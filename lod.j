globals
  trigger temp_trigger
  unit RealityTempUnit
  integer Silencer_CurseOfSilence_Level=0
  real LightningGrappleAngle
  unit LightningGrappleUnit
  real LightningGrappleDmg
  integer StaticChargeCounter
  unit StaticChargeCaster
  unit Lion_Finger_TempUnit
  real THD_TempReal1
  real THD_TempReal2
  real THD_TempReal3
  real THD_TempReal4
  real THD_TempReal5
  real THD_TempReal6
  
  unit Traxex_Gust_Tempunit=null
  real Traxex_Gust_TempX
  real Traxex_Gust_TempY
  group Traxex_Gust_TempGroup
  
  hashtable HeroStats=InitHashtable()
  hashtable UnitStats=InitHashtable()
  hashtable MHT = InitHashtable()
  hashtable hashtable019
  hashtable UltiCDs
  hashtable PRDtable=InitHashtable()
  
  boolean array PlayerHaveHero
  
  sound Sound_Tick
  real ForceOfNatureX
  real ForceOfNatureY
  boolean ForceOfNatureMC=false
  
  player TempPlayer
  
  integer LastRoshanSlayer=0
  real array ResetCooldown
  real array ReadyCooldown
  boolean AghBlackHoleDamage
  real Queen_SnatchedHP=999999
  unit Queen_SnatchedUnit=null
  group Queen_TempGroup=null
  unit Queen_TempUnit=null
  integer Queen_TempInt=0
  integer Queen_TempInt2=0
  integer FunHeroesTotal=1
  sound array spooky
  integer DigestItemsCount=0
  integer array DigestItems
  unit SpitTempUnit
  boolean FlyingCourierAllowed=false
  
  real ThirstInterval=0.015
  unit array BugHunterProviders
  real zOffsetDebug=.0
  boolean Mode_Debug=false
  unit BroodWebTemp
  boolean IsCorrosiveSkinDamage=false
  integer array DisablesList
  integer DisablesListCount=0
  string array SDHeroesPool
  integer array SDHeroesPoolInc
  integer array SDHeroesIDs
  constant string EmptySlotPath="UI\\Widgets\\Console\\Undead\\undead-inventory-slotfiller.blp"
  constant integer indexid_VS=1
  constant integer indexid_Zeus=2
  constant integer indexid_Enchantress=3
  constant integer indexid_Morphling=4
  constant integer indexid_CM=5
  constant integer indexid_Sven=6
  constant integer indexid_NagaSiren=7
  constant integer indexid_ES=8
  constant integer indexid_Riki=9
  constant integer indexid_LoneDruid=10
  constant integer indexid_Lina=11
  constant integer indexid_Juggernaut=12
  constant integer indexid_Silencer=13
  constant integer indexid_Treant=14
  constant integer indexid_Chieftain=15
  constant integer indexid_Kotl=16
  constant integer indexid_Ursa=17
  constant integer indexid_OgreMagi=18
  constant integer indexid_Tinker=19
  constant integer indexid_Furion=20
  constant integer indexid_PL=21
  constant integer indexid_Tiny=22
  constant integer indexid_Techies=23
  constant integer indexid_Chen=24
  constant integer indexid_Luna=25
  constant integer indexid_Sniper=26
  constant integer indexid_Troll=27
  constant integer indexid_Rhasta=28
  constant integer indexid_Wisp=29
  constant integer indexid_Pandaren=30
  constant integer indexid_Centaur=31
  constant integer indexid_Bounty=32
  constant integer indexid_DK=33
  constant integer indexid_AM=34
  constant integer indexid_Trax=35
  constant integer indexid_Omni=36
  constant integer indexid_Beastmaster=37
  constant integer indexid_THD=38
  constant integer indexid_Alchemist=39
  constant integer indexid_Potm=40
  constant integer indexid_Storm=41
  constant integer indexid_Huskar=42
  constant integer indexid_Lanaya=43
  constant integer indexid_Puck=44
  constant integer indexid_Clock=45
  constant integer indexid_Admiral=46
  constant integer indexid_WR=47
  constant integer indexid_Gyro=48
  constant integer indexid_Disruptor=49
  constant integer indexid_Tusk=50
  constant integer indexid_Phoenix=51
  constant integer indexid_BB=52
  constant integer indexid_Rubick=53
  constant integer indexid_Xin=54
  constant integer indexid_Legion=55
  constant integer indexid_Skywrath=56
  constant integer indexid_Timber=57
  constant integer indexid_Lycan=58
  constant integer indexid_Brood=59
  constant integer indexid_PA=60
  
  
  boolean quest_test=false
  
  group RadianceDamaged=CreateGroup()
  group TempGroup
  
  boolean NeedBoost=true
  integer array ArmletStrBonus
  integer array PositiveBuffs
  integer PositiveBuffsCount=0
  
  trigger CustomUnitBountySystem
  integer DMLivesLimit=666
  constant integer EXPAOE=1325
  unit GlobalKiller=null
  integer GlobalKillerExp
  boolean SacrificedByLich=false
  integer array SpawnHistory
  integer array EvasionContainers
  
  
  unit ShowPickUnit
  unit VisPickUnit
  unit ShowTUnit
  trigger TriggerEn1
  trigger TriggerEn2
  timer TimerMh
  integer array amhCounter
  boolean Intended=false
  
  integer array BonusMSPercentSystem
  
  constant integer COLOR=StringHash("color")
  constant integer BOUNTYL=StringHash("bounty_lowest")
  constant integer BOUNTYH=StringHash("bounty_highest")
  constant integer SIGHT=StringHash("sight")
  constant integer NSIGHT=StringHash("nsight")
  constant integer EXP=StringHash("expirience")
  // LoD Globals
  //===================================================
  //boolean array HasPickedUlt //used for 4 non-ult spells
  //==================================================
  
  real TempReal
  trigger BDRegen
  integer MORPH_MIN_STATS=0
  integer Lich_MorphedSkillId
  integer TempInteger
  timer DarknessTimer=CreateTimer()
  
  boolean TempBoolean=false
  
  boolean array HidePassivesForPlayer
  
  boolean IsFakeDamage=false
  integer array PassivesRealID
  integer array PassivesSpellbookID
  integer array PassivesLearningSkill
  integer array PassivesBuffID
  integer array PassivesUpgradeID
  integer array PassivesLearningSkillUpg
  integer array PassivesBaseUpgradeID
  integer array PassivesVisualID
  
  integer PassivesCount
  integer PassivesHiddenCount
  
  integer array AghaUpgradeID
  integer array AghaBaseSpellID
  integer array AghaUpgradedSpellID
  integer AghaCounter=0
  
  real DoubleEdgeDamage
  unit DoubleEdgeCaster
  integer array Prevent100GoldPerSwap
  boolean array IsImpossibleToBuyback
  
  unit array ReaperCasters
  
  group g_TrueshotGroup=CreateGroup()
  unit TrueshotBearer=null
  player TrueshotPlayer=null
  integer TrueshotDmg
  boolean TrueshotAlive=false
  boolean array TrueshotCreeps
  
  unit Oracle_TempCaster
  unit Oracle_TempDummy
  integer Oracle_TempLvl
  trigger Oracle_PurgeTrigger=null
  
  integer array BerserkerBloodResistCont
  
  unit Medusa_StoneGaze_TempUnit
  group Medusa_StoneGaze_Group
  
  trigger trig_WintersCurse
  unit unit_WinterCurseTarget
  group group_WinterCurse
  unit unit_WinterCurseCaster
  
  unit Wyvern_SplinterBlast_InitialCaster
  unit Wyvern_SplinterBlast_Helper
  
  unit TempCaster
  unit TempTarget
  trigger TempTrigger
  integer KaolinGGTempLvl
  integer KaolinGGBuffedByStone
  unit KaolinGGTempUnit
  group KaolinGGTempGroup
  real KaolinGeoGripTempX
  real KaolinGeoGripTempY
  integer KaolinTempRollingLvl
  boolean KaolinRollingBoulderTempBool
  integer KaolinTempRollingBuffed
  real KaolinTempRollingDamage
  group KaolinTempRollingGroup
  unit KaolinTempRollingCaster
  unit KaolinClosestTarget
  unit KaolinRollingTempUnit
  unit KaolinTempCaster
  unit KaolinPushedUnit
  unit KaolinSmashTempUnit
  unit KaolinMagnetizeTempCaster
  unit KaolinMagnetizeTempVictim
  group Kaolin_PushSmashedGroup
  integer KaolinTempInteger
  integer KaolinsPushLevelStorage
  real KaolinDistanceTemp
  real KaolinPushDamage
  boolean Kaolin_PreloadAnimation=false
  // LoD Globals - new
  //===================================================
  
  trigger GAME_TRIGGER = CreateTrigger()
  trigger CHAT_TRIGGER = CreateTrigger()
  trigger COOLDOWN_ITEM_TRIGGER = CreateTrigger()
  location ZeroLocation = Location(0,0)
  //boolean Mode_FF = false
  
  
  //used to store all the buffs that are removed when a unit transforms
  //==============================
  integer array morph_passives
  integer morph_passives_count
  
  
  //used for the timer system
  //==============================
  timer array udg_stack
  //timer array udg_store
  //boolean array udg_use
  integer udg_top = -1
  //integer udg_count = 0
  
  //used for the buff system
  //==============================		
  integer array LoDBuff_AbilID
  integer array LoDBuff_BuffID
  
  //used for the stats system
  //==============================
  integer LoDArmourAbilityBase  = 'AA00'
  integer LoDArmourAbilityCount = 8
  integer LoDArmourNegAbilityBase  = 'AG00'
  integer LoDArmourNegAbilityCount = 8
  integer LoDDamageAbilityBase  = 'AB00'
  integer LoDDamageAbilityCount = 12
  integer LoDRegenAbilityBase   = 'AC00'
  integer LoDRegenAbilityCount  = 6
  integer LoDManaRegenAbilityBase  = 'AD00'
  integer LoDManaRegenAbilityCount = 6
  integer LoDAttackAbilityBase  = 'AE00'
  integer LoDAttackAbilityCount = 10
  integer LoDAttackNegAbilityBase  = 'AF00'
  integer LoDAttackNegAbilityCount = 10
  integer LoDMovementAbilityBase   = 'AH00'
  integer LoDMovementAbilityCount  = 106
  integer LoDDamageNegAbilityBase  = 'AI00'
  integer LoDDamageNegAbilityCount = 12
  
  
  //used for group functions - if you see any of these variables used, replace it by something else
  //==============================
  unit array group_temp_unit
  real array group_temp_real
  integer array group_temp_integer
  boolean group_temp_boolean = false
  player group_temp_player = null
  group group_temp_group = null
  group temp_group = CreateGroup()
  group temp_group2 = CreateGroup()
  
  
  //new item id's
  //==============================
  integer indexid_ShadowAmulet
  
  
  // LoD Globals - stable
  //===================================================
  integer array CanAddTime
  
  boolean IsRealDamage=true
  real GetUnitPhysicalResistance_Result=1
  boolean LOLWTF=false
  trigger LOLWTF_Trig
  unit Shadowraze_Source=null
  integer Shadowraze_Level
  unit Netherblast_Source=null
  real Netherblast_x
  real Netherblast_y
  integer Netherblast_Level
  integer BuggedPassiveMax
  integer array PlayerPassiveSkill
  integer array PassiveReferenceId
  integer array PassiveBuffId
  integer array BuggedPassive
  integer array PassiveHiddenAbilityId
  integer array PassiveHiddenSpellBookId
  integer array HeroTypeId
  integer array InvokerSkill
  integer array AlternateSkillID
  boolean array CourierDead
  integer LoDMoonGlaive_Counter=0
  group LoDMoonGlaive_AlreadyHit
  unit LoDMoonGlaive_Source
  unit LoDMoonGlaive_Origin
  unit LoDMoonGlaive_Target
  real LoDMoonGlaive_MaxDistance
  real LoDMoonGlaive_Damage
  integer LoDMoonGlaive_Count
  unit RipTideSource=null
  group RipTideAlreadyHit=null
  integer NumberOfHeroes=112
  integer PlayerSkillOffset=6
  integer baseCreepSpawnTime=90
  integer CreepSpawnTimeForSD=150
  integer CreepSpawnTimeForMD=150
  boolean array b_EssenceShift_RangeSwitch
  constant integer EssenceShiftHash=StringHash("essenceshift")
  constant real FeastBaseForRanged=.0175
  constant real Balanced_MulticastHigherValue=150
  integer MaximumLevel=25
  boolean array b_isDamageShowed
  integer array DPS
  integer array PlayersId
  boolean array PlayerFFed
  boolean GameWasFFed=false
  boolean array IsPassiveAbility
  string TabTab="		"
  boolean b_isPickTime=true
  string s_MainMode=""
  string ModeForTitle
  integer array OneSkillCheckArray
  integer OneSkillOffsetCheck=1000
  integer NumberOfExtraAbilities=0
  integer array ExtraAbilityLevel
  integer i_BonusDraftAmount=0
  integer array i_BonusHeroCounter
  boolean array b_HeroAvailableForPlayer
  boolean array b_isPlayerReady
  boolean b_AllPlayersReady=false
  multiboard AbilityDraftMultiboard=null
  unit array SpellPickingDummy
  boolean array b_IsHeroAlreadyPreloaded
  integer array SelectedSkillHeroPointValue
  integer array UltimatesHeroId
  integer array MeleeOrRangedRestricted
  integer array HeroNumArrayRandomized
  integer array PlayerSkillNumber
  string array SkillIcon
  integer array SkillID
  integer array EngineeringUpgradeSkillID
  string array StackingLimitations
  string array BalanceStrings
  string array ExBalanceStrings
  string array StackingLimitations_Balanced
  integer array GlobalKillsCounter
  integer array GlobalDeathCounter
  integer array PlayerCS
  integer array PlayerDenyCounter
  integer array PlayerNeutralsCounter
  integer array GlobalAssistsCounter
  integer array ItemStats_Consumables
  integer array ItemStats_Wards
  integer array PlayerGoldCash
  integer array PlayerBestStreak
  integer array DoubleKillsCounter
  integer array TrippleKillsCounter
  integer array PlayerTimeDead
  integer array PlayerTowersDenied
  integer array GoldEarnedByKills
  integer array PlayerTowersKilled
  integer array PlayerAPM
  real array LastTimeActivity
  timer GlobalTimer=null
  real GameStartsTime=0
  integer array unusedarray
  boolean array b_isHeroPicked
  boolean array IsHeroIngame
  integer array PlayerKillsStreak
  integer array MultikillCounter
  integer array OwnageCounters
  boolean IsHeroesAvailable=false
  string array udg_Colors
  boolean array PlayerHaveRealHero
  timer array MultikillTimers
  timer array HeroRespawnTimer
  integer MinutesForTime=0
  integer SecondsForTime=0
  integer array DeathmatchKillsCounter
  boolean Mode_MA=false
  boolean Mode_DM=false
  boolean Mode_AR=false
  boolean Mode_TR=false
  boolean Mode_AP=false
  boolean Mode_ID=false
  multiboard CSBoard=null
  unit Roshan=null
  boolean array PlayerUseRandomStatus
  integer MinGoldForRepick=0
  boolean Mode_EM=false
  boolean Mode_NP=false
  boolean Mode_SC=false
  location FrozenThroneCreepsWaypoint=null
  location TreeOfLifeCreepsWaypoint=null
  location MidCreepsWaypoint=null
  location TopCreepsWaypoint=null
  location BottomCreepsWaypoint=null
  boolean SentinelTopRangeRaxExists=false
  boolean SentinelMidRangeRaxExists=false
  boolean SentinelBottomRangeRaxExists=false
  boolean SentinelTopMeleeRaxExists=false
  boolean SentinelMidMeleeRaxExists=false
  boolean SentinelBottomMeleeRaxExists=false
  boolean ScourgeTopRangeRaxExists=false
  boolean ScourgeMidRangeRaxExists=false
  boolean ScourgeBottomRangeRaxExists=false
  boolean ScourgeTopMeleeRaxExists=false
  boolean ScourgeMidMeleeRaxExists=false
  boolean ScourgeBottomMeleeRaxExists=false
  integer MeleeCreepsSpawnAmount=0
  integer RangeCreepsSpawnAmount=0
  location ScourgeMidMeleeSpawn=null
  location ScourgeTopMeleeSpawn=null
  location ScourgeBottomMeleeSpawn=null
  location ScourgeMidRangeSpawn=null
  location ScourgeBottomRangeSpawn=null
  location ScourgeTopRangeSpawn=null
  location SentinelMidMeleeSpawn=null
  location SentinelBottomMeleeSpawn=null
  location SentinelTopMeleeSpawn=null
  location SentinelMidRangeSpawn=null
  location SentinelBottomRangeSpawn=null
  location SentinelTopRangeSpawn=null
  location TopRuneSpawn=null
  location BottomRuneSpawn=null
  unit array udg_Hero
  integer integer542=0
  integer integer543=0
  player array S1
  player array T1
  integer array Deathmatch_LivesUsed
  unit array real011
  integer array OO
  force Force_SentPlayers=null
  force Force_ScourgePlayers=null
  player array Sentinels
  player array Scourges
  player NeutralsPlayer=null
  constant player Player15=Player(15)
  boolean Mode_SP=false
  integer VO=0
  integer array WO
  player PlayerModeTyper=null
  unit TmpUnit376=null
  integer TmpInt377=0
  real TmpReal378=0
  item array Mode_MM_Item0
  item array Mode_MM_Item1
  item array Mode_MM_Item2
  item array Mode_MM_Item3
  item array Mode_MM_Item4
  item array Mode_MM_Item5
  integer WaypointAbilID='A06G'
  location array WaypointLocations
  group C2=null
  boolean udg_ObserverMode=false
  boolean E2=false
  boolean Mode_MM_Activated=false
  boolean Mode_DU=false
  boolean Mode_MR=false
  boolean Mode_AA=false
  boolean Mode_AI=false
  boolean Mode_AS=false
  string FullModesString=""
  boolean Mode_SH=false
  boolean Mode_Normal=false
  player TempPlayer_OnRandom=null
  boolean Mode_VR=false
  boolean array Mode_VR_b
  integer array ItemsAbilities2
  integer ItemsAbilitiesMax2=0
  force AllPlayers=null
  boolean GameEnded=false
  constant real group008=0
  boolean region003=false
  boolean udg_Allow_Random=false
  boolean udg_Allow_Repick=false
  boolean Mode_RV=false
  boolean array HasAlreadyPickedHero
  string MainModeInTxt=""
  boolean array F3
  boolean array booleans050
  boolean rect001=false
  boolean boolean179=false
  location Y3=null
  real Meepo_Earthbind_TempY=0
  string string021=""
  string array L3
  rect ScouBotMeleeSpawnRect=null
  rect ScouMidMeleeSpawnRect=null
  rect ScouTopMeleeSpawnRect=null
  rect gg_rct_Hero_Creation_UD=null
  rect SentBotRangeSpawnRect=null
  rect SentTopRangeSpawnRect=null
  rect SentMidRangeSpawnRect=null
  rect ScouBotRangeSpawnRect=null
  rect ScouMidRangeSpawnRect=null
  rect ScouTopRangeSpawnRect=null
  rect gg_rct_Hero_Creation_NE=null
  rect SentBotMeleeSpawnRect=null
  rect SentTopMeleeSpawnRect=null
  rect SentMidMeleeSpawnRect=null
  rect BottomRuneSpawnRect=null
  rect F4=null
  rect G4=null
  rect TopRuneSpawnRect=null
  rect Z4=null
  rect V4=null
  rect W4=null
  rect X4=null
  rect Y4=null
  rect J4=null
  rect K4=null
  rect L4=null
  rect M4=null
  rect N4=null
  rect gg_rct_Allpick_Sent=null
  rect gg_rct_Allpick_Scourge=null
  rect R4=null
  rect P4=null
  rect Q4=null
  rect U4=null
  rect unit006=null
  rect real015=null
  rect integer041=null
  rect B5=null
  rect real014=null
  rect SomeRect7=null
  rect integer039=null
  rect F5=null
  rect integers010=null
  rect boolean036=null
  rect Z5=null
  rect V5=null
  rect W5=null
  rect integer040=null
  rect Y5=null
  rect rect070=null
  rect N5=null
  rect SomeRect2=null
  rect T5=null
  rect boolean037=null
  rect integer042=null
  rect real016=null
  rect unit007=null
  rect I6=null
  rect O6=null
  rect A6=null
  rect B6=null
  rect C6=null
  rect D6=null
  rect E6=null
  rect F6=null
  rect G6=null
  rect H6=null
  rect Z6=null
  rect V6=null
  rect W6=null
  rect X6=null
  rect Y6=null
  rect J6=null
  rect K6=null
  rect L6=null
  rect M6=null
  rect N6=null
  rect SomeRect3=null
  rect T6=null
  rect R6=null
  rect P6=null
  rect Q6=null
  rect U6=null
  rect I7=null
  rect O7=null
  rect A7=null
  rect B7=null
  rect C7=null
  rect D7=null
  rect E7=null
  rect F7=null
  rect G7=null
  rect H7=null
  rect Z7=null
  rect V7=null
  rect W7=null
  rect X7=null
  rect Y7=null
  rect J7=null
  rect K7=null
  rect L7=null
  rect M7=null
  rect N7=null
  rect S7=null
  rect T7=null
  rect R7=null
  rect P7=null
  rect Q7=null
  rect U7=null
  rect I8=null
  rect O8=null
  rect A8=null
  rect B8=null
  rect C8=null
  rect D8=null
  rect E8=null
  rect F8=null
  rect G8=null
  rect H8=null
  rect Z8=null
  rect V8=null
  rect W8=null
  rect X8=null
  rect Y8=null
  rect J8=null
  rect K8=null
  rect L8=null
  rect M8=null
  rect N8=null
  rect S8=null
  rect T8=null
  rect R8=null
  rect P8=null
  rect Q8=null
  rect U8=null
  rect integer032=null
  rect strings006=null
  rect integer036=null
  rect B9=null
  rect strings005=null
  rect D9=null
  rect integer033=null
  rect F9=null
  rect integer034=null
  rect strings002=null
  rect Z9=null
  rect V9=null
  rect W9=null
  rect integer035=null
  rect Y9=null
  rect J9=null
  rect integer038=null
  rect L9=null
  rect strings004=null
  rect N9=null
  rect S9=null
  rect T9=null
  rect strings003=null
  rect integer037=null
  rect strings007=null
  rect booleans006=null
  rect boolean025=null
  rect real007=null
  rect BA=null
  rect real006=null
  rect DA=null
  rect integer016=null
  rect LA=null
  rect string001=null
  rect NA=null
  rect SA=null
  rect TA=null
  rect SomeRect6=null
  rect real008=null
  rect real009=null
  rect real003=null
  rect IB=null
  rect OB=null
  rect SomeRect1=null
  rect BB=null
  rect CB=null
  rect DB=null
  rect EB=null
  rect FB=null
  rect GB=null
  rect HB=null
  rect ZB=null
  rect VB=null
  rect WB=null
  rect XB=null
  rect YB=null
  rect JB=null
  rect KB=null
  rect LB=null
  rect MB=null
  rect SB=null
  rect TB=null
  rect RB=null
  rect PB=null
  rect QB=null
  sound sound005=null
  sound sound006=null
  sound sound007=null
  sound boolean023=null
  sound DC=null
  sound boolean019=null
  sound FC=null
  sound Sound_TechiesLaugh=null
  sound ZC=null
  sound WC=null
  string string022="Sound\\Music\\mp3Music\\Human1.mp3"
  string string023="Sound\\Music\\mp3Music\\Human2.mp3"
  string string024="Sound\\Music\\mp3Music\\Human3.mp3"
  sound sound014=null
  sound LC=null
  sound boolean022=null
  sound sound016=null
  sound TC=null
  sound boolean020=null
  sound boolean024=null
  string string025="Sound\\Music\\mp3Music\\NightElf1.mp3"
  string string026="Sound\\Music\\mp3Music\\NightElf2.mp3"
  string OD="Sound\\Music\\mp3Music\\NightElf3.mp3"
  string string028="Sound\\Music\\mp3Music\\Orc1.mp3"
  string string029="Sound\\Music\\mp3Music\\Orc2.mp3"
  string string030="Sound\\Music\\mp3Music\\Orc3.mp3"
  string string031="Sound\\Music\\mp3Music\\BloodElfTheme.mp3"
  string string032="Sound\\Music\\mp3Music\\DarkAgents.mp3"
  string string033="Sound\\Music\\mp3Music\\TragicConfrontation.mp3"
  string string034="Sound\\Music\\mp3Music\\SadMystery.mp3"
  string string035="Sound\\Music\\mp3Music\\IllidansTheme.mp3"
  sound WD=null
  sound sound019=null
  sound QD=null
  sound UD=null
  string string036="Sound\\Music\\mp3Music\\Undead1.mp3"
  string string037="Sound\\Music\\mp3Music\\Undead2.mp3"
  string string038="Sound\\Music\\mp3Music\\Undead3.mp3"
  sound BE=null
  sound integer009=null
  sound sound022=null
  sound integer008=null
  sound FE=null
  sound sound024=null
  sound sound025=null
  sound JE=null
  sound KE=null
  sound sound026=null
  sound sound027=null
  sound sound028=null
  sound sound029=null
  sound sound030=null
  sound ResQFun=null
  sound sound032=null
  sound sound033=null
  sound sound034=null
  sound sound035=null
  sound sound036=null
  string string039="Sound\\Music\\mp3Music\\Tension.mp3"
  string string040="Sound\\Music\\mp3Music\\ArthasTheme.mp3"
  string string041="Sound\\Music\\mp3Music\\NightElfDefeat.mp3"
  string string042="Sound\\Music\\mp3Music\\NightElfVictory.mp3"
  sound ZF=null
  sound VF=null
  sound sound039=null
  sound sound040=null
  sound sound041=null
  sound sound042=null
  sound sound043=null
  sound sound044=null
  trigger RF=null
  trigger t_RegisterCreepsDeath=null
  trigger QF=null
  trigger UF=null
  trigger unit001=null
  trigger integers005=null
  trigger integers004=null
  trigger BG=null
  trigger reals001=null
  trigger DG=null
  trigger boolean004=null
  trigger FG=null
  trigger integer012=null
  trigger real001=null
  trigger ZG=null
  trigger VG=null
  trigger WG=null
  trigger integer014=null
  trigger YG=null
  trigger JG=null
  trigger group002=null
  trigger LG=null
  trigger integer013=null
  trigger trigger019=null
  trigger SG=null
  trigger trigger021=null
  trigger trigger022=null
  trigger unit002=null
  trigger integers002=null
  trigger OH=null
  trigger BH=null
  trigger integer002=null
  trigger DH=null
  trigger booleans001=null
  trigger FH=null
  trigger booleans002=null
  trigger integers003=null
  trigger ZH=null
  trigger VH=null
  trigger WH=null
  trigger boolean003=null
  trigger JH=null
  unit ScouBaseWaypointDummy=null
  unit TopWaypointDummy=null
  unit SentBaseWaypointDummy=null
  unit BottomWaypointDummy=null
  unit MidWaypointDummy=null
  unit GZ=null
  unit BY=null
  unit CY=null
  unit DY=null
  string HCLstring=""
  unit array VY
  unit array WY
  unit array XY
  integer YY=0
  destructable array destructables001
  destructable array destructables002
  destructable array destructables003
  integer integer546=0
  group array NY
  boolean array SY
  integer TY
  integer RY
  boolean PY=false
  trigger array QY
  real array UY
  integer IJ=0
  boolean array IsHeroDead
  real array AJ
  integer array BJ
  integer array CJ
  integer DJ=0
  string array strings019
  integer array integers127
  integer integer550=0
  string string044
  real real081
  integer TreesKilled=0
  sound sound060
  unit XJ
  real YJ
  real JJ
  real KJ
  integer tt_int1
  integer MJ
  integer NJ
  real tt_real1
  real tt_real2
  real real084
  real real085
  real PJ
  real QJ
  real UJ
  unit tt_unit1
  unit tt_unit2
  unit tt_unit3
  item tt_item1
  trigger integer029
  group DK
  group unit005
  player tt_player1
  boolean tt_bool1
  string unit004
  image tt_image1=null
  unit VK=null
  integer WK
  boolean NoHeroLimitOff=true
  trigger trigger024
  trigger trigger025
  region integer031
  integer LK=1
  boolean boolean035=false
  timer NK
  boolean SK=false
  integer CreepSpawnTime=90
  boolean boolean033=false
  boolean boolean185=false
  string integers009="No Mode"
  boolean Mode_NR=false
  boolean Mode_NS=false
  boolean Mode_ER=false
  boolean Mode_PM=false
  boolean BL=false
  boolean CL=false
  integer DL
  boolean EL=false
  integer array FL
  boolean array GL
  integer HL=0
  integer array ZL
  integer array VL
  integer array WL
  integer array YL
  integer array JL
  integer array KL
  integer array LL
  integer array ML
  integer array SL
  integer array TL
  boolean array ShowRollNumbers
  boolean array SoundsMuted
  boolean array CSONStatus1
  boolean array ShowCourierIcon
  unit group003=null
  unit group006=null
  boolean boolean190=false
  player player009=null
  player player010=null
  boolean array booleans057
  integer integer555
  player player011
  trigger trigger026=null
  boolean boolean191=false
  integer integer556
  integer integer557
  boolean Mode_CD=false
  boolean Mode_CM=false
  trigger HeroEnters
  boolean boolean193=false
  integer group004='A10N'
  integer IN='A0S0'
  integer ON='A10O'
  integer AN='A10P'
  boolean IsRemoveMinesBlast=false
  integer array CN
  region DN
  region EN
  region SomeRect4
  region GN
  region RestrictedRegion
  constant real ZN=150
  integer array DispellableBuffs
  integer DispellableBuffs_i=0
  integer array XN
  integer array YN
  integer array JN
  integer array KN
  integer LN=0
  gamecache MN
  gamecache RGCGC
  gamecache RGCGC2
  gamecache RGCGC3
  integer array BonusDamageSystemCont
  integer array SN
  integer array TN
  integer array RN
  trigger PN
  integer array BuybackUnitId
  integer array UN
  integer array BuybackUnitCost
  weathereffect Weather_Moonlight=null
  weathereffect Weather_Wind=null
  weathereffect Weather_Snow=null
  weathereffect Weather_Rain=null
  rect CS
  boolean fake_item_buy=false
  constant playercolor ES=ConvertPlayerColor(0)
  constant playercolor FS=ConvertPlayerColor(12)
  real real086=-7232
  real real087=-7136
  unit SentFountain
  unit SentinelBuilding_ShopCache
  unit SentinelBuilding_ShopWeapon
  unit SentinelBuilding_ShopAccessorizer
  unit SentinelBuilding_ShopChimaera
  unit SentinelBuilding_Shop1
  unit SentinelBuilding_Shop2
  unit SentinelBuilding_Shop3
  unit SentinelBuilding_Shop4
  unit SentinelBuilding_Shop5
  unit SentinelBuilding_Shop6
  unit NQ
  unit SQ
  unit TQ
  unit integer025
  unit boolean031
  unit integer027
  unit string005
  unit E47
  unit E77
  unit E87
  unit E97
  unit ED7
  unit EE7
  unit EF7
  unit EG7
  unit EH7
  unit EI7
  unit EJ7
  unit EK7
  unit EM7
  unit EN7
  unit EO7
  unit EP7
  unit EQ7
  unit ER7
  unit ES7
  unit ET7
  unit EU7
  unit EV7
  unit EW7
  unit EX7
  unit EY7
  unit EZ7
  constant playercolor EA7=ConvertPlayerColor(6)
  constant playercolor EB7=ConvertPlayerColor(12)
  real EC7=6272
  real E37=5504
  unit ScourgeFountain
  unit ScourgeBuilding_ShopGateway
  unit ScourgeBuilding_ShopWeapon
  unit ScourgeBuilding_ShopAccessorizer
  unit ScourgeBuilding_ShopGraveyard
  unit ScourgeBuilding_Shop1
  unit ScourgeBuilding_Shop2
  unit ScourgeBuilding_Shop3
  unit ScourgeBuilding_Shop4
  unit ScourgeBuilding_Shop5
  unit ScourgeBuilding_Shop6
  unit FrozenThrone
  unit Towers_Scourge_Top_1
  unit Towers_Scourge_Mid_1
  unit Towers_Scourge_Bot_1
  unit Towers_Scourge_Top_2
  unit Towers_Scourge_Mid_2
  unit Towers_Scourge_Bot_2
  unit Towers_Scourge_Top_3
  unit Towers_Scourge_Mid_3
  unit Towers_Scourge_Bot_3
  unit Towers_Scourge_Throne1
  unit Towers_Scourge_Throne2
  unit HL7
  unit H17
  unit H07
  unit H57
  unit H27
  unit I47
  unit I77
  unit I87
  unit I97
  unit ID7
  unit IE7
  unit IF7
  unit IG7
  unit IH7
  unit II7
  unit IJ7
  unit IK7
  unit IM7
  unit IN7
  unit IO7
  unit IP7
  unit CirclesOfPower_1
  unit CirclesOfPower_2
  unit CirclesOfPower_3
  unit CirclesOfPower_4
  unit CirclesOfPower_5
  unit CirclesOfPower_7
  unit CirclesOfPower_8
  unit CirclesOfPower_9
  unit CirclesOfPower_10
  unit CirclesOfPower_11
  unit array CirclesOfPower
  real array ItemSpawnX
  real array ItemSpawnY
  player udg_Observer1
  player udg_Observer2
  string array IL7
  integer array PlayerColors_R
  integer array PlayerColors_G
  integer array PlayerColors_B
  integer array HeroID
  integer array HeroCMDummy
  constant integer FirstSentinelHeroIndexid=1
  integer LastSentinelHeroIndexid
  integer FirstScourgeHeroIndexid
  integer LastScourgeHeroIndexid
  integer array AgiHeroesArray
  integer AgilityHeroesAmount
  integer array StrHeroesArray
  integer StrHeroesAmount
  integer array IntHeroesArray
  integer IntHeroesAmount
  integer array RangeHeroesArray
  integer RangeHeroesAmount
  integer array MeleeHeroesArray
  integer MeleeHeroesAmount
  string array HeroIcon
  integer array DummyID
  string array HeroTips1
  string array HeroTips2
  string array HeroTips3
  string array HeroTips4
  string array HeroTips5
  unit TavernIntSent1
  unit TavernIntSent2
  unit TavernIntScourge1
  unit TavernIntScourge2
  unit TavernAgiSent1
  unit TavernAgiSent2
  unit TavernAgiScourge1
  unit TavernAgiScourge2
  unit TavernStrSent1
  unit TavernStrSent2
  unit TavernStrScrouge1
  unit TavernStrScrouge2
  integer array SomeDummyAbilitiesList
  integer SomeDummyAbilitiesCounter=0
  integer array ItemsActiveAbilities
  integer ItemsActiveAbilitiesCount=-1
  boolean array IsPlayerLeftGame
  integer LeaversCounter=0
  integer SharedControlAlliesCount
  player SharedControlAlliesTempPlayer
  trigger OneHero
  trigger TriggerGoldPerSecond
  trigger TriggerUpdateGameTime
  timer array PrimaryUltiCooldownTimer
  timer array SecondaryUltiCooldownTimer
  integer array ReliableGold
  real array Assists_LastTimeDamaged
  integer array Assists_PlayerID
  integer array Assists_PlayerIDDamaged
  integer Assists_Increment=1
  constant real Assists_MaxTime=18
  player array Assists_Assisters
  unit array Revive_WhichHero
  real array Revive_When
  boolean array Revive_isShallowGrave
  integer Revive_InQueue=0
  unit array Revive_TempUArray
  real array Revive_TempRArray
  boolean array Revive_TempBArray
  unit TempUnit_BSCheck
  unit TempUnit_UrnCheck
  integer TempInt_UrnsCount
  integer TempInt_JanggoesCount
  integer AssistBonusesGoldGlobal
  integer AssistBonusesExpGlobal
  integer array AssistsBonusExpCounter
  integer array AssistsBonusGoldCounter
  integer AssistersAllGlobalCounter
  integer AssistersAllWOKillerGlobalCounter
  unit K27=null
  boolean M47=true
  integer M77=1
  trigger M87
  integer M97=0
  leaderboard array MD7
  integer array Item_Dummy
  integer array Item_Real
  integer array Item_SellerUnit
  integer array Item_Mute
  string array Item_Icon
  integer array Item_Cooldown
  integer array MK7
  integer ITC=0
  integer indexid_aghanimSilencer
  integer indexid_aghanimAA
  integer indexid_aghanimOmni
  integer indexid_aghanimSkywrath
  integer indexid_aghanimRubick
  integer indexid_aghanimEnigma
  integer indexid_aghanimDisruptor
  
  integer indexid_OrbOfVenom
  integer indexid_OrbOfVenomRanged
  integer indexid_BootsOfSpeed
  integer indexid_GlovesOfHaste
  integer indexid_BootsOfElvenskin
  integer indexid_CircletOfNobility
  integer indexid_BeltOfStrength
  integer indexid_BladesOfAlacrity
  integer indexid_BladesOfAttack
  integer indexid_Broadsword
  integer indexid_Chainmail
  integer indexid_Claymore
  integer indexid_DemonEdge
  integer indexid_Eaglehorn
  integer indexid_EnergyBooster
  integer indexid_GauntletOfStrength
  integer indexid_Gem
  integer indexid_GemCourier
  integer indexid_HelmOfIronWill
  integer indexid_Hyperstone
  integer indexid_IronwoodBranch
  integer indexid_KelensDagger
  integer indexid_DisabledKelensDagger
  integer indexid_MantleOfIntelligence
  integer indexid_MaskOfDeath
  integer indexid_MesserschmidtReaver
  integer indexid_MithrilHammer
  integer indexid_MysticStaff
  integer indexid_OgreAxe
  integer indexid_PlaneswalkerCloak
  integer indexid_PlateMail
  integer indexid_PointBooster
  integer indexid_Quarterstaff
  integer indexid_RingOfHealth
  integer indexid_RingOfProtection
  integer indexid_RingOfRegeneration
  integer indexid_RobeOfMagi
  integer indexid_SacredRelic
  integer indexid_SlippersOfAgility
  integer indexid_SobiMask
  integer indexid_StaffOfWizardry
  integer indexid_StoutShield
  integer indexid_StoutShieldRanged
  integer indexid_UltimateOrb
  integer indexid_VitalityBooster
  integer indexid_VoidStone
  integer indexid_javelin
  integer indexid_Bottle0Shop
  integer indexid_Bottle0
  integer indexid_bottle1
  integer indexid_bottle2
  integer indexid_bottle3
  integer indexid_BottleInvis
  integer indexid_BottleDD
  integer indexid_BottleHaste
  integer indexid_BottleRegen
  integer indexid_BottleIllusion
  integer indexid_MagicStick
  integer indexid_QuellingBlade
  integer indexid_QuellingBladeRanged
  integer indexid_TalismanOfEvasion
  integer indexid_EtherealBlade
  integer indexid_corruptor
  integer indexid_corruptorranged
  integer indexid_janggo
  integer indexid_janggoempty
  integer indexid_BladeOfTheReaper
  integer indexid_TranquilBoots
  integer indexid_TranquilBootsBroken
  integer indexid_RodOfAtos
  integer indexid_MoonShard
  integer indexid_RingOfAquila
  integer indexid_RingOfAquilaHero
  integer indexid_ClarityPotion
  integer indexid_claritypotionborrowed
  integer indexid_ghostpotion
  integer indexid_HealingSalve
  integer indexid_Tango
  integer indexid_TangoSec
  integer indexid_ObserverWards
  integer indexid_SentryWards
  integer indexid_ScrollOfTownPortal
  integer indexid_AnimalCourier
  integer indexid_Cheese
  integer OX7
  integer indexid_dustofappearance
  integer indexid_wandofillusions
  integer indexid_Smoke
  integer indexid_Perseverance
  integer indexid_HeaddressOfRejuvenation
  integer indexid_NathrezimBuckler
  integer indexid_RingOfBasilius
  integer indexid_RingOfBasiliusHero
  integer indexid_bootsOfTravel
  integer indexid_PowerTreadsAgility
  integer indexid_PowerTreadsStrength
  integer indexid_PowerTreadsIntelligence
  integer indexid_HandOfMidas
  integer indexid_HandOfMidasCourier
  integer indexid_OblivionStaff
  integer indexid_Bracer
  integer indexid_WraithBand
  integer indexid_NullTalisman
  integer indexid_Yasha
  integer indexid_Sange
  integer indexid_CraniumBasher
  integer indexid_CraniumBasherRanged
  integer indexid_BladeMail
  integer indexid_Maelstrom
  integer indexid_DiffusalBlade
  integer indexid_DiffusalBlade_upg
  integer indexid_DiffusalBlade_empty
  integer indexid_DiffusalBlade_upg_empty
  integer indexid_HelmOfTheDominator
  integer indexid_HelmOfTheDominatorCourier
  integer indexid_MaskOfMadness
  integer indexid_Eul
  integer indexid_SoulBooster
  integer indexid_Mekansm
  integer indexid_SangeAndYasha
  integer indexid_Desolator
  integer indexid_BattleFury
  integer indexid_Crystalys
  integer indexid_BlackKingBar10
  integer indexid_BlackKingBar09
  integer indexid_BlackKingBar08
  integer indexid_BlackKingBar07
  integer indexid_BlackKingBar06
  integer indexid_BlackKingBar05
  integer indexid_BlackKingBar04
  integer indexid_Aegis
  integer indexid_MantaStyle
  integer indexid_MantaStyleRanged
  integer indexid_LotharsEdge
  integer indexid_Dagon1
  integer indexid_Dagon2
  integer indexid_Dagon3
  integer indexid_Dagon4
  integer indexid_Dagon5
  integer indexid_Necronomicon1
  integer indexid_Necronomicon2
  integer indexid_Necronomicon3
  integer indexid_LinkensSphere
  integer indexid_LinkenDummy
  integer indexid_DivineRapier
  integer indexid_DivineRapierFree
  integer indexid_Buriza
  integer indexid_MKBOn
  integer indexid_MKBOff
  integer indexid_RadianceOn
  integer indexid_RadianceOff
  integer indexid_HeartOfTarrasque
  integer indexid_DisabledHeartOfTarrasque
  integer indexid_Satanic
  integer indexid_EyeOfSkadi
  integer indexid_EyeOfSkadiRanged
  integer indexid_Butterfly
  integer indexid_RefresherOrb
  integer indexid_GuinsooHex
  integer indexid_Vanguard
  integer indexid_VanguardRanged
  integer indexid_ArcaneRing
  integer indexid_Mjollnir
  integer indexid_FlyingCourier
  integer indexid_VladmirsOffering
  integer indexid_AssaultCuirass
  integer indexid_bloodstone
  integer indexid_HoodOfDefiance
  integer indexid_ArmletOn
  integer indexid_ArmletOff
  integer indexid_ArmletOnCourier
  integer indexid_ArmletOffCourier
  integer indexid_ShivasGuard
  integer indexid_ShivasGuardCourier
  integer indexid_Orchid
  integer indexid_PhaseBoots
  integer indexid_MagicWand
  integer indexid_ForceStaff
  integer indexid_Pipe
  integer indexid_PoormansShield
  integer indexid_PoormansShieldRanged
  integer indexid_GhostScepter
  integer indexid_UrnOfShadows
  integer indexid_UrnOfShadowsEmpty
  integer indexid_SoulRing
  integer indexid_ArcaneBoots
  integer indexid_MedallionOfCourage
  integer indexid_VeilOfDiscord
  integer indexid_HeavensHalberd
  integer indexid_AbyssalBlade
  integer indexid_RecipeHeaddressOfRejuvenation
  integer indexid_RecipeNethrezimBuckler
  integer indexid_RecipeBootsOfTravel
  integer indexid_RecipePowerTreads
  integer indexid_RecipeHandOfMidas
  integer indexid_RecipeBracer
  integer indexid_RecipeWraithBand
  integer indexid_RecipeNullTalisman
  integer indexid_RecipeYasha
  integer indexid_RecipeSange
  integer indexid_RecipeCraniumBasher
  integer indexid_RecipeMaelstrom
  integer indexid_RecipeDiffusalBlade
  integer indexid_RecipeMaskOfMadness
  integer indexid_RecipeEul
  integer indexid_RecipeMekansm
  integer indexid_RecipeSangeAndYasha
  integer indexid_RecipeDesolator
  integer indexid_RecipeCrystalys
  integer indexid_RecipeBKB
  integer indexid_RecipeMantaStyle
  integer indexid_RecipeLotharsEdge
  integer indexid_RecipeDagon
  integer indexid_RecipeNecronomicon
  integer indexid_RecipeLinken
  integer indexid_RecipeBuriza
  integer indexid_RecipeRadiance
  integer indexid_RecipeHeartOfTarrasque
  integer indexid_RecipeSatanic
  integer indexid_RecipeEyeOfSkadi
  integer indexid_RecipeButterfly
  integer indexid_RecipeRefresherOrb
  integer indexid_RecipeArcaneRing
  integer indexid_RecipeFlyingCourier
  integer indexid_RecipeVladmirOffering
  integer indexid_RecipeAssaultCuirass
  integer indexid_RecipeArmlet
  integer indexid_RecipeShivasGuard
  integer indexid_RecipeMagicWand
  integer indexid_RecipeForceStaff
  integer indexid_RecipePipe
  integer indexid_RecipeAghanim
  integer indexid_RecipeMjollnir
  integer indexid_RecipeUrnOfShadows
  integer indexid_RecipeSoulRing
  integer indexid_RecipeJanggo
  integer indexid_RecipeMedallion
  integer indexid_RecipeVeilOfDiscord
  integer indexid_RecipeOrchid
  integer indexid_RecipeBladeOfReaper
  integer indexid_RecipeTranquilBoots
  trigger T47
  integer T77=-1
  integer array Rec_Comp_1
  integer array Rec_Comp_2
  integer array Rec_Comp_3
  integer array Rec_Comp_4
  integer array Rec_Comp_5
  integer array Rec_Final
  integer Recipe_Max=0
  integer indexid_AghanimBasic
  integer indexid_AghanimFurion
  integer indexid_AghanimKotL
  integer indexid_AghanimLeshrak
  integer indexid_AghanimLich
  integer indexid_AghanimLina
  integer indexid_AghanimLion
  integer indexid_AghanimLucifer
  integer indexid_AghanimLuna
  integer indexid_AghanimNecro
  integer indexid_AghanimOgre
  integer indexid_AghanimZombie
  integer indexid_AghanimPugna
  integer indexid_AghanimQoP
  integer indexid_AghanimRhasta
  integer indexid_AghanimCM
  integer indexid_AghanimVeno
  integer indexid_AghanimWD
  integer indexid_AghanimZeus
  integer indexid_AghanimSniper
  integer indexid_AghanimClockwerk
  integer indexid_AghanimVS
  integer indexid_AghanimJuggernaut
  integer indexid_AghanimChaosKnight
  integer indexid_AghanimChen
  integer indexid_AghanimNightstalker
  integer indexid_AghanimJakiro
  integer indexid_AghanimSandKing
  integer indexid_AghanimHuskar
  integer indexid_AghanimInvoker
  integer indexid_AghanimPanda
  integer indexid_aghanimPudge
  integer indexid_AghanimWR
  integer indexid_AghanimVoid
  integer indexid_AghanimSpiritbreaker
  integer indexid_AghanimBane
  integer indexid_AghanimAbaddon
  integer indexid_AghanimDazzle
  integer indexid_AghanimTechies
  integer indexid_AghanimAxe
  integer indexid_AghanimES
  integer indexid_AghanimPuck
  integer indexid_AghanimWL
  integer indexid_AghanimRazor
  integer indexid_AghanimViper
  integer indexid_AghanimTiny
  integer indexid_AghanimOD
  integer indexid_AghanimEnchantress
  integer indexid_AghanimDS
  integer indexid_AghanimGyro
  integer indexid_AghanimMeepo
  integer indexid_AghanimBeastmaster
  integer indexid_AghanimVisage
  integer array HasItem_Javelin
  integer array HasItem_Dagger
  integer array HasItem_Bloodstone
  integer array HasItem_CraniumBasher
  integer array HasItem_LinkenSphere
  integer array HasItem_SangeNYasha
  integer array HasItem_Sange
  player U07
  unit U57
  unit U27
  integer V47
  boolean V77=false
  unit V87
  trigger t_manipulateitem
  integer TotalCount_LinkenSphere=0
  integer TotalCount_Dagger=0
  integer TotalCount_Bloodstone=0
  integer TotalCount_Heart=0
  integer VN7=0
  integer array HasItem_HeavensHalberd
  boolean VP7=false
  trigger VQ7
  trigger VR7
  real array VS7
  item array VT7
  integer VU7=0
  trigger VV7
  unit array VW7
  unit VX7=null
  real array VY7
  real array LastTimeDamaged_ForDagger
  integer array HasItem_Heart
  integer array HasItem_TranquilBoots
  real array V17
  real array V07
  player array V57
  real array V27
  real array W47
  real array W77
  integer W87=-1
  constant real W97=25
  constant real WD7=525
  region WE7
  integer WS7='A0FY'
  unit WT7
  unit WU7
  unit WV7
  group WW7
  unit WX7
  unit WY7
  player WZ7
  boolean WA7=false
  boolean WB7=false
  boolean WC7=false
  real W37
  boolean W67=false
  boolean array WL7
  constant real W07=6
  player W57
  constant real W27=25
  constant real X47=4
  boolean X77=false
  boolean X87=false
  boolean X97=false
  boolean XD7=false
  boolean XE7=false
  boolean XF7=false
  boolean XG7=false
  boolean XH7=false
  boolean XI7=false
  integer array XJ7
  integer array XK7
  integer XM7=0
  integer XN7
  integer XO7
  integer SentinelsIngame=0
  integer ScourgesIngame=0
  string XR7="|c00ff0303"
  string XS7="|c00ff0303"
  string XT7="|c000042ff"
  string XU7="|c00646464"
  string XV7="|c00ffffff"
  multiboard XW7
  integer array XX7
  integer array XY7
  player array XZ7
  integer XA7=0
  string XB7="|c00FF6600"
  multiboard ObsBoard
  trigger X37
  real X67=0
  real XL7=0
  real X17=0
  real X07=0
  real X57=0
  real X27=0
  real Y47=0
  real Y77=0
  real Y87=0
  real Y97=0
  real YD7=0
  real YE7=0
  real YF7=0
  real YG7=0
  real YH7=0
  real YI7=0
  real YJ7=0
  real YK7=0
  real YM7=0
  real YN7=0
  real YO7=0
  real YP7=0
  real YQ7=0
  real YR7=0
  real YS7=0
  real YT7=0
  real YU7=0
  real YV7=0
  real AntiBDRegenRate=90
  boolean YX7=false
  boolean YY7=false
  boolean YZ7=false
  boolean YA7=false
  boolean YB7=false
  boolean YC7=false
  boolean Y37=false
  boolean Y67=false
  boolean YL7=false
  unit Y17=null
  unit Y07=null
  group Y57
  boolean HeroDamageTracking_Enabled=true
  boolean Z47=false
  integer Z77=0
  string array Z87
  boolean Z97=false
  integer ZD7
  player ZE7
  integer ZF7
  integer ZG7='A0HU'
  integer ZH7='A0HX'
  trigger ZI7
  region ZJ7
  boolean ZK7=false
  boolean ZM7=false
  boolean ZN7=false
  boolean IsNotReplay=false
  unit array HeroAttackedLogic_Attackers
  group HeroAttackedLogic_TempGroup
  unit HeroAttackedLogic_TempUnit
  integer HeroAttackedLogic_TempInt
  integer HeroAttackedLogic_Counter=0
  integer array ZU7
  boolean array FixedCameraOnHero
  boolean array AutoselectionStatus
  boolean array HeroHasBeenUnlocked
  boolean ZY7=true
  boolean array ZZ7
  real ZA7=-200
  boolean array ShowDeathTimer
  leaderboard array ZC7
  boolean array CSONStatus2
  boolean Z67=true
  weathereffect ZL7
  boolean array Z17
  boolean array hhnActive
  boolean array ItemInfoShown
  boolean array SpellInfoShown
  boolean AFK_Check=true
  boolean array A47
  string array A77
  integer A87=0
  string A97="Sound\\Music\\mp3Music\\PH1.mp3"
  boolean array CustomWaterColor
  integer AE7
  integer AF7
  integer AG7
  string array AH7
  boolean array AI7
  integer AJ7=0
  boolean AK7=true
  integer array AM7
  boolean array AN7
  constant real AO7=-6950
  constant real AP7=6750
  boolean AQ7=false
  trigger AR7
  boolean AS7=false
  integer array CMGold
  boolean ModeCM_Manual
  boolean ModeCM_Started=false
  boolean udg_CMSpawn=false
  integer array ModeCM_Bank
  integer array ModeCM_Time
  integer ModeCM_Order
  integer ModeCM_Current
  integer array ModeCM_Bans1
  integer array ModeCM_Bans2
  integer ModeCM_BanCount1=0
  integer ModeCM_BanCount2=0
  integer array ModeCM_Picks1
  integer array ModeCM_Picks2
  integer ModeCM_PickCount1=0
  integer ModeCM_PickCount2=0
  integer ModeCM_PickPhase=0
  multiboard CMBoard
  image CM_Image1
  image CM_Image2
  image CM_Image3
  image CM_Image4
  unit array BE7
  integer array BF7
  boolean array BG7
  unit array BH7
  real array BI7
  real array BJ7
  real array BK7
  real array BM7
  real array BN7
  real array BO7
  real array BP7
  real array BQ7
  real RD_CenterX_Sent=-7030
  real RD_CenterY_Sent=6966
  real BT7=-7000
  real BU7=6875
  constant real BW7=75
  constant real BX7=125
  player BY7=null
  player BZ7=null
  integer BA7
  boolean BB7=false
  boolean BC7=false
  boolean array B37
  real B67
  real BL7
  real B17
  real B07
  unit array B57
  integer B27=0
  trigger C47
  unit array C77
  unit array C87
  boolean C97=false
  trigger CD7
  integer array CE7
  unit array CF7
  unit array CG7
  integer CH7=0
  unit array CI7
  integer CJ7
  integer CK7
  integer array CM7
  integer CN7
  boolean array CO7
  integer array CP7
  integer array CQ7
  integer CR7=0
  integer CS7=0
  real array CT7
  real array CU7
  real array CV7
  real array CW7
  integer array CX7
  boolean CY7=true
  image CZ7
  image CA7
  image CB7
  image CC7
  image C37
  image C67
  image CL7
  image C17
  image C07
  image C57
  image C27
  image L47
  image L77
  image L87
  image L97
  image LD7
  constant real LF7=75
  constant real LG7=140
  boolean Mode_SD=false
  integer array LJ7
  integer array LK7
  integer array LM7
  integer array LN7
  integer array LO7
  integer array LP7
  integer array LQ7
  integer LR7
  integer LS7
  integer LT7
  string LU7="|c008A2BE2Option 1: |r"
  string LV7="|c008A2BE2Option 2: |r"
  string LW7="|c008A2BE2Option 3: |r"
  integer LX7
  integer array LY7
  boolean LZ7=false
  boolean LA7=false
  leaderboard LB7
  integer LC7
  integer array L37
  boolean L67=false
  boolean LL7=false
  leaderboard L17
  boolean L07=false
  boolean Mode_MO=false
  boolean Mode_RO=false
  boolean Mode_OM=false
  boolean D78=true
  boolean Mode_NB=false
  boolean udg_ModeUB=false
  boolean Mode_NM=false
  boolean Mode_NT=false
  boolean DF8=false
  boolean Mode_OI=false
  real DH8=1.
  boolean Mode_MI=false
  boolean Mode_FR=false
  boolean Mode_ZM=false
  camerasetup DM8=null
  boolean Mode_CP=false
  boolean Mode_UL=false
  boolean Mode_SS=false
  boolean Mode_AB=false
  boolean Mode_S5=false
  boolean Mode_S6=false
  boolean Mode_FN=false
  boolean Mode_D2=false
  boolean Mode_D3=false
  boolean Mode_D4=false
  boolean Mode_D5=false
  boolean Mode_OS=false
  boolean Mode_BO=false
  boolean Mode_EB=false
  boolean Mode_MD=false
  boolean Mode_RA=false
  boolean Mode_LS3=false
  boolean Mode_LS=false
  boolean Mode_FF=false
  
  unit DO8
  unit DP8
  unit DQ8
  unit DR8
  unit DS8
  unit DT8
  group DA8
  unit DB8
  integer DC8
  real D58
  unit D28
  integer E48=0
  integer array TrackBonusBounty
  integer E78
  real E88
  unit E98
  integer ED8
  unit EE8
  integer EF8
  unit EG8
  real EH8
  unit EI8
  real EJ8
  integer EK8
  integer EM8
  unit EN8
  real EO8
  unit array EP8
  unit array EQ8
  integer ER8
  integer ES8
  real ET8
  real EU8
  unit EV8
  unit array EW8
  real EX8
  real EY8
  integer EZ8
  integer EA8
  unit EB8
  real EC8
  real E38
  real E68
  unit EL8
  unit array E18
  unit E28
  integer F48
  unit F78
  real F88
  real F98
  real FD8
  integer FE8=0
  real FF8
  real FG8
  integer FH8
  real FI8
  unit FJ8
  integer array FK8
  integer array FM8
  unit FN8
  unit FO8
  group FP8
  group FQ8
  group FR8
  integer FS8=0
  unit FT8
  integer array FU8
  integer array FV8
  integer array FW8
  integer array FX8
  integer array FY8
  unit F68
  real FL8
  integer array F18
  unit F08
  unit F58
  unit F28
  real G48
  unit G88
  unit G98
  integer GF8
  unit GG8
  unit GH8
  real GI8
  real GJ8
  real GK8
  real GM8
  boolean GU8=false
  boolean GV8=false
  trigger GW8
  integer GX8
  player GY8
  integer GZ8
  unit GA8
  real GB8
  unit GC8
  unit G38
  real G68
  real GL8
  integer G18
  unit G08
  unit G58
  unit G28
  group H48
  integer H78
  group H88
  unit H98
  real HD8
  destructable HE8=null
  unit HF8=null
  real HG8=0
  constant real HH8=26
  constant real HI8=550
  constant real HJ8=500
  real HK8
  real HM8
  group HN8
  unit HO8
  real HP8
  integer HQ8
  integer HR8
  unit HS8
  unit HU8
  integer HV8
  boolean HW8=false
  integer HX8
  unit HY8
  integer array HZ8
  integer array HA8
  integer array HB8
  integer array HC8
  unit H38
  unit H68
  integer HL8
  real H18
  real H08
  unit H58
  unit H28
  boolean I48=false
  integer I78
  unit I88
  group ID8
  group IE8
  unit IF8
  integer IH8='h06J'
  real II8
  real IJ8
  unit IK8
  unit IM8
  unit IN8
  real IO8
  real IP8
  real IQ8
  integer IR8
  real IS8
  real IT8
  unit IU8
  unit IV8
  integer IW8
  group IX8
  unit IY8
  unit IZ8
  integer IA8
  integer IB8
  player IC8
  integer I38
  unit array I68
  integer IL8
  integer I18
  group I58
  integer I28
  real JF8
  unit JG8
  integer array JH8
  trigger dividedwestand_t
  trigger DoubleTroubleTrigger
  integer dividedwestand_count=0
  boolean dividedwestand_usedscepter=false
  unit JN8
  real JO8
  real JP8
  real JQ8
  unit JR8
  unit JS8
  unit JT8
  group JU8
  real JV8
  unit JZ8
  integer JA8
  unit Necrolyte_Heartstopper_Caster
  integer Necrolyte_Heartstopper_Lvl
  unit J08
  integer array K88
  integer array K98
  group KD8
  integer KE8
  unit KF8
  real KG8
  real KJ8
  unit KK8
  unit KM8
  real KN8
  integer KO8
  unit array KP8
  unit KQ8
  unit KR8
  unit KS8
  integer KT8
  real KU8
  group KV8=null
  unit K38
  unit K18
  integer K08
  unit K58
  unit K28
  integer M48
  unit array M78
  boolean M88=false
  unit M98
  integer MD8
  real array ME8
  real array MF8
  real array MG8
  unit array MH8
  integer array MI8
  integer array MJ8
  integer MK8
  unit MM8
  integer MN8
  unit MO8
  unit MP8
  group MQ8
  integer MR8
  unit MS8
  unit MT8
  integer MU8
  integer sunray_level
  unit sunray_source
  unit N98
  group ND8
  unit NF8
  unit NG8
  real NH8
  real NI8
  real NJ8
  real NK8
  constant real NM8=325
  unit NN8
  unit NO8
  integer NP8
  real NQ8
  unit NR8
  boolean NS8=false
  unit NT8
  unit NU8
  real NV8
  unit NW8
  integer NX8
  integer NY8
  unit NZ8
  group NA8
  real NB8
  integer NC8
  region N38
  region N68
  unit NL8
  unit N18
  integer N08
  group N58
  group N28
  unit O48
  unit O78
  unit O88
  integer O98
  real OD8
  real OE8
  real OF8
  integer OG8
  unit OH8
  unit OI8
  unit OJ8
  unit OK8
  group OM8
  real ON8
  integer array OO8
  integer OP8=0
  integer OQ8
  unit OR8
  integer OS8
  integer OT8
  unit OU8
  real OV8
  real OW8
  real OX8
  unit OY8
  integer array OZ8
  integer array O18
  integer array O08
  integer O58
  integer O28
  integer P48
  unit P78
  integer P88
  integer P98
  sound PD8=null
  boolean PE8=false
  integer PM8
  integer PN8
  group PR8
  unit PS8
  integer PT8
  timer PB8=null
  force P68=null
  boolexpr PL8=null
  boolean array TIMERIMG
  trigger APShowTimersTrig
  unit TEMPUNIT
  unit BlackholeCaster
  group ILLUMINATEGROUP=CreateGroup()
  boolean RMD_StatsSent=false
endglobals

function echo takes string s returns nothing
  if bj_isSinglePlayer then
    call BJDebugMsg(s)
  endif
endfunction
//
//function IssueImmediateOrderById takes unit u, integer id returns boolean
//	call echo(GetUnitName(u)+" - "+I2S(id))
//	return IssueImmediateOrderById(u,id)
//endfunction
//
//function IssueImmediateOrder takes unit u, string str returns boolean
//	call echo(GetUnitName(u)+" - "+str)
//	return IssueImmediateOrder(u,str)
//endfunction
//
//function IssueTargetOrder takes unit u, string str, unit t returns boolean
//	call echo(GetUnitName(u)+" - "+str+" at "+GetUnitName(t))
//	return IssueTargetOrder(u,str,t)
//endfunction

function CreateTextTag_Hook takes nothing returns texttag
  local texttag tt=CreateTextTag()
  call echo(I2S(GetHandleId(tt)))
  return tt
endfunction

function HideAbility takes integer id returns nothing
  call SetPlayerAbilityAvailable(Player(1),id,false)
  call SetPlayerAbilityAvailable(Player(2),id,false)
  call SetPlayerAbilityAvailable(Player(3),id,false)
  call SetPlayerAbilityAvailable(Player(4),id,false)
  call SetPlayerAbilityAvailable(Player(5),id,false)
  call SetPlayerAbilityAvailable(Player(7),id,false)
  call SetPlayerAbilityAvailable(Player(8),id,false)
  call SetPlayerAbilityAvailable(Player(9),id,false)
  call SetPlayerAbilityAvailable(Player(10),id,false)
  call SetPlayerAbilityAvailable(Player(11),id,false)
endfunction

function RectF takes real x1, real y1, real x2, real y2 returns rect
  local integer i=0
  local unit u
  local integer color=GetRandomInt(0,255)
  set u=CreateUnit(Player(15),'ewsp',x1,y1,0)
  call SetUnitVertexColor(u,color,color,color,255)
  call UnitAddAbility(u,'Aloc')
  set u=CreateUnit(Player(15),'ewsp',x1,y2,0)
  call SetUnitVertexColor(u,color,color,color,255)
  call UnitAddAbility(u,'Aloc')
  set u=CreateUnit(Player(15),'ewsp',x2,y1,0)
  call SetUnitVertexColor(u,color,color,color,255)
  call UnitAddAbility(u,'Aloc')
  set u=CreateUnit(Player(15),'ewsp',x2,y2,0)
  call SetUnitVertexColor(u,color,color,color,255)
  call UnitAddAbility(u,'Aloc')
  set u=null
  return Rect(x1,y1,x2,y2)
endfunction

function PRD_Init takes nothing returns nothing
  call SaveReal(PRDtable,-1,0,0.0038)
  call SaveReal(PRDtable,-1,1,0.0147)
  call SaveReal(PRDtable,-1,2,0.0322)
  call SaveReal(PRDtable,-1,3,0.0557)
  call SaveReal(PRDtable,-1,4,0.0847)
  call SaveReal(PRDtable,-1,5,0.1189)
  call SaveReal(PRDtable,-1,6,0.1579)
  call SaveReal(PRDtable,-1,7,0.2015)
  call SaveReal(PRDtable,-1,8,0.2493)
  call SaveReal(PRDtable,-1,9,0.3021)
  call SaveReal(PRDtable,-1,10,0.3604)
  call SaveReal(PRDtable,-1,11,0.4226)
  call SaveReal(PRDtable,-1,12,0.4811)
  call SaveReal(PRDtable,-1,13,0.5714)
  call SaveReal(PRDtable,-1,14,0.6666)
  call SaveReal(PRDtable,-1,15,0.7500)
  call SaveReal(PRDtable,-1,16,0.8235)
  call SaveReal(PRDtable,-1,17,0.8888)
  call SaveReal(PRDtable,-1,18,0.9473)
  call SaveReal(PRDtable,-1,19,1.0000)
endfunction

function PRD_Get takes unit u, integer abilId, real chance returns boolean
  local integer h=GetHandleId(u)
  local real fxdchance=R2I(chance/5.)*5.
  local real add=LoadReal(PRDtable,-1,R2I(fxdchance/5.)-1)
  local real curchance=LoadReal(PRDtable,h,abilId)
  local real rnd=GetRandomReal(0.0,1.0)
  if IsUnitType(u,UNIT_TYPE_HERO)==false then
    return GetRandomInt(1,100)<chance
  endif
  if rnd<curchance+add then
    call SaveReal(PRDtable,h,abilId,0.0)
    return true
  else
    call SaveReal(PRDtable,h,abilId,curchance+add)
    return false
  endif
endfunction

function TriggerRegisterPlayersChat takes trigger t, string s, boolean strict returns nothing
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],s,strict)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],s,strict)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],s,strict)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],s,strict)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],s,strict)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],s,strict)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],s,strict)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],s,strict)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],s,strict)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],s,strict)
endfunction

function GetProperAttachPoint_Weapon takes unit u returns string
  local integer i=GetUnitTypeId(u)
  if i=='EC57' or i=='Hamg' or i=='E01Y' or i=='H00K' or i=='N0HP' or i=='Ucrl'  then
    return "hand"
  endif//veno Treant lanaya techies aa tony
  return "weapon"
endfunction

function GetProperAttachPoint_Foot takes unit u returns string
  local integer i=GetUnitTypeId(u)
  if i=='UC76' or i=='N0HP' or i=='Ulic' or i=='O016' or i=='O017' then
    return "origin"
  endif//Krobelus, aa, lich, bat rider
  return "foot"
endfunction

function ExeFunc takes string s returns nothing
  //	call PreloadEndEx()
  //	call PreloadGenClear()
  //	call PreloadGenStart()
  //	call Preload(s)
  //	call PreloadGenEnd("exec"+R2S(GetRandomReal(0,500))+".txt")
  //	call PreloadGenClear()
  call ExecuteFunc(s)
endfunction

function IsUnitVisibleLoD takes unit u, player p returns boolean
  return IsUnitVisible(u,p) and GetUnitAbilityLevel(u,'A1HX')==0
endfunction

function PidToChar takes integer i returns string
  if i==10 then
    return ":"
  elseif i==11 then
    return ";"
  endif
  return I2S(i)
endfunction

// RMD - SyncInteger Functions
function Traffic_RegisterCustomData takes string parent, string child, integer value returns nothing
  call StoreInteger(RGCGC,parent,child,value)
  call SyncStoredInteger(RGCGC,parent,child)
endfunction

function Traffic_RegisterCustomMetaData takes string parent, string child, integer value returns nothing
  call StoreInteger(RGCGC2,parent,child,value)
  call SyncStoredInteger(RGCGC2,parent,child)
endfunction

function Traffic_RegisterCustomGlobalData takes string parent, string child, integer value returns nothing
  call StoreInteger(RGCGC3,parent,child,value)
  call SyncStoredInteger(RGCGC3,parent,child)
endfunction

// RMD - Count players
function GetPlayerCount takes nothing returns integer
  local integer n=0
  local integer i=0
  local player p
  
  loop
    set p = Player(i)
    if GetPlayerController(p)==MAP_CONTROL_USER and GetPlayerSlotState(p)==PLAYER_SLOT_STATE_PLAYING then
      set n=n+1
    endif
    
    set i=i+1
    exitwhen i>11
  endloop
  
  return n
endfunction

// RMD SendStats
function RMD_SendStats takes nothing returns nothing
  local integer i=0
  local integer n=1
  
  if RMD_StatsSent==true then
    return
  endif
  
  // Toggle Sent
  set RMD_StatsSent=true
  
  // Loop
  loop
    call Traffic_RegisterCustomData("a",PidToChar(i),GlobalKillsCounter[n])
    call Traffic_RegisterCustomData("b",PidToChar(i),GlobalDeathCounter[n])
    call Traffic_RegisterCustomData("c",PidToChar(i),GlobalAssistsCounter[n])//assists
    call Traffic_RegisterCustomData("d",PidToChar(i),PlayerCS[n])//cs
    call Traffic_RegisterCustomData("e",PidToChar(i),PlayerDenyCounter[n])
    call Traffic_RegisterCustomData("f",PidToChar(i),LoadInteger(hashtable019,(400+n),(79)))//neutrals
    
    // Iterate
    set n=n+1
    set i=i+1
    
    // DotA Exception		
    if n==6 then
      set n=7
    endif
    
    exitwhen i==10
  endloop
endfunction

// RMD - A player left the game
function RMD_LeaveAction takes nothing returns nothing
  if GetPlayerCount()==2 then
    call RMD_SendStats()
  endif
endfunction
 
// RMD - Init Function (( call this asap ))
function RMD_Init takes nothing returns nothing
  local integer i=0
  local trigger t=CreateTrigger()
  local player p
  
  loop
    set p = Player(i)
    if GetPlayerController(p)==MAP_CONTROL_USER and GetPlayerSlotState(p)==PLAYER_SLOT_STATE_PLAYING then
      call TriggerRegisterPlayerEventLeave(t,p)
    endif
    
    set i=i+1
    exitwhen i==12
  endloop
  
  call TriggerAddAction(t,function RMD_LeaveAction)
  set t=null
endfunction
/////////////////////////
// RMD - Functions GetBottleWithRuneId //
/////////////////////////

//greatest function ever!
function herp takes nothing returns nothing
  call DisplayTextToPlayer(GetTriggerPlayer(),0,0,"herp")
endfunction

function B2S takes boolean b returns string
  if b then
    return "true"
  endif
  
  return "false"
endfunction

function Char2Id takes string c returns integer
  local integer i=0
  local string abc="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
  local string t
  loop
    set t=SubString(abc,i,i+1)
    exitwhen t==null or t==c
    set i=i+1
  endloop
  if i<10 then
    return i+48
  elseif i<36 then
    return i+65-10
  endif
  return i+97-36
endfunction

function String2Id takes string s returns integer
  return ((Char2Id(SubString(s,0,1))*256+Char2Id(SubString(s,1,2)))*256+Char2Id(SubString(s,2,3)))*256+Char2Id(SubString(s,3,4))
endfunction

function Id2Char takes integer i returns string
  local string abc="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
  if i>=97 then
    return SubString(abc,i-97+36,i-96+36)
  elseif i>=65 then
    return SubString(abc,i-65+10,i-64+10)
  endif
  return SubString(abc,i-48,i-47)
endfunction

function Id2String takes integer id returns string
  local integer t=id/256
  local string r=Id2Char(id-256*t)
  set id=t/256
  set r=Id2Char(t-256*id)+r
  set t=id/256
  return Id2Char(t)+Id2Char(id-256*t)+r
endfunction



//Systems:
//
//  Timer
//   - deals with timer recycling
//   - pretty simple, just use Timer_Get() instead of CreateTimer(), and Timer_End() instead of DestroyTimer()
//   - Timer_End() both stops the timer, and flushes the timers handle from the hashtable MHT
//   - note it does NOT flush hashtable HY
//
//
//  Movement
//   - can add both constant or percentage movespeed bonuses
//   - isnt really that useful, but is used for a few things
//   - is best for used for providing a movespeed increase without a buff
//   - can only increase movespeed, i didn't feel like adding another 100 abilities to deal with negative speeds as well, especially considering it probably wont be used \:3
//
//
//  Stats
//   - Deals with adding bonus damage, armour, regen, mana regen, or attack speed
//   - Use LoDStat_Set to set the value of one of these properties of a unit. Protip: dont use LoDStat_Set() since then you have to manually keep track of the bonuses a unit has
//	 instead use LoDStat_Add() and LoDStat_Sub() to add and subtract any bonuses, since these will not overide other bonuses the unit already has
//   - uses bitflagging to add the correct amount
//   - damage, armour, and attack speed can also add negative amounts
//
//
//  Buffs
//   - Adds a buff to a unit
//   - Can set the buff to last to certain amount of time, or forever if the duration passed is less than 0
//
//
//  Passive Cooldown
//   - Causes a skill to go into cooldown
//   - note that while the original passive skill is actually removed from the unit, while the dummy skill is on cooldown
//   - I'm not sure if this will cause issues with illusions \:3/
//
//
//  Other things to note:
//   - Movement, Buffs, Cooldown, and Stats systems all make the abilities they add permenant, to prevent bugs with transformation
//
//
//  Events
//   - uses only 2 triggers to register events, instead of a new trigger for every spell
//   - GAME_TRIGGER registers all spell, damage, attack, order events
//   - CHAT_TRIGGER registers chat events :3
//   - this only applies to spell I recoded, the older spells still use their own triggers to register events
//   - all setup is done in LoDEvent_Init()
//   - specific events such as orders, spells or damage are added when the hero enters the map
//
//==================================================================================================================================================

function Timer_End takes timer t returns nothing
  //set udg_top = udg_top + 1
  //set udg_stack[udg_top] = t
  
  //call BJDebugMsg("adding: "+I2S(GetHandleId(t))+"  top: "+I2S(udg_top))
  
  //call TimerStart(t,0,false,null)
  call PauseTimer(t)
  
  call FlushChildHashtable(MHT,GetHandleId(t))
  call DestroyTimer(t)
  
  //call BJDebugMsg("ending timer: "+I2S(GetHandleId(t)))
endfunction
function Timer_Get takes nothing returns timer
  //local timer t = CreateTimer()
  //local timer t = null
  
  //if udg_top ==-1 then
  //	set t = CreateTimer()
  
  //	call BJDebugMsg("empty stack, making: "+I2S(GetHandleId(t)))
  //	return t
  
  //return CreateTimer()
  //endif
  
  //set udg_top = udg_top - 1
  
  //set t = udg_stack[udg_top + 1]
  //call BJDebugMsg("top: "+I2S(udg_top + 1)+"  using: "+I2S(GetHandleId(t)))
  
  //return udg_stack[udg_top + 1]
  
  //call BJDebugMsg("making timer: "+I2S(GetHandleId(t)))
  
  return CreateTimer()
  //return t
endfunction


function GetIndex takes item B38 returns integer
  local integer ZF8
  local integer i=1
  if B38==null then
    return-2
  endif
  //set ZF8=DummyItem(GetItemTypeId(B38))
  set ZF8=GetItemTypeId(B38)
  loop
    
    if Item_Dummy[i]==ZF8 or Item_Real[i]==ZF8 or Item_Mute[i]==ZF8 then
      return i
    endif
    set i=i+1
    exitwhen i>ITC
  endloop
  return-1
endfunction

function GetBootsMS takes unit u returns integer
  if GetUnitAbilityLevel(u,'A0V0')>0 then
    if GetUnitAbilityLevel(u,'A0V0')==1 then
      return 40
    elseif GetUnitAbilityLevel(u,'A0V0')==2 then
      return 60
    elseif GetUnitAbilityLevel(u,'A0V0')==3 then
      return 85
    elseif GetUnitAbilityLevel(u,'A0V0')==4 then
      return 95
    elseif GetUnitAbilityLevel(u,'A0V0')==5 then
      return 90
    elseif GetUnitAbilityLevel(u,'A0V0')==6 then
      return 95
    elseif GetUnitAbilityLevel(u,'A0V0')==7 then
      return 110
    elseif GetUnitAbilityLevel(u,'A0V0')==8 then
      return 135
    endif
  endif
  
  if GetUnitAbilityLevel(u,'A00D')>0 then //travels
    return 100
  elseif GetUnitAbilityLevel(u,'A2HR')>0 then //tranquil boots
    return 85
  elseif GetUnitAbilityLevel(u,'A1VR')>0 then //mana boots
    return 60
  elseif GetUnitAbilityLevel(u,'A05U')>0 or GetUnitAbilityLevel(u,'A12V')>0 then //power treads and phase boots
    return 50
  elseif GetUnitAbilityLevel(u,'AIms')>0 then //boots of speed
    return 50
  elseif GetUnitAbilityLevel(u,'A2I9')>0 then //broken tranquil boots
    return 60
  endif
  return 0
endfunction

function BootsMs takes integer id returns integer
  if id=='I06B'then //travels
    return 100
  endif
  
  if id=='I0OG'then //tranquil boots
    return 75
  endif
  
  if id=='I0MI'then //mana boots
    return 60
  endif
  
  if id=='I05Z' or id=='I0GJ'then //powers treads or phase boots
    return 55
  endif
  
  if id=='I02O'then //boots of speed
    return 50
  endif
  
  if id=='I0OI' then//broken tranquil boots
    return 25
  endif
  
  if id=='I08Z'then //euls
    return 30
  endif
  
  return 0
endfunction

function IsBoots takes integer id returns boolean
  return BootsMs(id)>0
endfunction

function HasBoots takes unit u returns boolean
  local integer loopA = 0
  
  loop
    
    if IsBoots(Item_Real[GetIndex(UnitItemInSlot(u,loopA))]) then
      return true
    endif
    set loopA = loopA + 1
    exitwhen loopA == 6
  endloop
  
  return false
endfunction



function GetUnitOffsetSpeed takes unit u returns integer
  local integer lvl = GetUnitAbilityLevel(u,'EUL1') //euls
  local integer lvl2 = GetUnitAbilityLevel(u,'EUL2') //euls
  local integer movespeed
  if GetUnitAbilityLevel(u,'A33W')>0 then
    return 1000
  endif
  if lvl > 0 then
    if lvl==1 then
      set movespeed=40
    elseif lvl==2 then
      set movespeed=90
    elseif lvl==4 then
      set movespeed=95
    else
      set movespeed=100
    endif
  endif
  if lvl2>0 then
    if lvl2==1 then
      set movespeed=125
    elseif lvl2==2 then
      set movespeed=140
    endif
  endif
  if lvl+lvl2>0 then
    return movespeed
  endif
  if GetUnitAbilityLevel(u,'A00D')>0 then //travels
    return 100
  elseif GetUnitAbilityLevel(u,'A2HR')>0 then //tranquil boots
    return 85
  elseif GetUnitAbilityLevel(u,'A1VR')>0 then //mana boots
    return 55
  elseif GetUnitAbilityLevel(u,'A05U')>0 or GetUnitAbilityLevel(u,'A12V')>0 then //power treads and phase boots
    return 50
  elseif GetUnitAbilityLevel(u,'AIms')>0 then //boots of speed
    return 50
  elseif GetUnitAbilityLevel(u,'A2I9')>0 then //broken tranquil boots
    return 60
  endif
  
  return 0
endfunction

function LoDMovement_Get takes unit u returns integer
  return LoadInteger(MHT,GetHandleId(u),'MOVE')
endfunction

function GetUnitBaseSpeed takes unit u returns real
  return GetUnitDefaultMoveSpeed(u) + LoDMovement_Get(u)
endfunction

function GetUnitMoveSpeedLOD takes unit u returns real
  if LoadReal(HeroStats,GetHandleId(u),99)>0 then
    return LoadReal(HeroStats,GetHandleId(u),99)+GetUnitMoveSpeed(u)
  endif
  return GetUnitMoveSpeed(u)
endfunction


function LoDMovement_Set takes unit u, integer i returns integer
  local integer load = GetHandleId(u)
  local integer level = i - (i/4)*4
  local integer offset = (i-1)/4
  
  call UnitRemoveAbility(u,LoadInteger(MHT,'MOVE',load))
  
  if i > 521 then
    call UnitAddAbility(u,'AH1O')
    call SetUnitAbilityLevel(u,'AH1O',4) // doesnt have to b 4, just cant be one. \:3/
    call UnitMakeAbilityPermanent(u,true,'AH1O')
    
    call SaveInteger(MHT,load,'MOVE',522)
    call SaveInteger(MHT,'MOVE',load,'AH1O')
    
    return 522
  endif
  
  if 1>i then
    return 0
  endif
  
  set offset = LoDMovementAbilityBase + offset
  call SaveInteger(MHT,load,'MOVE',i)
  
  call SaveInteger(MHT,'MOVE',load,offset)
  
  
  if level == 0 then
    set level = 4
  endif
  
  call UnitAddAbility(u,offset)
  call SetUnitAbilityLevel(u,offset,level)
  call UnitMakeAbilityPermanent(u,true,offset)
  
  return i
endfunction

function LoDMovement_Add takes unit u, integer i returns integer
  local integer load = GetHandleId(u)
  //local integer o = 0//GetUnitOffsetSpeed(u)
  //local integer r = LoDMovement_Set(u,o + LoadInteger(MHT,load,'MOVE') + i) - o
  local integer r = LoDMovement_Set(u,LoadInteger(MHT,load,'MOVE') + i)
  
  //call SaveInteger(MHT,load,'MOVE',r)
  
  
  //call BJDebugMsg("r: "+I2S(r))
  //call BJDebugMsg("setting bonus ms to: "+I2S(LoDMovement_Get(u)))
  
  return r
endfunction
function LoDMovement_Sub takes unit u, integer i returns integer
  local integer load = GetHandleId(u)
  //local integer o = 0//GetUnitOffsetSpeed(u)
  //local integer r = LoDMovement_Set(u,o + LoadInteger(MHT,load,'MOVE') - i) - o
  
  local integer r = LoDMovement_Set(u,LoadInteger(MHT,load,'MOVE') - i)
  
  
  
  call SaveInteger(MHT,load,'MOVE',r)
  
  //call BJDebugMsg("r: "+I2S(r))
  //call BJDebugMsg("setting bonus ms to: "+I2S(LoDMovement_Get(u)))
  
  return r
endfunction
function LoDMovement_Pickup takes unit u, integer id returns nothing
  local integer i
  
  if HasBoots(u)then
    set i = BootsMs(id) - LoadInteger(MHT,GetHandleId(u),'BOOT')
    
    if i > 0 then
      call LoDMovement_Add(u,i)
      call SaveInteger(MHT,GetHandleId(u),'BOOT',LoadInteger(MHT,GetHandleId(u),'BOOT') + i)
    endif
  else
    set i = BootsMs(id)
    
    call LoDMovement_Add(u,i)
    call SaveInteger(MHT,GetHandleId(u),'BOOT',i)
  endif
endfunction
function LoDMovement_Drop takes unit u, integer id returns nothing
  local integer i
  
  //if HasBoots(u)then
  set i = BootsMs(id)
  
  if i == LoadInteger(MHT,GetHandleId(u),'BOOT')then
    call LoDMovement_Sub(u,i)
    call SaveInteger(MHT,GetHandleId(u),'BOOT',LoadInteger(MHT,GetHandleId(u),'BOOT') + i)
  endif
  //else
  //	call LoDMovement_Sub(u,BootsMs(id))
  //endif
endfunction



function LodStat_Count takes string s returns integer
  if s == "damage" then
    return LoDDamageAbilityCount
  elseif s == "damageneg" then
    return LoDDamageNegAbilityCount
  elseif s == "armour" then
    return LoDArmourAbilityCount
  elseif s == "armourneg" then
    return LoDArmourNegAbilityCount
  elseif s == "regen" then
    return LoDRegenAbilityCount
  elseif s == "manaregen" then
    return LoDManaRegenAbilityCount
  elseif s == "attack" then
    return LoDAttackAbilityCount
  elseif s == "attackneg" then
    return LoDAttackNegAbilityCount
  else
    call BJDebugMsg("Derp, invalid stat: "+s)
    return 0
  endif
endfunction
function LodStat_Base takes string s returns integer
  if s == "damage" then
    return LoDDamageAbilityBase
  elseif s == "damageneg" then
    return LoDDamageNegAbilityBase
  elseif s == "armour" then
    return LoDArmourAbilityBase
  elseif s == "armourneg" then
    return LoDArmourNegAbilityBase
  elseif s == "regen" then
    return LoDRegenAbilityBase
  elseif s == "manaregen" then
    return LoDManaRegenAbilityBase
  elseif s == "attack" then
    return LoDAttackAbilityBase
  elseif s == "attackneg" then
    return LoDAttackNegAbilityBase
  else
    call BJDebugMsg("Derp, invalid stat: "+s)
    return 0
  endif
endfunction
function LoDStat_Set takes unit u, integer i, string s returns integer
  local integer loopA = 0
  local integer base = LodStat_Base(s)    //lowest ability ID of the set of abilities
  local integer total = LodStat_Count(s)  //number of abilities there are in the system
  local integer limit= R2I(Pow(2,total) - 1) //max amount a unit can have from the system
  local integer r = i
  local real temp
  
  if i > limit then
    loop
      call UnitAddAbility(u,base+loopA)
      set loopA = loopA + 1
      exitwhen loopA > limit
    endloop
    
    return limit
  elseif 1>i then
    loop
      call UnitRemoveAbility(u,base+loopA)
      set loopA = loopA + 1
      exitwhen loopA > limit
    endloop
    
    return 0
  endif
  
  set temp = i/2.
  set i = i/2
  
  loop
    
    if i == temp or 0 > i then
      call UnitRemoveAbility(u,base + loopA)
    else
      call UnitAddAbility(u,base + loopA)
      //call BJDebugMsg(I2S(loopA)+"   "+B2S(UnitAddAbility(u,base + loopA)))
      call UnitMakeAbilityPermanent(u, true, base + loopA)
    endif
    
    set temp = i/2.
    set i = i/2
    set loopA = loopA + 1
    exitwhen loopA == total
  endloop
  
  return r
endfunction
function LoDStat_Get takes unit u, string s returns integer
  local integer loopA = 0
  local integer base = LodStat_Base(s)    //lowest ability ID of the set of abilities
  local integer total = LodStat_Count(s)  //number of abilities there are in the system
  local real current = 0
  
  loop
    
    if GetUnitAbilityLevel(u,base+loopA)==1then
      set current = current + Pow(2,loopA)
    endif
    set loopA = loopA + 1
    exitwhen loopA > total
  endloop
  
  return R2I(current)
endfunction
function LoDStat_Add takes unit u, integer i, string s returns integer
  return LoDStat_Set(u,LoDStat_Get(u,s)+i,s)
endfunction
function LoDStat_Sub takes unit u, integer i, string s returns integer
  local integer i2 = LoDStat_Set(u,LoDStat_Get(u,s)-i,s)
  
  if s=="manaregen" and 1>i2 then
    call UnitRemoveAbility(u,'Barm') //hidden buff for mana regen \:3/
  endif
  
  return i
endfunction
function LoDStat_Init takes nothing returns nothing
  //isnt needed, just used for preloading
  
  local integer loopA = 0
  local unit u = CreateUnit(Player(15),'H00Y',0,0,270)
  
  call LoDStat_Set(u,2000,"damage")
  call LoDStat_Set(u,2000,"damageneg")
  call LoDStat_Set(u,2000,"armour")
  call LoDStat_Set(u,2000,"armourneg")
  call LoDStat_Set(u,2000,"regen")
  call LoDStat_Set(u,2000,"manaregen")
  call LoDStat_Set(u,2000,"attack")
  call LoDStat_Set(u,2000,"attackneg")
  
  call UnitAddAbility(u,'A0X6')
  
  loop
    
    call UnitAddAbility(u,LoDMovementAbilityBase + loopA)
    set loopA = loopA + 1
    exitwhen loopA == LoDMovementAbilityCount
  endloop
  
  call RemoveUnit(u)
  
  set u = null
endfunction


function LoDMovePercentage_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer current
  local integer amount
  local unit u = LoadUnitHandle(MHT,info,0)
  local integer curbonus=GetBootsMS(u)
  if 0.405>=GetWidgetLife(u) then
    //call BJDebugMsg("calling timer end from MovePercentage: DEATH")
    call DestroyTimer(t)
    set t = null
    set u = null
    return
  endif
  
  set current = LoadInteger(MHT,info,0)
  set amount = R2I(GetUnitBaseSpeed(u)*LoadReal(MHT,info,0))
  
  if current!=amount then
    call LoDMovement_Sub(u,LoadInteger(MHT,info,0))
    call LoDMovement_Add(u,amount)
    call SaveInteger(MHT,info,0,amount)
  endif
  
  set t = null
  set u = null
endfunction

function LoDMovePercentage_Set takes unit u, real r, boolean b returns real
  local integer load = GetHandleId(u)
  local timer t = LoadTimerHandle(MHT,load,'AH00')
  local integer amount = R2I(GetUnitBaseSpeed(u)*r)
  local integer info
  
  
  if t==null then
    set t = CreateTimer()
    call SaveTimerHandle(MHT,load,'AH00',t)
  endif
  
  set info = GetHandleId(t)
  
  if b and amount >= LoadInteger(MHT,info,0) then
    call RemoveSavedHandle(MHT,load,'AH00')
    call LoDMovement_Sub(u,amount)
    
    call DestroyTimer(t)
    set t = null
    return 0.0
  endif
  
  call SaveUnitHandle(MHT,info,0,u)
  call SaveReal(MHT,info,0,r)
  call SaveInteger(MHT,info,0,amount)
  
  if b then
    call LoDMovement_Sub(u,amount)
  else
    call LoDMovement_Add(u,amount)
  endif
  
  call TimerStart(t,0.5,true,function LoDMovePercentage_Duration)
  
  set t = null
  return r
endfunction

function LoDMovePercentage_Add takes unit u, real r returns real
  return LoDMovePercentage_Set(u,r,false)
endfunction

function LoDMovePercentage_Sub takes unit u, real r returns real
  return LoDMovePercentage_Set(u,r,true)
endfunction


function Buff_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer id_b = LoadInteger(hashtable019,info,1)
  local unit u = LoadUnitHandle(hashtable019,info,0)
  
  call RemoveSavedHandle(hashtable019,GetHandleId(u),id_b)
  call UnitRemoveAbility(u,LoadInteger(hashtable019,info,0))
  call UnitRemoveAbility(u,id_b)
  call FlushChildHashtable(hashtable019,info)
  call DestroyTimer(t)
  
  set t = null
  set u = null
endfunction

function Buff_Duration takes unit u, integer id_b returns real
  if GetUnitAbilityLevel(u,id_b)==0then
    return 0.
  endif
  
  return TimerGetRemaining(LoadTimerHandle(hashtable019,GetHandleId(u),id_b))
endfunction

function Buff_Remove takes unit u, integer id_b returns nothing
  if GetUnitAbilityLevel(u,id_b)==0 and(IsUnitType(u,UNIT_TYPE_STRUCTURE)==true and GetUnitAbilityLevel(u,LoadInteger(hashtable019,GetHandleId(LoadTimerHandle(hashtable019,GetHandleId(u),id_b)),0))==0)then
    return
  endif
  
  call TimerStart(LoadTimerHandle(hashtable019,GetHandleId(u),id_b),0.,false,function Buff_End)
  call UnitRemoveAbility(u,id_b)
endfunction

function Buff_Add takes unit u, integer id_a, integer id_b, real duration returns nothing
  local timer t = null
  local integer info
  
  set IsRealDamage = false
  
  if GetUnitAbilityLevel(u,id_b)==0then
    set t = CreateTimer()
  else
    set t = LoadTimerHandle(hashtable019,GetHandleId(u),id_b)
  endif
  set info = GetHandleId(t)
  
  if HaveSavedInteger(hashtable019,info,0)and LoadInteger(hashtable019,info,0)!=id_a then //prevents permanently having an ability :S
    call UnitRemoveAbility(u,LoadInteger(hashtable019,info,0))
  endif
  
  call SaveTimerHandle(hashtable019,GetHandleId(u),id_b,t)
  
  call UnitAddAbility(u,id_a)
  call UnitMakeAbilityPermanent(u,true,id_a)
  
  set IsRealDamage = true
  
  call SaveUnitHandle(hashtable019,info,0,u)
  call SaveInteger(hashtable019,info,0,id_a)
  call SaveInteger(hashtable019,info,1,id_b)
  
  if duration>0then
    call TimerStart(t,duration,false,function Buff_End)
  endif
  
  set t = null
endfunction

function Buff_Init takes nothing returns nothing
  set LoDBuff_AbilID[0] = 'C000' //Aphotic Shield
  set LoDBuff_BuffID[0] = 'D000'
  set LoDBuff_AbilID[1] = 'C001' //Ion Shell
  set LoDBuff_BuffID[1] = 'D001'
  set LoDBuff_AbilID[2] = 'C002' //Maledict
  set LoDBuff_BuffID[2] = 'D002'
  set LoDBuff_AbilID[3] = 'C003' //Berserker's Call Target
  set LoDBuff_BuffID[3] = 'D003'
  set LoDBuff_AbilID[4] = 'C004' //Berserker's Call Caster
  set LoDBuff_BuffID[4] = 'D004'
  set LoDBuff_AbilID[5] = 'C005' //Reactive Armour
  set LoDBuff_BuffID[5] = 'D005'
  set LoDBuff_AbilID[6] = 'C006' //Trueshot
  set LoDBuff_BuffID[6] = 'D006'
  set LoDBuff_AbilID[7] = 'C007' //Last Word
  set LoDBuff_BuffID[7] = 'D007'
  set LoDBuff_AbilID[8] = 'C008' //Spiked Carapace
  set LoDBuff_BuffID[8] = 'D008'
  set LoDBuff_AbilID[9] = 'C009' //Firestorm
  set LoDBuff_BuffID[9] = 'D009'
  set LoDBuff_AbilID[10]= 'C010' //Fire Spirits
  set LoDBuff_BuffID[10]= 'D010'
  set LoDBuff_AbilID[11]= 'C011' //Icarus Dive
  set LoDBuff_BuffID[11]= 'D011'
  set LoDBuff_AbilID[12]= 'C012' //Sadist
  set LoDBuff_BuffID[12]= 'D012'
  set LoDBuff_AbilID[13]= 'C013' //Autofire
  set LoDBuff_BuffID[13]= 'D013'
  set LoDBuff_AbilID[14]= 'C014' //Acid Spray
  set LoDBuff_BuffID[14]= 'D014'
  set LoDBuff_AbilID[15]= 'C015' //Ancestral Spirit
  set LoDBuff_BuffID[15]= 'D015'
  set LoDBuff_AbilID[16]= 'C016' //Reflection
  set LoDBuff_BuffID[16]= 'D016'
  set LoDBuff_AbilID[17]= 'C017' //Stampede targets
  set LoDBuff_BuffID[17]= 'D017'
  set LoDBuff_AbilID[18]= 'C018' //Enfeeble
  set LoDBuff_BuffID[18]= 'D018'
  set LoDBuff_AbilID[19]= 'C019' //Brilliance Aura (Self Only)
  set LoDBuff_BuffID[19]= 'D019'
  set LoDBuff_AbilID[20]= 'C020' //Overwhelming Odds
  set LoDBuff_BuffID[20]= 'D020'
  set LoDBuff_AbilID[21]= 'C021' //Fiery Soul
  set LoDBuff_BuffID[21]= 'D021'
  set LoDBuff_AbilID[22]= 'C022' //Borrowed Time
  set LoDBuff_BuffID[22]= 'D022'
  set LoDBuff_AbilID[23]= 'C023' //Static Link Caster
  set LoDBuff_BuffID[23]= 'D023'
  set LoDBuff_AbilID[24]= 'C024' //Static Link Target
  set LoDBuff_BuffID[24]= 'D024'
  set LoDBuff_AbilID[25]= 'C025' //Warcry
  set LoDBuff_BuffID[25]= 'D025'
  set LoDBuff_AbilID[26]= 'C026' //Living Armour
  set LoDBuff_BuffID[26]= 'D026'
  set LoDBuff_AbilID[27]= 'C027' //Flux
  set LoDBuff_BuffID[27]= 'D027'
  set LoDBuff_AbilID[28]= 'C028' //Magnetic Field
  set LoDBuff_BuffID[28]= 'D028'
  set LoDBuff_AbilID[29]= 'C029' //Arctic Burn Attacker
  set LoDBuff_BuffID[29]= 'D029'
  set LoDBuff_AbilID[30]= 'C030' //Splinter Blast
  set LoDBuff_BuffID[30]= 'D030'
  set LoDBuff_AbilID[31]= 'C031' //Winter's Curse
  set LoDBuff_BuffID[31]= 'D031'
  set LoDBuff_AbilID[32]= 'C032' //Lunar Blessing
  set LoDBuff_BuffID[32]= 'D032'
  set LoDBuff_AbilID[33]= 'C033' //Halberd
  set LoDBuff_BuffID[33]= 'D033'
endfunction

function Attack_Disable_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local unit u = LoadUnitHandle(MHT,GetHandleId(t),0)
  local integer info = GetHandleId(u)
  local integer key = StringHash("attack_count")
  local integer count = LoadInteger(MHT,info,key)
  
  if count==1 then
    call UnitRemoveAbility(u,'Abun')
    call DestroyEffect(LoadEffectHandle(MHT,info,StringHash("attack_effect")))
  endif
  
  call SaveInteger(MHT,info,key,count - 1)
  
  call Timer_End(t)
  set t = null
  set u = null
endfunction

function Attack_Disable takes unit u, real duration, integer id_a, integer id_b returns nothing
  local timer t = Timer_Get()
  local integer info = GetHandleId(u)
  local integer key = StringHash("attack_count")
  local integer count = LoadInteger(MHT,info,key)
  
  if id_b!=0 and id_a!=0 then
    call Buff_Add(u,id_a,id_b,duration)
  endif
  
  if count==0then
    call SaveEffectHandle(MHT,info,StringHash("attack_effect"),AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl",u,"overhead"))
    call UnitAddAbility(u,'Abun')
    call UnitMakeAbilityPermanent(u,true,'Abun')
  endif
  
  
  call SaveInteger(MHT,info,key,count + 1)
  
  call SaveUnitHandle(MHT,GetHandleId(t),0,u)
  call TimerStart(t,duration,false,function Attack_Disable_End)
  
  set t = null
endfunction

function Damage_Block_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local unit u = LoadUnitHandle(MHT,info,0)
  
  set IsRealDamage = false
  call UnitRemoveAbility(u,'A505')
  call SetWidgetLife(u,LoadReal(MHT,info,0))
  set IsRealDamage = true
  
  call Timer_End(t)
  set t = null
  set u = null
endfunction

function Damage_Block takes unit u, real amount, boolean b returns nothing
  local timer t = null
  local integer info
  local real life
  local real heal
  
  if amount > 4000 then //It probably doesnt have to be this high, but this LoD...
    return
  endif
  
  set life = GetWidgetLife(u)
  set heal = life + amount
  
  if heal > GetUnitState(u,UNIT_STATE_MAX_LIFE) then
    set t = Timer_Get()
    set info = GetHandleId(t)
    
    set IsRealDamage = false
    call UnitAddAbility(u,'A505')
    set IsRealDamage = true
    
    call SaveUnitHandle(MHT,info,0,u)
    if b then
      call SaveReal(MHT,info,0,life)
    else
      call SaveReal(MHT,info,0,heal)
    endif
    call TimerStart(t,0,false,function Damage_Block_End)
    
    set t = null
  endif
  
  call SetWidgetLife(u,heal)
endfunction

function isMorphedUnit takes unit u returns boolean
  local integer uid=GetUnitTypeId(u)
  set Lich_MorphedSkillId=0
  if uid=='N01J' or uid=='N01T' or uid=='N0HT' or uid=='H600' or uid=='H601' or uid=='H602' then //alchemist
    if Mode_BO then
      set Lich_MorphedSkillId='ANcr'
    else
      set Lich_MorphedSkillId='QB0K'
    endif
    return true
  elseif uid=='H00F' or uid=='H00E' or uid=='H00F' then //dk
    set Lich_MorphedSkillId='QM00'
    return true
  elseif uid=='E015' then//lycan
    set Lich_MorphedSkillId='QM02'
    return true
  elseif uid=='H06X' or uid=='H06Y' or uid=='H06W' then//ezalor
    set Lich_MorphedSkillId='QM01'
    return true
  elseif uid=='H07I' then//flesh golem
    set Lich_MorphedSkillId='QM03'
    return true
  elseif uid=='O017' then//firefly
    set Lich_MorphedSkillId='QM04'
    return true
  elseif uid=='H08D' or uid=='H08C' or uid=='H08B' or uid=='H084' then//splitshot
    return true
  elseif uid=='N0MA' or uid=='N0MB' or uid=='N0MC' or uid=='N0MO' then//arctic burn
    return true
    
  endif
  return false
endfunction

function Transform_Movement takes unit u, integer spell, integer id returns nothing
  local boolean b = false
  local integer loopA = 0
  local integer max = LoadInteger(MHT,0,spell)
  if isMorphedUnit(u) and Lich_MorphedSkillId==spell then
    return
  endif
  loop
    
    set b = id==LoadInteger(MHT,spell,loopA)
    set loopA = loopA + 1
    exitwhen loopA==max or b
  endloop
  
  if b then
    set id = LoadInteger(MHT,GetHandleId(u),spell)
    
    if id > 0 then
      call LoDMovement_Sub(u,id)
    endif
  else
    //		set id = R2I(GetUnitDefaultMoveSpeed(u)) - LoadInteger(MHT,1,spell)
    //
    //		if id > 0 then
    //			call SaveInteger(MHT,GetHandleId(u),spell,id)
    //			call LoDMovement_Add(u,id)
    //		endif
  endif
endfunction

function Transform_Init takes nothing returns nothing
  //chemical rage
  call SaveBoolean(MHT,'ANcr','ANcr',true)
  call SaveInteger(MHT,0,'ANcr',3)   //number of units transformed to
  call SaveInteger(MHT,1,'ANcr',295) //default speed
  call SaveInteger(MHT,'ANcr',0,'N01H')
  call SaveInteger(MHT,'ANcr',1,'N01T')
  call SaveInteger(MHT,'ANcr',2,'N01J')
  
  call SaveBoolean(MHT,'QB0K','QB0K',true)
  call SaveInteger(MHT,0,'QB0K',3)   //number of units transformed to
  call SaveInteger(MHT,1,'QB0K',295) //default speed
  call SaveInteger(MHT,'QB0K',0,'H600')
  call SaveInteger(MHT,'QB0K',1,'H601')
  call SaveInteger(MHT,'QB0K',2,'H602')
  
  //eldar dragon form
  call SaveBoolean(MHT,'A03G','A036',true)
  call SaveInteger(MHT,0,'A03G',3)   //number of units transformed to
  call SaveInteger(MHT,1,'A03G',290) //default speed
  call SaveInteger(MHT,'A03G',0,'H00E')
  call SaveInteger(MHT,'A03G',1,'H00F')
  call SaveInteger(MHT,'A03G',2,'H00G')
  
  //eldar dragon form new
  call SaveBoolean(MHT,'QM00','A036',true)
  call SaveInteger(MHT,0,'QM00',3)   //number of units transformed to
  call SaveInteger(MHT,1,'QM00',290) //default speed
  call SaveInteger(MHT,'QM00',0,'H00E')
  call SaveInteger(MHT,'QM00',1,'H00F')
  call SaveInteger(MHT,'QM00',2,'H00G')
  
  //bear form
  call SaveBoolean(MHT,'A0AG','A0A6',true)
  call SaveInteger(MHT,0,'A0AG',3)   //number of units transformed to
  call SaveInteger(MHT,1,'A0AG',315) //default speed
  call SaveInteger(MHT,'A0AG',0,'N013')
  call SaveInteger(MHT,'A0AG',1,'N014')
  call SaveInteger(MHT,'A0AG',2,'N015')
  
  //berserker rage
  call SaveBoolean(MHT,'A0BE','A0BE',true)
  call SaveInteger(MHT,0,'A0BE',2)   //number of units transformed to
  call SaveInteger(MHT,1,'A0BE',300) //default speed
  call SaveInteger(MHT,'A0BE',0,'N02B')
  call SaveInteger(MHT,'A0BE',1,'N017')
  
  //Winter's Curse
  call SaveBoolean(MHT,'A2NE','A2NE',true)
  call SaveInteger(MHT,0,'A2NE',4)   //number of units transformed to
  call SaveInteger(MHT,1,'A2NE',285) //default speed
  call SaveInteger(MHT,'A2NE',0,'N0MA')
  call SaveInteger(MHT,'A2NE',1,'N0MC')
  call SaveInteger(MHT,'A2NE',2,'N0MB')
  call SaveInteger(MHT,'A2NE',3,'N0MO')
  
  //Split Shot
  call SaveBoolean(MHT,'A1C0','A1C0',true)
  call SaveInteger(MHT,0,'A1C0',4)   //number of units transformed to
  call SaveInteger(MHT,1,'A1C0',290) //default speed
  call SaveInteger(MHT,'A1C0',0,'H08B')
  call SaveInteger(MHT,'A1C0',1,'H08C')
  call SaveInteger(MHT,'A1C0',2,'H08D')
  call SaveInteger(MHT,'A1C0',3,'H084')
  
  //Flesh Golem
  call SaveBoolean(MHT,'A15J','A15J',true)
  call SaveInteger(MHT,0,'A15J',1)   //number of units transformed to
  call SaveInteger(MHT,1,'A15J',310) //default speed
  call SaveInteger(MHT,'A15J',0,'H07I')
  
  call SaveBoolean(MHT,'QM03','QM03',true)
  call SaveInteger(MHT,0,'QM03',1)   //number of units transformed to
  call SaveInteger(MHT,1,'QM03',310) //default speed
  call SaveInteger(MHT,'QM03',0,'H07I')
endfunction



function Passive_Cooldown_Finish takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer spell = LoadInteger(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,0)
  local integer level = GetUnitAbilityLevel(u,LoadInteger(MHT,info,2))
  local boolean b = UnitRemoveAbility(u,LoadInteger(MHT,info,1))==false
  local integer PlayerId=GetPlayerId(GetOwningPlayer(u))
  if spell=='A065' and SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+6]]=='A065' then
    set level=ExtraAbilityLevel[GetPlayerId(GetOwningPlayer(u))*2+2]
  endif
  //if level==0 then//6th skill?
  //	if spell=='A065' then//rearm?
  //		set level=ExtraAbilityLevel[GetPlayerId(GetOwningPlayer(u))*2+2]
  //	endif
  //endif
  set IsRealDamage = false
  
  call UnitAddAbility(u,spell)
  
  if GetUnitAbilityLevel(u,spell)==0 or b then //detects if the unit has the agha version, or had it and then dropped it
    if b then
      call UnitRemoveAbility(u,spell) //removes the agha version, if the unit no longer has agha
      
      set spell = LoadInteger(MHT,info,3)
      call UnitAddAbility(u,spell)
    else
      set spell = LoadInteger(MHT,info,3)
    endif
    
    call UnitRemoveAbility(u,LoadInteger(MHT,info,4))
    set level = GetUnitAbilityLevel(u,LoadInteger(MHT,info,5))
  endif
  
  call UnitMakeAbilityPermanent(u,true,spell)
  call SetUnitAbilityLevel(u,spell,level)
  
  set IsRealDamage = true
  
  if LoadBoolean(MHT,info,0)then
    call SaveBoolean(MHT,GetHandleId(u),spell,LoadBoolean(MHT,spell,1))
  endif
  
  call Timer_End(t)
  set t = null
  set u = null
endfunction
function Passive_Cooldown takes unit u, integer spell, integer level returns nothing
  local unit d = CreateUnit(Player(14),'e00E',0,0,0)
  local timer t = Timer_Get()
  local integer info = GetHandleId(t)
  local integer new = LoadInteger(MHT,spell,0)
  local integer dummy = LoadInteger(MHT,spell,1)
  local integer save = GetHandleId(u)
  
  call SaveUnitHandle(MHT,info,0,u)
  call SaveInteger(MHT,info,0,spell)
  call SaveInteger(MHT,info,1,new)
  call SaveInteger(MHT,info,2,dummy)
  call SaveInteger(MHT,info,3,LoadInteger(MHT,dummy,2))
  call SaveInteger(MHT,info,4,LoadInteger(MHT,spell,2))
  call SaveInteger(MHT,info,5,LoadInteger(MHT,spell,3))
  
  
  set IsRealDamage = false
  
  call UnitRemoveAbility(u,spell)
  
  //call BJDebugMsg("adding: "+Id2String(new)+"	"+B2S(UnitAddAbility(u,new)))
  
  
  call UnitAddAbility(u,new)
  call SetUnitAbilityLevel(u,new,level)
  call UnitMakeAbilityPermanent(u,true,new)
  call SaveTimerHandle(MHT,save,spell,t)
  
  if LoadBoolean(MHT,spell,0)then
    call SaveBoolean(MHT,info,0,true)
    call SaveBoolean(MHT,save,spell,LoadBoolean(MHT,spell,1)==false)
  endif
  
  call UnitAddAbility(u,'A04R') //adds marker so the spell shield ability won't proc any triggered gudnes : 3
  call UnitAddAbility(d,'A502')
  call IssueTargetOrder(d,"creepheal",u)
  call UnitRemoveAbility(u,'A04R') //remove marker after so the unit doesnt suddenly become supa stronk! :O
  
  set IsRealDamage = true
  
  call TimerStart(t,LoadReal(MHT,spell,level),false,function Passive_Cooldown_Finish)
  
  set d = null
  set t = null
endfunction
function Passive_Cooldown_End takes unit u, integer spell returns nothing
  call UnitAddAbility(u,spell)
  call UnitMakeAbilityPermanent(u,true,spell)
  call TimerStart( LoadTimerHandle(MHT,GetHandleId(u),spell),0,false,function Passive_Cooldown_Finish)
endfunction
function Passive_Cooldown_Learn takes unit u, integer spell, integer level returns nothing
  local integer check = LoadInteger(MHT,spell,0)
  
  if level==1then
    call UnitAddAbility(u,check)
    call UnitMakeAbilityPermanent(u,true,check)
    
    return
  endif
  
  call SetUnitAbilityLevel(u,check,level)
  call SetUnitAbilityLevel(u,LoadInteger(MHT,spell,1),level)
  call SetUnitAbilityLevel(u,LoadInteger(MHT,spell,2),level)
endfunction
function Passive_Cooldown_Init takes nothing returns nothing
  //Liquid Fire
  //call SaveBoolean(MHT,'A0O8',0,true)   //does the spell have additional data
  //call SaveBoolean(MHT,'A0O8',1,false)  //value of the extra data to be saved when finished
  //call SaveInteger(MHT,'A0O8',0,'A501') //dummy spell1
  //call SaveInteger(MHT,'A0O8',1,'A519') //dummy spell2, requires the engineering upgrade be changed to use this instead of the real spell
  //call SaveInteger(MHT,'A519',0,'A0O8') //lets the dummy spell know what spell should be leveled
  //call SaveInteger(MHT,'A519',1,'A501') //lets the dummy spell know what dummy spell should be leveled
  //call SaveReal(MHT,'A0O8',1,20)		//cooldown per level
  //call SaveReal(MHT,'A0O8',2,15)
  //call SaveReal(MHT,'A0O8',3,10)
  //call SaveReal(MHT,'A0O8',4,5)
  
  //Borrowed Time
  //	call SaveBoolean(MHT,'A0NS',0,false)  //does the spell have additional data
  //	call SaveInteger(MHT,'A0NS',0,'A503') //dummy spell1, used to show the cooldown
  //	call SaveInteger(MHT,'A0NS',1,'A517') //dummy spell2, used for learning
  //	call SaveInteger(MHT,'A0NS',2,'A504') //agha dummy spell1
  //	call SaveInteger(MHT,'A0NS',3,'A518') //agha dummy spell2
  //	call SaveInteger(MHT,'A517',0,'A0NS') //lets the dummy spell know what spell should be leveled
  //	call SaveInteger(MHT,'A517',1,'A503') //lets the dummy spell know what dummy spell should be leveled
  //	call SaveInteger(MHT,'A517',2,'A1DA') //agha version
  //	call SaveReal(MHT,'A0NS',1,60)
  //	call SaveReal(MHT,'A0NS',2,50)
  //	call SaveReal(MHT,'A0NS',3,40)
  //
  //	//Borrowed Time Agha
  //	call SaveBoolean(MHT,'A1DA',0,false)  //does the spell have additional data
  //	call SaveInteger(MHT,'A1DA',0,'A504') //dummy spell1
  //	call SaveInteger(MHT,'A1DA',1,'A518') //dummy spell2
  //	call SaveInteger(MHT,'A1DA',2,'A503') //unagha dummy spell1
  //	call SaveInteger(MHT,'A1DA',3,'A517') //unagha dummy spell2
  //	call SaveInteger(MHT,'A518',0,'A1DA') //lets the dummy spell know what spell should be leveled
  //	call SaveInteger(MHT,'A518',1,'A504') //lets the dummy spell know what dummy spell should be leveled
  //	call SaveInteger(MHT,'A518',2,'A0NS') //unagha version
  //	call SaveReal(MHT,'A1DA',1,60)
  //	call SaveReal(MHT,'A1DA',2,50)
  //	call SaveReal(MHT,'A1DA',3,40)
  
  //Rearm
  call SaveBoolean(MHT,'A065',0,false)  //does the spell have additional data
  call SaveInteger(MHT,'A065',0,'A528') //dummy spell1, used to show the cooldown
  call SaveInteger(MHT,'A065',1,'A527') //dummy spell2, used for learning
  call SaveInteger(MHT,'A527',0,'A065') //lets the dummy spell know what spell should be leveled
  call SaveInteger(MHT,'A527',1,'A528') //lets the dummy spell know what dummy spell should be leveled
  call SaveReal(MHT,'A065',1,9)
  call SaveReal(MHT,'A065',2,6)
  call SaveReal(MHT,'A065',3,3)
  
  //Tidebringer
  call SaveBoolean(MHT,'A13T',0,false)  //does the spell have additional data
  call SaveInteger(MHT,'A13T',0,'A523') //dummy spell1
  call SaveInteger(MHT,'A13T',1,'A522') //dummy spell2
  call SaveInteger(MHT,'A522',0,'A13T')
  call SaveInteger(MHT,'A522',1,'A523')
  call SaveReal(MHT,'A13T',1,13)
  call SaveReal(MHT,'A13T',2,10)
  call SaveReal(MHT,'A13T',3,7)
  call SaveReal(MHT,'A13T',4,4)
endfunction



//just some test code
//====================================================================================================================

function test takes nothing returns nothing
  //local item i = CreateItem('I0PB',-600,-600)
  //local unit u = null
  local unit u = CreateUnit(Player(1),'N01J',-500,-500,0)
  
  call BJDebugMsg("making")
  
  
  call UnitAddAbility(u,'P335')
  
  set u = null
endfunction


function test_start takes nothing returns nothing
  
  call BJDebugMsg("testing")
  
  call TimerStart(CreateTimer(),25,false,function test)
endfunction


//game code, its downhill from here...
//====================================================================================================================

//Initilizes any stuff needed for LoD
function LoD_Init takes nothing returns nothing
  local player p
  local integer loopA = 0
  
  set CanAddTime[0] = 2
  set CanAddTime[1] = 2
  
  // RMD Init
  call RMD_Init()
  
  call ExeFunc("LoDEvent_Init")
  call ExeFunc("Cooldown_Init")
  call Buff_Init()
  //call Timer_Init()
  call LoDStat_Init()
  //call Transform_Init()
  call Passive_Cooldown_Init()
  
  call HideAbility('A509')
  call HideAbility('A515')
  call HideAbility('A521')
  call HideAbility('A147')
  call HideAbility('A228')
  call HideAbility('A0B8')
  call HideAbility('A1WE')
  
  
  loop
    
    set p = Player(loopA)
    call TriggerRegisterPlayerUnitEvent(GAME_TRIGGER,p,EVENT_PLAYER_UNIT_ATTACKED,null)
    call TriggerRegisterPlayerUnitEvent(GAME_TRIGGER,p,EVENT_PLAYER_UNIT_DEATH,null)
    
    //call TriggerRegisterPlayerChatEvent(CHAT_TRIGGER,p,"derp",true) //awww D:
    
    //call TriggerRegisterPlayerUnitEvent(GAME_TRIGGER, Player(loopA),EVENT_PLAYER_UNIT_SUMMON,null)
    set loopA = loopA + 1
    exitwhen loopA == 15
  endloop
  
  
  set p=null
  //call test_start()
endfunction

function SetPlayerAbilityAvailable2 takes player p, integer spell, boolean b returns nothing
  //by default set to false, so it saves to true when the ability is disabled
  
  call SaveBoolean(MHT,GetHandleId(p),spell,b==false)
  call SetPlayerAbilityAvailable(p,spell,b)
endfunction

function GetHeroIndexFromId takes integer id returns integer
  local integer i=0
  loop
    if HeroID[i]==id then
      return i
    endif  
    set i=i+1
  endloop
  return -1
endfunction














function RA8 takes string String1,string String2,string Except returns boolean
  local integer Length1=StringLength(String1)
  local integer Length2=StringLength(String2)
  local string array Substrings1
  local string array Substrings2
  local integer SubstringsIndex1=0
  local integer SubstringsIndex2=0
  local integer SeparationIndex=0
  local integer i=0
  local integer d=0
  local integer j=0
  local integer k=0
  if String1==null or String2==null then
    return false
  endif
  loop
    if SubString(String1,i,i+1)=="," then
      set SubstringsIndex1=SubstringsIndex1+1
      set Substrings1[SubstringsIndex1]=SubString(String1,SeparationIndex,i)
      set SeparationIndex=i+2
    endif
    if i+1>=Length1 then
      set SubstringsIndex1=SubstringsIndex1+1
      set Substrings1[SubstringsIndex1]=SubString(String1,SeparationIndex,i+1)
    endif
    set i=i+1
    exitwhen i>=Length1
  endloop
  set i=0
  set SeparationIndex=0
  loop
    if SubString(String2,i,i+1)=="," then
      set SubstringsIndex2=SubstringsIndex2+1
      set Substrings2[SubstringsIndex2]=SubString(String2,SeparationIndex,i)
      set SeparationIndex=i+2
    endif
    if i+1>=Length2 then
      set SubstringsIndex2=SubstringsIndex2+1
      set Substrings2[SubstringsIndex2]=SubString(String2,SeparationIndex,i+1)
    endif
    set i=i+1
    exitwhen i>=Length2
  endloop
  set d=SubstringsIndex2
  loop
    loop
      if not(Except==Substrings1[SubstringsIndex1]or Except==Substrings2[SubstringsIndex2])then
        if Substrings1[SubstringsIndex1]==Substrings2[SubstringsIndex2] and Substrings1[SubstringsIndex1]!="multi-icon" then
          
          //call BJDebugMsg(Substrings1[SubstringsIndex1])
          
          return true
        endif
      endif
      set SubstringsIndex2=SubstringsIndex2-1
      exitwhen SubstringsIndex2<=0
    endloop
    set SubstringsIndex2=d
    set SubstringsIndex1=SubstringsIndex1-1
    exitwhen SubstringsIndex1<=0
  endloop
  return false
endfunction


function UnitAddItemToSlot takes unit u, item i, integer slot returns boolean
  local item d1 = null
  local item d2 = null
  local item d3 = null
  local item d4 = null
  local item d5 = null
  local integer loopA = 0
  local boolean added = false
  local boolean enable = IsTriggerEnabled(t_manipulateitem)
  
  if i==null or slot > 5 or 0 > slot then
    set d1=null
    set d2=null
    set d3=null
    set d4=null
    set d5=null
    return false
  endif
  
  call DisableTrigger(t_manipulateitem)
  
  loop
    
    if UnitItemInSlot(u,loopA)==null then
      if loopA==slot then
        set added = UnitAddItem(u,i)
      else
        
        //I am aware of how shitty this is...
        
        if d1==null then
          set d1 = UnitAddItemById(u,'I02M')
        elseif d2==null then
          set d2 = UnitAddItemById(u,'I02M')
        elseif d3==null then
          set d3 = UnitAddItemById(u,'I02M')
        elseif d4==null then
          set d4 = UnitAddItemById(u,'I02M')
        elseif d5==null then
          set d5 = UnitAddItemById(u,'I02M')
        endif
      endif
    endif
    set loopA = loopA + 1
    exitwhen loopA == 6
  endloop
  
  call RemoveItem(d5)
  call RemoveItem(d4)
  call RemoveItem(d3)
  call RemoveItem(d2)
  call RemoveItem(d1)
  
  if enable then
    call EnableTrigger(t_manipulateitem)
  endif
  set d1=null
  set d2=null
  set d3=null
  set d4=null
  set d5=null
  return added
endfunction













function UnitAddAbilityDevour takes unit Hero,integer AF8 returns boolean
  return UnitAddAbility(Hero,AF8) and UnitMakeAbilityPermanent(Hero,true,AF8)
endfunction

function C0F2 takes unit Source returns nothing
  call UnitRemoveAbility(Source,'A1OQ')
  call UnitRemoveAbility(Source,'A1OR')
  call UnitRemoveAbility(Source,'A1OS')
  call UnitRemoveAbility(Source,'A1OT')
  call UnitRemoveAbility(Source,'A1OU')
  call UnitRemoveAbility(Source,'A1OV')
  call UnitRemoveAbility(Source,'A1OW')
  call UnitRemoveAbility(Source,'A1OX')
  call UnitRemoveAbility(Source,'A1OY')
  call UnitRemoveAbility(Source,'S00M')
  call UnitRemoveAbility(Source,'A1OZ')
  call UnitRemoveAbility(Source,'S00N')
  call UnitRemoveAbility(Source,'A1P0')
  call UnitRemoveAbility(Source,'A1P1')
  call UnitRemoveAbility(Source,'A1P7')
  call UnitRemoveAbility(Source,'A1PA')
  call UnitRemoveAbility(Source,'A1P3')
  call UnitRemoveAbility(Source,'A1P4')
  call UnitRemoveAbility(Source,'A1P5')
  call UnitRemoveAbility(Source,'A1P6')
  call UnitRemoveAbility(Source,'A2AG')
endfunction

function C5F2 takes unit Source,integer Target returns nothing
  local integer C2F=Target
  local integer L4F=0
  local integer L7F=0
  if C2F=='n0HX' then
    set L4F='A1OQ'
  elseif C2F=='nomg' then
    set L4F='A1OR'
  elseif C2F=='nfpu' then
    set L4F='A1OS'
  elseif C2F=='nstl' then
    set L4F='A1OT'
  elseif C2F=='nsat' then
    set L4F='A1OU'
  elseif C2F=='nsth' then
    set L4F='A1OV'
    set L7F='A1OW'
  elseif C2F=='n00S' then
    set L4F='A1OX'
    set L7F='A1OY'
  elseif C2F=='nkol' then
    set L4F='S00M'
  elseif C2F=='nfsh' then
    set L4F='A1OZ'
    set L7F='A2AG'
  elseif C2F=='ncnk' then
    set L4F='S00N'
    set L7F='A1P0'
  elseif C2F=='ngns' then
    set L4F='A1P1'
  elseif C2F=='ngh1' then
    set L4F='A1P7'
    set L7F='A1PA'
  elseif C2F=='nowe' then
    set L4F='A1P3'
    set L7F='A1P4'
  elseif C2F=='ndtw' then
    set L4F='A1P5'
    set L7F='A1P6'
  elseif C2F=='nwlg' then
    set L4F='A1OY'
  endif
  if L4F!=0 then
    call C0F2(Source)
    call UnitAddAbilityDevour(Source,L4F)
  endif
  if L7F!=0 then
    call UnitAddAbilityDevour(Source,L7F)
  endif
endfunction





function UG82 takes nothing returns nothing
  local integer i=0
  if GameEnded==false and ZN7==false then
    loop
      call DisplayTimedTextToPlayer(Player(i),0,0,120,"|c00ff0303An internal checksum has failed|r")
      call DisplayTimedTextToPlayer(Player(i),0,0,120,"|c00ff0303This might not be a serious glitch, but it is important for me to get it|r")
      call DisplayTimedTextToPlayer(Player(i),0,0,120,"|c00ff0303Please send me the replay for this game to ResQLoD@gmail.com|r")
      set i=i+1
      exitwhen i==12
    endloop
  endif
endfunction

function AghaGetIndexByBaseSpell takes integer spell returns integer
  local integer i=1
  loop
    if AghaBaseSpellID[i]==spell then
      return i
    endif
    set i=i+1
    exitwhen i>AghaCounter
  endloop
  return -1
endfunction


function F49 takes item B38 returns integer
  local integer ZF8
  local integer i=1
  if B38==null then
    return-2
  endif
  //set ZF8=DummyItem(GetItemTypeId(B38))
  set ZF8=GetItemTypeId(B38)
  loop
    
    if Item_Dummy[i]==ZF8 or Item_Real[i]==ZF8 then
      return i
    endif
    set i=i+1
    exitwhen i>ITC
  endloop
  return-1
endfunction

function RefreshItemsWithBalance takes unit u returns nothing
  local player p = GetOwningPlayer(u)
  local integer VT8=0
  local integer VU8=5
  local integer array IXF
  local player array IYF
  local integer indexId
  local item FQ9
  
  set IXF[0]=0
  set IXF[1]=0
  set IXF[2]=0
  set IXF[3]=0
  set IXF[4]=0
  set IXF[5]=0
  call DisableTrigger(t_manipulateitem)
  loop
    
    set indexId=F49(UnitItemInSlot(u,VT8))
    if indexId==indexid_BlackKingBar10 or indexId==indexid_BlackKingBar09 or indexId==indexid_BlackKingBar08 or indexId==indexid_BlackKingBar07 or indexId==indexid_BlackKingBar06 or indexId==indexid_BlackKingBar05 or indexId==indexid_HelmOfTheDominator or indexId==indexid_Necronomicon1 or indexId==indexid_Necronomicon2 or indexId==indexid_Necronomicon3 or indexId==indexid_HandOfMidas or indexId==indexid_RefresherOrb or indexId==indexid_ArcaneRing or indexId==indexid_ArcaneBoots then
      set IXF[VT8]=GetItemTypeId(UnitItemInSlot(u,VT8))
      set IYF[VT8]=GetItemPlayer(UnitItemInSlot(u,VT8))
      call RemoveItem(UnitItemInSlot(u,VT8))
    endif
    set VT8=VT8+1
    exitwhen VT8>VU8
  endloop
  call UnitResetCooldown(u)
  call TimerStart(PrimaryUltiCooldownTimer[GetPlayerId((p))],0,false,null)
  call TimerStart(SecondaryUltiCooldownTimer[GetPlayerId((p))],0,false,null)
  set VT8=0
  set VU8=5
  loop
    
    if IXF[VT8]>0 then
      set FQ9=CreateItem(IXF[VT8],0,0)
      call SetItemPlayer(FQ9,IYF[VT8],false)
      call SetItemUserData(FQ9,1)
      call UnitAddItem(u,FQ9)
    endif
    set VT8=VT8+1
    exitwhen VT8>VU8
  endloop
  call EnableTrigger(t_manipulateitem)
  set FQ9=null
  set p=null
endfunction

function RefreshWithBalance takes unit u, boolean items returns nothing
  local integer IUF
  local integer IVF
  local integer SJ8
  local integer PlayerId
  local integer xx
  local integer i
  set PlayerId=GetPlayerId(GetOwningPlayer(u))
  set xx=1
  
  if items then
    call RefreshItemsWithBalance(u)
  endif
  
  loop
    set SJ8=PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]
    set IUF=SkillID[SJ8]
    set i=AghaGetIndexByBaseSpell(IUF)
    if i>0 then
      if GetUnitAbilityLevel(u,AghaUpgradeID[i])>0 then
        set IUF=AghaUpgradedSpellID[i]
      endif
    endif
    //call BJDebugMsg(Id2String(IUF)+" "+GetObjectName(IUF))
    
    if not(RA8(StackingLimitations[SJ8],"passive "+I2S(SJ8),"")) and LoadBoolean(MHT,0,IUF)==false and IUF!='A1RK' then
      set IVF=GetUnitAbilityLevel(u,IUF)
      if IVF>0 then
        call UnitRemoveAbility(u,IUF)
        call UnitAddAbility(u,IUF)
        call SetUnitAbilityLevel(u,IUF,IVF)
        call UnitMakeAbilityPermanent(u,true,IUF)
      endif
    endif
    set xx=xx+1
    exitwhen xx>PlayerSkillOffset
  endloop
  
  if LoadInteger(MHT,GetHandleId(u),StringHash("lasteaten"))!=0 then
    call C5F2(u,LoadInteger(MHT,GetHandleId(u),StringHash("lasteaten")))
  endif
  
  set u=null
endfunction


function Cooldown_Init takes nothing returns nothing
  
  //disables the trigger since only certain spells use it
  call DisableTrigger(COOLDOWN_ITEM_TRIGGER)
  //call TriggerAddCondition(COOLDOWN_ITEM_TRIGGER,Condition(function Cooldown_Item_Condition))
  //call TriggerAddCondition(COOLDOWN_ITEM_TRIGGER,Condition(function Cooldown_Event_Check))
  //call TriggerAddCondition(COOLDOWN_ITEM_TRIGGER,Condition(function Cooldown_Item_Check))
  
  //abilities
  //===================================================================
  // Invalid abilities have a boolean set to true
  
  //	call SaveBoolean(MHT,0,'A0NS',true) //Borrowed Time
  //	call SaveBoolean(MHT,0,'A1DA',true) //Borrowed Time (agha)
  
  
  
  //items
  //===================================================================
  //
  //
  
  //satanic
  call SaveBoolean(MHT,1,'A1FP',true)  //is an item spell (Doesn't use the ItemsActiveAbilities[] array since the item Id has to be indexed anyway)
  call SaveInteger(MHT,2,'A1FP','I0AB')   //real item id
  call SaveInteger(MHT,1,'I0AB','J000')   //dummy item id
  call SaveReal(MHT,0,'I0AB',35)    //cooldown duration
  call SaveInteger(MHT,0,'J000','I0AB')   //real item id
  
  //manta melee
  call SaveBoolean(MHT,1,'A0B8',true)  //is an item spell
  call SaveInteger(MHT,2,'A0B8','I09F')   //real item id
  call SaveInteger(MHT,1,'I09F','J001')   //dummy item id
  call SaveReal(MHT,0,'I09F',35)    //cooldown duration
  call SaveReal(MHT,0,'J001',35)    //dummy cooldown duration (only needed for delayed items)
  call SaveInteger(MHT,0,'J001','I09F')   //real item id
  
  //manta range
  call SaveBoolean(MHT,1,'A1WE',true)  //is an item spell
  call SaveInteger(MHT,2,'A1WE','I0MU')   //real item id
  call SaveInteger(MHT,1,'I0MU','J002')   //dummy item id
  call SaveReal(MHT,0,'I09F',50)    //cooldown duration
  call SaveReal(MHT,0,'J002',50)    //dummy cooldown duration (only needed for delayed items)
  call SaveInteger(MHT,0,'J002','I0MU')   //real item id
  
  
  
  call SaveInteger(MHT,0,'I09F','A0B8') //manta (melee)
  call SaveInteger(MHT,0,'I0MU','A1WE') //manta (ranged)
  call SaveInteger(MHT,0,'I00Z','A0T9') //shiva
  call SaveInteger(MHT,0,'I0AL','AChx') //guinsoo
  call SaveInteger(MHT,0,'I012','A0FD') //orchid
  call SaveInteger(MHT,0,'I08O','A15W') //blademail
  call SaveInteger(MHT,0,'I08Z','A1T7') //euls
  call SaveInteger(MHT,0,'I0HI','A19M') //forcestaff
  call SaveInteger(MHT,0,'I09M','A02O') //dagon1
  call SaveInteger(MHT,0,'I09P','A08Y') //dagon2
  call SaveInteger(MHT,0,'I09N','A08Z') //dagon3
  call SaveInteger(MHT,0,'I09O','A090') //dagon4
  call SaveInteger(MHT,0,'I09L','A092') //dagon5
  call SaveInteger(MHT,0,'I0O3','A28D') //veil
  call SaveInteger(MHT,0,'I0OL','A2EA') //rod
  call SaveInteger(MHT,0,'I093','A0CK') //mek
  call SaveInteger(MHT,0,'I066','AIda') //buckler
  call SaveInteger(MHT,0,'I0K6','A1EW') //pipe
  call SaveInteger(MHT,0,'I0KY','A1MO') //urn
  call SaveInteger(MHT,0,'I0N0','A1ZI') //medallion
  call SaveInteger(MHT,0,'I0NE','A1ZW') //Djangoe (the D's silent motherfucker)
  call SaveInteger(MHT,0,'I0OX','A2K7') //abyssal
  call SaveInteger(MHT,0,'I09H','A017') //lothar
  call SaveInteger(MHT,0,'I0JI','A1AC') //ghost
  call SaveInteger(MHT,0,'I0LT','A1QD') //ethereal blade
  call SaveInteger(MHT,0,'I0BE','A0JL') //mjollnir
  call SaveInteger(MHT,0,'I08Y','AIxk') //mask of madness
  call SaveInteger(MHT,0,'I08R','AIpg') //diffusal 1
  call SaveInteger(MHT,0,'I0J9','AIpg') //diffusal 2
  call SaveInteger(MHT,0,'I0OV','A2K4') //halberd
  call SaveInteger(MHT,0,'I06B','A231') //boots of travel
  call SaveInteger(MHT,0,'I0GJ','A12W') //phase boots
  call SaveInteger(MHT,0,'I0LL','A1Q8') //soul ring
  call SaveInteger(MHT,0,'I0GC','A0JY') //magic stick
  call SaveInteger(MHT,0,'I0HB','A0JY') //magic wand
  
endfunction


function QS8 takes nothing returns nothing
  call DisplayTimedTextToPlayer(Player(1),.0,.0,20.,"Selected unit id: "+Id2String(GetUnitTypeId(GetTriggerUnit()))+" ("+I2S(GetUnitTypeId(GetTriggerUnit()))+")")
endfunction

function QT8 takes nothing returns nothing
  call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()),.0,.0,20.,"You used skill # "+Id2String(GetSpellAbilityId())+" ("+I2S(GetSpellAbilityId())+")")
endfunction

function QU8 takes nothing returns nothing
  if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) then
    if OrderId2StringBJ(GetIssuedOrderId())!="smart" then
      call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()),.0,.0,20.,"Skill order: "+OrderId2StringBJ(GetIssuedOrderId())+" ("+I2S(GetIssuedOrderId())+")")
    endif
  endif
endfunction

function IMaxIF takes integer a,integer b returns integer
  if(a<b)then
    return b
  else
    return a
  endif
endfunction

function QV8 takes integer PlayerId returns boolean
  if Mode_Debug and false then
    return true
  endif
  return((GetPlayerController(Player(PlayerId))==MAP_CONTROL_USER)and(GetPlayerSlotState(Player(PlayerId))==PLAYER_SLOT_STATE_PLAYING))
endfunction

function QX8 takes player p,boolean QY8 returns nothing
  local sound QZ8=CreateSoundFromLabel("InterfaceError",false,false,false,10,10)
  if QY8 then
    if(GetLocalPlayer()==p)then
      call StartSound(QZ8)
    endif
  endif
  call KillSoundWhenDone(QZ8)
endfunction

function QA8 takes player p,boolean QY8,string s returns nothing
  if not(QY8)then
    return
  endif
  if(GetLocalPlayer()==p)then
    if(s!="")and(s!=null)then
      call ClearTextMessages()
      call DisplayTimedTextToPlayer(p,0,0,5,"|c00FF0000[LoD]|r|c006699CC"+" "+s+"|r")
    endif
  endif
endfunction

function DisplayWithoutClear takes player p,boolean QY8,string s returns nothing
  if not(QY8)then
    return
  endif
  if(GetLocalPlayer()==p)then
    if(s!="")and(s!=null)then
      call DisplayTimedTextToPlayer(p,0,0,5,"|c00FF0000[LoD]|r|c006699CC"+" "+s+"|r")
    endif
  endif
endfunction

function QB8 takes player p,boolean QY8,string s returns nothing
  if not(QY8)then
    return
  endif
  call QX8(p,QY8)
  call QA8(p,QY8,s)
endfunction

function AdjustHeroNumber takes integer num returns integer
  if num==113 then
    return 117
  endif
  return num
endfunction

function QC8 takes nothing returns integer
  local integer rnd
  local integer i
  loop
    set rnd=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
    set i=0
    loop
      if(GetUnitTypeId(udg_Hero[i])==HeroID[rnd])or(rnd==53)or(rnd==89)then
        exitwhen true
      endif
      if(i==12)then
        return HeroID[rnd]
      endif
      set i=i+1
      exitwhen i>12
    endloop
    exitwhen false
  endloop
  return HeroID[1]
endfunction

function UnitAddAbility2 takes unit Hero,integer aid returns boolean
  //call UnitAddAbility(Hero,aid)
  //call UnitMakeAbilityPermanent(Hero,true,aid)
  return UnitAddAbility(Hero,aid) and UnitMakeAbilityPermanent(Hero,true,aid)
endfunction

function ItsEvasionItem takes integer itemid returns boolean
  return itemid=='I0OV' or itemid=='I0J6' or itemid=='I0AI'
endfunction

function ItsEvasionAbility takes integer itemid returns boolean
  return itemid=='A0MX' or itemid=='QP0H' or itemid=='A03P' or itemid=='QP0R'
endfunction

function CountEvasionItems takes unit whichUnit, integer itemid returns integer
  local integer i=0
  local integer n=0
  local integer c=UnitInventorySize(whichUnit)-1
  loop
    
    if GetItemTypeId(UnitItemInSlot(whichUnit,i))==itemid  then
      if GetTriggerEventId()==EVENT_PLAYER_UNIT_DROP_ITEM or GetTriggerEventId()==EVENT_PLAYER_UNIT_PAWN_ITEM then
        if  UnitItemInSlot(whichUnit,i)!=GetManipulatedItem() then
          set n=n+1
        endif
      else
        set n=n+1
      endif
    endif
    set i=i+1
    exitwhen i>c
  endloop
  return n
endfunction

function AddEvasionSumAbility takes unit u, integer percent returns nothing
  local integer i=0
  local integer spellbook
  local integer level
  local integer total
  set percent=percent-28
  loop
    call UnitRemoveAbility(u,EvasionContainers[i])
    set i=i+1
    exitwhen i>8
  endloop
  if percent<0 then
    return
  endif
  set total=R2I(percent/2)+1
  set spellbook=R2I(total/4)
  set level=total-(spellbook*4)+1
  call UnitAddAbility2(u,EvasionContainers[spellbook])
  call UnitMakeAbilityPermanent(u,true,'EVA0'+spellbook)
  //call BJDebugMsg(Id2String('EVA0'+spellbook))
  //call BJDebugMsg(I2S(level))
  //call DisplayTimedTextToPlayer(GetOwningPlayer(u),.0,.0,10.,"Evasion updated")
  
endfunction

function CountEvasionPercent takes nothing returns nothing
  local unit u
  local real ev=1
  local integer i
  set u=GetTriggerUnit()
  if(IMaxIF(GetUnitAbilityLevel(u,'A0MX'),GetUnitAbilityLevel(u,'QP0H')))>0 then
    set ev=ev*(1-((IMaxIF(GetUnitAbilityLevel(u,'A0MX'),GetUnitAbilityLevel(u,'QP0H'))*5+5)*0.01))
  endif
  if(IMaxIF(GetUnitAbilityLevel(u,'A03P'),GetUnitAbilityLevel(u,'QP0R')))>0 then
    if(IMaxIF(GetUnitAbilityLevel(u,'A03P'),GetUnitAbilityLevel(u,'QP0R')))==1 then
      set ev=ev*(1-0.2)
    elseif (IMaxIF(GetUnitAbilityLevel(u,'A03P'),GetUnitAbilityLevel(u,'QP0R')))==2 then
      set ev=ev*(1-0.25)
    elseif (IMaxIF(GetUnitAbilityLevel(u,'A03P'),GetUnitAbilityLevel(u,'QP0R')))==3 then
      set ev=ev*(1-0.3)
    else
      set ev=ev*(1-0.4)
    endif
  endif
  
  if GetUnitAbilityLevel(u,'A2K6')>0 then//halberd
    set i=CountEvasionItems(u,'I0OV')
    loop
      set ev=ev*(1-0.25)
      set i=i-1
      exitwhen i==0
    endloop
  endif
  
  if GetUnitAbilityLevel(u,'A1BZ')>0 then//talisman
    set i=CountEvasionItems(u,'I0J6')
    loop
      set ev=ev*(1-0.25)
      set i=i-1
      exitwhen i==0
    endloop
  endif
  
  if GetUnitAbilityLevel(u,'AIev')>0 then//talisman
    set i=CountEvasionItems(u,'I0AI')
    loop
      set ev=ev*(1-0.35)
      set i=i-1
      exitwhen i==0
    endloop
  endif
  
  
  call AddEvasionSumAbility(u,R2I((1-ev)*100))
  set u=null
endfunction

function EvasionStacking takes nothing returns nothing
  local eventid EID=GetTriggerEventId()
  if EID==EVENT_PLAYER_UNIT_PICKUP_ITEM or EID==EVENT_PLAYER_UNIT_DROP_ITEM or EID==EVENT_PLAYER_UNIT_PAWN_ITEM then
    if (ItsEvasionItem(GetItemTypeId(GetManipulatedItem())))then
      call CountEvasionPercent()
    endif
  elseif EID==EVENT_PLAYER_HERO_SKILL then
    if ItsEvasionAbility(GetLearnedSkill())then
      call CountEvasionPercent()
    endif
  else//called by 5th skill
    if ItsEvasionAbility(TempInteger)then
      call CountEvasionPercent()
    endif
  endif
endfunction

function GetPassiveNumber takes integer RealID returns integer
  local integer i=1
  local integer k=0
  loop
    if RealID==PassivesRealID[i] then 
      set k=i
    endif
    set i=i+1
    exitwhen k>0 or i>PassivesCount
  endloop
  return k
endfunction

function GetPassiveLearnNumber takes integer RealID returns integer
  local integer i=1
  local integer k=0
  loop
    //call BJDebugMsg(I2S(PassivesLearningSkill[i]))
    if RealID==PassivesLearningSkill[i] or RealID==PassivesLearningSkillUpg[i] then 
      set k=i
    endif
    set i=i+1
    exitwhen k>0 or i>PassivesCount
  endloop
  return k
endfunction

function GeneralLearnA takes integer id returns nothing
  local unit u=GetTriggerUnit()
  local player p=GetOwningPlayer(u)
  local integer k=GetPassiveLearnNumber(id)
  local integer lvl
  //call BJDebugMsg("Unit: "+GetObjectName(GetUnitTypeId(u))+"; K="+I2S(k)+"; Lvl="+I2S(IMaxIF(GetUnitAbilityLevel(u,PassivesLearningSkill[k]),GetUnitAbilityLevel(u,PassivesLearningSkillUpg[k]))))
  if k>0 then
    //call BJDebugMsg(Id2String(id))
    set lvl=IMaxIF(GetUnitAbilityLevel(u,PassivesLearningSkill[k]),GetUnitAbilityLevel(u,PassivesLearningSkillUpg[k]))
    if lvl==1 then
      call UnitAddAbility2(u,PassivesSpellbookID[k])
      call SetPlayerAbilityAvailable(p,PassivesSpellbookID[k],false)
      call UnitMakeAbilityPermanent(u,true,PassivesRealID[k])
      
    else
      call SetUnitAbilityLevel(u,PassivesRealID[k],lvl)
    endif
  endif
  
  
  set u=null
  set p=null
  
endfunction

function GeneralLearnC takes nothing returns nothing
  local integer id=GetLearnedSkill()
  local unit u=GetTriggerUnit()
  local player p=GetOwningPlayer(u)
  local integer k=GetPassiveLearnNumber(id)
  local integer lvl
  //call BJDebugMsg(I2S(k))
  if k>0 then
    //call BJDebugMsg(Id2String(id))
    set lvl=IMaxIF(GetUnitAbilityLevel(u,PassivesLearningSkill[k]),GetUnitAbilityLevel(u,PassivesLearningSkillUpg[k]))
    if lvl==1 then
      if id!='A086' then
        call UnitAddAbility2(u,PassivesSpellbookID[k])
        call SetPlayerAbilityAvailable(p,PassivesSpellbookID[k],false)
        call UnitMakeAbilityPermanent(u,true,PassivesRealID[k])
      endif
    elseif lvl>0 then
      if id!='A086' then
        call SetUnitAbilityLevel(u,PassivesRealID[k],lvl)
      endif
    endif
  endif
  set u=null
endfunction

function FixHidden5thSkill takes integer id returns integer
  local integer i=1
  local integer k=0
  local unit u=GetTriggerUnit()
  loop
    if PassivesLearningSkill[i]==id then
      set k=i
    endif
    set i=i+1
    exitwhen i>PassivesCount
  endloop
  set u=null
  return k
endfunction



function QL8 takes integer id returns integer
  local unit u
  if id=='A2JR' then
    return 'A2JL'
  elseif id=='P247' then
    set TempInteger=0
    if GetHeroLevel(GetTriggerUnit())>=5 then
      set TempInteger=1
    elseif GetHeroLevel(GetTriggerUnit())>=8 then
      set TempInteger=2
    elseif GetHeroLevel(GetTriggerUnit())>=11 then
      set TempInteger=3
    elseif GetHeroLevel(GetTriggerUnit())>=14 then
      set TempInteger=4
    endif
    if TempInteger>0 then
      call ExeFunc("NighthunterFixS5")
    endif
  elseif id=='Z318' then
    return 'A0BR'
  elseif id=='A1WH' then
    return 'A0WP'
  elseif id=='QF89' then
    return 'QF88'
  elseif id=='QF87' then
    return 'A0KX'
  elseif id=='A1IQ' then
    set u=GetTriggerUnit()
    if GetHeroLevel(u)>4 and GetUnitAbilityLevel(u,'A524')==0 then
      call UnitAddAbility2(u,'A524')
    endif
    if GetHeroLevel(u)>13 then
      call SetUnitAbilityLevel(u,'A524',4)
    elseif GetHeroLevel(u)>10 then
      call SetUnitAbilityLevel(u,'A524',3)
    elseif GetHeroLevel(u)>7 then
      call SetUnitAbilityLevel(u,'A524',2)
    endif
    set u=null
  elseif id=='QB0G' or id=='A0AR' then
    set u=GetTriggerUnit()
    if GetHeroLevel(u)>13 then
      call SetUnitAbilityLevel(u,'A2AI',4)
    elseif GetHeroLevel(u)>10 then
      call SetUnitAbilityLevel(u,'A2AI',3)
    elseif GetHeroLevel(u)>7 then
      call SetUnitAbilityLevel(u,'A2AI',2)
    elseif GetHeroLevel(u)>4 then
      call UnitAddAbility2(u,'A2AI')
    endif
    set u=null
  elseif id=='A13T' then
    set u=GetTriggerUnit()
    if GetHeroLevel(u)>4 and GetUnitAbilityLevel(u,'A522')==0 then
      call UnitAddAbility(u,'A522')
      call UnitMakeAbilityPermanent(u,true,'A522')
      call UnitAddAbility2(u,'A13T')
    endif
    if GetHeroLevel(u)>13 then
      call SetUnitAbilityLevel(u,'A13T',4)
    elseif GetHeroLevel(u)>10 then
      call SetUnitAbilityLevel(u,'A13T',3)
    elseif GetHeroLevel(u)>7 then
      call SetUnitAbilityLevel(u,'A13T',2)
    endif
    set u=null
    return 'A522'
  endif
  return id
endfunction

function GetPassiveID takes integer learnid returns integer
  local integer i=1
  local integer k=0
  loop
    //call BJDebugMsg(I2S(PassivesLearningSkill[i]))
    if learnid==PassivesLearningSkill[i] or learnid==PassivesLearningSkillUpg[i] or learnid==PassivesRealID[i] or learnid==PassivesSpellbookID[i] then 
      set k=i
    endif
    set i=i+1
    exitwhen k>0 or i>PassivesCount
  endloop
  return k
endfunction

function ChangeAbilityVision takes unit u, integer oldid, integer newid returns nothing
  local integer lvl=GetUnitAbilityLevel(u,oldid)
  call UnitRemoveAbility(u,oldid)
  call UnitAddAbility2(u,newid)
  call SetUnitAbilityLevel(u,newid,lvl)
endfunction

function Q08 takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer lvl=GetHeroLevel(u)
  local integer PlayerId=GetPlayerId(GetOwningPlayer(u))
  local integer Q28
  local integer i
  local integer k=0
  local integer HQ28
  
  if NumberOfExtraAbilities>=1 then
    set Q28=SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+5]]
    
    set HQ28=GetPassiveID(Q28)
    //call BJDebugMsg(I2S(HQ28))
    set Q28=QL8(Q28)
    if Q28=='A30U'then
      if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==true or RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+1]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+2]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+3]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+4]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+5]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+6]],"melee morph",null) then
        set Q28='A30T'
      else
        set Q28='A306'
      endif
    endif
    //call BJDebugMsg(Id2String(Q28)+" "+I2S(lvl)+" "+I2S(ExtraAbilityLevel[PlayerId*2+1]))
    if lvl>=5 and ExtraAbilityLevel[PlayerId*2+1]==0 then
      call UnitAddAbility(u,Q28)
      call UnitMakeAbilityPermanent(u,true,Q28)
      if HidePassivesForPlayer[PlayerId] and HQ28>0 then
        call UnitRemoveAbility(u,PassivesUpgradeID[HQ28])
        call UnitAddAbility2(u,PassivesUpgradeID[HQ28])
        call ChangeAbilityVision(u,PassivesLearningSkill[HQ28],PassivesLearningSkillUpg[HQ28])
      endif
      if Q28=='A0EY' then
        call UnitAddAbility2(u,'A0FH')
        call UnitAddAbility2(u,'A0F0')
        call SetUnitAbilityLevel(u,'A0FH',1)
        call SetUnitAbilityLevel(u,'A0F0',1)
      endif
      call SaveInteger(hashtable019,'0GAL',1488,1)//get ability lvl
      call SaveUnitHandle(hashtable019,'0GTU',1488,u)//get trigger unit
      call SaveInteger(hashtable019,'0GLS',1488,Q28)//get learned skill
      call ExeFunc("R48")
      set ExtraAbilityLevel[PlayerId*2+1]=1
      //call BJDebugMsg(LoadStr(MHT,Q28,1000))
      if LoadStr(MHT,Q28,1000)!=null and LoadStr(MHT,Q28,1000)!="" then
        call ExeFunc(LoadStr(MHT,Q28,1000))
      endif
      if Q28!='A1IQ' then
        call Passive_Cooldown_Learn(u,Q28,1)
      endif
    endif
    if lvl>=8 and ExtraAbilityLevel[PlayerId*2+1]==1 then
      call SetUnitAbilityLevel(u,Q28,2)
      if HidePassivesForPlayer[PlayerId] and HQ28>0 then
        call SetUnitAbilityLevel(u,PassivesLearningSkillUpg[HQ28],2)
      endif
      if Q28=='A0EY' then
        call UnitAddAbility2(u,'A0FH')
        call UnitAddAbility2(u,'A0F0')
        call SetUnitAbilityLevel(u,'A0FH',2)
        call SetUnitAbilityLevel(u,'A0F0',2)
      endif
      call SaveInteger(hashtable019,'0GAL',1488,2)
      call SaveUnitHandle(hashtable019,'0GTU',1488,u)
      call SaveInteger(hashtable019,'0GLS',1488,Q28)
      call ExeFunc("R48")
      set ExtraAbilityLevel[PlayerId*2+1]=2
      if LoadStr(MHT,Q28,1001)!=null and LoadStr(MHT,Q28,1001)!="" then
        call ExeFunc(LoadStr(MHT,Q28,1001))
      endif
      call Passive_Cooldown_Learn(u,Q28,2)
    endif
    if lvl>=11 and ExtraAbilityLevel[PlayerId*2+1]==2 then
      call SetUnitAbilityLevel(u,Q28,3)
      if HidePassivesForPlayer[PlayerId] and HQ28>0 then
        call SetUnitAbilityLevel(u,PassivesLearningSkillUpg[HQ28],3)
      endif
      if Q28=='A0EY' then
        call UnitAddAbility2(u,'A0FH')
        call UnitAddAbility2(u,'A0F0')
        call SetUnitAbilityLevel(u,'A0FH',3)
        call SetUnitAbilityLevel(u,'A0F0',3)
      endif
      call SaveInteger(hashtable019,'0GAL',1488,3)
      call SaveUnitHandle(hashtable019,'0GTU',1488,u)
      call SaveInteger(hashtable019,'0GLS',1488,Q28)
      call ExeFunc("R48")
      set ExtraAbilityLevel[PlayerId*2+1]=3
      if LoadStr(MHT,Q28,1001)!=null and LoadStr(MHT,Q28,1001)!="" then
        call ExeFunc(LoadStr(MHT,Q28,1001))
      endif
      call Passive_Cooldown_Learn(u,Q28,3)
    endif
    if lvl>=14 and ExtraAbilityLevel[PlayerId*2+1]==3 then
      call SetUnitAbilityLevel(u,Q28,4)
      if HidePassivesForPlayer[PlayerId] and HQ28>0 then
        call SetUnitAbilityLevel(u,PassivesLearningSkillUpg[HQ28],4)
      endif
      if Q28=='A0EY' then
        call UnitAddAbility2(u,'A0FH')
        call UnitAddAbility2(u,'A0F0')
        call SetUnitAbilityLevel(u,'A0FH',4)
        call SetUnitAbilityLevel(u,'A0F0',4)
      endif
      call SaveInteger(hashtable019,'0GAL',1488,4)
      call SaveUnitHandle(hashtable019,'0GTU',1488,u)
      call SaveInteger(hashtable019,'0GLS',1488,Q28)
      call ExeFunc("R48")
      set ExtraAbilityLevel[PlayerId*2+1]=4
      if LoadStr(MHT,Q28,1001)!=null and LoadStr(MHT,Q28,1001)!="" then
        call ExeFunc(LoadStr(MHT,Q28,1001))
      endif
      call Passive_Cooldown_Learn(u,Q28,4)
    endif
    call GeneralLearnA(Q28)
    if(ItsEvasionAbility(Q28))then
      set TempInteger=Q28
      call EvasionStacking()
    endif
  endif
  if NumberOfExtraAbilities>=2 then
    set Q28=SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+6]]
    set HQ28=GetPassiveID(Q28)
    set Q28=QL8(Q28)
    
    set i=AghaGetIndexByBaseSpell(Q28)
    
    if lvl>=8 and ExtraAbilityLevel[PlayerId*2+2]==0 then
      
      call UnitAddAbility(u,Q28)
      call UnitMakeAbilityPermanent(u,true,Q28)
      if Mode_MA then
        if i>0 then
          call UnitMakeAbilityPermanent(u,true,AghaUpgradedSpellID[i])
        endif
      endif
      if HidePassivesForPlayer[PlayerId] and HQ28>0 then
        call UnitAddAbility2(u,PassivesUpgradeID[HQ28])
        call ChangeAbilityVision(u,PassivesLearningSkill[i],PassivesLearningSkillUpg[i])
      endif
      call SaveInteger(hashtable019,'0GAL',1488,1)
      call SaveUnitHandle(hashtable019,'0GTU',1488,u)
      call SaveInteger(hashtable019,'0GLS',1488,Q28)
      call ExeFunc("R48")
      set ExtraAbilityLevel[PlayerId*2+2]=1
      if LoadStr(MHT,Q28,1000)!=null and LoadStr(MHT,Q28,1000)!="" then
        call ExeFunc(LoadStr(MHT,Q28,1000))
      endif
      if Q28!='A065' then//-rearm
        call Passive_Cooldown_Learn(u,Q28,1)
      endif
    endif
    if i>0 and GetUnitAbilityLevel(u,AghaUpgradeID[i])>0 then
      set Q28=AghaUpgradedSpellID[i]
    endif
    if lvl>=13 and ExtraAbilityLevel[PlayerId*2+2]==1 then
      call SetUnitAbilityLevel(u,Q28,2)
      if HidePassivesForPlayer[PlayerId] and HQ28>0 then
        call SetUnitAbilityLevel(u,PassivesLearningSkillUpg[HQ28],2)
      endif
      call SaveInteger(hashtable019,'0GAL',1488,2)
      call SaveUnitHandle(hashtable019,'0GTU',1488,u)
      call SaveInteger(hashtable019,'0GLS',1488,Q28)
      call ExeFunc("R48")
      set ExtraAbilityLevel[PlayerId*2+2]=2
      if LoadStr(MHT,Q28,1001)!=null and LoadStr(MHT,Q28,1001)!="" then
        call ExeFunc(LoadStr(MHT,Q28,1001))
      endif
      call Passive_Cooldown_Learn(u,Q28,2)
    endif
    if lvl>=18 and ExtraAbilityLevel[PlayerId*2+2]==2 then
      call SetUnitAbilityLevel(u,Q28,3)
      if HidePassivesForPlayer[PlayerId] and HQ28>0 then
        call SetUnitAbilityLevel(u,PassivesLearningSkillUpg[HQ28],3)
      endif
      call SaveInteger(hashtable019,'0GAL',1488,3)
      call SaveUnitHandle(hashtable019,'0GTU',1488,u)
      call SaveInteger(hashtable019,'0GLS',1488,Q28)
      call ExeFunc("R48")
      set ExtraAbilityLevel[PlayerId*2+2]=3
      if LoadStr(MHT,Q28,1001)!=null and LoadStr(MHT,Q28,1001)!="" then
        call ExeFunc(LoadStr(MHT,Q28,1001))
      endif
      call Passive_Cooldown_Learn(u,Q28,3)
    endif
    call GeneralLearnA(Q28)
  endif
  if HidePassivesForPlayer[PlayerId] then
    set TEMPUNIT=u
    call ExeFunc("HidePassivesOnLearn")
  endif
  set u=null
endfunction

function R78 takes nothing returns nothing
  local integer xx=0
  if(GetUnitTypeId(GetTriggerUnit())=='hfoo')then
    loop
      if(GetSpellAbilityId()==SkillID[xx])then
        call IssueImmediateOrderById(GetTriggerUnit(),851972)
        exitwhen true
      endif
      set xx=xx+1
      exitwhen xx>NumberOfHeroes*4
    endloop
  endif
endfunction

function R98 takes nothing returns nothing
  local unit u=GetEnumUnit()
  call CreateUnit(GetOwningPlayer(u),'n00C',GetUnitX(u),GetUnitY(u),.0)
  call PanCameraToTimed(GetUnitX(u),GetUnitY(u),.0)
  call KillUnit(u)
  set u=null
endfunction

function RD8 takes nothing returns boolean
  return GetUnitTypeId(GetFilterUnit())=='etol'
endfunction

function RE8 takes nothing returns boolean
  return GetUnitTypeId(GetFilterUnit())=='unpl'
endfunction

function RF8 takes integer RG8 returns nothing
  local group g=CreateGroup()
  set GameWasFFed=true
  if RG8==1 then
    call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function RD8))
  else
    call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function RE8))
  endif
  call ForGroup(g,function R98)
  call DestroyGroup(g)
  set g=null
endfunction

function RH8 takes integer PlayerId returns integer
  local integer xx=0
  loop
    if PlayersId[xx]==PlayerId then
      return xx
    endif
    set xx=xx+1
    exitwhen xx>12
  endloop
  return 0
endfunction

function RI8 takes nothing returns nothing
  local integer i=0
  local boolean b=true
  local boolean bb=false
  loop
    if(GetPlayerController(Player(PlayersId[i]))==MAP_CONTROL_USER)and(GetPlayerSlotState(Player(PlayersId[i]))==PLAYER_SLOT_STATE_PLAYING)then
      set bb=true//if player exist
      if not PlayerFFed[PlayersId[i]]then
        set b=false//not ffed yet
        exitwhen true
      endif
    endif
    set i=i+1
    exitwhen i>5
  endloop
  if b and bb then
    call RF8(1)
  endif
  set i=6
  set b=true
  set bb=false
  loop
    if(GetPlayerController(Player(PlayersId[i]))==MAP_CONTROL_USER)and(GetPlayerSlotState(Player(PlayersId[i]))==PLAYER_SLOT_STATE_PLAYING)then
      set bb=true
      if not PlayerFFed[PlayersId[i]]then
        set b=false
        exitwhen true
      endif
    endif
    set i=i+1
    exitwhen i>11
  endloop
  if b and bb then
    call RF8(2)
  endif
endfunction

function RN8 takes integer PlayerId, boolean b returns nothing
  local player p=Player(PlayerId)
  if not(GameWasFFed) and Mode_FF then
    if b then //for leavers
      set PlayerFFed[PlayerId]=true
      call RI8()
      return
    endif
    if GetPlayerState(p,PLAYER_STATE_RESOURCE_LUMBER)>=20 then
      if not(PlayerFFed[PlayerId])then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,10.,"|c00FF0000[FF] |r"+"|c006699CC"+"Player "+udg_Colors[PlayerId]+IL7[PlayerId]+"|r"+"|c006699CC"+" has voted to fast finish."+"|r")
        set PlayerFFed[PlayerId]=true
        call RI8()
      else
        call DisplayTimedTextToPlayer(p,.0,.0,10.,"|c00FF0000[FF] |r"+"|c006699CC"+"You have already voted."+"|r")
      endif
    else
      call DisplayTimedTextToPlayer(p,.0,.0,10.,"|c00FF0000[FF] |r"+"|c006699CC"+"You can only vote to fast finish after 20 minutes."+"|r")
    endif
  endif
  set p=null
endfunction

function RO8 takes player p returns nothing
  local integer RJ8=0
  if not(GameWasFFed)then
    call DisplayTimedTextToPlayer(p,.0,.0,10.,"|c00FF0000[FF] |r"+"|c006699CC"+"Who is FF."+"|r")
    loop
      if((GetPlayerController(Player(PlayersId[RJ8]))==MAP_CONTROL_USER)and(GetPlayerSlotState(Player(PlayersId[RJ8]))==PLAYER_SLOT_STATE_PLAYING))then
        if PlayerFFed[PlayersId[RJ8]]then
          call DisplayTimedTextToPlayer(p,.0,.0,10.,"|c006699CC[|r"+"|c0066FF66Y|r"+"|c006699CC]|r"+" "+TabTab+udg_Colors[PlayersId[RJ8]]+IL7[PlayersId[RJ8]]+"|r")
        else
          call DisplayTimedTextToPlayer(p,.0,.0,10.,"|c006699CC[|r"+"|c00C83264N|r"+"|c006699CC]|r"+" "+TabTab+udg_Colors[PlayersId[RJ8]]+IL7[PlayersId[RJ8]]+"|r")
        endif
      elseif RJ8==0 then
        call DisplayTimedTextToPlayer(p,.0,.0,10.,"|c00ff0303The Sentinel|r")
      elseif RJ8==6 then
        call DisplayTimedTextToPlayer(p,.0,.0,10.,"|c0020c000The Scourge|r")
      endif
      set RJ8=RJ8+1
      exitwhen RJ8>12
    endloop
  endif
endfunction

function RP8 takes nothing returns nothing
  local integer xx=0
  loop
    set PlayersId[xx]=xx
    set xx=xx+1
    exitwhen xx>12
  endloop
endfunction




function FindString takes string String, string Substring returns boolean
  local integer length=StringLength(String)
  local integer slength=StringLength(Substring)
  local integer i=0
  if String==null or String=="" or Substring==null or Substring=="" then
    return false
  endif
  loop
    exitwhen i+slength>length
    if SubString(String,i,i+slength)==Substring then
      return true
    endif
    set i=i+1
  endloop
  return false
endfunction







function IsPlayer takes player p returns boolean
  return GetPlayerSlotState(p)==PLAYER_SLOT_STATE_PLAYING and GetPlayerController(p)==MAP_CONTROL_USER
endfunction

function SuspendXP_Fix takes nothing returns boolean
  call SuspendHeroXP(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(2)),true)
  return false
endfunction

function Func1381 takes nothing returns nothing
  local trigger t
  local integer Cache
  local unit Source=GetTriggerUnit()
  local integer SkillPoints=GetHeroSkillPoints(Source)
  if GetHeroLevel(Source)>=MaximumLevel then
    call SuspendHeroXP(Source,true)
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(Cache),(2),(GetTriggerUnit()))
    call TriggerRegisterTimerEvent(t,0.1,true)
    call TriggerAddCondition(t,Condition(function SuspendXP_Fix))
    set t=null
  endif
  set Source=null
endfunction

function DPSTimerCounter takes nothing returns nothing
  local integer i=0
  local integer d=1
  local real totaldmg=0
  loop
    loop
      set totaldmg=totaldmg+LoadReal(hashtable019,i,'hDPS'+d)
      call SaveReal(hashtable019,i,'hDPS'+d,LoadReal(hashtable019,i,'hDPS'+d+1))
      set d=d+1
      exitwhen d==61
    endloop
    set DPS[i]=R2I(totaldmg/60.)
    set d=1
    set totaldmg=0
    set i=i+1
    exitwhen i==12
  endloop
endfunction

function SD8 takes nothing returns nothing
  local integer PlayerId=GetPlayerId(GetOwningPlayer(GetEventDamageSource()))
  local real Damage=GetEventDamage()
  local real hp=GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)
  if not(GetPlayerController(GetOwningPlayer(GetEventDamageSource()))==MAP_CONTROL_USER) or not(GetPlayerController(GetOwningPlayer(GetTriggerUnit()))==MAP_CONTROL_USER) or not IsPlayerEnemy(GetOwningPlayer(GetTriggerUnit()),GetOwningPlayer(GetEventDamageSource())) then
    return
  endif
  if Damage>hp then
    set Damage=hp
  endif
  if not IsRealDamage then
    return
  endif
  call SaveReal(hashtable019,PlayerId,'hDPS'+60,Damage+LoadReal(hashtable019,PlayerId,'hDPS'+60))
endfunction

function DPSRegister takes nothing returns nothing
  local trigger t
  if b_isPickTime==false and IsPlayer(GetOwningPlayer(GetTriggerUnit())) then
    set t=CreateTrigger()
    call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
    call TriggerAddAction(t,function SD8)
    set t=null
  endif
endfunction

function SG8 takes nothing returns nothing
  local texttag tt=null
  local string d=I2S(R2I(GetEventDamage()))
  local player t=GetOwningPlayer(GetTriggerUnit())
  local player a=GetOwningPlayer(GetEventDamageSource())
  if d=="0" then
    return
  endif
  call CreateTextTagUnitBJ(d,GetTriggerUnit(),zOffsetDebug,12.,100.,100.,100.,.0)
  set zOffsetDebug=zOffsetDebug+20
  set tt=bj_lastCreatedTextTag
  call SetTextTagVelocityBJ(tt,10.,90)
  call SetTextTagPermanentBJ(tt,false)
  call SetTextTagLifespanBJ(tt,3)
  call SetTextTagFadepointBJ(tt,2)
  call SetTextTagVisibility(tt,false)
  if b_isDamageShowed[GetPlayerId(t)]and GetLocalPlayer()==t then
    call SetTextTagColor(tt,250,0,0,255)
    call SetTextTagVisibility(tt,true)
  endif
  if b_isDamageShowed[GetPlayerId(a)]and GetLocalPlayer()==a and IsUnitVisibleLoD(GetTriggerUnit(),a)then
    call SetTextTagColor(tt,0,0,250,255)
    call SetTextTagVisibility(tt,true)
  endif
  set tt=null
  set t=null
  set a=null
endfunction

function SH8 takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local trigger t
  if (IsUnitType(u,UNIT_TYPE_HERO) and b_isPickTime)==false then
    if quest_test then
      set t=CreateTrigger()
      call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DAMAGED)
      call TriggerAddAction(t,function SG8)
      set t=null
    endif
    if IsUnitType(u,UNIT_TYPE_HERO) and GetUnitAbilityLevel(u,'A04R')==0 then
      call ExeFunc("LoDEvent_Add")
    endif
  endif
  
  set u = null
  //set t = null
endfunction

function isPlayerPickedAbility takes player p,integer SJ8 returns boolean
  local integer PlayerId=GetPlayerId(p)
  local integer xx=1
  loop
    if(PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]==SJ8)then
      return true
    endif
    set xx=xx+1
    exitwhen xx>4+NumberOfExtraAbilities
  endloop
  return false
endfunction

function SK8 takes integer PlayerId,integer Q28 returns integer
  local integer xx=1
  loop
    set Q28=QL8(Q28)
    if(SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]]==Q28)then
      return PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]
    endif
    set xx=xx+1
    exitwhen xx>4+NumberOfExtraAbilities
  endloop
  return 0
endfunction

function SM8 takes integer PlayerId returns nothing
  local integer xx=1
  local integer i
  loop
    set i=PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]
    if RA8(StackingLimitations[i],"passive "+I2S(i),"")then
      set IsPassiveAbility[PlayerId*PlayerSkillOffset+xx]=true
    else
      set IsPassiveAbility[PlayerId*PlayerSkillOffset+xx]=false
    endif
    set xx=xx+1
    exitwhen xx>4+NumberOfExtraAbilities
  endloop
endfunction



function SR8 takes player p returns boolean
  local string SS8=IL7[GetPlayerId(p)]
  local string ST8=""
  return RA8(ST8,SS8,"")
endfunction

function PreloadAbility takes integer X58 returns nothing
  local unit u=CreateUnit(Player(15),'H00Y',0,0,270)
  call UnitAddAbility(u,X58)
  call UnitRemoveAbility(u,X58)
  call RemoveUnit(u)
  set u=null
endfunction

function GetHeroAbilityLevel takes unit Hero, integer id returns integer
  local integer i=GetPlayerId(GetOwningPlayer(Hero))
  local integer aid1=AlternateSkillID[PlayerSkillNumber[i*PlayerSkillOffset+id]]
  local integer aid2=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+id]]
  if aid1!=null then
    if GetUnitAbilityLevel(Hero,aid1)>0 then
      return GetUnitAbilityLevel(Hero,aid1)
    endif
  endif
  return GetUnitAbilityLevel(Hero,aid2)
endfunction

function ExBalanceOffDropper takes integer id, integer ifBalance, integer ifImbalance, integer ub, integer uimb returns nothing
  if Mode_EB then
    set SkillID[id]=ifBalance
    set EngineeringUpgradeSkillID[id]=ub
  else
    set SkillID[id]=ifImbalance
    set EngineeringUpgradeSkillID[id]=uimb
  endif
  //call echo(Id2String(ifBalance))
endfunction

function BalanceOffDropper takes integer id, integer BSkillId, integer ISkillId, integer BUpgradeId, integer IUpgradeId returns nothing
  if Mode_BO then
    set SkillID[id]=ISkillId
    set EngineeringUpgradeSkillID[id]=IUpgradeId
  else
    set SkillID[id]=BSkillId
    set EngineeringUpgradeSkillID[id]=BUpgradeId
  endif
endfunction

function BalanceOffStackSwitch takes integer id, string BO_on, string BO_off returns nothing
  if Mode_BO then
    set StackingLimitations[id]=BO_on
  else
    set StackingLimitations[id]=BO_off
  endif
endfunction

function CSD takes integer id, string IconPath, string StackLim, integer RSkillId, integer ASkillId, integer USkillId, string BalanceStr, string ExBalanceStr returns nothing
  set SkillIcon[id]=IconPath
  set StackingLimitations[id]=StackLim
  set SkillID[id]=RSkillId
  set AlternateSkillID[id]=ASkillId
  set EngineeringUpgradeSkillID[id]=USkillId
  set BalanceStrings[id]=BalanceStr
  set ExBalanceStrings[id]=ExBalanceStr
endfunction

function SZ8 takes nothing returns nothing
  local integer i=0
  local integer k=0
  set SkillIcon[0]=EmptySlotPath
  set StackingLimitations[0]=""
  set SkillID[0]=0
  set EngineeringUpgradeSkillID[0]=0
  set StackingLimitations_Balanced[0]=""
  set i=1-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNFrostBolt.blp","thunderbolt",'A02A',0,'Y001',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNHowlOfTerror.blp","volcano",'A17O',0,'Y002',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNGnollCommandAura.blp","passive 3",'P003','QP03','Y003',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNWandOfNeutralization.blp","forkedlightning",'A0IN','A1AW','Y004',"","")
  set i=2-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNChainLightning.blp","chainlightning",'A020',0,'Y005',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNBlue_Lightning.blp","thunderbolt",'A0JC',0,'Y006',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNZeusStatic.blp","passive 7",'A0N5','QP1T','Y007',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNSpell_Holy_SealOfMight.blp","roar, r1",'A29G','A29H','Y008',"","")
  set i=3-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNMagicImmunity.blp","passive 9",'A0DW','QP04','Y009',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSlow.blp","slow",'A0DX',0,'Y010',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNNaturesAttendants.blp","tornado",'A01B',0,'Y011',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDryadDispelMagic.blp","enhancement 12, arrows, range only",'A0DY','A1WB','Y012',"","")
  set i=4-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNCrushingWave.blp","carrionswarm",0,0,0,"","Waveform CD 11 -> 13")
  call ExBalanceOffDropper(i*4+1,'QB02','A0FN','QY02','Y013')//waveform
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNShimmerWeed.blp","acidbomb",'A0G6',0,'Y014',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNReplenishMana.blp","replenishmana, replenishlife, multi-icon, abuz agi, str bug",'A0KX',0,'Y015',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNForceofNature.blp","item 16, coldarrows",'A0G8',0,'Y016',"","")
  set i=5-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNCrystalNova.blp","mounthippogryph",'A1E9',0,'Y017',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNFrost.blp","entanglingroots",'A04C',0,'Y018',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNBrilliance.blp","passive 19",'P019','QP05','Y019',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTN_CMFF.blp","autoharvestlumber",'A03R','A0AV','Y020',"","")
  set i=6-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNStormBolt.blp","spellshieldaoe",'A190',0,'Y021',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNCleavingAttack.blp","melee only, passive 22",'A01K','QP06','Y022',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNAncestralSpirit.blp","fanofknives",'A2IS',0,'Y023',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNSvenGS.BLP","roar",'A1WH','A0WP','Y024',"","")
  set i=7-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSirenMirrorImage.blp","mirrorimage",'A063',0,'Y025',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNEnsnare.blp","unavatar",'A24D',0,'Y026',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNRipTide.blp","fanofknives",'A2KU',0,'Y027',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNPenguin.blp","awaken, avengerform, r2",'A07U',0,'Y028',"","")
  set i=8-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNShockWave.blp","barkskinoff",'A0SK',0,'Y029',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSmash.blp","roar",'A0DL',0,'Y030',"","Enchant Totem in addition with Tidebringer, Geminate attack (on melee), Walrus Punch, Jinada or Sleight of Fist will only add +100/140/180/220% dmg")
  call BalanceOffStackSwitch(i*4+2,"roar","roar, bgdmg1")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNAftershock.blp","passive 31",0,'QP1H',0,"","Aftershock duration changed from 0.6/0.9/1.2/1.5 to 0.6/0.8/1.0/1.2, damage from 50/75/100/125 to 40/60/80/100. It also has a cooldown of 1.6s.")
  call ExBalanceOffDropper(i*4+3,'QF85','A0DJ','QY85','Y031')//aftershock
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNEarthquake.blp","fanofknives",'A0DH','A1OB','Y032',"","")
  set i=9-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNCloudOfFog.blp","neutralinteract",'A0RG',0,'Y033',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNBlinkStrikeSA.blp","barkskinon",'A0K9',0,'Y034',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNTheBlackArrow.blp","passive 35",'A0DZ','QP07','Y035',"","Backstab deals only .5/0.6/0.7/0.8x agility damage if you have Fury Swipes")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNRikiINV.blp","passive 36, inv bug 1, ibug",'A0MB'+('A00J'*0),'QP08','Y036',"","Permanent Invisibility will be removed on spell casting")
  set i=10-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNGrizzlyBear.blp","summongrizzly",'A0A5',0,'Y037',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNDOCMasterTraining.blp","fanofknives",'A1EG'+('A1EF'*0),0,'Y038',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTN_SyllaSynergy.BLP","not work, engineeringupgrade",'A0A8'*0,0,'Y039',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNBearForm.blp","bearform, unbearform, battleroar, metamorphosis, melee morph, multi-icon",'A0AG',0,'Y040',"","")
  set i=11-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSearingArrows.blp","shockwave",'A01F',0,'Y041',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTN_LightStrikeArray.blp","restorationoff",0,0,0,"","Light Strike Array CD changed from 7 to 9s")
  call ExBalanceOffDropper(i*4+2,'QB0E','Z042','QY0E','Y042')//[lich bs] light strike
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNDisenchant.blp","passive 43",'A18X','QP1U','Y043',"Spells with a cooldown of 3s or less will only proc Fiery Soul every 2nd cast.","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNManaFlare.blp","chainlightning",'A01P','A09Z','Y044',"","")
  set i=12-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNWhirlwind.blp","whirlwind",'A05G',0,'Y045',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNHealingWard.blp","healingward",'A047',0,'Y046',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNBladeDance.blp","passive 47",'A00K','QP09','Y047',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNOmnislash.BLP","thunderbolt",'A0M1','A1AX','Y048',"","")
  set i=13-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNControlMagic.blp","neutralspell",'A14L',0,'Y049',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTN_GlaviesOfWisdom.BLP","arrows, range only",'A0LZ',0,'Y050',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNBansheeMaster.BLP","transmute",'A2NT',0,'Y051',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNSilencerSilence.blp","battlestations, r4",'A0L3','A2QC','Y052',"","")
  set i=14-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNNaturesGuise.blp","invisibility",'A01Z',0,'Y053',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNLeechSeed.blp","unavengerform",'A26N',0,'Y054',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNLivingArmor.blp","spiritlink",'A2ML',0,'Y055',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNOvergrowth.blp","blight",'A07Z',0,'Y056',"","")
  set i=15-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNGreatStomp.blp","holybolt",'A1AA',0,'Y057',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNAncestralCharge.blp","loadcorpse, whirlwind",'A1A8',0,'Y058',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNNaturalOrder.blp","passive 59",'A1CD','QP1I','Y059',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNEarthSplitter.blp","board",'A1A1',0,'Y060',"","")
  set i=16-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNOrbOfLightning.blp","carrionscarabs, carrionscarabsinstant",'A085',0,'Y061',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNCharm.blp","spellsteal",'A10X',0,'Y062',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNPriestAdept.blp","frenzy",'A112',0,'Y063',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNGhostMage.blp","range morph, metamorphosis, phoenixfire, creepheal, multi-icon",'QM01',0,'Y064',"","")
  set i=17-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNEarthquake.blp","thunderclap",'A03Y',0,'Y065',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNBloodLust.blp","fanofknives",0,0,0,"","Overpower manacost increased from 45/55/65/75 to 50/65/80/95, and attack speed bonus reduced if you pick Grow")
  call ExBalanceOffDropper(i*4+2,'QB0P','A1N4','QY0P','Y066')//Overpower
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNFurySwipes.blp","melee only, passive 67, orb effect, buff placer",'P067','QP0A','Y067',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNImprovedStrengthOfTheWild.blp","berserk",'A0LC',0,'Y068',"","")
  set i=18-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNFireBolt.blp","thunderbolt",0,0,0,"","Fire Blast CD changed from 6 to 8s")
  call ExBalanceOffDropper(i*4+1,'QB0J','A04W','QY0J','Y069')//[lich bs] fireblast
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNLiquidFire.blp","acidbomb",'A011',0,'Y070',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNBloodLust.blp","bloodlust",'A083',0,'Y071',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNWitchDoctorMaster.blp","carrionscarabsoff, passive 72",'A088','QP24','Y072',"Multicast chance reduced: x2 by 7%/3.5%/0%, x3 by 7%/3.5%, x4 by 7%","")
  set i=19-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNTinkerLaser.blp","drunkenhaze",'A049',0,'Y073',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNClusterRockets.blp","fanofknives",'A05E',0,'Y074',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNMarchOfTheMachines.blp","not work, manaflareoff",'A0BQ',0,'Y075',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNEngineeringUpgrade.blp","monsoon, channel, r44, r95, r55, r1, r2, r3, r4, r5, r6, r7, r8, r9, r10, r123, r11, r12, r14, r15, r16, r17, r18, r19, r20, r21, r22, r23, r24, r25",'A065',0,'Y076',"Rearm has a 9/6/3 cooldown.","")
  set i=20-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNEatTree.blp","carrionswarm",'A21E',0,'Y077',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNWispSplode.blp","blink",'A01O',0,'Y078',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNEnt.blp","forceofnature",'AEfn',0,'Y079',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNTreeOfEternity.blp","chainlightning, r55",'A1W8','A1W9','Y080',"","")
  set i=21-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNWindsArrows.blp","spellstealoff",'A10D',0,'Y081',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNDoppelwalk.blp","windwalk",0,0,0,"","Doppelwalk Manacost changed from 150/120/90/60 to 150/130/110/90")
  call ExBalanceOffDropper(i*4+2,'QB0B','A0D7','QY0B','Y082')
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNJuxtapose.blp","passive 83",'A0DB','QP0B','Y083',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNPhantomEdge.blp","passive 84",'A0YK','QP0C','Y084',"","")
  set i=22-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNGolemStormBolt.blp","phoenixmorph",'A0LL',0,'Y085',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNToss.blp","carrionscarabson",'A0BZ',0,'Y086',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNResistantSkin.blp","passive 87",'A19Q','QP1J','Y087',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNTinyGrow.blp","enhancement 88, passive 88",'A0CY','QP1K','Y088',"","Only increases damage by 40/80/120 for ranged heroes or heroes with range morphs.")
  call BalanceOffStackSwitch(i*4+4,"enhancement 88, passive 88","enhancement 88, passive 88, bgdmg1")
  set i=23-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNGoblinLandMine.blp","item 89",'A05J',0,'Y089',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNStasisTrap.blp","stasistrap",'A06H',0,'Y090',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNSelfDestructOn.blp","selfdestruct",'A06B',0,'Y091',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNRemote.blp","ward, chainlightning, multi-icon",'A0AK','A1FY','Y092',"","")
  set i=24-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNHolyBolt.blp","drunkenhaze",'A0KM',0,'Y093',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNStaffOfPreservation.blp","ancestralspirittarget, build",'A0LV',0,'Y094',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNScepterOfMastery.blp","ambush",'A28T',0,'Y095',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNHeal.blp","controlmagic, r6",'A0LT','A1CS','Y096',"","")
  set i=25-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNMoonStone.blp","firebolt",'A042',0,'Y097',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNUpgradeMoonGlaive.blp","enhancement 98, passive 98, buff placer, arrows",'A041','QP0D','Y098',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNAdvancedStrengthOfTheMoon.blp","enhancement 99, passive 99",'A062','QP0E','Y099',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNElunesBlessing.blp","corporealform",'A054','A00U','Y100',"","")
  set i=26-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNFragmentationBombs.blp","possession",'A064',0,'Y101',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNHumanMissileUpOne.blp","passive 102",'A03S','QP0F','Y102',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNHumanMissileUpTwo.blp","enhancement 103, passive 103, range only",'A03U','QP1Q','Y103',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDwarvenLongRifle.blp","thunderbolt",'A04P',0,'Y104',"","")
  set i=27-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNOrcMeleeUpThree.blp","metamorphosis, bearform, unbearform, melee morph, bash",'A0BE',0,'Y105',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNWhirlingAxesRanged.blp","auraunholy, loadarcher",'A21M',0,'Y106',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNCommand.blp","passive 107",'A0O0','QP0G','Y107',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNBerserkForTrolls.blp","fanofknives",'A1EJ',0,'Y108',"","")
  set i=28-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNRhastaForkedLightning.blp","forkedlightning",'A010',0,'Y109',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNHex.blp","hex",'A0RX',0,'Y110',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNMagicLariet.blp","magicleash",'A00P',0,'Y111',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNSerpentWard.blp","ward, r7",'A00H','A0A1','Y112',"","")
  set i=29-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNTether.blp","chainlightning, frenzyoff",'A1TA',0,'Y113',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSpirits.blp","fanofknives, battleroar, roar, multi-icon",'A1T8',0,'Y114',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNOvercharge.blp","manashieldon, manashieldoff",'A28Q',0,'Y115',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNRelocate.blp","spellstealon",'A1TB',0,'Y116',"","")
  set i=30-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNThunderClapPanda.blp","thunderclap",'A06M',0,'Y117',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNStrongDrink.blp","drunkenhaze",'Acdh',0,'Y118',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNDrunkenDodge.blp","passive 119",'A0MX','QP0H','Y119',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNStormEarth&Fire.blp","elementalfury",'A0MQ','A1B6','Y120',"","")
  set i=31-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNWarStomp.blp","stomp",'A00S',0,'Y121',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNArcaniteMelee.blp","firebolt",'A00L',0,'Y122',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNThorns.blp","passive 123",'A00V','QP0I','Y123',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNStampede.blp","ward, r8",'A2O6',0,'Y124',"","")
  set i=32-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNUpgradeMoonGlaive.blp","thunderbolt",'A004',0,'Y125',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNJinada.blp","passive 126, nagabuild, r9",'A1IQ',0,'Y126',"","Jinada only deals 1.25/1.45/1.65/1.85x damage if it procs while 'Sleight of Fist' or 'Grow!' or 'Geminate attack' (on melee) picked")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNWindWalkOn.blp","windwalk",0,0,0,"","Windwalk manacost changed from 50 to 50/60/70/80")
  call ExBalanceOffDropper(i*4+3,'QB09','A07A','QY09','Y127')//[lich bs] ww gondar
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNTrack.blp","faeriefire",0,0,0,"","Track duration changed from 30 to 15s")
  call ExBalanceOffDropper(i*4+4,'QB0D','A0B4','QY0D','Y128')//[lich bs] track
  set i=33-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNDKBreatheFire.blp","breathoffire",'A03F',0,'Y129',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNHumanArmorUpThree.blp","thunderbolt",0,0,0,"","Dragon Tail CD changed from 9 to 11")
  call ExBalanceOffDropper(i*4+2,'QB0G','A0AR','QY0G','Y130')//[lich bs] dk stun
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNIncinerate.blp","enhancement 131, passive 131",'A0CL','QP0J','Y131',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNAzureDragon.blp","metamorphosis, range morph",'QM00',0,'Y132',"","")
  set i=34-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNFeedback.blp","passive 133, orb effect",'A022','QP0K','Y133',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNBlink.blp","blink",0,0,0,"","Blink manacost changed from 60 to 60/70/80/90")
  call ExBalanceOffDropper(i*4+2,'QB08','AEbl','QY08','Y134')//[lich bs] antimage blink
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNNeutralManaShield.blp","passive 135",'A0KY','QP0L','Y135',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNManaVoid.blp","thunderbolt",'A0E3',0,'Y136',"","")
  set i=35-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNColdArrows.blp","arrows, range only",'A026',0,'Y137',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNDrowSilence.blp","silence",'A33A',0,'Y138',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNTrueShot.blp","defend",'A2O2',0,'Y139',"Trueshot Aura only works on range creeps, no matter if your hero is range or melee","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNMarksmanship.blp","fanofknives",'QF89',0,'QY88',"","")
  set i=36-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNResurrection.blp","frostarmor",'A08N',0,'Y141',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNRepel.blp","antimagicshell",0,0,0,"","Repel CD changed from 14 to 16, Duration from 6/8/10/12 to 4/6/8/10")
  call ExBalanceOffDropper(i*4+2,'QB05','A08V','QY05','Y142')//[lich bs] repel
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNSpiritLink.blp","passive 143",'A06A','QP0M','Y143',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDivineIntervention.blp","battleroar",'A0ER','A2S8','Y144',"","")
  set i=37-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNAbility_Warrior_SavageBlow.blp","carrionswarm",'A0O1',0,'Y145',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNEnchantedCrows.blp","awaken, unsummon, multi-icon",'A0OO',0,'Y146',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNEnchantedBears.blp","passive 147",'A0BD','QP0N','Y147',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNBattleRoar.blp","thunderbolt",'A0O2','A289','Y148',"","")
  set i=38-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNDualBreath.blp","carrionswarm",'A0O7',0,'Y149',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNFreezingBreath.blp","breathoffire",'A0O6',0,'Y150',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNAutoFire.blp","arrows, acidbomb",'A30U',0,'Y151',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNBreathOfFireNew.blp","shockwave",'A0O5','A1B1','Y152',"","")
  set i=39-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNHealingSpray.blp","preservation",'A0IL',0,'Y153',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNUnstableConcoction.blp","fanofknives, corrosivebreath",'A1NI',0,'Y154',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNMGexchange.blp","passive 155",'A0O3','QP0O','Y155',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNChemicalRage.blp","metamorphosis, melee morph, r25",0,0,0,"","Chemical Rage BAT changed from 1.4/1.2/1.0 to 1.5/1.4/1.3, Manareg from 3/7.5/12 to 3/7/11, HP Regen from 50/75/100 to 30/50/70")
  call ExBalanceOffDropper(i*4+4,'QB0K','ANcr','QY0K','Y156')//[lich bs] Chemical rage
  set i=40-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNStarfall.blp","coupleinstant",'A0KV',0,'Y157',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNImprovedStrengthOfTheMoon.blp","spies",'A0L8',0,'Y158',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNAdvancedStrengthOfTheWild.blp","windwalk",'A0LN',0,'Y159',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNAmbush.blp","corporealform, r11",'A0KU',0,'Y160',"","")
  set i=41-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNAbility_Druid_CatForm.blp","fanofknives",'A14P',0,'Y161',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNManaFlare.blp","chainlightning",'A14R',0,'Y162',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNOverload.blp","passive 163",'A0QW','QP1V','Y163',"Spells with a cooldown of 3s or less will only proc Overload every 2nd cast (except Ball Lightning).","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNStormReach.blp","carrionswarm",'A14O',0,'Y164',"","")
  set i=42-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNRegenerate.blp","massteleport",'A0QP',0,'Y165',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNFlamingArrows.blp","arrows, range only",'A0QN',0,'Y166',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNBerserkerBlood.blp","passive 167",'A0QQ','QP1L','Y167',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNSoulEater.blp","firebolt",'A0QR','A1B3','Y168',"","")
  set i=43-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNRefraction.blp","fanofknives",0,0,0,"","Instances changed from 3/4/5/6 to 2/3/4/5")
  call ExBalanceOffDropper(i*4+1,'QB03','A1EA','QY03','Y169')//refraction
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNWardenHide.blp","windwalk",'A0RV',0,'Y170',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNVorpal.blp","enhancement 171, passive 171, range only",'A0RO','QP1S','Y171',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNTrap.blp","curse, spiritwolf, multi-icon",'A0RP',0,'Y172',"","")
  set i=44-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNIllusory.blp","spiritlink, coupletarget, multi-icon",'A0S9',0,'Y173',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNWanningRift.blp","creepanimatedead",'A0SC',0,'Y174',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNPhaseShift.blp","phaseshift",'A0SB',0,'Y175',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNManaFlare.blp","rainofchaos",'A0S8','A1QP','Y176',"","")
  set i=45-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNFlakCannons.blp","creepdevour",'A0Z4',0,'Y177',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNPowerGenerator.blp","neutraldetectaoe",'A0Z5',0,'Y178',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNFlare.blp","blizzard",'A0Z6',0,'Y179',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNStrengthOfTheMoon.blp","clusterrockets",'A0Z8','A1CV','Y180',"","")
  set i=46-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNTorrent.blp","rejuvination",'A136',0,'Y181',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNTidebringer.blp","passive 182, orcbuild, r12",'A13T',0,'Y182',"Tidebringer only deals 60% AoE damage for ranged attackers.","")
  call BalanceOffStackSwitch(i*4+2,"passive 182, orcbuild, r12","passive 182, orcbuild, r12, bgdmg2")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNSpy.blp","incineratearrow, incineratearrowoff, multi-icon",'A11N',0,'Y183',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNUndeadDestroyer.blp","spiritofvengeance",'A11K',0,'Y184',"","")
  set i=47-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNShackleShot.blp","chainlightning",'A12J',0,'Y185',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNPowerShot.blp","spirittroll",'A12K',0,'Y186',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNCyclone.blp","fanofknives",'A14I',0,'Y187',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNFocusFire.blp","incineratearrowon",'A12P','A1D6','Y188',"","")
  set i=48-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNFlakCannons.blp","creepthunderbolt",'A1SO',0,'Y189',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNHumanArtilleryUpOne.blp","chainlightning",'A1SQ',0,'Y190',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNFragmentationBombs.blp","orb effect, range only, fanofknives, multi-attack",'A229',0,'Y191',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNCalldown.blp","ravenform",'A1T5','A235','Y192',"","")
  set i=49-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNThrallIcon4.blp","autodispel",'A1TV',0,'Y193',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNThrallIcon3.blp","chainlightning",'A1SW',0,'Y194',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNThrallIcon1.blp","rechargeoff",'A1SU',0,'Y195',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNStaticField.blp","stampede",'A1U6','A30N','Y196',"","")
  set i=50-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNIceShards.blp","standdown",'A1YO',0,'Y197',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSnowball2.blp","frenzyon",'A1S7',0,'Y198',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNFrozenSigil.blp","summongrizzly",'A1YR',0,'Y199',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNChillingTouch.blp","fanofknives",'A1YQ',0,'Y200',"","")
  call BalanceOffStackSwitch(i*4+4,"fanofknives","fanofknives, bgdmg2")
  set i=51-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNDash.blp","creepthunderclap",'A1RJ',0,'Y201',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNFireSpirits.blp","gold2lumber, harvest",'A1YX',0,'Y202',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNSunray.blp","charm, immolation, unimmolation, animatedead",'A1YY',0,'Y203',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNPhoenix2.blp","rechargeon, r123",'A1RK',0,'Y204',"","")
  set i=52-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNBristleGoo.blp","darkritual",'A0FW',0,'Y205',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNFanOfKnives.blp","fanofknives",'A0GP',0,'Y206',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNQuillSprayOff.blp","passive 207",'A0M3','QP1M','Y207',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNHire.blp","passive 208",'A0FV','QP1N','Y208',"Spells with a cooldown of 3s or less will only proc Warpath every 2nd cast (except Goo and Quill Spray).","")
  set i=53-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNTelekinesis.blp","wispharvest",'A27F',0,'Y209',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNFadeBolt.blp","tranquility",'A27G',0,'Y210',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNNullField.blp","passive 211",'A27V','QP0P','Y211',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNSpellSteal2.blp","transmute, multi-icon, shbug",'A27H','A30J','Y212',"","")
  set i=54-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSearingChains.blp","fanofknives",'A2H3',0,'Y213',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSleightOfFist.blp","recharge, metamorphosis",'A2H3',0,'Y213',"","Grow! provides less damage while using Sleight of Fist. Sleight of Fist CD changed from 30/22/14/6 to 32/24/16/8.")
  call ExBalanceOffDropper(i*4+2,'QB0L','A2H0','QY0L','Y214')//[lich bs] Sleight of fist
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNFlameGuard.blp","darksummoning",'A2HS',0,'Y215',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNFireRemnant.blp","ancestralspirit, acolyteharvest, multi-icon, acidbomb",'A2JR'+'A2JK'*0,'A2JL','Y216',"","")
  set i=55-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNAnimalWarTraining.blp","steal",'A2JB',0,'Y217',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNPressTheAttack.blp","creepheal",'A2J2',0,'Y218',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNMomentOfCourage.blp","passive 219, melee only",'A2EY','QP1O','Y219',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDuel.blp","autodispeloff",'A2CI',0,'Y220',"","")
  set i=56-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNArcaneBolt.blp","chainlightning",'A2BE',0,'Y221',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNConcussiveShot.blp","fanofknives",'A2IT',0,'Y222',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNAncientSeal.blp","soulburn",'A2HN',0,'Y223',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNMysticFlare.blp","submerge",'A2BG',0,'Y224',"","")
  set i=57-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNWhirlingDeath.blp","fanofknives",'A2FK',0,'Y225',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNTimberChain.blp","summonfactory",'A2E3',0,'Y226',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNReactiveArmor.blp","passive 227",'A2E4','QP1P','Y227',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNShredder_Chakram.blp","massteleport, immolation, unimmolation",'A2E5',0,'Y228',"","")
  set i=58-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSpiritWolf.blp","spiritwolf",'A03D',0,'Y229',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNHowlOfTerror.blp","deathanddecay",'A0ZF',0,'Y230',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNFeralHeart.blp","passive 231",'A03E','QP0Q','Y231',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDireWolf.blp","metamorphosis, melee morph, r95",'QM02',0,'Y232',"","")
  set i=59-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSpiderGreen.blp","parasite",'A0BH',0,'Y233',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNWeb.blp","restoration, inv bug 1",'Z234',0,'Y234',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNRedDragonDevour.blp","passive 235, orb effect",'Q0BK',0,'Y235',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNspiderling.blp","roar, melee only",'A0WQ',0,'Y236',"","")
  set i=60-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNThoriumRanged.blp","summonphoenix",'A0YM',0,'Y237',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNBearBlink.blp","deathcoil",'A0PL',0,'Y238',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNPABlur.blp","passive 239",'A03P','QP0R','Y239',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNCoupDeGrace.blp","passive 240",'A03Q','QP0S','Y240',"","")
  set i=61-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSplitShot.blp","range morph, metamorphosis, bearform, unbearform, multi-attack",'A1C0',0,'Y241',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNMysticSnakeNew.blp","chainlightning",'A0G2',0,'Y242',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNNeutralManaShield.blp","manashieldon, manashieldoff, shbug",'A0MP',0,'Y243',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNStoneGazeNew.blp","lavamonster",'A1AT',0,'Y244',"","Stone Gaze cooldown increased from 90 to 100")
  call ExBalanceOffDropper(i*4+4,'QB10','A1AT','QY0R','Y244')//[lich bs] Stone Gaze
  set i=62-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNVoid.blp","thunderbolt",'A02H',0,'Y245',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNPossession.blp","drunkenhaze",'A08C',0,'Y246',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNHeroDreadLord.blp","passive 247",'P247','A086','Y247',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDarkness.blp","battlestations, r14",'DRKN',0,'Y248',"","")
  set i=63-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNAdvancedUnholyStrength.blp","thunderbolt",'AHtb',0,'Y249',"","Hellfire Blast CD changed from 8 to 10s")
  call ExBalanceOffDropper(i*4+1,'QB0H','AHtb','QY0H','Y249')//[lich bs] leoric bolt
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNVampiricAura.blp","passive 250",'P250','QP0U','Y250',"","")
  call CSD(i*4+3,"ReplaceableTextures\\PassiveButtons\\BTNSkeletonCriticalStrike.blp","passive 251, wispharvest",'A2S0','QP0W','Y251',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNRe.blp","reincarnation, r15",'A01Y',0,'Y252',"","")
  set i=64-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNRedDragonDevour.blp","channel, animatedead, multi-icon, metamorphosis, stomp, tornado, ensnare, thunderclap, purge, shockwave, frostarmor, manaburn, heal, chainlightning, raisedead",'A10R',0,'Y253',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNWallOfFire.blp","fanofknives",'A1OP',0,'Y254',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNSoulBurn.blp","firebolt",'A094',0,'Y255',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDoom.blp","doom",'A0MU','A0A2','Y256',"","")
  set i=65-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNImpaleNA.blp","impale",'A0X7',0,'Y257',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNManaBurn.blp","creepheal",'A1H5',0,'Y258',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNThornShield.blp","fanofknives",'A2KO',0,'Y259',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNWindWalkOn.blp","windwalk",'A09U',0,'Y260',"","")
  set i=66-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSirenMaster.blp","berserk",'A05C',0,'Y261',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNHydraWarStomp.blp","roar",'A29K',0,'Y262',"","Slithereen Crush CD changed from 8 to 10")
  call ExBalanceOffDropper(i*4+2,'QB0I','A29K','QY0I','Y262')//[lich bs] slardar crush
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNSlardarBash.blp","passive 263, bash",'A0JJ',0,'Y263',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNAmplifyDamage.blp","faeriefire",'A0JJ','QP0V','Y263',"","Amplify Damage manacost changed from 25 -> 35/45/55")
  call ExBalanceOffDropper(i*4+4,'QB0C','A034','QY0C','Y264')//[lich bs] amplify damage
  set i=67-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNShadowStrike.blp","shadowstrike",'A0Q7',0,'Y265',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNBlink.blp","blink",0,0,0,"","Blink manacost changed from 60 to 60/70/80/90")
  call ExBalanceOffDropper(i*4+2,'QB07','A0ME','QY07','Y266')//[lich bs] akasha blink
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNPossession.blp","fanofknives",'A04A',0,'Y267',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNTornado.blp","shockwave",'A28R','A28S','Y268',"","")
  set i=68-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNClinkzStrafe.blp","berserk",'A030',0,'Y269',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSearingArrows.blp","arrows, range only, channel",'AHfa',0,'Y270',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNWindWalkOn.blp","windwalk",0,0,0,"","Windwalk (Clinkz) manacost changed from 75 to 80/90/100/110")
  call ExBalanceOffDropper(i*4+3,'QB0A','A025','QY0A','Y271')//[lich bs] ww bone
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDeathPact.blp","innerfire, trigger damage2",'A04Q',0,'Y272',"","")
  set i=69-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNTimewalk.blp","carrionswarm",'A0LK',0,'Y273',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNBacktrack.blp","passive 274",'A0CZ','QP22','Y274',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNTimelock.blp","passive 275, bash",'A081','QP0X','Y275',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNChronosphere.blp","clusterrockets, r16",'A0J1','A1D7','Y276',"","")
  set i=70-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSlowPoison.blp","arrows, range only",'A09V',0,'Y277',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNCorrosiveBreath.blp","passive 278",'A1A3','QP21','Y278',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNMagicImmunity.blp","passive 279",'A0MM','QP0Y','Y279',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNShadowStrike.blp","shadowstrike",'A080','A1UZ','Y280',"","")
  set i=71-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNPlasmaField.blp","fanofknives",'A1E7',0,'Y281',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNRazorChain.blp","tankdroppilot",'A1DP',0,'Y282',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNUnstableCurrent.blp","passive 283",'A1E6','QP0Z','Y283',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNMonsoon.blp","darkportal",'A1AO','A1UV','Y284',"","")
  set i=72-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNUnholyFrenzy.blp","unknown order 1",'A0SS','QP1W','Y286',"","Rage duration decreased from 3/4/5/6 to 2/3/4/5s")
  call ExBalanceOffDropper(i*4+1,'QB0Q','A0T2','QY0Q','Y285')//rage
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNCannibalize.blp","passive 286, agi bug 1",'A0SS','QP1W','Y286',"Feast only regenerates/deals 1.75/2.75/3.75/4.75% HP on ranged heroes.","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNGhoulFrenzy.blp","chainlightning",'A194',0,'Y287',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNOrbOfCorruption.blp","decouple",'A0SW',0,'Y288',"","")
  set i=73-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNOrbOfLightning.blp","unavatar",'A0MT',0,'Y289',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNCripple.blp","banish",'A2TD',0,'Y290',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNEntrapmentWard.blp","summongrizzly",'A09D',0,'Y291',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNLifeDrain.blp","drain",'A0CC','A02Z','Y292',"","")
  set i=74-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSummonWaterElemental.blp","acidbomb",'A046',0,'Y293',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNNagaArmorUp3.blp","passive 294",'A04E','QP10','Y294',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNAnchorSmash.blp","roar",'A226',0,'Y295',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNSeaGiantWarStomp.blp","howlofterror",'A29I',0,'Y296',"","")
  set i=75-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNCurse.blp","innerfire",'A04V',0,'Y297',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNDevourMagic.blp","chainlightning",'A0GK',0,'Y298',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNWandOfShadowSight.blp","sleep",'A04Y',0,'Y299',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNAmuletOftheWild.blp","magicleash",'A02Q','A1D9','Y300',"","")
  set i=76-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNDeathNova.blp","fanofknives",'A05V',0,'Y301',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSpell_Holy_SealOfRighteousness.blp","passive 302",'A01N','QP11','Y302',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNOrbOfCorruption.blp","passive 303",'A060','QP12','Y303',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNReapersScythe.blp","thunderbolt",'A067','A08P','Y304',"","")
  set i=77-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNImpale.blp","detectaoe",'A06I',0,'Y305',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNPlagueCloud.blp","unimmolation",'A06K',0,'Y306',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNExhumeCorpses.blp","passive 307",'A06D','QP13','Y307',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNCannibalize.blp","magicleash",'A0FL','A1CX','Y308',"","")
  set i=78-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSpell_Shadow_GatherShadows.blp","detonate",'A1P8',0,'Y309',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNEtherealFormOn.blp","passive 310",'A0ES','QP14','Y310',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNGreaterBash.blp","passive 311, bash",'A0G5','QP1X','Y311',"Greater Bash only has a 10% proc chance on ranged heroes. Has a 1.5 s cooldown.","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNNetherStrike.blp","creepheal",'A0G4','A1D8','Y312',"","")
  set i=79-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNCarrionSwarm.blp","tankloadpilot",'A1QW',0,'Y313',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNWeaverShukuchi.blp","windwalk",0,0,0,"","Shukuchi CD changed from 12/10/8/6 to 14/12/10/8")
  call ExBalanceOffDropper(i*4+2,'QB01','A0CA','QY01','Y314')//[lich bs] shukuchi
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNLocustSwarm.blp","passive 315, orb effect",'A0CG',0,'Y315',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNOrbOfFrost.blp","disassociate",'A0CT',0,'Y316',"","")
  set i=80-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNDeathCoil.blp","roar, howlofterror, battleroar, multi-icon",'A0EY',0,'Y317',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSacrificialSkull.blp","passive 318",'Z318','A0BR','Y318',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNRegenerationAura.blp","passive 319",'A0FU','QP15','Y319',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDizzy.blp","unknown order 1",'A29J',0,'Y320',"","")
  set i=81-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNImpale.blp","disenchant",'A06O',0,'Y321',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSandStorm.blp","voodoo",'A0H0',0,'Y322',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNPoisonSting.blp","passive 323, orb effect",'A0FA','QP16','Y323',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNEarthquake.blp","lightningshield",'A06R','A1B4','Y324',"","")
  set i=82-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTN_BerserkerCall.BLP","dismount",'A0I6',0,'Y325',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNIncinerate.blp","creepheal",'A0S1',0,'Y326',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNStaffOfSanctuary.blp","passive 327",'A0C6','QP17','Y327',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNOrcMeleeUpThree.blp","chainlightning",'A0E2','A1MR','Y328',"","")
  set i=83-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSpellSteal.blp","soulburn",'A0EC',0,'Y329',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNBloodBath.blp","passive 330",'A0LE','QP1Y','Y330',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNThirst.blp","passive 331",'A0I8','QP1Z','Y331',"","Thirst will detect only heroes with 35% hp or less instead of 50% or less")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNMarkOfFire.blp","shadowsight",'A0LH',0,'Y332',"","")
  set i=84-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNDeathCoil.blp","townbelloff",'A0I3',0,'Y333',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNLightningShield.blp","chainlightning",'A0MF',0,'Y334',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNIceBlade.blp","passive 335, buff placer",'A0MG','QP18','Y335',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNAnimateDead.blp","windwalk, r17",'A0NS','A1DA','Y336',"","")
  set i=85-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNAbility_Spectral_Dagger.blp","tankpilot",'A0HW',0,'Y337',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNCripplingFear.blp","passive 338",'A0FX','QP19','Y338',"Ranged Illusions only deal half of the damage","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNThickFur.blp","passive 339",'A0NA','QP20','Y339',"Dispersion disperses only 8/10/12/14% damage on STR heroes","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNHaunt.blp","healingspray, healingwave, multi-icon, r18",'A0H9',0,'Y340',"","")
  set i=86-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNAcidBomb.blp","chainlightning",'A0NM',0,'Y341',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNBigBadVoodooSpell.blp","unimmolation",'A0NE',0,'Y342',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNShadowPact.blp","renew",'A0NO',0,'Y343',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDeathWard.blp","tornado",'A0NT','A0NX','Y344',"","")
  set i=87-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNOrbOfDeathOn.blp","arrows, range only",'A0OI',0,'Y345',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSpell_Shadow_AntiShadow.blp","chainlightning",'A0OJ',0,'Y346',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNEssenceAura.blp","passive 347, r19",'A0IF','QP1A','Y347',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNSpell_Shadow_ImpPhaseShift.blp","blizzard",'A0OK','A1VW','Y348',"","")
  set i=88-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNFatalBonds.blp","autodispelon",'A0J5',0,'Y349',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSpell_Shadow_ShadowWordPain.blp","creepheal",'A0AS',0,'Y350',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNUnsummonBuilding.blp","blizzard",'A06P',0,'Y351',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNInfernal.blp","inferno, r20",'S008','S00U','Y352',"","")
  set i=89-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNEarthbind.blp","renewon",'A0NB',0,'Y353',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNDispelMagic.blp","carrionscarabsoff,",'A0N8',0,'Y354',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNGeostrike.blp","passive 355, buff placer",'A0N7','QP1B','Y355',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDividedWeStand.blp","passive 356, not work",'A0MW'*0,'A27C','Y356',"","")
  set i=90-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNINV_Wand_12.blp","thunderbolt",'A0NQ',0,'Y357',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNAnkh.blp","devourmagic",'A10L',0,'Y358',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNShadowWave.blp","darkportal",'A0OR',0,'Y359',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNSpell_Shadow_ShadowWard.blp","renewoff",'A10Q','A1DB','Y360',"","")
  set i=91-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNFire.blp","unavengerform",'A01I',0,'Y361',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNGrave.blp","flamestrike",'A0RA',0,'Y362',"","")
  call CSD(i*4+3,"ReplaceableTextures\\PassiveButtons\\PASBTNShadeTrueSight.blp","passive 363",'AIcd','QP1C','Y363',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDarkPortal.blp","divineshield, whirlwind",'A0R0',0,'Y364',"","")
  set i=92-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNDecay.blp","repair, str bug",'A15S',0,'Y365',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNHeartStopper.BLP","lumber2gold",'A0R5',0,'Y366',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNTombstone.blp","soulpreservation, r21",'A15V',0,'Y367',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNFleshGolem.blp","metamorphosis, melee morph, multi-icon, r24",'QM03',0,'Y368',"","")
  set i=93-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSpell_Shadow_Teleport.blp","repairoff",'A0QE',0,'Y369',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSpell_Shadow_Haunting.blp","autoentangle",'A0QG',0,'Y370',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNSpell_Nature_AstralRecal.blp","bloodlust",'A0R7',0,'Y371',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNWallRep.blp","manaflareon",'A0QK','A21Q','Y372',"","")
  set i=94-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNOrbOfFrost.blp","roar, not work",'A21W'*0,0,'Y373',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNOrbOfLightning.blp","fanofknives, not work",'A21X'*0,0,'Y374',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNOrbOfFire.blp","battleroar, not work",'A21V'*0,0,'Y375',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNSorceressMaster.blp","not work, howlofterror",'A21Y'*0,'A1GU','Y376',"","")
  set i=95-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNMalefice.blp","townbellon",'A0I7',0,'Y377',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTN_Conversion.BLP","autoentangleinstant",'A180',0,'Y378',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNDeathAndDecay.blp","not work, load",'A0B1',0,'Y379',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNGenericSpellImmunity.blp","cannibalize",'A1BX','A30L','Y380',"","")
  set i=96-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNLocustSwarm.blp","repairon",'A1EL',0,'Y381',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNFlamebreak.blp","autoharvestgold",'A19V',0,'Y382',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNFirefly.blp","metamorphosis, range morph, r3",'QM04',0,'Y383',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNMagicLariet.blp","chainlightning",'A19O',0,'Y384',"","")
  set i=97-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNColdFeet.blp","etherealform",'A1MG',0,'Y385',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNIceVortex.blp","replenish",'A1HS',0,'Y386',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNChillingTouch.blp","berserk",'A1HQ',0,'Y387',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNIceBlast.blp","taunt, fanofknives, r22",'A1MI','A2QE','Y388',"","")
  set i=98-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNOrbOfDarkness.blp","fanofknives",'A1IM',0,'Y389',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNQuillSpray.blp","farsight",'A1J7',0,'Y390',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNScatterRockets.blp","passive 391, abuz agi, agi bug 1",'A1HR','QP1F','Y391',"Essence Shift only works on 2/3 the attacks for ranged heroes.","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNShadowDance.blp","windwalk, ibug",'A1IN',0,'Y392',"","")
  set i=99-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSoulSteal.blp","replenishoff",'A2KZ',0,'Y393',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNConjure.blp","board",'A0H4',0,'Y394',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNMetamorphosis.blp","metamorphosis, range morph, chemicalrage",'A1RI',0,'Y395',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNSunder.blp","cripple",'A07Q',0,'Y396',"","")
  set i=100-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNEarthquake.blp","requestsacrifice",0,0,0,"","Split Earth CD changed from 9 to 11")
  call ExBalanceOffDropper(i*4+1,'QB0F','Z397','QY0F','Y397')//[lich bs] split earth
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNGuldanSkull.blp","fanofknives",'A20T',0,'Y398',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNLeshLightStorm.blp","chainlightning",'A06V',0,'Y399',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\PASBTNShadeTrueSight.blp","berserk",'A21F','A21G','Y400',"","")
  set i=101-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNPicture12.blp","chainlightning",'A1S8',0,'Y401',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSoulCatcher.blp","replenishon",'A1SB',0,'Y402',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNShadowPoison.blp","fingerofdeath, flare, multi-icon",'A1S4',0,'Y403',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDemonicPurge.blp","blizzard",'A343',0,'Y404',"","")
  set i=102-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNGlacier.blp","frostnova",'A07F',0,'Y405',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNFrostArmor.blp","frostarmor",'A08R',0,'Y406',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNDarkRitual.blp","innerfire",'A053',0,'Y407',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNBreathOfFrost.blp","sleep",'A05T','A08H','Y408',"","")
  set i=103-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNCarrionSwarm.blp","carrionswarm",0,0,0,"","Carrion Swarm CD changed from 4 to 6")
  call ExBalanceOffDropper(i*4+1,'QB06','A078','QY06','Y409')//[lich bs] swarm
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSilence.blp","silence",'A07M'+('A0P6'*0),0,'Y410',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNKrobWitchcraft.blp","passive 411, not work",'A02C'*0,0,'Y411',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNExorcism.blp","tornado",'A04N'+('A073'*0),0,'Y412',"","")
  set i=104-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNImpale.blp","freezingbreath",'A0X5',0,'Y413',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNHex.blp","hex",'A0MN',0,'Y414',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNManaDrain.blp","drain",'A02N',0,'Y415',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNCorpseExplode.blp","chainlightning",'A095','A09W','Y416',"","")
  set i=105-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNOrbOfVenom.blp","magicdefense",'A173',0,'Y417',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNEnvenomedSpear.blp","passive 418, buff placer",'A0MY','QP1D','Y418',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNVenomWards.blp","ward",'A0MS',0,'Y419',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNCorrosiveBreath.blp","summongrizzly",'A013','A0A6','Y420',"","")
  set i=106-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNShockWave.blp","shockwave",'A02S',0,'Y421',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNEmpower.blp","innerfire",'A037',0,'Y422',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNSkewer.blp","carrionswarm",'A1RD',0,'Y423',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNReversePolarity.blp","roar",'A29L',0,'Y424',"","")
  set i=107-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNAbsorbMagic.blp","cripple",'A08X',0,'Y425',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSoulAssumption.blp","creepheal, multi-icon",'A1NA',0,'Y426',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNAntiMagicShell.blp","passive 427",'A0VX','QP23','Y427',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNGargoyle.blp","fanofknives",'A1NE','A2IG','Y428',"","")
  set i=108-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNChaosBolt.blp","tankpilot",0,0,0,"","Chaos Bolt CD changed from 10 to 12")
  call ExBalanceOffDropper(i*4+1,'QB00','A055','QY00','Y429')//[lich bs] chaos bolt
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNRealityRift.blp","forceboard",'A0RW',0,'Y430',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNCriticalStrikeCK.blp","passive 431",'A03N','QP1E','Y431',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNPhantasm.blp","mirrorimage",'A03O',0,'Y432',"","")
  set i=109-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNArcticSiege.blp","stomp, range morph, r44, metamorphosis",'A332',0,'Y437',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNSplinterBlast.blp","unstoneform",'A2LA',0,'Y438',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNColdEmbrace.blp","townbellon",'A2LB',0,'Y439',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNWintersCurse.blp","unwindwalk",'A0Z0',0,'Y440',"","")
  set i=110-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNPurge.blp","unravenform",'A2M1',0,'Y433',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNMagneticField.blp","unrobogoblin",'A2LM',0,'Y434',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNSparkWraith.blp","undeadbuild",'A2LL',0,'Y435',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNTempestDouble.blp","not work",'A2M0'*0,0,'Y436',"","")//"not work, metamorphosis,summongrizzly"
  set i=111-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNBoulderSmash.blp","cripple, multi-icon",'A2QM',0,'Y443',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNRollingBoulder.blp","unsubmerge, multi-icon",'A2TJ',0,'Y444',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNScourgeBuild.blp","unflamingarrows, multi-icon",'A2QI',0,'Y445',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNMagnetize.blp","summonwareagle, multi-icon",'A2TI',0,'Y446',"","")
  set i=112-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNFortunesEnd.blp","webon",'A2QT',0,'Y453',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNFatesEdict.blp","chainlightning",'A2T5',0,'Y454',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNPurifyingFlames.blp","avengerform",0,0,0,"","Purifying Flames cooldown increased from 3 to 4")
  call ExBalanceOffDropper(i*4+3,'QB0O','A2SG','QY0O','Y455')//[lich bs]Purifying Flames
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNFalsePromise.blp","lavamonster",0,0,0,"","False Promise cooldown increased to 40/35/30 and duration decreased to 5/6/7")
  call ExBalanceOffDropper(i*4+4,'QB11','A2TF','QY0S','Y456')//[lich bs]False Promise
  // fire invoker
  set i=114-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSunstrike.blp","request_hero, r23",'Z601',0,'Y601',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNFireRocks.blp","mechanicalcritter",'Z602',0,'Y602',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNLavaSpawn.blp","militia",'Z603',0,'Y603',"","")
  call CSD(i*4+4,"","not work",0,0,0,"","")
  // water invoker
  set i=115-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNLament.blp","militiaconvert",'Z604',0,'Y604',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNManaShield.blp","windwalk",'Z605',0,'Y605',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNFreezingBreath.blp","militiaoff",'Z606',0,'Y606',"","")
  call CSD(i*4+4,"","not work",0,0,0,"","")
  //wex invoker
  set i=116-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNAnimalWarTraining.blp","militiaunconvert",'Z607',0,'Y607',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNInvokeTornado.blp","mindrot",'Z608',0,'Y608',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNEMP.blp","monsoon",'Z609',0,'Y609',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNScatterRockets.blp","mount",'Z610',0,'Y610',"","")
  set i=117-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNPoisonAbility66.blp","tranquility",'A32A',0,'A32T',"","")
  call CSD(i*4+2,"ReplaceableTextures\\CommandButtons\\BTNMammothStomp.blp","curse",'A32C',0,'A32U',"","")
  call CSD(i*4+3,"ReplaceableTextures\\CommandButtons\\BTNDevour.blp","eattree, controlmagic",'A32E',0,'A32V',"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNDrum.blp","absorb",'A32G',0,'A32W',"","")
  
  set i=118-1
  call CSD(i*4+1,"ReplaceableTextures\\CommandButtons\\BTNSoulSteal.blp","acidbomb",'A1PH',0,'Y458',"","")
  call CSD(i*4+2,"ReplaceableTextures\\PassiveButtons\\PASBTNBansheeAdept.blp","passive 400",'A33Q','A33R','Y459',"","")
  call CSD(i*4+3,"","not work",0,0,0,"","")
  call CSD(i*4+4,"ReplaceableTextures\\CommandButtons\\BTNLightningGrapple.blp","barkskinoff",'A33U',0,'Y460',"","")
  if Mode_SD or Mode_MD then
    call ExecuteFunc("RollSpellsForInvokerSD")
  endif
endfunction

function InitInvokerSpells takes nothing returns nothing
  local integer i=1
  local integer i1
  local integer i2
  local integer i3
  local integer i4
  local integer t
  loop
    //call PreloadAbility(SkillID[600+i])
    set i=i+1
    exitwhen i>10
  endloop
  set i=1
  loop
    set i1=GetRandomInt(1,10)
    loop
      set i2=GetRandomInt(1,10)
      exitwhen i1!=i2
    endloop
    loop
      set i3=GetRandomInt(1,10)
      exitwhen i1!=i3 and i2!=i3
    endloop
    loop
      set i4=GetRandomInt(1,10)
      exitwhen i1!=i4 and i2!=i4 and i3!=i4
    endloop
    if i1>i2 then
      set t=i1
      set i1=i2
      set i2=t
    endif
    if i1>i3 then
      set t=i1
      set i1=i3
      set i3=t
    endif
    if i1>i4 then
      set t=i1
      set i1=i4
      set i4=t
    endif
    if i2>i3 then
      set t=i2
      set i2=i3
      set i3=t
    endif
    if i2>i4 then
      set t=i2
      set i2=i4
      set i4=t
    endif
    if i3>i4 then
      set t=i3
      set i3=i4
      set i4=t
    endif
    set InvokerSkill[i*4+1]=600+i1
    set InvokerSkill[i*4+2]=600+i2
    set InvokerSkill[i*4+3]=600+i3
    set InvokerSkill[i*4+4]=600+i4
    set i=i+1
    exitwhen i>11
  endloop
endfunction

function SA8 takes real SB8 returns nothing
  local real SC8
  local real st=TimerGetElapsed(PB8)
  if st<=0 then
    set PB8=CreateTimer()
    call TimerStart(PB8,1000000,false,null)
  endif
  if(SB8>0)then
    loop
      set SC8=SB8-TimerGetElapsed(PB8)+st
      exitwhen SC8<=0
      if(SC8>bj_POLLED_WAIT_SKIP_THRESHOLD)then
        call TriggerSleepAction(.1*SC8)
      else
        call TriggerSleepAction(bj_POLLED_WAIT_INTERVAL)
      endif
    endloop
  endif
endfunction

function S38 takes location S68,real SL8,real S18 returns location
  return Location(GetLocationX(S68)+SL8*Cos(S18*bj_DEGTORAD),GetLocationY(S68)+SL8*Sin(S18*bj_DEGTORAD))
endfunction

function S08 takes nothing returns boolean
  local real dx=GetDestructableX(GetFilterDestructable())-.0
  local real dy=GetDestructableY(GetFilterDestructable())-.0
  return(dx*dx+dy*dy<=bj_enumDestructableRadius)
endfunction

function S58 takes player whichPlayer returns force
  set P68=CreateForce()
  call ForceEnumEnemies(P68,whichPlayer,PL8)
  return P68
endfunction

function T48 takes itemtype T78,integer T88 returns nothing
  local group g
  set bj_stockPickedItemType=T78
  set bj_stockPickedItemLevel=T88
  set g=CreateGroup()
  call GroupEnumUnitsOfType(g,"marketplace",PL8)
  call ForGroup(g,function UpdateEachStockBuildingEnum)
  call DestroyGroup(g)
  set g=null
endfunction

function T98 takes nothing returns nothing
  local integer pickedItemId
  local itemtype TD8
  local integer TE8=0
  local integer TF8=0
  local integer T88
  set T88=1
  loop
    if(bj_stockAllowedPermanent[T88])then
      set TF8=TF8+1
      if(GetRandomInt(1,TF8)==1)then
        set TD8=ITEM_TYPE_PERMANENT
        set TE8=T88
      endif
    endif
    if(bj_stockAllowedCharged[T88])then
      set TF8=TF8+1
      if(GetRandomInt(1,TF8)==1)then
        set TD8=ITEM_TYPE_CHARGED
        set TE8=T88
      endif
    endif
    if(bj_stockAllowedArtifact[T88])then
      set TF8=TF8+1
      if(GetRandomInt(1,TF8)==1)then
        set TD8=ITEM_TYPE_ARTIFACT
        set TE8=T88
      endif
    endif
    set T88=T88+1
    exitwhen T88>10
  endloop
  if(TF8==0)then
    set TD8=null
    return
  endif
  call T48(TD8,TE8)
  set TD8=null
endfunction

function TG8 takes nothing returns nothing
  call T98()
  call TimerStart(bj_stockUpdateTimer,bj_STOCK_RESTOCK_INTERVAL,true,function T98)
endfunction

function ReturnTrue1 takes nothing returns boolean
  return true
endfunction

function TI8 takes nothing returns nothing
  call DisplayTimedTextToPlayer(GetEnumPlayer(),0,group008,real081,string044)
endfunction

function ReturnTrue2 takes nothing returns boolean
  return true
endfunction

function InitializeHashtable takes nothing returns nothing
  set hashtable019=InitHashtable()
endfunction

function HLC_GetCommandString takes nothing returns string
  return HCLstring
endfunction

function TK8 takes nothing returns nothing
  local integer i
  local integer j
  local integer h
  local integer v
  local string TM8="abcdefghijklmnopqrstuvwxyz0123456789 -=,."
  local integer array TN8
  local boolean array TO8
  set TO8[0]=true
  set TO8[50]=true
  set TO8[60]=true
  set TO8[70]=true
  set TO8[80]=true
  set TO8[90]=true
  set TO8[100]=true
  set i=0
  set j=0
  loop
    if TO8[j]then
      set j=j+1
    endif
    exitwhen j>=256
    set TN8[j]=i
    set i=i+1
    set j=j+1
  endloop
  set i=0
  loop
    exitwhen i>=12
    set h=R2I(100*GetPlayerHandicap(Player(i)))
    if not TO8[h]then
      set h=TN8[h]
      set v=h/ 6
      set h=h-v*6
      call SetPlayerHandicap(Player(i),1)
      set HCLstring=HCLstring+SubString(TM8,v,v+1)
    endif
    set i=i+1
  endloop
endfunction

function TP8 takes multiboard TQ8,integer c,integer r,string TR8 returns nothing
  local multiboarditem mbitem=null
  set mbitem=MultiboardGetItem(TQ8,r-1,c-1)
  call MultiboardSetItemValue(mbitem,TR8)
  call MultiboardReleaseItem(mbitem)
  set mbitem=null
endfunction

function TT8 takes multiboard TQ8,integer c,integer r,string TU8 returns nothing
  local multiboarditem mbitem=null
  set mbitem=MultiboardGetItem(TQ8,r-1,c-1)
  call MultiboardSetItemIcon(mbitem,TU8)
  call MultiboardReleaseItem(mbitem)
  set mbitem=null
endfunction

function TV8 takes multiboard TQ8,integer c,integer r,boolean TW8,boolean TX8 returns nothing
  local multiboarditem mbitem=null
  set mbitem=MultiboardGetItem(TQ8,r-1,c-1)
  call MultiboardSetItemStyle(mbitem,TW8,TX8)
  call MultiboardReleaseItem(mbitem)
  set mbitem=null
endfunction

function TY8 takes multiboard TQ8,integer c,integer r,real TZ8,real TA8,real TB8,real TC8 returns nothing
  local multiboarditem mbitem=null
  set mbitem=MultiboardGetItem(TQ8,r-1,c-1)
  call MultiboardSetItemValueColor(mbitem,PercentTo255(TZ8),PercentTo255(TA8),PercentTo255(TB8),PercentTo255(100.-TC8))
  call MultiboardReleaseItem(mbitem)
  set mbitem=null
endfunction

function T38 takes multiboard TQ8,integer c,integer r,real T68 returns nothing
  local multiboarditem mbitem=null
  set mbitem=MultiboardGetItem(TQ8,r-1,c-1)
  call MultiboardSetItemWidth(mbitem,T68/ 100)
  call MultiboardReleaseItem(mbitem)
  set mbitem=null
endfunction

function TI_RequestBugReport takes nothing returns nothing
  local integer i=0
  if GameEnded==false and ZN7==false then
    loop
      call DisplayTimedTextToPlayer(Player(i),0,0,120,"|c00ff0303An internal index has failed|r")
      call DisplayTimedTextToPlayer(Player(i),0,0,120,"|c00ff0303This might not be a serious glitch, but it is important for me to get it|r")
      call DisplayTimedTextToPlayer(Player(i),0,0,120,"|c00ff0303Please send me the replay for this game to ResQLoD@gmail.com|r")
      set i=i+1
      exitwhen i==12
    endloop
  endif
endfunction

function UnitAsInteger_Clear takes integer i returns nothing
  if i>16000 then
    set XY[i-16000]=null
  elseif i>8000 then
    set WY[i-8000]=null
  else
    set VY[i]=null
  endif
endfunction

function UnitAsInteger_Load takes integer i returns unit
  if i>16000 then
    return XY[i-16000]
  elseif i>8000 then
    return WY[i-8000]
  else
    return VY[i]
  endif
endfunction

function T08 takes integer i returns destructable
  if i>16000 then
    return destructables003[i-16000]
  elseif i>8000 then
    return destructables002[i-8000]
  else
    return destructables001[i]
  endif
  return destructables001[i]
endfunction

function UnitAsInteger_Save takes unit u returns integer
  set YY=YY+1
  if YY>16000 then
    set XY[YY-16000]=u
  elseif YY>8000 then
    set WY[YY-8000]=u
  else
    set VY[YY]=u
  endif
  return YY
endfunction

function T28 takes integer i returns nothing
  if i>16000 then
    set destructables003[i-16000]=null
  elseif i>8000 then
    set destructables002[i-8000]=null
  else
    set destructables001[i]=null
  endif
endfunction

function U48 takes destructable d returns integer
  set integer546=integer546+1
  if integer546>24000 then
    set destructables003[integer546-16000]=d
  elseif integer546>8000 then
    set destructables002[integer546-8000]=d
  else
    set destructables001[integer546]=d
  endif
  return integer546
endfunction

function GetTime takes nothing returns real
  return TimerGetElapsed(GlobalTimer)
endfunction

function IsBlocked takes unit u returns boolean
  return GetUnitAbilityLevel(u,'B0BI')>0 or GetUnitAbilityLevel(u,'BNss')>0 or GetUnitAbilityLevel(u,'B0EV')>0
endfunction

function KillGroup takes group g returns nothing
  local integer i=GetHandleId(g)-TY
  if i<0 or i>120 then
    set PY=true
  else
    call GroupClear(g)
    set SY[i]=false
    set RY=i
  endif
endfunction

function GetAvailableGroup takes nothing returns group
  local integer i=RY
  loop
    exitwhen i==RY-1
    if SY[i]==false then
      set RY=i+1
      if RY==120 then
        set RY=0
      endif
      set SY[i]=true
      return NY[i]
    endif
    set i=i+1
    if i==120 then
      set i=0
    endif
  endloop
  return CreateGroup()
endfunction

function UD8 takes nothing returns boolean
  local integer Count=0
  local integer i=0
  loop
    exitwhen i==120
    if SY[i] then
      set Count=Count+1
    endif
    set i=i+1
  endloop
  if Count>100 or PY then
  endif
  return false
endfunction

function UF8 takes nothing returns nothing
  local integer i=0
  set RY=0
  set NY[i]=CreateGroup()
  set SY[i]=false
  set i=i+1
  set TY=GetHandleId(NY[0])
  loop
    exitwhen i==120
    set NY[i]=CreateGroup()
    set SY[i]=false
    set i=i+1
  endloop
endfunction

function UG8 takes nothing returns nothing
  local integer i=0
  if GameEnded==false and ZN7==false then
    loop
      //call DisplayTimedTextToPlayer(Player(i),0,0,120,"|")
      call DisplayTimedTextToPlayer(Player(i),0,0,120,"|c00ff0303An internal checksum has failed|r")
      call DisplayTimedTextToPlayer(Player(i),0,0,120,"|c00ff0303This might not be a serious glitch, but it is important for me to get it|r")
      //call DisplayTimedTextToPlayer(Player(i),0,0,120,"|c00ff0303Please send me the replay for this game to IceFrog@gmail.com|r")
      set i=i+1
      exitwhen i==12
    endloop
  endif
endfunction

function CleanTrigger_GetTime takes nothing returns real
  return TimerGetElapsed(GlobalTimer)
endfunction

function CleanTrigger takes trigger t returns nothing
  call DisableTrigger(t)
  set IJ=IJ+1
  set QY[IJ]=t
  set UY[IJ]=(TimerGetElapsed(GlobalTimer))+60
  if IJ>8000 then
    call UG8()
  endif
endfunction

function UI8 takes integer i returns nothing
  if i!=IJ then
    set QY[i]=QY[IJ]
    set UY[i]=UY[IJ]
  endif
  set QY[IJ]=null
  set UY[IJ]=0
  set IJ=IJ-1
endfunction

function UJ8 takes nothing returns boolean
  local real UK8=(TimerGetElapsed(GlobalTimer))
  local integer i
  set i=1
  loop
    exitwhen i>IJ
    if UY[i]<UK8 then
      if QY[i]==null or IsTriggerEnabled(QY[i]) then
        call UG8()
      else
        call DestroyTrigger(QY[i])
      endif
      call UI8(i)
    else
      set i=i+1
    endif
  endloop
  return false
endfunction

function UM8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  call SaveInteger(hashtable019,(GetHandleId(((LoadTriggerHandle(hashtable019,(Cache),(35)))))),(((LoadInteger(hashtable019,(Cache),(33))))),(2))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function AddTimedKeyForTrigger takes trigger t,integer UP8,real SB8 returns nothing
  local trigger t2=CreateTrigger()
  call TriggerAddCondition(t2,Condition(function UM8))
  call TriggerRegisterTimerEvent(t2,SB8,false)
  call SaveInteger(hashtable019,(GetHandleId((t))),((UP8)),(1))
  call SaveTriggerHandle(hashtable019,(GetHandleId(t2)),(35),(t))
  call SaveInteger(hashtable019,(GetHandleId(t2)),(33),(UP8))
  set t2=null
endfunction

function UQ8 takes unit u returns string
  if u==null then
    return GetObjectName('n09T')
  endif
  if GetUnitPointValue(u)==120 then
    return"Formless"
  elseif GetUnitPointValue(u)==111 then
    return"Earth Spirit"
  elseif GetUnitPointValue(u)==112 then
    return"Oracle"
  elseif GetUnitPointValue(u)==117 then
    return"Chakk"
  endif
  return GetObjectName(HeroCMDummy[GetUnitPointValue(u)])
endfunction

function UR8 takes integer i returns string
  if i==0 then
    return GetObjectName('n09T')
  endif
  return GetObjectName(HeroCMDummy[i])
endfunction

function US8 takes unit u returns string
  if u==null then
    return EmptySlotPath
  endif
  return HeroIcon[LoadInteger(hashtable019,GetPlayerId(GetOwningPlayer(u)),'hHid')]
endfunction

function UT8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  call SaveInteger(hashtable019,(GetHandleId(((LoadUnitHandle(hashtable019,(Cache),(14)))))),(((LoadInteger(hashtable019,(Cache),(33))))),(2))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function AddTimedKeyToUnit takes unit UV8,integer UP8,real SB8 returns nothing
  local trigger t=CreateTrigger()
  call TriggerAddCondition(t,Condition(function UT8))
  call TriggerRegisterTimerEvent(t,SB8,false)
  call SaveInteger(hashtable019,(GetHandleId((UV8))),((UP8)),(1))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(UV8))
  call SaveInteger(hashtable019,(GetHandleId(t)),(33),(UP8))
  set t=null
endfunction

function GetUnitPrimaryAttribute takes unit Hero returns integer
  //1 == int
  //2 == agi
  //3 == str
  local integer x
  local integer id=GetUnitTypeId(Hero)
  set x=1
  loop
    exitwhen x>AgilityHeroesAmount
    if id==AgiHeroesArray[x]then
      return 2
    endif
    set x=x+1
  endloop
  set x=1
  loop
    exitwhen x>StrHeroesAmount
    if id==StrHeroesArray[x]then
      return 3
    endif
    set x=x+1
  endloop
  set x=1
  loop
    exitwhen x>IntHeroesAmount
    if id==IntHeroesArray[x]then
      return 1
    endif
    set x=x+1
  endloop
  if id=='Eevm' or id=='E02V' or id=='E02W' or id=='E02U' or id=='N02B' or id=='N017' or id=='H08D' or id=='H08C' or id=='H084' or id=='H08B' or id=='N013' or id=='N014' or id=='N015' or id=='E02O' or id=='QTW2' or id=='QTW3' then
    return 2
  endif
  if id=='N01H' or id=='N01T' or id=='N01J' or id=='H600' or id=='H601' or id=='H602' or id=='H00E' or id=='H00G' or id=='H00F' or id=='H07I' or id=='E015' or id=='H0CQ' or id=='H0E3' or id=='H0E4' or id=='H0E5' or id=='U01X' or id=='N0MB' or id=='N0MC' or id=='N0MO' or id=='N0MA'then
    return 3
  endif
  if id=='H06X' or id=='H06Y' or id=='H06W' or id=='H0BC' or id=='O017' or id=='N0M7' or id=='N0MA' or id=='N0MB' or id=='N0MC' or id=='N0MO' then
    return 1
  endif
  return 0
endfunction

function GetHeroMainStatValue takes unit Hero returns integer
  local integer UZ8=GetUnitPrimaryAttribute(Hero)
  if UZ8==1 then
    return GetHeroInt(Hero,true)
  endif
  if UZ8==2 then
    return GetHeroAgi(Hero,true)
  endif
  if UZ8==3 then
    return GetHeroStr(Hero,true)
  endif
  return 0
endfunction

function UA8 takes unit whichUnit returns boolean
  return GetUnitState(whichUnit,UNIT_STATE_LIFE)<1 or IsHeroDead[GetPlayerId(GetOwningPlayer(whichUnit))]
endfunction

function SaveUnitModelScale takes integer U38,real U68,integer UL8 returns nothing
  set DJ=DJ+1
  set AJ[DJ]=U68
  set BJ[DJ]=U38
  set CJ[DJ]=UL8
endfunction

function U18 takes unit u returns real
  local integer U38=GetUnitTypeId(u)
  local integer i=1
  loop
    exitwhen i>DJ
    if BJ[i]==U38 or CJ[i]==U38 then
      return AJ[i]
    endif
    set i=i+1
  endloop
  return 1.
endfunction

function SaveUnitWinAnimation takes integer U58,string U28 returns nothing
  set integer550=integer550+1
  set strings019[integer550]=U28
  set integers127[integer550]=U58
endfunction

function V48 takes unit u returns string
  local integer U58=GetUnitTypeId(u)
  local integer i=1
  loop
    exitwhen i>integer550
    if integers127[i]==U58 then
      return strings019[i]
    endif
    set i=i+1
  endloop
  return"stand"
endfunction

function V78 takes unit u returns nothing
  if GetUnitTypeId(u)=='N01I' then
    call SetUnitAnimationByIndex(u,6)
  else
    call SetUnitAnimation(u,V48(u))
  endif
endfunction

function V88 takes player p returns integer
  local integer i
  set i=1
  if p==Sentinels[i]or p==Scourges[i]then
    return i
  endif
  set i=2
  if p==Sentinels[i]or p==Scourges[i]then
    return i
  endif
  set i=3
  if p==Sentinels[i]or p==Scourges[i]then
    return i
  endif
  set i=4
  if p==Sentinels[i]or p==Scourges[i]then
    return i
  endif
  set i=5
  if p==Sentinels[i]or p==Scourges[i]then
    return i
  endif
  return 0
endfunction

function IsSentinel takes player VD8 returns boolean
  return(VD8==Sentinels[0])or(VD8==Sentinels[1])or(VD8==Sentinels[2])or(VD8==Sentinels[3])or(VD8==Sentinels[4])or(VD8==Sentinels[5])
endfunction

function IsScourge takes player VD8 returns boolean
  return(VD8==Scourges[0])or(VD8==Scourges[1])or(VD8==Scourges[2])or(VD8==Scourges[3])or(VD8==Scourges[4])or(VD8==Scourges[5])
endfunction

function IsPlayerBelongToTeams takes player p returns boolean
  return p==Sentinels[1]or p==Sentinels[2]or p==Sentinels[3]or p==Sentinels[4]or p==Sentinels[5]or p==Scourges[1]or p==Scourges[2]or p==Scourges[3]or p==Scourges[4]or p==Scourges[5]
endfunction

function VI8 takes player p returns boolean
  if(GetPlayerSlotState(p)==PLAYER_SLOT_STATE_PLAYING or GetPlayerSlotState(p)==PLAYER_SLOT_STATE_LEFT)then
    if(GetPlayerController(p)==MAP_CONTROL_USER)then
      return true
    endif
  endif
  return false
endfunction

function IsPlayerLeaver takes player p returns boolean
  if GetPlayerSlotState(p)==PLAYER_SLOT_STATE_LEFT then
    if(GetPlayerController(p)==MAP_CONTROL_USER)then
      return true
    endif
  endif
  return false
endfunction

function CountPlayersInForceSub takes nothing returns nothing
  if(IsPlayer(GetEnumPlayer()))then
    set bj_forceCountPlayers=bj_forceCountPlayers+1
  endif
endfunction

function CountPlayersInForce takes force f returns integer
  set bj_forceCountPlayers=0
  call ForForce(f,function CountPlayersInForceSub)
  return bj_forceCountPlayers
endfunction

function CountHumanPlayers takes nothing returns nothing
  if GetPlayerSlotState(GetEnumPlayer())==PLAYER_SLOT_STATE_LEFT or GetPlayerSlotState(GetEnumPlayer())==PLAYER_SLOT_STATE_PLAYING then
    set bj_forceCountPlayers=bj_forceCountPlayers+1
  endif
endfunction

function VN8 takes nothing returns nothing
  if GetPlayerSlotState(GetEnumPlayer())==PLAYER_SLOT_STATE_PLAYING then
    if GetEnumPlayer()!=Player(13)and GetEnumPlayer()!=Player(14)then
      set bj_forceCountPlayers=bj_forceCountPlayers+1
    endif
  endif
endfunction

function VO8 takes force f returns integer
  set bj_forceCountPlayers=0
  call ForForce(f,function VN8)
  return bj_forceCountPlayers
endfunction


function Id2S takes integer value returns string
  local string charMap = ".................................!.#$%&'()*+,-./0123456789:;<=>.@ABCDEFGHIJKLMNOPQRSTUVWXYZ[.]^_`abcdefghijklmnopqrstuvwxyz{|}~................................................................................................................................."
  local string result = ""
  local integer remainingValue = value
  local integer charValue
  local integer byteno
  
  set byteno = 0
  loop
    set charValue = ModuloInteger(remainingValue, 256)
    set remainingValue = remainingValue / 256
    set result = SubString(charMap, charValue, charValue + 1) + result
    
    set byteno = byteno + 1
    exitwhen byteno == 4
  endloop
  return result
endfunction

function myhook2 takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  call SetPlayerTechMaxAllowed(Player(LoadInteger(hashtable019,GetHandleId(t),0)),LoadInteger(hashtable019,GetHandleId(t),1),LoadInteger(hashtable019,GetHandleId(t),2))
endfunction

function myhook takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerAddCondition(t,Condition(function myhook2))
  call TriggerRegisterTimerEvent(t,1,false)
  call SaveInteger(hashtable019,GetHandleId(t),0,GetPlayerId(TempPlayer_OnRandom))
  call SaveInteger(hashtable019,GetHandleId(t),1,TempInteger)
  call SaveInteger(hashtable019,GetHandleId(t),2,tt_int1)
  set t=null
  call echo(I2S(GetPlayerId(TempPlayer_OnRandom))+" - "+Id2S(TempInteger)+" ("+GetObjectName(TempInteger)+") - "+I2S(tt_int1))
  
endfunction

function SetPlayerTechMaxAllowedHook takes player p, integer id, integer amount returns nothing
  set TempInteger=id
  set TempPlayer_OnRandom=p
  set tt_int1=amount
  call ExecuteFunc("myhook")
  
  //call echo(I2S(GetPlayerId(p))+" - "+Id2S(id)+" ("+GetObjectName(id)+") - "+I2S(amount))
  call SetPlayerTechMaxAllowed(p,id,amount)
endfunction

function RemoveHeroFromTavernForPlayer takes integer hid,player p returns nothing
  if NoHeroLimitOff then
    call SetPlayerTechMaxAllowed(p,hid,0)
    set b_isHeroPicked[GetUnitPointValueByType(hid)]=true
  endif
endfunction

function TechHeroForAll takes integer hid returns nothing
  call RemoveHeroFromTavernForPlayer(hid,Sentinels[1])
  call RemoveHeroFromTavernForPlayer(hid,Sentinels[2])
  call RemoveHeroFromTavernForPlayer(hid,Sentinels[3])
  call RemoveHeroFromTavernForPlayer(hid,Sentinels[4])
  call RemoveHeroFromTavernForPlayer(hid,Sentinels[5])
  call RemoveHeroFromTavernForPlayer(hid,Scourges[1])
  call RemoveHeroFromTavernForPlayer(hid,Scourges[2])
  call RemoveHeroFromTavernForPlayer(hid,Scourges[3])
  call RemoveHeroFromTavernForPlayer(hid,Scourges[4])
  call RemoveHeroFromTavernForPlayer(hid,Scourges[5])
endfunction

function VR8 takes integer hid returns nothing
  if NoHeroLimitOff then
    call SetPlayerTechMaxAllowed(Sentinels[1],hid,0)
    call SetPlayerTechMaxAllowed(Sentinels[2],hid,0)
    call SetPlayerTechMaxAllowed(Sentinels[3],hid,0)
    call SetPlayerTechMaxAllowed(Sentinels[4],hid,0)
    call SetPlayerTechMaxAllowed(Sentinels[5],hid,0)
    call SetPlayerTechMaxAllowed(Scourges[1],hid,0)
    call SetPlayerTechMaxAllowed(Scourges[2],hid,0)
    call SetPlayerTechMaxAllowed(Scourges[3],hid,0)
    call SetPlayerTechMaxAllowed(Scourges[4],hid,0)
    call SetPlayerTechMaxAllowed(Scourges[5],hid,0)
  endif
endfunction

function VS8 takes player p returns nothing
  local integer VT8=FirstSentinelHeroIndexid
  local integer VU8=LastSentinelHeroIndexid
  if NoHeroLimitOff then
    loop
      exitwhen VT8>VU8
      call SetPlayerTechMaxAllowed(p,HeroID[VT8],0)
      set VT8=VT8+1
    endloop
    set VT8=FirstScourgeHeroIndexid
    set VU8=LastScourgeHeroIndexid
    loop
      exitwhen VT8>VU8
      call SetPlayerTechMaxAllowed(p,HeroID[VT8],0)
      set VT8=VT8+1
    endloop
    //call SetPlayerTechMaxAllowed(p,HeroID[117],0)   //temporal fix for formless
  endif
endfunction

function TechAll takes nothing returns nothing
  call VS8(Sentinels[1])
  call VS8(Sentinels[2])
  call VS8(Sentinels[3])
  call VS8(Sentinels[4])
  call VS8(Sentinels[5])
  call VS8(Scourges[1])
  call VS8(Scourges[2])
  call VS8(Scourges[3])
  call VS8(Scourges[4])
  call VS8(Scourges[5])
endfunction

function VW8 takes nothing returns nothing
  local integer i
  if NoHeroLimitOff then
    set i=FirstScourgeHeroIndexid
    loop
      exitwhen i>LastScourgeHeroIndexid
      call SetPlayerTechMaxAllowed(Sentinels[1],HeroID[i],0)
      call SetPlayerTechMaxAllowed(Sentinels[2],HeroID[i],0)
      call SetPlayerTechMaxAllowed(Sentinels[3],HeroID[i],0)
      call SetPlayerTechMaxAllowed(Sentinels[4],HeroID[i],0)
      call SetPlayerTechMaxAllowed(Sentinels[5],HeroID[i],0)
      set i=i+1
    endloop
    set i=FirstSentinelHeroIndexid
    loop
      exitwhen i>LastSentinelHeroIndexid
      call SetPlayerTechMaxAllowed(Scourges[1],HeroID[i],0)
      call SetPlayerTechMaxAllowed(Scourges[2],HeroID[i],0)
      call SetPlayerTechMaxAllowed(Scourges[3],HeroID[i],0)
      call SetPlayerTechMaxAllowed(Scourges[4],HeroID[i],0)
      call SetPlayerTechMaxAllowed(Scourges[5],HeroID[i],0)
      set i=i+1
    endloop
    call VR8(HeroID[113]) //temporal fix for formless 
  endif
endfunction

function IsEnemyCreepCond takes nothing returns boolean
  return IsUnitAlly(GetFilterUnit(),GetOwningPlayer(TmpUnit376))and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>0 and(GetOwningPlayer(GetFilterUnit())==Sentinels[0])or(GetOwningPlayer(GetFilterUnit())==Scourges[0])
endfunction

function VX8 takes nothing returns nothing
  local integer i
  local integer k
  local integer a=0
  //set ZO=FirstSentinelHeroIndexid
  set i=FirstSentinelHeroIndexid
  set k=LastSentinelHeroIndexid
  loop
    exitwhen i>k
    set a=a+1
    set WO[a]=i
    set i=i+1
  endloop
  set i=FirstScourgeHeroIndexid
  set k=LastScourgeHeroIndexid
  loop
    exitwhen i>k
    set a=a+1
    set WO[a]=i
    set i=i+1
  endloop
  set VO=a
endfunction

function GetSetElement takes nothing returns integer
  local integer VA8=GetRandomInt(FirstSentinelHeroIndexid,VO)
  local integer VB8=WO[VA8]
  set VB8=WO[VA8]
  if(FirstSentinelHeroIndexid==VO)then
    set WO[VA8]=0
    return VB8
  endif
  if(VA8==VO)then
    set VO=VO-1
    return VB8
  endif
  set WO[VA8]=WO[VO]
  set VO=VO-1
  return VB8
endfunction

function IsUnitSilenced takes unit whichUnit returns boolean
  return GetUnitAbilityLevel(whichUnit,'B01T')>0 or GetUnitAbilityLevel(whichUnit,'BNsi')>0 or GetUnitAbilityLevel(whichUnit,'B01X')>0 or GetUnitAbilityLevel(whichUnit,'BNdo')>0 or GetUnitAbilityLevel(whichUnit,'B02M')>0 or GetUnitAbilityLevel(whichUnit,'Bhea')>0 or GetUnitAbilityLevel(whichUnit,'B07V')>0 or GetUnitAbilityLevel(whichUnit,'B0BY')>0 or GetUnitAbilityLevel(whichUnit,'B08O')>0 or GetUnitAbilityLevel(whichUnit,'B07U')>0 or GetUnitAbilityLevel(whichUnit,'B0DL')>0 or GetUnitAbilityLevel(whichUnit,'B08V')>0 or GetUnitAbilityLevel(whichUnit,'B031')>0 or GetUnitAbilityLevel(whichUnit,'B0FT')>0 or GetUnitAbilityLevel(whichUnit,'B0FG')>0
endfunction

function V38 takes string V68 returns integer
  if V68=="a"then
    return 10
  elseif V68=="b"then
    return 11
  elseif V68=="c"then
    return 12
  elseif V68=="d"then
    return 13
  elseif V68=="e"then
    return 14
  elseif V68=="f"then
    return 15
  else
    return S2I(V68)
  endif
endfunction

function VL8 takes string V18 returns integer
  return V38(SubString(V18,0,1))*16+V38(SubString(V18,1,2))
endfunction

function isAintItemAbility takes integer aid returns boolean
  local integer i=1
  loop
    exitwhen i>ItemsAbilitiesMax2
    if aid==ItemsAbilities2[i]then
      return false
    endif
    set i=i+1
  endloop
  return true
endfunction

function V28 takes unit W48 returns integer
  local integer W78=GetUnitTypeId(W48)
  if W78=='e00R' or W78=='u00M' then
    return 1
  elseif W78=='e011' or W78=='u00D' then
    return 2
  elseif W78=='e00S' or W78=='u00N' then
    return 3
  elseif W78=='e019' or W78=='u00T' then
    return 4
  endif
  return 0
endfunction

function isPoisonArrowSkill takes integer id returns boolean
  return id=='A0DY' or id=='A1WB' or id=='A026' or id=='A09V' or id=='AHfa' or id=='A0LZ' or id=='A0QN' or id=='A0OI' or id=='A306'
endfunction

function IsDisjointSpell takes integer id returns boolean
  return id=='A0ME' or id=='AEbl' or id=='QB08' or id=='A01O' or id=='A0FN' or id=='QB07' or id=='A14O'
endfunction

function TextTagWithGold takes player whichPlayer,integer gold returns nothing
  local texttag t
  if gold>0 then
    set t=CreateTextTag()
    call SetPlayerState(whichPlayer,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(whichPlayer,PLAYER_STATE_RESOURCE_GOLD)+gold)
    call SetTextTagText(t,"+"+I2S(gold),.025)
    call SetTextTagPosUnit(t,udg_Hero[GetPlayerId(whichPlayer)],0)
    call SetTextTagColor(t,255,220,0,255)
    call SetTextTagVelocity(t,0,.03)
    call SetTextTagVisibility(t,GetLocalPlayer()==whichPlayer)
    call SetTextTagFadepoint(t,2)
    call SetTextTagLifespan(t,3)
    call SetTextTagPermanent(t,false)
  endif
  set t=null
endfunction

function WD8 takes player whichPlayer,integer gold returns nothing
  local integer i=1
  if IsPlayerAlly(whichPlayer,Sentinels[0])then
    loop
      exitwhen i>5
      if Sentinels[i]!=whichPlayer then
        call TextTagWithGold(Sentinels[i],gold)
      endif
      set i=i+1
    endloop
  endif
  set i=1
  if IsPlayerAlly(whichPlayer,Scourges[0])then
    loop
      exitwhen i>5
      if Scourges[i]!=whichPlayer then
        call TextTagWithGold(Scourges[i],gold)
      endif
      set i=i+1
    endloop
  endif
endfunction

function WF8 takes unit whichUnit,integer Level returns nothing
  local integer gold
  local player p=GetOwningPlayer(whichUnit)
  local integer WH8=0
  local integer WI8
  set gold=160+40*Level
  if Level==1 then
    set gold=264
  elseif Level==2 then
    set gold=312
  elseif Level==3 then
    set gold=358
  elseif Level==4 then
    set gold=405
  endif
  if IsUnitAlly(GetDyingUnit(),p)then
    if Level==1 then
      set gold=100
    elseif Level==2 then
      set gold=120
    elseif Level==3 then
      set gold=140
    elseif Level==4 then
      set gold=160
    endif
  endif
  if GetOwningPlayer(GetDyingUnit())==Scourges[0]then
    call TextTagWithGold(Sentinels[1],gold)
    call TextTagWithGold(Sentinels[2],gold)
    call TextTagWithGold(Sentinels[3],gold)
    call TextTagWithGold(Sentinels[4],gold)
    call TextTagWithGold(Sentinels[5],gold)
    set ReliableGold[GetPlayerId(Sentinels[1])]=ReliableGold[GetPlayerId(Sentinels[1])]+gold
    set ReliableGold[GetPlayerId(Sentinels[2])]=ReliableGold[GetPlayerId(Sentinels[2])]+gold
    set ReliableGold[GetPlayerId(Sentinels[3])]=ReliableGold[GetPlayerId(Sentinels[3])]+gold
    set ReliableGold[GetPlayerId(Sentinels[4])]=ReliableGold[GetPlayerId(Sentinels[4])]+gold
    set ReliableGold[GetPlayerId(Sentinels[5])]=ReliableGold[GetPlayerId(Sentinels[5])]+gold
  else
    call TextTagWithGold(Scourges[1],gold)
    call TextTagWithGold(Scourges[2],gold)
    call TextTagWithGold(Scourges[3],gold)
    call TextTagWithGold(Scourges[4],gold)
    call TextTagWithGold(Scourges[5],gold)
    set ReliableGold[GetPlayerId(Scourges[1])]=ReliableGold[GetPlayerId(Scourges[1])]+gold
    set ReliableGold[GetPlayerId(Scourges[2])]=ReliableGold[GetPlayerId(Scourges[2])]+gold
    set ReliableGold[GetPlayerId(Scourges[3])]=ReliableGold[GetPlayerId(Scourges[3])]+gold
    set ReliableGold[GetPlayerId(Scourges[4])]=ReliableGold[GetPlayerId(Scourges[4])]+gold
    set ReliableGold[GetPlayerId(Scourges[5])]=ReliableGold[GetPlayerId(Scourges[5])]+gold
  endif
  set p=null
endfunction

function IsIntHero takes integer id returns boolean
  local integer i=1
  loop
    exitwhen i>IntHeroesAmount
    if IntHeroesArray[i]==id then
      return true
    endif
    set i=i+1
  endloop
  return false
endfunction

function IsAgiHero takes integer id returns boolean
  local integer i=1
  loop
    exitwhen i>AgilityHeroesAmount
    if AgiHeroesArray[i]==id then
      return true
    endif
    set i=i+1
  endloop
  return false
endfunction

function IsStrHero takes integer id returns boolean
  local integer i=1
  loop
    exitwhen i>StrHeroesAmount
    if StrHeroesArray[i]==id then
      return true
    endif
    set i=i+1
  endloop
  return false
endfunction

function RandomIntHero takes player p returns nothing
  local integer i
  local integer k
  local location spawnLoc
  local integer rnd
  local boolean GotHero=false
  set PlayerUseRandomStatus[GetPlayerId(p)]=true
  if IsSentinel(p) then
    set i=FirstSentinelHeroIndexid
    set k=LastSentinelHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_NE)
  else
    set i=FirstScourgeHeroIndexid
    set k=LastScourgeHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_UD)
  endif
  if Mode_AP then
    if(GetRandomInt(1,2)==1)then
      set i=FirstSentinelHeroIndexid
      set k=LastSentinelHeroIndexid
    else
      set i=FirstScourgeHeroIndexid
      set k=LastScourgeHeroIndexid
    endif
  endif
  loop
    set rnd=GetRandomInt(i,k)
    exitwhen IsHeroIngame[rnd]==false and IsIntHero(HeroID[rnd])and HeroID[rnd]!='H00K' and not(MeleeOrRangedRestricted[GetPlayerId(p)]==2 and IsUnitIdType(HeroID[rnd],UNIT_TYPE_MELEE_ATTACKER))and not(MeleeOrRangedRestricted[GetPlayerId(p)]==1 and IsUnitIdType(HeroID[rnd],UNIT_TYPE_RANGED_ATTACKER))
  endloop
  if Mode_DU==false then
    call VR8(HeroID[rnd])
    set b_isHeroPicked[rnd]=true
    set IsHeroIngame[rnd]=true
  endif
  call CreateUnitAtLoc(p,HeroID[rnd],spawnLoc,0)
  call RemoveLocation(spawnLoc)
  set spawnLoc=null
endfunction

function WR8 takes player p returns nothing
  local integer i
  local integer k
  local location spawnLoc
  local integer rnd
  local boolean GotHero=false
  set PlayerUseRandomStatus[GetPlayerId(p)]=true
  if IsSentinel(p) then
    set i=FirstSentinelHeroIndexid
    set k=LastSentinelHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_NE)
  else
    set i=FirstScourgeHeroIndexid
    set k=LastScourgeHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_UD)
  endif
  if Mode_AP then
    if(GetRandomInt(1,2)==1)then
      set i=FirstSentinelHeroIndexid
      set k=LastSentinelHeroIndexid
    else
      set i=FirstScourgeHeroIndexid
      set k=LastScourgeHeroIndexid
    endif
  endif
  loop
    set rnd=GetRandomInt(i,k)
    exitwhen IsHeroIngame[rnd]==false and IsStrHero(HeroID[rnd])and not(MeleeOrRangedRestricted[GetPlayerId(p)]==2 and IsUnitIdType(HeroID[rnd],UNIT_TYPE_MELEE_ATTACKER))and not(MeleeOrRangedRestricted[GetPlayerId(p)]==1 and IsUnitIdType(HeroID[rnd],UNIT_TYPE_RANGED_ATTACKER))
  endloop
  if Mode_DU==false then
    call VR8(HeroID[rnd])
    set b_isHeroPicked[rnd]=true
    set IsHeroIngame[rnd]=true
  endif
  call CreateUnitAtLoc(p,HeroID[rnd],spawnLoc,0)
  call RemoveLocation(spawnLoc)
  set spawnLoc=null
endfunction

function GetRandomMeleeHero takes player p returns nothing
  local integer i
  local integer k
  local location spawnLoc
  local integer rnd
  local boolean GotHero=false
  local integer j=0
  set PlayerUseRandomStatus[GetPlayerId(p)]=true
  if IsSentinel(p) then
    set i=FirstSentinelHeroIndexid
    set k=LastSentinelHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_NE)
  else
    set i=FirstScourgeHeroIndexid
    set k=LastScourgeHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_UD)
  endif
  if Mode_AP then
    if(GetRandomInt(1,2)==1)then
      set i=FirstSentinelHeroIndexid
      set k=LastSentinelHeroIndexid
    else
      set i=FirstScourgeHeroIndexid
      set k=LastScourgeHeroIndexid
    endif
  endif
  loop
    set rnd=GetRandomInt(i,k)
    set j=j+1
    exitwhen IsHeroIngame[rnd]==false and IsUnitIdType(HeroID[rnd],UNIT_TYPE_MELEE_ATTACKER)==true or j>8000
  endloop
  if j>8000 and (IsHeroIngame[rnd]==false and IsUnitIdType(HeroID[rnd],UNIT_TYPE_MELEE_ATTACKER)==true)==false then
    call DisplayTimedTextToPlayer(p,0,0,10,"No melee heroes left.")
    call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+100)
  else
    if Mode_DU==false then
      call VR8(HeroID[rnd])
      set b_isHeroPicked[rnd]=true
      set IsHeroIngame[rnd]=true
    endif
    call CreateUnitAtLoc(p,HeroID[rnd],spawnLoc,0)
  endif
  call RemoveLocation(spawnLoc)
  set spawnLoc=null
endfunction

function GetRandomRangeHero takes player p returns nothing
  local integer i
  local integer k
  local location spawnLoc
  local integer rnd
  local boolean GotHero=false
  local integer j=0
  set PlayerUseRandomStatus[GetPlayerId(p)]=true
  if IsSentinel(p) then
    set i=FirstSentinelHeroIndexid
    set k=LastSentinelHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_NE)
  else
    set i=FirstScourgeHeroIndexid
    set k=LastScourgeHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_UD)
  endif
  if Mode_AP then
    if(GetRandomInt(1,2)==1)then
      set i=FirstSentinelHeroIndexid
      set k=LastSentinelHeroIndexid
    else
      set i=FirstScourgeHeroIndexid
      set k=LastScourgeHeroIndexid
    endif
  endif
  loop
    set rnd=GetRandomInt(i,k)
    set j=j+1
    exitwhen IsHeroIngame[rnd]==false and IsUnitIdType(HeroID[rnd],UNIT_TYPE_MELEE_ATTACKER)==false or j>8000
  endloop
  if j>8000 and (IsHeroIngame[rnd]==false and IsUnitIdType(HeroID[rnd],UNIT_TYPE_MELEE_ATTACKER)==false)==false then
    call DisplayTimedTextToPlayer(p,0,0,10,"No ranged heroes left.")
    call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+100)
  else
    if Mode_DU==false then
      call VR8(HeroID[rnd])
      set b_isHeroPicked[rnd]=true
      set IsHeroIngame[rnd]=true
    endif
    call CreateUnitAtLoc(p,HeroID[rnd],spawnLoc,0)
  endif
  call RemoveLocation(spawnLoc)
  set spawnLoc=null
endfunction

function WS8 takes player p returns nothing
  local integer i
  local integer k
  local location spawnLoc
  local integer rnd
  local boolean GotHero=false
  set PlayerUseRandomStatus[GetPlayerId(p)]=true
  if IsSentinel(p) then
    set i=FirstSentinelHeroIndexid
    set k=LastSentinelHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_NE)
  else
    set i=FirstScourgeHeroIndexid
    set k=LastScourgeHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_UD)
  endif
  if Mode_AP then
    if(GetRandomInt(1,2)==1)then
      set i=FirstSentinelHeroIndexid
      set k=LastSentinelHeroIndexid
    else
      set i=FirstScourgeHeroIndexid
      set k=LastScourgeHeroIndexid
    endif
  endif
  loop
    set rnd=GetRandomInt(i,k)
    exitwhen IsHeroIngame[rnd]==false and IsAgiHero(HeroID[rnd])and not(MeleeOrRangedRestricted[GetPlayerId(p)]==2 and IsUnitIdType(HeroID[rnd],UNIT_TYPE_MELEE_ATTACKER))and not(MeleeOrRangedRestricted[GetPlayerId(p)]==1 and IsUnitIdType(HeroID[rnd],UNIT_TYPE_RANGED_ATTACKER))
  endloop
  if Mode_DU==false then
    call VR8(HeroID[rnd])
    set b_isHeroPicked[rnd]=true
    set IsHeroIngame[rnd]=true
  endif
  call CreateUnitAtLoc(p,HeroID[rnd],spawnLoc,0)
  call RemoveLocation(spawnLoc)
  set spawnLoc=null
endfunction

function WT8 takes player p returns nothing
  local integer i
  local integer k
  local location spawnLoc
  local integer rnd
  local boolean GotHero=false
  set PlayerUseRandomStatus[GetPlayerId(p)]=true
  if IsSentinel(p) then
    set i=FirstSentinelHeroIndexid
    set k=LastSentinelHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_NE)
  else
    set i=FirstScourgeHeroIndexid
    set k=LastScourgeHeroIndexid
    set spawnLoc=GetRectCenter(gg_rct_Hero_Creation_UD)
  endif
  if Mode_AP then
    if(GetRandomInt(1,2)==1)then
      set i=FirstSentinelHeroIndexid
      set k=LastSentinelHeroIndexid
    else
      set i=FirstScourgeHeroIndexid
      set k=LastScourgeHeroIndexid
    endif
  endif
  loop
    set rnd=GetRandomInt(i,k)
    exitwhen IsHeroIngame[rnd]==false and not(MeleeOrRangedRestricted[GetPlayerId(p)]==2 and IsUnitIdType(HeroID[rnd],UNIT_TYPE_MELEE_ATTACKER))and not(MeleeOrRangedRestricted[GetPlayerId(p)]==1 and IsUnitIdType(HeroID[rnd],UNIT_TYPE_RANGED_ATTACKER))
  endloop
  if Mode_DU==false then
    call VR8(HeroID[rnd])
    set b_isHeroPicked[rnd]=true
    set IsHeroIngame[rnd]=true
  endif
  call CreateUnitAtLoc(p,HeroID[rnd],spawnLoc,0)
  call RemoveLocation(spawnLoc)
  set spawnLoc=null
endfunction

function WU8 takes boolean WV8,boolean WW8 returns integer
  local integer WO8
  local integer WP8
  if WV8 and WW8 then
    if(GetRandomInt(1,2)==1)then
      set WO8=FirstSentinelHeroIndexid
      set WP8=LastSentinelHeroIndexid
    else
      set WO8=FirstScourgeHeroIndexid
      set WP8=LastScourgeHeroIndexid
    endif
  elseif WV8 then
    set WO8=FirstSentinelHeroIndexid
    set WP8=LastSentinelHeroIndexid
  else
    set WO8=FirstScourgeHeroIndexid
    set WP8=LastScourgeHeroIndexid
  endif
  return GetRandomInt(WO8,WP8)
endfunction

function IsBasicCourier takes unit whichUnit returns boolean
  return GetUnitTypeId(whichUnit)=='n00I' or GetUnitTypeId(whichUnit)=='n022' or GetUnitTypeId(whichUnit)=='n021' or GetUnitTypeId(whichUnit)=='n0KY' or GetUnitTypeId(whichUnit)=='n0KZ' or GetUnitTypeId(whichUnit)=='n0LE' or GetUnitTypeId(whichUnit)=='n023' or GetUnitTypeId(whichUnit)=='n024' or GetUnitTypeId(whichUnit)=='n025' or GetUnitTypeId(whichUnit)=='n0L0' or GetUnitTypeId(whichUnit)=='n0L1' or GetUnitTypeId(whichUnit)=='n0M4' or GetUnitTypeId(whichUnit)=='n00M' or GetUnitTypeId(whichUnit)=='n0HV' or GetUnitTypeId(whichUnit)=='n0LS'
endfunction

function IsFlyingCourier takes unit whichUnit returns boolean
  return GetUnitTypeId(whichUnit)=='e01H' or GetUnitTypeId(whichUnit)=='e01Z' or GetUnitTypeId(whichUnit)=='e02R' or GetUnitTypeId(whichUnit)=='e02T' or GetUnitTypeId(whichUnit)=='e02S' or GetUnitTypeId(whichUnit)=='e030'
endfunction

function IsCourier takes unit whichUnit returns boolean
  return IsBasicCourier(whichUnit)or IsFlyingCourier(whichUnit)
endfunction

function WA8 takes destructable d returns boolean
  return GetDestructableTypeId(d)=='NTtc' or GetDestructableTypeId(d)=='NTtw' or GetDestructableTypeId(d)=='ATtr' or GetDestructableTypeId(d)=='B002' or GetDestructableTypeId(d)=='B003' or GetDestructableTypeId(d)=='B005'
endfunction

function IsMagicImmune takes unit u returns boolean
  return IsUnitType(u,UNIT_TYPE_MAGIC_IMMUNE) or GetUnitAbilityLevel(u,'A0S6')>0 or GetUnitAbilityLevel(u,'A179')>0 or GetUnitAbilityLevel(u,'ACmi')>0 or GetUnitAbilityLevel(u,'A0SU')>0 or GetUnitAbilityLevel(u,'B014')>0 or GetUnitAbilityLevel(u,'A0H3')>0 or LoadInteger(hashtable019,GetHandleId(u),4252)==1
endfunction

function WC8 takes unit W38 returns boolean
  return GetUnitAbilityLevel(W38,'A04R')>0 and IsPlayerBelongToTeams(GetOwningPlayer(W38))
endfunction

function IsBuggyFlying takes unit u returns boolean
  return GetUnitTypeId(u)=='H00F' or GetUnitTypeId(u)=='H00E' or GetUnitTypeId(u)=='H00G' or GetUnitTypeId(u)=='O017'
endfunction

function IsDamageReal takes real d returns boolean
  return 2<d and d<3000
endfunction

function W18 takes nothing returns nothing
  local integer VT8=1
  set PlayerModeTyper=Sentinels[1]
  loop
    exitwhen IsPlayer(PlayerModeTyper)or VT8>5
    set VT8=VT8+1
    set PlayerModeTyper=Sentinels[VT8]
  endloop
  if IsPlayer(PlayerModeTyper)==false then
    set PlayerModeTyper=Scourges[1]
    set VT8=1
    loop
      exitwhen IsPlayer(PlayerModeTyper)or VT8>5
      set VT8=VT8+1
      set PlayerModeTyper=Scourges[VT8]
    endloop
  endif
endfunction

function IsRealHero takes unit Hero returns boolean
  return IsUnitType(Hero,UNIT_TYPE_HERO) and IsUnitIllusion(Hero)==false and GetUnitTypeId(Hero)!='H00M' and GetUnitTypeId(Hero)!='H00Y' and GetUnitTypeId(Hero)!='H07G' and GetUnitTypeId(Hero)!='H0B8' and GetUnitTypeId(udg_Hero[GetPlayerId(GetOwningPlayer(Hero))])!=GetUnitTypeId(Hero)
endfunction

function DummyToHero takes integer i returns integer
  local integer x=0
  loop
    exitwhen x>LastScourgeHeroIndexid
    if DummyID[x]==i then
      return HeroID[x]
    endif
    set x=x+1
  endloop
  return-1
endfunction

function W28 takes integer U38 returns integer
  local integer i=1
  loop
    exitwhen i>LastScourgeHeroIndexid
    if U38==HeroID[i]then
      return i
    endif
    set i=i+1
  endloop
  return 0
endfunction

function IsDayTime takes nothing returns boolean
  return GetTimeOfDay()>6. and GetTimeOfDay()<18.
endfunction

function RemoveAbilsForUnit takes unit u returns nothing
  local integer i=1
  local integer lvl
  
  loop
    set lvl=GetUnitAbilityLevel(u,PassivesLearningSkill[i])
    if lvl==0 and GetUnitAbilityLevel(u,PassivesLearningSkillUpg[i])>0 then
      set lvl=GetUnitAbilityLevel(u,PassivesLearningSkillUpg[i])
    endif
    if lvl==0 and PassivesRealID[i]!='S00A' and (GetUnitAbilityLevel(u,PassivesRealID[i])>0 or GetUnitAbilityLevel(u,PassivesSpellbookID[i])>0 or GetUnitAbilityLevel(u,PassivesBuffID[i])>0) then
      call UnitRemoveAbility(u,PassivesRealID[i])
      call UnitRemoveAbility(u,PassivesSpellbookID[i])
      call UnitRemoveAbility(u,PassivesBuffID[i])
    endif
    if (lvl>0 and PassivesRealID[i]=='S00A' and IsDayTime())or(lvl==0 and PassivesRealID[i]=='S00A') then
      call UnitRemoveAbility(u,PassivesBuffID[i])
      call SetUnitAbilityLevel(u,'S00A',5)
    endif
    set i=i+1
    exitwhen i>PassivesCount
  endloop
  if GetUnitAbilityLevel(u,'Q0BK')>0 then
    set lvl=GetUnitAbilityLevel(u,'Q0BK')
    call UnitRemoveAbility(u,'Q0BK')
    call UnitAddAbility2(u,'Q0BK')
    call SetUnitAbilityLevel(u,'Q0BK',lvl)
  endif
  if GetUnitAbilityLevel(u,'A0CG')>0 then
    set lvl=GetUnitAbilityLevel(u,'A0CG')
    call UnitRemoveAbility(u,'A0CG')
    call UnitAddAbility2(u,'A0CG')
    call SetUnitAbilityLevel(u,'A0CG',lvl)
  endif
endfunction

function RemoveAbilsConst takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer i=1
  local integer lvl
  local integer id=LoadInteger(hashtable019,h,0)
  local integer limit=30
  if id=='A0AG' then
    set limit=105
  endif
  if GetUnitState(u,UNIT_STATE_LIFE)>0.405 then
    if GetTriggerEvalCount(t)<limit then
      loop
        set lvl=GetUnitAbilityLevel(u,PassivesLearningSkill[i])
        if lvl==0 and GetUnitAbilityLevel(u,PassivesLearningSkillUpg[i])>0 then
          set lvl=GetUnitAbilityLevel(u,PassivesLearningSkillUpg[i])
        endif
        if lvl==0 and PassivesRealID[i]!='S00A' and (GetUnitAbilityLevel(u,PassivesRealID[i])>0 or GetUnitAbilityLevel(u,PassivesSpellbookID[i])>0 or GetUnitAbilityLevel(u,PassivesBuffID[i])>0) then
          call UnitRemoveAbility(u,PassivesRealID[i])
          call UnitRemoveAbility(u,PassivesSpellbookID[i])
          call UnitRemoveAbility(u,PassivesBuffID[i])
        endif
        if (lvl>0 and PassivesRealID[i]=='S00A' and IsDayTime())or(lvl==0 and PassivesRealID[i]=='S00A') then
          call UnitRemoveAbility(u,PassivesBuffID[i])
          call SetUnitAbilityLevel(u,'S00A',5)
        endif
        set i=i+1
        exitwhen i>PassivesCount
      endloop
    else
      if GetUnitAbilityLevel(u,'Q0BK')>0 then
        set lvl=GetUnitAbilityLevel(u,'Q0BK')
        call UnitRemoveAbility(u,'Q0BK')
        call UnitAddAbility2(u,'Q0BK')
        call SetUnitAbilityLevel(u,'Q0BK',lvl)
      endif
      if GetUnitAbilityLevel(u,'A0CG')>0 then
        set lvl=GetUnitAbilityLevel(u,'A0CG')
        call UnitRemoveAbility(u,'A0CG')
        call UnitAddAbility2(u,'A0CG')
        call SetUnitAbilityLevel(u,'A0CG',lvl)
      endif
      call CleanTrigger(t)
      call FlushChildHashtable(hashtable019,h)
      set TEMPUNIT=u
      //call ExeFunc("Abbadon_Frostmourne_Transform_helper")
      //call BJDebugMsg("|c00ff0000Error: some hero left with passives. Report that.|r")
    endif
  endif
  set t=null
  set u=null
  
endfunction

function Wait0SecPlz takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local trigger tt
  local integer hh
  local integer id=GetSpellAbilityId()
  if LoadInteger(hashtable019,h,0)>0 then
    set id=LoadInteger(hashtable019,h,0)
  endif
  if id=='A0AG' or id=='QM01' or id=='A0BE' or id=='QM00' or id=='QB0K' or id=='ANcr' or id=='QB0L' or id=='A2H0' or id=='QM02' or id=='A1C0' or id=='QM03' or id=='QM04' or id=='A1RI' or id=='A332' or id=='A2M0' or id=='A2H1' then
    set tt=CreateTrigger()
    set hh=GetHandleId(tt)
    call SaveUnitHandle(hashtable019,hh,0,LoadUnitHandle(hashtable019,h,0))
    call SaveInteger(hashtable019,hh,0,id)
    call TriggerRegisterTimerEvent(tt,0.02,true)
    call TriggerAddCondition(tt,Condition(function RemoveAbilsConst))
    call RemoveSavedInteger(hashtable019,h,0)
  endif
  set t=null
  set tt=null
  
endfunction

function GetMorphId takes integer UnitID returns integer
  local integer id=W28(UnitID)
  local string MorphString=I2S(2*id-2)
  local integer l=StringLength(MorphString)
  if id==0 then
    if UnitID=='N01H' or UnitID=='H600' then
      return 'M500'
    elseif UnitID=='N01T' or UnitID=='H601' then
      return 'M502'
    elseif UnitID=='N01J' or UnitID=='H602' then
      return 'M504'
    elseif UnitID=='H00F' then
      return 'M506'
    elseif UnitID=='H00E' then
      return 'M508'
    elseif UnitID=='H00G' then
      return 'M510'
    elseif UnitID=='O017' then
      return 'M512'
    elseif UnitID=='H06X' then
      return 'M514'
    elseif UnitID=='H06Y' then
      return 'M516'
    elseif UnitID=='H06W' then
      return 'M518'
    elseif UnitID=='N013' then
      return 'M520'
    elseif UnitID=='N014' then
      return 'M522'
    elseif UnitID=='N015' then
      return 'M524'
    elseif UnitID=='E015' then
      return 'M526'
    elseif UnitID=='H07I' then
      return 'M528'
    elseif UnitID=='Eevm' then
      return 'M530'
    elseif UnitID=='E02V' then
      return 'M532'
    elseif UnitID=='E02W' then
      return 'M534'
    elseif UnitID=='E02U' then
      return 'M536'
    elseif UnitID=='H08D' then
      return 'M538'
    elseif UnitID=='H08C' then
      return 'M540'
    elseif UnitID=='H084' then
      return 'M542'
    elseif UnitID=='H08B' then
      return 'M544'
    elseif UnitID=='N017' then
      return 'M546'
    elseif UnitID=='N02B' then
      return 'M548'
    elseif UnitID=='N0MB' then
      return 'M550'
    elseif UnitID=='N0MC' then
      return 'M552'
    elseif UnitID=='N0MO' then
      return 'M554'
    elseif UnitID=='N0MA' then
      return 'M556'
    elseif UnitID=='U01X' then
      return 'M558'
    elseif UnitID=='QTW2' then
      return 'M562'
    elseif UnitID=='QTW3' then
      return 'M564'
    elseif UnitID=='KODO' then
      return 'M566'
    else
      return 0
    endif
  endif
  if l==1 then
    set MorphString="M00"+MorphString
  elseif l==2 then
    set MorphString="M0"+MorphString
  elseif l==3 then
    set MorphString="M"+MorphString
  else
    return 0
  endif
  return String2Id(MorphString)
endfunction

function MorphUnit_RemoveBuffs takes unit u returns nothing
  local integer loopA = 0
  local integer limit = morph_passives_count + 1
  
  loop
    exitwhen loopA==limit
    call UnitRemoveAbility(u,morph_passives[loopA])
    set loopA = loopA + 1
  endloop
endfunction

function MorphUnit takes unit u returns integer
  //local integer morph = GetMorphId(HeroTypeId[GetPlayerId(GetOwningPlayer(u))])
  local integer morph = GetMorphId(GetUnitTypeId(u))
  
  //call BJDebugMsg("xin: "+Id2String('M106'))
  //call BJDebugMsg("morfid: "+Id2String(morph))
  //call BJDebugMsg(B2S(morph!='M106'))
  
  if morph!='M106'then //prevents the unit from transforming into itself \:3/
    call UnitAddAbility(u,'A04R')//adds marker so the morph ability cant be stolen
    
    call UnitAddAbility(u,morph)
    call UnitRemoveAbility(u,morph)
    
    call MorphUnit_RemoveBuffs(u)
    
    call UnitRemoveAbility(u,'A04R')
  endif
  call RemoveAbilsForUnit(u)
  return morph
endfunction
function UnMorphUnit takes unit u, integer morph returns nothing
  
  //call BJDebugMsg("xin: "+Id2String('M106'))
  //call BJDebugMsg("unmorfid: "+Id2String(morph))
  //call BJDebugMsg(B2S(morph!='M106'))
  
  if morph!='M107'then //prevents the unit from transforming into itself \:3/
    call UnitAddAbility(u,'A04R')//adds marker so the morph ability cant be stolen
    
    call UnitAddAbility(u,morph)
    call UnitRemoveAbility(u,morph)
    call MorphUnit_RemoveBuffs(u)
    
    call UnitRemoveAbility(u,'A04R')
  endif
  call RemoveAbilsForUnit(u)
endfunction

function GetExpForUnit takes unit Hero returns integer
  local integer Level=GetHeroLevel(Hero)
  if Level==1 then
    return 100
  elseif Level==2 then
    return 120
  elseif Level==3 then
    return 160
  elseif Level==4 then
    return 220
  else
    return-200+100*Level
  endif
  return 0
endfunction

function IsObserver takes player p returns boolean
  return udg_ObserverMode and(udg_Observer1==p or udg_Observer2==p)
endfunction

function IsUnitCycloned takes unit u returns boolean
  return GetUnitAbilityLevel(u,'Bcyc')>0 or GetUnitAbilityLevel(u,'Bcy2')>0
endfunction

function IsUnitFamiliar takes integer id returns boolean
  return id=='u014' or id=='u015' or id=='u016' or id=='u01D' or id=='u01E' or id=='u01F'
endfunction

function IsHexed takes unit u returns boolean
  return GetUnitAbilityLevel(u,'BOhx')>0 or GetUnitAbilityLevel(u,'B00H')>0
endfunction

function DamageTarget takes unit Source,unit Target,integer DT,real Damage returns nothing
  if DT==0 then
    return
  endif
  set IsFakeDamage=true
  if DT==1 then
    call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_FIRE,WEAPON_TYPE_WHOKNOWS)
  elseif DT==2 then
    call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_HERO,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
  elseif DT==3 then
    call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_HERO,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)
  elseif DT==4 then
    call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_PIERCE,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
  elseif DT==5 then
    call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
  elseif DT==6 then
    call SetUnitState(Target,UNIT_STATE_LIFE,RMaxBJ(GetUnitState(Target,UNIT_STATE_LIFE)-Damage,1))
    if GetUnitState(Target,UNIT_STATE_LIFE)<2 and GetUnitAbilityLevel(Target,'B07D')==0 then
      call UnitRemoveBuffs(Target,true,true)
      call UnitRemoveAbility(Target,'Aetl')
      call UnitDamageTarget(CreateUnit(GetOwningPlayer(Source),'e00E',0,0,0),Target,100000000.00,true,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
    endif
  elseif DT==7 then
    if GetUnitAbilityLevel(Target,'Aetl')>0 or GetUnitAbilityLevel(Target,'B01N')>0 then
      call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_HERO,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)
    else
      call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_HERO,DAMAGE_TYPE_UNIVERSAL,WEAPON_TYPE_WHOKNOWS)
    endif
  endif
  set IsFakeDamage=false
endfunction

function DamageTargetWithDelay_Go takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  local integer XK8=LoadInteger(hashtable019,Cache,30)
  local unit Target=UnitAsInteger_Load(XK8)
  local integer XH8=LoadInteger(hashtable019,Cache,36)
  local real Damage=LoadReal(hashtable019,Cache,20)
  call DamageTarget(Source,Target,XH8,Damage)
  call UnitAsInteger_Clear(XK8)
  call FlushChildHashtable(hashtable019,Cache)
  call CleanTrigger(t)
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function DamageTarget_Delayed takes unit Source,unit Target,integer DT,real Damage,real delay returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,Cache,2,Source)
  call SaveInteger(hashtable019,Cache,30,UnitAsInteger_Save(Target))
  call SaveInteger(hashtable019,Cache,36,DT)
  call SaveReal(hashtable019,Cache,20,Damage*1.)
  call TriggerRegisterTimerEvent(t,delay,false)
  call TriggerAddCondition(t,Condition(function DamageTargetWithDelay_Go))
  set t=null
endfunction

function SoundForPlayer takes player whichPlayer,string path returns nothing
  local sound s=CreateSound(path,false,false,false,10,10,"DefaultEAXON")
  if(GetLocalPlayer()==whichPlayer)then
    call StartSound(s)
  endif
  call KillSoundWhenDone(s)
  set s=null
endfunction

function SoundForAllPlayers takes player whichPlayer,string soundPath returns nothing
  call SoundForPlayer(Sentinels[1],soundPath)
  call SoundForPlayer(Sentinels[2],soundPath)
  call SoundForPlayer(Sentinels[3],soundPath)
  call SoundForPlayer(Sentinels[4],soundPath)
  call SoundForPlayer(Sentinels[5],soundPath)
  call SoundForPlayer(Scourges[1],soundPath)
  call SoundForPlayer(Scourges[2],soundPath)
  call SoundForPlayer(Scourges[3],soundPath)
  call SoundForPlayer(Scourges[4],soundPath)
  call SoundForPlayer(Scourges[5],soundPath)
endfunction

function Error takes player p,string txt returns nothing
  local sound s=CreateSoundFromLabel("InterfaceError",false,false,false,10,10)
  if(txt!="")and(txt!=null)then
    if(GetLocalPlayer()==p)then
      call ClearTextMessages()
      call DisplayTimedTextToPlayer(p,.5,-1.,2.,"|cffffcc00"+txt+"|r")
    endif
  endif
  if(GetLocalPlayer()==p)then
    call StartSound(s)
  endif
  call KillSoundWhenDone(s)
  set s=null
endfunction

function ErrorDefault2s takes player p,string txt returns nothing
  local sound s=CreateSoundFromLabel("InterfaceError",false,false,false,10,10)
  if(GetLocalPlayer()==p)then
    if(txt!="")and(txt!=null)then
      call DisplayTimedTextToPlayer(p,0,0,2.,"|cffffcc00"+txt+"|r")
    endif
    call StartSound(s)
  endif
  call KillSoundWhenDone(s)
  set s=null
endfunction

function ErrorDefault5s takes player p,string txt returns nothing
  local sound s=CreateSoundFromLabel("InterfaceError",false,false,false,10,10)
  if(GetLocalPlayer()==p)then
    if(txt!="")and(txt!=null)then
      call DisplayTimedTextToPlayer(p,0,0,5.,"|cffffcc00"+txt+"|r")
    endif
    call StartSound(s)
  endif
  call KillSoundWhenDone(s)
  set s=null
endfunction

function InterruptUnit takes unit u returns nothing
  call PauseUnit(u,true)
  call IssueImmediateOrder(u,"stop")//"stop"
  call PauseUnit(u,false)
endfunction


function RunIfTrue takes string f,boolean b returns nothing
  if b and f!="" and f!=null then
    call ExeFunc(f)
  endif
endfunction

function SafeX50 takes real x returns real
  local real dx=GetRectMinX(bj_mapInitialPlayableArea)+50
  if(x<dx)then
    return dx
  endif
  set dx=GetRectMaxX(bj_mapInitialPlayableArea)-50
  if(x>dx)then
    return dx
  endif
  return x
endfunction

function SafeX75 takes real x returns real
  local real dx=GetRectMinX(bj_mapInitialPlayableArea)+75
  if(x<dx)then
    return dx
  endif
  set dx=GetRectMaxX(bj_mapInitialPlayableArea)-75
  if(x>dx)then
    return dx
  endif
  return x
endfunction

function SafeY50 takes real y returns real
  local real dy=GetRectMinY(bj_mapInitialPlayableArea)+50
  if(y<dy)then
    return dy
  endif
  set dy=GetRectMaxY(bj_mapInitialPlayableArea)-50
  if(y>dy)then
    return dy
  endif
  return y
endfunction

function SafeY75 takes real y returns real
  local real dy=GetRectMinY(bj_mapInitialPlayableArea)+75
  if(y<dy)then
    return dy
  endif
  set dy=GetRectMaxY(bj_mapInitialPlayableArea)-75
  if(y>dy)then
    return dy
  endif
  return y
endfunction

function PreloadAbility_TimerTick takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer aid=LoadInteger(hashtable019,Cache,37)
  call PreloadAbility(aid)
  call FlushChildHashtable(hashtable019,Cache)
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function PreloadAbilityDelayed takes integer aid,real time returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveInteger(hashtable019,Cache,37,aid)
  call TriggerRegisterTimerEvent(t,time,false)
  call TriggerAddCondition(t,Condition(function PreloadAbility_TimerTick))
  set t=null
endfunction

function Tree_Killer takes nothing returns nothing
  call KillDestructable(GetEnumDestructable())
endfunction

function RemoveHero takes unit Hero returns nothing
  call SaveBoolean(hashtable019,(GetHandleId(Hero)),(38),(false))
  call FlushChildHashtable(hashtable019,(GetHandleId(Hero)))
  call RemoveUnit(Hero)
endfunction

function UnitAddAbilityLevel takes unit whichUnit,integer YD8,integer YE8 returns nothing
  if GetUnitAbilityLevel(whichUnit,YD8)==0 then
    call UnitAddAbility(whichUnit,YD8)
  endif
  call SetUnitAbilityLevel(whichUnit,YD8,YE8)
endfunction

function IMinIF takes integer a,integer b returns integer
  if(a<b)then
    return a
  else
    return b
  endif
endfunction



function RMinIF takes real a,real b returns real
  if(a<b)then
    return a
  else
    return b
  endif
endfunction

function RMaxIF takes real a,real b returns real
  if(a<b)then
    return b
  else
    return a
  endif
endfunction

function YK8 takes nothing returns nothing
  local integer Cache=GetHandleId(GetExpiredTimer())
  local unit whichUnit=(LoadUnitHandle(hashtable019,(Cache),(26)))
  call SetUnitState(whichUnit,UNIT_STATE_LIFE,GetUnitState(whichUnit,UNIT_STATE_LIFE)+(LoadReal(hashtable019,(Cache),(20))))
  set whichUnit=null
endfunction

function YM8 takes unit whichUnit,real Damage returns nothing
  local timer t=CreateTimer()
  local integer Cache=GetHandleId(t)
  call SaveReal(hashtable019,(Cache),(20),((Damage)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(26),(whichUnit))
  call TimerStart(t,0,false,function YK8)
  set t=null
endfunction

function HealUnitFor takes unit whichUnit,real Damage returns nothing
  local real maxlife=GetUnitState(whichUnit,UNIT_STATE_MAX_LIFE)
  local real curlife=GetUnitState(whichUnit,UNIT_STATE_LIFE)
  if(GetUnitState(whichUnit,UNIT_STATE_LIFE)>1)then
    if Damage>(maxlife-curlife)then
      if Damage>=curlife then
        call SetUnitState(whichUnit,UNIT_STATE_LIFE,maxlife)
        call YM8(whichUnit,Damage-(maxlife-curlife))
      else
        call YM8(whichUnit,Damage)
      endif
    else
      call SetUnitState(whichUnit,UNIT_STATE_LIFE,GetUnitState(whichUnit,UNIT_STATE_LIFE)+Damage)
    endif
  endif
endfunction

function YQ8 takes unit Source,unit Target,real YR8 returns boolean
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real TargetX=GetUnitX(Target)
  local real TargetY=GetUnitY(Target)
  if((SourceX-TargetX)*(SourceX-TargetX)+(SourceY-TargetY)*(SourceY-TargetY))<YR8*YR8 then
    return true
  else
    return false
  endif
  return false
endfunction

function DistanceBetweenUnits takes unit Source,unit Target returns real
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real TargetX=GetUnitX(Target)
  local real TargetY=GetUnitY(Target)
  if Source==null or Target==null then
    return I2R(9999999999)
  else
    return SquareRoot((SourceX-TargetX)*(SourceX-TargetX)+(SourceY-TargetY)*(SourceY-TargetY))
  endif
  return 1.
endfunction

function YX8 takes unit Source,location Target returns real
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real TargetX=GetLocationX(Target)
  local real TargetY=GetLocationY(Target)
  if Source==null then
    return I2R(9999999999)
  else
    return SquareRoot((SourceX-TargetX)*(SourceX-TargetX)+(SourceY-TargetY)*(SourceY-TargetY))
  endif
  return 1.
endfunction

function DistanceBetweenXY takes real x1,real y1,real x2,real y2 returns real
  return SquareRoot(((x1-x2)*(x1-x2))+((y1-y2)*(y1-y2)))
endfunction

function YZ8 takes unit whichUnit returns nothing
  call SetUnitState(whichUnit,UNIT_STATE_MANA,GetUnitState(whichUnit,UNIT_STATE_MAX_MANA))
endfunction

function YA8 takes nothing returns nothing
  call DisplayTimedTextToPlayer(GetEnumPlayer(),0,group008,real081,string044)
endfunction

function DisplayTimedTextToForceEx takes force YC8,real SB8,string Y38 returns nothing
  set string044=Y38
  set real081=SB8
  call ForForce(YC8,function YA8)
endfunction

function Y68 takes nothing returns nothing
  if ShowRollNumbers[GetPlayerId(GetEnumPlayer())]then
    call DisplayTimedTextToPlayer(GetEnumPlayer(),0,group008,real081,string044)
  endif
endfunction

function YL8 takes force YC8,real SB8,string Y38 returns nothing
  set string044=Y38
  set real081=SB8
  call ForForce(YC8,function Y68)
endfunction

function Y18 takes unit whichUnit,real Y08 returns nothing
  call SetUnitState(whichUnit,UNIT_STATE_LIFE,GetUnitState(whichUnit,UNIT_STATE_LIFE)+Y08)
endfunction

function Y58 takes nothing returns nothing
  call PauseAllUnitsBJ(true)
endfunction

function RepeatedPauseAll takes nothing returns nothing
  local timer t=CreateTimer()
  call TimerStart(t,1,true,function Y58)
  set t=null
endfunction

function Y28 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger((t))
  set t=null
  return false
endfunction

function Z48 takes string Z78,unit whichUnit,string Z88,real SB8 returns nothing
  local effect fx=AddSpecialEffectTarget(Z78,whichUnit,Z88)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveEffectHandle(hashtable019,(Cache),(32),(fx))
  call TriggerRegisterUnitEvent(t,whichUnit,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,SB8,false)
  call TriggerAddCondition(t,Condition(function Y28))
  set fx=null
  set t=null
endfunction

function Z98 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger((t))
  set t=null
  return false
endfunction

function ZD8 takes string Z78,real x,real y,real SB8 returns nothing
  local effect fx=AddSpecialEffect(Z78,x,y)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveEffectHandle(hashtable019,(Cache),(32),(fx))
  call TriggerRegisterTimerEvent(t,SB8,false)
  call TriggerAddCondition(t,Condition(function Z98))
  set fx=null
  set t=null
endfunction

function PulseEffectTarget_Child takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local string Z78=(LoadStr(hashtable019,(Cache),(39)))
  local string Z88=(LoadStr(hashtable019,(Cache),(40)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  call Z48(Z78,Target,Z88,2)
  if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>Count then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  return false
endfunction

function ZE8 takes unit whichUnit,integer ZF8 returns item
  local integer ZG8=0
  local item ZH8
  loop
    exitwhen ZG8==6
    set ZH8=UnitItemInSlot(whichUnit,ZG8)
    if ZH8!=null and GetItemTypeId(ZH8)==ZF8 then
      return ZH8
    endif
    set ZG8=ZG8+1
  endloop
  set ZH8=null
  return null
endfunction

function CleanTimer takes timer t returns nothing
  call PauseTimer(t)
  call FlushChildHashtable(hashtable019,(GetHandleId(t)))
  call DestroyTimer(t)
endfunction

function GetAngleBetweenUnits takes unit a,unit b returns real
  return bj_RADTODEG*Atan2(GetUnitY(b)-GetUnitY(a),GetUnitX(b)-GetUnitX(a))
endfunction

function AngleBetweenXY takes real x1,real y1,real x2,real y2 returns real
  return bj_RADTODEG*Atan2(y2-y1,x2-x1)
endfunction

function ZN8 takes nothing returns nothing
  call DestroyLightning((LoadLightningHandle(hashtable019,(GetHandleId(GetExpiredTimer())),(41))))
endfunction

function ZO8 takes string ZP8,real x1,real y1,real x2,real y2,real r,real g,real b,real a,real SB8 returns nothing
  local timer t=CreateTimer()
  local lightning ZQ8=AddLightning(ZP8,true,x1,y1,x2,y2)
  call SetLightningColor(ZQ8,r,g,b,a)
  call SaveLightningHandle(hashtable019,(GetHandleId(t)),(41),(ZQ8))
  call TimerStart(t,SB8,false,function ZN8)
  set t=null
  set ZQ8=null
endfunction

function ZR8 takes string ZS8,unit ZT8,integer r,integer g,integer b returns nothing
  local texttag tt=CreateTextTag()
  call SetTextTagText(tt,ZS8,.03)
  call SetTextTagPosUnit(tt,ZT8,0)
  call SetTextTagColor(tt,r,g,b,255)
  call SetTextTagPermanent(tt,true)
  set tt=null
endfunction

function TextTagOnUnit takes string ZS8,real SB8,unit ZT8,real ZV8,integer r,integer g,integer b,integer a returns nothing
  local texttag tt=CreateTextTag()
  call SetTextTagText(tt,ZS8,ZV8)
  call SetTextTagPosUnit(tt,ZT8,64)
  call SetTextTagColor(tt,r,g,b,a)
  call SetTextTagVelocity(tt,0,.0355)
  call SetTextTagFadepoint(tt,2)
  call SetTextTagPermanent(tt,false)
  call SetTextTagLifespan(tt,SB8)
  //if IsUnitVisibleLoD(ZT8,GetLocalPlayer())or IsObserver(GetLocalPlayer())then
  call SetTextTagVisibility(tt,IsUnitVisibleLoD(ZT8,GetLocalPlayer())or IsObserver(GetLocalPlayer()))
  //else
  //	call SetTextTagVisibility(tt,false)
  //endif
  set tt=null
endfunction

function ZW8 takes player p,string ZS8,real SB8,unit ZT8,real ZV8,integer r,integer g,integer b,integer a returns nothing
  local texttag tt=CreateTextTag()
  call SetTextTagText(tt,ZS8,ZV8)
  call SetTextTagPosUnit(tt,ZT8,64)
  call SetTextTagColor(tt,r,g,b,a)
  call SetTextTagVelocity(tt,0,.0355)
  call SetTextTagFadepoint(tt,2)
  call SetTextTagPermanent(tt,false)
  call SetTextTagLifespan(tt,SB8)
  //if IsPlayerAlly(GetLocalPlayer(),p) or IsObserver(GetLocalPlayer())then
  call SetTextTagVisibility(tt,IsPlayerAlly(GetLocalPlayer(),p) or IsObserver(GetLocalPlayer()))
  //else
  //	call SetTextTagVisibility(tt,false)
  //endif
  set tt=null
endfunction

function ReturnTrue takes nothing returns boolean
  return true
endfunction

function TriggerRegisterAnyUnitEvent takes trigger t,playerunitevent pue returns nothing
  local integer i=0
  loop
    call TriggerRegisterPlayerUnitEvent(t,Player(i),pue,Condition(function ReturnTrue))
    set i=i+1
    exitwhen i==16
  endloop
endfunction

function TriggerRegisterHumanUnitEvent takes trigger t,playerunitevent pue returns nothing
  local integer i=1
  loop
    exitwhen i>5
    call TriggerRegisterPlayerUnitEvent(t,Sentinels[i],pue,Condition(function ReturnTrue))
    call TriggerRegisterPlayerUnitEvent(t,Scourges[i],pue,Condition(function ReturnTrue))
    set i=i+1
  endloop
endfunction

function ZC8 takes nothing returns nothing
  if WA8(GetEnumDestructable())and IsDestructableAliveBJ(GetEnumDestructable())then
    set TreesKilled=TreesKilled+1
    call KillDestructable(GetEnumDestructable())
  endif
endfunction

function KillTrees takes real x,real y,real d returns integer
  local rect r=Rect(x-d,y-d,x+d,y+d)
  set TreesKilled=0
  call EnumDestructablesInRect(r,Condition(function ReturnTrue2),function ZC8)
  call RemoveRect(r)
  set r=null
  return TreesKilled
endfunction

function IsTerrainPathableFixed takes real x,real y returns boolean
  return( not(IsTerrainPathable(x,y,PATHING_TYPE_WALKABILITY)))
endfunction

function PlaySoundAtPos takes sound Z18,real x,real y returns nothing
  call SetSoundPosition(Z18,x,y,0)
  call SetSoundVolume(Z18,127)
  set bj_lastPlayedSound=Z18
  if(Z18!=null)then
    call StartSound(Z18)
  endif
endfunction

function TimedReveal_End takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local fogmodifier f=(LoadFogModifierHandle(hashtable019,(Cache),(42)))
  call FogModifierStop(f)
  call DestroyFogModifier(f)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set f=null
  return false
endfunction

function TimedReveal takes player p,real SB8,real x,real y,real r returns nothing
  local trigger t=CreateTrigger()
  local fogmodifier Z58=CreateFogModifierRadius(p,FOG_OF_WAR_VISIBLE,x,y,r,true,true)
  call FogModifierStart(Z58)
  call SaveFogModifierHandle(hashtable019,(GetHandleId(t)),(42),(Z58))
  call TriggerRegisterTimerEvent(t,SB8,false)
  call TriggerAddCondition(t,Condition(function TimedReveal_End))
  set Z58=null
  set t=null
endfunction

function GroupCount_Helper takes nothing returns nothing
  set bj_groupCountUnits=bj_groupCountUnits+1
endfunction

function A48 takes nothing returns nothing
  local destructable d = GetEnumDestructable()
  
  if(WA8(d)or GetDestructableTypeId(d)=='B005')and GetWidgetLife(d)>0 then
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ThunderClap\\ThunderClapCaster.mdl",GetWidgetX(GetEnumDestructable()),GetWidgetY(GetEnumDestructable())))
    set tt_bool1=true
  endif
  
  set d = null
endfunction

function A78 takes real x,real y,real d returns boolean
  local rect r=Rect(x-d,y-d,x+d,y+d)
  set tt_bool1=false
  call EnumDestructablesInRect(r,Condition(function ReturnTrue2),function A48)
  call RemoveRect(r)
  set r=null
  return tt_bool1
endfunction

function A88 takes nothing returns nothing
  call PauseUnit(GetEnumUnit(),true)
endfunction

function A98 takes nothing returns boolean
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,0,0,16000,Condition(function ReturnTrue))
  call ForGroup(g,function A88)
  call KillGroup(g)
  set g=null
  return false
endfunction

function AD8 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function A98))
  call TriggerEvaluate(t)
  set t=null
endfunction

function IsDead takes unit u returns boolean
  return GetUnitTypeId(u)<1 or IsUnitType(u,UNIT_TYPE_DEAD) or 0.405>GetWidgetLife(u)
endfunction

function FixPassivesPlz takes nothing returns nothing
  local integer pid=GetPlayerId(GetTriggerPlayer())
  local integer i=1
  local integer lvl
  local unit u=udg_Hero[pid]
  if u!=null and IsDead(u)==false then
    loop
      set lvl=GetUnitAbilityLevel(u,PassivesLearningSkill[i])
      if lvl==0 then
        set lvl=GetUnitAbilityLevel(u,PassivesLearningSkillUpg[i])
      endif
      if lvl==0 and (GetUnitAbilityLevel(u,PassivesRealID[i])>0 or GetUnitAbilityLevel(u,PassivesSpellbookID[i])>0) then
        call UnitRemoveAbility(u,PassivesRealID[i])
        call UnitRemoveAbility(u,PassivesSpellbookID[i])
        call UnitRemoveAbility(u,PassivesBuffID[i])
      endif
      set i=i+1
      exitwhen i>PassivesCount
    endloop
  endif
  set u=null
endfunction

function AH8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8
  local unit Target
  local integer AI8
  local unit Source
  local real AJ8
  local unit Projectile
  local real x
  local real y
  local real TargetX
  local real TargetY
  local real AM8
  local real AN8
  local real AO8
  local real AP8
  local boolean disjointed
  local real lastX
  local real lastY
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if IsDisjointSpell(GetSpellAbilityId()) then
      
      call SaveBoolean(hashtable019,Cache,-1,true)
      call SaveReal(hashtable019,Cache,-1,GetUnitX(GetTriggerUnit()))
      call SaveReal(hashtable019,Cache,-2,GetUnitY(GetTriggerUnit()))
    endif
  else
    set XK8=(LoadInteger(hashtable019,(Cache),(30)))
    set Target=UnitAsInteger_Load(XK8)
    set AI8=(LoadInteger(hashtable019,(Cache),(43)))
    set Source=UnitAsInteger_Load(AI8)
    set AJ8=(LoadReal(hashtable019,(Cache),(44)))
    set Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
    set x=GetUnitX(Projectile)
    set y=GetUnitY(Projectile)
    set TargetX=GetUnitX(Target)
    set TargetY=GetUnitY(Target)
    set AM8=AJ8*.03
    if(LoadBoolean(hashtable019,Cache,-1))then
      
      set TargetX=LoadReal(hashtable019,Cache,-1)
      set TargetY=LoadReal(hashtable019,Cache,-2)
    endif
    set AN8=AngleBetweenXY(x,y,TargetX,TargetY)
    set AO8=x+AM8*Cos(AN8*bj_DEGTORAD)
    set AP8=y+AM8*Sin(AN8*bj_DEGTORAD)
    
    call SetUnitX(Projectile,AO8)
    call SetUnitY(Projectile,AP8)
    call SetUnitFacing(Projectile,AN8)
    if IsDead(Target)then
      call KillUnit(Projectile)
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    elseif DistanceBetweenXY(TargetX,TargetY,AO8,AP8)<=AM8 then
      call KillUnit(Projectile)
      set tt_unit1=Source
      set tt_unit2=Target
      if LoadBoolean(hashtable019,Cache,-1)==false then
        //call BJDebugMsg("fired "+(LoadStr(HY,(Cache),(46))))
        if LoadStr(hashtable019,Cache,46)!=null and LoadStr(hashtable019,Cache,46)!="" then
          call ExeFunc(LoadStr(hashtable019,Cache,46))
        endif
      endif
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set Target=null
  set Source=null
  set Projectile=null
  return false
endfunction

function AddProjectile takes unit Source,unit Target,integer AR8,string AS8,real AJ8, boolean CanBeDisjoined returns trigger
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real AT8=GetUnitFacing(Source)
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function AH8))
  call SaveReal(hashtable019,(Cache),(44),((AJ8)*1.))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveStr(hashtable019,(Cache),(46),(AS8))
  call SaveInteger(hashtable019,(Cache),(43),(UnitAsInteger_Save(Source)))
  call SaveBoolean(hashtable019,Cache,-1,false)
  if CanBeDisjoined then
    
    call SaveReal(hashtable019,Cache,-1,0)
    call SaveReal(hashtable019,Cache,-2,0)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_SPELL_EFFECT)
  endif
  call SaveUnitHandle(hashtable019,(Cache),(45),(CreateUnit(GetOwningPlayer(Source),AR8,SourceX,SourceY,AT8)))
  set integer029=t
  set t=null
  return integer029
endfunction

function MoveProjectileToXY_Move takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local real AJ8=(LoadReal(hashtable019,(Cache),(44)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real x=GetUnitX(Projectile)
  local real y=GetUnitY(Projectile)
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real AM8=AJ8*.03
  local real AN8=AngleBetweenXY(x,y,TargetX,TargetY)
  local real AO8=x+AM8*Cos(AN8*bj_DEGTORAD)
  local real AP8=y+AM8*Sin(AN8*bj_DEGTORAD)
  call SetUnitX(Projectile,AO8)
  call SetUnitY(Projectile,AP8)
  if DistanceBetweenXY(TargetX,TargetY,AO8,AP8)<=AM8 then
    call KillUnit(Projectile)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Projectile=null
  return false
endfunction

function DamageProjectile_Move takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real AJ8=(LoadReal(hashtable019,(Cache),(44)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real x=GetUnitX(Projectile)
  local real y=GetUnitY(Projectile)
  local real TargetX=GetUnitX(Target)
  local real TargetY=GetUnitY(Target)
  local real AM8=AJ8*.03
  local real AN8=AngleBetweenXY(x,y,TargetX,TargetY)
  local real AO8=x+AM8*Cos(AN8*bj_DEGTORAD)
  local real AP8=y+AM8*Sin(AN8*bj_DEGTORAD)
  call SetUnitX(Projectile,AO8)
  call SetUnitY(Projectile,AP8)
  call SetUnitFacing(Projectile,AN8)
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call KillUnit(Projectile)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif DistanceBetweenXY(TargetX,TargetY,AO8,AP8)<=AM8 then
    call DamageTarget((LoadUnitHandle(hashtable019,(Cache),(2))),Target,(LoadInteger(hashtable019,(Cache),(36))),(LoadReal(hashtable019,(Cache),(20))))
    call KillUnit(Projectile)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  set Projectile=null
  return false
endfunction

function DelayedLocust_Helper takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  call UnitAddAbility((LoadUnitHandle(hashtable019,(Cache),(26))),'Aloc')
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function AU8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=GetTriggerEvalCount(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real AV8=(LoadReal(hashtable019,(Cache),(49)))
  local real U68=AV8-(AV8-U18(Hero))*Count/ 40
  if Count>40 or IsDead(Hero)then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SetUnitScale(Hero,U68,U68,U68)
  endif
  set t=null
  set Hero=null
  return false
endfunction

function AW8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real AX8=(LoadReal(hashtable019,(Cache),(50)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.025,true)
  call TriggerAddCondition(t,Condition(function AU8))
  set Cache=GetHandleId(t)
  call SaveReal(hashtable019,(Cache),(49),((AX8)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  set t=null
  set Hero=null
  return false
endfunction

function AY8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=GetTriggerEvalCount(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real AZ8=((LoadReal(hashtable019,(Cache),(51)))-U18(Hero))*Count/ 40
  local real U68=U18(Hero)+AZ8
  if Count>40 or IsDead(Hero)then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SetUnitScale(Hero,U68,U68,U68)
  endif
  set t=null
  set Hero=null
  return false
endfunction

function AA8 takes unit Hero,real SB8,real U68 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real AB8=U68*U18(Hero)
  local real AX8=AB8
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveReal(hashtable019,(Cache),(50),((AX8)*1.))
  call TriggerRegisterTimerEvent(t,SB8,false)
  call TriggerAddCondition(t,Condition(function AW8))
  if SB8>3 then
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,.025,true)
    call TriggerAddCondition(t,Condition(function AY8))
    set Cache=GetHandleId(t)
    call SaveReal(hashtable019,(Cache),(51),((AB8)*1.))
    call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  else
    call SetUnitScale(Hero,AX8,AX8,AX8)
  endif
  set t=null
endfunction

function AC8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer A38=(LoadInteger(hashtable019,(Cache),(52)))
  if Hero!=null then
    call UnitRemoveAbility(Hero,A38)
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  return false
endfunction

function A68 takes unit u,integer A38,real SB8 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call UnitAddAbility2(u,A38)
  call TriggerRegisterTimerEvent(t,SB8,false)
  call TriggerAddCondition(t,Condition(function AC8))
  call SaveUnitHandle(hashtable019,(Cache),(14),(u))
  call SaveInteger(hashtable019,(Cache),(52),(A38))
  set t=null
endfunction

function AL8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit u=(LoadUnitHandle(hashtable019,(Cache),(53)))
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  call UnitShareVision(u,p,false)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set u=null
  set p=null
  return false
endfunction

function ShareUnitVisionTimed_Add takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit u=GetTriggerUnit()
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  call UnitShareVision(u,p,true)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function AL8))
  call SavePlayerHandle(hashtable019,(Cache),(54),(p))
  call SaveUnitHandle(hashtable019,(Cache),(53),(u))
  set t=null
  set u=null
  set p=null
  return false
endfunction

function DummyProjectileMoving takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit target=LoadUnitHandle(hashtable019,h,30)
  local unit caster=LoadUnitHandle(hashtable019,h,43)
  //local unit target=LoadUnitAsInteger(LoadInteger(HY , h , 30))
  //local unit caster=LoadUnitAsInteger(LoadInteger(HY , h , 43))
  local real speed=LoadReal(hashtable019 , h , 44)
  local unit projectile=LoadUnitHandle(hashtable019 , h , 45)
  local real xp=GetUnitX(projectile)
  local real yp=GetUnitY(projectile)
  local real xt=GetUnitX(target)
  local real yt=GetUnitY(target)
  local real Distance=speed * 0.03
  local real angle=AngleBetweenXY(xp , yp , xt , yt)
  local real dx=xp + Distance * Cos(angle * bj_DEGTORAD)
  local real dy=yp + Distance * Sin(angle * bj_DEGTORAD)
  call SetUnitX(projectile , dx)
  call SetUnitY(projectile , dy)
  call SetUnitFacing(projectile , angle)
  if IsDead(target) then
    call KillUnit(projectile)
    call FlushChildHashtable(hashtable019 , h)
    call DestroyTrigger(t)
  elseif DistanceBetweenXY(xt , yt , dx , dy) <= Distance then
    call KillUnit(projectile)
    set TempCaster = caster
    set TempTarget = target
    call ExeFunc(LoadStr(hashtable019 , h , 46))
    call FlushChildHashtable(hashtable019 , h)
    call DestroyTrigger(t)
  endif
  set t = null
  set target = null
  set projectile = null
  set caster = null
  return false
endfunction

function CreateDummyProjectile takes unit caster,unit target,integer projectile,string callback,real speed returns trigger
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local real x=GetUnitX(caster)
  local real y=GetUnitY(caster)
  local real face=GetUnitFacing(caster)
  call TriggerRegisterTimerEvent(t , 0.03 , true)
  call TriggerAddCondition(t , Condition(function DummyProjectileMoving))
  call SaveReal(hashtable019 , h , 44 , speed)
  //call SaveInteger(HY , h , 30 , SaveUnitAsInteger(target))
  call SaveUnitHandle(hashtable019,h,30,target)
  call SaveStr(hashtable019 , h , 46 , callback)
  call SaveUnitHandle(hashtable019,h,43,caster)
  //call SaveInteger(HY , h , 43 , SaveUnitAsInteger(caster))
  call SaveUnitHandle(hashtable019 , h , 45 , CreateUnit(GetOwningPlayer(caster) , projectile , x , y , face))
  set TempTrigger = t
  set t = null
  return TempTrigger
endfunction

function A18 takes nothing returns nothing
  set bj_groupCountUnits=bj_groupCountUnits+1
endfunction

function A08 takes group g returns integer
  set bj_groupCountUnits=0
  call ForGroup(g,function A18)
  return bj_groupCountUnits
endfunction

function A58 takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local fogmodifier Z58=(LoadFogModifierHandle(hashtable019,(h),(42)))
  call FogModifierStop(Z58)
  call DestroyFogModifier(Z58)
  call FlushChildHashtable(hashtable019,(h))
  call PauseTimer(t)
  call DestroyTimer(t)
  set t=null
  set Z58=null
endfunction

function A28 takes fogmodifier Z58,real SB8 returns nothing
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call FogModifierStart(Z58)
  call SaveFogModifierHandle(hashtable019,h,42,Z58)
  call TimerStart(t,SB8,false,function A58)
  set t=null
endfunction

function B48 takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local integer B78=LoadInteger(hashtable019,h,55)
  local destructable d=T08(B78)
  if d!=null then
    call RemoveDestructable(d)
  endif
  call T28(B78)
  call FlushChildHashtable(hashtable019,h)
  call PauseTimer(t)
  call DestroyTimer(t)
  set d=null
  set t=null
endfunction

function B88 takes destructable d,real delay returns nothing
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call TimerStart(t,delay,false,function B48)
  call SaveInteger(hashtable019,h,55,U48(d))
  set t=null
endfunction

function B98 takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit Hero=LoadUnitHandle(hashtable019,h,14)
  local integer id=LoadInteger(hashtable019,h,52)
  if Hero!=null and GetUnitAbilityLevel(Hero,id)>0 then
    call UnitRemoveAbility(Hero,id)
  endif
  call FlushChildHashtable(hashtable019,h)
  call PauseTimer(t)
  call DestroyTimer(t)
  set t=null
  set Hero=null
endfunction

function BD8 takes unit u,integer id,real delay returns nothing
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call TimerStart(t,delay,false,function B98)
  call SaveUnitHandle(hashtable019,h,14,u)
  call SaveInteger(hashtable019,h,52,id)
  set t=null
endfunction

function BE8 takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  call SetUnitAnimation(LoadUnitHandle(hashtable019,h,53),"stand")
  call FlushChildHashtable(hashtable019,h)
  call PauseTimer(t)
  call DestroyTimer(t)
  set t=null
endfunction

function BF8 takes unit u,real SB8 returns nothing
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call SaveUnitHandle(hashtable019,h,53,u)
  call TimerStart(t,SB8,false,function BE8)
  set t=null
endfunction

function BG8 takes real SB8,boolean BH8,real x,real y,real BI8,real BJ8,real BK8,real BM8,real BN8 returns nothing
  local real BO8
  local real BP8
  local real BQ8
  if(BJ8<=0 or BN8<=0 or BM8<=0)then
    return
  endif
  set BP8=2.*SB8/ BM8
  set BO8=2.*BJ8/ BN8
  set BQ8=BI8/ BJ8
  call TerrainDeformRipple(x,y,BJ8,BK8,R2I(SB8*1000),1,BO8,BP8,BQ8,BH8)
endfunction

function ImitateBountyGain takes player whichPlayer,unit whichUnit,integer gold returns nothing
  local texttag t
  set t=CreateTextTag()
  if GetHandleId(t)>0 then
    call SetPlayerState(whichPlayer,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(whichPlayer,PLAYER_STATE_RESOURCE_GOLD)+gold)
    call SetTextTagText(t,"+"+I2S(gold),.025)
    call SetTextTagPosUnit(t,whichUnit,-0.4)
    call SetTextTagColor(t,255,220,0,255)
    call SetTextTagVelocity(t,0,.03)
    call SetTextTagVisibility(t,GetLocalPlayer()==whichPlayer)
    call SetTextTagFadepoint(t,2)
    call SetTextTagLifespan(t,3)
    call SetTextTagPermanent(t,false)
  else
    call DestroyTextTag(t)
  endif
  set t=null
endfunction

function Func1592 takes nothing returns boolean
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  call FlushChildHashtable(hashtable019,(GetHandleId((LoadUnitHandle(hashtable019,(h),(26))))))
  call ShowUnit(LoadUnitHandle(hashtable019,h,26),false)
  call RemoveUnit(LoadUnitHandle(hashtable019,h,26))
  call FlushChildHashtable(hashtable019,h)
  call PauseTimer(t)
  call DestroyTimer(t)
  set t=null
  return false
endfunction

function BT8 takes unit u,real d returns nothing
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call TimerStart(t,d,false,function Func1592)
  call SaveUnitHandle(hashtable019,h,26,u)
  set t=null
endfunction

function KillUnitTimed_Expire takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  call FlushChildHashtable(hashtable019,(GetHandleId((LoadUnitHandle(hashtable019,(Cache),(26))))))
  call ShowUnit((LoadUnitHandle(hashtable019,(Cache),(26))),false)
  call KillUnit((LoadUnitHandle(hashtable019,(Cache),(26))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function HideUnitTimed_Expire takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  call FlushChildHashtable(hashtable019,(GetHandleId((LoadUnitHandle(hashtable019,(Cache),(26))))))
  call ShowUnit((LoadUnitHandle(hashtable019,(Cache),(26))),false)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function BU8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  call RemoveUnit((LoadUnitHandle(hashtable019,(Cache),(26))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function BV8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  call KillUnit((LoadUnitHandle(hashtable019,(Cache),(26))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function BW8 takes unit u,real d returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,d,false)
  call TriggerAddCondition(t,Condition(function BV8))
  call SaveUnitHandle(hashtable019,(Cache),(26),(u))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,d+.01,false)
  call TriggerAddCondition(t,Condition(function BU8))
  call SaveUnitHandle(hashtable019,(Cache),(26),(u))
  set t=null
endfunction

function BX8 takes sound Z18 returns nothing
  if Z18!=null then
    if SoundsMuted[GetPlayerId(GetLocalPlayer())]==false then
      call StartSound(Z18)
    endif
  endif
endfunction

function BY8 takes sound Z18,player XS8 returns nothing
  if GetLocalPlayer()==XS8 and SoundsMuted[GetPlayerId(XS8)]==false then
    call StartSound(Z18)
  endif
endfunction

function BZ8 takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false)!=null
endfunction

function BA8 takes nothing returns nothing
  call BY8(sound060,GetOwningPlayer(GetEnumUnit()))
endfunction

function BB8 takes unit Source,sound Z18,real x,real y,real r returns nothing
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  set sound060=Z18
  call GroupEnumUnitsInRange(g,x,y,r,Condition(function BZ8))
  call GroupRemoveUnit(g,Source)
  call ForGroup(g,function BA8)
  call KillGroup(g)
  set g=null
endfunction

function BC8 takes unit whichUnit,item B38 returns integer
  local integer i=0
  loop
    exitwhen i>5
    if UnitItemInSlot(whichUnit,i)==B38 then
      return i
    endif
    set i=i+1
  endloop
  return-1
endfunction

function DelayedSetUnitPosition_Helper takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit whichUnit=(LoadUnitHandle(hashtable019,(Cache),(56)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  call SetUnitPosition(whichUnit,x,y)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set whichUnit=null
  return false
endfunction

function B68 takes real n1,real n2 returns integer
  if n1/ n2-R2I(n1/ n2)>=.5 then
    return R2I(n1/ n2)+1
  endif
  return R2I(n1/ n2)
endfunction

function BL8 takes player p returns nothing
  if GetLocalPlayer()==p then
    call ClearTextMessages()
  endif
endfunction

function B18 takes unit u,real d returns nothing
  call SetUnitState(u,UNIT_STATE_LIFE,RMaxIF(GetUnitState(u,UNIT_STATE_LIFE)-d,1))
endfunction

function B08 takes integer B58 returns nothing
  local unit u=CreateUnit(Player(15),B58,0,0,0)
  call RemoveUnit(u)
  set u=null
endfunction

function B28 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit u=(LoadUnitHandle(hashtable019,(Cache),(53)))
  local real SB8=(LoadReal(hashtable019,(Cache),(57)))
  local integer C48=(LoadInteger(hashtable019,(Cache),(58)))
  if GetTriggerEvalCount(t)/ 10>R2I(SB8)then
    call SetUnitVertexColor(u,255,100,255,255)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif IsDead(u)==false then
    call SetUnitVertexColor(u,255,100,255,C48)
  endif
  set t=null
  set u=null
  return false
endfunction

function C78 takes unit u,real SB8,integer C48 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function B28))
  call SaveUnitHandle(hashtable019,(Cache),(53),(u))
  call SaveReal(hashtable019,(Cache),(57),((SB8)*1.))
  call SaveInteger(hashtable019,(Cache),(58),(C48))
  set t=null
endfunction

function DistribGoldToPlayerForUnit takes player C98,integer CD8,unit CE8 returns nothing
  local texttag t=CreateTextTag()
  local string s="UI\\Feedback\\GoldCredit\\GoldCredit.mdl"
  call SetPlayerState(C98,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(C98,PLAYER_STATE_RESOURCE_GOLD)+CD8)
  call SetTextTagText(t,"+"+I2S(CD8),.025)
  call SetTextTagPosUnit(t,CE8,0)
  call SetTextTagColor(t,255,220,0,255)
  call SetTextTagVelocity(t,0,.03)
  if GetLocalPlayer()!=C98 then
    set s=""
  endif
  call SetTextTagVisibility(t,GetLocalPlayer()==C98)
  if GetUnitState(CE8,UNIT_STATE_LIFE)>.5 then
    call DestroyEffect(AddSpecialEffectTarget(s,CE8,"overhead"))
  endif
  call SetTextTagFadepoint(t,2)
  call SetTextTagLifespan(t,3)
  call SetTextTagPermanent(t,false)
  set t=null
endfunction

function CF8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer CG8=(LoadInteger(hashtable019,(Cache),(59)))
  if UnitRemoveAbility(Target,CG8) or GetUnitAbilityLevel(Target,CG8)==0 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  return false
endfunction

function CH8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer CG8=(LoadInteger(hashtable019,(Cache),(59)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  if UnitRemoveAbility(Target,CG8)==false then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function CF8))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveInteger(hashtable019,(Cache),(59),(CG8))
  endif
  set t=null
  set Target=null
  return false
endfunction

function AddTimedAbility takes unit Target,integer CG8,integer Level,real SB8 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call UnitAddAbility2(Target,CG8)
  call SetUnitAbilityLevel(Target,CG8,Level)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,SB8,false)
  call TriggerAddCondition(t,Condition(function CH8))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(59),(CG8))
  set t=null
endfunction

function CJ8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer CG8=(LoadInteger(hashtable019,(Cache),(59)))
  local integer CK8=(LoadInteger(hashtable019,(Cache),(59)))
  call UnitRemoveAbility(Target,CK8)
  if UnitRemoveAbility(Target,CG8) or GetUnitAbilityLevel(Target,CG8)==0 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  return false
endfunction

function CM8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer CG8=(LoadInteger(hashtable019,(Cache),(59)))
  local integer CK8=(LoadInteger(hashtable019,(Cache),(60)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call UnitRemoveAbility(Target,CK8)
  if UnitRemoveAbility(Target,CG8)==false then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function CJ8))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveInteger(hashtable019,(Cache),(59),(CG8))
    call SaveInteger(hashtable019,(Cache),(60),(CK8))
  endif
  set t=null
  set Target=null
  return false
endfunction

function CN8 takes unit Target,integer CG8,integer Level,real SB8,integer CK8 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call UnitAddAbility2(Target,CG8)
  call SetUnitAbilityLevel(Target,CG8,Level)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,SB8,false)
  call TriggerAddCondition(t,Condition(function CM8))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(59),(CG8))
  call SaveInteger(hashtable019,(Cache),(60),(CK8))
  set t=null
endfunction

function CO8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer CP8=(LoadInteger(hashtable019,(Cache),(61)))
  local integer CQ8=(LoadInteger(hashtable019,(Cache),(62)))
  local unit u1=UnitAsInteger_Load(CP8)
  local unit u2=UnitAsInteger_Load(CQ8)
  local real SB8=(LoadReal(hashtable019,(Cache),(57)))
  local lightning ZQ8=(LoadLightningHandle(hashtable019,(Cache),(41)))
  if I2R(GetTriggerEvalCount(t))*.025>SB8 then
    call DestroyLightning(ZQ8)
    call UnitAsInteger_Clear(CP8)
    call UnitAsInteger_Clear(CQ8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call MoveLightning(ZQ8,true,GetUnitX(u1),GetUnitY(u1),GetUnitX(u2),GetUnitY(u2))
  endif
  set t=null
  set u1=null
  set u2=null
  set ZQ8=null
  return false
endfunction

function CR8 takes string ZP8,unit u1,unit u2,real r,real g,real b,real a,real SB8 returns nothing
  local real x1=GetUnitX(u1)
  local real y1=GetUnitY(u1)
  local real x2=GetUnitX(u2)
  local real y2=GetUnitY(u2)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local lightning ZQ8=AddLightning(ZP8,true,x1,y1,x2,y2)
  call SetLightningColor(ZQ8,r,g,b,a)
  call SaveLightningHandle(hashtable019,(Cache),(41),(ZQ8))
  call SaveInteger(hashtable019,(Cache),(61),(UnitAsInteger_Save(u1)))
  call SaveInteger(hashtable019,(Cache),(62),(UnitAsInteger_Save(u2)))
  call SaveReal(hashtable019,(Cache),(57),((SB8)*1.))
  call TriggerRegisterTimerEvent(t,.025,true)
  call TriggerAddCondition(t,Condition(function CO8))
  set t=null
  set ZQ8=null
endfunction

function CS8 takes string CT8 returns nothing
  local sound CU8=CreateSound(CT8,false,false,false,10,10,"")
  call SetSoundVolume(CU8,0)
  call StartSound(CU8)
  call KillSoundWhenDone(CU8)
  set CU8=null
endfunction

function CV8 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local ubersplat Splat=(LoadUbersplatHandle(hashtable019,(Cache),(131)))
  call DestroyUbersplat(Splat)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Splat=null
  return false
endfunction

function CX8 takes ubersplat Splat,real d returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveUbersplatHandle(hashtable019,(Cache),(131),(Splat))
  call TriggerRegisterTimerEvent(t,d,false)
  call TriggerAddCondition(t,Condition(function CV8))
  set t=null
endfunction

function CY8 takes nothing returns nothing
  local real d=DistanceBetweenXY(GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),JJ,KJ)
  if d<YJ then
    set YJ=d
    set XJ=GetEnumUnit()
  endif
endfunction

function CZ8 takes group g,real x,real y returns unit
  set YJ=999999
  set XJ=null
  set JJ=x
  set KJ=y
  call ForGroup(g,function CY8)
  return XJ
endfunction

function IsSpiritBear takes unit Unit returns boolean
  return GetUnitTypeId(Unit)=='n004' or GetUnitTypeId(Unit)=='n018' or GetUnitTypeId(Unit)=='n01C' or GetUnitTypeId(Unit)=='n01G'
endfunction

function CL8 takes player p returns nothing
  local unit Hero=udg_Hero[GetPlayerId(p)]
  local integer i=0
  local item Item
  loop
    exitwhen i>5
    set Item=UnitItemInSlot(Hero,i)
    call SetItemDroppable(Item,false)
    set i=i+1
  endloop
  set Hero=null
  set Item=null
endfunction

function C08 takes player p returns nothing
  local unit Hero=udg_Hero[GetPlayerId(p)]
  local integer i=0
  local item Item
  loop
    exitwhen i>5
    set Item=UnitItemInSlot(Hero,i)
    call SetItemDroppable(Item,true)
    set i=i+1
  endloop
  set Hero=null
  set Item=null
endfunction

function C58 takes unit u returns boolean
  return GetUnitAbilityLevel(u,'Aetl')>0 or GetUnitAbilityLevel(u,'Bcyc')>0 or GetUnitAbilityLevel(u,'Bcy2')>0 or GetUnitAbilityLevel(u,'B01N')>0
endfunction

function IsUnitEntangled takes unit u returns boolean
  return(GetUnitAbilityLevel((u),('B0C1'))>0)or(GetUnitAbilityLevel((u),('BEer'))>0)or(GetUnitAbilityLevel((u),('Beng'))>0)or(GetUnitAbilityLevel((u),('Bena'))>0)or(GetUnitAbilityLevel((u),('B017'))>0)or(GetUnitAbilityLevel((u),('B078'))>0)or(GetUnitAbilityLevel((u),('B08F'))>0)or(GetUnitAbilityLevel((u),('B08E'))>0)or(GetUnitAbilityLevel((u),('B0ER'))>0)or(GetUnitAbilityLevel((u),('B0FN'))>0)
endfunction

function IsUnitInvulnerable takes unit u returns boolean
  if GetUnitAbilityLevel(u,'B02J')>0 or GetUnitAbilityLevel(u,'BUsp')>0 or GetUnitAbilityLevel(u,'Bust')>0 or C58(u) then
    return true
  endif
  
  return false
endfunction

function L48 takes unit u returns nothing
  call UnitRemoveAbility(u,'B0C1')
  call UnitRemoveAbility(u,'BEer')
  call UnitRemoveAbility(u,'Beng')
  call UnitRemoveAbility(u,'Bena')
  call UnitRemoveAbility(u,'B017')
  call UnitRemoveAbility(u,'B078')
  call UnitRemoveAbility(u,'B08F')
  call UnitRemoveAbility(u,'B08E')
  call UnitRemoveAbility(u,'B0ER')
  call UnitRemoveAbility(u,'B0FN')
endfunction

function IsUnitDisabled takes unit u returns boolean
  return(GetUnitAbilityLevel((u),('B00H'))>0)or(GetUnitAbilityLevel((u),('BOhx'))>0)or(GetUnitAbilityLevel((u),('BPSE'))>0)or(GetUnitAbilityLevel((u),('B099'))>0)or(GetUnitAbilityLevel((u),('BSTN'))>0)or(GetUnitAbilityLevel((u),('B0CF'))>0)or(GetUnitAbilityLevel((u),('B0BM'))>0)or(GetUnitAbilityLevel((u),('B06M'))>0)or(GetUnitAbilityLevel((u),('B07N'))>0)or(GetUnitAbilityLevel((u),('B08S'))>0)or(GetUnitAbilityLevel((u),('B00Q'))>0)or(GetUnitAbilityLevel((u),('B04V'))>0)or(GetUnitAbilityLevel((u),('B072'))>0)or(GetUnitAbilityLevel((u),('BUan'))>0)or(GetUnitAbilityLevel((u),('B095'))>0)or(GetUnitAbilityLevel((u),('B03I'))>0)or(GetUnitAbilityLevel((u),('B0AD'))>0)or(GetUnitAbilityLevel((u),('B0AE'))>0)or(GetUnitAbilityLevel((u),('B0BE'))>0)or(GetUnitAbilityLevel((u),('B0BF'))>0)or(GetUnitAbilityLevel((u),('B008'))>0)or(GetUnitAbilityLevel((u),('B04B'))>0)or(GetUnitAbilityLevel((u),('B02F'))>0)or(GetUnitAbilityLevel((u),('BUsp'))>0)or(GetUnitAbilityLevel((u),('BUst'))>0)or(GetUnitAbilityLevel((u),('B0DD'))>0)or((LoadInteger(hashtable019,(GetHandleId((u))),((4293))))==1) or((LoadInteger(hashtable019,(GetHandleId((u))),((4303))))==1)or(GetUnitAbilityLevel((u),('B0C2'))>0)or(GetUnitAbilityLevel((u),('B06S'))>0)or(GetUnitAbilityLevel((u),('B02S'))>0)or GetUnitAbilityLevel(u,'B07E')>0 or GetUnitAbilityLevel(u,'B00Q')>0
endfunction

function L88 takes unit u returns boolean
  return IsUnitDisabled(u)or IsUnitEntangled(u)or IsUnitPaused(u)or IsUnitCycloned(u)
endfunction

function L98 takes integer Minutes,integer Seconds,boolean extraColor returns nothing
  local integer x=0
  loop
    exitwhen x>15
    call SetPlayerState(Player(x),PLAYER_STATE_RESOURCE_LUMBER,Minutes)
    call SetPlayerState(Player(x),PLAYER_STATE_RESOURCE_FOOD_USED,Seconds)
    set x=x+1
  endloop
endfunction

function IsUnitBADWithSpellbooks takes unit u returns boolean
  local integer id=GetUnitTypeId(u)
  return id=='n027' or id=='u014' or id=='u015' or id=='u016' or id=='u01D' or id=='u01E' or id=='u01F' or id=='u017' or id=='u019' or id=='u018' or id=='u01A' or id=='u01B' or id=='u01C'
endfunction

function SetUnitInvulAdvanced takes unit u,boolean b returns nothing
  call SetUnitInvulnerable(u,b)
  call SaveBoolean(hashtable019,(GetHandleId(u)),(509),(b))
endfunction

function IsUnitInvulAdvanced takes unit u returns boolean
  return(LoadBoolean(hashtable019,(GetHandleId(u)),(509)))or GetUnitAbilityLevel(u,'Avul')>0
endfunction

function LI8 takes real x,real y returns location
  local real AO8
  local real AP8
  local integer i=0
  loop
    exitwhen i>40
    set AO8=x+i*20
    set AP8=y+i*20
    if IsPointInRegion(RestrictedRegion,AO8,AP8)==false then
      return Location(AO8,AP8)
    endif
    set AO8=x+i*20
    set AP8=y-i*20
    if IsPointInRegion(RestrictedRegion,AO8,AP8)==false then
      return Location(AO8,AP8)
    endif
    set AO8=x-i*20
    set AP8=y+i*20
    if IsPointInRegion(RestrictedRegion,AO8,AP8)==false then
      return Location(AO8,AP8)
    endif
    set AO8=x-i*20
    set AP8=y-i*20
    if IsPointInRegion(RestrictedRegion,AO8,AP8)==false then
      return Location(AO8,AP8)
    endif
    set i=i+1
  endloop
  return Location(x,y)
endfunction

function GenericCondition_IsDotAInvis takes unit u returns boolean
  return GetUnitAbilityLevel(u,'B068')>0 or GetUnitAbilityLevel(u,'B07T')>0 or GetUnitAbilityLevel(u,'B076')>0 or GetUnitAbilityLevel(u,'BOwk')>0 or GetUnitAbilityLevel(u,'B04R')>0 or GetUnitAbilityLevel(u,'B0A5')>0 or GetUnitAbilityLevel(u,'B01Q')>0 or GetUnitAbilityLevel(u,'B006')>0 or GetUnitAbilityLevel(u,'Binv')>0 or GetUnitAbilityLevel(u,'Apiv')>0 or GetUnitAbilityLevel(u,'A021')>0 or GetUnitAbilityLevel(u,'A0K4')>0 or GetUnitAbilityLevel(u,'A0XB')>0 or GetUnitAbilityLevel(u,'A0Z2')>0 or GetUnitAbilityLevel(u,'A1GA')>0 or GetUnitAbilityLevel(u,'A1HW')>0 or GetUnitAbilityLevel(u,'A1HX')>0 or GetUnitAbilityLevel(u,'A00J')>0 or GetUnitAbilityLevel(u,'B08K')>0 or GetUnitAbilityLevel(u,'B08X')>0 or GetUnitAbilityLevel(u,'B039')>0 or GetUnitAbilityLevel(u,'B00K')>0 or GetUnitAbilityLevel(u,'BHfs')>0 or GetUnitAbilityLevel(u,'A140')>0 or GetUnitAbilityLevel(u,'B021')>0 or GetUnitAbilityLevel(u,'A0ZD')>0 or GetUnitAbilityLevel(u,'A0KT')>0
endfunction

function IsUnitSpiritBear takes unit whichUnit returns boolean
  local integer LM8=GetUnitTypeId(whichUnit)
  return LM8=='n004' or LM8=='n01G' or LM8=='n01C' or LM8=='n018' or LM8=='e00K' or LM8=='e00I' or LM8=='e00L' or LM8=='e01J'
endfunction

function LN8 takes nothing returns boolean
  return(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)!=null
endfunction

function LO8 takes nothing returns boolean
  return((GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and GetUnitAbilityLevel(GetFilterUnit(),'A1RB')==0)!=null
endfunction

function GenericCondition_BasicsAndVisible takes nothing returns boolean
  return((GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit())))!=null
endfunction

function GenericCondition_BasicsAndStructure takes nothing returns boolean
  return GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false
endfunction

function GenericCondition_EnemyUnitsExNoImmuneNoInvisAndStructure takes nothing returns boolean
  return(IsMagicImmune(GetFilterUnit())==false and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function Func1637 takes nothing returns boolean
  return(IsMagicImmune(GetFilterUnit())==false and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function GenericCondition_EnemyUnitsExNoImmuneNoInvisAndStructureWithAncient takes nothing returns boolean
  return IsMagicImmune(GetFilterUnit())==false and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false)
endfunction

function GenericCondition_EnemyUnitsExNoInvisAndStructureWithAncient takes nothing returns boolean
  return IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false)
endfunction

function LR8 takes nothing returns boolean
  return(IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function GenericCondition_EnemyUnitsVisible takes nothing returns boolean
  return((IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit())))!=null
endfunction

function GenericCondition_EnemyUnitsAndVisibleOrWW takes nothing returns boolean
  return((IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and(IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))or GenericCondition_IsDotAInvis(GetFilterUnit())))!=null
endfunction

function LS8 takes nothing returns boolean
  return(IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false))!=null
endfunction

function LT8 takes nothing returns boolean
  return(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1)))!=null
endfunction

function DefaultEnemyFilter takes nothing returns boolean
  return(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function GenericCondition_EnemyUnitsExHeroesVision takes nothing returns boolean
  return((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1)))!=null
endfunction

function GenericCondition_EnemyUnitsExHeroes takes nothing returns boolean
  return((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO))!=null
endfunction

function GenericCondition_EnemyUnitsExHeroesNoDotaInvis takes nothing returns boolean
  return(((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO))and GenericCondition_IsDotAInvis(GetFilterUnit())==false)!=null
endfunction

function LV8 takes nothing returns boolean
  return(((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)))!=null
endfunction

function GenericCondition_EnemyUnitsExNoHeroes takes nothing returns boolean
  return((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==false)!=null
endfunction

function LW8 takes nothing returns boolean
  return((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and GetUnitAbilityLevel(GetFilterUnit(),'A1RB')==0)!=null
endfunction

function NonImmuneEnemyFilter takes nothing returns boolean
  return(IsMagicImmune(GetFilterUnit())==false and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function NonImmuneVisibleEnemyFilter takes nothing returns boolean
  return(IsMagicImmune(GetFilterUnit())==false and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function GenericCondition_EnemyUnitsExNoImmuneNoInvisWithAncient takes nothing returns boolean
  return(IsMagicImmune(GetFilterUnit())==false and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false))!=null
endfunction

function LZ8 takes nothing returns boolean
  return(IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false))!=null
endfunction

function LA8 takes nothing returns boolean
  return(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false))!=null
endfunction

function GenericCondition_EnemyUnitsNoNeutrals takes nothing returns boolean
  return(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and GetOwningPlayer(GetFilterUnit())!=NeutralsPlayer)!=null
endfunction

function LB8 takes nothing returns boolean
  return(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function LC8 takes nothing returns boolean
  return((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==false)!=null
endfunction

function L38 takes nothing returns boolean
  return(IsMagicImmune(GetFilterUnit())==false and(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit()))))!=null
endfunction

function GenericCondition_EnemyUnitsAndStructureWithAncientsEx takes nothing returns boolean
  return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false)
endfunction

function L68 takes nothing returns boolean
  return(IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false))!=null
endfunction

function LL8 takes nothing returns boolean
  return(IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and IsPlayerBelongToTeams(GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false))!=null
endfunction

function L18 takes nothing returns boolean
  return(IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false))!=null
endfunction

function L08 takes nothing returns boolean
  return(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function L58 takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function L28 takes nothing returns boolean
  return((IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) or GetOwningPlayer(GetFilterUnit())==Sentinels[0]or GetOwningPlayer(GetFilterUnit())==Scourges[0])and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function D49 takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitIllusion(GetFilterUnit())==false and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function Func1661 takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function D89 takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function D99 takes nothing returns boolean
  return(IsMagicImmune(GetFilterUnit())==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit()))))!=null
endfunction

function Func0287 takes nothing returns boolean
  return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and GenericCondition_IsDotAInvis(GetFilterUnit())==false
endfunction

function DD9 takes nothing returns boolean
  return((GenericCondition_IsDotAInvis(GetFilterUnit())==false or IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1))==true) and(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit()))))!=null
endfunction

function DE9 takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function GenericCondition_EnemyHeroesExNoDotAInvis takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)or GenericCondition_IsDotAInvis(GetEnumUnit()))!=null
endfunction

function DF9 takes nothing returns boolean
  return(IsMagicImmune(GetFilterUnit())==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit())) and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit()))))!=null
endfunction

function GenericCondition_AllUnits takes nothing returns boolean
  return((GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function DG9 takes nothing returns boolean
  return(((GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and GetUnitAbilityLevel(GetFilterUnit(),'A1RB')==0)!=null
endfunction

function GenericCondition_AllNonNeutrals takes nothing returns boolean
  return((GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and GetOwningPlayer(GetFilterUnit())!=NeutralsPlayer)!=null
endfunction

function DH9 takes nothing returns boolean
  return(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)!=null
endfunction

function DI9 takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and (GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false) and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function GenericCondition_AllHeroesNotSelf takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and GetTriggerUnit()!=GetFilterUnit()and IsUnitIllusion(GetFilterUnit())==false)!=null
endfunction

function GenericCondition_AllHeroesAndIllusions takes nothing returns boolean
  return((GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) or IsUnitIllusion(GetFilterUnit()))and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function GenericCondition_Hero takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO))!=null
endfunction

function GenericCondition_EnemyUnitsExVisible takes nothing returns boolean
  return((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1)))!=null
endfunction

function Func1667 takes nothing returns boolean
  return(((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1)))and GetUnitTypeId(GetFilterUnit())!='n0F5')!=null
endfunction

function GenericCondition_RegularUnits takes nothing returns boolean
  return((GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function GenericCondition_RegularUnitsExVisible takes nothing returns boolean
  return(((GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1)))!=null
endfunction

function DK9 takes nothing returns boolean
  return(IsMagicImmune(GetFilterUnit())==false and((GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1)))!=null
endfunction

function DM9 takes nothing returns boolean
  return(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit()) and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false and GetUnitTypeId(GetFilterUnit())!='n0F5')!=null
endfunction

function GenericCondition_FloatingHeroes takes nothing returns boolean
  return GetUnitTypeId(GetFilterUnit())=='H00E' or GetUnitTypeId(GetFilterUnit())=='H00G' or GetUnitTypeId(GetFilterUnit())=='H00F' or GetUnitTypeId(GetFilterUnit())=='E00P' or GetUnitTypeId(GetFilterUnit())=='N00B' or GetUnitTypeId(GetFilterUnit())=='UC60' or GetUnitTypeId(GetFilterUnit())=='EC77' or GetUnitTypeId(GetFilterUnit())=='U00P' or GetUnitTypeId(GetFilterUnit())=='E02N' or GetUnitTypeId(GetFilterUnit())=='E02O' or GetUnitTypeId(GetFilterUnit())=='O016' or GetUnitTypeId(GetFilterUnit())=='O017' or GetUnitTypeId(GetFilterUnit())=='E02F' or GetUnitTypeId(GetFilterUnit())=='H0DO'
endfunction

function Func1668 takes nothing returns boolean
  return IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(tt_unit1)) and V28(GetFilterUnit())>0
endfunction

function DO9 takes real stundur returns integer
  if stundur>=4. then//2.8
    return 19
  elseif stundur>=3.75 then//2.75
    return 18
  elseif stundur>=3.5 then//2.6
    return 17
  elseif stundur>=3.25 then//2.5
    return 16
  elseif stundur>=3 then//2.4
    return 15
  elseif stundur>=2.75 then//2.25
    return 14
  elseif stundur>=2.5 then//2.20
    return 13
  elseif stundur>=2.25 then//2.0
    return 12
  elseif stundur>=2 then//1.8
    return 11
  elseif stundur>=1.8 then//1.75
    return 10
  elseif stundur>=1.75 then//1.65
    return 9
  elseif stundur>=1.65 then//1.5
    return 8
  elseif stundur>=1.5 then//1.4
    return 7
  elseif stundur>=1.25 then//1.25
    return 6
  elseif stundur>=1.2 then
    return 5
  elseif stundur>=1 then
    return 4
  elseif stundur>=.75 then
    return 3
  elseif stundur>=.5 then
    return 2
  elseif stundur>=.25 then
    return 1
  endif
  return 1
endfunction

function StunTarget takes unit Source,unit Target,real DP9 returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local integer Level=DO9(DP9)
  call UnitAddAbility(Caster,'A0X6')
  call SetUnitAbilityLevel(Caster,'A0X6',Level)
  call IssueTargetOrderById(Caster,852095,Target)
  set Caster=null
endfunction

function DS9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer DT9=(LoadInteger(hashtable019,(Cache),(73)))
  local unit Hero=UnitAsInteger_Load(DT9)
  local integer Count=GetTriggerEvalCount(t)
  local real y=(Count-13)*(Count-13)
  if Count<26 then
    if IsBuggyFlying(Hero)==false then
      call SetUnitFlyHeight(Hero,375-y,0)
    endif
  else
    call PauseUnit(Hero,false)
    if IsBuggyFlying(Hero)==false then
      call SetUnitFlyHeight(Hero,GetUnitDefaultFlyHeight(Hero),0)
    endif
    call DamageTarget((LoadUnitHandle(hashtable019,(Cache),(2))),Hero,1,(LoadReal(hashtable019,(Cache),(20))))
    call StunTarget((LoadUnitHandle(hashtable019,(Cache),(2))),Hero,(LoadReal(hashtable019,(Cache),(57))))
    call UnitAsInteger_Clear(DT9)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Hero=null
  return false
endfunction

function DU9 takes unit Hero,unit Source,real SB8,real DV9,real DW9 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call PauseUnit(Hero,true)
  if IsBuggyFlying(Hero)==false then
    call UnitAddAbility(Hero,'Amrf')
    call UnitRemoveAbility(Hero,'Amrf')
  endif
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Impale\\ImpaleHitTarget.mdl",GetUnitX(Hero),GetUnitY(Hero)))
  call SaveInteger(hashtable019,(Cache),(73),(UnitAsInteger_Save(Hero)))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(20),((DV9)*1.))
  call SaveReal(hashtable019,(Cache),(57),((SB8)*1.))
  call TriggerRegisterTimerEvent(t,.02/ .52*DW9,true)
  call TriggerAddCondition(t,Condition(function DS9))
  set t=null
endfunction

function DX9 takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),DK)==false and IsMagicImmune(GetEnumUnit())==false and((LoadInteger(hashtable019,(GetHandleId((GetEnumUnit()))),((4253))))==1)==false then
    call GroupAddUnit(DK,GetEnumUnit())
    call DU9(GetEnumUnit(),tt_unit1,real084,tt_real1,real085)
  endif
endfunction

function DY9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real DV9=(LoadReal(hashtable019,(Cache),(20)))
  local real SB8=(LoadReal(hashtable019,(Cache),(57)))
  local real x1=(LoadReal(hashtable019,(Cache),(64)))
  local real y1=(LoadReal(hashtable019,(Cache),(65)))
  local real x2=(LoadReal(hashtable019,(Cache),(66)))
  local real y2=(LoadReal(hashtable019,(Cache),(67)))
  local real w=(LoadReal(hashtable019,(Cache),(68)))
  local real DZ9=(LoadReal(hashtable019,(Cache),(44)))
  local real a=Atan2(y2-y1,x2-x1)
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  local group DA9=GetAvailableGroup()
  local real offset=DZ9*.0625
  local real DC9=(LoadReal(hashtable019,(Cache),(71)))
  local real D39=(LoadReal(hashtable019,(Cache),(72)))
  local real D69=(LoadReal(hashtable019,(Cache),(70)))
  local real DL9=(LoadReal(hashtable019,(Cache),(63)))
  if offset>DistanceBetweenXY(x1,y1,x2,y2)then
    set x1=x2
    set y1=y2
  else
    set x1=x1+offset*Cos(a)
    set y1=y1+offset*Sin(a)
  endif
  set tt_unit1=Source
  set tt_real1=DV9
  set real084=SB8
  set real085=DL9
  set DK=g
  call GroupEnumUnitsInRange(DA9,x1,y1,w,Condition(function DefaultEnemyFilter))
  call ForGroup(DA9,function DX9)
  call KillGroup(DA9)
  if DistanceBetweenXY(x1,y1,DC9,D39)>=D69 then
    call SaveReal(hashtable019,(Cache),(71),((x1)*1.))
    call SaveReal(hashtable019,(Cache),(72),((y1)*1.))
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\Impale\\ImpaleMissTarget.mdl",x1,y1))
  endif
  call SaveReal(hashtable019,(Cache),(64),((x1)*1.))
  call SaveReal(hashtable019,(Cache),(65),((y1)*1.))
  if x1==x2 and y1==y2 then
    if(LoadBoolean(hashtable019,(Cache),(69))) then
      call KillGroup(g)
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set g=null
  set DA9=null
  set Source=null
  set t=null
  return false
endfunction

function D19 takes unit Source,unit D09,real DV9,real SB8,real DL9,real x1,real y1,real x2,real y2,real w,group D59,boolean D29,real DZ9 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real YR8=DistanceBetweenXY(x1,y1,x2,y2)
  local integer E49=B68(YR8,ZN)
  local real D69=YR8/ E49
  local group g
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(20),((DV9)*1.))
  call SaveReal(hashtable019,(Cache),(57),((SB8)*1.))
  call SaveReal(hashtable019,(Cache),(63),((DL9)*1.))
  call SaveReal(hashtable019,(Cache),(64),((x1)*1.))
  call SaveReal(hashtable019,(Cache),(65),((y1)*1.))
  call SaveReal(hashtable019,(Cache),(66),((x2)*1.))
  call SaveReal(hashtable019,(Cache),(67),((y2)*1.))
  call SaveReal(hashtable019,(Cache),(68),((w)*1.))
  call SaveReal(hashtable019,(Cache),(44),((DZ9)*1.))
  if D59==null then
    set g=GetAvailableGroup()
    if D09!=null and IsUnitIllusion(D09)==false then
      call GroupAddUnit(g,D09)
    endif
    call SaveGroupHandle(hashtable019,(Cache),(22),(g))
    call SaveBoolean(hashtable019,(Cache),(69),(D29))
    set g=null
  else
    call SaveGroupHandle(hashtable019,(Cache),(22),(D59))
    call SaveBoolean(hashtable019,(Cache),(69),(D29))
  endif
  call SaveReal(hashtable019,(Cache),(70),((D69)*1.))
  call SaveReal(hashtable019,(Cache),(71),((x1)*1.))
  call SaveReal(hashtable019,(Cache),(72),((y1)*1.))
  call TriggerRegisterTimerEvent(t,.0625,true)
  call TriggerAddCondition(t,Condition(function DY9))
  set t=null
  set g=null
endfunction

function E79 takes unit Source,integer Level,integer E89 returns nothing
  local integer i
  if HZ8[1]==0 then
    return
  endif
  set i=1
  loop
    exitwhen i>10
    call UnitRemoveAbility(Source,HZ8[i])
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>10
    call UnitRemoveAbility(Source,HA8[i])
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>10
    call UnitRemoveAbility(Source,HB8[i])
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>10
    call UnitRemoveAbility(Source,HC8[i])
    set i=i+1
  endloop
  call UnitRemoveAbility(Source,'B0BS')
  if Level==1 then
    call UnitAddAbility(Source,HZ8[E89])
  elseif Level==2 then
    call UnitAddAbility(Source,HA8[E89])
  elseif Level==3 then
    call UnitAddAbility(Source,HB8[E89])
  elseif Level==4 then
    call UnitAddAbility(Source,HC8[E89])
  endif
endfunction

function AddDispellableBuff takes integer id returns nothing
  set DispellableBuffs_i=DispellableBuffs_i+1
  set DispellableBuffs[DispellableBuffs_i]=id
endfunction

function RemoveDispellableBuffs takes unit u returns nothing
  local integer i=1
  loop
    exitwhen i>DispellableBuffs_i
    call UnitRemoveAbility(u,DispellableBuffs[i])
    set i=i+1
  endloop
endfunction

function AddPositiveBuffToList takes integer id returns nothing
  set PositiveBuffsCount=PositiveBuffsCount+1
  set PositiveBuffs[PositiveBuffsCount]=id
endfunction

function RemovePositiveBuffs takes unit u returns nothing
  local integer i=1
  loop
    exitwhen i>PositiveBuffsCount
    call UnitRemoveAbility(u,PositiveBuffs[i])
    set i=i+1
  endloop
endfunction

function EF9 takes integer AF8 returns boolean
  return AF8=='AIpg' or AF8=='A02V' or AF8=='ACpu' or AF8=='A18D' or AF8=='A1OU' or AF8=='AIcy' or AF8=='A1SA'
endfunction

function EG9 takes unit Target returns nothing
  call UnitRemoveAbility(Target,'A1JA')
  call UnitRemoveAbility(Target,'B0CD')
  call UnitRemoveAbility(Target,'A1LD')
  call UnitRemoveAbility(Target,'Aetl')
  call E79(Target,0,0)
endfunction

function EH9 takes nothing returns boolean
  if EF9(GetSpellAbilityId())then
    call EG9(GetSpellTargetUnit())
  endif
  return false
endfunction


function ShareVisionTic takes nothing returns nothing
  //A1HX shadow dance
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer buffid=LoadInteger(hashtable019,h,0)
  local player p=LoadPlayerHandle(hashtable019,h,1)
  local boolean needchange=LoadBoolean(hashtable019,h,'0NEW')
  local player np=LoadPlayerHandle(hashtable019,h,'0NEW')
  local unit dummy=LoadUnitHandle(hashtable019,h,'DUMM')
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call RemoveUnit(dummy)
    call UnitShareVision(u,p,false)
    call FlushChildHashtable(hashtable019,h)
    call RemoveSavedHandle(MHT,GetHandleId(u),buffid)
    call CleanTrigger(t)
  else
    
    if GetUnitAbilityLevel(u,buffid)>0 then//buff in
      if needchange then
        call UnitShareVision(u,p,false)
        call SetUnitOwner(dummy,np,false)
        set p=np
        call SavePlayerHandle(hashtable019,h,0,p)
        call SaveBoolean(hashtable019,h,'0NEW',false)
      endif
      if GetUnitAbilityLevel(u,'A1HX')==0 then
        call UnitShareVision(u,p,true)
        call SetUnitPosition(dummy,GetUnitX(u),GetUnitY(u))
      else
        call UnitShareVision(u,p,false)
        
      endif
      
      
      
    else
      call RemoveUnit(dummy)
      call UnitShareVision(u,p,false)
      call FlushChildHashtable(hashtable019,h)
      call RemoveSavedHandle(MHT,GetHandleId(u),buffid)
      call CleanTrigger(t)
      
    endif
  endif
  set t=null
  set u=null
  set dummy=null
endfunction

function ShareVision takes unit u,unit toWho,integer buffId returns nothing
  local trigger t=LoadTriggerHandle(MHT,GetHandleId(u),buffId)
  local integer hu=GetHandleId(u)
  local integer h
  local unit dummy
  if t==null then
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,0.02,true)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function ShareVisionTic))
    call SaveUnitHandle(hashtable019,h,0,u)
    call SavePlayerHandle(hashtable019,h,1,GetOwningPlayer(toWho))
    call SaveInteger(hashtable019,h,0,buffId)
    call SaveTriggerHandle(MHT,hu,buffId,t)
    set dummy=CreateUnit(GetOwningPlayer(toWho),'hFFD',GetUnitX(u),GetUnitY(u),0)
    call SaveUnitHandle(hashtable019,h,'DUMM',dummy)
    call UnitAddAbility(dummy,'A30X')
    //call BJDebugMsg(I2S(GetUnitAbilityLevel(dummy,'A30X')))
    set dummy=null
  else
    set h=GetHandleId(t)
    if IsPlayerEnemy(GetOwningPlayer(toWho),LoadPlayerHandle(hashtable019,h,1))then
      call SaveBoolean(hashtable019,h,'0NEW',true)
      call SavePlayerHandle(hashtable019,h,'0NEW',GetOwningPlayer(toWho))
    endif
    
    
  endif
  
  set t=null
endfunction

function IsMagicSelfDispell takes integer id returns boolean
  return id=='A1WE' or id=='A0B8' or id=='A063' or id=='A03O' or id=='A0T2' or id=='QB0Q' or id=='A0MQ' or id=='A1B6' or id=='A11F' or id=='A11E' or id=='A0S3' or id=='A11D'  or id=='A11G' or id=='A11H'  or id=='A2LI' or id=='A0NS' or id=='A1DA'
  //mantas, phantasm, mirror image, rage, primal split, BKB, borrowed time
endfunction

function IsMagicDispell takes integer id returns boolean
  return id=='A08V' or id=='QB05' or id=='A2TF' or id=='QB11' or id=='A0MF' or id=='Aprg' or id=='ACpu' or id=='AIpg' or id=='A02E' or id=='A02V' or id=='A0QH' or id=='A0QX' or id=='A18D' or id=='A1OU' or id=='A1SA' or id=='A2T2' or id=='A2TN' or id=='Acyc' or id=='ACcy' or id=='AIcy' or id=='A0XK' or id=='A12L' or id=='A13V' or id=='A1RL' or id=='A2FI'
  //repel, false promise, aphotic shield, purges, cyclones
endfunction

function MagicDispellCheck takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer id=LoadInteger(hashtable019,h,0)
  local integer buffid=LoadInteger(hashtable019,h,1)
  local integer sid
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitRemoveAbility(u,id)
    call UnitRemoveAbility(u,buffid)
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT then
    if GetUnitAbilityLevel(u,id)==0 then//ability was removed somehow
      call FlushChildHashtable(hashtable019,h)
      call CleanTrigger(t)
    else
      set sid=GetSpellAbilityId()
      if GetTriggerUnit()==u then//selfcasts
        if IsMagicSelfDispell(sid)then
          call UnitRemoveAbility(u,id)
          call UnitRemoveAbility(u,buffid)
          call FlushChildHashtable(hashtable019,h)
          call CleanTrigger(t)
        endif
      else
        if GetSpellTargetUnit()==u and (IsPlayerAlly(GetOwningPlayer(GetTriggerUnit()),GetOwningPlayer(u)) or IsBlocked(u)==false) and IsMagicDispell(sid) then
          call UnitRemoveAbility(u,id)
          call UnitRemoveAbility(u,buffid)
          call FlushChildHashtable(hashtable019,h)
          call CleanTrigger(t)
        endif
        
        
      endif
      
      
    endif
    
  endif
  set t=null
  set u=null
endfunction


//Will take unit and awaits till he'll get under dispellng stuff
//takes Which unit and which ability to remove on dispell
function DetectMagicDispell takes unit u, integer id, integer buffid returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function MagicDispellCheck))
  call SaveUnitHandle(hashtable019,h,0,u)
  call SaveInteger(hashtable019,h,0,id)
  call SaveInteger(hashtable019,h,1,buffid)
  set t=null
endfunction


function FindRealIndexId takes integer indexId returns integer
  if MK7[indexId]==0 then
    return indexId
  else
    return MK7[indexId]
  endif
endfunction

function Bottle_IsIndexRune takes integer id returns boolean
  return id==indexid_BottleIllusion or id==indexid_BottleHaste or id==indexid_BottleDD or id==indexid_BottleRegen or id==indexid_BottleInvis
endfunction

function EM9 takes unit whichUnit,integer ZF8 returns boolean
  local integer ZG8
  local item ZH8
  set ZG8=0
  loop
    exitwhen ZG8>5
    set ZH8=UnitItemInSlot(whichUnit,ZG8)
    
    if ZH8!=null and GetItemTypeId(ZH8)==ZF8 then
      
      set ZH8=null
      return true
    endif
    set ZG8=ZG8+1
  endloop
  set ZH8=null
  return false
endfunction



function GetIndexNoMute takes item B38 returns integer
  local integer ZF8
  local integer i=1
  if B38==null then
    return-2
  endif
  //set ZF8=DummyItem(GetItemTypeId(B38))
  set ZF8=GetItemTypeId(B38)
  loop
    exitwhen i>ITC
    if Item_Dummy[i]==ZF8 or Item_Real[i]==ZF8 then
      return i
    endif
    set i=i+1
  endloop
  return-1
endfunction

function GetScepterIndexId takes integer PlayerId returns integer
  local integer unitId
  set unitId=UltimatesHeroId[PlayerId]
  if unitId=='H004' then
    return indexid_AghanimLina
  elseif unitId=='UC18' then
    return indexid_AghanimLion
  elseif unitId=='E02J' then
    return indexid_aghanimDisruptor
  elseif unitId=='N01A' then
    return indexid_aghanimSilencer
  elseif unitId=='N0HP' then
    return indexid_aghanimAA
  elseif unitId=='Harf' then
    return indexid_aghanimOmni
  elseif unitId=='H0DO' then
    return indexid_aghanimSkywrath
  elseif unitId=='E02X' then
    return indexid_aghanimRubick
  elseif unitId=='Uktl' then
    return indexid_aghanimEnigma
  elseif unitId=='Hmkg' then
    return indexid_AghanimOgre
  elseif unitId=='Ucrl' or unitId=='U01X' then
    return indexid_AghanimTiny
  elseif unitId=='H00H' then
    return indexid_AghanimPugna
  elseif unitId=='UC01' then
    return indexid_AghanimQoP
  elseif unitId=='Orkn' then
    return indexid_AghanimRhasta
  elseif unitId=='Hmbr' then
    return indexid_AghanimZeus
  elseif unitId=='Hjai' then
    return indexid_AghanimCM
  elseif unitId=='Ulic' then
    return indexid_AghanimLich
  elseif unitId=='Ekee' then
    return indexid_AghanimLeshrak
  elseif unitId=='Emns' then
    return indexid_AghanimFurion
  elseif unitId=='EC57' then
    return indexid_AghanimVeno
  elseif unitId=='U00E' then
    return indexid_AghanimNecro
  elseif unitId=='E005' then
    return indexid_AghanimLuna
  elseif unitId=='E01A' then
    return indexid_AghanimWD
  elseif unitId=='UC42' then
    return indexid_AghanimLucifer
  elseif unitId=='Npbm' then
    return indexid_AghanimPanda
  elseif unitId=='H00T' then
    return indexid_AghanimClockwerk
  elseif unitId=='Hvwd' then
    return indexid_AghanimVS
  elseif unitId=='Nbbc' then
    return indexid_AghanimJuggernaut
  elseif unitId=='H00A' then
    return indexid_AghanimChen
  elseif unitId=='Udre' then
    return indexid_AghanimNightstalker
  elseif unitId=='E00P' then
    return indexid_AghanimJakiro
  elseif unitId=='U00K' then
    return indexid_AghanimSandKing
  elseif unitId=='H00Q' then
    return indexid_AghanimHuskar
  elseif unitId=='H00U' then
    return indexid_AghanimInvoker
  elseif unitId=='U00F' then
    return indexid_aghanimPudge
  elseif unitId=='N0EG' then
    return indexid_AghanimWR
  elseif unitId=='EC45' then
    return indexid_AghanimVoid
  elseif unitId=='O00J' then
    return indexid_AghanimSpiritbreaker
  elseif unitId=='Oshd' then
    return indexid_AghanimBane
  elseif unitId=='Udea' then
    return indexid_AghanimAbaddon
  elseif unitId=='N01W' then
    return indexid_AghanimDazzle
  elseif unitId=='H00K' then
    return indexid_AghanimTechies
  elseif unitId=='Opgh' then
    return indexid_AghanimAxe
  elseif unitId=='Otch' then
    return indexid_AghanimES
  elseif unitId=='H00R' then
    return indexid_AghanimZombie
  elseif unitId=='H07I' then
    return indexid_AghanimZombie
  elseif unitId=='N00B' then
    return indexid_AghanimPuck
  elseif unitId=='E01C' then
    return indexid_AghanimWL
  elseif unitId=='E002' then
    return indexid_AghanimRazor
  elseif unitId=='EC77' then
    return indexid_AghanimViper
  elseif unitId=='U00P' then
    return indexid_AghanimOD
  elseif unitId=='Emoo' then
    return indexid_AghanimEnchantress
  elseif unitId=='H00N' then
    return indexid_AghanimDS
  elseif unitId=='E02N' or unitId=='E02O' then
    return indexid_AghanimGyro
  elseif unitId=='H00I' then
    return indexid_AghanimMeepo
  elseif unitId=='H00D' then
    return indexid_AghanimBeastmaster
  elseif unitId=='UC60' then
    return indexid_AghanimVisage
  endif
  return indexid_AghanimBasic
endfunction

function GetScepterAbilityId takes unit whichUnit returns integer
  local integer unitId
  if whichUnit==null then
    return-2
  endif
  set unitId=UltimatesHeroId[GetPlayerId(GetOwningPlayer(whichUnit))]
  if unitId=='H004' then
    return 'A0TP'
  elseif unitId=='Uktl' then
    return 'A30M'
  elseif unitId=='E02J' then
    return 'A30O'
  elseif unitId=='E02X' then
    return 'A30K'
  elseif unitId=='UC18' then
    return 'A0TR'
  elseif unitId=='H0DO' then
    return 'A30I'
  elseif unitId=='N01A' then
    return 'A2QB'
  elseif unitId=='N0HP' then
    return 'A2QF'
  elseif unitId=='Harf' then
    return 'A2S7'
  elseif unitId=='Hmkg' then
    return 'A2KT'
  elseif unitId=='Ucrl' or unitId=='U01X' then
    return 0
  elseif unitId=='H00H' then
    return 'A0TV'
  elseif unitId=='UC01' then
    return 'A0TX'
  elseif unitId=='Orkn' then
    return 'A0TZ'
  elseif unitId=='Hmbr' then
    return 'A0U1'
  elseif unitId=='Hjai' then
    return 'A0U3'
  elseif unitId=='Ulic' then
    return 'A0U5'
  elseif unitId=='Ekee' then
    return 'A0U7'
  elseif unitId=='Emns' then
    return 'A0U9'
  elseif unitId=='EC57' then
    return 'A0UB'
  elseif unitId=='U00E' then
    return 'A0UD'
  elseif unitId=='E005' then
    return 'A0UF'
  elseif unitId=='E01A' then
    return 'A0UH'
  elseif unitId=='UC42' then
    return 'A0UJ'
  elseif unitId=='Npbm' then
    return 'A1BE'
  elseif unitId=='H00T' then
    return 'A1B9'
  elseif unitId=='Hvwd' then
    return 'A1BA'
  elseif unitId=='Nbbc' then
    return 'A1BB'
  elseif unitId=='H00A' then
    return 'A1CU'
  elseif unitId=='Udre' then
    return 'A1BG'
  elseif unitId=='E00P' then
    return 'A1BJ'
  elseif unitId=='U00K' then
    return 'A1BC'
  elseif unitId=='H00Q' then
    return 'A1BI'
  elseif unitId=='H00U' then
    return 'A1BD'
  elseif unitId=='U00F' then
    return 'A1CY'
  elseif unitId=='N0EG' then
    return 'A1D2'
  elseif unitId=='EC45' then
    return 'A1D1'
  elseif unitId=='O00J' then
    return 'A1CZ'
  elseif unitId=='Oshd' then
    return 'A1D0'
  elseif unitId=='Udea' then
    return 'A1D3'
  elseif unitId=='N01W' then
    return 'A1D4'
  elseif unitId=='H00K' then
    return 'A1G1'
  elseif unitId=='Opgh' then
    return 'A1MT'
  elseif unitId=='Otch' then
    return 'A1N0'
  elseif unitId=='N00B' then
    return 'A1QS'
  elseif unitId=='E01C' then
    return 'A1UT'
  elseif unitId=='E002' then
    return 'A1UU'
  elseif unitId=='EC77' then
    return 'A1V1'
  elseif unitId=='U00P' then
    return 'A1VY'
  elseif unitId=='Emoo' then
    return 'A1WD'
  elseif unitId=='H00N' then
    return 'A21S'
  elseif unitId=='E02N' or unitId=='E02O' then
    return 'A237'
  elseif unitId=='H00I' then
    return 'A27E'
  elseif unitId=='H00D' then
    return 'A28A'
  elseif unitId=='UC60' then
    return 'A2IH'
  endif
  return 0
endfunction

function GetScepterHiddenAbilityId takes unit whichUnit returns integer
  local integer unitId
  if whichUnit==null then
    return-2
  endif
  set unitId=UltimatesHeroId[GetPlayerId(GetOwningPlayer(whichUnit))]
  if unitId=='H004' then
    return 'A0TO'
  elseif unitId=='Uktl' then
    return 'A30M'
  elseif unitId=='E02X' then
    return 'A30K'
  elseif unitId=='E02J' then
    return 'A30O'
  elseif unitId=='H0DO' then
    return 'A30I'
  elseif unitId=='UC18' then
    return 'A0TQ'
  elseif unitId=='N01A' then
    return 'A2QB'
  elseif unitId=='N0HP' then
    return 'A2QF'
  elseif unitId=='Harf' then
    return 'A2S7'
  elseif unitId=='Hmkg' then
    return 0
  elseif unitId=='Ucrl' or unitId=='U01X' then
    return 0
  elseif unitId=='H00H' then
    return 'A0TU'
  elseif unitId=='UC01' then
    return 'A0TW'
  elseif unitId=='Orkn' then
    return 'A0TY'
  elseif unitId=='Hmbr' then
    return 'A0U0'
  elseif unitId=='Hjai' then
    return 'A0U2'
  elseif unitId=='Ulic' then
    return 'A0U4'
  elseif unitId=='Ekee' then
    return 'A0U6'
  elseif unitId=='Emns' then
    return 'A0U8'
  elseif unitId=='EC57' then
    return 'A0UA'
  elseif unitId=='U00E' then
    return 'A0UC'
  elseif unitId=='E005' then
    return 'A0UE'
  elseif unitId=='E01A' then
    return 'A0UG'
  elseif unitId=='UC42' then
    return 'A0UI'
  elseif unitId=='Npbm' then
    return 'A1BS'
  elseif unitId=='H00T' then
    return 'A1CW'
  elseif unitId=='Hvwd' then
    return 'A1BT'
  elseif unitId=='Nbbc' then
    return 'A1BR'
  elseif unitId=='H00A' then
    return 'A1CT'
  elseif unitId=='Udre' then
    return 'A1BO'
  elseif unitId=='E00P' then
    return 'A1BN'
  elseif unitId=='U00K' then
    return 'A1BM'
  elseif unitId=='H00Q' then
    return 'A1BL'
  elseif unitId=='H00U' then
    return 'A1BK'
  elseif unitId=='U00F' then
    return 'A1D5'
  elseif unitId=='N0EG' then
    return 'A1DC'
  elseif unitId=='EC45' then
    return 'A1DD'
  elseif unitId=='O00J' then
    return 'A1DG'
  elseif unitId=='Oshd' then
    return 'A1DH'
  elseif unitId=='Udea' then
    return 'A1DE'
  elseif unitId=='N01W' then
    return 'A1DF'
  elseif unitId=='H00K' then
    return 'A1G0'
  elseif unitId=='Opgh' then
    return 'A1MS'
  elseif unitId=='Otch' then
    return 'A1MZ'
  elseif unitId=='N00B' then
    return 'A1QR'
  elseif unitId=='E01C' then
    return 'A1US'
  elseif unitId=='E002' then
    return 'A1UW'
  elseif unitId=='EC77' then
    return 'A1V0'
  elseif unitId=='U00P' then
    return 'A1VX'
  elseif unitId=='Emoo' then
    return 'A1WC'
  elseif unitId=='H00N' then
    return 'A21R'
  elseif unitId=='E02N' or unitId=='E02O' then
    return 'A236'
  elseif unitId=='H00I' then
    return 'A27D'
  elseif unitId=='H00D' then
    return 'A28A'
  elseif unitId=='UC60' then
    return 'A2IH'
  endif
  return 0
endfunction

function ES9 takes item Item returns boolean
  local integer i=1
  loop
    exitwhen i>VU7
    if Item==VT7[i]then
      return true
    endif
    set i=i+1
  endloop
  return false
endfunction

function ET9 takes item B38 returns boolean
  local integer indexId=GetIndex(B38)
  if indexId==indexid_AghanimBasic or indexId==indexid_AghanimFurion or indexId==indexid_AghanimKotL or indexId==indexid_AghanimLeshrak or indexId==indexid_AghanimLich or indexId==indexid_AghanimLina or indexId==indexid_AghanimLion or indexId==indexid_AghanimLucifer or indexId==indexid_AghanimLuna or indexId==indexid_AghanimNecro or indexId==indexid_AghanimOgre or indexId==indexid_AghanimPugna or indexId==indexid_AghanimQoP or indexId==indexid_AghanimRhasta or indexId==indexid_AghanimCM or indexId==indexid_AghanimVeno or indexId==indexid_AghanimWD or indexId==indexid_AghanimZeus or indexId==indexid_AghanimClockwerk or indexId==indexid_AghanimVS or indexId==indexid_AghanimJuggernaut or indexId==indexid_AghanimChen or indexId==indexid_AghanimNightstalker or indexId==indexid_AghanimJakiro or indexId==indexid_AghanimSandKing or indexId==indexid_AghanimHuskar or indexId==indexid_AghanimInvoker or indexId==indexid_aghanimPudge or indexId==indexid_AghanimWR or indexId==indexid_AghanimVoid or indexId==indexid_AghanimSpiritbreaker or indexId==indexid_AghanimBane or indexId==indexid_AghanimAbaddon or indexId==indexid_AghanimDazzle or indexId==indexid_AghanimTechies or indexId==indexid_AghanimPanda or indexId==indexid_AghanimAxe or indexId==indexid_AghanimES then
    return true
  elseif indexId==indexid_AghanimPuck or indexId==indexid_AghanimWL or indexId==indexid_AghanimRazor or indexId==indexid_AghanimViper or indexId==indexid_AghanimTiny or indexId==indexid_AghanimOD or indexId==indexid_AghanimEnchantress or indexId==indexid_AghanimDS or indexId==indexid_AghanimGyro or indexId==indexid_AghanimMeepo or indexId==indexid_AghanimBeastmaster or indexId==indexid_AghanimVisage or indexId==indexid_aghanimSilencer or indexId==indexid_aghanimAA or indexId==indexid_aghanimOmni or indexId==indexid_aghanimSkywrath or indexId==indexid_aghanimRubick or indexId==indexid_aghanimEnigma or indexId==indexid_aghanimDisruptor then
    return true
  endif
  return false
endfunction

function IsIndexIdConsumable takes integer indexId returns boolean
  return indexId==indexid_FlyingCourier or indexId==indexid_Cheese or indexId==indexid_dustofappearance or indexId==indexid_ClarityPotion or indexId==indexid_HealingSalve or indexId==indexid_Tango or indexId==indexid_ObserverWards or indexId==indexid_SentryWards or indexId==indexid_ScrollOfTownPortal or indexId==indexid_ghostpotion or indexId==indexid_wandofillusions or indexId==indexid_Smoke
endfunction



function IsIndexIdCharged takes integer indexId returns boolean
  return (indexId)==indexid_UrnOfShadows or indexId==indexid_janggo or (indexId)==indexid_DiffusalBlade or (indexId)==indexid_DiffusalBlade_upg or indexId==indexid_bloodstone or indexId==indexid_Aegis or (indexId)==indexid_MagicStick or (indexId)==indexid_MagicWand or indexId==indexid_BladeOfTheReaper 
endfunction

function UpFlyingCourierWhereverHeIs takes nothing returns boolean
  return IsBasicCourier(GetFilterUnit()) and (GetOwningPlayer(GetFilterUnit())==TempPlayer or GetPlayerAlliance(GetOwningPlayer(GetFilterUnit()),TempPlayer,ALLIANCE_SHARED_CONTROL))
endfunction

function MakeFlyingCourier takes item it, player p returns nothing
  local group g=GetAvailableGroup()
  local unit u=null
  set TempPlayer=p
  call GroupEnumUnitsInRange(g,0,0,12000,Condition(function UpFlyingCourierWhereverHeIs))
  set u=FirstOfGroup(g)
  if u!=null then
    call UnitAddItem(u,it)
  endif
  call KillGroup(g)
  set u=null
  set g=null
endfunction

function EW9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer ZF8=(LoadInteger(hashtable019,(Cache),(74)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local boolean consumable=(LoadBoolean(hashtable019,(Cache),(75)))
  local integer charges=(LoadInteger(hashtable019,(Cache),(76)))
  local item newItem=CreateItem(ZF8,x,y)
  call SetItemPlayer(newItem,p,true)
  call SetItemUserData(newItem,0)
  if consumable then
    call SetItemCharges(newItem,charges)
  endif
  if ZF8==Item_Dummy[indexid_RecipeFlyingCourier] then
    call MakeFlyingCourier(newItem,p)
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set p=null
  set newItem=null
  return false
endfunction

function DelayedItemCreation takes integer ZF8,real x,real y,player p,boolean consumable,integer charges returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveInteger(hashtable019,(Cache),(74),(ZF8))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SavePlayerHandle(hashtable019,(Cache),(54),(p))
  call SaveBoolean(hashtable019,(Cache),(75),(consumable))
  call SaveInteger(hashtable019,(Cache),(76),(charges))
  call TriggerAddCondition(t,Condition(function EW9))
  call TriggerRegisterTimerEvent(t,0,false)
  set t=null
endfunction

function DisableItemTriggers takes nothing returns nothing
  call DisableTrigger(t_manipulateitem)
endfunction

function EnableItemTriggers takes nothing returns nothing
  call EnableTrigger(t_manipulateitem)
endfunction

function DestroyItem takes item B38 returns nothing
  call DisableTrigger(t_manipulateitem)
  call RemoveItem(B38)
  call EnableTrigger(t_manipulateitem)
endfunction

function FindItemOfTypeEx takes unit whichUnit,integer ZF8,item Func1072 returns item
  local integer ZG8
  local item ZH8
  set ZG8=0
  loop
    exitwhen ZG8>5
    set ZH8=UnitItemInSlot(whichUnit,ZG8)
    //if ZH8!=null and ZH8!=E39 and (DummyItem(GetItemTypeId(ZH8)))==ZF8 then
    if ZH8!=null and ZH8!=Func1072 and GetItemTypeId(ZH8)==ZF8 then
      set ZH8=null
      return UnitItemInSlot(whichUnit,ZG8)
    endif
    set ZG8=ZG8+1
  endloop
  set ZH8=null
  return null
endfunction

function FindItemOfType takes unit whichUnit,integer ZF8 returns item
  local integer ZG8
  local item ZH8
  set ZG8=0
  loop
    exitwhen ZG8>5
    set ZH8=UnitItemInSlot(whichUnit,ZG8)
    //if(ZH8!=null)and(DummyItem(GetItemTypeId(ZH8))==ZF8)then
    if ZH8!=null and GetItemTypeId(ZH8)==ZF8 then
      set ZH8=null
      return UnitItemInSlot(whichUnit,ZG8)
    endif
    set ZG8=ZG8+1
  endloop
  set ZH8=null
  return null
endfunction

function FindItemOfIndexExForPlayer takes player p,unit whichUnit,integer indexId,item Func1072 returns item
  local integer ZG8
  local item ZH8
  set ZG8=0
  loop
    exitwhen ZG8>5
    set ZH8=UnitItemInSlot(whichUnit,ZG8)
    //if ZH8!=null and ZH8!=E39 and DummyItem(GetIndex(ZH8))==indexId and(GetItemPlayer(ZH8)==p or indexId==indexid_ObserverWards or indexId==indexid_SentryWards)then
    if ZH8!=null and ZH8!=Func1072 and GetIndex(ZH8)==indexId and(GetItemPlayer(ZH8)==p or indexId==indexid_ObserverWards or indexId==indexid_SentryWards)then
      
      set ZH8=null
      return UnitItemInSlot(whichUnit,ZG8)
    endif
    set ZG8=ZG8+1
  endloop
  set ZH8=null
  return null
endfunction

function FindItemOfIndexForPlayer takes player p,unit whichUnit,integer indexId returns item
  local integer ZG8
  local item ZH8
  set ZG8=0
  loop
    exitwhen ZG8>5
    set ZH8=UnitItemInSlot(whichUnit,ZG8)
    //if(ZH8!=null)and(DummyItem(GetIndex(ZH8))==indexId)and(GetItemPlayer(ZH8)==p or indexId==indexid_ObserverWards or indexId==indexid_SentryWards)then
    if(ZH8!=null)and GetIndex(ZH8)==indexId and(GetItemPlayer(ZH8)==p or indexId==indexid_ObserverWards or indexId==indexid_SentryWards)then
      set ZH8=null
      return UnitItemInSlot(whichUnit,ZG8)
    endif
    set ZG8=ZG8+1
  endloop
  set ZH8=null
  return null
endfunction

function FindItemByIndex takes unit whichUnit,integer indexId returns item
  local integer ZG8
  local item ZH8
  set ZG8=0
  loop
    exitwhen ZG8>5
    set ZH8=UnitItemInSlot(whichUnit,ZG8)
    //if(ZH8!=null)and(DummyItem(GetIndex(ZH8))==indexId)then
    if(ZH8!=null)and GetIndex(ZH8)==indexId then
      set ZH8=null
      return UnitItemInSlot(whichUnit,ZG8)
    endif
    set ZG8=ZG8+1
  endloop
  set ZH8=null
  return null
endfunction

function GetEmptyInventorySlots takes unit whichUnit returns integer
  local integer i=0
  local integer n=0
  local integer E29=UnitInventorySize(whichUnit)-1
  loop
    exitwhen i>E29
    if UnitItemInSlot(whichUnit,i)==null then
      set n=n+1
    endif
    set i=i+1
  endloop
  return n
endfunction




function F79 takes item B38 returns integer
  local integer ZF8
  local integer i=1
  if B38==null then
    return-2
  endif
  //set ZF8=DummyItem(GetItemTypeId(B38))
  set ZF8=GetItemTypeId(B38)
  loop
    exitwhen i>ITC
    if Item_Mute[i]==ZF8 then
      return i
    endif
    set i=i+1
  endloop
  return-1
endfunction

function MuteToRealId takes item B38 returns integer
  local integer ZF8
  local integer i=1
  if B38==null then
    return-2
  endif
  //set ZF8=DummyItem(GetItemTypeId(B38))
  set ZF8=GetItemTypeId(B38)
  loop
    exitwhen i>ITC
    if Item_Mute[i]==ZF8 then
      return Item_Real[i]
    endif
    set i=i+1
  endloop
  return-1
endfunction

function UnitToIndex takes unit whichUnit returns integer
  local integer unitId
  local integer i=0
  if whichUnit==null then
    return-2
  endif
  set unitId=GetUnitTypeId(whichUnit)
  loop
    exitwhen i>ITC
    if Item_SellerUnit[i]==unitId then
      return i
    endif
    set i=i+1
  endloop
  return-1
endfunction

function FD9 takes item FE9 returns string
  if FE9==null then
    return EmptySlotPath
  endif
  return Item_Icon[GetIndex(FE9)]
endfunction

function FF9 takes item B38 returns boolean
  return GetIndex(B38)==indexid_DivineRapier or GetIndex(B38)==indexid_DivineRapierFree or GetIndex(B38)==indexid_Gem or GetIndex(B38)==indexid_GemCourier
endfunction

function FG9 takes integer indexId returns integer
  if indexid_Tango==indexId then
    return 4
  endif
  if indexid_ObserverWards==indexId or indexid_SentryWards==indexId or OX7==indexId or indexid_ghostpotion==indexId or indexid_wandofillusions==indexId or indexid_dustofappearance==indexId then
    return 2
  endif
  return 1
endfunction

function IsItemTemporary takes item B38 returns boolean
  return GetItemType(B38)==ITEM_TYPE_POWERUP or GetItemType(B38)==ITEM_TYPE_PURCHASABLE or GetItemType(B38)==ITEM_TYPE_MISCELLANEOUS
endfunction

function FI9 takes unit Hero returns real
  local real result
  if IsSentinel(GetOwningPlayer(Hero))then
    set result=GetRectCenterX(gg_rct_Hero_Creation_NE)
  else
    set result=GetRectCenterX(gg_rct_Hero_Creation_UD)
  endif
  return result
endfunction

function FK9 takes unit Hero returns real
  local real result
  if IsSentinel(GetOwningPlayer(Hero))then
    set result=GetRectCenterY(gg_rct_Hero_Creation_NE)
  else
    set result=GetRectCenterY(gg_rct_Hero_Creation_UD)
  endif
  return result
endfunction

function FM9 takes unit Hero,integer FN9,integer FO9 returns item
  local real x=FI9(Hero)
  local real y=FK9(Hero)
  local item Item=CreateItem(FN9,x,y)
  local integer i=0
  local boolean array FP9
  local item FQ9
  call DisableTrigger(t_manipulateitem)
  if FN9>0 then
    loop
      exitwhen i>(UnitInventorySize(Hero)-1)
      if UnitItemInSlot(Hero,i)==null and i!=FO9 then
        set FQ9=CreateItem('I02M',x,y)
        call UnitAddItem(Hero,FQ9)
        set FP9[i]=true
      else
        set FP9[i]=false
      endif
      if i==FO9 then
        call EnableTrigger(t_manipulateitem)
        call UnitAddItem(Hero,Item)
        call DisableTrigger(t_manipulateitem)
      endif
      set i=i+1
    endloop
    set i=0
    loop
      exitwhen i>5
      if FP9[i] then
        call RemoveItem(UnitItemInSlot(Hero,i))
      endif
      set i=i+1
    endloop
  endif
  call EnableTrigger(t_manipulateitem)
  set tt_item1=Item
  set Item=null
  set FQ9=null
  return tt_item1
endfunction

function FR9 takes integer U58,integer r,integer g,integer b returns nothing
  set LN=LN+1
  set XN[LN]=r
  set YN[LN]=g
  set JN[LN]=b
  set KN[LN]=U58
endfunction

function FS9 takes unit u returns nothing
  local integer id=GetUnitTypeId(u)
  local integer i=1
  local integer a=255
  local boolean found=false
  if id=='Ewar' then
    set a=R2I(2.55*(100-18+20*GetUnitAbilityLevel(u,'P239'))) //A03P
  endif
  loop
    exitwhen i>LN or found
    if KN[i]==id then
      set found=true
      call SetUnitVertexColor(u,XN[i],YN[i],JN[i],a)
    endif
    set i=i+1
  endloop
  if found==false then
    call SetUnitVertexColor(u,255,255,255,255)
  endif
endfunction

function FU9 takes unit u returns nothing
  local integer id=GetUnitTypeId(u)
  local integer i=1
  local boolean found=false
  loop
    exitwhen i>LN or found
    if KN[i]==id then
      set found=true
      call SetUnitVertexColor(u,XN[i],YN[i],JN[i],0)
    endif
    set i=i+1
  endloop
  if found==false then
    call SetUnitVertexColor(u,255,255,255,0)
  endif
endfunction

function FV9 takes player p,string FW9,integer Y08 returns nothing
  local string id=I2S(GetPlayerId(p))
  call StoreInteger(MN,id,FW9,Y08)
  if IsPlayer(PlayerModeTyper)==false then
    call W18()
  endif
  if GetLocalPlayer()==PlayerModeTyper then
    call SyncStoredInteger(MN,id,FW9)
  endif
endfunction

//function Traffic_RegisterCustomData takes string parent, string child, integer value returns nothing
//	call StoreInteger(RGCGC,parent,child,value)
//	call SyncStoredInteger(RGCGC,parent,child)
//endfunction

//function Traffic_RegisterCustomMetaData takes string parent, string child, integer value returns nothing
//	call StoreInteger(RGCGC2,parent,child,value)
//	call SyncStoredInteger(RGCGC2,parent,child)
//endfunction

//function Traffic_RegisterCustomGlobalData takes string parent, string child, integer value returns nothing
//	call StoreInteger(RGCGC3,parent,child,value)
//	call SyncStoredInteger(RGCGC3,parent,child)
//endfunction

function Traffic_RegisterData takes string FY9,integer Y08 returns nothing
  call StoreInteger(MN,"Data",FY9,Y08)
  if IsPlayer(PlayerModeTyper)==false then
    call W18()
  endif
  if GetLocalPlayer()==PlayerModeTyper then
    call SyncStoredInteger(MN,"Data",FY9)
  endif
endfunction

function FA9 takes string s,string FB9,string FC9 returns string
  local string F39=""
  local integer i=0
  local integer F69=StringLength(s)
  local string FL9
  local integer F19=StringLength(FB9)
  local boolean found=false
  loop
    exitwhen i+1>F69
    set FL9=SubString(s,i,i+F19)
    if FL9!=FB9 or found then
      set F39=F39+SubString(s,i,i+1)
      set i=i+1
    else
      set F39=F39+FC9
      set i=i+F19
      set found=true
    endif
  endloop
  return F39
endfunction

function F09 takes player F59,player F29 returns string
  local string s=GetObjectName('n0C8')
  set s=FA9(s,"$dead",udg_Colors[GetPlayerId(F59)]+(IL7[GetPlayerId((F59))])+"|r")
  set s=FA9(s,"$killer",udg_Colors[GetPlayerId(F29)]+(IL7[GetPlayerId((F29))])+"|r")
  return s
endfunction


function GetBonusMSPercent takes unit u returns integer
  local integer i=0
  if GetUnitAbilityLevel(u,BonusMSPercentSystem[0])>0 then
    set i=i+1
  endif
  if GetUnitAbilityLevel(u,BonusMSPercentSystem[1])>0 then
    set i=i+2
  endif
  if GetUnitAbilityLevel(u,BonusMSPercentSystem[2])>0 then
    set i=i+4
  endif
  if GetUnitAbilityLevel(u,BonusMSPercentSystem[3])>0 then
    set i=i+8
  endif
  if GetUnitAbilityLevel(u,BonusMSPercentSystem[4])>0 then
    set i=i+16
  endif
  if GetUnitAbilityLevel(u,BonusMSPercentSystem[5])>0 then
    set i=i+32
  endif
  if GetUnitAbilityLevel(u,BonusMSPercentSystem[6])>0 then
    set i=i+64
  endif
  if GetUnitAbilityLevel(u,BonusMSPercentSystem[7])>0 then
    set i=i+128
  endif
  if GetUnitAbilityLevel(u,BonusMSPercentSystem[7])>0 then
    set i=i+256
  endif
  if GetUnitAbilityLevel(u,BonusMSPercentSystem[7])>0 then
    set i=i+512
  endif
  return i
endfunction

function SetBonusMSPercent takes unit u,integer d returns nothing
  local integer array b
  local integer a=d
  local integer c=1
  local integer i=0
  local integer E29
  if d<1 then
    call UnitRemoveAbility(u,BonusMSPercentSystem[0])
    call UnitRemoveAbility(u,BonusMSPercentSystem[1])
    call UnitRemoveAbility(u,BonusMSPercentSystem[2])
    call UnitRemoveAbility(u,BonusMSPercentSystem[3])
    call UnitRemoveAbility(u,BonusMSPercentSystem[4])
    call UnitRemoveAbility(u,BonusMSPercentSystem[5])
    call UnitRemoveAbility(u,BonusMSPercentSystem[6])
    call UnitRemoveAbility(u,BonusMSPercentSystem[7])
    call UnitRemoveAbility(u,BonusMSPercentSystem[8])
    call UnitRemoveAbility(u,BonusMSPercentSystem[9])
    return
  endif
  loop
    exitwhen c==0
    set c=a/ 2
    set b[i]=a-c*2
    set a=c
    set i=i+1
  endloop
  set E29=9
  set i=0
  loop
    exitwhen i>E29
    if b[i]==1 then
      call UnitAddAbility(u,BonusMSPercentSystem[i])
    else
      call UnitRemoveAbility(u,BonusMSPercentSystem[i])
    endif
    set i=i+1
  endloop
endfunction

function AddBonusMSPercent takes unit u, integer d returns nothing
  local integer h=GetHandleId(u)
  local integer curBonus=LoadInteger(MHT,h,'MSPC')
  if IsUnitType(u,UNIT_TYPE_HERO)==true then
    call SetBonusMSPercent(u,d+curBonus)
    call SaveInteger(MHT,h,'MSPC',d+curBonus)
  endif
endfunction

function SubBonusMSPercent takes unit u, integer d returns nothing
  local integer h=GetHandleId(u)
  local integer curBonus=LoadInteger(MHT,h,'MSPC')
  if IsUnitType(u,UNIT_TYPE_HERO)==true then
    call SetBonusMSPercent(u,curBonus-d)
    call SaveInteger(MHT,h,'MSPC',curBonus-d)
  endif
endfunction

function AddBonusDamage takes unit u,integer d returns nothing
  local integer array b
  local integer a=d
  local integer c=1
  local integer i=0
  local integer E29
  if d<1 then
    call UnitRemoveAbility(u,BonusDamageSystemCont[0])
    call UnitRemoveAbility(u,BonusDamageSystemCont[1])
    call UnitRemoveAbility(u,BonusDamageSystemCont[2])
    call UnitRemoveAbility(u,BonusDamageSystemCont[3])
    call UnitRemoveAbility(u,BonusDamageSystemCont[4])
    call UnitRemoveAbility(u,BonusDamageSystemCont[5])
    call UnitRemoveAbility(u,BonusDamageSystemCont[6])
    call UnitRemoveAbility(u,BonusDamageSystemCont[7])
    call UnitRemoveAbility(u,BonusDamageSystemCont[8])
    return
  endif
  loop
    exitwhen c==0
    set c=a/ 2
    set b[i]=a-c*2
    set a=c
    set i=i+1
  endloop
  set E29=8
  set i=0
  loop
    exitwhen i>E29
    if b[i]==1 then
      call UnitAddAbility(u,BonusDamageSystemCont[i])
    else
      call UnitRemoveAbility(u,BonusDamageSystemCont[i])
    endif
    set i=i+1
  endloop
endfunction

function G79 takes unit u returns nothing
  local integer h=GetHandleId(u)
  local integer i=0
  set i=i+LoadInteger(hashtable019,h,'a068')
  set i=i+LoadInteger(hashtable019,h,'a167')
  set i=i+LoadInteger(hashtable019,h,'a208')
  set i=i+LoadInteger(hashtable019,h,'a272')
  set i=i+LoadInteger(hashtable019,h,'a278')
  set i=i+LoadInteger(hashtable019,h,'a310')
  set i=i+LoadInteger(hashtable019,h,'a430')
  call AddBonusDamage(u,i)
endfunction

function G89 takes unit u,integer d returns nothing
  local integer array b
  local integer a=d
  local integer c=1
  local integer i=0
  local integer E29
  if d<1 then
    call UnitRemoveAbility(u,SN[0])
    call UnitRemoveAbility(u,SN[1])
    call UnitRemoveAbility(u,SN[2])
    call UnitRemoveAbility(u,SN[3])
    call UnitRemoveAbility(u,SN[4])
    call UnitRemoveAbility(u,SN[5])
    call UnitRemoveAbility(u,SN[6])
    call UnitRemoveAbility(u,SN[7])
    call UnitRemoveAbility(u,SN[8])
    call UnitRemoveAbility(u,SN[9])
    call UnitRemoveAbility(u,SN[10])
    return
  endif
  loop
    exitwhen c==0
    set c=a/ 2
    set b[i]=a-c*2
    set a=c
    set i=i+1
  endloop
  set E29=10
  set i=0
  loop
    exitwhen i>E29
    if b[i]==1 then
      call UnitAddAbility(u,SN[i])
      call UnitMakeAbilityPermanent(u,true,SN[i])
    else
      call UnitRemoveAbility(u,SN[i])
    endif
    set i=i+1
  endloop
endfunction

function AddBonusAS takes unit u,integer d returns nothing
  local integer array b
  local integer a=d
  local integer c=1
  local integer i=0
  local integer E29
  if d<1 then
    call UnitRemoveAbility(u,TN[0])
    call UnitRemoveAbility(u,TN[1])
    call UnitRemoveAbility(u,TN[2])
    call UnitRemoveAbility(u,TN[3])
    call UnitRemoveAbility(u,TN[4])
    call UnitRemoveAbility(u,TN[5])
    call UnitRemoveAbility(u,TN[6])
    call UnitRemoveAbility(u,TN[7])
    call UnitRemoveAbility(u,TN[8])
    return
  endif
  loop
    exitwhen c==0
    set c=a/ 2
    set b[i]=a-c*2
    set a=c
    set i=i+1
  endloop
  set E29=8
  set i=0
  loop
    exitwhen i>E29
    if b[i]==1 then
      call UnitAddAbility(u,TN[i])
    else
      call UnitRemoveAbility(u,TN[i])
    endif
    set i=i+1
  endloop
endfunction

function GD9 takes unit u,integer d returns nothing
  local integer array b
  local integer a=d
  local integer c=1
  local integer i=0
  local integer E29
  if d<1 then
    call UnitRemoveAbility(u,RN[0])
    call UnitRemoveAbility(u,RN[1])
    call UnitRemoveAbility(u,RN[2])
    call UnitRemoveAbility(u,RN[3])
    call UnitRemoveAbility(u,RN[4])
    call UnitRemoveAbility(u,RN[5])
    return
  endif
  loop
    exitwhen c==0
    set c=a/ 2
    set b[i]=a-c*2
    set a=c
    set i=i+1
  endloop
  set E29=i
  set i=0
  loop
    exitwhen i>E29
    if b[i]==1 then
      call UnitAddAbility(u,RN[i])
    else
      call UnitRemoveAbility(u,RN[i])
    endif
    set i=i+1
  endloop
endfunction

function Func1088 takes unit Source returns integer
  local integer W78=GetUnitTypeId(Source)
  local integer Func1086='o01P'
  if W78=='Udre' or W78=='H071' then
    set Func1086='o01N'
  endif
  return Func1086
endfunction

function Func1085 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call KillUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SetUnitX(Caster,GetUnitX(Source))
    call SetUnitY(Caster,GetUnitY(Source))
  endif
  set t=null
  set Source=null
  set Caster=null
  return false
endfunction

function GJ9 takes unit Source returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=CreateUnit(GetOwningPlayer(Source),Func1088(Source),GetUnitX(Source),GetUnitY(Source),0)
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Func1085))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  set t=null
  set Caster=null
endfunction

function Func1096 takes integer unitId returns boolean
  local integer i=0
  loop
    exitwhen i>59
    if unitId==BuybackUnitId[i]then
      return true
    endif
    set i=i+1
  endloop
  return false
endfunction

function DefineBuybackUnitIndex takes integer Level returns integer
  local real Time=TimerGetElapsed(GlobalTimer)-GameStartsTime
  local real Minutes=(R2I(Time)/ 60)-(1/ 2)
  local real Func1093=100+Level*Level*1.5+Minutes*15
  local integer ZG8
  set ZG8=R2I(Func1093/ 50)
  set ZG8=IMinBJ(ZG8,59)
  set ZG8=IMaxBJ(ZG8,0)
  return ZG8
endfunction

function FixVisionGlitch_DefineDummy takes unit hero returns integer
  local integer uid=GetUnitTypeId(hero)
  local integer did='o01P'
  if uid=='Udre' or uid=='H071' then
    set did='o01N'
  endif
  return did
endfunction

function FixVisionGlitch_CorrectXY takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit hero=(LoadUnitHandle(hashtable019,(h),(2)))
  local unit dummy=(LoadUnitHandle(hashtable019,(h),(19)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH or hero==null then
    call KillUnit(dummy)
    call FlushChildHashtable(hashtable019,(h))
    call DestroyTrigger(t)
  else
    call SetUnitX(dummy,GetUnitX(hero))
    call SetUnitY(dummy,GetUnitY(hero))
  endif
  set t=null
  set hero=null
  set dummy=null
  return false
endfunction

function FixVisionGlitchOnBuyBach takes unit u returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local unit d=CreateUnit(GetOwningPlayer(u),FixVisionGlitch_DefineDummy(u),GetUnitX(u),GetUnitY(u),0)
  call TriggerRegisterTimerEvent(t,0.1,true)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function FixVisionGlitch_CorrectXY))
  call SaveUnitHandle(hashtable019,(h),(2),(u))
  call SaveUnitHandle(hashtable019,(h),(19),(d))
  set t=null
  set d=null
endfunction

function Func1094 takes player p returns nothing
  local integer id=GetPlayerId(p)
  local unit Func1095=CirclesOfPower[id]
  local unit Hero=udg_Hero[id]
  local integer Level=GetHeroLevel(Hero)
  local integer i=0
  call FixVisionGlitchOnBuyBach(Hero)
  loop
    exitwhen i>59
    call RemoveUnitFromStock(Func1095,BuybackUnitId[i])
    set i=i+1
  endloop
  if Mode_DM then
    return
  endif
  if YL7==false then
    return
  endif
  call AddUnitToStock(Func1095,BuybackUnitId[DefineBuybackUnitIndex(Level)],1,1)
  set UN[id]=BuybackUnitId[DefineBuybackUnitIndex(Level)]
  set Hero=null
  set Func1095=null
endfunction

function GR9 takes player p returns nothing
  local integer id=GetPlayerId(p)
  local unit Func1095=CirclesOfPower[id]
  local unit Hero=udg_Hero[id]
  local integer Level=GetHeroLevel(Hero)
  local integer i=0
  if Mode_DM then
    return
  endif
  if YL7==false then
    return
  endif
  if UN[id]=='h0D4' then
    return
  endif
  if UN[id]!=0 then
    call RemoveUnitFromStock(Func1095,UN[id])
  endif
  call AddUnitToStock(Func1095,BuybackUnitId[DefineBuybackUnitIndex(Level)],1,1)
  set UN[id]=BuybackUnitId[DefineBuybackUnitIndex(Level)]
  set Hero=null
  set Func1095=null
endfunction

function GS9 takes nothing returns boolean
  if Mode_DM then
    return false
  endif
  call GR9(Sentinels[1])
  call GR9(Sentinels[2])
  call GR9(Sentinels[3])
  call GR9(Sentinels[4])
  call GR9(Sentinels[5])
  call GR9(Scourges[1])
  call GR9(Scourges[2])
  call GR9(Scourges[3])
  call GR9(Scourges[4])
  call GR9(Scourges[5])
  return false
endfunction

function GT9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer id=(LoadInteger(hashtable019,(Cache),(34)))
  local unit Func1095=CirclesOfPower[id]
  local unit Hero=udg_Hero[id]
  local integer Level=GetHeroLevel(Hero)
  local integer i=0
  call UnitRemoveAbility(Func1095,'A20U')
  call AddUnitToStock(Func1095,BuybackUnitId[DefineBuybackUnitIndex(Level)],1,1)
  set UN[id]=BuybackUnitId[DefineBuybackUnitIndex(Level)]
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Func1095=null
  set Hero=null
  return false
endfunction

function GU9 takes player p returns nothing
  local integer id=GetPlayerId(p)
  local unit Func1095=CirclesOfPower[id]
  local unit Hero=udg_Hero[id]
  local integer Level=GetHeroLevel(Hero)
  local integer i=0
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call GJ9(Hero)
  loop
    exitwhen i>59
    call RemoveUnitFromStock(Func1095,BuybackUnitId[i])
    set i=i+1
  endloop
  call TriggerAddCondition(t,Condition(function GT9))
  call TriggerRegisterTimerEvent(t,360,false)
  call SaveInteger(hashtable019,(Cache),(34),(id))
  set UN[id]='h0D4'
  call UnitAddAbility(Func1095,'A20U')
  call IssueImmediateOrderById(Func1095,852526)
  set Hero=null
  set Func1095=null
  set t=null
endfunction

function StorePlayersColorValues takes nothing returns nothing
  set PlayerColors_R[GetPlayerId(Sentinels[1])]=0
  set PlayerColors_G[GetPlayerId(Sentinels[1])]=66
  set PlayerColors_B[GetPlayerId(Sentinels[1])]=255
  set PlayerColors_R[GetPlayerId(Sentinels[2])]=48
  set PlayerColors_G[GetPlayerId(Sentinels[2])]=230
  set PlayerColors_B[GetPlayerId(Sentinels[2])]=185
  set PlayerColors_R[GetPlayerId(Sentinels[3])]=50
  set PlayerColors_G[GetPlayerId(Sentinels[3])]=0
  set PlayerColors_B[GetPlayerId(Sentinels[3])]=129
  set PlayerColors_R[GetPlayerId(Sentinels[4])]=255
  set PlayerColors_G[GetPlayerId(Sentinels[4])]=252
  set PlayerColors_B[GetPlayerId(Sentinels[4])]=1
  set PlayerColors_R[GetPlayerId(Sentinels[5])]=255
  set PlayerColors_G[GetPlayerId(Sentinels[5])]=50
  set PlayerColors_B[GetPlayerId(Sentinels[5])]=0
  set PlayerColors_R[GetPlayerId(Scourges[1])]=220
  set PlayerColors_G[GetPlayerId(Scourges[1])]=50
  set PlayerColors_B[GetPlayerId(Scourges[1])]=50
  set PlayerColors_R[GetPlayerId(Scourges[2])]=50
  set PlayerColors_G[GetPlayerId(Scourges[2])]=50
  set PlayerColors_B[GetPlayerId(Scourges[2])]=50
  set PlayerColors_R[GetPlayerId(Scourges[3])]=75
  set PlayerColors_G[GetPlayerId(Scourges[3])]=150
  set PlayerColors_B[GetPlayerId(Scourges[3])]=190
  set PlayerColors_R[GetPlayerId(Scourges[4])]=16
  set PlayerColors_G[GetPlayerId(Scourges[4])]=60
  set PlayerColors_B[GetPlayerId(Scourges[4])]=18
  set PlayerColors_R[GetPlayerId(Scourges[5])]=68
  set PlayerColors_G[GetPlayerId(Scourges[5])]=42
  set PlayerColors_B[GetPlayerId(Scourges[5])]=4
endfunction

function HK9 takes nothing returns nothing
  local integer VT8
  local integer VU8
  local integer i
  set udg_Colors[GetPlayerId(Sentinels[0])]="|c00ff0303"
  set udg_Colors[GetPlayerId(Sentinels[1])]="|c000042ff"
  set udg_Colors[GetPlayerId(Sentinels[2])]="|c001ce6b9"
  set udg_Colors[GetPlayerId(Sentinels[3])]="|c00540081"
  set udg_Colors[GetPlayerId(Sentinels[4])]="|c00fffc01"
  set udg_Colors[GetPlayerId(Sentinels[5])]="|c00ff8000"
  set udg_Colors[GetPlayerId(Scourges[0])]="|c0020c000"
  set udg_Colors[GetPlayerId(Scourges[1])]="|c00e55bb0"
  set udg_Colors[GetPlayerId(Scourges[2])]="|c00959697"
  set udg_Colors[GetPlayerId(Scourges[3])]="|c007ebff1"
  set udg_Colors[GetPlayerId(Scourges[4])]="|c00106246"
  set udg_Colors[GetPlayerId(Scourges[5])]="|c004e2a04"
  call SetPlayerColor(Sentinels[0],PLAYER_COLOR_RED)
  call SetPlayerColor(Sentinels[1],PLAYER_COLOR_BLUE)
  call SetPlayerColor(Sentinels[2],PLAYER_COLOR_CYAN)
  call SetPlayerColor(Sentinels[3],PLAYER_COLOR_PURPLE)
  call SetPlayerColor(Sentinels[4],PLAYER_COLOR_YELLOW)
  call SetPlayerColor(Sentinels[5],PLAYER_COLOR_ORANGE)
  call SetPlayerColor(Scourges[0],PLAYER_COLOR_GREEN)
  call SetPlayerColor(Scourges[1],PLAYER_COLOR_PINK)
  call SetPlayerColor(Scourges[2],PLAYER_COLOR_LIGHT_GRAY)
  call SetPlayerColor(Scourges[3],PLAYER_COLOR_LIGHT_BLUE)
  call SetPlayerColor(Scourges[4],PLAYER_COLOR_AQUA)
  call SetPlayerColor(Scourges[5],PLAYER_COLOR_BROWN)
  set VT8=1
  set VU8=5
  loop
    if GetPlayerSlotState(Sentinels[VT8])==PLAYER_SLOT_STATE_EMPTY then
      call SetPlayerName(Sentinels[VT8],GetObjectName('n0DH')+" "+I2S(VT8))
    endif
    if GetPlayerSlotState(Scourges[VT8])==PLAYER_SLOT_STATE_EMPTY then
      call SetPlayerName(Scourges[VT8],GetObjectName('n0DH')+" "+I2S(5+VT8))
    endif
    set VT8=VT8+1
    exitwhen VT8>VU8
  endloop
endfunction

function Func1057 takes nothing returns nothing
  local integer i
  local integer HI9=125
  call SetUnitOwner(CirclesOfPower_1,Sentinels[1],false)
  call SetUnitOwner(CirclesOfPower_2,Sentinels[2],false)
  call SetUnitOwner(CirclesOfPower_3,Sentinels[3],false)
  call SetUnitOwner(CirclesOfPower_4,Sentinels[4],false)
  call SetUnitOwner(CirclesOfPower_5,Sentinels[5],false)
  call SetUnitOwner(CirclesOfPower_7,Scourges[1],false)
  call SetUnitOwner(CirclesOfPower_8,Scourges[2],false)
  call SetUnitOwner(CirclesOfPower_9,Scourges[3],false)
  call SetUnitOwner(CirclesOfPower_10,Scourges[4],false)
  call SetUnitOwner(CirclesOfPower_11,Scourges[5],false)
  set CirclesOfPower[GetPlayerId(Sentinels[1])]=CirclesOfPower_1
  set CirclesOfPower[GetPlayerId(Sentinels[2])]=CirclesOfPower_2
  set CirclesOfPower[GetPlayerId(Sentinels[3])]=CirclesOfPower_3
  set CirclesOfPower[GetPlayerId(Sentinels[4])]=CirclesOfPower_4
  set CirclesOfPower[GetPlayerId(Sentinels[5])]=CirclesOfPower_5
  set CirclesOfPower[GetPlayerId(Scourges[1])]=CirclesOfPower_7
  set CirclesOfPower[GetPlayerId(Scourges[2])]=CirclesOfPower_8
  set CirclesOfPower[GetPlayerId(Scourges[3])]=CirclesOfPower_9
  set CirclesOfPower[GetPlayerId(Scourges[4])]=CirclesOfPower_10
  set CirclesOfPower[GetPlayerId(Scourges[5])]=CirclesOfPower_11
  set i=1
  if GetLocalPlayer()==Player(i)then
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,HI9)
  endif
  set i=2
  if GetLocalPlayer()==Player(i)then
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,HI9)
  endif
  set i=3
  if GetLocalPlayer()==Player(i)then
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,HI9)
  endif
  set i=4
  if GetLocalPlayer()==Player(i)then
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,HI9)
  endif
  set i=5
  if GetLocalPlayer()==Player(i)then
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,HI9)
  endif
  set i=7
  if GetLocalPlayer()==Player(i)then
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,HI9)
  endif
  set i=8
  if GetLocalPlayer()==Player(i)then
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,HI9)
  endif
  set i=9
  if GetLocalPlayer()==Player(i)then
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,HI9)
  endif
  set i=10
  if GetLocalPlayer()==Player(i)then
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,HI9)
  endif
  set i=11
  if GetLocalPlayer()==Player(i)then
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower[GetPlayerId(Player(i))],255,255,255,HI9)
  endif
  set ItemSpawnX[GetPlayerId(Sentinels[1])]=GetUnitX(CirclesOfPower[GetPlayerId(Sentinels[1])])
  set ItemSpawnX[GetPlayerId(Sentinels[2])]=GetUnitX(CirclesOfPower[GetPlayerId(Sentinels[2])])
  set ItemSpawnX[GetPlayerId(Sentinels[3])]=GetUnitX(CirclesOfPower[GetPlayerId(Sentinels[3])])
  set ItemSpawnX[GetPlayerId(Sentinels[4])]=GetUnitX(CirclesOfPower[GetPlayerId(Sentinels[4])])
  set ItemSpawnX[GetPlayerId(Sentinels[5])]=GetUnitX(CirclesOfPower[GetPlayerId(Sentinels[5])])
  set ItemSpawnX[GetPlayerId(Scourges[1])]=GetUnitX(CirclesOfPower[GetPlayerId(Scourges[1])])
  set ItemSpawnX[GetPlayerId(Scourges[2])]=GetUnitX(CirclesOfPower[GetPlayerId(Scourges[2])])
  set ItemSpawnX[GetPlayerId(Scourges[3])]=GetUnitX(CirclesOfPower[GetPlayerId(Scourges[3])])
  set ItemSpawnX[GetPlayerId(Scourges[4])]=GetUnitX(CirclesOfPower[GetPlayerId(Scourges[4])])
  set ItemSpawnX[GetPlayerId(Scourges[5])]=GetUnitX(CirclesOfPower[GetPlayerId(Scourges[5])])
  set ItemSpawnY[GetPlayerId(Sentinels[1])]=GetUnitY(CirclesOfPower[GetPlayerId(Sentinels[1])])
  set ItemSpawnY[GetPlayerId(Sentinels[2])]=GetUnitY(CirclesOfPower[GetPlayerId(Sentinels[2])])
  set ItemSpawnY[GetPlayerId(Sentinels[3])]=GetUnitY(CirclesOfPower[GetPlayerId(Sentinels[3])])
  set ItemSpawnY[GetPlayerId(Sentinels[4])]=GetUnitY(CirclesOfPower[GetPlayerId(Sentinels[4])])
  set ItemSpawnY[GetPlayerId(Sentinels[5])]=GetUnitY(CirclesOfPower[GetPlayerId(Sentinels[5])])
  set ItemSpawnY[GetPlayerId(Scourges[1])]=GetUnitY(CirclesOfPower[GetPlayerId(Scourges[1])])
  set ItemSpawnY[GetPlayerId(Scourges[2])]=GetUnitY(CirclesOfPower[GetPlayerId(Scourges[2])])
  set ItemSpawnY[GetPlayerId(Scourges[3])]=GetUnitY(CirclesOfPower[GetPlayerId(Scourges[3])])
  set ItemSpawnY[GetPlayerId(Scourges[4])]=GetUnitY(CirclesOfPower[GetPlayerId(Scourges[4])])
  set ItemSpawnY[GetPlayerId(Scourges[5])]=GetUnitY(CirclesOfPower[GetPlayerId(Scourges[5])])
endfunction

function HN9 takes unit XX8 returns boolean
  local integer ID=GetUnitTypeId(XX8)
  if ID=='n00V' or ID=='n00W' or ID=='n002' or ID=='n00X' or ID=='nC38' or ID=='n01K' or ID=='n009' then
    return true
  endif
  return false
endfunction

function Func1059 takes nothing returns nothing
  if(GetOwningPlayer(GetEnumUnit())==Player(0))then
    call SetUnitOwner(GetEnumUnit(),Sentinels[0],false)
    if HN9(GetEnumUnit())==false then
      call SetUnitColor(GetEnumUnit(),ConvertPlayerColor(0))
    endif
  else
    call SetUnitOwner(GetEnumUnit(),Scourges[0],false)
    if HN9(GetEnumUnit())==false then
      call SetUnitColor(GetEnumUnit(),ConvertPlayerColor(6))
    endif
  endif
endfunction

function Func1060 takes nothing returns nothing
  local group HQ9=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(HQ9,Player(0),Condition(function ReturnTrue2))
  call ForGroup(HQ9,function Func1059)
  call GroupClear(HQ9)
  call GroupEnumUnitsOfPlayer(HQ9,Player(6),Condition(function ReturnTrue2))
  call ForGroup(HQ9,function Func1059)
  call KillGroup(HQ9)
  set HQ9=null
endfunction

function HR9 takes player p returns nothing
  local integer i=0
  local string HS9=GetPlayerName(p)
  local integer F69=StringLength(HS9)
  local integer HT9=F69
  loop
    exitwhen i==F69
    if SubString(HS9,i,i+1)=="("and SubString(HS9,i-1,i)==" "then
      set HT9=i-1
      call SetPlayerName(p,SubString(HS9,0,HT9))
      set i=F69
    else
      set i=i+1
    endif
  endloop
endfunction

function HU9 takes nothing returns nothing
  local integer HV9
  local integer HW9
  local integer VT8
  local integer VU8
  local integer x=0
  local integer y=0
  local integer i
  local trigger t=null
  local location SpawnSent=GetRectCenter(gg_rct_Allpick_Sent)
  local location SpawnScourge=GetRectCenter(gg_rct_Allpick_Scourge)
  if GetPlayerState(Sentinels[0],PLAYER_STATE_OBSERVER)!=0 or GetPlayerState(Scourges[0],PLAYER_STATE_OBSERVER)!=0 then
    set udg_ObserverMode=true
    set Sentinels[0]=Player(13)
    set Scourges[0]=Player(14)
    set udg_Observer1=Player(0)
    set udg_Observer2=Player(6)
    call SetAllyColorFilterState(0)
    loop
      exitwhen x>5
      call SetPlayerAlliance(Player(0),Sentinels[x],ConvertAllianceType(0),true)
      call SetPlayerAlliance(Player(0),Sentinels[x],ConvertAllianceType(4),true)
      call SetPlayerAlliance(Player(0),Scourges[x],ConvertAllianceType(0),false)
      call SetPlayerAlliance(Player(0),Scourges[x],ConvertAllianceType(4),false)
      set x=x+1
    endloop
  endif
  call ForceAddPlayer(Force_SentPlayers,Sentinels[0])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[1])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[2])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[3])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[4])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[5])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[0])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[1])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[2])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[3])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[4])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[5])
  call ForceAddPlayer(AllPlayers,Sentinels[1])
  call ForceAddPlayer(AllPlayers,Sentinels[2])
  call ForceAddPlayer(AllPlayers,Sentinels[3])
  call ForceAddPlayer(AllPlayers,Sentinels[4])
  call ForceAddPlayer(AllPlayers,Sentinels[5])
  call ForceAddPlayer(AllPlayers,Scourges[1])
  call ForceAddPlayer(AllPlayers,Scourges[2])
  call ForceAddPlayer(AllPlayers,Scourges[3])
  call ForceAddPlayer(AllPlayers,Scourges[4])
  call ForceAddPlayer(AllPlayers,Scourges[5])
  if udg_ObserverMode then
    call ForceAddPlayer(AllPlayers,Player(0))
    call ForceAddPlayer(AllPlayers,Player(6))
  endif
  set x=0
  set y=0
  loop
    exitwhen x>5
    loop
      exitwhen y>5
      if(x!=y)then
        call SetPlayerAlliance(Sentinels[x],Sentinels[y],ConvertAllianceType(0),true)
        call SetPlayerAlliance(Sentinels[x],Sentinels[y],ConvertAllianceType(1),true)
        call SetPlayerAlliance(Sentinels[x],Sentinels[y],ConvertAllianceType(2),true)
        call SetPlayerAlliance(Sentinels[x],Sentinels[y],ConvertAllianceType(3),true)
        call SetPlayerAlliance(Sentinels[x],Sentinels[y],ConvertAllianceType(4),true)
        call SetPlayerAlliance(Sentinels[x],Sentinels[y],ConvertAllianceType(5),true)
        call SetPlayerAlliance(Sentinels[x],Sentinels[y],ConvertAllianceType(6),false)
        call SetPlayerAlliance(Sentinels[x],Sentinels[y],ConvertAllianceType(7),false)
        call SetPlayerAlliance(Scourges[x],Scourges[y],ConvertAllianceType(0),true)
        call SetPlayerAlliance(Scourges[x],Scourges[y],ConvertAllianceType(1),true)
        call SetPlayerAlliance(Scourges[x],Scourges[y],ConvertAllianceType(2),true)
        call SetPlayerAlliance(Scourges[x],Scourges[y],ConvertAllianceType(3),true)
        call SetPlayerAlliance(Scourges[x],Scourges[y],ConvertAllianceType(4),true)
        call SetPlayerAlliance(Scourges[x],Scourges[y],ConvertAllianceType(5),true)
        call SetPlayerAlliance(Scourges[x],Scourges[y],ConvertAllianceType(6),false)
        call SetPlayerAlliance(Scourges[x],Scourges[y],ConvertAllianceType(7),false)
        call SetPlayerAlliance(Sentinels[x],Scourges[y],ConvertAllianceType(0),false)
        call SetPlayerAlliance(Sentinels[x],Scourges[y],ConvertAllianceType(1),false)
        call SetPlayerAlliance(Sentinels[x],Scourges[y],ConvertAllianceType(2),false)
        call SetPlayerAlliance(Sentinels[x],Scourges[y],ConvertAllianceType(3),false)
        call SetPlayerAlliance(Sentinels[x],Scourges[y],ConvertAllianceType(4),false)
        call SetPlayerAlliance(Sentinels[x],Scourges[y],ConvertAllianceType(5),false)
        call SetPlayerAlliance(Sentinels[x],Scourges[y],ConvertAllianceType(6),false)
        call SetPlayerAlliance(Sentinels[x],Scourges[y],ConvertAllianceType(7),false)
        call SetPlayerAlliance(Scourges[x],Sentinels[y],ConvertAllianceType(0),false)
        call SetPlayerAlliance(Scourges[x],Sentinels[y],ConvertAllianceType(1),false)
        call SetPlayerAlliance(Scourges[x],Sentinels[y],ConvertAllianceType(2),false)
        call SetPlayerAlliance(Scourges[x],Sentinels[y],ConvertAllianceType(3),false)
        call SetPlayerAlliance(Scourges[x],Sentinels[y],ConvertAllianceType(4),false)
        call SetPlayerAlliance(Scourges[x],Sentinels[y],ConvertAllianceType(5),false)
        call SetPlayerAlliance(Scourges[x],Sentinels[y],ConvertAllianceType(6),false)
        call SetPlayerAlliance(Scourges[x],Sentinels[y],ConvertAllianceType(7),false)
      endif
      set y=y+1
    endloop
    set y=0
    set x=x+1
  endloop
  call SetPlayerTeam(Sentinels[0],0)
  call SetPlayerTeam(Sentinels[1],0)
  call SetPlayerTeam(Sentinels[2],0)
  call SetPlayerTeam(Sentinels[3],0)
  call SetPlayerTeam(Sentinels[4],0)
  call SetPlayerTeam(Sentinels[5],0)
  call SetPlayerTeam(Scourges[0],1)
  call SetPlayerTeam(Scourges[1],1)
  call SetPlayerTeam(Scourges[2],1)
  call SetPlayerTeam(Scourges[3],1)
  call SetPlayerTeam(Scourges[4],1)
  call SetPlayerTeam(Scourges[5],1)
  call SetPlayerName(Sentinels[0],GetObjectName('n03N'))
  call SetPlayerName(Scourges[0],GetObjectName('n03O'))
  call SetPlayerName(NeutralsPlayer,GetObjectName('n0E8'))
  call Func1057()
  if(Sentinels[0]!=Player(0)or Scourges[0]!=Player(6))then
    call Func1060()
  endif
  call HK9()
  set HW9=VO8(Force_SentPlayers)
  set HV9=VO8(Force_ScourgePlayers)
  set VT8=1
  set VU8=5
  loop
    exitwhen VT8>VU8
    if(IsPlayer(Sentinels[VT8]))then
      call SetPlayerState(Sentinels[VT8],PLAYER_STATE_RESOURCE_GOLD,(4375/ HW9))
      call SetPlayerState(Sentinels[VT8],PLAYER_STATE_RESOURCE_LUMBER,0)
    endif
    if(IsPlayer(Scourges[VT8]))then
      call SetPlayerState(Scourges[VT8],PLAYER_STATE_RESOURCE_GOLD,(4375/ HV9))
      call SetPlayerState(Scourges[VT8],PLAYER_STATE_RESOURCE_LUMBER,0)
    endif
    set VT8=VT8+1
  endloop
  call SetPlayerHandicapXP(Sentinels[1],1)
  call SetPlayerHandicapXP(Sentinels[2],1)
  call SetPlayerHandicapXP(Sentinels[3],1)
  call SetPlayerHandicapXP(Sentinels[4],1)
  call SetPlayerHandicapXP(Sentinels[5],1)
  call SetPlayerHandicapXP(Scourges[1],1)
  call SetPlayerHandicapXP(Scourges[2],1)
  call SetPlayerHandicapXP(Scourges[3],1)
  call SetPlayerHandicapXP(Scourges[4],1)
  call SetPlayerHandicapXP(Scourges[5],1)
  call SetPlayerState(Sentinels[0],PLAYER_STATE_GIVES_BOUNTY,1)
  call SetPlayerState(Sentinels[1],PLAYER_STATE_GIVES_BOUNTY,1)
  call SetPlayerState(Sentinels[2],PLAYER_STATE_GIVES_BOUNTY,1)
  call SetPlayerState(Sentinels[3],PLAYER_STATE_GIVES_BOUNTY,1)
  call SetPlayerState(Sentinels[4],PLAYER_STATE_GIVES_BOUNTY,1)
  call SetPlayerState(Sentinels[5],PLAYER_STATE_GIVES_BOUNTY,1)
  call SetPlayerState(Scourges[0],PLAYER_STATE_GIVES_BOUNTY,1)
  call SetPlayerState(Scourges[1],PLAYER_STATE_GIVES_BOUNTY,1)
  call SetPlayerState(Scourges[2],PLAYER_STATE_GIVES_BOUNTY,1)
  call SetPlayerState(Scourges[3],PLAYER_STATE_GIVES_BOUNTY,1)
  call SetPlayerState(Scourges[4],PLAYER_STATE_GIVES_BOUNTY,1)
  call SetPlayerState(Scourges[5],PLAYER_STATE_GIVES_BOUNTY,1)
  call W18()
  call StorePlayersColorValues()
  call HR9(Sentinels[1])
  call HR9(Sentinels[2])
  call HR9(Sentinels[3])
  call HR9(Sentinels[4])
  call HR9(Sentinels[5])
  call HR9(Scourges[1])
  call HR9(Scourges[2])
  call HR9(Scourges[3])
  call HR9(Scourges[4])
  call HR9(Scourges[5])
  set x=1
  loop
    exitwhen x>5
    if IsPlayer(Sentinels[x])then
      call CreateUnitAtLoc(Sentinels[x],'n00C',SpawnSent,bj_UNIT_FACING)
    endif
    if IsPlayer(Scourges[x])then
      call CreateUnitAtLoc(Scourges[x],'n00C',SpawnScourge,bj_UNIT_FACING)
    endif
    set x=x+1
  endloop
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  set i=0
  loop
    set IL7[i]=GetPlayerName(Player(i))
    set i=i+1
    exitwhen i==16
  endloop
  set t=null
  set SpawnSent=null
  set SpawnScourge=null
endfunction

function HZ9 takes nothing returns nothing
  local integer i=1
  
  set HeroID[indexid_VS]='Hvwd'
  set DummyID[indexid_VS]='h03Z'
  set HeroCMDummy[indexid_VS]='n09U'
  set HeroIcon[indexid_VS]="ReplaceableTextures\\CommandButtons\\BTNAvengingWatcher.blp"
  call SaveUnitWinAnimation(HeroID[indexid_VS],"stand 4")
  call SaveUnitModelScale(HeroID[indexid_VS],1.35,DummyID[indexid_VS])
  set i=i+1
  set HeroID[indexid_Zeus]='Hmbr'
  set DummyID[indexid_Zeus]='h040'
  set HeroCMDummy[indexid_Zeus]='n09A'
  set HeroIcon[indexid_Zeus]="ReplaceableTextures\\CommandButtons\\BTNAvatar.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Zeus],"attack slam alternate")
  call SaveUnitModelScale(HeroID[indexid_Zeus],1.3,DummyID[indexid_Zeus])
  set i=i+1
  set HeroID[indexid_Enchantress]='Emoo'
  set DummyID[indexid_Enchantress]='h041'
  set HeroCMDummy[indexid_Enchantress]='n099'
  set HeroIcon[indexid_Enchantress]="ReplaceableTextures\\CommandButtons\\BTNDryad.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Enchantress],"stand 4")
  call SaveUnitModelScale(HeroID[indexid_Enchantress],1,DummyID[indexid_Enchantress])
  set i=i+1
  set HeroID[indexid_Morphling]='O00P'
  set DummyID[indexid_Morphling]='h042'
  set HeroCMDummy[indexid_Morphling]='n098'
  set HeroIcon[indexid_Morphling]="ReplaceableTextures\\CommandButtons\\BTNSeaElemental.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Morphling],"stand 2")
  call SaveUnitModelScale(HeroID[indexid_Morphling],1,DummyID[indexid_Morphling])
  set i=i+1
  set HeroID[indexid_CM]='Hjai'
  set DummyID[indexid_CM]='h043'
  set HeroCMDummy[indexid_CM]='n09W'
  set HeroIcon[indexid_CM]="ReplaceableTextures\\CommandButtons\\BTNJaina.blp"
  call SaveUnitWinAnimation(HeroID[indexid_CM],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_CM],1,DummyID[indexid_CM])
  set i=i+1
  set HeroID[indexid_Sven]='H001'
  set DummyID[indexid_Sven]='h044'
  set HeroCMDummy[indexid_Sven]='n096'
  set HeroIcon[indexid_Sven]="ReplaceableTextures\\CommandButtons\\BTNFelGuardBlue.tga"
  call SaveUnitWinAnimation(HeroID[indexid_Sven],"spell")
  call SaveUnitModelScale(HeroID[indexid_Sven],1,DummyID[indexid_Sven])
  set i=i+1
  set HeroID[indexid_NagaSiren]='HC49'
  set DummyID[indexid_NagaSiren]='h045'
  set HeroCMDummy[indexid_NagaSiren]='n09P'
  set HeroIcon[indexid_NagaSiren]="ReplaceableTextures\\CommandButtons\\BTNSeaWitch.blp"
  call SaveUnitWinAnimation(HeroID[indexid_NagaSiren],"spell")
  call SaveUnitModelScale(HeroID[indexid_NagaSiren],1,DummyID[indexid_NagaSiren])
  set i=i+1
  set HeroID[indexid_ES]='Otch'
  set DummyID[indexid_ES]='h046'
  set HeroCMDummy[indexid_ES]='n09D'
  set HeroIcon[indexid_ES]="ReplaceableTextures\\CommandButtons\\BTNTauren.blp"
  call SaveUnitWinAnimation(HeroID[indexid_ES],"attack slam")
  call SaveUnitModelScale(HeroID[indexid_ES],1.1,DummyID[indexid_ES])
  set i=i+1
  set HeroID[indexid_Riki]='HC92'
  set DummyID[indexid_Riki]='h047'
  set HeroCMDummy[indexid_Riki]='n09X'
  set HeroIcon[indexid_Riki]="ReplaceableTextures\\CommandButtons\\BTNSatyrTrickster.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Riki],"stand 4")
  call SaveUnitModelScale(HeroID[indexid_Riki],1,DummyID[indexid_Riki])
  set i=i+1
  set HeroID[indexid_LoneDruid]='N01O'
  set DummyID[indexid_LoneDruid]='h048'
  set HeroCMDummy[indexid_LoneDruid]='n09Y'
  set HeroIcon[indexid_LoneDruid]="ReplaceableTextures\\CommandButtons\\BTNDruidOfTheClaw.blp"
  call SaveUnitWinAnimation(HeroID[indexid_LoneDruid],"spell slam")
  call SaveUnitModelScale(HeroID[indexid_LoneDruid],1,DummyID[indexid_LoneDruid])
  call SaveUnitModelScale('n013',1.1,DummyID[indexid_LoneDruid])
  call SaveUnitModelScale('n014',1.2,DummyID[indexid_LoneDruid])
  call SaveUnitModelScale('n015',1.3,DummyID[indexid_LoneDruid])
  call SaveUnitModelScale('n004',1,DummyID[indexid_LoneDruid])
  call SaveUnitModelScale('n018',1.1,DummyID[indexid_LoneDruid])
  call SaveUnitModelScale('n01C',1.2,DummyID[indexid_LoneDruid])
  call SaveUnitModelScale('n01G',1.3,DummyID[indexid_LoneDruid])
  set i=i+1
  set HeroID[indexid_Lina]='H004'
  set DummyID[indexid_Lina]='h049'
  set HeroCMDummy[indexid_Lina]='n09Z'
  set HeroIcon[indexid_Lina]="ReplaceableTextures\\CommandButtons\\BTNSorceress.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Lina],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_Lina],1.2,DummyID[indexid_Lina])
  set i=i+1
  set HeroID[indexid_Juggernaut]='Nbbc'
  set DummyID[indexid_Juggernaut]='h04A'
  set HeroCMDummy[indexid_Juggernaut]='n0A5'
  set HeroIcon[indexid_Juggernaut]="ReplaceableTextures\\CommandButtons\\BTNChaosBlademaster.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Juggernaut],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_Juggernaut],1,DummyID[indexid_Juggernaut])
  set i=i+1
  set HeroID[indexid_Silencer]='N01A'
  set DummyID[indexid_Silencer]='h04B'
  set HeroCMDummy[indexid_Silencer]='n097'
  set HeroIcon[indexid_Silencer]="ReplaceableTextures\\CommandButtons\\BTNSpellBreaker.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Silencer],"stand ready")
  call SaveUnitModelScale(HeroID[indexid_Silencer],1,DummyID[indexid_Silencer])
  set i=i+1
  set HeroID[indexid_Treant]='Hamg'
  set DummyID[indexid_Treant]='h04C'
  set HeroCMDummy[indexid_Treant]='n09F'
  set HeroIcon[indexid_Treant]="ReplaceableTextures\\CommandButtons\\BTNTreant.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Treant],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Treant],.72,DummyID[indexid_Treant])
  set i=i+1
  set HeroID[indexid_Chieftain]='O015'
  set DummyID[indexid_Chieftain]='h07P'
  set HeroCMDummy[indexid_Chieftain]='n0GC'
  set HeroIcon[indexid_Chieftain]="ReplaceableTextures\\CommandButtons\\BTNHeroTaurenChieftain.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Chieftain],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_Chieftain],1.1,DummyID[indexid_Chieftain])
  set i=i+1
  set HeroID[indexid_Kotl]='Hblm'
  set DummyID[indexid_Kotl]='h04E'
  set HeroCMDummy[indexid_Kotl]='n09G'
  set HeroIcon[indexid_Kotl]="ReplaceableTextures\\CommandButtons\\BTNHeroArchMage.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Kotl],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_Kotl],1.2,DummyID[indexid_Kotl])
  call SaveUnitModelScale('H06X',1.5,DummyID[indexid_Kotl])
  call SaveUnitModelScale('H06Y',1.5,DummyID[indexid_Kotl])
  call SaveUnitModelScale('H06W',1.5,DummyID[indexid_Kotl])
  set i=i+1
  set HeroID[indexid_Ursa]='Huth'
  set DummyID[indexid_Ursa]='h04F'
  set HeroCMDummy[indexid_Ursa]='n09V'
  set HeroIcon[indexid_Ursa]="ReplaceableTextures\\CommandButtons\\BTNFurbolgTracker.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Ursa],"attack spell")
  call SaveUnitModelScale(HeroID[indexid_Ursa],1.2,DummyID[indexid_Ursa])
  set i=i+1
  set HeroID[indexid_OgreMagi]='Hmkg'
  set DummyID[indexid_OgreMagi]='h04G'
  set HeroCMDummy[indexid_OgreMagi]='n0A1'
  set HeroIcon[indexid_OgreMagi]="ReplaceableTextures\\CommandButtons\\BTNOgreMagi.blp"
  call SaveUnitWinAnimation(HeroID[indexid_OgreMagi],"sleep")
  call SaveUnitModelScale(HeroID[indexid_OgreMagi],1.4,DummyID[indexid_OgreMagi])
  set i=i+1
  set HeroID[indexid_Tinker]='Ntin'
  set DummyID[indexid_Tinker]='h04H'
  set HeroCMDummy[indexid_Tinker]='n0AA'
  set HeroIcon[indexid_Tinker]="ReplaceableTextures\\CommandButtons\\BTNHeroTinker.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Tinker],"stand 2")
  call SaveUnitModelScale(HeroID[indexid_Tinker],1,DummyID[indexid_Tinker])
  set i=i+1
  set HeroID[indexid_Furion]='Emns'
  set DummyID[indexid_Furion]='h04I'
  set HeroCMDummy[indexid_Furion]='n0A4'
  set HeroIcon[indexid_Furion]="ReplaceableTextures\\CommandButtons\\BTNFurion.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Furion],"spell")
  call SaveUnitModelScale(HeroID[indexid_Furion],1.2,DummyID[indexid_Furion])
  set i=i+1
  set HeroID[indexid_PL]='Ogrh'
  set DummyID[indexid_PL]='h04J'
  set HeroCMDummy[indexid_PL]='n0A3'
  set HeroIcon[indexid_PL]="ReplaceableTextures\\CommandButtons\\BTNHellScream.blp"
  call SaveUnitWinAnimation(HeroID[indexid_PL],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_PL],1,DummyID[indexid_PL])
  set i=i+1
  set HeroID[indexid_Tiny]='Ucrl'
  set DummyID[indexid_Tiny]='h04K'
  set HeroCMDummy[indexid_Tiny]='n0A7'
  set HeroIcon[indexid_Tiny]="ReplaceableTextures\\CommandButtons\\BTNMountainGiant.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Tiny],"spell")
  call SaveUnitModelScale(HeroID[indexid_Tiny],.5,DummyID[indexid_Tiny])
  call SaveUnitModelScale('U01X',.5,DummyID[indexid_Tiny])
  set i=i+1
  set HeroID[indexid_Techies]='H00K'
  set DummyID[indexid_Techies]='h04L'
  set HeroCMDummy[indexid_Techies]='n0A9'
  set HeroIcon[indexid_Techies]="ReplaceableTextures\\CommandButtons\\BTNGoblinSapper.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Techies],"stand 2")
  call SaveUnitModelScale(HeroID[indexid_Techies],1,DummyID[indexid_Techies])
  set i=i+1
  set HeroID[indexid_Chen]='H00A'
  set DummyID[indexid_Chen]='h04M'
  set HeroCMDummy[indexid_Chen]='n0AB'
  set HeroIcon[indexid_Chen]="ReplaceableTextures\\CommandButtons\\BTNHeroFarseer.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Chen],"spell chain lightning")
  call SaveUnitModelScale(HeroID[indexid_Chen],1,DummyID[indexid_Chen])
  set i=i+1
  set HeroID[indexid_Luna]='E005'
  set DummyID[indexid_Luna]='h04N'
  set HeroCMDummy[indexid_Luna]='n0BE'
  set HeroIcon[indexid_Luna]="ReplaceableTextures\\CommandButtons\\BTNHuntress.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Luna],"spell")
  call SaveUnitModelScale(HeroID[indexid_Luna],1,DummyID[indexid_Luna])
  set i=i+1
  set HeroID[indexid_Sniper]='Usyl'
  set DummyID[indexid_Sniper]='h04O'
  set HeroCMDummy[indexid_Sniper]='n0BD'
  set HeroIcon[indexid_Sniper]="ReplaceableTextures\\CommandButtons\\BTNRifleman.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Sniper],"spell")
  call SaveUnitModelScale(HeroID[indexid_Sniper],1.1,DummyID[indexid_Sniper])
  set i=i+1
  set HeroID[indexid_Troll]='N016'
  set DummyID[indexid_Troll]='h04P'
  set HeroCMDummy[indexid_Troll]='n0A8'
  set HeroIcon[indexid_Troll]="ReplaceableTextures\\CommandButtons\\BTNForestTroll.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Troll],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Troll],1.25,DummyID[indexid_Troll])
  call SaveUnitModelScale('N02B',1.25,DummyID[indexid_Troll])
  call SaveUnitModelScale('QTW2',1.25,DummyID[indexid_Troll])
  call SaveUnitModelScale('QTW3',1.25,DummyID[indexid_Troll])
  call SaveUnitModelScale('N017',1.25,DummyID[indexid_Troll])
  set i=i+1
  set HeroID[indexid_Rhasta]='Orkn'
  set DummyID[indexid_Rhasta]='h057'
  set HeroCMDummy[indexid_Rhasta]='n094'
  set HeroIcon[indexid_Rhasta]="ReplaceableTextures\\CommandButtons\\BTNShadowHunter.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Rhasta],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_Rhasta],1,DummyID[indexid_Rhasta])
  set i=i+1
  set HeroID[indexid_Wisp]='O01F'
  set DummyID[indexid_Wisp]='h0CI'
  set HeroCMDummy[indexid_Wisp]='n0KS'
  set HeroIcon[indexid_Wisp]="ReplaceableTextures\\CommandButtons\\BTNWispHero.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Wisp],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Wisp],1.3,DummyID[indexid_Wisp])
  set i=i+1
  set HeroID[indexid_Pandaren]='Npbm'
  set DummyID[indexid_Pandaren]='h053'
  set HeroCMDummy[indexid_Pandaren]='n0AO'
  set HeroIcon[indexid_Pandaren]="ReplaceableTextures\\CommandButtons\\BTNPandarenBrewmaster.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Pandaren],"stand ready")
  call SaveUnitModelScale(HeroID[indexid_Pandaren],1,DummyID[indexid_Pandaren])
  set i=i+1
  set HeroID[indexid_Centaur]='H000'
  set DummyID[indexid_Centaur]='h04X'
  set HeroCMDummy[indexid_Centaur]='n0AN'
  set HeroIcon[indexid_Centaur]="ReplaceableTextures\\CommandButtons\\BTNCentaurKhan.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Centaur],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Centaur],1.75,DummyID[indexid_Centaur])
  set i=i+1
  set HeroID[indexid_Bounty]='Naka'
  set DummyID[indexid_Bounty]='h052'
  set HeroCMDummy[indexid_Bounty]='n0AM'
  set HeroIcon[indexid_Bounty]="ReplaceableTextures\\CommandButtons\\BTNakama.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Bounty],"stand var4")
  call SaveUnitModelScale(HeroID[indexid_Bounty],1.2,DummyID[indexid_Bounty])
  set i=i+1
  set HeroID[indexid_DK]='Hlgr'
  set DummyID[indexid_DK]='h04V'
  set HeroCMDummy[indexid_DK]='n0AQ'
  set HeroIcon[indexid_DK]="ReplaceableTextures\\CommandButtons\\BTNTheCaptain.blp"
  call SaveUnitWinAnimation(HeroID[indexid_DK],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_DK],1.35,DummyID[indexid_DK])
  call SaveUnitModelScale('H00F',1,DummyID[indexid_DK])
  call SaveUnitModelScale('H00G',1,DummyID[indexid_DK])
  call SaveUnitModelScale('H00E',1,DummyID[indexid_DK])
  call FR9('H00G',255,255,200)
  call FR9('H00F',255,255,200)
  call FR9('H00G',255,200,200)
  set i=i+1
  set HeroID[indexid_AM]='Edem'
  set DummyID[indexid_AM]='h04T'
  set HeroCMDummy[indexid_AM]='n0AR'
  set HeroIcon[indexid_AM]="ReplaceableTextures\\CommandButtons\\BTNHeroDemonHunter.blp"
  call SaveUnitWinAnimation(HeroID[indexid_AM],"stand channel")
  call SaveUnitModelScale(HeroID[indexid_AM],1,DummyID[indexid_AM])
  set i=i+1
  set HeroID[indexid_Trax]='Nbrn'
  set DummyID[indexid_Trax]='h055'
  set HeroCMDummy[indexid_Trax]='n0AL'
  set HeroIcon[indexid_Trax]="ReplaceableTextures\\CommandButtons\\BTNBansheeRanger.tga"
  call SaveUnitWinAnimation(HeroID[indexid_Trax],"spell")
  call SaveUnitModelScale(HeroID[indexid_Trax],1,DummyID[indexid_Trax])
  set i=i+1
  set HeroID[indexid_Omni]='Harf'
  set DummyID[indexid_Omni]='h04Z'
  set HeroCMDummy[indexid_Omni]='n0AS'
  set HeroIcon[indexid_Omni]="ReplaceableTextures\\CommandButtons\\BTNArthas.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Omni],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_Omni],1.1,DummyID[indexid_Omni])
  set i=i+1
  set HeroID[indexid_Beastmaster]='H00D'
  set DummyID[indexid_Beastmaster]='h04S'
  set HeroCMDummy[indexid_Beastmaster]='n0AK'
  set HeroIcon[indexid_Beastmaster]="ReplaceableTextures\\CommandButtons\\BTNBeastMaster.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Beastmaster],"spell slam")
  call SaveUnitModelScale(HeroID[indexid_Beastmaster],1,DummyID[indexid_Beastmaster])
  set i=i+1
  set HeroID[indexid_THD]='E00P'
  set DummyID[indexid_THD]='h04R'
  set HeroCMDummy[indexid_THD]='n0AJ'
  set HeroIcon[indexid_THD]="ReplaceableTextures\\CommandButtons\\BTNChimaera.blp"
  call SaveUnitWinAnimation(HeroID[indexid_THD],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_THD],1,DummyID[indexid_THD])
  set i=i+1
  set HeroID[indexid_Alchemist]='N01I'
  set DummyID[indexid_Alchemist]='h054'
  set HeroCMDummy[indexid_Alchemist]='n0AI'
  set HeroIcon[indexid_Alchemist]="ReplaceableTextures\\CommandButtons\\BTNHeroAlchemist.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Alchemist],"stand 2")
  call SaveUnitModelScale(HeroID[indexid_Alchemist],1,DummyID[indexid_Alchemist])
  call SaveUnitModelScale('N01J',1,DummyID[indexid_Alchemist])
  call SaveUnitModelScale('N01H',1,DummyID[indexid_Alchemist])
  call SaveUnitModelScale('N01T',1,DummyID[indexid_Alchemist])
  call SaveUnitModelScale('H600',1,DummyID[indexid_Alchemist])
  call SaveUnitModelScale('H601',1,DummyID[indexid_Alchemist])
  call SaveUnitModelScale('H602',1,DummyID[indexid_Alchemist])
  set i=i+1
  set HeroID[indexid_Potm]='N01V'
  set DummyID[indexid_Potm]='h04W'
  set HeroCMDummy[indexid_Potm]='n0AH'
  set HeroIcon[indexid_Potm]="ReplaceableTextures\\CommandButtons\\BTNPriestessOfTheMoon.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Potm],"stand ready")
  call SaveUnitModelScale(HeroID[indexid_Potm],1,DummyID[indexid_Potm])
  set i=i+1
  set HeroID[indexid_Storm]='H00S'
  set DummyID[indexid_Storm]='h04Q'
  set HeroCMDummy[indexid_Storm]='n0AT'
  set HeroIcon[indexid_Storm]="ReplaceableTextures\\CommandButtons\\BTNStorm.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Storm],"spell")
  call SaveUnitModelScale(HeroID[indexid_Storm],1,DummyID[indexid_Storm])
  set i=i+1
  set HeroID[indexid_Huskar]='H00Q'
  set DummyID[indexid_Huskar]='h04Y'
  set HeroCMDummy[indexid_Huskar]='n0AG'
  set HeroIcon[indexid_Huskar]="ReplaceableTextures\\CommandButtons\\BTNHeadHunterBerserker.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Huskar],"stand alternate 3")
  call SaveUnitModelScale(HeroID[indexid_Huskar],1.15,DummyID[indexid_Huskar])
  set i=i+1
  set HeroID[indexid_Lanaya]='E01Y'
  set DummyID[indexid_Lanaya]='h058'
  set HeroCMDummy[indexid_Lanaya]='n0AF'
  set HeroIcon[indexid_Lanaya]="ReplaceableTextures\\CommandButtons\\BTNAssassin.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Lanaya],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_Lanaya],1.2,DummyID[indexid_Lanaya])
  set i=i+1
  set HeroID[indexid_Puck]='N00B'
  set DummyID[indexid_Puck]='h050'
  set HeroCMDummy[indexid_Puck]='n0AE'
  set HeroIcon[indexid_Puck]="ReplaceableTextures\\CommandButtons\\BTNFaerieDragon.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Puck],"attack spell")
  call SaveUnitModelScale(HeroID[indexid_Puck],1.1,DummyID[indexid_Puck])
  set i=i+1
  set HeroID[indexid_Clock]='H00T'
  set DummyID[indexid_Clock]='h051'
  set HeroCMDummy[indexid_Clock]='n0AU'
  set HeroIcon[indexid_Clock]="ReplaceableTextures\\CommandButtons\\BTNClockWerkGoblin.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Clock],"Birth")
  call SaveUnitModelScale(HeroID[indexid_Clock],1.5,DummyID[indexid_Clock])
  set i=i+1
  set HeroID[indexid_Admiral]='H06S'
  set DummyID[indexid_Admiral]='h06T'
  set HeroCMDummy[indexid_Admiral]='n0EE'
  set HeroIcon[indexid_Admiral]="ReplaceableTextures\\CommandButtons\\BTNProudmoore.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Admiral],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_Admiral],1.1,DummyID[indexid_Admiral])
  set i=i+1
  set HeroID[indexid_WR]='N0EG'
  set DummyID[indexid_WR]='h07A'
  set HeroCMDummy[indexid_WR]='n0EH'
  set HeroIcon[indexid_WR]="ReplaceableTextures\\CommandButtons\\BTNSylvanusWindrunner.blp"
  call SaveUnitWinAnimation(HeroID[indexid_WR],"stand victory")
  call SaveUnitModelScale(HeroID[indexid_WR],1.2,DummyID[indexid_WR])
  set i=i+1
  set HeroID[indexid_Gyro]='E02N'
  set DummyID[indexid_Gyro]='h0CC'
  set HeroCMDummy[indexid_Gyro]='n0KN'
  set HeroIcon[indexid_Gyro]="ReplaceableTextures\\CommandButtons\\BTNFlyingMachine.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Gyro],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Gyro],1.1,DummyID[indexid_Gyro])
  call SaveUnitModelScale('E02O',1.1,DummyID[indexid_Gyro])
  set i=i+1
  set HeroID[indexid_Disruptor]='E02J'
  set DummyID[indexid_Disruptor]='h0CD'
  set HeroCMDummy[indexid_Disruptor]='n0KR'
  set HeroIcon[indexid_Disruptor]="ReplaceableTextures\\CommandButtons\\BTNThrall.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Disruptor],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Disruptor],1.1,DummyID[indexid_Disruptor])
  set i=i+1
  set HeroID[indexid_Tusk]='E02I'
  set DummyID[indexid_Tusk]='h0C9'
  set HeroCMDummy[indexid_Tusk]='n0KK'
  set HeroIcon[indexid_Tusk]="ReplaceableTextures\\CommandButtons\\BTNTuskaarBrown.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Tusk],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Tusk],1.,DummyID[indexid_Tusk])
  set i=i+1
  set HeroID[indexid_Phoenix]='E02F'
  set DummyID[indexid_Phoenix]='h0C8'
  set HeroCMDummy[indexid_Phoenix]='n0KM'
  set HeroIcon[indexid_Phoenix]="ReplaceableTextures\\CommandButtons\\BTNPhoenix.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Phoenix],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Phoenix],1.05,DummyID[indexid_Phoenix])
  set i=i+1
  set HeroID[indexid_BB]='H008'
  set DummyID[indexid_BB]='h04U'
  set HeroCMDummy[indexid_BB]='n0AC'
  set HeroIcon[indexid_BB]="ReplaceableTextures\\CommandButtons\\BTNRazorback.blp"
  call SaveUnitWinAnimation(HeroID[indexid_BB],"stand")
  call SaveUnitModelScale(HeroID[indexid_BB],1.65,DummyID[indexid_BB])
  set i=i+1
  set HeroID[indexid_Rubick]='E02X'
  set DummyID[indexid_Rubick]='h0CT'
  set HeroCMDummy[indexid_Rubick]='n0LK'
  set HeroIcon[indexid_Rubick]="ReplaceableTextures\\CommandButtons\\BTNMedivh.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Rubick],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Rubick],1.15,DummyID[indexid_Rubick])
  set i=i+1
  set HeroID[indexid_Xin]='N0M0'
  set DummyID[indexid_Xin]='h0DG'
  set HeroCMDummy[indexid_Xin]='n0M1'
  set HeroIcon[indexid_Xin]="ReplaceableTextures\\CommandButtons\\BTNFireBrewmaster.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Xin],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Xin],1,DummyID[indexid_Xin])
  set i=i+1
  set HeroID[indexid_Legion]='E02K'
  set DummyID[indexid_Legion]='h0CA'
  set HeroCMDummy[indexid_Legion]='n0KJ'
  set HeroIcon[indexid_Legion]="ReplaceableTextures\\CommandButtons\\BTNGarithos.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Legion],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Legion],1.3,DummyID[indexid_Legion])
  set i=i+1
  set HeroID[indexid_Skywrath]='H0DO'
  set DummyID[indexid_Skywrath]='h0DH'
  set HeroCMDummy[indexid_Skywrath]='n0M6'
  set HeroIcon[indexid_Skywrath]="ReplaceableTextures\\CommandButtons\\BTNDragonHawk.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Skywrath],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Skywrath],1.1,DummyID[indexid_Skywrath])
  set i=i+1
  set HeroID[indexid_Timber]='E032'
  set DummyID[indexid_Timber]='h0EB'
  set HeroCMDummy[indexid_Timber]='n0ME'
  set HeroIcon[indexid_Timber]="ReplaceableTextures\\CommandButtons\\BTNJunkGolem.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Timber],"stand 3")
  call SaveUnitModelScale(HeroID[indexid_Timber],1,DummyID[indexid_Timber])
  set i=i+1
  set LastSentinelHeroIndexid=57
  set i=58
  set FirstScourgeHeroIndexid=58
  set HeroID[indexid_Lycan]='U008'
  set DummyID[indexid_Lycan]='h05H'
  set HeroCMDummy[indexid_Lycan]='n0B3'
  set HeroIcon[indexid_Lycan]="ReplaceableTextures\\CommandButtons\\BTNKiljaedin.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Lycan],"spell")
  call SaveUnitModelScale(HeroID[indexid_Lycan],1.2,DummyID[indexid_Lycan])
  call SaveUnitModelScale('E015',1,DummyID[indexid_Lycan])
  call FR9(HeroID[indexid_Lycan],255,75,255)
  set i=i+1
  set HeroID[indexid_Brood]='U006'
  set DummyID[indexid_Brood]='h05I'
  set HeroCMDummy[indexid_Brood]='n0B4'
  set HeroIcon[indexid_Brood]="ReplaceableTextures\\CommandButtons\\BTNSpiderBlack.blp"
  call SaveUnitWinAnimation(HeroID[indexid_Brood],"walk")
  call SaveUnitModelScale(HeroID[indexid_Brood],1.36,DummyID[indexid_Brood])
  set i=i+1
  set HeroID[indexid_PA]='Ewar'
  set DummyID[indexid_PA]='h05J'
  set HeroCMDummy[indexid_PA]='n0B5'
  set HeroIcon[indexid_PA]="ReplaceableTextures\\CommandButtons\\BTNHeroWarden.blp"
  call SaveUnitWinAnimation(HeroID[indexid_PA],"spell slam")
  call SaveUnitModelScale(HeroID[indexid_PA],1,DummyID[indexid_PA])
  set i=i+1
  set HeroID[61]='H00V'
  set DummyID[61]='h05K'
  set HeroCMDummy[61]='n0B6'
  set HeroIcon[61]="ReplaceableTextures\\CommandButtons\\BTNNagaSeaWitch.blp"
  call SaveUnitWinAnimation(HeroID[61],"stand ready")
  call SaveUnitModelScale(HeroID[61],1,DummyID[61])
  call SaveUnitModelScale('H08D',1,DummyID[61])
  call SaveUnitModelScale('H08C',1,DummyID[61])
  call SaveUnitModelScale('H084',1,DummyID[61])
  call SaveUnitModelScale('H08B',1,DummyID[61])
  set i=i+1
  set HeroID[62]='Udre'
  set DummyID[62]='h05L'
  set HeroCMDummy[62]='n0B7'
  set HeroIcon[62]="ReplaceableTextures\\CommandButtons\\BTNTichondrius.blp"
  call SaveUnitWinAnimation(HeroID[62],"spell slam")
  call SaveUnitModelScale(HeroID[62],1,DummyID[62])
  set i=i+1
  set HeroID[63]='NC00'
  set DummyID[63]='h05M'
  set HeroCMDummy[63]='n0C0'
  set HeroIcon[63]="ReplaceableTextures\\CommandButtons\\BTNSkeletonArcher.blp"
  call SaveUnitWinAnimation(HeroID[63],"stand victory")
  call SaveUnitModelScale(HeroID[63],1.8,DummyID[63])
  call FR9(HeroID[63],100,125,100)
  set i=i+1
  set HeroID[64]='UC42'
  set DummyID[64]='h05N'
  set HeroCMDummy[64]='n0BV'
  set HeroIcon[64]="ReplaceableTextures\\CommandButtons\\BTNDoomGuard.blp"
  call SaveUnitWinAnimation(HeroID[64],"stand victory")
  call SaveUnitModelScale(HeroID[64],1.1,DummyID[64])
  set i=i+1
  set HeroID[65]='U000'
  set DummyID[65]='h05O'
  set HeroCMDummy[65]='n0BU'
  set HeroIcon[65]="ReplaceableTextures\\CommandButtons\\BTNHeroCryptLord.tga"
  call SaveUnitWinAnimation(HeroID[65],"spell throw")
  call SaveUnitModelScale(HeroID[65],.8,DummyID[65])
  set i=i+1
  set HeroID[66]='UC91'
  set DummyID[66]='h05P'
  set HeroCMDummy[66]='n0C1'
  set HeroIcon[66]="ReplaceableTextures\\CommandButtons\\BTNNagaMyrmidon.tga"
  call SaveUnitWinAnimation(HeroID[66],"spell")
  call SaveUnitModelScale(HeroID[66],1,DummyID[66])
  call FR9(HeroID[66],175,75,200)
  set i=i+1
  set HeroID[67]='UC01'
  set DummyID[67]='h05Q'
  set HeroCMDummy[67]='n0C2'
  set HeroIcon[67]="ReplaceableTextures\\CommandButtons\\BTNBlueDemoness.tga"
  call SaveUnitWinAnimation(HeroID[67],"spell slam")
  call SaveUnitModelScale(HeroID[67],1.3,DummyID[67])
  set i=i+1
  set HeroID[68]='E004'
  set DummyID[68]='h05R'
  set HeroCMDummy[68]='n0BW'
  set HeroIcon[68]="ReplaceableTextures\\CommandButtons\\BTNSkeletonMage.blp"
  call SaveUnitWinAnimation(HeroID[68],"stand victory")
  call SaveUnitModelScale(HeroID[68],1,DummyID[68])
  set i=i+1
  set HeroID[69]='EC45'
  set DummyID[69]='h05S'
  set HeroCMDummy[69]='n0BS'
  set HeroIcon[69]="ReplaceableTextures\\CommandButtons\\BTNFacelessOne.blp"
  call SaveUnitWinAnimation(HeroID[69],"spell slam")
  call SaveUnitModelScale(HeroID[69],1.3,DummyID[69])
  call FR9(HeroID[69],0,255,150)
  set i=i+1
  set HeroID[70]='EC77'
  set DummyID[70]='h05T'
  set HeroCMDummy[70]='n0BR'
  set HeroIcon[70]="ReplaceableTextures\\CommandButtons\\BTNNetherDragon.blp"
  call SaveUnitWinAnimation(HeroID[70],"spell slam")
  call SaveUnitModelScale(HeroID[70],1.2,DummyID[70])
  call FR9(HeroID[70],75,255,25)
  set i=i+1
  set HeroID[71]='E002'
  set DummyID[71]='h05U'
  set HeroCMDummy[71]='n0BY'
  set HeroIcon[71]="ReplaceableTextures\\CommandButtons\\BTNRevenant.blp"
  call SaveUnitWinAnimation(HeroID[71],"spell")
  call SaveUnitModelScale(HeroID[71],1,DummyID[71])
  set i=i+1
  set HeroID[72]='U00C'
  set DummyID[72]='h05V'
  set HeroCMDummy[72]='n0BQ'
  set HeroIcon[72]="ReplaceableTextures\\CommandButtons\\BTNGhoul.blp"
  call SaveUnitWinAnimation(HeroID[72],"victory")
  call SaveUnitModelScale(HeroID[72],1.5,DummyID[72])
  call FR9(HeroID[72],100,100,100)
  set i=i+1
  set HeroID[73]='H00H'
  set DummyID[73]='h05W'
  set HeroCMDummy[73]='n0BT'
  set HeroIcon[73]="ReplaceableTextures\\CommandButtons\\BTNPugna.BLP"
  call SaveUnitWinAnimation(HeroID[73],"stand ready")
  call SaveUnitModelScale(HeroID[73],1,DummyID[73])
  set i=i+1
  set HeroID[74]='Ofar'
  set DummyID[74]='h05X'
  set HeroCMDummy[74]='n0BP'
  set HeroIcon[74]="ReplaceableTextures\\CommandButtons\\BTNSeaGiantGreen.blp"
  call SaveUnitWinAnimation(HeroID[74],"attack slam")
  call SaveUnitModelScale(HeroID[74],1,DummyID[74])
  set i=i+1
  set HeroID[75]='Oshd'
  set DummyID[75]='h05Y'
  set HeroCMDummy[75]='n0BO'
  set HeroIcon[75]="ReplaceableTextures\\CommandButtons\\BTNVoidWalker.blp"
  call SaveUnitWinAnimation(HeroID[75],"spell")
  call SaveUnitModelScale(HeroID[75],1.5,DummyID[75])
  call FR9(HeroID[75],150,0,150)
  set i=i+1
  set HeroID[76]='U00E'
  set DummyID[76]='h05Z'
  set HeroCMDummy[76]='n0B8'
  set HeroIcon[76]="ReplaceableTextures\\CommandButtons\\BTNGhostOfKelThuzad.blp"
  call SaveUnitWinAnimation(HeroID[76],"stand victory")
  call SaveUnitModelScale(HeroID[76],1.3,DummyID[76])
  set i=i+1
  set HeroID[77]='U00F'
  set DummyID[77]='h060'
  set HeroCMDummy[77]='n0C5'
  set HeroIcon[77]="ReplaceableTextures\\CommandButtons\\BTNAbomination.blp"
  call SaveUnitWinAnimation(HeroID[77],"stand 3")
  call SaveUnitModelScale(HeroID[77],1.,DummyID[77])
  set i=i+1
  set HeroID[78]='O00J'
  set DummyID[78]='h061'
  set HeroCMDummy[78]='n0C3'
  set HeroIcon[78]="ReplaceableTextures\\CommandButtons\\BTNSpiritWalker.blp"
  call SaveUnitWinAnimation(HeroID[78],"stand ready")
  call SaveUnitModelScale(HeroID[78],1.2,DummyID[78])
  set i=i+1
  set HeroID[79]='Ubal'
  set DummyID[79]='h062'
  set HeroCMDummy[79]='n0BX'
  set HeroIcon[79]="ReplaceableTextures\\CommandButtons\\BTNNerubianQueen.blp"
  call SaveUnitWinAnimation(HeroID[79],"attack")
  call SaveUnitModelScale(HeroID[79],1.,DummyID[79])
  call FR9(HeroID[79],255,200,200)
  set i=i+1
  set HeroID[80]='Nfir'
  set DummyID[80]='h063'
  set HeroCMDummy[80]='n0BN'
  set HeroIcon[80]="ReplaceableTextures\\CommandButtons\\BTNShade.blp"
  call SaveUnitWinAnimation(HeroID[80],"stand channel")
  call SaveUnitModelScale(HeroID[80],1.15,DummyID[80])
  call FR9(HeroID[80],0,0,0)
  set i=i+1
  set HeroID[81]='U00K'
  set DummyID[81]='h064'
  set HeroCMDummy[81]='n0C4'
  set HeroIcon[81]="ReplaceableTextures\\CommandButtons\\BTNArachnathidGreen.blp"
  call SaveUnitWinAnimation(HeroID[81],"attack 3")
  call SaveUnitModelScale(HeroID[81],1,DummyID[81])
  set i=i+1
  set HeroID[82]='Opgh'
  set DummyID[82]='h065'
  set HeroCMDummy[82]='n0BM'
  set HeroIcon[82]="ReplaceableTextures\\CommandButtons\\BTNChaosGrom.blp"
  call SaveUnitWinAnimation(HeroID[82],"stand victory")
  call SaveUnitModelScale(HeroID[82],1,DummyID[82])
  set i=i+1
  set HeroID[83]='Hvsh'
  set DummyID[83]='h066'
  set HeroCMDummy[83]='n0BZ'
  set HeroIcon[83]="ReplaceableTextures\\CommandButtons\\BTNShaman.blp"
  call SaveUnitWinAnimation(HeroID[83],"stand victory")
  call SaveUnitModelScale(HeroID[83],1.25,DummyID[83])
  call FR9(HeroID[83],250,150,150)
  set i=i+1
  set HeroID[84]='Udea'
  set DummyID[84]='h067'
  set HeroCMDummy[84]='n0BL'
  set HeroIcon[84]="ReplaceableTextures\\CommandButtons\\BTNHeroDeathKnight.blp"
  call SaveUnitWinAnimation(HeroID[84],"stand ready")
  call SaveUnitModelScale(HeroID[84],1,DummyID[84])
  set i=i+1
  set HeroID[85]='E01B'
  set DummyID[85]='h068'
  set HeroCMDummy[85]='n0B9'
  set HeroIcon[85]="ReplaceableTextures\\CommandButtons\\BTNvengeanceincarnate.blp"
  call SaveUnitWinAnimation(HeroID[85],"stand ready")
  call SaveUnitModelScale(HeroID[85],.8,DummyID[85])
  set i=i+1
  set HeroID[86]='E01A'
  set DummyID[86]='h069'
  set HeroCMDummy[86]='n0BK'
  set HeroIcon[86]="ReplaceableTextures\\CommandButtons\\BTNWitchDoctor.blp"
  call SaveUnitWinAnimation(HeroID[86],"stand victory")
  call SaveUnitModelScale(HeroID[86],1.25,DummyID[86])
  set i=i+1
  set HeroID[87]='U00P'
  set DummyID[87]='h06A'
  set HeroCMDummy[87]='n0BA'
  set HeroIcon[87]="ReplaceableTextures\\CommandButtons\\BTNDestroyer.blp"
  call SaveUnitWinAnimation(HeroID[87],"stand alternate 2")
  call SaveUnitModelScale(HeroID[87],.85,DummyID[87])
  set i=i+1
  set HeroID[88]='E01C'
  set DummyID[88]='h06C'
  set HeroCMDummy[88]='n0BB'
  set HeroIcon[88]="ReplaceableTextures\\CommandButtons\\BTNGuldan.blp"
  call SaveUnitWinAnimation(HeroID[88],"spell")
  call SaveUnitModelScale(HeroID[88],1.5,DummyID[88])
  set i=i+1
  set HeroID[89]='H00I'
  set DummyID[89]='h06D'
  set HeroCMDummy[89]='n0BJ'
  set HeroIcon[89]="ReplaceableTextures\\CommandButtons\\BTNKoboldGeomancer.blp"
  call SaveUnitWinAnimation(HeroID[89],"spell")
  call SaveUnitModelScale(HeroID[89],1.4,DummyID[89])
  call SaveUnitModelScale('H00J',1.4,DummyID[89])
  set i=i+1
  set HeroID[90]='N01W'
  set DummyID[90]='h06E'
  set HeroCMDummy[90]='n0BI'
  set HeroIcon[90]="ReplaceableTextures\\CommandButtons\\BTNDarkTrollShadowPriest.blp"
  call SaveUnitWinAnimation(HeroID[90],"spell")
  call SaveUnitModelScale(HeroID[90],1.2,DummyID[90])
  set i=i+1
  set HeroID[91]='N00R'
  set DummyID[91]='h06F'
  set HeroCMDummy[91]='n0BC'
  set HeroIcon[91]="ReplaceableTextures\\CommandButtons\\BTNPitLord.blp"
  call SaveUnitWinAnimation(HeroID[91],"stand channel")
  call SaveUnitModelScale(HeroID[91],.95,DummyID[91])
  set i=i+1
  set HeroID[92]='H00R'
  set DummyID[92]='h06G'
  set HeroCMDummy[92]='n0BH'
  set HeroIcon[92]="ReplaceableTextures\\CommandButtons\\BTNZombie.blp"
  call SaveUnitWinAnimation(HeroID[92],"stand")
  call SaveUnitModelScale(HeroID[92],2,DummyID[92])
  call SaveUnitModelScale('H07I',1.3,DummyID[92])
  set i=i+1
  set HeroID[93]='H00N'
  set DummyID[93]='h06H'
  set HeroCMDummy[93]='n0BG'
  set HeroIcon[93]="ReplaceableTextures\\CommandButtons\\BTNDranaiMage.blp"
  call SaveUnitWinAnimation(HeroID[93],"spell")
  call SaveUnitModelScale(HeroID[93],1.15,DummyID[93])
  set i=i+1
  set HeroID[94]='H00U'
  set DummyID[94]='h06B'
  set HeroCMDummy[94]='n0BF'
  set HeroIcon[94]="ReplaceableTextures\\CommandButtons\\BTNHeroBloodElfPrince.blp"
  call SaveUnitWinAnimation(HeroID[94],"spell")
  call SaveUnitModelScale(HeroID[94],1.25,DummyID[94])
  set i=i+1
  set HeroID[95]='Uktl'
  set DummyID[95]='h04D'
  set HeroCMDummy[95]='n0A6'
  set HeroIcon[95]="ReplaceableTextures\\CommandButtons\\BTNSpell_Shadow_SummonVoidWalker.blp"
  call SaveUnitWinAnimation(HeroID[95],"stand")
  call SaveUnitModelScale(HeroID[95],1.5,DummyID[95])
  set i=i+1
  set HeroID[96]='O016'
  set DummyID[96]='h07R'
  set HeroCMDummy[96]='n0G9'
  set HeroIcon[96]="ReplaceableTextures\\CommandButtons\\BTNTrollBatRider.blp"
  call SaveUnitWinAnimation(HeroID[96],"stand")
  call SaveUnitModelScale(HeroID[96],1.2,DummyID[96])
  call SaveUnitModelScale('O017',1.2,DummyID[96])
  set i=i+1
  set HeroID[97]='N0HP'
  set DummyID[97]='h0B0'
  set HeroCMDummy[97]='n0HR'
  set HeroIcon[97]="ReplaceableTextures\\CommandButtons\\BTNIcyGhost.blp"
  call SaveUnitWinAnimation(HeroID[97],"stand")
  call SaveUnitModelScale(HeroID[97],1.17,DummyID[97])
  call SaveUnitModelScale('N0HP',1.2,DummyID[97])
  set i=i+1
  set HeroID[98]='H071'
  set DummyID[98]='h072'
  set HeroCMDummy[98]='n0EF'
  set HeroIcon[98]="ReplaceableTextures\\CommandButtons\\BTNMurgulShadowCaster.blp"
  call SaveUnitWinAnimation(HeroID[98],"stand 3")
  call SaveUnitModelScale(HeroID[98],1.25,DummyID[98])
  set i=i+1
  set HeroID[99]='Eevi'
  set DummyID[99]='h056'
  set HeroCMDummy[99]='n0AV'
  set HeroIcon[99]="ReplaceableTextures\\CommandButtons\\BTNEvilIllidan.blp"
  call SaveUnitWinAnimation(HeroID[99],"spell channel")
  call SaveUnitModelScale(HeroID[99],1,DummyID[99])
  call SaveUnitModelScale('Eevm',1,DummyID[99])
  call SaveUnitModelScale('E02V',1,DummyID[99])
  call SaveUnitModelScale('E02W',1,DummyID[99])
  call SaveUnitModelScale('E02U',1,DummyID[99])
  set i=i+1
  set HeroID[100]='Ekee'
  set DummyID[100]='h059'
  set HeroCMDummy[100]='n0AW'
  set HeroIcon[100]="ReplaceableTextures\\CommandButtons\\BTNKeeperGhostBlue.blp"
  call SaveUnitWinAnimation(HeroID[100],"stand victory")
  call SaveUnitModelScale(HeroID[100],1,DummyID[100])
  set i=i+1
  set HeroID[101]='E02H'
  set DummyID[101]='h0CB'
  set HeroCMDummy[101]='n0KL'
  set HeroIcon[101]="ReplaceableTextures\\CommandButtons\\BTNArchimonde.blp"
  call SaveUnitWinAnimation(HeroID[101],"stand 3")
  call SaveUnitModelScale(HeroID[101],1.25,DummyID[101])
  set i=i+1
  set HeroID[102]='Ulic'
  set DummyID[102]='h05A'
  set HeroCMDummy[102]='n0AX'
  set HeroIcon[102]="ReplaceableTextures\\CommandButtons\\BTNLichVersion2.blp"
  call SaveUnitWinAnimation(HeroID[102],"stand channel")
  call SaveUnitModelScale(HeroID[102],1.3,DummyID[51])
  set i=i+1
  set HeroID[103]='UC76'
  set DummyID[103]='h05B'
  set HeroCMDummy[103]='n0AY'
  set HeroIcon[103]="ReplaceableTextures\\CommandButtons\\BTNBanshee.blp"
  call SaveUnitWinAnimation(HeroID[103],"spell wail")
  call SaveUnitModelScale(HeroID[103],1.35,DummyID[103])
  set i=i+1
  set HeroID[104]='UC18'
  set DummyID[104]='h05C'
  set HeroCMDummy[104]='n0AZ'
  set HeroIcon[104]="ReplaceableTextures\\CommandButtons\\BTNLion.BLP"
  call SaveUnitWinAnimation(HeroID[104],"spell callstorm")
  call SaveUnitModelScale(HeroID[104],1.3,DummyID[104])
  call FR9(HeroID[104],50,100,255)
  set i=i+1
  set HeroID[105]='EC57'
  set DummyID[105]='h05D'
  set HeroCMDummy[105]='n0B0'
  set HeroIcon[105]="ReplaceableTextures\\CommandButtons\\BTNHydralisk.blp"
  call SaveUnitWinAnimation(HeroID[105],"attack")
  call SaveUnitModelScale(HeroID[105],1.,DummyID[105])
  call FR9(HeroID[105],150,200,255)
  set i=i+1
  set HeroID[106]='UC11'
  set DummyID[106]='h05E'
  set HeroCMDummy[106]='n0A2'
  set HeroIcon[106]="ReplaceableTextures\\CommandButtons\\BTNBlueMagnataur.tga"
  call SaveUnitWinAnimation(HeroID[106],"stand channel")
  call SaveUnitModelScale(HeroID[106],1,DummyID[106])
  call FR9(HeroID[106],150,150,100)
  set i=i+1
  set HeroID[107]='UC60'
  set DummyID[107]='h05F'
  set HeroCMDummy[107]='n0B1'
  set HeroIcon[107]="ReplaceableTextures\\CommandButtons\\BTNSpiritWyvern.blp"
  call SaveUnitWinAnimation(HeroID[107],"stand victory")
  call SaveUnitModelScale(HeroID[107],1,DummyID[107])
  call FR9(HeroID[107],150,150,150)
  set i=i+1
  set HeroID[108]='U00A'
  set DummyID[108]='h05G'
  set HeroCMDummy[108]='n0B2'
  set HeroIcon[108]="ReplaceableTextures\\CommandButtons\\BTNChaosWarlord.blp"
  call SaveUnitWinAnimation(HeroID[108],"stand victory")
  call SaveUnitModelScale(HeroID[108],1.05,DummyID[108])
  set i=i+1
  
  set i=i+1
  set HeroID[109]='N0M7'
  set DummyID[109]='h0DW'
  set HeroCMDummy[109]='n0M8'
  set HeroIcon[109]="ReplaceableTextures\\CommandButtons\\BTNFrostWyrm.blp"
  call SaveUnitWinAnimation(HeroID[109],"stand victory")
  call SaveUnitModelScale(HeroID[109],0.9,DummyID[109])
  set i=i+1
  
  set i=i+1
  set HeroID[110]='N0MK'
  set DummyID[110]='h0EF'
  set HeroCMDummy[110]='n0ML'
  set HeroIcon[110]="ReplaceableTextures\\CommandButtons\\BTNGnollWarden.blp"
  call SaveUnitWinAnimation(HeroID[110],"stand victory")
  call SaveUnitModelScale(HeroID[110],1.5,DummyID[110])
  
  set i=i+1
  set HeroID[111]='N0MU'
  set DummyID[111]=0
  set HeroCMDummy[111]=0
  set HeroIcon[111]="ReplaceableTextures\\CommandButtons\\BTNEarthBrewmaster.blp"
  call SaveUnitWinAnimation(HeroID[111],"stand 3")
  call SaveUnitModelScale(HeroID[111],1,DummyID[111])
  
  set HeroID[112]='N0MD'
  set DummyID[112]=0
  set HeroCMDummy[112]=0
  set HeroIcon[112]="ReplaceableTextures\\CommandButtons\\BTNPriest.blp"
  call SaveUnitWinAnimation(HeroID[112],"stand victory")
  call SaveUnitModelScale(HeroID[112],1.25,DummyID[112])
  
  set HeroID[113]='H500'
  set HeroIcon[113]="ReplaceableTextures\\CommandButtons\\BTNSpell_Shadow_AntiShadow.blp"
  call SaveUnitWinAnimation(HeroID[113],"stand")
  call SaveUnitModelScale(HeroID[113],1.1,0)
  
  set HeroID[114]='HIV2'
  set DummyID[114]='h06B'
  set HeroCMDummy[114]='n0BF'
  
  set HeroID[115]='HIV3'
  set DummyID[115]='h06B'
  set HeroCMDummy[115]='n0BF'
  
  set HeroID[116]='H00U'
  set DummyID[116]='h06B'
  set HeroCMDummy[116]='n0BF'
  set HeroIcon[116]="ReplaceableTextures\\CommandButtons\\BTNHeroBloodElfPrince.blp"
  call SaveUnitWinAnimation(HeroID[116],"stand victory")
  call SaveUnitModelScale(HeroID[116],1.25,DummyID[116])
  
  set HeroID[117]='KODO'
  set DummyID[117]=0
  set HeroCMDummy[117]=0
  set HeroIcon[117]="ReplaceableTextures\\CommandButtons\\BTNKotoBeast.blp"
  call SaveUnitWinAnimation(HeroID[117],"stand victory")
  call SaveUnitModelScale(HeroID[117],1.0,DummyID[117])
  set IsHeroIngame[117]=true
  set b_isHeroPicked[117]=true
  
  set HeroID[118]='HnUT'
  set IsHeroIngame[118]=true
  set b_isHeroPicked[118]=true
  set LastScourgeHeroIndexid=112
  
  set AgiHeroesArray[1]='Nbrn'//agility
  set AgiHeroesArray[2]='Edem'
  set AgiHeroesArray[3]='N016'
  set AgiHeroesArray[4]='Nbbc'
  set AgiHeroesArray[5]='Naka'
  set AgiHeroesArray[6]='O00P'
  set AgiHeroesArray[7]='Usyl'
  set AgiHeroesArray[8]='E005'
  set AgiHeroesArray[9]='N01O'
  set AgiHeroesArray[10]='HC92'
  set AgiHeroesArray[11]='Hvwd'
  set AgiHeroesArray[12]='HC49'
  set AgiHeroesArray[13]='Huth'
  set AgiHeroesArray[14]='Ogrh'
  set AgiHeroesArray[15]='U006'
  set AgiHeroesArray[16]='EC57'
  set AgiHeroesArray[17]='Eevi'
  set AgiHeroesArray[18]='Ubal'
  set AgiHeroesArray[19]='E004'
  set AgiHeroesArray[20]='EC77'
  set AgiHeroesArray[21]='Hvsh'
  set AgiHeroesArray[22]='Nfir'
  set AgiHeroesArray[23]='E002'
  set AgiHeroesArray[24]='EC45'
  set AgiHeroesArray[25]='Ewar'
  set AgiHeroesArray[26]='U000'
  set AgiHeroesArray[27]='H00V'
  set AgiHeroesArray[28]='E01B'
  set AgiHeroesArray[29]='N01V'
  set AgiHeroesArray[30]='H00I'
  set AgiHeroesArray[31]='E01Y'
  set AgiHeroesArray[32]='H071'
  set AgiHeroesArray[33]='E02N'
  set AgiHeroesArray[34]='N0M0'
  set AgiHeroesArray[35]='N0MK'
  set AgilityHeroesAmount=35
  set StrHeroesArray[1]='Npbm'//strength
  set StrHeroesArray[2]='Hlgr'
  set StrHeroesArray[3]='Harf'
  set StrHeroesArray[4]='H000'
  set StrHeroesArray[5]='H001'
  set StrHeroesArray[6]='Hamg'
  set StrHeroesArray[7]='H008'
  set StrHeroesArray[8]='Ucrl'
  set StrHeroesArray[9]='Otch'
  set StrHeroesArray[10]='NC00'
  set StrHeroesArray[11]='Udre'
  set StrHeroesArray[12]='UC11'
  set StrHeroesArray[13]='Ofar'
  set StrHeroesArray[14]='U00F'
  set StrHeroesArray[15]='U00K'
  set StrHeroesArray[16]='O00J'
  set StrHeroesArray[17]='Udea'
  set StrHeroesArray[18]='Opgh'
  set StrHeroesArray[19]='U00A'
  set StrHeroesArray[20]='U00C'
  set StrHeroesArray[21]='UC91'
  set StrHeroesArray[22]='UC42'
  set StrHeroesArray[23]='U008'
  set StrHeroesArray[24]='H00D'
  set StrHeroesArray[25]='N01I'
  set StrHeroesArray[26]='H00Q'
  set StrHeroesArray[27]='N00R'
  set StrHeroesArray[28]='H00T'
  set StrHeroesArray[29]='H06S'
  set StrHeroesArray[30]='H00R'
  set StrHeroesArray[31]='O015'
  set StrHeroesArray[32]='E02I'
  set StrHeroesArray[33]='E02F'
  set StrHeroesArray[34]='O01F'
  set StrHeroesArray[35]='E032'
  set StrHeroesArray[36]='E02K'
  set StrHeroesArray[37]='N0MU'
  set StrHeroesArray[38]='KODO'
  set StrHeroesAmount=38
  set IntHeroesArray[1]='Orkn'//intel
  set IntHeroesArray[2]='Emoo'
  set IntHeroesArray[3]='Emns'
  set IntHeroesArray[4]='H004'
  set IntHeroesArray[5]='Hjai'
  set IntHeroesArray[6]='Uktl'
  set IntHeroesArray[7]='Hmbr'
  set IntHeroesArray[8]='H00K'
  set IntHeroesArray[9]='Ntin'
  set IntHeroesArray[10]='Hmkg'
  set IntHeroesArray[11]='Hblm'
  set IntHeroesArray[12]='N01A'
  set IntHeroesArray[13]='H00A'
  set IntHeroesArray[14]='Ulic'
  set IntHeroesArray[15]='Ekee'
  set IntHeroesArray[16]='UC76'
  set IntHeroesArray[17]='UC18'
  set IntHeroesArray[18]='UC01'
  set IntHeroesArray[19]='UC60'
  set IntHeroesArray[20]='H00H'
  set IntHeroesArray[21]='Oshd'
  set IntHeroesArray[22]='U00E'
  set IntHeroesArray[23]='E01A'
  set IntHeroesArray[24]='U00P'
  set IntHeroesArray[25]='E00P'
  set IntHeroesArray[26]='E01C'
  set IntHeroesArray[27]='N01W'
  set IntHeroesArray[28]='H00N'
  set IntHeroesArray[29]='N0EG'
  set IntHeroesArray[30]='H00S'
  set IntHeroesArray[31]='N00B'
  set IntHeroesArray[32]='H00U'
  set IntHeroesArray[33]='O016'
  set IntHeroesArray[34]='N0HP'
  set IntHeroesArray[35]='E02H'
  set IntHeroesArray[36]='E02J'
  set IntHeroesArray[37]='E02X'
  set IntHeroesArray[38]='H0DO'
  set IntHeroesArray[39]='N0M7'
  set IntHeroesArray[40]='N0MD'
  set IntHeroesArray[41]='H500'
  set IntHeroesAmount=41
  set RangeHeroesArray[1]='Orkn'//range
  set RangeHeroesArray[2]='Emoo'
  set RangeHeroesArray[3]='Emns'
  set RangeHeroesArray[4]='H004'
  set RangeHeroesArray[5]='Hjai'
  set RangeHeroesArray[6]='Uktl'
  set RangeHeroesArray[7]='Hmbr'
  set RangeHeroesArray[8]='H00K'
  set RangeHeroesArray[9]='Ntin'
  set RangeHeroesArray[10]='Nbrn'
  set RangeHeroesArray[11]='Hblm'
  set RangeHeroesArray[12]='N01A'
  set RangeHeroesArray[13]='H00A'
  set RangeHeroesArray[14]='Ulic'
  set RangeHeroesArray[15]='Ekee'
  set RangeHeroesArray[16]='UC76'
  set RangeHeroesArray[17]='UC18'
  set RangeHeroesArray[18]='UC01'
  set RangeHeroesArray[19]='UC60'
  set RangeHeroesArray[20]='H00H'
  set RangeHeroesArray[21]='Oshd'
  set RangeHeroesArray[22]='U00E'
  set RangeHeroesArray[23]='E01A'
  set RangeHeroesArray[24]='U00P'
  set RangeHeroesArray[25]='E00P'
  set RangeHeroesArray[26]='E01C'
  set RangeHeroesArray[27]='N01W'
  set RangeHeroesArray[28]='N0EG'
  set RangeHeroesArray[29]='H00S'
  set RangeHeroesArray[30]='N00B'
  set RangeHeroesArray[31]='H00U'
  set RangeHeroesArray[32]='N016'
  set RangeHeroesArray[33]='O00P'
  set RangeHeroesArray[34]='Usyl'
  set RangeHeroesArray[35]='E005'
  set RangeHeroesArray[36]='N01O'
  set RangeHeroesArray[37]='E01Y'
  set RangeHeroesArray[38]='Hvwd'
  set RangeHeroesArray[39]='EC57'
  set RangeHeroesArray[40]='Ubal'
  set RangeHeroesArray[41]='E004'
  set RangeHeroesArray[42]='EC77'
  set RangeHeroesArray[43]='Nfir'
  set RangeHeroesArray[44]='E002'
  set RangeHeroesArray[45]='H00V'
  set RangeHeroesArray[46]='N01V'
  set RangeHeroesArray[47]='H00Q'
  set RangeHeroesArray[48]='O016'
  set RangeHeroesArray[49]='N0HP'
  set RangeHeroesArray[50]='O01F'
  set RangeHeroesArray[51]='E02H'
  set RangeHeroesArray[52]='E02N'
  set RangeHeroesArray[53]='E02J'
  set RangeHeroesArray[54]='E02F'
  set RangeHeroesArray[55]='E02X'
  set RangeHeroesArray[56]='H0DO'
  set RangeHeroesArray[57]='N0MK'
  set RangeHeroesArray[58]='N0M7'
  set RangeHeroesArray[59]='H500'
  set RangeHeroesArray[60]='N0MD'
  set RangeHeroesArray[61]='KODO'
  set RangeHeroesAmount=61
  set MeleeHeroesArray[1]='Hmkg'
  set MeleeHeroesArray[2]='H00N'
  set MeleeHeroesArray[3]='Edem'
  set MeleeHeroesArray[4]='Nbbc'
  set MeleeHeroesArray[5]='Naka'
  set MeleeHeroesArray[6]='HC49'
  set MeleeHeroesArray[7]='Huth'
  set MeleeHeroesArray[8]='Ogrh'
  set MeleeHeroesArray[9]='U006'
  set MeleeHeroesArray[10]='Eevi'
  set MeleeHeroesArray[11]='Hvsh'
  set MeleeHeroesArray[12]='EC45'
  set MeleeHeroesArray[13]='Ewar'
  set MeleeHeroesArray[14]='U000'
  set MeleeHeroesArray[15]='E01B'
  set MeleeHeroesArray[16]='H00I'
  set MeleeHeroesArray[17]='HC92'
  set MeleeHeroesArray[18]='Npbm'
  set MeleeHeroesArray[19]='Hlgr'
  set MeleeHeroesArray[20]='Harf'
  set MeleeHeroesArray[21]='H000'
  set MeleeHeroesArray[22]='H001'
  set MeleeHeroesArray[23]='Hamg'
  set MeleeHeroesArray[24]='H008'
  set MeleeHeroesArray[25]='Ucrl'
  set MeleeHeroesArray[26]='Otch'
  set MeleeHeroesArray[27]='NC00'
  set MeleeHeroesArray[28]='Udre'
  set MeleeHeroesArray[29]='UC11'
  set MeleeHeroesArray[30]='Ofar'
  set MeleeHeroesArray[31]='U00F'
  set MeleeHeroesArray[32]='U00K'
  set MeleeHeroesArray[33]='O00J'
  set MeleeHeroesArray[34]='Udea'
  set MeleeHeroesArray[35]='Opgh'
  set MeleeHeroesArray[36]='U00A'
  set MeleeHeroesArray[37]='U00C'
  set MeleeHeroesArray[38]='UC91'
  set MeleeHeroesArray[39]='UC42'
  set MeleeHeroesArray[40]='U008'
  set MeleeHeroesArray[41]='H00D'
  set MeleeHeroesArray[42]='N01I'
  set MeleeHeroesArray[43]='N00R'
  set MeleeHeroesArray[44]='H00T'
  set MeleeHeroesArray[45]='H06S'
  set MeleeHeroesArray[46]='H00R'
  set MeleeHeroesArray[47]='O015'
  set MeleeHeroesArray[48]='H071'
  set MeleeHeroesArray[49]='E02I'
  set MeleeHeroesArray[50]='N0M0'
  set MeleeHeroesArray[51]='E032'
  set MeleeHeroesArray[52]='E02K'
  set MeleeHeroesArray[53]='N0MU'
  set MeleeHeroesAmount=53
  call VX8()
endfunction

function HA9 takes nothing returns nothing
  call SaveUnitWinAnimation('esen',"stand 4")
  call SaveUnitWinAnimation('e00V',"stand 4")
  call SaveUnitWinAnimation('edry',"spell")
  call SaveUnitWinAnimation('e00W',"spell")
  call SaveUnitWinAnimation('ugho',"stand victory")
  call SaveUnitWinAnimation('u001',"stand victory")
  call SaveUnitWinAnimation('unec',"stand channel")
  call SaveUnitWinAnimation('u002',"stand channel")
  call SaveUnitModelScale('n00M',.4,'n00M')
  call SaveUnitModelScale('e02R',.5,'e02R')
  call SaveUnitModelScale('e02T',1.2,'e02T')
  call SaveUnitModelScale('e02S',.5,'e02S')
  call SaveUnitModelScale('e030',.5,'e030')
  call SaveUnitModelScale('n0LS',1,'n0LS')
endfunction


function ChangeUnitTint_BackToNormal takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local string s=LoadStr(HeroStats,GetUnitTypeId(u),COLOR)
  local integer r=255
  local integer g=255
  local integer b=255
  if(s!="" and s!=null)then
    set r=S2I(SubString(s,0,3))
    set g=S2I(SubString(s,3,6))
    set b=S2I(SubString(s,6,9))
  endif
  call SetUnitVertexColor(u,r,g,b,255)
  call CleanTrigger(t)
  call FlushChildHashtable(hashtable019,h)
  set t=null
  set u=null
endfunction

function ChangeUnitTint takes unit u, integer red,integer green, integer blue, integer transparency, real duration returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call SetUnitVertexColor(u,red,green,blue,255-transparency)
  call TriggerRegisterTimerEvent(t,duration,false)
  call TriggerAddCondition(t,Condition(function ChangeUnitTint_BackToNormal))
  call SaveUnitHandle(hashtable019,h,0,u)
  set t=null
endfunction

function IsItemAbilityById takes integer id returns boolean
  local integer i=0
  loop
    exitwhen i>ItemsActiveAbilitiesCount
    if ItemsActiveAbilities[i]==id then
      return true
    endif
    set i=i+1
  endloop
  return false
endfunction

function Func1034 takes nothing returns nothing
  //item abilities
  local integer i=ItemsActiveAbilitiesCount
  set i=i+1
  set ItemsActiveAbilities[i]='A1ZW'
  set i=i+1
  set ItemsActiveAbilities[i]='A0B6'
  set i=i+1
  set ItemsActiveAbilities[i]='A0K7'
  set i=i+1
  set ItemsActiveAbilities[i]='A0T7'
  set i=i+1
  set ItemsActiveAbilities[i]='A0T8'
  set i=i+1
  set ItemsActiveAbilities[i]='A11F'
  set i=i+1
  set ItemsActiveAbilities[i]='A11H'
  set i=i+1
  set ItemsActiveAbilities[i]='A2LI'
  set i=i+1
  set ItemsActiveAbilities[i]='A11G'
  set i=i+1
  set ItemsActiveAbilities[i]='A11D'
  set i=i+1
  set ItemsActiveAbilities[i]='A0S3'
  set i=i+1
  set ItemsActiveAbilities[i]='A11E'
  set i=i+1
  set ItemsActiveAbilities[i]='A15W'
  set i=i+1
  set ItemsActiveAbilities[i]='A2HQ'
  set i=i+1
  set ItemsActiveAbilities[i]='A231'
  set i=i+1
  set ItemsActiveAbilities[i]='A2HO'
  set i=i+1
  set ItemsActiveAbilities[i]='A02O'
  set i=i+1
  set ItemsActiveAbilities[i]='A08Y'
  set i=i+1
  set ItemsActiveAbilities[i]='A08Z'
  set i=i+1
  set ItemsActiveAbilities[i]='A090'
  set i=i+1
  set ItemsActiveAbilities[i]='A092'
  set i=i+1
  set ItemsActiveAbilities[i]='AIpg'
  set i=i+1
  set ItemsActiveAbilities[i]='AItb'
  set i=i+1
  set ItemsActiveAbilities[i]='A0H6'
  set i=i+1
  set ItemsActiveAbilities[i]='A1QD'
  set i=i+1
  set ItemsActiveAbilities[i]='A1T7'
  set i=i+1
  set ItemsActiveAbilities[i]='A19M'
  set i=i+1
  set ItemsActiveAbilities[i]='A1AC'
  set i=i+1
  set ItemsActiveAbilities[i]='AChx'
  set i=i+1
  set ItemsActiveAbilities[i]='A28Y'
  set i=i+1
  set ItemsActiveAbilities[i]='AIbk'
  set i=i+1
  set ItemsActiveAbilities[i]='A1EW'
  set i=i+1
  set ItemsActiveAbilities[i]='A017'
  set i=i+1
  set ItemsActiveAbilities[i]='A0JY'
  set i=i+1
  set ItemsActiveAbilities[i]='A0FO'
  set i=i+1
  set ItemsActiveAbilities[i]='A0H7'
  set i=i+1
  set ItemsActiveAbilities[i]='A0B8'
  set i=i+1
  set ItemsActiveAbilities[i]='A1WE'
  set i=i+1
  set ItemsActiveAbilities[i]='AIxk'
  set i=i+1
  set ItemsActiveAbilities[i]='A1ZI'
  set i=i+1
  set ItemsActiveAbilities[i]='A0CK'
  set i=i+1
  set ItemsActiveAbilities[i]='A0JL'
  set i=i+1
  set ItemsActiveAbilities[i]='A1FO'
  set i=i+1
  set ItemsActiveAbilities[i]='AIda'
  set i=i+1
  set ItemsActiveAbilities[i]='A0HB'
  set i=i+1
  set ItemsActiveAbilities[i]='A0D3'
  set i=i+1
  set ItemsActiveAbilities[i]='A0DF'
  set i=i+1
  set ItemsActiveAbilities[i]='A0FD'
  set i=i+1
  set ItemsActiveAbilities[i]='A12W'
  set i=i+1
  set ItemsActiveAbilities[i]='A14A'
  set i=i+1
  set ItemsActiveAbilities[i]='A1FD'
  set i=i+1
  set ItemsActiveAbilities[i]='A1IO'
  set i=i+1
  set ItemsActiveAbilities[i]='A02W'
  set i=i+1
  set ItemsActiveAbilities[i]='A269'
  set i=i+1
  set ItemsActiveAbilities[i]='A2KG'
  set i=i+1
  set ItemsActiveAbilities[i]='A1FP'
  set i=i+1
  set ItemsActiveAbilities[i]='A0T9'
  set i=i+1
  set ItemsActiveAbilities[i]='A1Q8'
  set i=i+1
  set ItemsActiveAbilities[i]='A1MO'
  set i=i+1
  set ItemsActiveAbilities[i]='A28D'
  set i=i+1
  set ItemsActiveAbilities[i]='Aeat'
  set i=i+1
  set ItemsActiveAbilities[i]='ANTG'
  set i=i+1
  set ItemsActiveAbilities[i]='ANLS'
  set i=i+1
  set ItemsActiveAbilities[i]='A0K0'
  set i=i+1
  set ItemsActiveAbilities[i]='AIpl'
  set i=i+1
  set ItemsActiveAbilities[i]='A0JT'
  set i=i+1
  set ItemsActiveAbilities[i]='AIpr'
  set i=i+1
  set ItemsActiveAbilities[i]='A02X'
  set i=i+1
  set ItemsActiveAbilities[i]='A1R5'
  set i=i+1
  set ItemsActiveAbilities[i]='AIsw'
  set i=i+1
  set ItemsActiveAbilities[i]='A206'
  set i=i+1
  set ItemsActiveAbilities[i]='A1ZH'
  set i=i+1
  set ItemsActiveAbilities[i]='A2EA'
  set i=i+1
  set ItemsActiveAbilities[i]='A2K4'
  set i=i+1
  set ItemsActiveAbilities[i]='A2K7'
  set i=i+1
  set ItemsActiveAbilities[i]='A2K1'
  set i=i+1
  set ItemsActiveAbilities[ItemsActiveAbilitiesCount]='A2N1' //shadow amulet
endfunction

function isDummyAbility takes integer id returns boolean
  //dummy abilities
  return id=='A2TH' or id=='A21F' or id=='A21G' or id=='A21H' or id=='A1S9' or id=='A24A' or id=='A24B' or id=='A1S9' or id=='A06K' or id=='A1VG' or id=='A28Q' or id=='A1WF' or id=='A0T8' or id=='A0T7' or id=='A20N' or id=='A1Z2' or id=='A1Z3' or id=='A205' or id=='A14A' or id=='A269' or id=='A2KG' or id=='A21J' or id=='A27X' or id=='A28Y' or id=='A24E' or id=='A1ZH' or id=='A1WO' or id=='A1FQ' or id=='A0TE' or id=='A2JO' or id=='A2FX' or id=='A0MP' or id=='A2KE' or id=='A2KH' or id=='A2K9' or id=='A2JL' or id=='A2O2' or id=='A2MB' or id=='A21J' or id=='A2MC' or id=='A1NH' or id=='A2LI' or id=='A2TK' or id=='A1MO'
endfunction

function IT9 takes nothing returns nothing
  local integer i=1
  set i=i+1
  set SomeDummyAbilitiesList[i]='A0H6'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A012'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A06K'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A0I9'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A0HA'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A0K5'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A0PY'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A1FO'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A0RT'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A0SA'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A0T7'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A0T8'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A14A'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A0BE'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A21X'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A21W'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A21V'
  set i=i+1
  set SomeDummyAbilitiesList[i]='Anh1'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A1OZ'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A13D'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A026'
  set i=i+1
  set SomeDummyAbilitiesList[i]='A1Q8'
  set SomeDummyAbilitiesCounter=i
endfunction

function IU9 takes nothing returns nothing
  //item abilities
  set ItemsAbilities2[1]='AImt'
  set ItemsAbilities2[2]='AIda'
  set ItemsAbilities2[3]='ANtm'
  set ItemsAbilities2[4]='ACch'
  set ItemsAbilities2[5]='AIxk'
  set ItemsAbilities2[6]='A0CK'
  set ItemsAbilities2[7]='A017'
  set ItemsAbilities2[8]='A0B8'
  set ItemsAbilities2[9]='A0HB'
  set ItemsAbilities2[10]='A0D3'
  set ItemsAbilities2[10]='A0DF'
  set ItemsAbilities2[11]='A02W'
  set ItemsAbilities2[12]='AIpr'
  set ItemsAbilities2[13]='AIpl'
  set ItemsAbilities2[14]='A0FO'
  set ItemsAbilities2[15]='A0H7'
  set ItemsAbilities2[16]='A0H6'
  set ItemsAbilities2[17]='A02X'
  set ItemsAbilities2[18]='AIsw'
  set ItemsAbilities2[19]='A0CX'
  set ItemsAbilities2[20]='A0B6'
  set ItemsAbilities2[21]='Aeat'
  set ItemsAbilities2[22]='A08L'
  set ItemsAbilities2[23]='AIcy'
  set ItemsAbilities2[24]='A05Z'
  set ItemsAbilities2[25]='AIbk'
  set ItemsAbilities2[26]='A0DY'
  set ItemsAbilities2[27]='A0LZ'
  set ItemsAbilities2[28]='A0OI'
  set ItemsAbilities2[29]='A0KX'
  set ItemsAbilities2[30]='A0KW'
  set ItemsAbilities2[31]='A026'
  set ItemsAbilities2[32]='A0C4'
  set ItemsAbilities2[33]='A012'
  set ItemsAbilities2[34]='A06K'
  set ItemsAbilities2[35]='A02T'
  set ItemsAbilities2[36]='AHfa'
  set ItemsAbilities2[37]='A09V'
  set ItemsAbilities2[38]='A05Y'
  set ItemsAbilities2[39]='A0I9'
  set ItemsAbilities2[40]='A0HA'
  set ItemsAbilities2[41]='A0K5'
  set ItemsAbilities2[42]='A0PY'
  set ItemsAbilities2[43]='A0QN'
  set ItemsAbilities2[44]='A0RT'
  set ItemsAbilities2[45]='A0RP'
  set ItemsAbilities2[46]='A12W'
  set ItemsAbilities2[47]='A0SA'
  set ItemsAbilities2[48]='A0T7'
  set ItemsAbilities2[49]='A0T8'
  set ItemsAbilities2[50]='A14A'
  set ItemsAbilities2[51]='A0BE'
  set ItemsAbilities2[52]='A21X'
  set ItemsAbilities2[53]='A21W'
  set ItemsAbilities2[54]='A21V'
  set ItemsAbilities2[55]='A0MP'
  set ItemsAbilities2[56]='A13D'
  set ItemsAbilities2[57]='A0JY'
  set ItemsAbilities2[58]='A15W'
  set ItemsAbilities2[59]='A1FO'
  set ItemsAbilities2[60]='A1FD'
  set ItemsAbilities2[61]='A1OZ'
  set ItemsAbilities2[62]='A1MO'
  set ItemsAbilities2[63]='A1IO'
  set ItemsAbilities2[64]='A1Q8'
  set ItemsAbilities2[65]='A1RA'
  set ItemsAbilities2[66]='A1QV'
  set ItemsAbilities2[67]='A1WE'
  set ItemsAbilities2[68]='A1WB'
  set ItemsAbilities2[69]='A2KG'
  set ItemsAbilities2[70]='A2N1'
  set ItemsAbilities2[71]='ANTG'
  set ItemsAbilities2[72]='ANLS'
  set ItemsAbilities2[73]='A1R5'
  set ItemsAbilities2[74]='A02O'
  set ItemsAbilities2[75]='A08Y'
  set ItemsAbilities2[76]='A08Z'
  set ItemsAbilities2[77]='A090'
  set ItemsAbilities2[78]='A092'
  set ItemsAbilitiesMax2=78
endfunction

function IV9 takes nothing returns boolean
  call IU9()
  call IT9()
  call Func1034()
  return false
endfunction

function IW9 takes nothing returns nothing
  call CreateQuestBJ(0,"TRIGSTR_50004","TRIGSTR_50005","ReplaceableTextures\\CommandButtons\\BTNSpy.blp")
  call CreateQuestBJ(0,"TRIGSTR_50006","TRIGSTR_50007","ReplaceableTextures\\CommandButtons\\BTNTome.blp")
  call CreateQuestBJ(0,"TRIGSTR_50008","TRIGSTR_50009","ReplaceableTextures\\CommandButtons\\BTNAmbush.blp")
  call CreateQuestBJ(2,"TRIGSTR_50022","TRIGSTR_50023","ReplaceableTextures\\CommandButtons\\BTNSirenMirrorImage.blp")
  call CreateQuestBJ(2,"TRIGSTR_50024","TRIGSTR_50025","ReplaceableTextures\\CommandButtons\\BTNTinyGrow.blp")
  call CreateQuestBJ(2,"TRIGSTR_50020","TRIGSTR_50021","ReplaceableTextures\\CommandButtons\\BTNSlowPoison.blp")
  call CreateQuestBJ(2,"TRIGSTR_50014","TRIGSTR_50015","ReplaceableTextures\\CommandButtons\\BTNOrbOfFrost.blp")
  call CreateQuestBJ(2,"TRIGSTR_50016","TRIGSTR_50017","ReplaceableTextures\\CommandButtons\\BTNOrbOfLightning.blp")
  call CreateQuestBJ(2,"TRIGSTR_50018","TRIGSTR_50019","ReplaceableTextures\\CommandButtons\\BTNOrbOfFire.blp")
  call CreateQuestBJ(2,"TRIGSTR_50010","TRIGSTR_50011","ReplaceableTextures\\CommandButtons\\BTNSilencerSilence.blp")
  call CreateQuestBJ(2,"TRIGSTR_50012","TRIGSTR_50013","ReplaceableTextures\\CommandButtons\\BTNSpellSteal2.blp")
endfunction

function Func1037 takes nothing returns boolean
  local string s
  if IsUnitIllusion(GetTriggerUnit())==false and GetUnitTypeId(GetTriggerUnit())!='H00J' then
    set s=GetUnitName(GetTriggerUnit())+" "+GetObjectName('n0HB')+" "+GetObjectName(GetLearnedSkill())+" ("+GetObjectName('n0HC')+" "+I2S(GetLearnedSkillLevel())+")"
    call DisplayTimedTextToPlayer(udg_Observer1,0,0,3,s)
    call DisplayTimedTextToPlayer(udg_Observer2,0,0,3,s)
    //call echo(s)
  endif
  return false
endfunction

function IY9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Func1037))
  set t=null
endfunction

function GetUnitPhysicalResistance_Compute takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit u=GetTriggerUnit()
  local real Damage=LoadReal(hashtable019,Cache,20)
  local real RealDamage=GetEventDamage()
  local real ManaShieldRatio
  call HealUnitFor(u,RealDamage)
  if GetUnitAbilityLevel(u,'BNms')>0 then //Mana Shield
    set ManaShieldRatio=GetUnitAbilityLevel(u,'A0MP')*0.5
    if GetUnitAbilityLevel(u,'A0MP')<3 then
      set ManaShieldRatio=ManaShieldRatio+.25
    endif
    call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MANA)+RealDamage*.5/ManaShieldRatio)
  endif
  set GetUnitPhysicalResistance_Result=RealDamage/Damage
  call CleanTrigger(t)
  call FlushChildHashtable(hashtable019,Cache)
  set t=null
  set u=null
  return false
endfunction

function GetUnitPhysicalResistance takes unit u returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real Damage=RMinBJ(20,GetUnitState(u,UNIT_STATE_LIFE)/2)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function GetUnitPhysicalResistance_Compute))
  call SaveReal(hashtable019,Cache,20,Damage)
  set IsRealDamage=false
  call DamageTarget(u,u,2,Damage)
  set IsRealDamage=true
  set t=null
endfunction

function IZ9 takes nothing returns nothing
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,25.,(IL7[GetPlayerId((GetTriggerPlayer()))])+"|c00ff0303 "+GetObjectName('n02D')+"|r")
endfunction

function IA9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local player IB9=(LoadPlayerHandle(hashtable019,(Cache),(78)))
  local integer VT8=1
  local integer IC9
  local integer W98=GetPlayerState(IB9,PLAYER_STATE_RESOURCE_GOLD)
  if HeroHasBeenUnlocked[GetPlayerId(IB9)]==false and EL then
    if GetTriggerEvalCount(t)==4 then
      if IsPlayerAlly(GetLocalPlayer(),IB9) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,6,GetObjectName('n0J3'))
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,6,GetObjectName('n0JG'))
      endif
    endif
    return false
  endif
  if W98>20 then
    call SetPlayerState(IB9,PLAYER_STATE_RESOURCE_GOLD,0)
    set ReliableGold[GetPlayerId(IB9)]=0
    if IsSentinel(IB9)then
      set IC9=CountPlayersInForce(Force_SentPlayers)
    else
      set IC9=CountPlayersInForce(Force_ScourgePlayers)
    endif
    if IsSentinel(IB9)then
      loop
        exitwhen VT8>5
        if IsPlayer(Sentinels[VT8])then
          call SetPlayerState(Sentinels[VT8],PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(Sentinels[VT8],PLAYER_STATE_RESOURCE_GOLD)+W98/ IC9)
        endif
        set VT8=VT8+1
      endloop
    else
      loop
        exitwhen VT8>5
        if IsPlayer(Scourges[VT8])then
          call SetPlayerState(Scourges[VT8],PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(Scourges[VT8],PLAYER_STATE_RESOURCE_GOLD)+W98/ IC9)
        endif
        set VT8=VT8+1
      endloop
    endif
  endif
  set t=null
  return false
endfunction

function I39 takes player IB9 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SavePlayerHandle(hashtable019,(Cache),(78),(IB9))
  call TriggerRegisterTimerEvent(t,2,true)
  call TriggerAddCondition(t,Condition(function IA9))
  set t=null
endfunction

function I69 takes player p returns nothing
  local multiboarditem mbitem=MultiboardGetItem(CSBoard,XK7[GetPlayerId(p)],XJ7[GetPlayerId(p)])
  call MultiboardSetItemValue(mbitem,"|c00333333"+(IL7[GetPlayerId((p))])+"|r")
  call MultiboardReleaseItem(mbitem)
  set mbitem=null
endfunction

function IL9 takes nothing returns nothing
  local integer HW9=CountPlayersInForce(Force_SentPlayers)
  local integer HV9=CountPlayersInForce(Force_ScourgePlayers)
  local integer VT8
  local integer VU8
  local string Time
  local string name
  local unit Hero=udg_Hero[GetPlayerId(GetTriggerPlayer())]
  if Hero==null then
    set name=GetObjectName('n0EW')
  else
    set name=GetUnitName(Hero)
  endif
  if(SecondsForTime<10)then
    set Time=I2S(MinutesForTime)+":0"+I2S(SecondsForTime)
  else
    set Time=I2S(MinutesForTime)+":"+I2S(SecondsForTime)
  endif
  if GameEnded==false then
    set L3[GetPlayerId(GetTriggerPlayer())]="|c00555555"+Time+"|r"
    call RN8(GetPlayerId(GetTriggerPlayer()),true)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,25.,udg_Colors[GetPlayerId(GetTriggerPlayer())]+(IL7[GetPlayerId((GetTriggerPlayer()))])+" ("+name+")|r|c00ff0303 "+GetObjectName('n02D')+"|r")
    if(IsSentinel(GetTriggerPlayer()))then
      set VT8=1
      set VU8=5
      loop
        exitwhen VT8>VU8
        if(Sentinels[VT8]!=GetTriggerPlayer())then
          if(IsPlayer(Sentinels[VT8]))then
            call SetPlayerAllianceStateBJ(GetTriggerPlayer(),Sentinels[VT8],4)
          endif
        endif
        set VT8=VT8+1
      endloop
    else
      set VT8=1
      set VU8=5
      loop
        exitwhen VT8>VU8
        if(Scourges[VT8]!=GetTriggerPlayer())then
          if(IsPlayer(Scourges[VT8]))then
            call SetPlayerAllianceStateBJ(GetTriggerPlayer(),Scourges[VT8],4)
          endif
        endif
        set VT8=VT8+1
      endloop
    endif
    if IsSentinel(GetTriggerPlayer())or IsScourge(GetTriggerPlayer())then
      set LeaversCounter=LeaversCounter+1
    endif
    call Traffic_RegisterData("C"+"K"+I2S(PlayerCS[GetPlayerId(GetTriggerPlayer())])+"D"+I2S(PlayerDenyCounter[GetPlayerId(GetTriggerPlayer())])+"N"+I2S((LoadInteger(hashtable019,(400+GetPlayerId(GetTriggerPlayer())),(79)))),GetPlayerId(GetTriggerPlayer()))
    set ZE7=GetTriggerPlayer()
    call ExeFunc("I19")
    if EL then
      call CL8(GetTriggerPlayer())
    endif
    set IsPlayerLeftGame[GetPlayerId(GetTriggerPlayer())]=true
    call I69(GetTriggerPlayer())
    call I39(GetTriggerPlayer())
    if LeaversCounter==2 and udg_ObserverMode==false and BL then
      call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,60," ")
      call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,60," ")
      call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,60,"|c006699CC"+GetObjectName('n0FW')+"|r")
    endif
    if LeaversCounter==3 then
      set Z97=true
      call ExeFunc("I09")
      set Z97=false
    endif
  else
    set L3[GetPlayerId(GetTriggerPlayer())]="|c00555555End|r"
    call ExeFunc("I59")
  endif
  set Hero=null
endfunction

function RemoveStuffFromHero takes unit Hero returns nothing
  //	if GetUnitTypeId(Hero)!='H00J' and GetUnitTypeId(Hero)!='H00I' then
  if GetOwningPlayer(Hero)==GetLocalPlayer()then
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1," ")
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1,"|c006699CC"+GetObjectName('n0GR'))
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1," ")
  endif
  call BY8(sound025,GetOwningPlayer(Hero))
  //endif
  call SetUnitState(Hero,UNIT_STATE_MANA,999999)
  if FindItemByIndex(Hero,indexid_AghanimOgre)!=null and (SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Hero))*PlayerSkillOffset+6]]=='A088' or SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Hero))*PlayerSkillOffset+4]]=='A088') then
    set tt_unit1=Hero
    call ExeFunc("AghaFireblast_Add")
  endif
  call SetPlayerAbilityAvailable(GetOwningPlayer(Hero),'A344',false)
  call SetUnitInvulnerable(Hero,false)
  call UnitRemoveAbility(Hero,'A32F')
  call UnitRemoveAbility(Hero,'B32F')
  call UnitRemoveAbility(Hero,'A335')//overload
  call UnitRemoveAbility(Hero,'A334')//lifebreak
  call UnitRemoveAbility(Hero,'B08B')//overload buff
  call UnitRemoveAbility(Hero,'B083')//lifebreak buff
  call UnitRemoveAbility(Hero,'A32H')
  call UnitRemoveAbility(Hero,'A32I')
  call UnitRemoveAbility(Hero,'A32J')
  call UnitRemoveAbility(Hero,'A32K')
  call UnitRemoveAbility(Hero,'A32L')
  call UnitRemoveAbility(Hero,'A32M')
  call UnitRemoveAbility(Hero,'A32N')
  call UnitRemoveAbility(Hero,'A32O')
  call UnitRemoveAbility(Hero,'A32P')
  call UnitRemoveAbility(Hero,'A32Q')
  call UnitRemoveAbility(Hero,'A32R')
  call UnitRemoveAbility(Hero,'A32S')
  
  call UnitRemoveAbility(Hero,'A021')
  call UnitRemoveAbility(Hero,'QINV')
  call UnitRemoveAbility(Hero,'A31B')
  call UnitRemoveAbility(Hero,'A30B')
  call UnitRemoveAbility(Hero,'B30A')
  call UnitRemoveAbility(Hero,'A319')
  call UnitRemoveAbility(Hero,'A317')
  call UnitRemoveAbility(Hero,'A310')
  call UnitRemoveAbility(Hero,'A313')
  call UnitRemoveAbility(Hero,'A314')
  call UnitRemoveAbility(Hero,'A315')
  call UnitRemoveAbility(Hero,'A30B')
  call UnitRemoveAbility(Hero,'A309')
  call UnitRemoveAbility(Hero,'A305')
  call UnitRemoveAbility(Hero,'NOAT')
  call UnitRemoveAbility(Hero,'QF86')
  call UnitRemoveAbility(Hero,'A0AZ')
  call UnitRemoveAbility(Hero,'A23F')
  call UnitRemoveAbility(Hero,'A0KT')
  call UnitRemoveAbility(Hero,'A0NW')
  call UnitRemoveAbility(Hero,'A0NU')
  call UnitRemoveAbility(Hero,'A0OW')
  call UnitRemoveAbility(Hero,'A0OV')
  call UnitRemoveAbility(Hero,'A0OX')
  call UnitRemoveAbility(Hero,'A0OY')
  call UnitRemoveAbility(Hero,'A0P0')
  call UnitRemoveAbility(Hero,'A17K')
  call UnitRemoveAbility(Hero,'A0PV')
  call UnitRemoveAbility(Hero,'A0QO')
  call UnitRemoveAbility(Hero,'A0RC')
  call UnitRemoveAbility(Hero,'A0RF')
  call UnitRemoveAbility(Hero,'A228')
  call UnitRemoveAbility(Hero,group004)
  call UnitRemoveAbility(Hero,IN)
  call UnitRemoveAbility(Hero,ON)
  call UnitRemoveAbility(Hero,AN)
  call UnitRemoveAbility(Hero,'A0NU')
  call UnitRemoveAbility(Hero,'A0NW')
  call UnitRemoveAbility(Hero,WS7)
  call UnitRemoveAbility(Hero,'A0I5')
  call UnitRemoveAbility(Hero,'A0C9')
  call UnitRemoveAbility(Hero,'A0IH')
  call UnitRemoveAbility(Hero,'B067')
  call UnitRemoveAbility(Hero,'B08L')
  call UnitRemoveAbility(Hero,'A0SR')
  call UnitRemoveAbility(Hero,'A0WO')
  call UnitRemoveAbility(Hero,'A0WR')
  call UnitRemoveAbility(Hero,'A1CN')
  call UnitRemoveAbility(Hero,'A0VH')
  call UnitRemoveAbility(Hero,'A0VJ')
  call UnitRemoveAbility(Hero,'A109')
  call UnitRemoveAbility(Hero,'A0VW')
  call UnitRemoveAbility(Hero,'A0XM')
  call UnitRemoveAbility(Hero,'A11O')
  call UnitRemoveAbility(Hero,'A11R')
  call UnitRemoveAbility(Hero,'A147')
  call UnitRemoveAbility(Hero,'A148')
  call UnitRemoveAbility(Hero,'A11U')
  call UnitRemoveAbility(Hero,'A149')
  call UnitRemoveAbility(Hero,'A121')
  call UnitRemoveAbility(Hero,'A126')
  call UnitRemoveAbility(Hero,'A179')
  call UnitRemoveAbility(Hero,'Aetl')
  call UnitRemoveAbility(Hero,CN[0])
  call UnitRemoveAbility(Hero,CN[1])
  call UnitRemoveAbility(Hero,CN[2])
  call UnitRemoveAbility(Hero,CN[3])
  call UnitRemoveAbility(Hero,CN[4])
  call UnitRemoveAbility(Hero,CN[5])
  call UnitRemoveAbility(Hero,'A1G5')
  call UnitRemoveAbility(Hero,'A1G3')
  call UnitRemoveAbility(Hero,'A1G6')
  call UnitRemoveAbility(Hero,'A1G4')
  call SaveBoolean(hashtable019,(GetHandleId(Hero)),(80),(false))
  call SetUnitPathing(Hero,true)
  call PauseUnit(Hero,false)
  call SetUnitFlyHeight(Hero,GetUnitDefaultFlyHeight(Hero),0)
  call SetUnitScale(Hero,U18(Hero)*DH8,U18(Hero)*DH8,U18(Hero)*DH8)
  call UnitRemoveAbility(Hero,'A1CA')
  call UnitRemoveAbility(Hero,'A1C9')
  call UnitRemoveAbility(Hero,'A1CB')
  call UnitRemoveAbility(Hero,'A1CC')
  call UnitRemoveAbility(Hero,'A1GA')
  call UnitRemoveAbility(Hero,'A1W3')
  call UnitRemoveAbility(Hero,'B0DO')
  call UnitRemoveAbility(Hero,'A1UH')
  call UnitRemoveAbility(Hero,'A1UI')
  call UnitRemoveAbility(Hero,'A1Z4')
  call UnitRemoveAbility(Hero,'A1ZA')
  call UnitRemoveAbility(Hero,'A1ZB')
  call UnitRemoveAbility(Hero,'A1Z9')
  call UnitRemoveAbility(Hero,'B0DV')
  call UnitRemoveAbility(Hero,'A266')
  call UnitRemoveAbility(Hero,'A265')
  call UnitRemoveAbility(Hero,'A24L')
  call UnitRemoveAbility(Hero,'B0ED')
  call UnitRemoveAbility(Hero,'A23O')
  call UnitRemoveAbility(Hero,'B0E9')
  call GD9(Hero,0)
  if GetUnitTypeId(Hero)=='E02N' or GetUnitTypeId(Hero)=='E02O' then
    call UnitRemoveAbility(Hero,'A237')
    call UnitAddAbility(Hero,'A22B')
    call UnitRemoveAbility(Hero,'A22B')
    if FindItemOfType(Hero,Item_Real[indexid_AghanimGyro])!=null then
      call UnitAddAbility(Hero,'A237')
    endif
  endif
  call UnitRemoveAbility(Hero,'A23F')
  set tt_unit1=Hero
  call ExeFunc("DK_DragonForm_ChangeTail")
  if LoadBoolean(MHT,GetHandleId(Hero),StringHash("morphedburn")) then
    //call Transform_Movement(Hero,'A2NE',GetUnitTypeId(Hero))
    call UnMorphUnit(Hero,LoadInteger(MHT,GetHandleId(Hero),StringHash("second")))
    call UnMorphUnit(Hero,LoadInteger(MHT,GetHandleId(Hero),StringHash("first")))
    call SaveBoolean(MHT,GetHandleId(Hero),StringHash("morphedburn"),false)
  endif
endfunction

function J79 takes nothing returns boolean
  if GetPlayerAlliance(GetOwningPlayer(GetFilterUnit()),SharedControlAlliesTempPlayer,ALLIANCE_SHARED_CONTROL) and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false then
    set SharedControlAlliesCount=SharedControlAlliesCount+1
  endif
  return false
endfunction

function J89 takes unit u,player p,real x,real y,boolean J99 returns nothing
  local group g=GetAvailableGroup()
  set SharedControlAlliesCount=0
  set SharedControlAlliesTempPlayer=p
  call GroupEnumUnitsSelected(g,p,Condition(function J79))
  if SharedControlAlliesCount==0 and GetLocalPlayer()==p then
    if J99==false then
      call ClearSelection()
      call SelectUnit(u,true)
    endif
    call PanCameraToTimed(x,y,0)
  endif
  set SharedControlAlliesCount=0
  call KillGroup(g)
  set g=null
endfunction

function JD9 takes unit CE8 returns boolean
  return GetUnitTypeId(CE8)=='H00I' or GetUnitTypeId(CE8)=='H00J'
endfunction

function JE9 takes unit JF9 returns nothing
  local integer JG9
  if FindItemOfType(JF9,Item_Real[indexid_bloodstone])!=null and GetUnitTypeId(JF9)!='H00J' then
    set JG9=R2I(GetItemCharges(FindItemOfType(JF9,Item_Real[indexid_bloodstone]))*.67)
    if GetItemCharges(FindItemOfType(JF9,Item_Real[indexid_bloodstone]))==1 then
      set JG9=0
    endif
    call SetItemCharges(FindItemOfType(JF9,Item_Real[indexid_bloodstone]),JG9)
    call AddHeroXP(JF9,GetHeroXP(VW7[GetPlayerId(GetOwningPlayer(JF9))]),true)
    call RemoveUnit(VW7[GetPlayerId(GetOwningPlayer(JF9))])
  endif
endfunction

function JH9 takes unit JI9 returns nothing
  local integer Cache=GetHandleId(GetOwningPlayer(JI9))
  local unit JJ9=(LoadUnitHandle(hashtable019,(Cache),(699)))
  local unit JK9=(LoadUnitHandle(hashtable019,(Cache),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(Cache),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(Cache),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(Cache),(703)))
  local unit JP9
  set JP9=JJ9
  if JP9!=null then
    call RemoveUnit(JP9)
  endif
  set JP9=JK9
  if JP9!=null then
    call RemoveUnit(JP9)
  endif
  set JP9=JM9
  if JP9!=null then
    call RemoveUnit(JP9)
  endif
  set JP9=JN9
  if JP9!=null then
    call RemoveUnit(JP9)
  endif
  set JP9=JO9
  if JP9!=null then
    call RemoveUnit(JP9)
  endif
  set JJ9=null
  set JK9=null
  set JM9=null
  set JN9=null
  set JO9=null
  set JP9=null
endfunction

function JQ9 takes nothing returns boolean
  call CleanTrigger(GetTriggeringTrigger())
  set X77=false
  return false
endfunction

function JR9 takes unit JS9 returns nothing
  local integer Cache=GetHandleId(GetOwningPlayer(JS9))
  local unit JJ9=(LoadUnitHandle(hashtable019,(Cache),(699)))
  local unit JK9=(LoadUnitHandle(hashtable019,(Cache),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(Cache),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(Cache),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(Cache),(703)))
  local unit JP9
  local real x=GetUnitX(JJ9)
  local real y=GetUnitY(JJ9)
  local trigger t
  if X77==false then
    if IsSentinel(GetOwningPlayer(JJ9))then
      set x=GetRectCenterX(gg_rct_Hero_Creation_NE)
      set y=GetRectCenterY(gg_rct_Hero_Creation_NE)
    else
      set x=GetRectCenterX(gg_rct_Hero_Creation_UD)
      set y=GetRectCenterY(gg_rct_Hero_Creation_UD)
    endif
  else
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,2,false)
    call TriggerAddCondition(t,Condition(function JQ9))
  endif
  set JP9=JJ9
  if JP9!=null and JS9!=JP9 then
    call ReviveHero(JP9,x,y,false)
    call SetUnitX(JP9,x)
    call SetUnitY(JP9,y)
    call RemoveStuffFromHero(JP9)
    call SetUnitPathing(JP9,true)
    call SetUnitState(JP9,UNIT_STATE_MANA,10000)
  endif
  set JP9=JK9
  if JP9!=null and JS9!=JP9 then
    call ReviveHero(JP9,x,y,false)
    call SetUnitX(JP9,x)
    call SetUnitY(JP9,y)
    call RemoveStuffFromHero(JP9)
    call SetUnitPathing(JP9,true)
    call SetUnitState(JP9,UNIT_STATE_MANA,10000)
  endif
  set JP9=JM9
  if JP9!=null and JS9!=JP9 then
    call ReviveHero(JP9,x,y,false)
    call SetUnitX(JP9,x)
    call SetUnitY(JP9,y)
    call RemoveStuffFromHero(JP9)
    call SetUnitPathing(JP9,true)
    call SetUnitState(JP9,UNIT_STATE_MANA,10000)
  endif
  set JP9=JN9
  if JP9!=null and JS9!=JP9 then
    call ReviveHero(JP9,x,y,false)
    call SetUnitX(JP9,x)
    call SetUnitY(JP9,y)
    call RemoveStuffFromHero(JP9)
    call SetUnitPathing(JP9,true)
    call SetUnitState(JP9,UNIT_STATE_MANA,10000)
  endif
  set JP9=JO9
  if JP9!=null and JS9!=JP9 then
    call ReviveHero(JP9,x,y,false)
    call SetUnitX(JP9,x)
    call SetUnitY(JP9,y)
    call RemoveStuffFromHero(JP9)
    call SetUnitPathing(JP9,true)
    call SetUnitState(JP9,UNIT_STATE_MANA,10000)
  endif
  set JJ9=null
  set JK9=null
  set JM9=null
  set JN9=null
  set JO9=null
  set JP9=null
  set t=null
endfunction

function FixPassiveSkills_TempDisableAbilitiesForHero takes unit Hero returns nothing
  local integer PlayerId=GetPlayerId(GetOwningPlayer(Hero))
  local integer id1=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+1]
  local integer id2=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+2]
  local integer id3=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+3]
  local integer id4=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+4]
  local integer id5=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+5]
  local integer id6=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+6]
  local integer i=0
  if NumberOfExtraAbilities<2 then
    set id6=-1
  endif
  if NumberOfExtraAbilities<1 then
    set id5=-1
  endif
  loop
    exitwhen i>BuggedPassiveMax
    if i!=id1 and i!=id2 and i!=id3 and i!=id4 and i!=id5 and i!=id6 then
      call SetPlayerAbilityAvailable2(Player(PlayerId),PassiveHiddenAbilityId[i],false)
      call UnitRemoveAbility(Hero,PassiveBuffId[i])//[lich] fix passives show up on transform
      //call BJDebugMsg(GetObjectName(PassiveReferenceId[i])+" effect temporarily disabled")
    else
      if GetUnitAbilityLevel(Hero,PassiveReferenceId[i])==0 then
        call SetPlayerAbilityAvailable2(Player(PlayerId),PassiveHiddenAbilityId[i],false)
        //call BJDebugMsg(GetObjectName(PassiveReferenceId[i])+" effect temporarily disabled")
      else
        if (LoadInteger(hashtable019,GetHandleId(Hero),4338)==1 and PassiveHiddenAbilityId[i]=='AOcr')==false then
          call SetPlayerAbilityAvailable2(Player(PlayerId),PassiveHiddenAbilityId[i],true)
        endif
      endif
    endif
    set i=i+1
  endloop
endfunction


function JT9 takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local player p=GetOwningPlayer(u)
  local real x
  local real y
  local integer JG9
  local integer lvl
  set IsImpossibleToBuyback[GetPlayerId(GetOwningPlayer(u))]=false
  set IsHeroDead[GetPlayerId(GetOwningPlayer(u))]=false
  if IsSentinel(GetOwningPlayer(u))then
    set x=GetRectCenterX(gg_rct_Hero_Creation_NE)
    set y=GetRectCenterY(gg_rct_Hero_Creation_NE)
  else
    set x=GetRectCenterX(gg_rct_Hero_Creation_UD)
    set y=GetRectCenterY(gg_rct_Hero_Creation_UD)
  endif
  call TimerStart(HeroRespawnTimer[GetPlayerId(p)],.0,false,null)
  //if JD9(u)then//meepo
  //call JR9(u)
  //else
  call J89(u,p,x,y,false)
  //endif
  call SetUnitX(u,x)
  call SetUnitY(u,y)
  call RemoveStuffFromHero(u)//remove stuff from respawnd hero
  call SetUnitPathing(u,true)
  if FindItemOfType(u,Item_Real[indexid_bloodstone])!=null and GetUnitTypeId(u)!='H00J' then
    set JG9=R2I(GetItemCharges(FindItemOfType(u,Item_Real[indexid_bloodstone]))*.67*1.)
    if GetItemCharges(FindItemOfType(u,Item_Real[indexid_bloodstone]))==1 then
      set JG9=0
    endif
    call SetItemCharges(FindItemOfType(u,Item_Real[indexid_bloodstone]),JG9)
    call AddHeroXP(u,GetHeroXP(VW7[GetPlayerId(GetOwningPlayer(u))]),true)
    call RemoveUnit(VW7[GetPlayerId(GetOwningPlayer(u))])
  endif
  call FixPassiveSkills_TempDisableAbilitiesForHero(u)//[lich] revive debug
  if GetUnitAbilityLevel(u,'Q0BK')>0 then
    set lvl=GetUnitAbilityLevel(u,'Q0BK')
    call UnitRemoveAbility(u,'Q0BK')
    call UnitAddAbility2(u,'Q0BK')
    call SetUnitAbilityLevel(u,'Q0BK',lvl)
  endif
  if GetUnitAbilityLevel(u,'A0CG')>0 then
    set lvl=GetUnitAbilityLevel(u,'A0CG')
    call UnitRemoveAbility(u,'A0CG')
    call UnitAddAbility2(u,'A0CG')
    call SetUnitAbilityLevel(u,'A0CG',lvl)
  endif
  if GetUnitAbilityLevel(u,'A2AI')>0 then
    call UnitRemoveAbility(u,'QF0O')
    call SetUnitAbilityLevel(u,'QB0G',GetUnitAbilityLevel(u,'A2AI'))
  endif
  call LoDStat_Set(u,0,"armourneg")
  call RemoveAbilsForUnit(u)
  //call BJDebugMsg(I2S(LoadInteger(MHT,GetHandleId(u),StringHash("acidspray"))))
  set u=null
endfunction

function JU9 takes integer JV9 returns nothing
  if(JV9==151)then //Invoker LoD spells
    call ExeFunc("LodInvoker_InitAll")
  elseif(JV9==indexid_AM)then
    call ExeFunc("JX9")
    call ExeFunc("JY9")
  elseif(JV9==indexid_Beastmaster)then
    call ExeFunc("JB9")
  elseif JV9==111 then
    call ExeFunc("Kaolin_Death_Reg")
    call ExeFunc("Kaolin_Magnetize_Reg")
    call ExeFunc("Kaolin_BoulderSmash_Reg")
    call ExeFunc("Kaolin_Stones_Reg")
    call ExeFunc("Kaolin_GeomagneticGrip_Reg")
    //call ExeFunc("Kaolin_RegisterUnitWithStones")
  elseif JV9==112 then
    call ExeFunc("Oracle_FortunesEnd_Reg")
    call ExeFunc("Oracle_FatesEdict_Reg")
    call ExeFunc("Oracle_PurifingFlames_Reg")
    call ExeFunc("Oracle_FalsePromise_Reg")
  elseif(JV9==indexid_THD)then
    call ExeFunc("J39")
    call ExeFunc("J19")
  elseif(JV9==indexid_Bounty)then
    call ExeFunc("J09")
    call ExeFunc("J59")
  elseif(JV9==indexid_BB)then
    call ExeFunc("BB_Bristleback_Reg")
    call ExeFunc("K99")
  elseif(JV9==indexid_Centaur)then
    call ExeFunc("Centaur_Return_Learning")
    call ExeFunc("Stampede_Init")
  elseif(JV9==indexid_Chen)then
    call ExeFunc("KH9")
  elseif(JV9==indexid_CM)then
    call ExeFunc("KK9")
  elseif(JV9==indexid_ES)then
    call ExeFunc("ES_EchoSlam_Reg")
    call ExeFunc("KN9")
    call ExeFunc("AfterShock_Orbs") //This actually deals with Enchanted Totem, not aftershock... \:3/
  elseif(JV9==indexid_Enchantress)then
    call ExeFunc("KT9")
    call ExeFunc("KU9")
  elseif(JV9==95)then
    call ExeFunc("KV9")
  elseif(JV9==indexid_Furion)then
    call ExeFunc("KA9")
  elseif(JV9==indexid_Juggernaut)then
    call ExeFunc("K39")
  elseif(JV9==indexid_Kotl)then
  elseif(JV9==indexid_Luna)then
    call ExeFunc("Luna_Glaive_Learn")
  elseif(JV9==indexid_Morphling)then
    call ExeFunc("MD9")
    call ExeFunc("MF9")
    call ExeFunc("MG9")
    call ExeFunc("MH9")
  elseif(JV9==indexid_NagaSiren)then
  elseif(JV9==indexid_OgreMagi)then
    call ExeFunc("MM9")//Multicast enemies
    call ExeFunc("MN9")//Multicast allies
  elseif(JV9==indexid_Omni)then
  elseif(JV9==indexid_PL)then
    call ExeFunc("MP9")
    call ExeFunc("MQ9")
    call ExeFunc("MR9")
  elseif(JV9==indexid_Treant)then
  elseif(JV9==indexid_Silencer)then
    call ExeFunc("MZ9")
  elseif(JV9==indexid_Sniper)then
    call ExeFunc("MB9")
    call ExeFunc("MC9")
    call ExeFunc("M39")
  elseif(JV9==indexid_Riki)then
    call ExeFunc("Riki_PermanentInvisibility_Reg")
    call ExeFunc("Riki_PermanentInvis_Init")
  elseif(JV9==indexid_LoneDruid)then
    call ExeFunc("M59")
    call ExeFunc("N49")
    call ExeFunc("N79")
    call ExeFunc("N99")
    call ExeFunc("ND9")
  elseif(JV9==indexid_Techies)then
    call ExeFunc("NE9")
    call ExeFunc("NF9")
    call ExeFunc("NG9")
    call ExeFunc("NH9")
  elseif(JV9==indexid_Tinker)then
    call ExeFunc("NJ9")
  elseif(JV9==indexid_Tiny)then
    call ExeFunc("NM9")
    call ExeFunc("NP9")
  elseif(JV9==indexid_Ursa)then
    call ExeFunc("NQ9")
  elseif(JV9==1)then
  elseif(JV9==indexid_Zeus)then
  elseif(JV9==27)then
    call ExeFunc("NZ9")
    call ExeFunc("NA9")
    call ExeFunc("NB9")
    call ExeFunc("NC9")
  elseif(JV9==82)then
    call ExeFunc("N69")
    call ExeFunc("NL9")
  elseif(JV9==75)then
    call ExeFunc("N59")
  elseif(JV9==83)then
    call ExeFunc("O79")
    call ExeFunc("BS_Bloodrage_Reg")
    call ExeFunc("OD9")
  elseif(JV9==indexid_Brood)then
    call ExeFunc("OE9")
    call ExeFunc("Brood_RegisterSpinWebAppears")
  elseif(JV9==108)then
  elseif(JV9==69)then
    call ExeFunc("Void_Backtrack_Reg")
  elseif(JV9==100)then
  elseif(JV9==102)then
    call ExeFunc("Lich_FrostArmor_Reg")
  elseif(JV9==64)then
  elseif(JV9==106)then
    call ExeFunc("OZ9")
  elseif(JV9==61)then
  elseif(JV9==76)then
    call ExeFunc("O39")
    call ExeFunc("Necrolyte_Heartstopper_InitTrig")
  elseif(JV9==80)then
    call ExeFunc("O09")
    call ExeFunc("O29")
    call ExeFunc("NL")
  elseif(JV9==62)then
    call ExeFunc("P79")
    call ExeFunc("P99")
  elseif(JV9==indexid_PA)then
    call ExeFunc("PD9")
  elseif(JV9==77)then
    call ExeFunc("PG9")
    call ExeFunc("PH9")
    call ExeFunc("PI9")
  elseif(JV9==73)then
    call ExeFunc("NW")
    call ExeFunc("Oblivion_Decripify_Reg")
  elseif(JV9==81)then
    call ExeFunc("PM9")
  elseif(JV9==66)then
  elseif(JV9==78)then
    call ExeFunc("Spiritbreaker_Greaterbash_Init")
    call ExeFunc("Spiritbreaker_EmpoweringHaste")
  elseif(JV9==99)then
  elseif(JV9==74)then
    call ExeFunc("PZ9")
  elseif(JV9==105)then
    call ExeFunc("Venomancer_PlagueWard_Init")
  elseif(JV9==70)then
    call ExeFunc("PL9")
    call ExeFunc("Viper_CorrosiveSkin_Reg")
  elseif(JV9==107)then
    call ExeFunc("P59")
    call ExeFunc("Q49")
    call ExeFunc("Q79")
  elseif(JV9==79)then
    call ExeFunc("QE9")
  elseif(JV9==68)then
    call ExeFunc("QF9")
  elseif(JV9==84)then
  elseif(JV9==85)then
    call ExeFunc("QM9")
    call ExeFunc("QN9")
    call ExeFunc("Spectre_Dispersion_Reg")
    call ExeFunc("QP9")
  elseif(JV9==86)then
    call ExeFunc("QU9")
  elseif(JV9==87)then
    call ExeFunc("QV9")
    call ExeFunc("QW9")
  elseif(JV9==indexid_DK)then
    call ExeFunc("QA9")
    call ExeFunc("DK_Attack_Reg")
  elseif(JV9==indexid_Alchemist)then
  elseif(JV9==88)then
    call ExeFunc("QL9")
    call ExeFunc("Q19")
    call ExeFunc("Q09")
    call ExeFunc("Q59")
  elseif(JV9==indexid_Potm)then
    call ExeFunc("PotM_EluneArrow_Reg")
    call ExeFunc("R89")
  elseif JV9==89 then
    call ExeFunc("R99")
  elseif JV9==90 then
    call ExeFunc("RF9")
  elseif JV9==71 then
    call ExeFunc("RJ9")
    call ExeFunc("RM9")
  elseif JV9==93 then
  elseif JV9==indexid_Huskar then
    call ExeFunc("Huskar_BurningSpears_Reg")
    call ExeFunc("SacredWarrior_BerserkerBlood_Reg")
    call ExeFunc("RU9")
  elseif JV9==91 then
    call ExeFunc("RV9")
  elseif JV9==92 then
    call ExeFunc("R69")
  elseif JV9==indexid_Storm then
    call ExeFunc("R09")
    call ExeFunc("R29")
  elseif JV9==indexid_Lanaya then
    call ExeFunc("S79")
  elseif JV9==indexid_Puck then
    call ExeFunc("SF9")
  elseif JV9==72 then
    call ExeFunc("Lifestealer_Feast_InitTrig")
    call ExeFunc("SJ9")
    call ExeFunc("SK9")
  elseif JV9==112 or JV9==113 or JV9==114 then
    call ExeFunc("SM9")
  elseif JV9==indexid_Sven then
  elseif JV9==104 then
    call ExeFunc("SR9")
  elseif JV9==65 then
    call ExeFunc("SU9")
  elseif JV9==indexid_Lycan then
    call ExeFunc("SW9")
  elseif JV9==63 then
    call ExeFunc("SZ9")
    call ExeFunc("SkeletonKing_MortalStrike_Reg")
  elseif JV9==indexid_Clock then
  elseif JV9==indexid_Admiral then
    call ExeFunc("Admiral_XMark_Init")
    call ExeFunc("S09")
  elseif JV9==indexid_WR then
    call ExeFunc("T49")
    call ExeFunc("T79")
  elseif JV9==indexid_Lina then
    call ExeFunc("T89")
  elseif JV9==96 then
    call ExeFunc("TD9")
  elseif JV9==indexid_Chieftain then
    call ExeFunc("TJ9")
  elseif JV9==97 then
    call ExeFunc("TP9")
  elseif JV9==98 then
    call ExeFunc("TR9")
    call ExeFunc("TT9")
  elseif JV9==67 then
  elseif JV9==indexid_Rhasta then
  elseif JV9==indexid_Phoenix then
    call ExeFunc("T39")
  elseif JV9==100 then
  elseif JV9==101 then
    call ExeFunc("TL9")
  elseif JV9==indexid_Gyro then
    call ExeFunc("U79")
  elseif JV9==indexid_Disruptor then
    call ExeFunc("UD9")
  elseif JV9==indexid_Wisp then
    call ExeFunc("Wisp_Overcharge_Reg")
    call ExeFunc("UI9")
  elseif JV9==indexid_Tusk then
    call ExeFunc("UN9")
    call ExeFunc("Tuskar_FrozenSigil_Init")
  elseif JV9==indexid_Pandaren then
    call ExeFunc("UO9")
  elseif JV9==indexid_Rubick then
    call ExeFunc("UP9")
    call ExeFunc("UR9")
    call ExeFunc("US9")
  elseif JV9==103 then
  elseif JV9==indexid_Xin then
    call ExeFunc("UW9")
    call ExeFunc("UX9")
    call ExeFunc("UY9")
  elseif JV9==indexid_Legion then
    call ExeFunc("UZ9")
    call ExeFunc("UA9")
    call ExeFunc("UB9")
    call ExeFunc("UC9")
  elseif JV9==indexid_Skywrath then
    call ExeFunc("U69")
  elseif JV9==indexid_Timber then
    call ExeFunc("U29")
    call ExeFunc("V49")
  elseif JV9==121 then
    call ExeFunc("Formless_Init")
    call ExeFunc("Formless_Reset_Init")
  endif
endfunction




function V79 takes player whichPlayer,string Y38 returns nothing
  if IsPlayerInForce(GetLocalPlayer(),S58(whichPlayer))then
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,group008,40,udg_Colors[GetPlayerId(whichPlayer)]+(IL7[GetPlayerId((whichPlayer))])+"|r "+Y38)
  endif
endfunction

function Main_AllHasHero takes nothing returns boolean
  return udg_Hero[GetPlayerId(Sentinels[1])]!=null and udg_Hero[GetPlayerId(Sentinels[2])]!=null and udg_Hero[GetPlayerId(Sentinels[3])]!=null and udg_Hero[GetPlayerId(Sentinels[4])]!=null and udg_Hero[GetPlayerId(Sentinels[5])]!=null and udg_Hero[GetPlayerId(Scourges[1])]!=null and udg_Hero[GetPlayerId(Scourges[2])]!=null and udg_Hero[GetPlayerId(Scourges[3])]!=null and udg_Hero[GetPlayerId(Scourges[4])]!=null and udg_Hero[GetPlayerId(Scourges[5])]!=null
endfunction

function V89 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  set boolean193=true
  call CleanTrigger(t)
  call DestroyFogModifier(CreateFogModifierRadius(Sentinels[0],FOG_OF_WAR_MASKED,AO7,AP7,700,false,false))
  call DestroyFogModifier(CreateFogModifierRadius(Scourges[0],FOG_OF_WAR_MASKED,AO7,AP7,700,false,false))
  set t=null
  return false
endfunction

function V99 takes unit u returns boolean
  return GetUnitTypeId(u)!='H00M' and GetUnitTypeId(u)!='H07G' and GetUnitTypeId(u)!='H00Y' and GetUnitTypeId(u)!='H00J' and GetUnitTypeId(u)!='H0B8'
endfunction

function VD9 takes nothing returns boolean
  return(IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) and LoadBoolean(hashtable019,GetHandleId(GetTriggerUnit()),StringHash("tempest"))==false and IsUnitIllusion(GetTriggerUnit())==false and HaveSavedBoolean(hashtable019,GetHandleId(GetTriggerUnit()),85)==false and V99(GetTriggerUnit()) and b_isPickTime==false)!=null
endfunction

function VE9 takes nothing returns boolean
  return GetUnitTypeId(GetFilterUnit())=='n00C'
endfunction

function VF9 takes nothing returns nothing
  call RemoveUnit(GetEnumUnit())
endfunction

function VG9 takes player p returns nothing
  local group HQ9=GetAvailableGroup()
  local boolexpr VH9=Condition(function VE9)
  call GroupEnumUnitsOfPlayer(HQ9,p,VH9)
  call ForGroup(HQ9,function VF9)
  call KillGroup(HQ9)
  set HQ9=null
  set VH9=null
endfunction

function VI9 takes nothing returns nothing
  call VG9(Sentinels[1])
  call VG9(Sentinels[2])
  call VG9(Sentinels[3])
  call VG9(Sentinels[4])
  call VG9(Sentinels[5])
  call VG9(Scourges[1])
  call VG9(Scourges[2])
  call VG9(Scourges[3])
  call VG9(Scourges[4])
  call VG9(Scourges[5])
endfunction

function VJ9 takes nothing returns boolean
  return GetUnitTypeId(GetFilterUnit())=='ncop'
endfunction

function VK9 takes nothing returns nothing
  if Mode_SD then
    call UnitRemoveAbility(CirclesOfPower[GetPlayerId(GetOwningPlayer(GetEnumUnit()))],'A14F')
    call UnitRemoveAbility(CirclesOfPower[GetPlayerId(GetOwningPlayer(GetEnumUnit()))],'A14E')
    call UnitRemoveAbility(CirclesOfPower[GetPlayerId(GetOwningPlayer(GetEnumUnit()))],'A14H')
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A0I4')==0 then
    call UnitAddAbility(GetEnumUnit(),'A0I4')
  endif
endfunction

function VM9 takes player p returns nothing
  local group g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,p,Condition(function VJ9))
  call ForGroup(g,function VK9)
  call KillGroup(g)
  set g=null
endfunction

function VN9 takes unit Hero,player p returns string
  local string s=GetObjectName('n0DB')
  set s=FA9(s,"$hero",GetUnitName(Hero))
  set s=FA9(s,"$p",(IL7[GetPlayerId((p))]))
  return s
endfunction

function VO9 takes nothing returns nothing
  local integer i=0
  local integer d=0
  local multiboarditem mi
  local integer add=0
  local string s=""
  local real width=.12
  set AbilityDraftMultiboard=CreateMultiboard()
  if Mode_Debug then
    set SentinelsIngame=5
    set ScourgesIngame=5
  endif
  
  call MultiboardSetRowCount(AbilityDraftMultiboard,2+SentinelsIngame+ScourgesIngame)
  call MultiboardSetColumnCount(AbilityDraftMultiboard,5+NumberOfExtraAbilities)
  call MultiboardSetItemsWidth(AbilityDraftMultiboard,.015)
  call MultiboardSetTitleText(AbilityDraftMultiboard,"-"+StringCase(ModeForTitle,true))
  call MultiboardSetItemsStyle(AbilityDraftMultiboard,false,true)
  loop
    set mi=MultiboardGetItem(AbilityDraftMultiboard,0,i)
    call MultiboardSetItemStyle(mi,true,false)
    if i==0 then
      call MultiboardSetItemWidth(mi,width)
      call MultiboardSetItemValue(mi,"|c00FF0303The Sentinel|r")
    endif
    call MultiboardReleaseItem(mi)
    set i=i+1
    exitwhen i==MultiboardGetColumnCount(AbilityDraftMultiboard)
  endloop
  set i=0
  loop
    set mi=MultiboardGetItem(AbilityDraftMultiboard,1+SentinelsIngame,i)
    call MultiboardSetItemStyle(mi,true,false)
    if i==0 then
      call MultiboardSetItemWidth(mi,width)
      call MultiboardSetItemValue(mi,"|c0020C000The Scourge|r")
    endif
    call MultiboardReleaseItem(mi)
    set i=i+1
    exitwhen i==MultiboardGetColumnCount(AbilityDraftMultiboard)
  endloop
  if SentinelsIngame!=0 then
    set i=0
    set d=1
    loop
      set mi=MultiboardGetItem(AbilityDraftMultiboard,d,i)
      if i==(4+NumberOfExtraAbilities) then
        call MultiboardSetItemStyle(mi,true,false)
        call MultiboardSetItemWidth(mi,width)
        call MultiboardSetItemValue(mi,TabTab+udg_Colors[GetPlayerId((S1[d]))]+IL7[GetPlayerId((S1[d]))]+"|r")
      else
        call MultiboardSetItemStyle(mi,false,true)
        call MultiboardSetItemIcon(mi,SkillIcon[0])
      endif
      set i=i+1
      if i>(5+NumberOfExtraAbilities) then
        set d=d+1
        set i=0
      endif
      call MultiboardReleaseItem(mi)
      exitwhen d==SentinelsIngame+1
    endloop
  endif
  //call echo(I2S(MultiboardGetColumnCount(AbilityDraftMultiboard)))
  if ScourgesIngame!=0 then
    set i=0
    set d=2+SentinelsIngame
    loop
      set mi=MultiboardGetItem(AbilityDraftMultiboard,d,i)
      if i==4+NumberOfExtraAbilities then
        call MultiboardSetItemStyle(mi,true,false)
        call MultiboardSetItemWidth(mi,width)
        call MultiboardSetItemValue(mi,TabTab+udg_Colors[GetPlayerId((T1[d-1-SentinelsIngame]))]+IL7[GetPlayerId((T1[d-1-SentinelsIngame]))]+"|r")
      else
        call MultiboardSetItemStyle(mi,false,true)
        call MultiboardSetItemIcon(mi,SkillIcon[0])
      endif
      set i=i+1
      if i>(5+NumberOfExtraAbilities) then
        set d=d+1
        set i=0
      endif
      call MultiboardReleaseItem(mi)
      exitwhen d==SentinelsIngame+ScourgesIngame+2
    endloop
  endif
  call MultiboardMinimize(AbilityDraftMultiboard,false)
  call MultiboardDisplay(AbilityDraftMultiboard,true)
  set mi=null
endfunction












function VP9 takes unit u,player p returns nothing
  local integer PlayerId=GetPlayerId(p)
  local integer xx=0
  //local integer skill
  local integer learn
  local integer picked
  set xx=1
  loop
    if PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]!=0 then
      
      
      set picked = PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]
      //set skill = SkillID[picked]							   //learning dummy, for passive cooldowns
      set learn = EngineeringUpgradeSkillID[picked]
      
      //if Mode_BO==false then
      //	if learn=='Y067' and IsUnitType(u,UNIT_TYPE_RANGED_ATTACKER)==true then //ranged fury swipes
      //		set learn = 'Y611'
      //	endif
      
      //if learn=='Y076' then
      //	call EnableTrigger(COOLDOWN_ITEM_TRIGGER)
      
      //	call SaveBoolean(MHT,GetHandleId(u),2,true)
      //	call TriggerRegisterUnitEvent(COOLDOWN_ITEM_TRIGGER,u,EVENT_UNIT_USE_ITEM)
      //	call TriggerRegisterUnitEvent(COOLDOWN_ITEM_TRIGGER,u,EVENT_UNIT_SPELL_EFFECT)
      //endif
      //endif
      
      
      
      
      call UnitAddAbility2(u,learn)
      call SetPlayerAbilityAvailable(p,learn,false)
      call UnitMakeAbilityPermanent(u,true,learn)
      
      
      //call UnitAddAbility(u,EngineeringUpgradeSkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]])
      //call SetPlayerAbilityAvailable(p,EngineeringUpgradeSkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],false)
      //call UnitMakeAbilityPermanent(u,true,EngineeringUpgradeSkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]])
      
      
    endif
    set xx=xx+1
    exitwhen xx>4
  endloop
endfunction

function VQ9 takes unit u,integer PlayerId returns nothing
  local integer VR9=(GetUnitPointValue(u)*4)-4
  local integer xx=0
  local integer RG8
  local integer id1=VR9+1
  local integer id2=VR9+2
  local integer id3=VR9+3
  local integer id4=VR9+4
  local integer myloop='Z000'
  local integer fixjump=0
  
  call RemoveUnit(SpellPickingDummy[PlayerId])
  call SetPlayerState(Player(PlayerId),PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(Player(PlayerId),PLAYER_STATE_RESOURCE_GOLD)+250)
  set SpellPickingDummy[PlayerId]=CreateUnit(Player(PlayerId),'hfoo',GetRectMaxX(bj_mapInitialPlayableArea),GetRectMinY(bj_mapInitialPlayableArea),.0)
  set SelectedSkillHeroPointValue[PlayerId]=GetUnitPointValue(u)
  call RemoveUnit(u)
  //	if GetUnitPointValue(u)==94 or GetUnitPointValue(u)==194 or GetUnitPointValue(u)==195  then //Invoker
  //		if GetUnitPointValue(u)==94 then
  //			set id1=150*4+1
  //			set id2=150*4+2
  //			set id3=150*4+3
  //			set id4=0
  //		elseif GetUnitPointValue(u)==194 then
  //			set id1=151*4+1
  //			set id2=151*4+2
  //			set id3=151*4+3
  //			set id4=0
  //		else
  //			set id1=152*4+1
  //			set id2=152*4+2
  //			set id3=152*4+3
  //			set id4=152*4+4
  //		endif
  //	endif
  if Mode_Debug then
    call DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,20.,"Hero Number: "+I2S(GetUnitPointValue(u)))
    call DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,20.,"Skill #1 number: "+I2S(id1))
    call DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,20.,"Skill #2 number: "+I2S(id2))
    call DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,20.,"Skill #3 number: "+I2S(id3))
    call DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,20.,"Skill #4 number: "+I2S(id4))
  endif
  if IsSentinel(Player(PlayerId)) then
    set RG8=1
  else
    set RG8=2
  endif
  
  
  if(isPlayerPickedAbility(Player(PlayerId),id1)==false)then
    if OneSkillCheckArray[RG8*OneSkillOffsetCheck+id1]==0 then
      call UnitAddAbility(SpellPickingDummy[PlayerId],'Z000')
    else
      call UnitAddAbility(SpellPickingDummy[PlayerId],'Z010')
    endif
  else
    call UnitAddAbility(SpellPickingDummy[PlayerId],'Z004')
  endif
  if(isPlayerPickedAbility(Player(PlayerId),id2)==false)then
    if OneSkillCheckArray[RG8*OneSkillOffsetCheck+id2]==0 then
      call UnitAddAbility(SpellPickingDummy[PlayerId],'Z001')
    else
      call UnitAddAbility(SpellPickingDummy[PlayerId],'Z011')
    endif
  else
    call UnitAddAbility(SpellPickingDummy[PlayerId],'Z005')
  endif
  if(isPlayerPickedAbility(Player(PlayerId),id3)==false)then
    if OneSkillCheckArray[RG8*OneSkillOffsetCheck+id3]==0 then
      call UnitAddAbility(SpellPickingDummy[PlayerId],'Z002')
    else
      call UnitAddAbility(SpellPickingDummy[PlayerId],'Z012')
    endif
  else
    call UnitAddAbility(SpellPickingDummy[PlayerId],'Z006')
  endif
  if(isPlayerPickedAbility(Player(PlayerId),id4)==false)then
    if OneSkillCheckArray[RG8*OneSkillOffsetCheck+id4]==0 then
      call UnitAddAbility(SpellPickingDummy[PlayerId],'Z003')
    else
      call UnitAddAbility(SpellPickingDummy[PlayerId],'Z013')
    endif
  else
    call UnitAddAbility(SpellPickingDummy[PlayerId],'Z007')
  endif
  set xx=1
  loop
    //		if GetUnitPointValue(u)==94 then //Invoker
    //			call UnitAddAbility(SpellPickingDummy[PlayerId],SkillID[InvokerSkill[PlayerId*4+xx]])
    //			call SetUnitAbilityLevel(SpellPickingDummy[PlayerId],SkillID[InvokerSkill[PlayerId*4+xx]],4)
    //		else
    if not RA8(StackingLimitations[VR9+xx],"not work","0") then
      set fixjump=SkillID[VR9+xx]
      if fixjump=='A0FU' then
        set fixjump='QF00'
      endif
      if fixjump=='A0KX' then
        set fixjump='QF87'
      endif
      if fixjump=='A0OO' then
        set fixjump='A302'
      endif
      if fixjump=='A30U' then
        set fixjump='A30V'
      endif
      call UnitAddAbility(SpellPickingDummy[PlayerId],fixjump)
      if xx==4 or xx==6 then
        call SetUnitAbilityLevel(SpellPickingDummy[PlayerId],fixjump,3)
      else
        call SetUnitAbilityLevel(SpellPickingDummy[PlayerId],fixjump,4)
      endif
      if FindString(StackingLimitations[VR9+xx],"melee only") or (Mode_BO==false and FindString(StackingLimitations_Balanced[VR9+xx],"melee only")) then
        call UnitAddAbility(SpellPickingDummy[PlayerId],'Z020'+xx-1)
      elseif FindString(StackingLimitations[VR9+xx],"range only") or (Mode_BO==false and FindString(StackingLimitations_Balanced[VR9+xx],"range only")) then
        call UnitAddAbility(SpellPickingDummy[PlayerId],'Z024'+xx-1)
      elseif FindString(StackingLimitations[VR9+xx],"melee morph") or (Mode_BO==false and FindString(StackingLimitations_Balanced[VR9+xx],"melee morph")) then
        call UnitAddAbility(SpellPickingDummy[PlayerId],'Z030'+xx-1)
      elseif FindString(StackingLimitations[VR9+xx],"range morph") or (Mode_BO==false and FindString(StackingLimitations_Balanced[VR9+xx],"range morph")) then
        call UnitAddAbility(SpellPickingDummy[PlayerId],'Z034'+xx-1)
      endif
    else
      call UnitRemoveAbility(SpellPickingDummy[PlayerId],'Z000'-1+xx)
      call UnitAddAbility(SpellPickingDummy[PlayerId],'Z014'-1+xx)
      
    endif
    //		endif
    set xx=xx+1
    exitwhen xx>4
  endloop
  call ClearSelectionForPlayer(Player(PlayerId))
  call SelectUnitAddForPlayer(SpellPickingDummy[PlayerId],Player(PlayerId))
endfunction

function VS9 takes nothing returns nothing
  call MultiboardDisplay(CSBoard,false)
  call VO9()
  call SuspendTimeOfDay(true)
  call DisableTrigger(HeroEnters)
endfunction

function HidePassivesFunctionSup takes unit u returns nothing
  local integer i=1
  local integer k
  local integer lvl
  //local unit u=GetEnumUnit()
  local player p=GetOwningPlayer(u)
  local boolean b=false
  //call DisplayTimedTextToPlayer(p,0,0,10,"Passives become hidden")
  loop
    //call BJDebugMsg( B2S(UnitAddAbility2(u,PassivesUpgradeID[i]))+" "+Id2String(PassivesUpgradeID[i]))
    if PassivesUpgradeID[i]>0 then
      call UnitAddAbility2(u,PassivesUpgradeID[i])
      if GetUnitAbilityLevel(u,PassivesLearningSkillUpg[i])>0 then
        //call BJDebugMsg(Id2String(PassivesUpgradeID[i]))
        set lvl=GetUnitAbilityLevel(u,PassivesLearningSkillUpg[i])
        call UnitRemoveAbility(u,PassivesLearningSkillUpg[i])
        call UnitAddAbility2(u,PassivesLearningSkillUpg[i])
        call SetUnitAbilityLevel(u,PassivesLearningSkillUpg[i],lvl)
      endif
    endif
    set i=i+1
    exitwhen i>PassivesCount
  endloop
  call SetPlayerAbilityAvailable(p,'A13T',b)//tidebringer
  call SetPlayerAbilityAvailable(p,'A0MB',b)//riki's ulty
  call SetPlayerAbilityAvailable(p,'P247',b)// hunter in the night
  call SetPlayerAbilityAvailable(p,'A1IQ',b)//jinada
  //call UnitRemoveAbility(udg_Hero[GetPlayerId(p)],'A1IQ')
  //call SetPlayerAbilityAvailable(p,'A0O8',b)//liquid fire
  if NumberOfExtraAbilities>0 then
    set k=GetPassiveLearnNumber(SkillID[PlayerSkillNumber[GetPlayerId(p)*PlayerSkillOffset+5]])
    if k>0 then
      call SetPlayerAbilityAvailable(p,PassivesLearningSkill[k],b)
    endif
  endif
  if NumberOfExtraAbilities>1 then
    set k=GetPassiveLearnNumber(SkillID[PlayerSkillNumber[GetPlayerId(p)*PlayerSkillOffset+6]])
    if k>0 then
      call SetPlayerAbilityAvailable(p,PassivesLearningSkill[k],b)
    endif
  endif
  set u=null
  
endfunction

function VT9 takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local player p=GetOwningPlayer(XX8)
  local real x
  local real y
  local region r=CreateRegion()
  local player VU9=p
  local item Item
  local unit Hero=XX8
  local trigger t
  local integer xx
  local integer PlayerId=GetPlayerId(p)
  local integer id
  local string dbg=""
  if Mode_Debug then
    call SetHeroLevel(XX8,25,false)
    call SetPlayerState(GetOwningPlayer(XX8),PLAYER_STATE_RESOURCE_GOLD,100000)
  endif
  if s_MainMode=="ap" then
    call VP9(XX8,p)
  elseif s_MainMode=="sd" then
    call VP9(XX8,p)
  elseif s_MainMode=="md" then
    call VP9(XX8,p)
  elseif s_MainMode=="ar" then
    call SaveUnitHandle(hashtable019,'hRUT',1,XX8)
    call ExeFunc("VV9")
    call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"|cff99ccff Your spells:|r")
    set xx=1
    set dbg=GetPlayerName(Player(PlayerId))+": "
    loop
      set id=PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]
      if id>600 then
        call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"	"+GetObjectName(SkillID[id])+"|cffffcc00 (Invoker)|r")
      else
        if xx==4 or xx==6 then
          call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"	"+"|c00ff0303"+GetObjectName(SkillID[id])+"|r"+"|cffffcc00"+" ("+GetObjectName(HeroID[(id+3)/4])+")"+"|r")
          set dbg=dbg+GetObjectName(SkillID[id])+", "
        else
          call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"	"+GetObjectName(SkillID[id])+"|cffffcc00"+" ("+GetObjectName(HeroID[(id+3)/4])+")"+"|r")
          set dbg=dbg+GetObjectName(SkillID[id])+", "
        endif
      endif
      set xx=xx+1
      exitwhen xx>4+NumberOfExtraAbilities
    endloop
    if IsNotReplay==false then
      //call BJDebugMsg(dbg)
    endif
  endif
  if HidePassivesForPlayer[GetPlayerId(p)] then
    call HidePassivesFunctionSup(XX8)
  endif
  set PlayerHaveHero[GetPlayerId(p)]=true
  if GetUnitAbilityLevel(XX8,'Y253')>0 then
    call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"|c00ff0000Passives acquired through Devour are automatically hidden.|r")
  endif
  if Mode_DM==false then
    call GR9(GetOwningPlayer(XX8))
  endif
  if AN7[GetPlayerId(p)] then
    //call GF9(p,GetUnitPointValue(XX8))
  endif
  if boolean193==false and(udg_Hero[GetPlayerId(Sentinels[1])]!=null and udg_Hero[GetPlayerId(Sentinels[2])]!=null and udg_Hero[GetPlayerId(Sentinels[3])]!=null and udg_Hero[GetPlayerId(Sentinels[4])]!=null and udg_Hero[GetPlayerId(Sentinels[5])]!=null and udg_Hero[GetPlayerId(Scourges[1])]!=null and udg_Hero[GetPlayerId(Scourges[2])]!=null and udg_Hero[GetPlayerId(Scourges[3])]!=null and udg_Hero[GetPlayerId(Scourges[4])]!=null and udg_Hero[GetPlayerId(Scourges[5])]!=null)then
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,7,false)
    call TriggerAddCondition(t,Condition(function V89))
    set t=null
  endif
  set IsHeroDead[GetPlayerId(GetOwningPlayer((XX8)))]=false
  call RegionAddRect(r,real008)
  if Mode_RV and rect001==false then
    set F3[GetPlayerId(p)]=true
    set p=(LoadPlayerHandle(hashtable019,(2000),(550+GetPlayerId(p))))
    call SetUnitOwner(XX8,p,true)
  endif
  if IsSentinel(GetOwningPlayer(XX8))then
    if IsUnitInRegion(r,XX8)then
      set x=GetRandomReal(GetRectMinX(gg_rct_Hero_Creation_NE),GetRectMaxX(gg_rct_Hero_Creation_NE))
      set y=GetRandomReal(GetRectMinY(gg_rct_Hero_Creation_NE),GetRectMaxY(gg_rct_Hero_Creation_NE))
    else
      set x=GetUnitX(XX8)
      set y=GetUnitY(XX8)
    endif
  else
    if IsUnitInRegion(r,XX8)then
      set x=GetRandomReal(GetRectMinX(gg_rct_Hero_Creation_UD),GetRectMaxX(gg_rct_Hero_Creation_UD))
      set y=GetRandomReal(GetRectMinY(gg_rct_Hero_Creation_UD),GetRectMaxY(gg_rct_Hero_Creation_UD))
    else
      set x=GetUnitX(XX8)
      set y=GetUnitY(XX8)
    endif
  endif
  set HasAlreadyPickedHero[GetPlayerId(p)]=true
  if(not Mode_RV or rect001)then
    if BB7==false and Mode_CD==false then
      call PanCameraToTimedForPlayer(p,x,y,0)
    endif
    call ClearSelectionForPlayer(p)
    call SelectUnitAddForPlayer(XX8,p)
  endif
  call SetUnitX(XX8,x)
  call SetUnitY(XX8,y)
  set udg_Hero[GetPlayerId(p)]=XX8
  set HeroTypeId[GetPlayerId(p)]=GetUnitTypeId(XX8)
  call SaveInteger(hashtable019,GetPlayerId(GetOwningPlayer(XX8)),'hHid',GetUnitPointValue(XX8))
  call FV9(p,"9",GetUnitTypeId(XX8))
  if Mode_RV and rect001==false then
    call VS8(VU9)
  else
    call VS8(p)
  endif
  call SaveBoolean(hashtable019,(GetHandleId(XX8)),(85),(true))
  if Mode_DU==false and b_isPickTime==false then
    set b_isHeroPicked[GetUnitPointValue(XX8)]=true
    set IsHeroIngame[GetUnitPointValue(XX8)]=true
    call TechHeroForAll(GetUnitTypeId(XX8))
  endif
  if Mode_DM then
    if IsSentinel(p)then
      set Deathmatch_LivesUsed[0]=Deathmatch_LivesUsed[0]+1
    else
      set Deathmatch_LivesUsed[1]=Deathmatch_LivesUsed[1]+1
    endif
    set OO[GetPlayerId(p)]=OO[GetPlayerId(p)]+1
    if OO[GetPlayerId(GetOwningPlayer(XX8))]>1 and XX8!=real011[GetPlayerId(GetOwningPlayer(XX8))]then
      call JE9(real011[GetPlayerId(GetOwningPlayer(XX8))])
      //call DisableTrigger(t_manipulateitem)
      call SetHeroXP(XX8,GetHeroXP(real011[GetPlayerId(GetOwningPlayer(XX8))]),false)
      call UnitAddItem(XX8,UnitItemInSlot(real011[GetPlayerId(GetOwningPlayer(XX8))],0))
      call UnitAddItem(XX8,UnitItemInSlot(real011[GetPlayerId(GetOwningPlayer(XX8))],1))
      call UnitAddItem(XX8,UnitItemInSlot(real011[GetPlayerId(GetOwningPlayer(XX8))],2))
      call UnitAddItem(XX8,UnitItemInSlot(real011[GetPlayerId(GetOwningPlayer(XX8))],3))
      call UnitAddItem(XX8,UnitItemInSlot(real011[GetPlayerId(GetOwningPlayer(XX8))],4))
      call UnitAddItem(XX8,UnitItemInSlot(real011[GetPlayerId(GetOwningPlayer(XX8))],5))
      //call EnableTrigger(t_manipulateitem)
      //if JD9(IO[GetPlayerId(GetOwningPlayer(XX8))])then
      //	call JH9(IO[GetPlayerId(GetOwningPlayer(XX8))])
      //else
      call RemoveHero(real011[GetPlayerId(GetOwningPlayer(XX8))])
      //endif
    endif
  endif
  if Mode_RV then
    if TimerGetElapsed(GlobalTimer)>60 then
      call V79(p,GetObjectName('n02E')+" "+GetUnitName(XX8))
    elseif PlayerUseRandomStatus[GetPlayerId(VU9)] then
      call V79(p,VN9(XX8,VU9))
    else
      call SetPlayerState(VU9,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(VU9,PLAYER_STATE_RESOURCE_GOLD)+250)
      call V79(p,GetObjectName('n0D1')+" "+GetUnitName(XX8)+" "+GetObjectName('n0D0')+" "+(IL7[GetPlayerId((VU9))]))
    endif
  elseif Mode_SH==false or p==PlayerModeTyper then
    if(PlayerHaveRealHero[GetPlayerId(GetOwningPlayer(XX8))] and Mode_SH==false)then
      call V79(p,GetObjectName('n0D5')+" "+GetUnitName(XX8)+".")
    elseif((PlayerUseRandomStatus[GetPlayerId(p)] and Mode_DM==false)or Mode_AR or Mode_TR or Mode_VR)then
      call V79(p,GetObjectName('n0D3')+" "+GetUnitName(XX8)+".")
    else
      call V79(p,GetObjectName('n0D2')+" "+GetUnitName(XX8)+".")
    endif
  endif
  if NoHeroLimitOff then
    if Mode_RV then
      call VG9(VU9)
    else
      call VG9(p)
    endif
  endif
  if(BB7 or Mode_CD)and NoHeroLimitOff then
    call VG9(p)
  endif
  call VM9(p)
  if isPlayerPickedAbility(p,311)or isPlayerPickedAbility(p,263)or isPlayerPickedAbility(p,275)then
    call DisplayTimedTextToPlayer(p,0,group008,10.," ")
    call DisplayTimedTextToPlayer(p,0,group008,10.,"|c00ff0303"+GetObjectName('n0G3')+"|r")
  endif
  if isPlayerPickedAbility(p,337)then
    call DisplayTimedTextToPlayer(p,0,group008,30.," ")
    call DisplayTimedTextToPlayer(p,0,group008,30.,"|c00ff0303"+GetObjectName('n06P')+" "+GetObjectName('n06U')+"|r")
  endif
  if(PlayerUseRandomStatus[GetPlayerId(p)]==false)then
    if(Mode_Normal)then
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,175+GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD))
    endif
  endif
  if HaveSavedBoolean(hashtable019,600+GetUnitPointValue(XX8),87)==false then
    call SaveBoolean(hashtable019,(600+GetUnitPointValue(XX8)),(87),(true))
  endif
  set tt_unit1=XX8
  call ExeFunc("VW9")
  if hhnActive[GetPlayerId(GetLocalPlayer())]==false then
    call SetPlayerName(p,(IL7[GetPlayerId((p))])+" ("+UQ8(udg_Hero[GetPlayerId(p)])+")")
  endif
  call RemoveRegion(r)
  set r=null
  set XX8=null
  set Item=null
  set Hero=null
  set t=null
endfunction

function VX9 takes nothing returns boolean
  return(IsUnitType(GetSoldUnit(),UNIT_TYPE_HERO))!=null
endfunction

function VY9 takes nothing returns nothing
  local unit Hero=GetSoldUnit()
  local player p=GetOwningPlayer(Hero)
  if b_isPickTime then
    call VQ9(Hero,GetPlayerId(p))
    return
  endif
  call VS8(p)
  set Hero=null
endfunction

function GoldPerSecTrigger takes nothing returns boolean
  local integer W98=1
  local integer pid
  local integer i=1
  local real time=TimerGetElapsed(GlobalTimer)
  if Mode_EM then
    set W98=2
  endif
  loop
    exitwhen i==6
    if(LoadReal(HeroStats,GetHandleId(Sentinels[i]),25)<time)then
      call SetPlayerState(Sentinels[i],PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(Sentinels[i],PLAYER_STATE_RESOURCE_GOLD)+W98)
    endif
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i==6
    if(LoadReal(HeroStats,GetHandleId(Scourges[i]),25)<time)then
      call SetPlayerState(Scourges[i],PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(Scourges[i],PLAYER_STATE_RESOURCE_GOLD)+W98)
    endif
    set i=i+1
  endloop
  return false
endfunction

function VA9 takes nothing returns nothing
  local integer YO8=R2I(TimerGetElapsed(GlobalTimer)-GameStartsTime)
  local integer Minutes=YO8/ 60-1/ 2
  local integer Seconds=ModuloInteger(YO8,60)
  if boolean033 then
    call L98(Minutes,Seconds,false)
  elseif SK==false then
    set YO8=R2I(16-TimerGetElapsed(GlobalTimer))
    set Minutes=YO8/ 60-1/ 2
    set Seconds=ModuloInteger(YO8,60)
    call L98(Minutes,Seconds,true)
  endif
  
  set MinutesForTime = Minutes
  set SecondsForTime = Seconds
endfunction

function VB9 takes nothing returns boolean
  local unit Source=GetTriggerUnit()
  local integer aid=GetSpellAbilityId()
  if IsUnitType(Source,UNIT_TYPE_HERO) and(LoadInteger(UltiCDs,(aid),(GetUnitAbilityLevel(Source,aid))))>0 then
    if aid==SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Source))*PlayerSkillOffset+4]] or (AlternateSkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Source))*PlayerSkillOffset+4]]!=null and aid==AlternateSkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Source))*PlayerSkillOffset+4]]) then
      if isMorphedUnit(Source)==true and aid==Lich_MorphedSkillId then
        
      else
        call TimerStart(PrimaryUltiCooldownTimer[GetPlayerId(GetOwningPlayer(Source))],(LoadInteger(UltiCDs,(aid),(GetUnitAbilityLevel(Source,aid)))),false,null)
      endif
    else
      call TimerStart(SecondaryUltiCooldownTimer[GetPlayerId(GetOwningPlayer(Source))],(LoadInteger(UltiCDs,(aid),(GetUnitAbilityLevel(Source,aid)))),false,null)
    endif
  endif
  if aid=='A02W' then
    call TimerStart(PrimaryUltiCooldownTimer[GetPlayerId((GetOwningPlayer(Source)))],0,false,null)
    call TimerStart(SecondaryUltiCooldownTimer[GetPlayerId((GetOwningPlayer(Source)))],0,false,null)
  endif
  set Source=null
  return false
endfunction

function VC9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer i
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function VB9))
  set t=null
  set i=0
  loop
    exitwhen(i>13)
    set PrimaryUltiCooldownTimer[i]=CreateTimer()
    set SecondaryUltiCooldownTimer[i]=CreateTimer()
    set i=i+1
  endloop
  set UltiCDs=InitHashtable()
  call SaveInteger(UltiCDs,'A11K',1,90)
  call SaveInteger(UltiCDs,'A11K',2,80)
  call SaveInteger(UltiCDs,'A11K',3,70)
  call SaveInteger(UltiCDs,'A0O2',1,80)
  call SaveInteger(UltiCDs,'A0O2',2,75)
  call SaveInteger(UltiCDs,'A0O2',3,70)
  call SaveInteger(UltiCDs,'A289',1,45)
  call SaveInteger(UltiCDs,'A289',2,45)
  call SaveInteger(UltiCDs,'A289',3,45)
  call SaveInteger(UltiCDs,'A0NS',1,60)
  call SaveInteger(UltiCDs,'A0NS',2,50)
  call SaveInteger(UltiCDs,'A0NS',3,40)
  call SaveInteger(UltiCDs,'A0DH',1,110)
  call SaveInteger(UltiCDs,'A0DH',2,110)
  call SaveInteger(UltiCDs,'A0DH',3,110)
  call SaveInteger(UltiCDs,'A1OB',1,110)
  call SaveInteger(UltiCDs,'A1OB',2,110)
  call SaveInteger(UltiCDs,'A1OB',3,110)
  call SaveInteger(UltiCDs,'A0ER',1,100)
  call SaveInteger(UltiCDs,'A0ER',2,100)
  call SaveInteger(UltiCDs,'A0ER',3,100)
  call SaveInteger(UltiCDs,'A2S8',1,100)
  call SaveInteger(UltiCDs,'A2S8',2,100)
  call SaveInteger(UltiCDs,'A2S8',3,100)
  call SaveInteger(UltiCDs,'A0MQ',1,140)
  call SaveInteger(UltiCDs,'A0MQ',2,120)
  call SaveInteger(UltiCDs,'A0MQ',3,100)
  call SaveInteger(UltiCDs,'A1B6',1,140)
  call SaveInteger(UltiCDs,'A1B6',2,120)
  call SaveInteger(UltiCDs,'A1B6',3,100)
  call SaveInteger(UltiCDs,'A1WH',1,80)
  call SaveInteger(UltiCDs,'A1WH',2,80)
  call SaveInteger(UltiCDs,'A1WH',3,80)
  call SaveInteger(UltiCDs,'A0WP',1,80)
  call SaveInteger(UltiCDs,'A0WP',2,80)
  call SaveInteger(UltiCDs,'A0WP',3,80)
  call SaveInteger(UltiCDs,'A1A1',1,100)
  call SaveInteger(UltiCDs,'A1A1',2,100)
  call SaveInteger(UltiCDs,'A1A1',3,100)
  call SaveInteger(UltiCDs,'A07Z',1,115)
  call SaveInteger(UltiCDs,'A07Z',2,105)
  call SaveInteger(UltiCDs,'A07Z',3,95)
  call SaveInteger(UltiCDs,'ANcr',1,45)
  call SaveInteger(UltiCDs,'ANcr',2,45)
  call SaveInteger(UltiCDs,'ANcr',3,45)
  call SaveInteger(UltiCDs,'QB0K',1,45)
  call SaveInteger(UltiCDs,'QB0K',2,45)
  call SaveInteger(UltiCDs,'QB0K',3,45)
  call SaveInteger(UltiCDs,'A0Z8',1,70)
  call SaveInteger(UltiCDs,'A0Z8',2,55)
  call SaveInteger(UltiCDs,'A0Z8',3,40)
  call SaveInteger(UltiCDs,'A1CV',1,12)
  call SaveInteger(UltiCDs,'A1CV',2,12)
  call SaveInteger(UltiCDs,'A1CV',3,12)
  call SaveInteger(UltiCDs,'A03G',1,115)
  call SaveInteger(UltiCDs,'A03G',2,115)
  call SaveInteger(UltiCDs,'A03G',3,115)
  call SaveInteger(UltiCDs,'QM00',1,115)
  call SaveInteger(UltiCDs,'QM00',2,115)
  call SaveInteger(UltiCDs,'QM00',3,115)
  call SaveInteger(UltiCDs,'A29L',1,120)
  call SaveInteger(UltiCDs,'A29L',2,110)
  call SaveInteger(UltiCDs,'A29L',3,100)
  call SaveInteger(UltiCDs,'A0QR',1,45)
  call SaveInteger(UltiCDs,'A0QR',2,30)
  call SaveInteger(UltiCDs,'A0QR',3,15)
  call SaveInteger(UltiCDs,'A1B3',1,24)
  call SaveInteger(UltiCDs,'A1B3',2,16)
  call SaveInteger(UltiCDs,'A1B3',3,8)
  call SaveInteger(UltiCDs,'A06R',1,100)
  call SaveInteger(UltiCDs,'A06R',2,90)
  call SaveInteger(UltiCDs,'A06R',3,80)
  call SaveInteger(UltiCDs,'A1B4',1,90)
  call SaveInteger(UltiCDs,'A1B4',2,80)
  call SaveInteger(UltiCDs,'A1B4',3,70)
  call SaveInteger(UltiCDs,'A0G4',1,75)
  call SaveInteger(UltiCDs,'A0G4',2,75)
  call SaveInteger(UltiCDs,'A0G4',3,75)
  call SaveInteger(UltiCDs,'A1D8',1,20)
  call SaveInteger(UltiCDs,'A1D8',2,20)
  call SaveInteger(UltiCDs,'A1D8',3,20)
  call SaveInteger(UltiCDs,'A29I',1,150)
  call SaveInteger(UltiCDs,'A29I',2,150)
  call SaveInteger(UltiCDs,'A29I',3,150)
  call SaveInteger(UltiCDs,'A0E2',1,75)
  call SaveInteger(UltiCDs,'A0E2',2,65)
  call SaveInteger(UltiCDs,'A0E2',3,55)
  call SaveInteger(UltiCDs,'A1MR',1,6)
  call SaveInteger(UltiCDs,'A1MR',2,6)
  call SaveInteger(UltiCDs,'A1MR',3,6)
  call SaveInteger(UltiCDs,'A03O',1,100)
  call SaveInteger(UltiCDs,'A03O',2,100)
  call SaveInteger(UltiCDs,'A03O',3,100)
  //call SaveInteger(UltiCDs,'A0RW',1,20)
  //call SaveInteger(UltiCDs,'A0RW',2,20)
  //call SaveInteger(UltiCDs,'A0RW',3,20)
  call SaveInteger(UltiCDs,'A0MU',1,110)
  call SaveInteger(UltiCDs,'A0MU',2,110)
  call SaveInteger(UltiCDs,'A0MU',3,110)
  call SaveInteger(UltiCDs,'A0A2',1,100)
  call SaveInteger(UltiCDs,'A0A2',2,100)
  call SaveInteger(UltiCDs,'A0A2',3,100)
  call SaveInteger(UltiCDs,'A0SW',1,100)
  call SaveInteger(UltiCDs,'A0SW',2,100)
  call SaveInteger(UltiCDs,'A0SW',3,100)
  call SaveInteger(UltiCDs,'A093',1,100)
  call SaveInteger(UltiCDs,'A093',2,70)
  call SaveInteger(UltiCDs,'A093',3,40)
  call SaveInteger(UltiCDs,'QM02',1,100)
  call SaveInteger(UltiCDs,'QM02',2,70)
  call SaveInteger(UltiCDs,'QM02',3,40)
  call SaveInteger(UltiCDs,'A03K',1,180)
  call SaveInteger(UltiCDs,'A03K',2,150)
  call SaveInteger(UltiCDs,'A03K',3,120)
  call SaveInteger(UltiCDs,'DRKN',1,180)
  call SaveInteger(UltiCDs,'DRKN',2,150)
  call SaveInteger(UltiCDs,'DRKN',3,120)
  call SaveInteger(UltiCDs,'DRKU',1,180)
  call SaveInteger(UltiCDs,'DRKU',2,150)
  call SaveInteger(UltiCDs,'DRKU',3,120)
  call SaveInteger(UltiCDs,'A0R0',1,130)
  call SaveInteger(UltiCDs,'A0R0',2,130)
  call SaveInteger(UltiCDs,'A0R0',3,130)
  call SaveInteger(UltiCDs,'A0FL',1,30)
  call SaveInteger(UltiCDs,'A0FL',2,30)
  call SaveInteger(UltiCDs,'A0FL',3,30)
  call SaveInteger(UltiCDs,'A1CX',1,30)
  call SaveInteger(UltiCDs,'A1CX',2,30)
  call SaveInteger(UltiCDs,'A1CX',3,30)
  call SaveInteger(UltiCDs,'A034',1,10)
  call SaveInteger(UltiCDs,'A034',2,10)
  call SaveInteger(UltiCDs,'A034',3,10)
  call SaveInteger(UltiCDs,'QB0C',1,10)
  call SaveInteger(UltiCDs,'QB0C',2,10)
  call SaveInteger(UltiCDs,'QB0C',3,10)
  call SaveInteger(UltiCDs,'A15J',1,75)
  call SaveInteger(UltiCDs,'A15J',2,75)
  call SaveInteger(UltiCDs,'A15J',3,75)
  call SaveInteger(UltiCDs,'QM03',1,75)
  call SaveInteger(UltiCDs,'QM03',2,75)
  call SaveInteger(UltiCDs,'QM03',3,75)
  call SaveInteger(UltiCDs,'A0E3',1,70)
  call SaveInteger(UltiCDs,'A0E3',2,70)
  call SaveInteger(UltiCDs,'A0E3',3,70)
  call SaveInteger(UltiCDs,'A04P',1,20)
  call SaveInteger(UltiCDs,'A04P',2,15)
  call SaveInteger(UltiCDs,'A04P',3,10)
  call SaveInteger(UltiCDs,'A0M1',1,130)
  call SaveInteger(UltiCDs,'A0M1',2,120)
  call SaveInteger(UltiCDs,'A0M1',3,110)
  call SaveInteger(UltiCDs,'A1AX',1,110)
  call SaveInteger(UltiCDs,'A1AX',2,100)
  call SaveInteger(UltiCDs,'A1AX',3,90)
  call SaveInteger(UltiCDs,'A054',1,120)
  call SaveInteger(UltiCDs,'A054',2,120)
  call SaveInteger(UltiCDs,'A054',3,120)
  call SaveInteger(UltiCDs,'A00U',1,120)
  call SaveInteger(UltiCDs,'A00U',2,120)
  call SaveInteger(UltiCDs,'A00U',3,120)
  call SaveInteger(UltiCDs,'A0G8',1,80)
  call SaveInteger(UltiCDs,'A0G8',2,80)
  call SaveInteger(UltiCDs,'A0G8',3,80)
  call SaveInteger(UltiCDs,'A07U',1,180)
  call SaveInteger(UltiCDs,'A07U',2,120)
  call SaveInteger(UltiCDs,'A07U',3,60)
  call SaveInteger(UltiCDs,'A0KU',1,160)
  call SaveInteger(UltiCDs,'A0KU',2,140)
  call SaveInteger(UltiCDs,'A0KU',3,120)
  call SaveInteger(UltiCDs,'A1EJ',1,30)
  call SaveInteger(UltiCDs,'A1EJ',2,30)
  call SaveInteger(UltiCDs,'A1EJ',3,30)
  call SaveInteger(UltiCDs,'A0B4',1,10)
  call SaveInteger(UltiCDs,'A0B4',2,7)
  call SaveInteger(UltiCDs,'A0B4',3,5)
  call SaveInteger(UltiCDs,'QB0D',1,10)
  call SaveInteger(UltiCDs,'QB0D',2,7)
  call SaveInteger(UltiCDs,'QB0D',3,5)
  call SaveInteger(UltiCDs,'QF89',1,40)
  call SaveInteger(UltiCDs,'QF89',2,40)
  call SaveInteger(UltiCDs,'QF89',3,40)
  call SaveInteger(UltiCDs,'A1IN',1,65)
  call SaveInteger(UltiCDs,'A1IN',2,65)
  call SaveInteger(UltiCDs,'A1IN',3,65)
  call SaveInteger(UltiCDs,'A0J1',1,120)
  call SaveInteger(UltiCDs,'A0J1',2,100)
  call SaveInteger(UltiCDs,'A0J1',3,80)
  call SaveInteger(UltiCDs,'A1D7',1,60)
  call SaveInteger(UltiCDs,'A1D7',2,60)
  call SaveInteger(UltiCDs,'A1D7',3,60)
  call SaveInteger(UltiCDs,'A1MI',1,40)
  call SaveInteger(UltiCDs,'A1MI',2,40)
  call SaveInteger(UltiCDs,'A1MI',3,40)
  call SaveInteger(UltiCDs,'A2QE',1,40)
  call SaveInteger(UltiCDs,'A2QE',2,40)
  call SaveInteger(UltiCDs,'A2QE',3,40)
  call SaveInteger(UltiCDs,'A1AO',1,80)
  call SaveInteger(UltiCDs,'A1AO',2,70)
  call SaveInteger(UltiCDs,'A1AO',3,60)
  call SaveInteger(UltiCDs,'A1UV',1,80)
  call SaveInteger(UltiCDs,'A1UV',2,70)
  call SaveInteger(UltiCDs,'A1UV',3,60)
  call SaveInteger(UltiCDs,'A1NE',1,180)
  call SaveInteger(UltiCDs,'A1NE',2,160)
  call SaveInteger(UltiCDs,'A1NE',3,140)
  call SaveInteger(UltiCDs,'A2IG',1,180)
  call SaveInteger(UltiCDs,'A2IG',2,160)
  call SaveInteger(UltiCDs,'A2IG',3,140)
  call SaveInteger(UltiCDs,'A1AT',1,90)
  call SaveInteger(UltiCDs,'A1AT',2,90)
  call SaveInteger(UltiCDs,'A1AT',3,90)
  call SaveInteger(UltiCDs,'QB10',1,100)
  call SaveInteger(UltiCDs,'QB10',2,100)
  call SaveInteger(UltiCDs,'QB10',3,100)
  call SaveInteger(UltiCDs,'A2TI',1,80)
  call SaveInteger(UltiCDs,'A2TI',2,80)
  call SaveInteger(UltiCDs,'A2TI',3,80)
  call SaveInteger(UltiCDs,'A2TF',1,20)
  call SaveInteger(UltiCDs,'A2TF',2,20)
  call SaveInteger(UltiCDs,'A2TF',3,20)
  call SaveInteger(UltiCDs,'QB11',1,40)
  call SaveInteger(UltiCDs,'QB11',2,35)
  call SaveInteger(UltiCDs,'QB11',3,30)
  call SaveInteger(UltiCDs,'A32G',1,90)
  call SaveInteger(UltiCDs,'A32G',2,80)
  call SaveInteger(UltiCDs,'A32G',3,70)
  call SaveInteger(UltiCDs,'A33U',1,35)
  call SaveInteger(UltiCDs,'A33U',2,35)
  call SaveInteger(UltiCDs,'A33U',3,35)
  call SaveInteger(UltiCDs,'A0RP',1,11)
  call SaveInteger(UltiCDs,'A0RP',2,9)
  call SaveInteger(UltiCDs,'A0RP',3,7)
  call SaveInteger(UltiCDs,'A0LC',1,25)
  call SaveInteger(UltiCDs,'A0LC',2,25)
  call SaveInteger(UltiCDs,'A0LC',3,25)
  call SaveInteger(UltiCDs,'A0IN',1,45)
  call SaveInteger(UltiCDs,'A0IN',2,45)
  call SaveInteger(UltiCDs,'A0IN',3,45)
  call SaveInteger(UltiCDs,'A1AW',1,10)
  call SaveInteger(UltiCDs,'A1AW',2,10)
  call SaveInteger(UltiCDs,'A1AW',3,10)
  call SaveInteger(UltiCDs,'A0LH',1,70)
  call SaveInteger(UltiCDs,'A0LH',2,60)
  call SaveInteger(UltiCDs,'A0LH',3,50)
  call SaveInteger(UltiCDs,'A04Q',1,45)
  call SaveInteger(UltiCDs,'A04Q',2,45)
  call SaveInteger(UltiCDs,'A04Q',3,45)
  call SaveInteger(UltiCDs,'A0WQ',1,45)
  call SaveInteger(UltiCDs,'A0WQ',2,45)
  call SaveInteger(UltiCDs,'A0WQ',3,45)
  call SaveInteger(UltiCDs,'A09U',1,70)
  call SaveInteger(UltiCDs,'A09U',2,60)
  call SaveInteger(UltiCDs,'A09U',3,50)
  call SaveInteger(UltiCDs,'A0CT',1,60)
  call SaveInteger(UltiCDs,'A0CT',2,50)
  call SaveInteger(UltiCDs,'A0CT',3,40)
  call SaveInteger(UltiCDs,'A29J',1,120)
  call SaveInteger(UltiCDs,'A29J',2,110)
  call SaveInteger(UltiCDs,'A29J',3,100)
  call SaveInteger(UltiCDs,'A07Q',1,120)
  call SaveInteger(UltiCDs,'A07Q',2,80)
  call SaveInteger(UltiCDs,'A07Q',3,40)
  call SaveInteger(UltiCDs,'A0H9',1,120)
  call SaveInteger(UltiCDs,'A0H9',2,120)
  call SaveInteger(UltiCDs,'A0H9',3,120)
  call SaveInteger(UltiCDs,'A013',1,100)
  call SaveInteger(UltiCDs,'A013',2,100)
  call SaveInteger(UltiCDs,'A013',3,100)
  call SaveInteger(UltiCDs,'A0A6',1,100)
  call SaveInteger(UltiCDs,'A0A6',2,80)
  call SaveInteger(UltiCDs,'A0A6',3,60)
  call SaveInteger(UltiCDs,'A080',1,80)
  call SaveInteger(UltiCDs,'A080',2,50)
  call SaveInteger(UltiCDs,'A080',3,30)
  call SaveInteger(UltiCDs,'A1UZ',1,12)
  call SaveInteger(UltiCDs,'A1UZ',2,12)
  call SaveInteger(UltiCDs,'A1UZ',3,12)
  call SaveInteger(UltiCDs,'A03R',1,90)
  call SaveInteger(UltiCDs,'A03R',2,80)
  call SaveInteger(UltiCDs,'A03R',3,70)
  call SaveInteger(UltiCDs,'A0AV',1,90)
  call SaveInteger(UltiCDs,'A0AV',2,80)
  call SaveInteger(UltiCDs,'A0AV',3,70)
  call SaveInteger(UltiCDs,'A0S8',1,85)
  call SaveInteger(UltiCDs,'A0S8',2,85)
  call SaveInteger(UltiCDs,'A0S8',3,85)
  call SaveInteger(UltiCDs,'A1QP',1,85)
  call SaveInteger(UltiCDs,'A1QP',2,85)
  call SaveInteger(UltiCDs,'A1QP',3,85)
  call SaveInteger(UltiCDs,'A0LT',1,160)
  call SaveInteger(UltiCDs,'A0LT',2,140)
  call SaveInteger(UltiCDs,'A0LT',3,120)
  call SaveInteger(UltiCDs,'A1CS',1,30)
  call SaveInteger(UltiCDs,'A1CS',2,30)
  call SaveInteger(UltiCDs,'A1CS',3,30)
  call SaveInteger(UltiCDs,'A11T',1,80)
  call SaveInteger(UltiCDs,'A11T',2,70)
  call SaveInteger(UltiCDs,'A11T',3,60)
  call SaveInteger(UltiCDs,'QM01',1,80)
  call SaveInteger(UltiCDs,'QM01',2,70)
  call SaveInteger(UltiCDs,'QM01',3,60)
  call SaveInteger(UltiCDs,'A1W8',1,90)
  call SaveInteger(UltiCDs,'A1W8',2,75)
  call SaveInteger(UltiCDs,'A1W8',3,60)
  call SaveInteger(UltiCDs,'A1W9',1,90)
  call SaveInteger(UltiCDs,'A1W9',2,75)
  call SaveInteger(UltiCDs,'A1W9',3,60)
  call SaveInteger(UltiCDs,'A29G',1,120)
  call SaveInteger(UltiCDs,'A29G',2,120)
  call SaveInteger(UltiCDs,'A29G',3,120)
  call SaveInteger(UltiCDs,'A29H',1,120)
  call SaveInteger(UltiCDs,'A29H',2,120)
  call SaveInteger(UltiCDs,'A29H',3,120)
  call SaveInteger(UltiCDs,'A0L3',1,160)
  call SaveInteger(UltiCDs,'A0L3',2,160)
  call SaveInteger(UltiCDs,'A0L3',3,160)
  call SaveInteger(UltiCDs,'A2QC',1,160)
  call SaveInteger(UltiCDs,'A2QC',2,160)
  call SaveInteger(UltiCDs,'A2QC',3,160)
  call SaveInteger(UltiCDs,'A01P',1,120)
  call SaveInteger(UltiCDs,'A01P',2,90)
  call SaveInteger(UltiCDs,'A01P',3,55)
  call SaveInteger(UltiCDs,'A09Z',1,120)
  call SaveInteger(UltiCDs,'A09Z',2,90)
  call SaveInteger(UltiCDs,'A09Z',3,55)
  call SaveInteger(UltiCDs,'A12P',1,60)
  call SaveInteger(UltiCDs,'A12P',2,60)
  call SaveInteger(UltiCDs,'A12P',3,60)
  call SaveInteger(UltiCDs,'A1D6',1,15)
  call SaveInteger(UltiCDs,'A1D6',2,15)
  call SaveInteger(UltiCDs,'A1D6',3,15)
  call SaveInteger(UltiCDs,'A19O',1,90)
  call SaveInteger(UltiCDs,'A19O',2,70)
  call SaveInteger(UltiCDs,'A19O',3,50)
  call SaveInteger(UltiCDs,'A0AK',1,10)
  call SaveInteger(UltiCDs,'A0AK',2,10)
  call SaveInteger(UltiCDs,'A0AK',3,10)
  call SaveInteger(UltiCDs,'A1FY',1,10)
  call SaveInteger(UltiCDs,'A1FY',2,10)
  call SaveInteger(UltiCDs,'A1FY',3,10)
  call SaveInteger(UltiCDs,'A0VF',1,22)
  call SaveInteger(UltiCDs,'A0VF',2,17)
  call SaveInteger(UltiCDs,'A0VF',3,12)
  call SaveInteger(UltiCDs,'A0VF',4,5)
  call SaveInteger(UltiCDs,'A1B5',1,16)
  call SaveInteger(UltiCDs,'A1B5',2,8)
  call SaveInteger(UltiCDs,'A1B5',3,4)
  call SaveInteger(UltiCDs,'A1B5',4,2)
  call SaveInteger(UltiCDs,'A07K',1,6)
  call SaveInteger(UltiCDs,'A07K',2,6)
  call SaveInteger(UltiCDs,'A07K',3,6)
  call SaveInteger(UltiCDs,'A10Q',1,40)
  call SaveInteger(UltiCDs,'A10Q',2,40)
  call SaveInteger(UltiCDs,'A10Q',3,40)
  call SaveInteger(UltiCDs,'A1DB',1,40)
  call SaveInteger(UltiCDs,'A1DB',2,40)
  call SaveInteger(UltiCDs,'A1DB',3,40)
  call SaveInteger(UltiCDs,'A00H',1,110)
  call SaveInteger(UltiCDs,'A00H',2,110)
  call SaveInteger(UltiCDs,'A00H',3,110)
  call SaveInteger(UltiCDs,'A0A1',1,110)
  call SaveInteger(UltiCDs,'A0A1',2,110)
  call SaveInteger(UltiCDs,'A0A1',3,110)
  call SaveInteger(UltiCDs,'A0O5',1,60)
  call SaveInteger(UltiCDs,'A0O5',2,60)
  call SaveInteger(UltiCDs,'A0O5',3,60)
  call SaveInteger(UltiCDs,'A1B1',1,60)
  call SaveInteger(UltiCDs,'A1B1',2,60)
  call SaveInteger(UltiCDs,'A1B1',3,60)
  call SaveInteger(UltiCDs,'A0NT',1,90)
  call SaveInteger(UltiCDs,'A0NT',2,90)
  call SaveInteger(UltiCDs,'A0NT',3,90)
  call SaveInteger(UltiCDs,'A0NX',1,90)
  call SaveInteger(UltiCDs,'A0NX',2,90)
  call SaveInteger(UltiCDs,'A0NX',3,90)
  call SaveInteger(UltiCDs,'A02Q',1,100)
  call SaveInteger(UltiCDs,'A02Q',2,100)
  call SaveInteger(UltiCDs,'A02Q',3,100)
  call SaveInteger(UltiCDs,'A1D9',1,100)
  call SaveInteger(UltiCDs,'A1D9',2,100)
  call SaveInteger(UltiCDs,'A1D9',3,100)
  call SaveInteger(UltiCDs,'A0QK',1,100)
  call SaveInteger(UltiCDs,'A0QK',2,100)
  call SaveInteger(UltiCDs,'A0QK',3,100)
  call SaveInteger(UltiCDs,'A073',1,100)
  call SaveInteger(UltiCDs,'A073',2,100)
  call SaveInteger(UltiCDs,'A073',3,100)
  call SaveInteger(UltiCDs,'A03J',1,100)
  call SaveInteger(UltiCDs,'A03J',2,100)
  call SaveInteger(UltiCDs,'A03J',3,100)
  call SaveInteger(UltiCDs,'A04J',1,100)
  call SaveInteger(UltiCDs,'A04J',2,100)
  call SaveInteger(UltiCDs,'A04J',3,100)
  call SaveInteger(UltiCDs,'A04M',1,100)
  call SaveInteger(UltiCDs,'A04M',2,100)
  call SaveInteger(UltiCDs,'A04M',3,100)
  call SaveInteger(UltiCDs,'A04N',1,115)
  call SaveInteger(UltiCDs,'A04N',2,115)
  call SaveInteger(UltiCDs,'A04N',3,115)
  call SaveInteger(UltiCDs,'A095',1,160)
  call SaveInteger(UltiCDs,'A095',2,100)
  call SaveInteger(UltiCDs,'A095',3,40)
  call SaveInteger(UltiCDs,'A09W',1,100)
  call SaveInteger(UltiCDs,'A09W',2,60)
  call SaveInteger(UltiCDs,'A09W',3,20)
  call SaveInteger(UltiCDs,'A1BX',1,200)
  call SaveInteger(UltiCDs,'A1BX',2,190)
  call SaveInteger(UltiCDs,'A1BX',3,180)
  call SaveInteger(UltiCDs,'A30L',1,200)
  call SaveInteger(UltiCDs,'A30L',2,190)
  call SaveInteger(UltiCDs,'A30L',3,180)
  call SaveInteger(UltiCDs,'A05T',1,145)
  call SaveInteger(UltiCDs,'A05T',2,115)
  call SaveInteger(UltiCDs,'A05T',3,60)
  call SaveInteger(UltiCDs,'A08H',1,145)
  call SaveInteger(UltiCDs,'A08H',2,115)
  call SaveInteger(UltiCDs,'A08H',3,60)
  call SaveInteger(UltiCDs,'A067',1,100)
  call SaveInteger(UltiCDs,'A067',2,85)
  call SaveInteger(UltiCDs,'A067',3,70)
  call SaveInteger(UltiCDs,'A08P',1,70)
  call SaveInteger(UltiCDs,'A08P',2,70)
  call SaveInteger(UltiCDs,'A08P',3,70)
  call SaveInteger(UltiCDs,'A0CC',1,22)
  call SaveInteger(UltiCDs,'A0CC',2,22)
  call SaveInteger(UltiCDs,'A0CC',3,22)
  call SaveInteger(UltiCDs,'A0OK',1,130)
  call SaveInteger(UltiCDs,'A0OK',2,130)
  call SaveInteger(UltiCDs,'A0OK',3,130)
  call SaveInteger(UltiCDs,'A1VW',1,130)
  call SaveInteger(UltiCDs,'A1VW',2,130)
  call SaveInteger(UltiCDs,'A1VW',3,130)
  call SaveInteger(UltiCDs,'A28R',1,120)
  call SaveInteger(UltiCDs,'A28R',2,110)
  call SaveInteger(UltiCDs,'A28R',3,100)
  call SaveInteger(UltiCDs,'A28S',1,40)
  call SaveInteger(UltiCDs,'A28S',2,40)
  call SaveInteger(UltiCDs,'A28S',3,40)
  call SaveInteger(UltiCDs,'S008',1,165)
  call SaveInteger(UltiCDs,'S008',2,165)
  call SaveInteger(UltiCDs,'S008',3,165)
  call SaveInteger(UltiCDs,'S00U',1,165)
  call SaveInteger(UltiCDs,'S00U',2,165)
  call SaveInteger(UltiCDs,'S00U',3,165)
  call SaveInteger(UltiCDs,'A1TB',1,90)
  call SaveInteger(UltiCDs,'A1TB',2,75)
  call SaveInteger(UltiCDs,'A1TB',3,60)
  call SaveInteger(UltiCDs,'A1U6',1,85)
  call SaveInteger(UltiCDs,'A1U6',2,85)
  call SaveInteger(UltiCDs,'A1U6',3,85)
  call SaveInteger(UltiCDs,'A30N',1,85)
  call SaveInteger(UltiCDs,'A30N',2,85)
  call SaveInteger(UltiCDs,'A30N',3,85)
  call SaveInteger(UltiCDs,'A1T5',1,55)
  call SaveInteger(UltiCDs,'A1T5',2,50)
  call SaveInteger(UltiCDs,'A1T5',3,45)
  call SaveInteger(UltiCDs,'A235',1,55)
  call SaveInteger(UltiCDs,'A235',2,50)
  call SaveInteger(UltiCDs,'A235',3,45)
  call SaveInteger(UltiCDs,'A343',1,50)
  call SaveInteger(UltiCDs,'A343',2,50)
  call SaveInteger(UltiCDs,'A343',3,50)
  call SaveInteger(UltiCDs,'A1RK',1,110)
  call SaveInteger(UltiCDs,'A1RK',2,110)
  call SaveInteger(UltiCDs,'A1RK',3,110)
  call SaveInteger(UltiCDs,'A1YQ',1,30)
  call SaveInteger(UltiCDs,'A1YQ',2,24)
  call SaveInteger(UltiCDs,'A1YQ',3,18)
  call SaveInteger(UltiCDs,'A27H',1,20)
  call SaveInteger(UltiCDs,'A27H',2,18)
  call SaveInteger(UltiCDs,'A27H',3,16)
  call SaveInteger(UltiCDs,'A30J',1,5)
  call SaveInteger(UltiCDs,'A30J',2,5)
  call SaveInteger(UltiCDs,'A30J',3,5)
  call SaveInteger(UltiCDs,'A2BG',1,60)
  call SaveInteger(UltiCDs,'A2BG',2,40)
  call SaveInteger(UltiCDs,'A2BG',3,20)
  call SaveInteger(UltiCDs,'A30H',1,20)
  call SaveInteger(UltiCDs,'A30H',2,10)
  call SaveInteger(UltiCDs,'A30H',3,0)
  call SaveInteger(UltiCDs,'A2CI',1,50)
  call SaveInteger(UltiCDs,'A2CI',2,50)
  call SaveInteger(UltiCDs,'A2CI',3,50)
  call SaveInteger(UltiCDs,'A2E5',1,8)
  call SaveInteger(UltiCDs,'A2E5',2,8)
  call SaveInteger(UltiCDs,'A2E5',3,8)
  call SaveInteger(UltiCDs,'A2O6',1,50)
  call SaveInteger(UltiCDs,'A2O6',2,50)
  call SaveInteger(UltiCDs,'A2O6',3,50)
  call SaveInteger(UltiCDs,'A0Z0',1,90)
  call SaveInteger(UltiCDs,'A0Z0',2,80)
  call SaveInteger(UltiCDs,'A0Z0',3,70)
  call SaveInteger(UltiCDs,'A504',1,60)
  call SaveInteger(UltiCDs,'A504',2,50)
  call SaveInteger(UltiCDs,'A504',3,40)
  call SaveInteger(UltiCDs,'A503',1,60)
  call SaveInteger(UltiCDs,'A503',2,50)
  call SaveInteger(UltiCDs,'A503',3,40)
endfunction

function V39 takes nothing returns boolean
  local player p
  local integer i
  local integer id
  local integer V69
  set i=1
  loop
    exitwhen i>5
    set p=Sentinels[i]
    set id=GetPlayerId(p)
    set V69=GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)
    if V69<ReliableGold[id]then
      set ReliableGold[id]=V69
    endif
    set p=Scourges[i]
    set id=GetPlayerId(p)
    set V69=GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)
    if V69<ReliableGold[id]then
      set ReliableGold[id]=V69
    endif
    set i=i+1
  endloop
  return false
endfunction

function VL9 takes integer Source,integer Target returns boolean
  local integer i=Assists_Increment-1
  local real V19=0
  local real UK8=(TimerGetElapsed(GlobalTimer))
  local integer Count=0
  loop
    exitwhen i==Assists_Increment or V19>Assists_MaxTime or Count>200
    if i==0 then
      set i=8000-1
    endif
    set Count=Count+1
    set V19=UK8-Assists_LastTimeDamaged[i]
    if Assists_PlayerID[i]==Source and Assists_PlayerIDDamaged[i]==Target and V19<Assists_MaxTime then
      set Assists_PlayerID[i]=0
      set Assists_PlayerIDDamaged[i]=0
      return true
    endif
    set i=i-1
  endloop
  return false
endfunction

function V09 takes integer Source,integer Target returns boolean
  local integer i=Assists_Increment-1
  local real V19=0
  local real UK8=(TimerGetElapsed(GlobalTimer))
  local integer Count=0
  loop
    exitwhen i==Assists_Increment or V19>Assists_MaxTime or Count>200
    if i==0 then
      set i=8000-1
    endif
    set Count=Count+1
    set V19=UK8-Assists_LastTimeDamaged[i]
    if Assists_PlayerID[i]==Source and Assists_PlayerIDDamaged[i]==Target and V19<Assists_MaxTime then
      return true
    endif
    set i=i-1
  endloop
  return false
endfunction

function V59 takes nothing returns nothing
  local integer Source=GetPlayerId(GetOwningPlayer(GetEventDamageSource()))
  local integer Target=GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
  local real Damage=GetEventDamage()
  set Assists_LastTimeDamaged[Assists_Increment]=(TimerGetElapsed(GlobalTimer))
  set Assists_PlayerID[Assists_Increment]=Source
  set Assists_PlayerIDDamaged[Assists_Increment]=Target
  set Assists_Increment=Assists_Increment+1
  if Assists_Increment==8000 then
    set Assists_Increment=1
  endif
endfunction

function V29 takes unit CE8,unit W49 returns string
  local integer i=1
  local integer W79=GetPlayerId(GetOwningPlayer(CE8))
  local integer W89=GetPlayerId(GetOwningPlayer(W49))
  local integer B78
  local string W99=" "+GetObjectName('n0JY')+" "
  local boolean WD9=false
  loop
    exitwhen i>5
    if IsSentinel(GetOwningPlayer(W49))then
      set B78=GetPlayerId(Sentinels[i])
    else
      set B78=GetPlayerId(Scourges[i])
    endif
    if W89!=B78 and VL9(B78,W79)then
      set GlobalAssistsCounter[B78]=GlobalAssistsCounter[B78]+1
      call Traffic_RegisterData("Assist"+I2S(B78),W79)
      if WD9 then
        set W99=W99+"/"+udg_Colors[B78]+(IL7[GetPlayerId((Player(B78)))])+"|r"
      else
        set W99=W99+udg_Colors[B78]+(IL7[GetPlayerId((Player(B78)))])+"|r"
      endif
      set WD9=true
    endif
    set i=i+1
  endloop
  if WD9 then
    return W99
  endif
  return" "
endfunction

function WE9 takes unit CE8,unit W49 returns string
  local integer i=1
  local integer W79=GetPlayerId(GetOwningPlayer(CE8))
  local integer W89=GetPlayerId(GetOwningPlayer(W49))
  local integer B78
  local string W99=""
  local boolean WD9=false
  loop
    exitwhen i>5
    if IsSentinel(GetOwningPlayer(W49))then
      set B78=GetPlayerId(Sentinels[i])
    else
      set B78=GetPlayerId(Scourges[i])
    endif
    if W89!=B78 and V09(B78,W79)then
      if WD9 then
        set W99=W99+"/"+udg_Colors[B78]+(IL7[GetPlayerId((Player(B78)))])+"|r"
      else
        set W99=W99+udg_Colors[B78]+(IL7[GetPlayerId((Player(B78)))])+"|r"
      endif
      set WD9=true
    endif
    set i=i+1
  endloop
  if WD9 then
    return W99
  endif
  return" "
endfunction

function WF9 takes unit CE8,unit W49 returns integer
  local integer i=1
  local integer W79=GetPlayerId(GetOwningPlayer(CE8))
  local integer W89=GetPlayerId(GetOwningPlayer(W49))
  local integer B78
  local integer Count=0
  loop
    exitwhen i>5
    if IsSentinel(GetOwningPlayer(W49))then
      set B78=GetPlayerId(Sentinels[i])
    else
      set B78=GetPlayerId(Scourges[i])
    endif
    if W89!=B78 and V09(B78,W79)then
      set Count=Count+1
    endif
    set i=i+1
  endloop
  return Count
endfunction

function WG9 takes unit CE8,unit W49 returns boolean
  local integer i=1
  local integer W79=GetPlayerId(GetOwningPlayer(CE8))
  local integer W89=GetPlayerId(GetOwningPlayer(W49))
  local integer B78
  local string W99=" Assists: "
  local boolean WD9=false
  local integer x=1
  set Assists_Assisters[1]=null
  set Assists_Assisters[2]=null
  set Assists_Assisters[3]=null
  set Assists_Assisters[4]=null
  set Assists_Assisters[5]=null
  loop
    exitwhen i>5
    if IsSentinel(GetOwningPlayer(W49))then
      set B78=GetPlayerId(Sentinels[i])
    else
      set B78=GetPlayerId(Scourges[i])
    endif
    if W89!=B78 and V09(B78,W79)then
      set Assists_Assisters[x]=Player(B78)
      set x=x+1
      set WD9=true
    endif
    set i=i+1
  endloop
  return WD9
endfunction

function WH9 takes unit CE8,unit W49,real W98 returns nothing
  local integer i=1
  local integer Count=0
  call WG9(CE8,W49)
  loop
    exitwhen i>5
    if Assists_Assisters[i]!=null then
      set Count=Count+1
    endif
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>5
    if Assists_Assisters[i]!=null then
      set ReliableGold[GetPlayerId(Assists_Assisters[i])]=ReliableGold[GetPlayerId(Assists_Assisters[i])]+R2I(W98/ Count)
      call DistribGoldToPlayerForUnit(Assists_Assisters[i],R2I(W98/ Count),udg_Hero[GetPlayerId(Assists_Assisters[i])])
    endif
    set i=i+1
  endloop
endfunction

function RegisterCreepsDeath takes nothing returns nothing
  local integer id=GetUnitTypeId(GetTriggerUnit())
  if GetOwningPlayer(GetTriggerUnit())==NeutralsPlayer then
    set PlayerNeutralsCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerNeutralsCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
  elseif(id=='ugho')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  elseif(id=='unec')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  elseif(id=='esen')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  elseif(id=='edry')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  elseif(id=='u001')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  elseif(id=='u002')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  elseif(id=='e00V')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  elseif(id=='e00W')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  elseif(id=='ebal')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  elseif(id=='e026')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  elseif(id=='umtw')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  elseif(id=='u00R')then
    if(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit())))then
      set PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerDenyCounter[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    else
      set PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerCS[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
    endif
  endif
endfunction

function WK9 takes integer i returns nothing
  local integer x=1
  local integer y=1
  set Revive_WhichHero[i]=null
  set Revive_When[i]=0
  set Revive_isShallowGrave[i]=false
  loop
    exitwhen y>Revive_InQueue
    if Revive_When[y]!=0 then
      set Revive_TempUArray[x]=Revive_WhichHero[y]
      set Revive_TempRArray[x]=Revive_When[y]
      set Revive_TempBArray[x]=Revive_isShallowGrave[y]
      set Revive_WhichHero[y]=null
      set Revive_When[y]=0
      set Revive_isShallowGrave[y]=false
      set x=x+1
    endif
    set y=y+1
  endloop
  set Revive_InQueue=x-1
  set x=1
  loop
    exitwhen x>Revive_InQueue
    set Revive_WhichHero[x]=Revive_TempUArray[x]
    set Revive_When[x]=Revive_TempRArray[x]
    set Revive_isShallowGrave[x]=Revive_TempBArray[x]
    set x=x+1
  endloop
endfunction

function WM9 takes unit CE8 returns boolean
  return GetUnitTypeId(CE8)=='H00I' or GetUnitTypeId(CE8)=='H00J'
endfunction

function WN9 takes unit CE8 returns boolean
  local integer Cache=GetHandleId(GetOwningPlayer(CE8))
  local unit JJ9=(LoadUnitHandle(hashtable019,(Cache),(699)))
  local unit JK9=(LoadUnitHandle(hashtable019,(Cache),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(Cache),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(Cache),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(Cache),(703)))
  if GetUnitAbilityLevel(JJ9,'A0OV')!=0 or GetUnitAbilityLevel(JK9,'A0OV')!=0 or GetUnitAbilityLevel(JM9,'A0OV')!=0 or GetUnitAbilityLevel(JN9,'A0OV')!=0 or GetUnitAbilityLevel(JO9,'A0OV')!=0 then
    set JJ9=null
    set JK9=null
    set JM9=null
    set JN9=null
    set JO9=null
    return true
  endif
  set JJ9=null
  set JK9=null
  set JM9=null
  set JN9=null
  set JO9=null
  return false
endfunction

function WO9 takes unit CE8 returns boolean
  local integer i=0
  local integer Cache=GetHandleId(GetOwningPlayer(CE8))
  local unit JI9=(LoadUnitHandle(hashtable019,(Cache),(699)))
  loop
    exitwhen i>5
    if GetItemTypeId(UnitItemInSlot(JI9,i))==Item_Real[indexid_Aegis]and GetItemCharges(UnitItemInSlot(JI9,i))>0 then
      return true
    endif
    set i=i+1
  endloop
  set JI9=null
  return false
endfunction

function WP9 takes unit CE8,location WQ9 returns nothing
  local integer Cache=GetHandleId(GetOwningPlayer(CE8))
  local unit JJ9=(LoadUnitHandle(hashtable019,(Cache),(699)))
  local unit JK9=(LoadUnitHandle(hashtable019,(Cache),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(Cache),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(Cache),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(Cache),(703)))
  if JJ9!=null then
    call ReviveHeroLoc(JJ9,WQ9,true)
    call RemoveStuffFromHero(JJ9)
  endif
  if JK9!=null then
    call ReviveHeroLoc(JK9,WQ9,true)
    call RemoveStuffFromHero(JK9)
  endif
  if JM9!=null then
    call ReviveHeroLoc(JM9,WQ9,true)
    call RemoveStuffFromHero(JM9)
  endif
  if JN9!=null then
    call ReviveHeroLoc(JN9,WQ9,true)
    call RemoveStuffFromHero(JN9)
  endif
  if JO9!=null then
    call ReviveHeroLoc(JO9,WQ9,true)
    call RemoveStuffFromHero(JO9)
  endif
  set JJ9=null
  set JK9=null
  set JM9=null
  set JN9=null
  set JO9=null
endfunction

function CustomHeroRevive_GetTime takes nothing returns real
  return TimerGetElapsed(GlobalTimer)
endfunction

function WR9 takes unit Hero,real Time,boolean WS9 returns nothing
  set Revive_InQueue=Revive_InQueue+1
  set Revive_WhichHero[Revive_InQueue]=Hero
  set Revive_When[Revive_InQueue]=(TimerGetElapsed(GlobalTimer))+Time
  set Revive_isShallowGrave[Revive_InQueue]=WS9
endfunction

function WT9 takes integer i returns nothing
  local unit CE8=Revive_WhichHero[i]
  local boolean WS9=Revive_isShallowGrave[i]
  local player WU9=GetOwningPlayer(CE8)
  local location WQ9
  if IsScourge(WU9)then
    set WQ9=GetRectCenter(gg_rct_Hero_Creation_UD)
  else
    set WQ9=GetRectCenter(gg_rct_Hero_Creation_NE)
  endif
  if GameEnded==false and IsDead(CE8)then
    call J89(CE8,WU9,GetLocationX(WQ9),GetLocationY(WQ9),true)
    if WM9(CE8)==false or GetUnitAbilityLevel(CE8,'A0MW')==0 then
      call ReviveHeroLoc(CE8,WQ9,true)
    else
      call WP9(CE8,WQ9)
    endif
    call SetUnitState(CE8,UNIT_STATE_MANA,GetUnitState(CE8,UNIT_STATE_MAX_MANA))
  endif
  call RemoveLocation(WQ9)
  call WK9(i)
  set CE8=null
  set WU9=null
  set WQ9=null
endfunction

function WV9 takes nothing returns boolean
  local real UK8=(TimerGetElapsed(GlobalTimer))
  local integer i
  set i=1
  loop
    exitwhen i>Revive_InQueue
    if Revive_When[i]<UK8 and Revive_When[i]!=0 then
      call WT9(i)
    endif
    if Revive_When[i]!=0 and IsDead(Revive_WhichHero[i])==false then
      call WK9(i)
    endif
    set i=i+1
  endloop
  return false
endfunction

function WW9 takes unit WX9,unit WY9 returns nothing
  //if DistanceBetweenUnits(WX9,WY9)>1200 or(IsDead(WX9)and GetUnitTypeId(WX9)=='H00K')then
  
  //suicide experience
  if DistanceBetweenUnits(WX9,WY9)>1200 or(IsDead(WX9)and GetUnitAbilityLevel(WX9,'A06B')>0)then
    call AddHeroXP(WX9,GetExpForUnit(WY9),true)
  endif
endfunction

function WZ9 takes nothing returns boolean
  if(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitIllusion(GetFilterUnit())==false then
    if IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(TempUnit_BSCheck))and FindItemOfType(GetFilterUnit(),Item_Real[indexid_bloodstone])!=null then
      call SetItemCharges(FindItemOfType(GetFilterUnit(),Item_Real[indexid_bloodstone]),GetItemCharges(FindItemOfType(GetFilterUnit(),Item_Real[indexid_bloodstone]))+1)
    endif
  endif
  return false
endfunction

function Func1883 takes nothing returns boolean
  local item i
  local integer charges
  if TempInt_UrnsCount==0 and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitIllusion(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(TempUnit_UrnCheck))then
    set i = FindItemOfType(GetFilterUnit(),Item_Real[indexid_UrnOfShadows])
    if i!=null then
      set TempInt_UrnsCount=TempInt_UrnsCount+1
      set charges=GetItemCharges(i)
      if charges==0 then
        set charges=2
      else
        set charges=charges+1
      endif
      call SetItemCharges(i,charges)
    endif
    set i = null
  endif
  set i=null
  return false
endfunction

function AncientJangoo_FindNearbyHeroes takes nothing returns boolean
  local item i
  local integer charges
  if TempInt_JanggoesCount==0 and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitIllusion(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(TempUnit_UrnCheck))then
    if FindItemOfType(GetFilterUnit(),Item_Real[indexid_janggo])!=null then
      set TempInt_JanggoesCount=TempInt_JanggoesCount+1
      set charges=GetItemCharges(FindItemOfType(GetFilterUnit(),Item_Real[indexid_janggo]))
      set charges=IMinBJ(charges+1,5)
      call SetItemCharges(FindItemOfType(GetFilterUnit(),Item_Real[indexid_janggo]),charges)
    endif
  endif
  set i=null
  return false
endfunction

function WB9 takes unit u returns nothing
  local group g=GetAvailableGroup()
  set TempUnit_BSCheck=u
  call GroupEnumUnitsInRange(g,GetUnitX(u),GetUnitY(u),1625,Condition(function WZ9))
  call KillGroup(g)
  set g=null
endfunction

function WC9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit W39=(LoadUnitHandle(hashtable019,(Cache),(335)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real x
  local real y
  local real a
  if GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if GetTriggerUnit()!=W39 then
      call KillUnit(W39)
    endif
  else
    set a=GetUnitFacing(Target)*bj_RADTODEG
    set x=GetUnitX(Target)+75
    set y=GetUnitY(Target)+75
    call SetUnitX(W39,x)
    call SetUnitY(W39,y)
    call IssueTargetOrderById(W39,851983,Target)
  endif
  set t=null
  set W39=null
  set Target=null
  return false
endfunction

function W69 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit W39
  if GetSummoningUnit()==Caster then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    set W39=GetSummonedUnit()
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterDeathEvent(t,W39)
    call TriggerRegisterDeathEvent(t,Target)
    call TriggerRegisterTimerEvent(t,.05,true)
    call TriggerAddCondition(t,Condition(function WC9))
    call SaveUnitHandle(hashtable019,(Cache),(335),(W39))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call UnitAddAbility(W39,'Aloc')
    call SetUnitPosition(W39,GetUnitX(Target)+100,GetUnitY(Target)+100)
    call IssueTargetOrderById(W39,851983,Target)
    call SetUnitMoveSpeed(W39,522)
  endif
  set t=null
  set Target=null
  set Source=null
  set Caster=null
  set W39=null
  return false
endfunction

function WL9 takes unit Source,unit W19 returns nothing
  local unit Target=W19
  local unit Caster
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  if WC8(Target)then
    set Target=(udg_Hero[GetPlayerId(GetOwningPlayer((Target)))])
  endif
  set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function W69))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call UnitAddAbility2(Caster,'A2E7')
  call IssueTargetOrderById(Caster,852274,Target)
  set t=null
  set Target=null
  set Caster=null
endfunction

function W09 takes nothing returns boolean
  if(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitIllusion(GetFilterUnit())==false then
    if IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(TempUnit_BSCheck))==false and FindItemOfType(GetFilterUnit(),Item_Real[indexid_BladeOfTheReaper])!=null then
    endif
  endif
  return false
endfunction

function W59 takes unit u returns nothing
  local group g=GetAvailableGroup()
  set TempUnit_BSCheck=u
  call GroupEnumUnitsInRange(g,GetUnitX(u),GetUnitY(u),1625,Condition(function W09))
  call KillGroup(g)
  set g=null
endfunction

function W29 takes unit u returns nothing
  local group g=GetAvailableGroup()
  set TempInt_UrnsCount=0
  set TempUnit_UrnCheck=u
  call GroupEnumUnitsInRange(g,GetUnitX(u),GetUnitY(u),1425,Condition(function Func1883))
  call KillGroup(g)
  set TempInt_UrnsCount=0
  set g=null
endfunction

function X49 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer X79=(LoadInteger(hashtable019,(Cache),(88)))
  local integer i=1
  local player p
  local string TR8
  loop
    exitwhen i>5
    if X79==0 then
      set p=Sentinels[i]
      set TR8=udg_Colors[GetPlayerId(Sentinels[0])]+GetObjectName('n03N')+"|r "+GetObjectName('n03P')+" "+udg_Colors[GetPlayerId(Sentinels[0])]+GetObjectName('n03Q')+"|r"
    else
      set p=Scourges[i]
      set TR8=udg_Colors[GetPlayerId(Scourges[0])]+GetObjectName('n03O')+"|r "+GetObjectName('n03P')+" "+udg_Colors[GetPlayerId(Scourges[0])]+GetObjectName('n03Q')+"|r"
    endif
    call DisplayTimedTextToPlayer(p,0,0,10,TR8)
    call BY8(WD,p)
    set i=i+1
  endloop
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set p=null
  return false
endfunction

function X89 takes integer X79 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,1.5,false)
  call TriggerAddCondition(t,Condition(function X49))
  call SaveInteger(hashtable019,(Cache),(88),(X79))
  set t=null
endfunction

function Func4996 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XD9=(LoadInteger(hashtable019,(Cache),(89)))
  local string TR8=(LoadStr(hashtable019,(Cache),(90)))
  local integer PlayerId=LoadInteger(hashtable019,'0SND','0PID')
  if XD9==1 then
    call BX8(boolean019)
  elseif XD9==2 then
    call BX8(UD)
  elseif XD9==3 then
    call BX8(JE)
  elseif XD9==4 then
    call BX8(KE)
  endif
  call DisplayTimedTextToForceEx(AllPlayers,10.,TR8)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function Func4475 takes string TR8,integer XD9 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,1.5,false)
  call TriggerAddCondition(t,Condition(function Func4996))
  call SaveStr(hashtable019,(Cache),(90),(TR8))
  call SaveInteger(hashtable019,(Cache),(89),(XD9))
  set t=null
endfunction

function XF9 takes player C98,integer CD8 returns nothing
  local integer VT8=1
  local integer IC9
  if IsSentinel(C98)then
    set IC9=CountPlayersInForce(Force_SentPlayers)
  else
    set IC9=CountPlayersInForce(Force_ScourgePlayers)
  endif
  if IsSentinel(C98)then
    loop
      exitwhen VT8>5
      if IsPlayer(Sentinels[VT8])then
        set ReliableGold[GetPlayerId(Sentinels[VT8])]=ReliableGold[GetPlayerId(Sentinels[VT8])]+CD8/ IC9
        call DistribGoldToPlayerForUnit(Sentinels[VT8],CD8/ IC9,udg_Hero[GetPlayerId(Sentinels[VT8])])
      endif
      set VT8=VT8+1
    endloop
  else
    loop
      exitwhen VT8>5
      if IsPlayer(Scourges[VT8])then
        set ReliableGold[GetPlayerId(Scourges[VT8])]=ReliableGold[GetPlayerId(Scourges[VT8])]+CD8/ IC9
        call DistribGoldToPlayerForUnit(Scourges[VT8],CD8/ IC9,udg_Hero[GetPlayerId(Scourges[VT8])])
      endif
      set VT8=VT8+1
    endloop
  endif
endfunction

function Func5400 takes unit CE8,integer Func3388 returns nothing
  local player WU9=GetOwningPlayer(CE8)
  call SetPlayerState(WU9,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(WU9,PLAYER_STATE_RESOURCE_GOLD)-Func3388)
  set WU9=null
endfunction

function Func5402 takes nothing returns boolean
  if GetUnitTypeId(GetFilterUnit())=='o003' then
    call KillUnit(GetFilterUnit())
    return true
  endif
  return false
endfunction

function XJ9 takes nothing returns nothing
  local boolexpr VH9=Condition(function Func5402)
  local group HQ9=GetAvailableGroup()
  call GroupEnumUnitsInRect(HQ9,bj_mapInitialPlayableArea,VH9)
  call KillGroup(HQ9)
  set HQ9=null
  set VH9=null
endfunction

function Func5518 takes nothing returns boolean
  if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) and LoadBoolean(hashtable019,GetHandleId(GetTriggerUnit()),StringHash("tempest"))==false then
    if GetUnitTypeId(GetTriggerUnit())=='H00J' and WO9(GetTriggerUnit()) then
      return false
    endif
    return true
  endif
  return false
endfunction

function XM9 takes unit W49,player WU9,player C98 returns boolean
  return W49==null or(IsSentinel(WU9)and IsSentinel(C98))or(IsScourge(WU9)and IsScourge(C98))
endfunction

function XN9 takes nothing returns nothing
  if(GetUnitTypeId((GetEnumUnit()))=='H00J')==false then
    set AssistersAllGlobalCounter=AssistersAllGlobalCounter+1
    if GetOwningPlayer(GetKillingUnit())!=GetOwningPlayer(GetEnumUnit())then
      set AssistersAllWOKillerGlobalCounter=AssistersAllWOKillerGlobalCounter+1
    endif
  endif
endfunction

function Func4806 takes nothing returns nothing
  if(GetUnitTypeId((GetEnumUnit()))=='H00J')==false then
    call AddHeroXP(GetEnumUnit(),AssistBonusesExpGlobal,true)
    set AssistsBonusExpCounter[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=AssistsBonusExpCounter[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+AssistBonusesExpGlobal
    if GetOwningPlayer(GetKillingUnit())!=GetOwningPlayer(GetEnumUnit())then
      set AssistsBonusGoldCounter[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=AssistsBonusGoldCounter[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+AssistBonusesGoldGlobal
      set ReliableGold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=ReliableGold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+AssistBonusesGoldGlobal
      call DistribGoldToPlayerForUnit(GetOwningPlayer(GetEnumUnit()),AssistBonusesGoldGlobal,GetEnumUnit())
    endif
  endif
endfunction

function AssistBonusesDistrib takes nothing returns boolean
  local integer Level
  local integer xpbonus=0
  local integer gbonus=0
  local group g
  if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) and IsUnitIllusion(GetTriggerUnit())==false and(GetUnitTypeId(GetTriggerUnit())=='H00J')==false and LoadBoolean(hashtable019,GetHandleId(GetTriggerUnit()),StringHash("tempest"))==false then
    set Level=GetHeroLevel(GetTriggerUnit())
    set AssistBonusesExpGlobal=0
    set AssistBonusesGoldGlobal=0
    set g=GetAvailableGroup()
    set AssistersAllGlobalCounter=0
    set AssistersAllWOKillerGlobalCounter=0
    call GroupEnumUnitsInRange(g,GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),1225,Condition(function D89))
    call ForGroup(g,function XN9)
    if AssistersAllGlobalCounter==1 then
      set xpbonus=20*Level+120
    elseif AssistersAllGlobalCounter==2 then
      set xpbonus=15*Level+90
    elseif AssistersAllGlobalCounter==3 then
      set xpbonus=7*Level+30
    elseif AssistersAllGlobalCounter==4 then
      set xpbonus=5*Level+20
    elseif AssistersAllGlobalCounter==5 then
      set xpbonus=4*Level+15
    endif
    if AssistersAllWOKillerGlobalCounter==1 then
      set gbonus=9*Level+95
    elseif AssistersAllWOKillerGlobalCounter==2 then
      set gbonus=8*Level+20
    elseif AssistersAllWOKillerGlobalCounter==3 then
      set gbonus=6*Level
    elseif AssistersAllWOKillerGlobalCounter==4 then
      set gbonus=6*Level
    elseif AssistersAllWOKillerGlobalCounter==5 then
      set gbonus=6*Level
    endif
    if Mode_EM then
    endif
    set AssistBonusesExpGlobal=xpbonus
    set AssistBonusesGoldGlobal=gbonus
    call ForGroup(g,function Func4806)
    call KillGroup(g)
    set g=null
  endif
  set g=null
  return false
endfunction

function XS9 takes nothing returns nothing
  local boolean isNonPvsPKill=false
  local unit Victim=GetDyingUnit()
  local unit Killer=GetKillingUnit()
  local player PKiller=GetOwningPlayer(Killer)
  local player PVictim=GetOwningPlayer(Victim)
  local integer GoldReward=0
  local integer GoldPenalty=0
  local boolean isKillerBelongToPlayers=false
  local string tmpStoppedStreakString=""
  local string tmpStreakString=""
  local string assistsStringVar=""
  local integer tmpCurStreakOfKiller
  local string DyingPlayerName
  local string KillingPlayerName
  local string resultingStrngOfKill
  local string GoldRewardStr
  local boolean ShallowGraveStatus=false
  local real ShallowGraveRespTimeMultiplier=1
  local real UnknownRespTimeMultiplier1=1
  local real UnknownRespTimeMultiplier2=1
  local real TechiesSuicideRespTimeMultiplier=1
  local real BloodstoneRespTimeBonus=0
  local trigger t
  local integer RespTime
  local integer AssistantCounter
  local integer unittypeId
  local integer DyingUnitOwnerGold=GetPlayerState(PVictim,PLAYER_STATE_RESOURCE_GOLD)
  local integer DyingUnitOwnerUnreliableGold=DyingUnitOwnerGold-ReliableGold[GetPlayerId(PVictim)]
  local unit tmpKillingUnit
  local unit tmpDyingUnit
  local string Y99
  local boolean KilledByReaper=LoadInteger(hashtable019,GetHandleId(Victim),4418)==1
  local item it
  if KilledByReaper then
    set IsImpossibleToBuyback[GetPlayerId(PVictim)]=true
  endif
  if LoadInteger(hashtable019,GetHandleId(Victim),4333)==1 then
    set Killer=udg_Hero[GetPlayerId(LoadPlayerHandle(hashtable019,GetHandleId(Victim),4333))]
    set PKiller=GetOwningPlayer(Killer)
  endif
  if Killer==null and LoadInteger(hashtable019,GetHandleId(Victim),4500)==1 then
    set Killer=OH8
    set PKiller=GetOwningPlayer(Killer)
  endif
  set AssistantCounter=WF9(Victim,Killer)
  if Killer!=null then
    set unittypeId=GetUnitTypeId(Killer)
    call WW9(udg_Hero[GetPlayerId(GetOwningPlayer(Killer))],Victim)
  endif
  if IsPlayerAlly(PKiller,PVictim)==true and((LoadInteger(hashtable019,GetHandleId(Killer),4328))==1)==true and unit_WinterCurseCaster!=null then
    set Killer=unit_WinterCurseCaster
    set PKiller=GetOwningPlayer(Killer)
  endif
  if XM9(Killer,PVictim,PKiller)==false and AssistantCounter==1 and IsPlayerBelongToTeams(PKiller)==false and PKiller!=NeutralsPlayer then
    call WG9(Victim,Killer)
    set PKiller=Assists_Assisters[1]
    set Killer=udg_Hero[GetPlayerId(PKiller)]
  endif
  set IsHeroDead[GetPlayerId(GetOwningPlayer((Victim)))]=true
  if GetUnitAbilityLevel(Victim,'A0OV')!=0 or(WM9(Victim)and WN9(Victim))then
    set ShallowGraveStatus=true
    call UnitRemoveAbility(Victim,'A0OV')
    set TmpUnit376=Victim
    if IsUnitType(Killer,UNIT_TYPE_STRUCTURE)==false then
    endif
  endif
  if PKiller==null then
    set PKiller=PVictim
  endif
  if GetUnitAbilityLevel(Killer,'Aloc')>0 then
    set Killer=udg_Hero[GetPlayerId(PKiller)]
  endif
  if IsPlayerAlly(PKiller,PVictim)==false and PKiller!=Player(12) then//if enemy and non-neutrals
    call AssistBonusesDistrib()
  endif
  if Mode_ID and GetUnitTypeId(Victim)!='H00J' then
    set it=UnitRemoveItemFromSlot(Victim,GetRandomInt(0,5))
    if GetItemTypeId(it)=='I00K' then
      call CreateItem('I00G',GetItemX(it),GetItemY(it))
      call RemoveItem(it)
    endif
    set it=null
  endif
  if IsSentinel(PVictim)then
    if IsSentinel(PKiller)then
      set isNonPvsPKill=true
      if(PKiller==PVictim)then
        call DisplayTimedTextToForceEx(AllPlayers,10.,(udg_Colors[GetPlayerId(PVictim)]+(IL7[GetPlayerId((PVictim))])+"|r "+GetObjectName('n03R')))
      else
        call DisplayTimedTextToForceEx(AllPlayers,10.,F09(PVictim,PKiller))
      endif
    elseif IsScourge(PKiller)then
      set isKillerBelongToPlayers=true
      set GlobalDeathCounter[GetPlayerId(Sentinels[0])]=GlobalDeathCounter[GetPlayerId(Sentinels[0])]+1
      set GlobalKillsCounter[GetPlayerId(Scourges[0])]=GlobalKillsCounter[GetPlayerId(Scourges[0])]+1
      set OwnageCounters[2]=OwnageCounters[2]+1
      set OwnageCounters[1]=0
      if PKiller!=Scourges[0]then
        set GlobalKillsCounter[GetPlayerId(PKiller)]=GlobalKillsCounter[GetPlayerId(PKiller)]+1
        set PlayerKillsStreak[GetPlayerId(PKiller)]=PlayerKillsStreak[GetPlayerId(PKiller)]+1
      endif
    endif
  endif
  if IsScourge(PVictim)then
    if IsScourge(PKiller)then
      set isNonPvsPKill=true
      if(PKiller==PVictim)then
        call DisplayTimedTextToForceEx(AllPlayers,10.,(udg_Colors[GetPlayerId(PVictim)]+(IL7[GetPlayerId((PVictim))])+"|r "+GetObjectName('n03R')))
      else
        call DisplayTimedTextToForceEx(AllPlayers,10.,F09(PVictim,PKiller))
      endif
    elseif IsSentinel(PKiller)then
      set isKillerBelongToPlayers=true
      set GlobalDeathCounter[GetPlayerId(Scourges[0])]=GlobalDeathCounter[GetPlayerId(Scourges[0])]+1
      set GlobalKillsCounter[GetPlayerId(Sentinels[0])]=GlobalKillsCounter[GetPlayerId(Sentinels[0])]+1
      set OwnageCounters[1]=OwnageCounters[1]+1
      set OwnageCounters[2]=0
      if PKiller!=Sentinels[0]then
        set GlobalKillsCounter[GetPlayerId(PKiller)]=GlobalKillsCounter[GetPlayerId(PKiller)]+1
        set PlayerKillsStreak[GetPlayerId(PKiller)]=PlayerKillsStreak[GetPlayerId(PKiller)]+1
      endif
    endif
  endif
  if PKiller==NeutralsPlayer then
    set isKillerBelongToPlayers=false
    if GetUnitTypeId(Killer)=='n00L' then
      call DisplayTimedTextToForceEx(AllPlayers,10.,(udg_Colors[GetPlayerId(PVictim)]+(IL7[GetPlayerId((PVictim))])+"|r "+GetObjectName('n03T')))
    else
      call DisplayTimedTextToForceEx(AllPlayers,10.,(udg_Colors[GetPlayerId(PVictim)]+(IL7[GetPlayerId((PVictim))])+"|r "+GetObjectName('n03U')))
    endif
    set isNonPvsPKill=true
  endif
  if IsRemoveMinesBlast then
    call PlaySoundAtPos(Sound_TechiesLaugh,GetUnitX(Victim),GetUnitY(Victim))
  endif
  call Traffic_RegisterData("Hero"+I2S(GetPlayerId(PVictim)),GetPlayerId(PKiller))
  set tmpCurStreakOfKiller=PlayerKillsStreak[GetPlayerId(PVictim)]
  if tmpCurStreakOfKiller>2 and isNonPvsPKill==false then
    if tmpCurStreakOfKiller==3 then
      set GoldReward=125
      set tmpStoppedStreakString="|c0000ff40"+GetObjectName('n04L')+"|r"
    elseif tmpCurStreakOfKiller==4 then
      set GoldReward=250
      set tmpStoppedStreakString="|c00400080"+GetObjectName('n04N')+"|r"
    elseif tmpCurStreakOfKiller==5 then
      set GoldReward=375
      set tmpStoppedStreakString="|c00ff0080"+GetObjectName('n04M')+"|r"
    elseif tmpCurStreakOfKiller==6 then
      set GoldReward=500
      set tmpStoppedStreakString="|c00ff8000"+GetObjectName('n04J')+"|r"
    elseif tmpCurStreakOfKiller==7 then
      set GoldReward=625
      set tmpStoppedStreakString="|c00808000"+GetObjectName('n04I')+"|r"
    elseif tmpCurStreakOfKiller==8 then
      set GoldReward=750
      set tmpStoppedStreakString="|c00ff80ff"+GetObjectName('n03V')+"|r"
    elseif tmpCurStreakOfKiller==9 then
      set GoldReward=875
      set tmpStoppedStreakString="|c00ff0000"+GetObjectName('n03W')+"|r"
    elseif tmpCurStreakOfKiller>=10 then
      set GoldReward=1000
      set tmpStoppedStreakString="|c00ff8000"+GetObjectName('n03X')+"|r"
    endif
  endif
  set tmpCurStreakOfKiller=PlayerKillsStreak[GetPlayerId(PKiller)]
  if tmpCurStreakOfKiller>PlayerBestStreak[GetPlayerId(PKiller)]then
    set PlayerBestStreak[GetPlayerId(PKiller)]=tmpCurStreakOfKiller
  endif
  set tmpKillingUnit=Killer
  if IsUnitType(tmpKillingUnit,UNIT_TYPE_HERO)==false then
    set tmpKillingUnit=udg_Hero[GetPlayerId(GetOwningPlayer(tmpKillingUnit))]
  endif
  if tmpCurStreakOfKiller>2 and GetUnitTypeId(tmpKillingUnit)!='U00F' and AM7[GetPlayerId(GetOwningPlayer(tmpKillingUnit))]==0 then
  endif
  set tmpDyingUnit=Victim
  if IsUnitType(tmpDyingUnit,UNIT_TYPE_HERO)==false then
    set tmpDyingUnit=udg_Hero[GetPlayerId(GetOwningPlayer(tmpDyingUnit))]
  endif
  if isNonPvsPKill==false and isKillerBelongToPlayers then
  endif
  if tmpCurStreakOfKiller>2 and isNonPvsPKill==false then
    if tmpCurStreakOfKiller==3 then
      call BX8(boolean022)
      set Y99=GetObjectName('n04L')
      set tmpStreakString=" "+GetObjectName('n04K')+" |c0000ff40"+Y99+"|r"+GetObjectName('n049')
    elseif tmpCurStreakOfKiller==4 then
      call BX8(DC)
      set Y99=GetObjectName('n04N')
      set tmpStreakString=" "+GetObjectName('n04H')+" |c00400080"+Y99+"|r"+GetObjectName('n049')
    elseif tmpCurStreakOfKiller==5 then
      call BX8(TC)
      set Y99=GetObjectName('n04M')
      set tmpStreakString=" "+GetObjectName('n04G')+" |c00ff0080"+Y99+"|r"+GetObjectName('n049')
    elseif tmpCurStreakOfKiller==6 then
      call BX8(BE)
      set Y99=GetObjectName('n04J')
      set tmpStreakString=" "+GetObjectName('n04H')+" |c00ff8000"+Y99+"|r"+GetObjectName('n04A')
    elseif tmpCurStreakOfKiller==7 then
      call BX8(integer008)
      set Y99=GetObjectName('n04I')
      set tmpStreakString=" "+GetObjectName('n04H')+" |c00808000"+Y99+"|r"+GetObjectName('n04A')
    elseif tmpCurStreakOfKiller==8 then
      call BX8(boolean024)
      set Y99=GetObjectName('n03V')
      set tmpStreakString=" "+GetObjectName('n04G')+" |c00ff80ff"+Y99+"|r"+GetObjectName('n04A')
    elseif tmpCurStreakOfKiller==9 then
      call BX8(ZC)
      set Y99=GetObjectName('n03W')
      set tmpStreakString=" "+GetObjectName('n04H')+" |c00ff0000"+Y99+"|r"+GetObjectName('n04B')
    elseif tmpCurStreakOfKiller>=10 then
      call BX8(WC)
      set tmpStreakString=" "+GetObjectName('n04H')+" |c00ff8000"+GetObjectName('n03X')+"|r. "+GetObjectName('n04F')+GetObjectName('n04B')
    endif
  endif
  if isNonPvsPKill==false then
    set GoldReward=GoldReward+100+GetHeroLevel(Victim)*5+100
    set DyingPlayerName=udg_Colors[GetPlayerId(PVictim)]+(IL7[GetPlayerId((PVictim))])+"|r"
    set KillingPlayerName=udg_Colors[GetPlayerId(PKiller)]+(IL7[GetPlayerId((PKiller))])+"|r"
    set GoldRewardStr="|c00FFDC00"+I2S(GoldReward)+"|r"
    if PKiller==Sentinels[0]or PKiller==Scourges[0]then
      if AssistantCounter==0 then
        if PKiller==Sentinels[0]then
          set resultingStrngOfKill=KillingPlayerName+" "+GetObjectName('n042')+" "+DyingPlayerName+GetObjectName('n043')+GetObjectName('n049')+" "+GoldRewardStr+" "+GetObjectName('n044')+"."
          call XF9(PKiller,GoldReward)
        elseif PKiller==Scourges[0]then
          set resultingStrngOfKill=KillingPlayerName+" "+GetObjectName('n042')+" "+DyingPlayerName+GetObjectName('n043')+GetObjectName('n049')+" "+GoldRewardStr+" "+GetObjectName('n044')+"."
          call XF9(PKiller,GoldReward)
        endif
      elseif AssistantCounter>1 then
        set resultingStrngOfKill=KillingPlayerName+" "+GetObjectName('n042')+" "+DyingPlayerName+GetObjectName('n043')+GetObjectName('n049')+" "+GoldRewardStr+" "+GetObjectName('n044')+"."
        call WH9(Victim,Killer,GoldReward)
      endif
    elseif tmpStoppedStreakString==""and tmpStreakString==""then
      set resultingStrngOfKill=KillingPlayerName+" "+GetObjectName('n042')+" "+DyingPlayerName+GetObjectName('n043')+" "+GetObjectName('n04C')+" "+GoldRewardStr+" "+GetObjectName('n045')+GetObjectName('n049')
    elseif tmpStoppedStreakString==""and tmpStreakString!=""then
      set resultingStrngOfKill=KillingPlayerName+" "+GetObjectName('n042')+" "+DyingPlayerName+GetObjectName('n043')+" "+GetObjectName('n04C')+" "+GoldRewardStr+" "+GetObjectName('n045')+GetObjectName('n049')
    elseif tmpStoppedStreakString!=""and tmpStreakString==""then
      set resultingStrngOfKill=KillingPlayerName+" "+GetObjectName('n048')+" "+DyingPlayerName+GetObjectName('n047')+" "+tmpStoppedStreakString+" "+GetObjectName('n046')+" "+GoldRewardStr+" "+GetObjectName('n045')+GetObjectName('n049')
    elseif tmpStoppedStreakString!=""and tmpStreakString!=""then
      set resultingStrngOfKill=KillingPlayerName+" "+GetObjectName('n048')+" "+DyingPlayerName+GetObjectName('n047')+" "+tmpStoppedStreakString+" "+GetObjectName('n046')+" "+GoldRewardStr+" "+GetObjectName('n045')+GetObjectName('n049')
    endif
    if isKillerBelongToPlayers then
      set assistsStringVar=V29(Victim,Killer)
    endif
    call DisplayTimedTextToForceEx(AllPlayers,10,resultingStrngOfKill+assistsStringVar)
    if tmpStreakString!=""then
      call DisplayTimedTextToForceEx(AllPlayers,10,KillingPlayerName+tmpStreakString)
    endif
    set ReliableGold[GetPlayerId(PKiller)]=ReliableGold[GetPlayerId(PKiller)]+GoldReward
    call DistribGoldToPlayerForUnit(PKiller,GoldReward,Victim)
    set GoldEarnedByKills[GetPlayerId(PKiller)]=GoldEarnedByKills[GetPlayerId(PKiller)]+GoldReward
    if OwnageCounters[1]>4 then
      call X89(0)
    endif
    if OwnageCounters[2]>4 then
      call X89(1)
    endif
  endif
  set GoldPenalty=GetHeroLevel(Victim)*30
  if FindItemOfType(Victim,Item_Real[indexid_bloodstone])!=null then
    if GetItemCharges(FindItemOfType(Victim,Item_Real[indexid_bloodstone]))>0 then
      set BloodstoneRespTimeBonus=-1*(4*GetItemCharges(FindItemOfType(Victim,Item_Real[indexid_bloodstone])))
      set GoldPenalty=IMaxBJ(R2I(GoldPenalty-25*GetItemCharges(FindItemOfType(Victim,Item_Real[indexid_bloodstone]))),0)
    endif
  endif
  
  
  if GoldPenalty>DyingUnitOwnerUnreliableGold then
    set GoldPenalty=DyingUnitOwnerUnreliableGold
  endif
  call WB9(Victim)
  if FindItemOfType(Killer,Item_Real[indexid_bloodstone])!=null and DistanceBetweenUnits(Killer,Victim)>1600 then//[lich] bloodstone out of range
    call SetItemCharges(FindItemOfType(Killer,Item_Real[indexid_bloodstone]),GetItemCharges(FindItemOfType(Killer,Item_Real[indexid_bloodstone]))+1)
  endif
  call W29(Victim)
  call W59(Victim)
  if ShallowGraveStatus==false then
    set PlayerGoldCash[GetPlayerId(PVictim)]=PlayerGoldCash[GetPlayerId(PVictim)]+GoldPenalty
    call Func5400(Victim,GoldPenalty)
  endif
  call SaveInteger(hashtable019,(400+GetPlayerId(PKiller)),(450+GetPlayerId(PVictim)),((LoadInteger(hashtable019,(400+GetPlayerId(PKiller)),(450+GetPlayerId(PVictim))))+1))
  call SaveInteger(hashtable019,(400+GetPlayerId(PVictim)),(500+GetPlayerId(PKiller)),((LoadInteger(hashtable019,(400+GetPlayerId(PVictim)),(500+GetPlayerId(PKiller))))+1))
  call StartTimerBJ(MultikillTimers[GetPlayerId(PKiller)],false,18)
  if isNonPvsPKill==false and PKiller!=Sentinels[0]and PKiller!=Scourges[0]and PKiller!=NeutralsPlayer then
    set MultikillCounter[GetPlayerId(PKiller)]=MultikillCounter[GetPlayerId(PKiller)]+1
    if MultikillCounter[GetPlayerId(PKiller)]==2 then
      set DoubleKillsCounter[GetPlayerId(PKiller)]=DoubleKillsCounter[GetPlayerId(PKiller)]+1
      call SaveInteger(hashtable019,'0SND','0PID',GetPlayerId(PKiller))
      set Y99=GetObjectName('n04S')
      call Func4475(udg_Colors[GetPlayerId(PKiller)]+(IL7[GetPlayerId((PKiller))])+"|r "+GetObjectName('n04D')+" |c000000ff"+Y99+"|r"+GetObjectName('n049'),1)
    endif
    if MultikillCounter[GetPlayerId(PKiller)]==3 then
      set TrippleKillsCounter[GetPlayerId(PKiller)]=TrippleKillsCounter[GetPlayerId(PKiller)]+1
      call SaveInteger(hashtable019,'0SND','0PID',GetPlayerId(PKiller))
      set Y99=GetObjectName('n04E')
      call Func4475(udg_Colors[GetPlayerId(PKiller)]+(IL7[GetPlayerId((PKiller))])+"|r "+GetObjectName('n04D')+" |c0000ff40"+Y99+"|r"+GetObjectName('n04B'),2)
    endif
    if MultikillCounter[GetPlayerId(PKiller)]==4 then
      set TrippleKillsCounter[GetPlayerId(PKiller)]=TrippleKillsCounter[GetPlayerId(PKiller)]+1
      call SaveInteger(hashtable019,'0SND','0PID',GetPlayerId(PKiller))
      set Y99=GetObjectName('n0HJ')
      call Func4475(udg_Colors[GetPlayerId(PKiller)]+(IL7[GetPlayerId((PKiller))])+"|r "+GetObjectName('n04D')+" |c0000FFFF"+Y99+"|r"+GetObjectName('n04B'),3)
    endif
    if MultikillCounter[GetPlayerId(PKiller)]>4 then
      set TrippleKillsCounter[GetPlayerId(PKiller)]=TrippleKillsCounter[GetPlayerId(PKiller)]+1
      call SaveInteger(hashtable019,'0SND','0PID',GetPlayerId(PKiller))
      set Y99=GetObjectName('n0HK')
      call Func4475(udg_Colors[GetPlayerId(PKiller)]+(IL7[GetPlayerId((PKiller))])+"|r "+GetObjectName('n04K')+" |c0000AAFF"+Y99+"|r"+GetObjectName('n04B'),4)
    endif
  endif
  if(isNonPvsPKill==false)then
    set PlayerKillsStreak[GetPlayerId(PVictim)]=0
  endif
  set PlayerKillsStreak[0]=0
  set PlayerKillsStreak[6]=0
  set GlobalDeathCounter[GetPlayerId(PVictim)]=GlobalDeathCounter[GetPlayerId(PVictim)]+1
  if ShallowGraveStatus then
    set ShallowGraveRespTimeMultiplier=.4
  endif
  
  //if isNonPvsPKill and GetUnitTypeId(Victim)=='H00K' then
  //suicide death reduction
  if isNonPvsPKill and GetUnitAbilityLevel(Victim,'A06B')>0 then
    set TechiesSuicideRespTimeMultiplier=.5
  endif
  
  set RespTime=R2I(((GetHeroLevel(Victim)*4)+R2I(LoadReal(HeroStats,GetHandleId(Victim),26)))*TechiesSuicideRespTimeMultiplier)+R2I(BloodstoneRespTimeBonus)
  if Mode_FR then
    set RespTime=R2I(RespTime*.5)
  endif
  if CL then
    set PlayerTimeDead[GetPlayerId(PVictim)]=0
    call TimerStart(HeroRespawnTimer[GetPlayerId(PVictim)],1.,false,null)
  else
    set PlayerTimeDead[GetPlayerId(PVictim)]=PlayerTimeDead[GetPlayerId(PVictim)]+RespTime
    call TimerStart(HeroRespawnTimer[GetPlayerId(PVictim)],RespTime,false,null)
  endif
  call TriggerExecute(trigger021)
  if Mode_DM==false then
    call WR9(Victim,RespTime,ShallowGraveStatus)
  else
    if(IsSentinel(PVictim))then
      set DeathmatchKillsCounter[0]=DeathmatchKillsCounter[0]+1
    endif
    if IsScourge(PVictim)then
      set DeathmatchKillsCounter[1]=DeathmatchKillsCounter[1]+1
    endif
    set real011[GetPlayerId(PVictim)]=Victim
    if GetUnitTypeId(Victim)=='H00J' then
      set real011[GetPlayerId(PVictim)]=(LoadUnitHandle(hashtable019,(GetHandleId(GetOwningPlayer(Victim))),(699)))
    endif
    if DeathmatchKillsCounter[0]==DL then
      call TriggerExecute(trigger025)
    endif
    if DeathmatchKillsCounter[1]==DL then
      call TriggerExecute(trigger024)
    endif
    if(GetUnitTypeId(Victim)=='U006')then
      call ExeFunc("XJ9")
    elseif GetUnitTypeId(Victim)=='U008' or GetUnitTypeId(Victim)=='E015' then
      set VK=Victim
      call ExeFunc("YD9")
    elseif GetUnitTypeId(Victim)=='Ucrl' then
      set VK=Victim
      call ExeFunc("YE9")
    endif
  endif
  set Victim=null
  set Killer=null
  set PKiller=null
  set PVictim=null
  set t=null
  set tmpKillingUnit=null
  set tmpDyingUnit=null
endfunction

function YF9 takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local player C98=GetOwningPlayer(GetKillingUnit())
  local player WU9=GetOwningPlayer(GetTriggerUnit())
  local string TR8
  local integer Func4148=WF9(GetTriggerUnit(),GetKillingUnit())
  local integer lc=1
  local integer PlayerId
  local string Y99
  if C98==Sentinels[0]or C98==Scourges[0]then
    call WH9(GetTriggerUnit(),GetKillingUnit(),200)
    set TR8=WE9(GetTriggerUnit(),GetKillingUnit())+" "+GetObjectName('n04W')+" |c00ff0303"+GetObjectName('n04Y')+GetObjectName('n049')+"|r "
    if Func4148>1 then
      set TR8=TR8+"(+200 "+GetObjectName('n044')+")"
    else
      set TR8=TR8+"(+200 "+GetObjectName('n045')+")"
    endif
    loop
      exitwhen lc>5
      if IsSentinel(GetOwningPlayer(GetKillingUnit()))then
        set PlayerId=GetPlayerId(Sentinels[lc])
      else
        set PlayerId=GetPlayerId(Scourges[lc])
      endif
      set lc=lc+1
    endloop
  else
    set PlayerId=GetPlayerId((C98))
    set Y99=GetObjectName('n04Y')
    set TR8=udg_Colors[GetPlayerId(C98)]+(IL7[GetPlayerId((C98))])+"|r "+GetObjectName('n04W')+" |c00ff0303"+Y99+GetObjectName('n049')+"|r "
    set TR8=TR8+"(+200 "+GetObjectName('n045')+")"
    call DistribGoldToPlayerForUnit(C98,200,udg_Hero[GetPlayerId(C98)])
    set ReliableGold[GetPlayerId(C98)]=ReliableGold[GetPlayerId(C98)]+200
  endif
  call DisplayTimedTextToForceEx(AllPlayers,10,TR8)
  call BX8(FC)
  call CleanTrigger(t)
  set t=null
  set C98=null
  set WU9=null
endfunction

function YG9 takes nothing returns boolean
  if GetOwningPlayer(GetKillingUnit())!=NeutralsPlayer and GetKillingUnit()!=null and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) and IsPlayerEnemy(GetOwningPlayer(GetTriggerUnit()),GetOwningPlayer(GetKillingUnit())) then
    if GetOwningPlayer(GetKillingUnit())==Sentinels[0]or GetOwningPlayer(GetKillingUnit())==Scourges[0]then
      if WF9(GetTriggerUnit(),GetKillingUnit())>0 then
        call YF9()
      endif
    else
      call YF9()
    endif
  endif
  return false
endfunction

function YH9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit u
  local region r
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set u=(LoadUnitHandle(hashtable019,(Cache),(53)))
    set r=CreateRegion()
    call RegionAddRect(r,real009)
    call RegionAddRect(r,real003)
    call RegionAddRect(r,QB)
    if IsUnitInRegion(r,u)==false then
      if(LoadBoolean(hashtable019,(Cache),(91))) then
        call SaveBoolean(hashtable019,(Cache),(91),(false))
      else
        call SetUnitX(u,GetRectCenterX(Q4))
        call SetUnitY(u,GetRectCenterY(Q4))
        call SaveBoolean(hashtable019,(Cache),(91),(true))
      endif
    endif
    call RemoveRegion(r)
  endif
  set t=null
  set u=null
  set r=null
  return false
endfunction

function YI9 takes unit u returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,10,true)
  call TriggerAddCondition(t,Condition(function YH9))
  call SaveUnitHandle(hashtable019,(Cache),(53),(u))
  call SaveBoolean(hashtable019,(Cache),(91),(true))
  set t=null
endfunction

function YJ9 takes nothing returns boolean
  local item Item
  local integer Count=GetTriggerEvalCount(GetTriggeringTrigger())
  if Count==360 then
    call CleanTrigger(GetTriggeringTrigger())
  endif
  if Count==180 or Count==300 then
    if K27!=null then
      set Item=FindItemOfType(K27,Item_Real[indexid_Aegis])
      if Item!=null then
        if Count==180 then
          if IsSentinel(GetOwningPlayer(K27))then
            call DisplayTimedTextToForceEx(Force_SentPlayers,15,GetObjectName('n0E9')+" |c00ff0303"+GetObjectName('n0E7')+"|r")
          else
            call DisplayTimedTextToForceEx(Force_ScourgePlayers,15,GetObjectName('n0E9')+" |c00ff0303"+GetObjectName('n0E7')+"|r")
          endif
        else
          if IsSentinel(GetOwningPlayer(K27))then
            call DisplayTimedTextToForceEx(Force_SentPlayers,15,GetObjectName('n0E9')+" |c00ff0303"+GetObjectName('n0DX')+"|r")
          else
            call DisplayTimedTextToForceEx(Force_ScourgePlayers,15,GetObjectName('n0E9')+" |c00ff0303"+GetObjectName('n0DX')+"|r")
          endif
        endif
      endif
    endif
  endif
  set Item=null
  return false
endfunction

function YK9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function YJ9))
  call TriggerEvaluate(t)
  set t=null
endfunction

function YM9 takes nothing returns boolean
  set M77=GetTriggerEvalCount(GetTriggeringTrigger())
  if Roshan!=null and GetUnitState(Roshan,UNIT_STATE_LIFE)>1 then
    call SetPlayerTechResearched(GetOwningPlayer(Roshan),'R00F',M77)
    if GetUnitAbilityLevel(Roshan,'A142')==0 then
      call UnitAddAbility(Roshan,'A142')
    endif
    call SetUnitAbilityLevel(Roshan,'A142',M77+1)
  endif
  return false
endfunction

function HealHeroForAegisAct takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local player p
  local real heal
  local unit u
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    
    if IsRealDamage and GetEventDamage()>0 then
      set p=GetOwningPlayer(GetEventDamageSource())
      if (IsSentinel(p) or IsScourge(p)) and IsPlayer(p) then
        call FlushChildHashtable(hashtable019,h)
        call CleanTrigger(t)
      endif
    endif
  else
    if(TimerGetElapsed(GlobalTimer)<LoadReal(hashtable019,h,0))then
      set u=LoadUnitHandle(hashtable019,h,0)
      set heal=GetUnitState(u,UNIT_STATE_MAX_LIFE)*0.2*0.05
      call SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_LIFE)+heal)
    else
      call FlushChildHashtable(hashtable019,h)
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set u=null
endfunction

function HealHeroForAegis takes unit u returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,0.05,true)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function HealHeroForAegisAct))
  call SaveUnitHandle(hashtable019,GetHandleId(t),0,u)
  
  call SaveReal(hashtable019,GetHandleId(t),0,TimerGetElapsed(GlobalTimer)+5)
  set t=null
endfunction

function YN9 takes nothing returns nothing
  local integer i=1
  local unit Hero
  set K27=null
  loop
    exitwhen i>5
    set Hero=udg_Hero[GetPlayerId(Sentinels[i])]
    if Hero!=null and FindItemOfType(Hero,Item_Real[indexid_Aegis])!=null then
      call DisableTrigger(t_manipulateitem)
      call Traffic_RegisterData("AegisOff",GetPlayerId(GetOwningPlayer(Hero)))
      call RemoveItem(FindItemOfType(Hero,Item_Real[indexid_Aegis]))
      call EnableTrigger(t_manipulateitem)
      call HealHeroForAegis(Hero)
    endif
    set Hero=udg_Hero[GetPlayerId(Scourges[i])]
    if Hero!=null and FindItemOfType(Hero,Item_Real[indexid_Aegis])!=null then
      call DisableTrigger(t_manipulateitem)
      call Traffic_RegisterData("AegisOff",GetPlayerId(GetOwningPlayer(Hero)))
      call RemoveItem(FindItemOfType(Hero,Item_Real[indexid_Aegis]))
      call EnableTrigger(t_manipulateitem)
      call HealHeroForAegis(Hero)
    endif
    set i=i+1
  endloop
  set Hero=null
endfunction

function YO9 takes string YP9,string YQ9 returns string
  local string s=GetObjectName('n0CA')
  set s=FA9(s,"$team",YP9)
  set s=FA9(s,"$team",YQ9)
  return s
endfunction

function YR9 takes nothing returns boolean
  return GetUnitTypeId(GetDyingUnit())=='n00L'
endfunction

function IsHero takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO))!=null
endfunction

function YS9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local location YT9
  local real U68
  local integer RespTime=LoadInteger(hashtable019,GetHandleId(t),0)
  if GetTriggerEvalCount(t)==RespTime or ZM7 then
    set ZM7=false
    set YT9=GetRectCenter(Q4)
    call YN9()
    set M97=M97+1
    set Roshan=CreateUnitAtLoc(Player(12),'n00L',YT9,bj_UNIT_FACING)
    call SetUnitAcquireRange(Roshan,150)
    call YI9(Roshan)
    call UnitAddAbility(Roshan,'A142')
    call SetPlayerTechResearched(GetOwningPlayer(Roshan),'R00F',M77)
    call SetUnitAbilityLevel(Roshan,'A142',M77+1)
    call RemoveLocation(YT9)
    if M97>1 then
      call UnitRemoveAbility(Roshan,'A0K2')
      call UnitAddAbility(Roshan,'A0Q6')
      call UnitAddItem(Roshan,CreateItem(Item_Real[indexid_Cheese],0,0))
    endif
    call UnitAddItem(Roshan,CreateItem(Item_Real[indexid_Aegis],0,0))
    call CleanTrigger(t)
  elseif GetTriggerEvalCount(t)==360 then
    call YN9()
  endif
  set t=null
  set YT9=null
  return false
endfunction

function YU9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function YS9))
  call SaveInteger(hashtable019,GetHandleId(t),0,GetRandomInt(8,11)*60)
  set ZM7=false
  call YK9()
  set M47=false
  if(IsSentinel(GetOwningPlayer(GetKillingUnit())))then
    call Traffic_RegisterData("Roshan",0)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,YO9("|c00ff0000"+GetObjectName('n065')+"|r",GetObjectName('n065')))
    set LastRoshanSlayer=0
    call AdjustPlayerStateBJ(200,Sentinels[1],PLAYER_STATE_RESOURCE_GOLD)
    call AdjustPlayerStateBJ(200,Sentinels[2],PLAYER_STATE_RESOURCE_GOLD)
    call AdjustPlayerStateBJ(200,Sentinels[3],PLAYER_STATE_RESOURCE_GOLD)
    call AdjustPlayerStateBJ(200,Sentinels[4],PLAYER_STATE_RESOURCE_GOLD)
    call AdjustPlayerStateBJ(200,Sentinels[5],PLAYER_STATE_RESOURCE_GOLD)
  endif
  if(IsScourge(GetOwningPlayer(GetKillingUnit())))then
    call Traffic_RegisterData("Roshan",1)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,YO9("|c00004000"+GetObjectName('n06C')+"|r",GetObjectName('n06C')))
    set LastRoshanSlayer=1
    call AdjustPlayerStateBJ(200,Scourges[1],PLAYER_STATE_RESOURCE_GOLD)
    call AdjustPlayerStateBJ(200,Scourges[2],PLAYER_STATE_RESOURCE_GOLD)
    call AdjustPlayerStateBJ(200,Scourges[3],PLAYER_STATE_RESOURCE_GOLD)
    call AdjustPlayerStateBJ(200,Scourges[4],PLAYER_STATE_RESOURCE_GOLD)
    call AdjustPlayerStateBJ(200,Scourges[5],PLAYER_STATE_RESOURCE_GOLD)
  endif
  set t=null
endfunction

function YV9 takes nothing returns nothing
  local texttag t=CreateTextTag()
  local unit u=GetTriggerUnit()
  local player p=GetOwningPlayer(GetKillingUnit())
  call SetTextTagText(t,"$",.027)
  call SetTextTagPosUnit(t,u,0)
  call SetTextTagColorBJ(t,PlayerColors_R[GetPlayerId(p)],PlayerColors_G[GetPlayerId(p)],PlayerColors_B[GetPlayerId(p)],15)
  call SetTextTagVelocity(t,0,.035)
  call SetTextTagFadepoint(t,3)
  call SetTextTagLifespan(t,1.5)
  call SetTextTagPermanent(t,false)
  call SetTextTagVisibility(t,GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2)
  set t=null
  set u=null
  set p=null
endfunction

function YW9 takes unit u,player p returns nothing
  local texttag t=CreateTextTag()
  call SetTextTagText(t,"!",.03)
  call SetTextTagPosUnit(t,u,0)
  call SetTextTagColorBJ(t,PlayerColors_R[GetPlayerId(p)],PlayerColors_G[GetPlayerId(p)],PlayerColors_B[GetPlayerId(p)],15)
  call SetTextTagVelocity(t,0,.035)
  call SetTextTagFadepoint(t,3)
  call SetTextTagLifespan(t,1.5)
  call SetTextTagPermanent(t,false)
  call SetTextTagVisibility(t,CSONStatus2[GetPlayerId(GetLocalPlayer())] or(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2)))
  set t=null
endfunction

function YX9 takes nothing returns nothing
  if IsUnitType(GetEnumUnit(),UNIT_TYPE_MELEE_ATTACKER) then
    call AddHeroXP(GetEnumUnit(),NJ/ tt_int1,true)
  else
    call AddHeroXP(GetEnumUnit(),MJ/ tt_int1,true)
  endif
endfunction

function YY9 takes nothing returns nothing
  //	local group g=GetAvailableGroup()
  //	local integer YZ9
  //	local integer YA9=18
  //	local integer YB9=YA9*2
  //	call GroupEnumUnitsInRange(g,GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),1225,Condition(function D89))
  //	set YZ9=A08(g)
  //	set tt_int1=YZ9
  //	set MJ=YA9
  //	set NJ=YB9
  //	call ForGroup(g,function YX9)
  //	call KillGroup(g)
  call YW9(GetDyingUnit(),GetOwningPlayer(GetKillingUnit()))
  //	set g=null
endfunction

function YC9 takes nothing returns boolean
  if IsUnitAlly(GetKillingUnit(),GetOwningPlayer(GetTriggerUnit())) then
    call YY9()
  else
    if udg_ObserverMode and IsPlayerBelongToTeams(GetOwningPlayer(GetKillingUnit()))then
      //call YV9()
    endif
  endif
  return false
endfunction

function Y39 takes player F59,player F29 returns string
  local string s=GetObjectName('n0AP')
  set s=FA9(s,"$dead",(IL7[GetPlayerId((F59))]))
  return s
endfunction

function Y69 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  call SetTerrainPathable(x,y,PATHING_TYPE_WALKABILITY,false)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function YL9 takes unit Source returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  call SetTerrainPathable(x,y,PATHING_TYPE_WALKABILITY,true)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function Y69))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  set Source=null
  set t=null
endfunction

function Y19 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Y09=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Count=GetTriggerEvalCount(t)
  local integer Y59=180-Count
  local integer i=1
  local integer id
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  loop
    exitwhen i>5
    if IsPlayerAlly(GetOwningPlayer(Y09),Sentinels[0])then
      set id=GetPlayerId(Sentinels[i])
    else
      set id=GetPlayerId(Scourges[i])
    endif
    set i=i+1
    if Y59==0 then
      call LeaderboardDisplay(MD7[id],false)
      if IsPlayerAlly(Sentinels[0],Player(id))then
        set CourierDead[GetPlayerId(Sentinels[0])]=false
      endif
      if IsPlayerAlly(Scourges[0],Player(id))then
        set CourierDead[GetPlayerId(Scourges[0])]=false
      endif
    else
      if IsDead(udg_Hero[id])==false then
        call PlayerSetLeaderboard(Player(id),MD7[id])
        call LeaderboardDisplay(MD7[id],true)
        call LeaderboardSetLabel(MD7[id],"	"+GetObjectName('n0LZ')+" "+I2S(Y59))
      endif
    endif
  endloop
  if Y59==2 then
    call SetUnitPosition(Y09,x,y)
  endif
  if Y59==0 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Y09=null
  return false
endfunction

function Y29 takes player whichPlayer,integer W98 returns nothing
  local texttag t
  if W98>0 then
    set t=CreateTextTag()
    call SetPlayerState(whichPlayer,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(whichPlayer,PLAYER_STATE_RESOURCE_GOLD)+W98)
    call SetTextTagText(t,"+"+I2S(W98),.025)
    call SetTextTagPosUnit(t,udg_Hero[GetPlayerId(whichPlayer)],0)
    call SetTextTagColor(t,255,220,0,255)
    call SetTextTagVelocity(t,0,.03)
    call SetTextTagVisibility(t,GetLocalPlayer()==whichPlayer)
    call SetTextTagFadepoint(t,2)
    call SetTextTagLifespan(t,3)
    call SetTextTagPermanent(t,false)
  endif
  set t=null
endfunction

function Z49 takes nothing returns boolean
  local real x
  local real y
  local unit Y09=GetTriggerUnit()
  local integer i=1
  local integer WE8=175
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  if IsBasicCourier(Y09) then
    set WE8=150
  endif
  call Traffic_RegisterData("Courier"+I2S(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
  call DisplayTimedTextToForceEx(AllPlayers,10.,Y39(GetOwningPlayer(GetTriggerUnit()),GetOwningPlayer(GetKillingUnit())))
  call PingMinimapEx(GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),6,255,0,0,false)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function Y19))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Y09))
  if IsPlayerAlly(GetOwningPlayer(Y09),Sentinels[0]) and CourierDead[GetPlayerId(Sentinels[0])]==false then
    set CourierDead[GetPlayerId(Sentinels[0])]=true
    loop
      exitwhen i>5
      call Y29(Scourges[i],WE8)
      set i=i+1
    endloop
  endif
  set i=1
  if IsPlayerAlly(GetOwningPlayer(Y09),Scourges[0]) and CourierDead[GetPlayerId(Scourges[0])]==false then
    set CourierDead[GetPlayerId(Scourges[0])]=true
    loop
      exitwhen i>5
      call Y29(Sentinels[i],WE8)
      set i=i+1
    endloop
  endif
  if IsSentinel(GetOwningPlayer(Y09))then
    set x=GetRectCenterX(gg_rct_Hero_Creation_NE)
    set y=GetRectCenterY(gg_rct_Hero_Creation_NE)
  else
    set x=GetRectCenterX(gg_rct_Hero_Creation_UD)
    set y=GetRectCenterY(gg_rct_Hero_Creation_UD)
  endif
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  if IsTerrainPathable(GetUnitX(Y09),GetUnitY(Y09),PATHING_TYPE_WALKABILITY)then
    call YL9(Y09)
  endif
  set t=null
  set Y09=null
  return false
endfunction

function Z79 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x=real086
  local real y=real087
  if IsScourge(GetOwningPlayer(Source))then
    set x=EC7
    set y=E37
  endif
  if IsDead(Source)==false then
    if DistanceBetweenXY(GetUnitX(Source),GetUnitY(Source),x,y)<800 then
      call UnitAddAbility2(Source,'Avul')
    else
      call UnitRemoveAbility(Source,'Avul')
    endif
  endif
  set t=null
  set Source=null
  return false
endfunction

function Z89 takes unit Y09 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  //call SetPlayerAbilityAvailable2(GetOwningPlayer(Y09),'A29N',false)
  call UnitMakeAbilityPermanent(Y09,true,'A29M')
  call TriggerRegisterDeathEvent(t,Y09)
  call TriggerAddCondition(t,Condition(function Z49))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function Z79))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Y09))
  set t=null
endfunction

function Z99 takes nothing returns nothing
  if IsCourier(GetTriggerUnit())and IsUnitIllusion(GetTriggerUnit())==false then
    call Traffic_RegisterData("Courier"+I2S(GetPlayerId(GetOwningPlayer(GetTriggerUnit()))),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call DisplayTimedTextToForceEx(AllPlayers,10.,Y39(GetOwningPlayer(GetTriggerUnit()),GetOwningPlayer(GetKillingUnit())))
    call PingMinimapEx(GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),6,255,0,0,false)
  endif
endfunction

function ZD9 takes nothing returns boolean
  call CleanTrigger(GetTriggeringTrigger())
  set CourierDead[GetPlayerId(Sentinels[0])]=false
  set CourierDead[GetPlayerId(Scourges[0])]=false
  set MD7[GetPlayerId(Sentinels[1])]=CreateLeaderboard()
  set MD7[GetPlayerId(Sentinels[2])]=CreateLeaderboard()
  set MD7[GetPlayerId(Sentinels[3])]=CreateLeaderboard()
  set MD7[GetPlayerId(Sentinels[4])]=CreateLeaderboard()
  set MD7[GetPlayerId(Sentinels[5])]=CreateLeaderboard()
  set MD7[GetPlayerId(Scourges[1])]=CreateLeaderboard()
  set MD7[GetPlayerId(Scourges[2])]=CreateLeaderboard()
  set MD7[GetPlayerId(Scourges[3])]=CreateLeaderboard()
  set MD7[GetPlayerId(Scourges[4])]=CreateLeaderboard()
  set MD7[GetPlayerId(Scourges[5])]=CreateLeaderboard()
  call PlayerSetLeaderboard(Sentinels[1],MD7[GetPlayerId(Sentinels[1])])
  call PlayerSetLeaderboard(Sentinels[2],MD7[GetPlayerId(Sentinels[2])])
  call PlayerSetLeaderboard(Sentinels[3],MD7[GetPlayerId(Sentinels[3])])
  call PlayerSetLeaderboard(Sentinels[4],MD7[GetPlayerId(Sentinels[4])])
  call PlayerSetLeaderboard(Sentinels[5],MD7[GetPlayerId(Sentinels[5])])
  call PlayerSetLeaderboard(Scourges[1],MD7[GetPlayerId(Scourges[1])])
  call PlayerSetLeaderboard(Scourges[2],MD7[GetPlayerId(Scourges[2])])
  call PlayerSetLeaderboard(Scourges[3],MD7[GetPlayerId(Scourges[3])])
  call PlayerSetLeaderboard(Scourges[4],MD7[GetPlayerId(Scourges[4])])
  call PlayerSetLeaderboard(Scourges[5],MD7[GetPlayerId(Scourges[5])])
  call LeaderboardDisplay(MD7[GetPlayerId(Sentinels[1])],false)
  call LeaderboardDisplay(MD7[GetPlayerId(Sentinels[2])],false)
  call LeaderboardDisplay(MD7[GetPlayerId(Sentinels[3])],false)
  call LeaderboardDisplay(MD7[GetPlayerId(Sentinels[4])],false)
  call LeaderboardDisplay(MD7[GetPlayerId(Sentinels[5])],false)
  call LeaderboardDisplay(MD7[GetPlayerId(Scourges[1])],false)
  call LeaderboardDisplay(MD7[GetPlayerId(Scourges[2])],false)
  call LeaderboardDisplay(MD7[GetPlayerId(Scourges[3])],false)
  call LeaderboardDisplay(MD7[GetPlayerId(Scourges[4])],false)
  call LeaderboardDisplay(MD7[GetPlayerId(Scourges[5])],false)
  call LeaderboardSetLabelBJ(MD7[GetPlayerId(Sentinels[1])]," ")
  call LeaderboardSetLabelBJ(MD7[GetPlayerId(Sentinels[2])]," ")
  call LeaderboardSetLabelBJ(MD7[GetPlayerId(Sentinels[3])]," ")
  call LeaderboardSetLabelBJ(MD7[GetPlayerId(Sentinels[4])]," ")
  call LeaderboardSetLabelBJ(MD7[GetPlayerId(Sentinels[5])]," ")
  call LeaderboardSetLabelBJ(MD7[GetPlayerId(Scourges[1])]," ")
  call LeaderboardSetLabelBJ(MD7[GetPlayerId(Scourges[2])]," ")
  call LeaderboardSetLabelBJ(MD7[GetPlayerId(Scourges[3])]," ")
  call LeaderboardSetLabelBJ(MD7[GetPlayerId(Scourges[4])]," ")
  call LeaderboardSetLabelBJ(MD7[GetPlayerId(Scourges[5])]," ")
  return false
endfunction

function ZE9 takes nothing returns nothing
  local integer id=GetUnitTypeId(GetTriggerUnit())
  if id=='e00R' or id=='e011' or id=='e00S' or id=='e019' or id=='u00M' or id=='u00D' or id=='u00N' or id=='u00T' then
    if IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit()))then
      set PlayerTowersDenied[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerTowersDenied[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
      call DisplayTimedTextToForceEx(AllPlayers,10,udg_Colors[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+(IL7[GetPlayerId((GetOwningPlayer(GetKillingUnit())))])+"|r "+GetObjectName('n04P')+".")
    else
      call DisplayTimedTextToForceEx(AllPlayers,10,udg_Colors[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+(IL7[GetPlayerId((GetOwningPlayer(GetKillingUnit())))])+"|r "+GetObjectName('n0EN')+".")
    endif
  endif
endfunction

function IsRune takes integer i returns boolean
  return i=='I006' or i=='I008' or i=='I00J' or i=='I00K' or i=='I007'
endfunction

function Func1971 takes nothing returns nothing
  if GetWidgetLife(GetEnumItem())>0 and IsRune(GetItemTypeId(GetEnumItem()))then
    set tt_item1=GetEnumItem()
  endif
endfunction

function ZH9 takes nothing returns integer
  local integer i=GetRandomInt(1,5)
  loop
    exitwhen i!=T77
    set i=GetRandomInt(1,5)
  endloop
  set T77=i
  return i
endfunction

function ZI9 takes nothing returns boolean
  local boolean ZJ9=false
  local boolean ZK9=false
  local real x
  local real y
  local real x1
  local real y1
  local real x2
  local real y2
  local integer ZM9
  if GetRandomInt(1,2)==1 then
    set x=GetLocationX(TopRuneSpawn)
    set y=GetLocationY(TopRuneSpawn)
  else
    set x=GetLocationX(BottomRuneSpawn)
    set y=GetLocationY(BottomRuneSpawn)
  endif
  set x1=GetLocationX(TopRuneSpawn)
  set y1=GetLocationY(TopRuneSpawn)
  set x2=GetLocationX(BottomRuneSpawn)
  set y2=GetLocationY(BottomRuneSpawn)
  set tt_item1=null
  call EnumItemsInRect(TopRuneSpawnRect,Condition(function ReturnTrue2),function Func1971)
  if tt_item1==null then
    set ZJ9=true
  endif
  set tt_item1=null
  call EnumItemsInRect(BottomRuneSpawnRect,Condition(function ReturnTrue2),function Func1971)
  if tt_item1==null then
    set ZK9=true
  endif
  if Mode_ER==false or GetTriggerEvalCount(GetTriggeringTrigger())<20 then
    if ZJ9 and ZK9 then
      set ZM9=ZH9()
      if ZM9==1 then
        call CreateItem('I007',x,y)
      elseif ZM9==2 then
        call CreateItem('I006',x,y)
      elseif ZM9==3 then
        call CreateItem('I00K',x,y)
      elseif ZM9==4 then
        call CreateItem('I008',x,y)
      elseif ZM9==5 then
        call CreateItem('I00J',x,y)
      endif
    endif
  else
    if ZJ9 then
      set ZM9=ZH9()
      if ZM9==1 then
        call CreateItem('I007',x1,y1)
      elseif ZM9==2 then
        call CreateItem('I006',x1,y1)
      elseif ZM9==3 then
        call CreateItem('I00K',x1,y1)
      elseif ZM9==4 then
        call CreateItem('I008',x1,y1)
      elseif ZM9==5 then
        call CreateItem('I00J',x1,y1)
      endif
    endif
    if ZK9 then
      set ZM9=ZH9()
      if ZM9==1 then
        call CreateItem('I007',x2,y2)
      elseif ZM9==2 then
        call CreateItem('I006',x2,y2)
      elseif ZM9==3 then
        call CreateItem('I00K',x2,y2)
      elseif ZM9==4 then
        call CreateItem('I008',x2,y2)
      elseif ZM9==5 then
        call CreateItem('I00J',x2,y2)
      endif
    endif
  endif
  return false
endfunction

function ZP9 takes unit Source returns nothing
  local real x
  local real y
  if IsSentinel(GetOwningPlayer(Source))then
    set x=GetRectCenterX(gg_rct_Hero_Creation_NE)
    set y=GetRectCenterY(gg_rct_Hero_Creation_NE)
  else
    set x=GetRectCenterX(gg_rct_Hero_Creation_UD)
    set y=GetRectCenterY(gg_rct_Hero_Creation_UD)
  endif
  call IssuePointOrderById(Source,851986,x,y)
endfunction

function ZQ9 takes nothing returns nothing
  local item Item=GetEnumItem()
  if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==U07 and V47==0 then
    set V47=V47+1
    call UnitAddItem(U57,Item)
  endif
  set Item=null
endfunction

function ZR9 takes nothing returns nothing
  local item Item=GetEnumItem()
  if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==U07 then
    call UnitAddItem(U27,Item)
  endif
  set Item=null
endfunction

function ZS9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Y09=(LoadUnitHandle(hashtable019,(Cache),(92)))
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local rect r=Rect(x-300,y-300,x+300,y+300)
  if GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    set U07=p
    set U57=Source
    set U27=Y09
    call EnumItemsInRect(r,Condition(function ReturnTrue2),function ZR9)
  else
    if GetTriggerEvalCount(t)>9 then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      set U07=p
      set U57=Source
      set U27=Y09
      call EnumItemsInRect(r,Condition(function ReturnTrue2),function ZR9)
    else
      set U07=p
      set U57=Source
      set V47=0
      call EnumItemsInRect(r,Condition(function ReturnTrue2),function ZQ9)
    endif
  endif
  call RemoveRect(r)
  set t=null
  set Source=null
  set Y09=null
  set r=null
  return false
endfunction

function ZT9 takes unit Y09,unit Source returns nothing
  local player p=GetOwningPlayer(Source)
  local integer i
  local item Item
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real x=GetUnitX(Y09)
  local real y=GetUnitY(Y09)
  local integer indexId
  if IsTerrainPathable(x,y,PATHING_TYPE_WALKABILITY)then
    set x=GetUnitX(Source)
    set y=GetUnitY(Source)
  endif
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerRegisterTimerEvent(t,.01,true)
  call TriggerAddCondition(t,Condition(function ZS9))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(92),(Y09))
  call SavePlayerHandle(hashtable019,(Cache),(54),(p))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  set i=0
  loop
    exitwhen i>5
    set Item=UnitItemInSlot(Y09,i)
    set indexId=GetIndex(Item)
    if Item!=null and GetItemPlayer(Item)==p and ES9(Item)==false and(indexId!=indexid_BottleInvis and indexId!=indexid_BottleDD and indexId!=indexid_BottleHaste and indexId!=indexid_BottleRegen and indexId!=indexid_BottleIllusion)then
      call UnitRemoveItem(Y09,Item)
      call SetItemPosition(Item,x,y)
    endif
    set i=i+1
  endloop
  set t=null
  set Item=null
endfunction

function ZU9 takes unit Unit returns boolean
  local integer ZV9=GetUnitCurrentOrder(Unit)
  return(ZV9==0)or(ZV9==851973)or(ZV9==851975)or(ZV9==851987)or(ZV9==851993)
endfunction

function ZW9 takes trigger t returns nothing
  local integer Cache=GetHandleId(t)
  local unit Y09=(LoadUnitHandle(hashtable019,(Cache),(92)))
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x
  local real y
  local real ZX9
  local real ZY9
  local real ZZ9
  local real ZA9
  local real ZB9
  local real YR8
  local real ZC9
  local real Z39=GetUnitX(Hero)
  local real Z69=GetUnitY(Hero)
  if(ZU9(Hero)==false)then
    set x=GetUnitX(Hero)
    set y=GetUnitY(Hero)
    set ZA9=(LoadReal(hashtable019,(Cache),(677)))
    set ZB9=(LoadReal(hashtable019,(Cache),(678)))
    call SaveReal(hashtable019,(Cache),(677),((x)*1.))
    call SaveReal(hashtable019,(Cache),(678),((y)*1.))
    set ZZ9=Atan2(y-ZB9,x-ZA9)
    set ZX9=SquareRoot((x-ZA9)*(x-ZA9)+(y-ZB9)*(y-ZB9))/ .2
    set ZY9=GetUnitMoveSpeedLOD(Y09)
    set YR8=DistanceBetweenXY(GetUnitX(Hero),GetUnitY(Hero),GetUnitX(Y09),GetUnitY(Y09))
    set ZC9=RAbsBJ(ZZ9*bj_RADTODEG-GetUnitFacing(Y09))
    if(YR8<ZY9-ZX9 and ZY9>ZX9)or(YR8<RMaxBJ(ZY9,ZX9)and ZC9>=90)then
    else
      set Z39=x+ZX9*Cos(ZZ9)
      set Z69=y+ZX9*Sin(ZZ9)
    endif
  endif
  call SaveInteger(hashtable019,(Cache),(679),(1))
  call IssuePointOrderById(Y09,851986,Z39,Z69)
  set Y09=null
  set Hero=null
  set t=null
endfunction

function ZL9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Y09=(LoadUnitHandle(hashtable019,(Cache),(92)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x
  local real y
  local integer i
  local player p=GetOwningPlayer(Source)
  local item Item
  if GetTriggerEventId()==EVENT_WIDGET_DEATH then
    if GetTriggerUnit()==Source then
      call ZP9(Y09)
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_TARGET_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_POINT_ORDER then
    if(LoadInteger(hashtable019,(Cache),(679)))==1 then
      call SaveInteger(hashtable019,(Cache),(679),(0))
    elseif GetIssuedOrderId()!=852100 and GetIssuedOrderId()!=852090 then
      call CleanTrigger(t)
    endif
  else
    if DistanceBetweenUnits(Y09,Source)<150 then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call ZT9(Y09,Source)
      call ZP9(Y09)
    else
      call ZW9(t)
    endif
  endif
  set t=null
  set Y09=null
  set Source=null
  set Item=null
  return false
endfunction

function Z19 takes unit Hero,boolean Z09 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Y09=GetSellingUnit()
  local integer Z59=(LoadInteger(hashtable019,(GetHandleId(Y09)),(8000)))
  if Hero!=null then
    if Hero!=(LoadUnitHandle(hashtable019,(GetHandleId(Y09)),(8002+Z59)))and Z09 then
      set Z59=Z59+1
      call SaveInteger(hashtable019,(GetHandleId(Y09)),(8000),(Z59))
      call SaveUnitHandle(hashtable019,(GetHandleId(Y09)),(8002+Z59),(Hero))
    endif
    call SaveReal(hashtable019,(Cache),(677),((GetUnitX(Hero))*1.))
    call SaveReal(hashtable019,(Cache),(678),((GetUnitY(Hero))*1.))
    call IssueTargetOrderById(Y09,851986,Hero)
    call TriggerRegisterDeathEvent(t,Y09)
    call TriggerRegisterDeathEvent(t,Hero)
    call TriggerRegisterUnitEvent(t,Y09,EVENT_UNIT_ISSUED_ORDER)
    call TriggerRegisterUnitEvent(t,Y09,EVENT_UNIT_ISSUED_TARGET_ORDER)
    call TriggerRegisterUnitEvent(t,Y09,EVENT_UNIT_ISSUED_POINT_ORDER)
    call TriggerRegisterTimerEvent(t,.2,true)
    call TriggerAddCondition(t,Condition(function ZL9))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Hero))
    call SaveUnitHandle(hashtable019,(Cache),(92),(Y09))
  endif
  set t=null
  set Y09=null
endfunction

function Z29 takes nothing returns nothing
  local item Item=GetEnumItem()
  local unit u=VX7
  local player p=GetOwningPlayer(u)
  local integer id=GetPlayerId(p)
  if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==p then
    call SetItemPosition(Item,ItemSpawnX[id],ItemSpawnY[id])
    call UnitAddItem(V87,Item)
  endif
  set Item=null
  set u=null
  set p=null
endfunction

function A49 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit u=(LoadUnitHandle(hashtable019,(Cache),(53)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  set VX7=u
  set V87=Source
  if IsSentinel(GetOwningPlayer(VX7))then
    call EnumItemsInRect(boolean036,Condition(function ReturnTrue2),function Z29)
  else
    call EnumItemsInRect(Z5,Condition(function ReturnTrue2),function Z29)
  endif
  if GetTriggerEvalCount(t)==3 then
    call KillUnit(u)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set u=null
  set Source=null
  return false
endfunction

function A79 takes unit Hero returns nothing
  local unit u=GetSoldUnit()
  local integer i=0
  local item Item
  local integer id=GetPlayerId(GetOwningPlayer(u))
  local region r=CreateRegion()
  local trigger t
  local integer Cache
  local unit Source=GetSellingUnit()
  if IsSentinel(GetOwningPlayer(u))then
    call RegionAddRect(r,boolean036)
  else
    call RegionAddRect(r,Z5)
  endif
  if IsUnitInRegion(r,Source)then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,.05,true)
    call TriggerAddCondition(t,Condition(function A49))
    call SaveUnitHandle(hashtable019,(Cache),(53),(u))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    loop
      exitwhen i>5
      set Item=UnitItemInSlot(Source,i)
      if Bottle_IsIndexRune(GetIndex(Item))==false and GetIndex(Item)!=indexid_Aegis and ES9(Item)==false then
        call UnitRemoveItemFromSlot(Source,i)
        if IsUnitInRegion(r,Source)and IsPlayerAlly(GetItemPlayer(Item),GetOwningPlayer(Source)) then
          set id=GetPlayerId(GetItemPlayer(Item))
          call SetItemPosition(Item,ItemSpawnX[id],ItemSpawnY[id])
        endif
      endif
      set i=i+1
    endloop
  endif
  call RemoveRegion(r)
  set u=null
  set r=null
  set t=null
  set Item=null
  set Source=null
endfunction

function A89 takes unit u returns string
  local string s=GetObjectName('n0FO')
  set s=FA9(s,"$hero",udg_Colors[GetPlayerId(GetOwningPlayer(u))]+GetUnitName(u)+"|r")
  return s
endfunction

function Func4588 takes unit Source returns boolean
  if GetOwningPlayer(Source)!=GetLocalPlayer()then
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,15,A89(udg_Hero[GetPlayerId(GetOwningPlayer(Source))]))
  endif
  return false
endfunction

function RemoveBuybackVisuals takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  call UnitRemoveAbility(LoadUnitHandle(hashtable019,h,0),'A336')
  call UnitRemoveAbility(LoadUnitHandle(hashtable019,h,0),'B0GU')
  call PauseTimer(t)
  call DestroyTimer(t)
  set t=null
endfunction

function AddBuybackVisuals takes unit u,real r returns nothing
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call TimerStart(t,r,false,function RemoveBuybackVisuals)
  call UnitAddAbility2(u,'A336')
  call SaveUnitHandle(hashtable019,h,0,u)
  set t=null
endfunction

function DeliverItems_Main takes nothing returns nothing
  local unit u=GetSoldUnit()
  local player p=GetOwningPlayer(u)
  local integer pid=GetPlayerId(p)
  local real r=0
  if GetUnitTypeId(u)=='h085' then
    if udg_Hero[pid]!=null and IsDead(udg_Hero[pid])==false then
      call Z19(udg_Hero[pid],true)
    endif
    call KillUnit(u)
  elseif GetUnitTypeId(u)=='h0BV' then
    if udg_Hero[pid]!=null then
      call A79(udg_Hero[pid])
    endif
    call KillUnit(u)
  elseif GetUnitTypeId(u)=='h0DE' then
    if udg_Hero[pid]!=null then
      call Z19((LoadUnitHandle(hashtable019,(GetHandleId(GetSellingUnit())),(8002+(LoadInteger(hashtable019,(GetHandleId(GetSellingUnit())),(8000)))-1))),false)
    endif
    call KillUnit(u)
  elseif Func1096(GetUnitTypeId(u))then
    if udg_Hero[pid]!=null then
      if IsDead(udg_Hero[pid]) and p==GetOwningPlayer(GetSellingUnit())and((LoadInteger(hashtable019,(GetHandleId((udg_Hero[pid]))),((4304))))==1)==false and IsImpossibleToBuyback[pid]==false then
        set r=TimerGetRemaining(HeroRespawnTimer[pid])
        call SaveReal(HeroStats,GetHandleId(p),25,r+TimerGetElapsed(GlobalTimer))
        call SaveReal(HeroStats,GetHandleId(p),26,r*0.25)
        call Func4588(udg_Hero[pid])
        set V77=true
        call ReviveHero(udg_Hero[pid],GetUnitX(u),GetUnitY(u),true)
        call AddBuybackVisuals(udg_Hero[pid],r)
        set V77=false
        call SetUnitState(udg_Hero[pid],UNIT_STATE_MANA,10000)
        set ReliableGold[pid]=IMaxBJ(0,ReliableGold[pid]-BuybackUnitCost[DefineBuybackUnitIndex(GetHeroLevel(udg_Hero[GetPlayerId(GetOwningPlayer(GetSellingUnit()))]))])
        call GU9(p)
        
      else
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+BuybackUnitCost[DefineBuybackUnitIndex(GetHeroLevel(udg_Hero[GetPlayerId(GetOwningPlayer(GetSellingUnit()))]))])
        if IsImpossibleToBuyback[pid] then
          call Error(p,"Cannot buy back due to Reaper's Scythe")
        endif
      endif
    endif
    call KillUnit(u)
  endif
  set u=null
endfunction

function Fuse_Helper takes player whichPlayer,unit whichUnit,integer resultitem,integer i0,integer i1,integer i2,integer i3,integer i4,integer i5 returns nothing
  local item Item
  call DisableTrigger(VQ7)
  if i0>0 then
    set Item=UnitItemInSlot(whichUnit,0)
    call DestroyItem(Item)
  endif
  if i1>0 then
    set Item=UnitItemInSlot(whichUnit,1)
    call DestroyItem(Item)
  endif
  if i2>0 then
    set Item=UnitItemInSlot(whichUnit,2)
    call DestroyItem(Item)
  endif
  if i3>0 then
    set Item=UnitItemInSlot(whichUnit,3)
    call DestroyItem(Item)
  endif
  if i4>0 then
    set Item=UnitItemInSlot(whichUnit,4)
    call DestroyItem(Item)
  endif
  if i5>0 then
    set Item=UnitItemInSlot(whichUnit,5)
    call DestroyItem(Item)
  endif
  set Item=UnitAddItemById(whichUnit,Item_Real[resultitem])
  call SetItemPlayer(Item,whichPlayer,true)
  call SetItemUserData(Item,0)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl",whichUnit,"origin"))
  if GetIndex(Item)==indexid_bloodstone then
    call SetItemCharges(Item,8)
  endif
  call EnableTrigger(VQ7)
  if IsPlayerAlly(GetLocalPlayer(),whichPlayer) then
    if resultitem==indexid_Mekansm then
      call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(whichPlayer)]+(IL7[GetPlayerId((whichPlayer))])+"|r |c00ffff00"+GetObjectName('n0LX')+"|r")
    elseif resultitem==indexid_DivineRapier then
      call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(whichPlayer)]+(IL7[GetPlayerId((whichPlayer))])+"|r |c00ffff00"+GetObjectName('n0LY')+"|r")
    endif
  endif
  set Item=null
endfunction






function Fuse takes player p,unit whichUnit,integer indexId returns boolean
  local integer i
  local integer x
  local integer y
  local integer array searchItems
  local boolean array searchItems_Active
  local integer array recipeItems
  local boolean array recipeItems_Active
  local boolean array found
  local integer array result
  local player whichPlayer
  local integer MaxSearch=1
  local integer k
  local player array PlayerSearches
  local integer m
  local item Inventory0
  local item Inventory1
  local item Inventory2
  local item Inventory3
  local item Inventory4
  local item Inventory5
  local player InventoryPlayer0
  local player InventoryPlayer1
  local player InventoryPlayer2
  local player InventoryPlayer3
  local player InventoryPlayer4
  local player InventoryPlayer5
  local integer InventoryUserData0
  local integer InventoryUserData1
  local integer InventoryUserData2
  local integer InventoryUserData3
  local integer InventoryUserData4
  local integer InventoryUserData5
  local integer InventoryIndex0
  local integer InventoryIndex1
  local integer InventoryIndex2
  local integer InventoryIndex3
  local integer InventoryIndex4
  local integer InventoryIndex5
  local boolean extrasearch=false
  local boolean resetvars=true
  set Inventory0=UnitItemInSlot(whichUnit,0)
  set Inventory1=UnitItemInSlot(whichUnit,1)
  set Inventory2=UnitItemInSlot(whichUnit,2)
  set Inventory3=UnitItemInSlot(whichUnit,3)
  set Inventory4=UnitItemInSlot(whichUnit,4)
  set Inventory5=UnitItemInSlot(whichUnit,5)
  set InventoryPlayer0=GetItemPlayer(Inventory0)
  set InventoryPlayer1=GetItemPlayer(Inventory1)
  set InventoryPlayer2=GetItemPlayer(Inventory2)
  set InventoryPlayer3=GetItemPlayer(Inventory3)
  set InventoryPlayer4=GetItemPlayer(Inventory4)
  set InventoryPlayer5=GetItemPlayer(Inventory5)
  set InventoryUserData0=GetItemUserData(Inventory0)
  set InventoryUserData1=GetItemUserData(Inventory1)
  set InventoryUserData2=GetItemUserData(Inventory2)
  set InventoryUserData3=GetItemUserData(Inventory3)
  set InventoryUserData4=GetItemUserData(Inventory4)
  set InventoryUserData5=GetItemUserData(Inventory5)
  set InventoryIndex0=GetIndex(Inventory0)
  set InventoryIndex1=GetIndex(Inventory1)
  set InventoryIndex2=GetIndex(Inventory2)
  set InventoryIndex3=GetIndex(Inventory3)
  set InventoryIndex4=GetIndex(Inventory4)
  set InventoryIndex5=GetIndex(Inventory5)
  if(GetPlayerSlotState((p))==PLAYER_SLOT_STATE_LEFT)then
    set MaxSearch=5
    set extrasearch=true
  endif
  set PlayerSearches[1]=p
  if extrasearch then
    set k=2
    set m=1
    loop
      exitwhen k>MaxSearch
      if IsSentinel(p)then
        if p!=Sentinels[m]then
          set PlayerSearches[k]=Sentinels[m]
          set k=k+1
        endif
      else
        if p!=Scourges[m]then
          set PlayerSearches[k]=Scourges[m]
          set k=k+1
        endif
      endif
      set m=m+1
    endloop
  endif
  set k=1
  loop
    exitwhen k>MaxSearch
    set whichPlayer=PlayerSearches[k]
    set i=0
    if Inventory0!=null and InventoryUserData0==1 and(InventoryPlayer0==whichPlayer or Mode_PM or(GetPlayerSlotState((InventoryPlayer0))==PLAYER_SLOT_STATE_LEFT))then
      set searchItems[i+1]=InventoryIndex0
    else
      set searchItems[i+1]=0
    endif
    set i=1
    if Inventory1!=null and InventoryUserData1==1 and(InventoryPlayer1==whichPlayer or Mode_PM or(GetPlayerSlotState((InventoryPlayer1))==PLAYER_SLOT_STATE_LEFT))then
      set searchItems[i+1]=InventoryIndex1
    else
      set searchItems[i+1]=0
    endif
    set i=2
    if Inventory2!=null and InventoryUserData2==1 and(InventoryPlayer2==whichPlayer or Mode_PM or(GetPlayerSlotState((InventoryPlayer2))==PLAYER_SLOT_STATE_LEFT))then
      set searchItems[i+1]=InventoryIndex2
    else
      set searchItems[i+1]=0
    endif
    set i=3
    if Inventory3!=null and InventoryUserData3==1 and(InventoryPlayer3==whichPlayer or Mode_PM or(GetPlayerSlotState((InventoryPlayer3))==PLAYER_SLOT_STATE_LEFT))then
      set searchItems[i+1]=InventoryIndex3
    else
      set searchItems[i+1]=0
    endif
    set i=4
    if Inventory4!=null and InventoryUserData4==1 and(InventoryPlayer4==whichPlayer or Mode_PM or(GetPlayerSlotState((InventoryPlayer4))==PLAYER_SLOT_STATE_LEFT))then
      set searchItems[i+1]=InventoryIndex4
    else
      set searchItems[i+1]=0
    endif
    set i=5
    if Inventory5!=null and InventoryUserData5==1 and(InventoryPlayer5==whichPlayer or Mode_PM or(GetPlayerSlotState((InventoryPlayer5))==PLAYER_SLOT_STATE_LEFT))then
      set searchItems[i+1]=InventoryIndex5
    else
      set searchItems[i+1]=0
    endif
    set searchItems[0]=indexId
    set i=1
    loop
      exitwhen i>(Recipe_Max)
      set recipeItems[0]=Rec_Comp_1[i]
      set recipeItems[1]=Rec_Comp_2[i]
      set recipeItems[2]=Rec_Comp_3[i]
      set recipeItems[3]=Rec_Comp_4[i]
      set recipeItems[4]=Rec_Comp_5[i]
      if resetvars then
        set recipeItems_Active[0]=true
        set recipeItems_Active[1]=true
        set recipeItems_Active[2]=true
        set recipeItems_Active[3]=true
        set recipeItems_Active[4]=true
        set recipeItems_Active[5]=true
        set recipeItems_Active[6]=true
        set searchItems_Active[0]=true
        set searchItems_Active[1]=true
        set searchItems_Active[2]=true
        set searchItems_Active[3]=true
        set searchItems_Active[4]=true
        set searchItems_Active[5]=true
        set searchItems_Active[6]=true
        set result[0]=0
        set result[1]=0
        set result[2]=0
        set result[3]=0
        set result[4]=0
        set result[5]=0
        set result[6]=0
        set resetvars=false
      endif
      set found[0]=false
      set found[1]=false
      set found[2]=false
      set found[3]=false
      set found[4]=false
      set x=0
      loop
        exitwhen x==5
        if recipeItems[x]==0 then
          set found[x]=true
        else
          set y=0
          loop
            exitwhen y==7
            
            //call BJDebugMsg("Passing: "+Id2String(searchItems[y])+" "+I2S(searchItems[y])+"  returned: "+Id2String(searchItems[y])+" "+I2S(searchItems[y]))
            
            //if DummyItem(searchItems[y])==recipeItems[x]and searchItems_Active[y]and recipeItems_Active[x]then
            if searchItems[y]==recipeItems[x]and searchItems_Active[y]and recipeItems_Active[x]then
              set searchItems_Active[y]=false
              set recipeItems_Active[x]=false
              set found[x]=true
              set result[y]=1
              set y=7
              set resetvars=true
            else
              set y=y+1
            endif
          endloop
        endif
        if found[x] then
          set x=x+1
        else
          set x=5
        endif
      endloop
      if found[0]and found[1]and found[2]and found[3]and found[4]then
        call Fuse_Helper(whichPlayer,whichUnit,Rec_Final[i],result[1],result[2],result[3],result[4],result[5],result[6])
        set i=Recipe_Max+2
      else
        set i=i+1
      endif
    endloop
    set tt_bool1=result[0]==1
    if i==(Recipe_Max+2)then
      set Inventory0=null
      set Inventory1=null
      set Inventory2=null
      set Inventory3=null
      set Inventory4=null
      set Inventory5=null
      return true
    endif
    set k=k+1
  endloop
  set Inventory0=null
  set Inventory1=null
  set Inventory2=null
  set Inventory3=null
  set Inventory4=null
  set Inventory5=null
  set InventoryPlayer0 =null
  set InventoryPlayer1 =null
  set InventoryPlayer2 =null
  set InventoryPlayer3 =null
  set InventoryPlayer4 =null
  set InventoryPlayer5 =null
  set whichPlayer=null
  return false
endfunction

function AttemptFuse takes player whichPlayer,unit whichUnit,integer indexId returns boolean
  local integer i=1
  local boolean result
  set tt_bool1=false
  set result=Fuse(whichPlayer,whichUnit,indexId)
  return result
endfunction

function FindDestination_Which2 takes nothing returns boolean
  if IsUnitAlly(GetFilterUnit(),GetOwningPlayer(tt_unit1)) and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')==0 and UnitInventorySize(GetFilterUnit())>1 and GetUnitTypeId(GetFilterUnit())!='ncop' and GetPlayerAlliance(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(tt_unit1),ALLIANCE_SHARED_CONTROL)and GetOwningPlayer(tt_unit1)!=GetOwningPlayer(GetFilterUnit())and IsUnitIllusion(GetFilterUnit())==false and IsDead(GetFilterUnit())==false then
    if IsCourier(GetFilterUnit()) then
      set tt_int1=tt_int1+1
      set tt_unit2=GetFilterUnit()
    endif
  endif
  return false
endfunction

function FindDestination_Which takes nothing returns boolean
  if IsUnitAlly(GetFilterUnit(),GetOwningPlayer(tt_unit1)) and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')==0 and UnitInventorySize(GetFilterUnit())>1 and GetUnitTypeId(GetFilterUnit())!='ncop' and IsUnitIllusion(GetFilterUnit())==false and IsDead(GetFilterUnit())==false then
    if GetOwningPlayer(tt_unit1)==GetOwningPlayer(GetFilterUnit())then
      if IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) then
        if GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 then
          set tt_unit2=GetFilterUnit()
        endif
      elseif IsUnitType(tt_unit2,UNIT_TYPE_HERO)==false then
        set tt_unit2=GetFilterUnit()
      endif
    endif
  endif
  return false
endfunction

function FindDestination takes unit whichUnit,integer BonusRange returns unit
  local group g=GetAvailableGroup()
  set tt_unit1=whichUnit
  set tt_unit2=null
  call GroupEnumUnitsInRange(g,GetUnitX(tt_unit3),GetUnitY(tt_unit3),1300+BonusRange,Condition(function FindDestination_Which))
  if tt_unit2==null then
    set tt_int1=0
    call KillGroup(g)
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(tt_unit3),GetUnitY(tt_unit3),1100+BonusRange,Condition(function FindDestination_Which2))
    if tt_int1>1 then
      set tt_unit2=null
    endif
  endif
  call KillGroup(g)
  set g=null
  return tt_unit2
endfunction

function CheckFuse takes player whichPlayer,unit whichUnit,unit sellingUnit,integer indexId,real x,real y,integer charges,integer userdata returns nothing
  local unit Destination
  local item newItem
  set tt_unit3=sellingUnit
  if GetUnitPointValue(whichUnit)==200 then
    set Destination=FindDestination(whichUnit,0)
    if Destination==null then
      set Destination=FindDestination(whichUnit,300)
    endif
  else
    set Destination=whichUnit
  endif
  
  if Destination==null or AttemptFuse(whichPlayer,Destination,FindRealIndexId(indexId))==false or tt_bool1==false then
    if IsIndexIdCharged(FindRealIndexId(indexId))then
      if GetEmptyInventorySlots(Destination)==0 or Destination==null then
        
        call DelayedItemCreation(Item_Dummy[indexId],x,y,whichPlayer,true,charges)
      else
        set newItem=UnitAddItemById(Destination,Item_Real[indexId])
        call SetItemCharges(newItem,charges)
        call SetItemPlayer(newItem,whichPlayer,true)
        call SetItemUserData(newItem,userdata)
      endif
    elseif IsIndexIdConsumable(FindRealIndexId(indexId))then
      if Destination==null or(GetEmptyInventorySlots(Destination)==0 and FindItemOfType(Destination,Item_Real[indexId])==null)then
        
        call DelayedItemCreation(Item_Dummy[indexId],x,y,whichPlayer,true,FG9(indexId))
      else
        set newItem=CreateItem(Item_Dummy[indexId],x,y)
        call SetItemPlayer(newItem,whichPlayer,true)
        call SetItemUserData(newItem,userdata)
        call SetItemCharges(newItem,FG9(indexId))
        call UnitAddItem(Destination,newItem)
      endif
    else
      if GetEmptyInventorySlots(Destination)==0 or Destination==null then
        call DelayedItemCreation(Item_Dummy[indexId],x,y,whichPlayer,false,0)
      else
        set newItem=UnitAddItemById(Destination,Item_Real[indexId])
        call SetItemPlayer(newItem,whichPlayer,true)
        call SetItemUserData(newItem,0)
      endif
    endif
  else
    if IsUnitType(Destination,UNIT_TYPE_HERO) then
      if userdata==0 then
        call Traffic_RegisterData("PUI_"+I2S(GetPlayerId(GetOwningPlayer(Destination))),Item_Real[FindRealIndexId(indexId)])
      endif
    endif
  endif
  set Destination=null
  set newItem=null
endfunction

function ItemStats_Track takes player p,integer indexId returns nothing
  local integer i=GetPlayerId(p)
  if indexId==indexid_ClarityPotion then
    set ItemStats_Consumables[i]=ItemStats_Consumables[i]+1
  elseif indexId==indexid_HealingSalve then
    set ItemStats_Consumables[i]=ItemStats_Consumables[i]+1
  elseif indexId==indexid_Tango then
    set ItemStats_Consumables[i]=ItemStats_Consumables[i]+4
  elseif indexId==indexid_ObserverWards then
    set ItemStats_Consumables[i]=ItemStats_Consumables[i]+2
    set ItemStats_Wards[i]=ItemStats_Wards[i]+2
  elseif indexId==indexid_SentryWards then
    set ItemStats_Consumables[i]=ItemStats_Consumables[i]+2
    set ItemStats_Wards[i]=ItemStats_Wards[i]+2
  elseif indexId==indexid_ScrollOfTownPortal then
    set ItemStats_Consumables[i]=ItemStats_Consumables[i]+1
  elseif indexId==indexid_dustofappearance then
    set ItemStats_Consumables[i]=ItemStats_Consumables[i]+2
  elseif indexId==indexid_ghostpotion then
    set ItemStats_Consumables[i]=ItemStats_Consumables[i]+2
  elseif indexId==indexid_wandofillusions then
    set ItemStats_Consumables[i]=ItemStats_Consumables[i]+2
  endif
endfunction

function UnitItem_RestrictBuying takes unit store,unit buyer returns boolean
  local integer indexId
  if(store==ScourgeBuilding_ShopGraveyard or store==ScourgeBuilding_ShopGateway)and IsUnitAlly(buyer,Scourges[0])then
    return false
  elseif(store==SentinelBuilding_ShopChimaera or store==SentinelBuilding_ShopCache)and IsUnitAlly(buyer,Sentinels[0])then
    return false
  endif
  set indexId=UnitToIndex(buyer)
  if indexId==indexid_ObserverWards or indexId==indexid_Gem or indexId==indexid_Smoke then
    return true
  endif
  return false
endfunction

function UnitItem_GetBestX takes unit sellingUnit,unit soldUnit returns real
  if sellingUnit==SentinelBuilding_ShopCache or sellingUnit==SentinelBuilding_ShopWeapon or sellingUnit==SentinelBuilding_ShopAccessorizer or sellingUnit==SentinelBuilding_ShopChimaera or sellingUnit==SentinelBuilding_Shop1 or sellingUnit==SentinelBuilding_Shop2 or sellingUnit==SentinelBuilding_Shop3 or sellingUnit==SentinelBuilding_Shop4 or sellingUnit==SentinelBuilding_Shop5 or sellingUnit==SentinelBuilding_Shop6 then
    return ItemSpawnX[GetPlayerId(GetOwningPlayer(soldUnit))]
  elseif sellingUnit==ScourgeBuilding_ShopGateway or sellingUnit==ScourgeBuilding_ShopWeapon or sellingUnit==ScourgeBuilding_ShopAccessorizer or sellingUnit==ScourgeBuilding_ShopGraveyard or sellingUnit==ScourgeBuilding_Shop1 or sellingUnit==ScourgeBuilding_Shop2 or sellingUnit==ScourgeBuilding_Shop3 or sellingUnit==ScourgeBuilding_Shop4 or sellingUnit==ScourgeBuilding_Shop5 or sellingUnit==ScourgeBuilding_Shop6 then
    return ItemSpawnX[GetPlayerId(GetOwningPlayer(soldUnit))]
  elseif sellingUnit==BY or sellingUnit==GZ then
    return-7133.
  elseif sellingUnit==CY or sellingUnit==DY then
    return 7207.
  endif
  return GetUnitX(soldUnit)
endfunction

function UnitItem_GetBestY takes unit sellingUnit,unit soldUnit returns real
  if sellingUnit==SentinelBuilding_ShopCache or sellingUnit==SentinelBuilding_ShopWeapon or sellingUnit==SentinelBuilding_ShopAccessorizer or sellingUnit==SentinelBuilding_ShopChimaera or sellingUnit==SentinelBuilding_Shop1 or sellingUnit==SentinelBuilding_Shop2 or sellingUnit==SentinelBuilding_Shop3 or sellingUnit==SentinelBuilding_Shop4 or sellingUnit==SentinelBuilding_Shop5 or sellingUnit==SentinelBuilding_Shop6 then
    return ItemSpawnY[GetPlayerId(GetOwningPlayer(soldUnit))]
  elseif sellingUnit==ScourgeBuilding_ShopGateway or sellingUnit==ScourgeBuilding_ShopWeapon or sellingUnit==ScourgeBuilding_ShopAccessorizer or sellingUnit==ScourgeBuilding_ShopGraveyard or sellingUnit==ScourgeBuilding_Shop1 or sellingUnit==ScourgeBuilding_Shop2 or sellingUnit==ScourgeBuilding_Shop3 or sellingUnit==ScourgeBuilding_Shop4 or sellingUnit==ScourgeBuilding_Shop5 or sellingUnit==ScourgeBuilding_Shop6 then
    return ItemSpawnY[GetPlayerId(GetOwningPlayer(soldUnit))]
  elseif sellingUnit==BY or sellingUnit==GZ then
    return 4317.
  elseif sellingUnit==CY or sellingUnit==DY then
    return-4243.
  endif
  return GetUnitY(soldUnit)
endfunction

function UnitItem_GetBestXOld takes unit sellingUnit,unit soldUnit returns real
  if sellingUnit==SentinelBuilding_ShopCache or sellingUnit==SentinelBuilding_ShopWeapon or sellingUnit==SentinelBuilding_ShopAccessorizer or sellingUnit==SentinelBuilding_ShopChimaera or sellingUnit==SentinelBuilding_Shop1 or sellingUnit==SentinelBuilding_Shop2 or sellingUnit==SentinelBuilding_Shop3 or sellingUnit==SentinelBuilding_Shop4 or sellingUnit==SentinelBuilding_Shop5 or sellingUnit==SentinelBuilding_Shop6 then
    return GetRectCenterX(gg_rct_Hero_Creation_NE)
  elseif sellingUnit==ScourgeBuilding_ShopGateway or sellingUnit==ScourgeBuilding_ShopWeapon or sellingUnit==ScourgeBuilding_ShopAccessorizer or sellingUnit==ScourgeBuilding_ShopGraveyard or sellingUnit==ScourgeBuilding_Shop1 or sellingUnit==ScourgeBuilding_Shop2 or sellingUnit==ScourgeBuilding_Shop3 or sellingUnit==ScourgeBuilding_Shop4 or sellingUnit==ScourgeBuilding_Shop5 or sellingUnit==ScourgeBuilding_Shop6 then
    return GetRectCenterX(gg_rct_Hero_Creation_UD)
  endif
  return GetUnitX(soldUnit)
endfunction

function UnitItem_GetBestYOld takes unit sellingUnit,unit soldUnit returns real
  if sellingUnit==SentinelBuilding_ShopCache or sellingUnit==SentinelBuilding_ShopWeapon or sellingUnit==SentinelBuilding_ShopAccessorizer or sellingUnit==SentinelBuilding_ShopChimaera or sellingUnit==SentinelBuilding_Shop1 or sellingUnit==SentinelBuilding_Shop2 or sellingUnit==SentinelBuilding_Shop3 or sellingUnit==SentinelBuilding_Shop4 or sellingUnit==SentinelBuilding_Shop5 or sellingUnit==SentinelBuilding_Shop6 then
    return GetRectCenterY(gg_rct_Hero_Creation_NE)
  elseif sellingUnit==ScourgeBuilding_ShopGateway or sellingUnit==ScourgeBuilding_ShopWeapon or sellingUnit==ScourgeBuilding_ShopAccessorizer or sellingUnit==ScourgeBuilding_ShopGraveyard or sellingUnit==ScourgeBuilding_Shop1 or sellingUnit==ScourgeBuilding_Shop2 or sellingUnit==ScourgeBuilding_Shop3 or sellingUnit==ScourgeBuilding_Shop4 or sellingUnit==ScourgeBuilding_Shop5 or sellingUnit==ScourgeBuilding_Shop6 then
    return GetRectCenterY(gg_rct_Hero_Creation_UD)
  endif
  return GetUnitY(soldUnit)
endfunction

function UnitItem_Delayed_Expire takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local unit u=(LoadUnitHandle(hashtable019,(Cache),(53)))
  local unit s=(LoadUnitHandle(hashtable019,(Cache),(94)))
  local integer indexId=(LoadInteger(hashtable019,(Cache),(93)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local integer charges=(LoadInteger(hashtable019,(Cache),(76)))
  call CheckFuse(p,u,s,FindRealIndexId(indexId),x,y,charges,0)
  call ShowUnit(u,false)
  call UnitApplyTimedLife(u,'BTLF',2)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set p=null
  set u=null
  set s=null
  return false
endfunction

function UnitItem_Main takes nothing returns nothing
  local unit u=GetSoldUnit()
  local player p=GetOwningPlayer(u)
  local integer indexId=UnitToIndex(u)
  local real x
  local real y
  //call echo(Id2String(GetUnitTypeId(u)))
  if GetUnitTypeId(u)=='h03Q' and not FlyingCourierAllowed then
    call Error(p,"You cant buy Flying courier until 3 minutes mark.")
    call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+220)
    set u=null
    return
  endif
  if UnitItem_RestrictBuying(GetSellingUnit(),u)then
    call Error(p,GetObjectName('n02G'))
    if IsUnitAlly(u,Sentinels[0])then
      set p=Scourges[0]
    else
      set p=Sentinels[0]
    endif
    set x=UnitItem_GetBestXOld(GetSellingUnit(),u)
    set y=UnitItem_GetBestYOld(GetSellingUnit(),u)
    call DelayedItemCreation(Item_Dummy[UnitToIndex(u)],x,y,p,true,FG9(UnitToIndex(u)))
  else
    call ItemStats_Track(p,FindRealIndexId(indexId))
    if Item_Real[indexId]==0 then
      call Error(p,GetObjectName('n02H'))
    else
      set x=UnitItem_GetBestX(GetSellingUnit(),u)
      set y=UnitItem_GetBestY(GetSellingUnit(),u)
      
      if indexId==indexid_dustofappearance then
        call CheckFuse(p,u,GetSellingUnit(),FindRealIndexId(indexId),x,y,2,0)
      else
        call CheckFuse(p,u,GetSellingUnit(),FindRealIndexId(indexId),x,y,0,0)
      endif
    endif
  endif
  call UnitAddAbility(u,'Aloc')
  call ShowUnit(u,false)
  call UnitApplyTimedLife(u,'BTLF',2)
  set u=null
  set p=null
endfunction

function UnitItem_Enter takes nothing returns boolean
  if fake_item_buy==false then
    if GetUnitPointValue(GetSoldUnit())>=200 then
      call UnitItem_Main()
      if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(GetSoldUnit()))or(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2))then
        if GetUnitTypeId(GetSoldUnit())=='h02F' then
          call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,20,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(IL7[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName('n0HU')+"|r")
        elseif GetUnitTypeId(GetSoldUnit())=='h03Q' and FlyingCourierAllowed then
          call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,20,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(IL7[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName('n0KG')+"|r")
        elseif GetUnitTypeId(GetSoldUnit())=='h076' then
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(IL7[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName('n0KO')+"|r")
        elseif GetUnitTypeId(GetSoldUnit())=='h02C' then
          call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(IL7[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName('n0KP')+"|r")
        elseif GetUnitTypeId(GetSoldUnit())=='h02D' then
          call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(IL7[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName('n0KQ')+"|r")
        elseif GetUnitTypeId(GetSoldUnit())=='h0BA' then
          call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(IL7[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName('n0KT')+"|r")
        elseif GetUnitTypeId(GetSoldUnit())=='h01G' then
          call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(IL7[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName('n0LB')+"|r")
        elseif GetUnitTypeId(GetSoldUnit())=='h0D3' then
          call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(IL7[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName('n0LP')+"|r")
        endif
      endif
    else
      call DeliverItems_Main()
    endif
  endif
  return false
endfunction

function BY9 takes unit u returns boolean
  local integer id=GetUnitTypeId(u)
  return id=='Eevi' or id=='Eevm' or id=='E02V' or id=='E02W' or id=='E02U'
endfunction

function RestrictedItems_UpdateMeleeRange takes unit Hero,item Item returns nothing
  local unit u=Hero
  local integer unitId=GetUnitTypeId(u)
  local integer indexId=GetIndexNoMute(Item)
  if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER) or IsUnitType(u,UNIT_TYPE_HERO)==false then
    if indexId==indexid_EyeOfSkadiRanged then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_EyeOfSkadi])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_QuellingBladeRanged then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_QuellingBlade])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_StoutShieldRanged then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_StoutShield])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_PoormansShieldRanged then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_PoormansShield])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_VanguardRanged then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_Vanguard])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_OrbOfVenomRanged then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_OrbOfVenom])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_MantaStyleRanged then
      if BY9(u)==false then
        set tt_player1=GetItemPlayer(Item)
        call DestroyItem(Item)
        set tt_item1=UnitAddItemById(u,Item_Real[indexid_MantaStyle])
        call SetItemPlayer(tt_item1,tt_player1,false)
        call SetItemUserData(tt_item1,1)
      endif
    elseif indexId==indexid_MantaStyle then
      if BY9(u) then
        set tt_player1=GetItemPlayer(Item)
        call DestroyItem(Item)
        set tt_item1=UnitAddItemById(u,Item_Real[indexid_MantaStyleRanged])
        call SetItemPlayer(tt_item1,tt_player1,false)
        call SetItemUserData(tt_item1,1)
      endif
    elseif indexId==indexid_corruptorranged then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_corruptor])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    endif
  else
    if indexId==indexid_EyeOfSkadi then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_EyeOfSkadiRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_QuellingBlade then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_QuellingBladeRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_StoutShield then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_StoutShieldRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_PoormansShield then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_PoormansShieldRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_Vanguard then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_VanguardRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_OrbOfVenom then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_OrbOfVenomRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_MantaStyle then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_MantaStyleRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_corruptor then
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_corruptorranged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    endif
  endif
  set u=null
endfunction

function RestrictedItems_UpdateMeleeRange2 takes unit Hero,item Item returns nothing
  local unit u=Hero
  local integer unitId=GetUnitTypeId(u)
  local integer indexId=GetIndexNoMute(Item)
  if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==false or IsUnitType(u,UNIT_TYPE_HERO)==false then
    if indexId==indexid_EyeOfSkadiRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_EyeOfSkadi])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_QuellingBladeRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_QuellingBlade])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_StoutShieldRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_StoutShield])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_PoormansShieldRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_PoormansShield])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_VanguardRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_Vanguard])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_OrbOfVenomRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_OrbOfVenom])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_MantaStyleRanged then
      if BY9(u)==false then
        set tt_player1=GetItemPlayer(Item)
        call RemoveItem(Item)
        set tt_item1=UnitAddItemById(u,Item_Real[indexid_MantaStyle])
        call SetItemPlayer(tt_item1,tt_player1,false)
        call SetItemUserData(tt_item1,1)
      endif
    elseif indexId==indexid_corruptorranged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_corruptor])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    endif
  else
    if indexId==indexid_EyeOfSkadi then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_EyeOfSkadiRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_QuellingBlade then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_QuellingBladeRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_StoutShield then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_StoutShieldRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_PoormansShield then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_PoormansShieldRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_Vanguard then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_VanguardRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_OrbOfVenom then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_OrbOfVenomRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_MantaStyle then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_MantaStyleRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_corruptor then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_corruptorranged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    endif
  endif
  set u=null
endfunction

function RestrictedItems_UpdateMeleeRange_All takes unit Hero returns nothing
  local integer i=0
  local item Item
  call DisableTrigger(t_manipulateitem)
  loop
    exitwhen i>5
    set Item=UnitItemInSlot(Hero,i)
    if Item!=null then
      call RestrictedItems_UpdateMeleeRange2(Hero,Item)
    endif
    set i=i+1
  endloop
  call EnableTrigger(t_manipulateitem)
  set Item=null
endfunction

function RestrictedItems takes unit Hero,item Item returns boolean
  local unit u=Hero
  local integer unitId=GetUnitTypeId(u)
  local integer indexId=GetIndex(Item)
  local real x
  local real y
  local boolean continue=true
  set x=GetUnitX(u)
  set y=GetUnitY(u)
  if indexId==indexid_Bottle0Shop then
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl",u,"overhead"))
    call SoundForPlayer(GetOwningPlayer(u),"Abilities\\Spells\\Human\\Heal\\HealTarget.wav")
    set tt_player1=GetItemPlayer(Item)
    call DestroyItem(Item)
    set tt_item1=UnitAddItemById(u,Item_Real[indexid_bottle3])
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    call UnitRemoveAbility(u,'B0GI')
  endif
  if (indexId)==indexid_DiffusalBlade and GetItemCharges(Item)==0 then
    set tt_player1=GetItemPlayer(Item)
    call DestroyItem(Item)
    set tt_item1=UnitAddItemById(u,Item_Real[indexid_DiffusalBlade_empty])
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  endif
  if indexId==indexid_janggo and GetItemCharges(Item)==0 then
    set tt_player1=GetItemPlayer(Item)
    call DestroyItem(Item)
    set tt_item1=UnitAddItemById(u,Item_Real[indexid_janggoempty])
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  endif
  call DisableTrigger(t_manipulateitem)
  if(indexId==indexid_PowerTreadsStrength or indexId==indexid_PowerTreadsAgility or indexId==indexid_PowerTreadsIntelligence)and(FindItemOfTypeEx(u,Item_Real[indexid_PowerTreadsStrength],Item)!=null or FindItemOfTypeEx(u,Item_Real[indexid_PowerTreadsAgility],Item)!=null or FindItemOfTypeEx(u,Item_Real[indexid_PowerTreadsIntelligence],Item)!=null)then
    call Error(GetOwningPlayer(u),GetObjectName('n02L'))
    set tt_player1=GetItemPlayer(Item)
    call RemoveItem(Item)
    set tt_item1=CreateItem(Item_Dummy[indexId],x,y)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  endif
  if(indexId==indexid_QuellingBlade)and(FindItemOfTypeEx(u,Item_Real[indexid_QuellingBlade],Item)!=null or FindItemOfTypeEx(u,Item_Real[indexid_QuellingBladeRanged],Item)!=null)then
    call Error(GetOwningPlayer(u),GetObjectName('n0HL'))
    set tt_player1=GetItemPlayer(Item)
    call RemoveItem(Item)
    set tt_item1=CreateItem(Item_Dummy[indexId],x,y)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    set continue=false
  endif
  if continue and(indexId==indexid_QuellingBladeRanged)and(FindItemOfTypeEx(u,Item_Real[indexid_QuellingBlade],Item)!=null or FindItemOfTypeEx(u,Item_Real[indexid_QuellingBladeRanged],Item)!=null)then
    call Error(GetOwningPlayer(u),GetObjectName('n0HL'))
    set tt_player1=GetItemPlayer(Item)
    call RemoveItem(Item)
    set tt_item1=CreateItem(Item_Dummy[indexId],x,y)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    set continue=false
  endif
  if(indexId==indexid_ArmletOff or indexId==indexid_ArmletOn or indexId==indexid_ArmletOffCourier or indexId==indexid_ArmletOnCourier)and(FindItemOfTypeEx(u,Item_Real[indexid_ArmletOff],Item)!=null or FindItemOfTypeEx(u,Item_Real[indexid_ArmletOn],Item)!=null or FindItemOfTypeEx(u,Item_Real[indexid_ArmletOffCourier],Item)!=null or FindItemOfTypeEx(u,Item_Real[indexid_ArmletOnCourier],Item)!=null)then
    call Error(GetOwningPlayer(u),GetObjectName('n02C'))
    set tt_player1=GetItemPlayer(Item)
    call RemoveItem(Item)
    set tt_item1=CreateItem(Item_Dummy[indexId],x,y)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  endif
  if(indexId==indexid_DivineRapier and IsPlayerEnemy(GetItemPlayer(Item),GetOwningPlayer(u)))then
    set tt_player1=GetItemPlayer(Item)
    call DestroyItem(Item)
    set tt_item1=UnitAddItemById(u,Item_Real[indexid_DivineRapierFree])
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  endif
  if(indexId==indexid_Aegis)and(IsFlyingCourier(u)or IsSpiritBear(u))then
    if IsFlyingCourier(u)then
      call Error(GetOwningPlayer(u),GetObjectName('n02K'))
    endif
    set tt_player1=GetItemPlayer(Item)
    set tt_int1=GetItemCharges(Item)
    call RemoveItem(Item)
    if indexId==indexid_Aegis then
      set tt_item1=CreateItem(Item_Dummy[indexId],GetRectCenterX(Q4),GetRectCenterY(Q4))
    endif
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    if indexId==indexid_Aegis then
      call SetItemCharges(tt_item1,tt_int1)
    endif
  endif
  //if indexId==indexid_KelensDagger and(isPlayerPickedAbility(GetOwningPlayer(u),1*4)or isPlayerPickedAbility(GetOwningPlayer(u),(77*4)-3))then//[lich] dagger allow for all
  //	call Error(GetOwningPlayer(u),GetObjectName('n02J'))
  //	set tt_player1=GetItemPlayer(Item)
  //	call RemoveItem(Item)
  //	set tt_item1=CreateItem(Item_Dummy[indexId],x,y)
  //	call SetItemPlayer(tt_item1,tt_player1,false)
  //	call SetItemUserData(tt_item1,1)
  //endif
  //if continue and(indexId==indexid_QuellingBlade or indexId==indexid_QuellingBladeRanged)and isPlayerPickedAbility(GetOwningPlayer(u),(46*4)-2)then
  //	call Error(GetOwningPlayer(u),GetObjectName('n02J'))
  //	set tt_player1=GetItemPlayer(Item)
  //	call RemoveItem(Item)
  //	set tt_item1=CreateItem(Item_Dummy[indexId],x,y)
  //	call SetItemPlayer(tt_item1,tt_player1,false)
  //	call SetItemUserData(tt_item1,1)
  //	set continue=false
  //endif
  if(indexId==indexid_BlackKingBar10 or indexId==indexid_BlackKingBar09 or indexId==indexid_BlackKingBar08 or indexId==indexid_BlackKingBar07 or indexId==indexid_BlackKingBar06 or indexId==indexid_BlackKingBar05)and unitId=='U00C' then
    call DisplayTimedTextToPlayer(GetOwningPlayer(u),0,group008,10,"|c00ff0303"+GetObjectName('n02P')+"|r")
  endif
  call EnableTrigger(t_manipulateitem)
  if continue then
    call RestrictedItems_UpdateMeleeRange(Hero,Item)
  endif
  set u=null
  set Item=null
  return false
endfunction

function B69 takes integer indexId returns boolean
  return indexId==indexid_HelmOfTheDominatorCourier or indexId==indexid_ArmletOnCourier or indexId==indexid_ArmletOffCourier or indexId==indexid_ShivasGuardCourier or indexId==indexid_HelmOfTheDominator or indexId==indexid_ArmletOn or indexId==indexid_ArmletOff or indexId==indexid_ShivasGuard or indexId==indexid_Gem or indexId==indexid_GemCourier or indexId==indexid_HandOfMidas or indexId==indexid_HandOfMidasCourier
endfunction

function BL9 takes integer indexId returns boolean
  return indexId==indexid_Gem or indexId==indexid_GemCourier
endfunction

function B19 takes unit Hero,item Item returns boolean
  local integer FN9=0
  local item B38=Item
  local integer indexId=F49(B38)
  local integer B09=0
  local boolean result=false
  local integer B59=F79(B38)
  local boolean B29=false
  if IsUnitType(Hero,UNIT_TYPE_HERO) then
    if indexId==indexid_HelmOfTheDominatorCourier then
      set B09=indexid_HelmOfTheDominator
    endif
    if indexId==indexid_HandOfMidasCourier then
      set B09=indexid_HandOfMidas
    endif
    if indexId==indexid_ArmletOnCourier then
      set B09=indexid_ArmletOn
    endif
    if indexId==indexid_ArmletOffCourier then
      set B09=indexid_ArmletOff
    endif
    if indexId==indexid_ShivasGuardCourier then
      set B09=indexid_ShivasGuard
    endif
    if indexId==indexid_GemCourier then
      set B09=indexid_Gem
    endif
    if B59==indexid_GemCourier then
      set B09=indexid_Gem
      set B29=true
    endif
    if B09!=0 then
      set tt_player1=GetItemPlayer(B38)
      call DestroyItem(B38)
      if B29 then
        set tt_item1=UnitAddItemById(Hero,Item_Mute[B09])
      else
        set tt_item1=UnitAddItemById(Hero,Item_Real[B09])
      endif
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
      set result=true
    endif
  else
    if indexId==indexid_HelmOfTheDominator then
      set B09=indexid_HelmOfTheDominatorCourier
    endif
    if indexId==indexid_HandOfMidas then
      set B09=indexid_HandOfMidasCourier
    endif
    if indexId==indexid_ArmletOn then
      set B09=indexid_ArmletOnCourier
    endif
    if indexId==indexid_ArmletOff then
      set B09=indexid_ArmletOffCourier
    endif
    if indexId==indexid_ShivasGuard then
      set B09=indexid_ShivasGuardCourier
    endif
    if indexId==indexid_Gem then
      set B09=indexid_GemCourier
    endif
    if B59==indexid_Gem then
      set B09=indexid_GemCourier
      set B29=true
    endif
    if B09!=0 then
      set tt_player1=GetItemPlayer(B38)
      call DestroyItem(B38)
      if B29 then
        set tt_item1=UnitAddItemById(Hero,Item_Mute[B09])
      else
        set tt_item1=UnitAddItemById(Hero,Item_Real[B09])
      endif
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
      set result=true
    endif
  endif
  set B38=null
  return result
endfunction

function CourierFakedItems_Main takes unit Hero,item Item returns boolean
  if B69(F49(Item))or BL9(F79(Item))then
    return B19(Hero,Item)
  endif
  return false
endfunction

function GetAghaIdByBase takes integer id returns integer
  local integer i=1
  local integer k=0
  loop
    if AghaBaseSpellID[i]==id then
      set k=i
    endif
    set i=i+1
    exitwhen k>0 or i>AghaCounter
  endloop
  return k
endfunction

function C79 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Unit=(LoadUnitHandle(hashtable019,(Cache),(26)))
  local integer EventType=(LoadInteger(hashtable019,(Cache),(97)))
  local integer indexId=(LoadInteger(hashtable019,(Cache),(93)))
  local boolean temporary=(LoadBoolean(hashtable019,(Cache),(95)))
  local item Item
  local player p=GetOwningPlayer(Unit)
  local player owner
  local integer charges
  local boolean consumable=false
  local item newItem
  local integer scepter_indexid
  local integer scepter_abilityid
  local integer scepter_hiddenabilityid
  local integer newCharges
  local item targetItem
  local integer targetCount
  local item FinalItem
  local boolean finished=false
  local integer i
  local integer k
  call DisableTrigger(VQ7)
  if temporary then
    set FinalItem=null
    set owner=(LoadPlayerHandle(hashtable019,(Cache),(54)))
    set charges=(LoadInteger(hashtable019,(Cache),(76)))
  else
    set Item=(LoadItemHandle(hashtable019,(Cache),(96)))
    set FinalItem=Item
    set owner=GetItemPlayer(Item)
    set charges=GetItemCharges(Item)
  endif
  if temporary==false and Item==null then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call EnableTrigger(VQ7)
    set t=null
    set Unit=null
    set p=null
    return false
  endif
  if EventType==1 then
    if p!=owner and GetUnitTypeId(Unit)=='ncop' then
      if IsIndexIdConsumable(FindRealIndexId(indexId))or IsIndexIdCharged(FindRealIndexId(indexId))then
        set consumable=true
      endif
      if IsPlayerEnemy(p,owner)then
        call DelayedItemCreation(Item_Dummy[indexId],ItemSpawnX[GetPlayerId(p)],ItemSpawnY[GetPlayerId(p)],owner,consumable,charges)
      else
        call DelayedItemCreation(Item_Dummy[indexId],ItemSpawnX[GetPlayerId(owner)],ItemSpawnY[GetPlayerId(owner)],owner,consumable,charges)
      endif
      call Error(p,GetObjectName('n0DR'))
      if temporary==false then
        set finished=true
        call DestroyItem(Item)
      endif
    elseif Mode_PM==false and temporary==false and GetItemType(Item)==ITEM_TYPE_CAMPAIGN and MuteToRealId(Item)!=0 and(p==owner or(GetPlayerSlotState((owner))==PLAYER_SLOT_STATE_LEFT))then
      if IsIndexIdCharged(indexId)then
        set consumable=true
      else
        set consumable=false
      endif
      if(GetPlayerSlotState((owner))==PLAYER_SLOT_STATE_LEFT)and Bottle_IsIndexRune(indexId)then
      else
        call DestroyItem(Item)
        set finished=true
        set newItem=UnitAddItemById(Unit,Item_Real[indexId])
        set FinalItem=newItem
        call SetItemPlayer(newItem,owner,false)
        call SetItemUserData(newItem,0)
        if consumable or (indexId==indexid_Tango or indexId==indexid_HealingSalve or indexId==indexid_ClarityPotion) then
          call SetItemCharges(newItem,charges)
        endif
      endif
    elseif Mode_PM==false and temporary==false and (GetItemType(Item)==ITEM_TYPE_PERMANENT ) and p!=owner and Item_Mute[GetIndex(Item)]!=0 and(GetPlayerSlotState((owner))==PLAYER_SLOT_STATE_LEFT)==false then
      
      if IsIndexIdCharged(indexId)then
        set consumable=true
      else
        set consumable=false
      endif
      call DestroyItem(Item)
      set finished=true
      set newItem=UnitAddItemById(Unit,Item_Mute[indexId])
      set FinalItem=newItem
      call SetItemPlayer(newItem,owner,false)
      call SetItemUserData(newItem,0)
      if consumable then
        call SetItemCharges(newItem,charges)
      endif
    elseif temporary==false and GetItemType(Item)==ITEM_TYPE_PERMANENT and ET9(Item)and IsUnitType(Unit,UNIT_TYPE_HERO) then
      set scepter_indexid=GetScepterIndexId(GetPlayerId(GetOwningPlayer(Unit)))
      set scepter_abilityid=GetScepterAbilityId(Unit)
      set scepter_hiddenabilityid=GetScepterHiddenAbilityId(Unit)
      if scepter_abilityid=='A2S7' or scepter_abilityid=='A237' then//guardian angel or calldown?
        if isPlayerPickedAbility(GetOwningPlayer(Unit),76) then//rearm?
          set scepter_abilityid=0
        endif
      endif
      if isPlayerPickedAbility(GetOwningPlayer(Unit),74) or isPlayerPickedAbility(GetOwningPlayer(Unit),73)then
        call UnitAddAbility2(Unit,'A33H')
        call SetPlayerAbilityAvailable(GetOwningPlayer(Unit),'A33H',false)
      endif
      if Mode_BO or Mode_MA then
        if Mode_S6 then
          set i=GetPlayerId(GetOwningPlayer(Unit))*PlayerSkillOffset
          set k=GetAghaIdByBase(SkillID[PlayerSkillNumber[i+6]])
          if (k==0 and SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Unit))*PlayerSkillOffset+6]]=='A088') or (k>0 and isPlayerPickedAbility(GetOwningPlayer(Unit),76)==false) or (k>0 and isPlayerPickedAbility(GetOwningPlayer(Unit),76) and SkillID[PlayerSkillNumber[i+6]]!='A0ER' and SkillID[PlayerSkillNumber[i+6]]!='A1T5' and SkillID[PlayerSkillNumber[i+4]]!='A0ER' and SkillID[PlayerSkillNumber[i+4]]!='A1T5') then
            call UnitAddAbility2(Unit,AghaUpgradeID[k])
            call UnitMakeAbilityPermanent(Unit,true,AghaUpgradedSpellID[k])
            call SetPlayerAbilityAvailable(GetOwningPlayer(Unit),AghaUpgradeID[k],false)
            if SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Unit))*PlayerSkillOffset+6]]=='A088' then
              set tt_unit1=Unit
              call ExeFunc("AghaFireblast_Add")
            endif
          endif
        endif
      endif
      if scepter_abilityid!=0 then
        call UnitAddAbility2(Unit,scepter_abilityid)
        call UnitMakeAbilityPermanent(Unit,true,scepter_abilityid)
        call SetPlayerAbilityAvailable2(p,scepter_abilityid,false)
        if scepter_hiddenabilityid!=0 then
          call UnitMakeAbilityPermanent(Unit,true,scepter_hiddenabilityid)
        endif
        if GetUnitTypeId(Unit)=='H00U' then
          set tt_unit1=Unit
          call ExeFunc("CJ9")
        endif
        if UltimatesHeroId[GetPlayerId(GetOwningPlayer(Unit))]=='Hmkg' then
          set tt_unit1=Unit
          call ExeFunc("AghaFireblast_Add")
        endif
      endif
      if indexId!=scepter_indexid then
        call DestroyItem(Item)
        set newItem=UnitAddItemById(Unit,Item_Real[scepter_indexid])
        set FinalItem=newItem
        call SetItemPlayer(newItem,owner,false)
        call SetItemUserData(newItem,1)
      endif
    elseif temporary==false and GetItemType(Item)==ITEM_TYPE_ARTIFACT then
      //call BJDebugMsg("4")
      if (p!=owner and IsPlayerLeaver(owner)==false and (indexId==indexid_Tango or indexId==indexid_HealingSalve or indexId==indexid_ClarityPotion)) then
        call DisableTrigger(t_manipulateitem)
        call DestroyItem(Item)
        set newItem=UnitAddItemById(Unit,Item_Mute[indexId])
        set FinalItem=newItem
        call SetItemPlayer(newItem,owner,false)
        call SetItemUserData(newItem,1)
        call SetItemCharges(newItem,charges)
        call EnableTrigger(t_manipulateitem)
        
      else
        call DisableTrigger(t_manipulateitem)
        set targetItem=FindItemOfIndexExForPlayer(owner,Unit,indexId,Item)
        if targetItem==null then
        else
          call SetItemCharges(targetItem,charges+GetItemCharges(targetItem))
          call DestroyItem(Item)
          set FinalItem=null
        endif
        call EnableTrigger(t_manipulateitem)
      endif
    elseif temporary and IsIndexIdConsumable(FindRealIndexId(indexId))then
      //call BJDebugMsg("5")
      if (p==owner) then
        call DisableTrigger(t_manipulateitem)
        if GetEmptyInventorySlots(Unit)==0 and FindItemOfIndexForPlayer(owner,Unit,indexId)==null then
          call Error(p,GetObjectName('n02O'))
          call DelayedItemCreation(Item_Dummy[(indexId)],(((LoadReal(hashtable019,(Cache),(6))))*1.),(((LoadReal(hashtable019,(Cache),(7))))*1.),(owner),(true),(charges))
        else
          set targetItem=FindItemOfIndexForPlayer(owner,Unit,indexId)
          if targetItem==null then
            call DisableTrigger(t_manipulateitem)
            set newItem=UnitAddItemById(Unit,Item_Real[indexId])
            set FinalItem=newItem
            call SetItemPlayer(newItem,owner,false)
            call SetItemUserData(newItem,1)
            call SetItemCharges(newItem,charges)
          else
            call SetItemCharges(targetItem,charges+GetItemCharges(targetItem))
          endif
        endif
        call EnableTrigger(t_manipulateitem)
      else
        
        if Item_Mute[indexId]>0 then
          set tt_int1=Item_Mute[indexId]
        else
          set tt_int1=Item_Real[indexId]
        endif
        call DisableTrigger(t_manipulateitem)
        
        set targetItem=FindItemOfIndexForPlayer(owner,Unit,indexId)
        if targetItem==null and GetEmptyInventorySlots(Unit)!=0 then
          
          set newItem=UnitAddItemById(Unit,tt_int1)
          set FinalItem=newItem
          call SetItemPlayer(newItem,owner,false)
          call SetItemUserData(newItem,1)
          call SetItemCharges(newItem,charges)
          
        elseif targetItem==null and GetEmptyInventorySlots(Unit)==0 then
          
          
        else
          call SetItemCharges(targetItem,charges+GetItemCharges(targetItem))
        endif
        call EnableTrigger(t_manipulateitem)
        
      endif
    elseif temporary then
      call CheckFuse(owner,Unit,null,indexId,(LoadReal(hashtable019,(Cache),(6))),(LoadReal(hashtable019,(Cache),(7))),charges,1)
    elseif temporary==false and(GetItemType(Item)==ITEM_TYPE_PERMANENT or GetItemType(Item)==ITEM_TYPE_CAMPAIGN)then
      //call BJDebugMsg("8")
      call SetItemUserData(Item,1)
      set finished=AttemptFuse(owner,Unit,0)
    endif
    if finished==false and FinalItem!=null and IsItemTemporary(FinalItem)==false then
      set finished=CourierFakedItems_Main(Unit,FinalItem)
    endif
    if finished==false and FinalItem!=null and IsItemTemporary(FinalItem)==false then
      call RestrictedItems(Unit,FinalItem)
    endif
  else
    if GetWidgetLife(Item)>0 then
      set scepter_indexid=GetScepterIndexId(GetPlayerId(GetOwningPlayer(Unit)))
      set scepter_abilityid=GetScepterAbilityId(Unit)
      if FindItemOfType(Unit,Item_Real[scepter_indexid])==null then
        if GetUnitAbilityLevel(Unit,'A33H')>0 then
          call UnitRemoveAbility(Unit,'A33H')
        endif
        if scepter_abilityid>0 then
          call UnitRemoveAbility(Unit,scepter_abilityid)
        endif
        if Mode_MA or Mode_BO then
          if Mode_S6 then
            set k=GetAghaIdByBase(SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Unit))*PlayerSkillOffset+6]])
            if k>0 then
              call UnitRemoveAbility(Unit,AghaUpgradeID[k])
            endif
            if SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Unit))*PlayerSkillOffset+6]]=='A088' then
              set tt_unit1=Unit
              call ExeFunc("AghaFireblast_Remove")
            endif
          endif
        endif
        
        if UltimatesHeroId[GetPlayerId(GetOwningPlayer(Unit))]=='Hmkg' then
          set tt_unit1=Unit
          call ExeFunc("AghaFireblast_Remove")
        endif
      endif
      if IsItemOwned(Item)==false then
        if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(indexId) or indexId==indexid_HealingSalve or indexId==indexid_ClarityPotion or indexId==indexid_Tango then
          set consumable=true
        endif
        
        call DelayedItemCreation(Item_Dummy[indexId],GetItemX(Item),GetItemY(Item),owner,consumable,charges)
        call DestroyItem(Item)
      endif
    endif
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call EnableTrigger(VQ7)
  set t=null
  set Item=null
  set Unit=null
  set p=null
  set owner=null
  set newItem=null
  set targetItem=null
  set FinalItem=null
  return false
endfunction

function DelayTrigger_Expire takes nothing returns boolean
  call EnableTrigger(t_manipulateitem)
  call CleanTrigger(GetTriggeringTrigger())
  return false
endfunction

function DelayTrigger takes nothing returns nothing
  local trigger t=CreateTrigger()
  call DisableTrigger(t_manipulateitem)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function DelayTrigger_Expire))
  set t=null
endfunction

function CM9 takes nothing returns boolean
  local item Item
  local integer EventType
  local unit Unit=GetTriggerUnit()
  local trigger t
  local integer Cache
  local integer scepter_indexid
  local integer scepter_abilityid
  local integer id
  local integer k
  local item it
  set id=GetPlayerId(GetOwningPlayer(Unit))
  
  if(IsUnitType(Unit,UNIT_TYPE_HERO) or IsSpiritBear(Unit))and IsUnitIllusion(Unit)==false then
    if GetTriggerEventId()==EVENT_PLAYER_UNIT_PICKUP_ITEM then
      
      
      
      if GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_javelin]then
        set HasItem_Javelin[id]=HasItem_Javelin[id]+1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_KelensDagger]then
        set TotalCount_Dagger=TotalCount_Dagger+1
        set HasItem_Dagger[id]=HasItem_Dagger[id]+1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_bloodstone]then
        set TotalCount_Bloodstone=TotalCount_Bloodstone+1
        set HasItem_Bloodstone[id]=HasItem_Bloodstone[id]+1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_CraniumBasher]or (GetItemTypeId(GetManipulatedItem()))==Item_Real[indexid_AbyssalBlade]then
        set HasItem_CraniumBasher[id]=HasItem_CraniumBasher[id]+1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_HeartOfTarrasque]then
        set TotalCount_Heart=TotalCount_Heart+1
        set HasItem_Heart[id]=HasItem_Heart[id]+1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_LinkensSphere]then
        set TotalCount_LinkenSphere=TotalCount_LinkenSphere+1
        set HasItem_LinkenSphere[id]=HasItem_LinkenSphere[id]+1
        call DisableTrigger(t_manipulateitem)
        set it=CreateItem('I0HM',GetUnitX(Unit),GetUnitY(Unit))
        call UnitAddItem(Unit,it)
        if GetWidgetLife(it)>0 then
          call RemoveItem(it)
        endif
        set it=null
        call EnableTrigger(t_manipulateitem)
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_SangeAndYasha]then
        set HasItem_SangeNYasha[id]=HasItem_SangeNYasha[id]+1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_Sange]then
        set HasItem_Sange[id]=HasItem_Sange[id]+1
      elseif (GetItemTypeId(GetManipulatedItem()))==Item_Real[indexid_HeavensHalberd]then
        set HasItem_HeavensHalberd[id]=HasItem_HeavensHalberd[id]+1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_TranquilBoots]then
        set VN7=VN7+1
        set HasItem_TranquilBoots[id]=HasItem_TranquilBoots[id]+1
      endif
    elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_DROP_ITEM then
      
      
      
      if GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_javelin]then
        set HasItem_Javelin[id]=HasItem_Javelin[id]-1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_KelensDagger]then
        set HasItem_Dagger[id]=HasItem_Dagger[id]-1
        set TotalCount_Dagger=TotalCount_Dagger-1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_TranquilBoots]then
        set HasItem_TranquilBoots[id]=HasItem_TranquilBoots[id]-1
        set VN7=VN7-1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_bloodstone]then
        set HasItem_Bloodstone[id]=HasItem_Bloodstone[id]-1
        set TotalCount_Bloodstone=TotalCount_Bloodstone-1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_CraniumBasher]or (GetItemTypeId(GetManipulatedItem()))==Item_Real[indexid_AbyssalBlade]then
        set HasItem_CraniumBasher[id]=HasItem_CraniumBasher[id]-1
        if HasItem_CraniumBasher[id]<1 or FindItemOfTypeEx(Unit,Item_Real[indexid_CraniumBasher],GetManipulatedItem())==null or FindItemOfTypeEx(Unit,Item_Real[indexid_AbyssalBlade],GetManipulatedItem())==null then
          call UnitRemoveAbility(Unit,'A174')
        endif
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_HeartOfTarrasque]then
        set HasItem_Heart[id]=HasItem_Heart[id]-1
        set TotalCount_Heart=TotalCount_Heart-1
      elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_LinkensSphere]or GetItemTypeId(GetManipulatedItem())==Item_Mute[indexid_LinkensSphere]then
        set TotalCount_LinkenSphere=IMaxBJ(TotalCount_LinkenSphere-1,0)
        set HasItem_LinkenSphere[id]=IMaxBJ(HasItem_LinkenSphere[id]-1,0)
        call UnitRemoveAbility(Unit,'B0BI')
      endif
    endif
  endif
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_PAWN_ITEM then
    set Item=GetSoldItem()
    call SetItemUserData(Item,-2)
    set scepter_indexid=GetScepterIndexId(GetPlayerId(GetOwningPlayer(Unit)))
    set scepter_abilityid=GetScepterAbilityId(Unit)
    if FindItemOfTypeEx(Unit,Item_Real[scepter_indexid],Item)==null and GetUnitAbilityLevel(Unit,scepter_abilityid)>0 then
      if Mode_MA or Mode_BO  then
        if Mode_S6 then
          set k=GetAghaIdByBase(SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Unit))*PlayerSkillOffset+6]])
          if k>0 then
            call UnitRemoveAbility(Unit,AghaUpgradeID[k])
          endif
          if SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Unit))*PlayerSkillOffset+6]]=='A088' then
            set tt_unit1=Unit
            call ExeFunc("AghaFireblast_Remove")
          endif
        endif
      endif
      call UnitRemoveAbility(Unit,scepter_abilityid)
      if UltimatesHeroId[GetPlayerId(GetOwningPlayer(Unit))]=='Hmkg' then
        set tt_unit1=Unit
        call ExeFunc("AghaFireblast_Remove")
      endif
    endif
  elseif GetItemTypeId(GetManipulatedItem())!='I00E' and GetItemTypeId(GetManipulatedItem())!='I02M' then
    set Item=GetManipulatedItem()
    if IsUnitIllusion(Unit)or GetItemUserData(Item)==-2 then
      set Item=null
      set Unit=null
      set t=null
      return false
    endif
    if GetTriggerEventId()==EVENT_PLAYER_UNIT_PICKUP_ITEM then
      set EventType=1
    else
      set EventType=2
    endif
    if((EventType==1) or(EventType==2 and IsItemTemporary(Item)==false and GetWidgetLife(Item)>0))and GetUnitTypeId(Unit)!='H00J' then
      if IsRune(GetItemTypeId(Item)) or GetItemTypeId(Item)=='I0HM' then
        set Item=null
        set Unit=null
        set t=null
        return false
      endif
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call TriggerRegisterTimerEvent(t,0,false)
      call TriggerAddCondition(t,Condition(function C79))
      call SaveUnitHandle(hashtable019,(Cache),(26),(Unit))
      call SaveInteger(hashtable019,(Cache),(97),(EventType))
      call SaveInteger(hashtable019,(Cache),(93),(GetIndex(Item)))
      call SaveItemHandle(hashtable019,Cache,0,Item)
      if IsItemTemporary(Item)then
        call SaveBoolean(hashtable019,(Cache),(95),(true))
        call SavePlayerHandle(hashtable019,(Cache),(54),(GetItemPlayer(Item)))
        call SaveInteger(hashtable019,(Cache),(76),(GetItemCharges(Item)))
        //call BJDebugMsg(I2S(GetItemCharges(Item)))
        call SaveReal(hashtable019,(Cache),(6),((GetItemX(Item))*1.))
        call SaveReal(hashtable019,(Cache),(7),((GetItemY(Item))*1.))
      else
        call SaveBoolean(hashtable019,(Cache),(95),(false))
        call SaveItemHandle(hashtable019,(Cache),(96),(Item))
        call SetItemUserData(Item,0)
      endif
    endif
  endif
  set Item=null
  set Unit=null
  set t=null
  return false
endfunction

function CN9 takes nothing returns boolean
  if GetSpellAbilityId()=='A1RI' or GetSpellAbilityId()=='A0BE'then
    if IsDead(GetTriggerUnit())==false then
      call RestrictedItems_UpdateMeleeRange_All(GetTriggerUnit())
    endif
  endif
  return false
endfunction

function RestrictedItems_UpdateMeleeRange_All2 takes nothing returns nothing
  call RestrictedItems_UpdateMeleeRange_All(tt_unit1)
endfunction

function CO9 takes unit Hero,integer CP9,boolean CQ9 returns nothing
  local string CR9
  local string s
  local player p=GetOwningPlayer(Hero)
  local real d=2
  local string CS9="Use"
  if CQ9 then
    set CS9="Store"
  endif
  if CP9=='I006' then
    set CR9="|c00ff0000"+GetObjectName('n0JQ')+"|r"
    call Traffic_RegisterData("Rune"+CS9+"1",GetPlayerId(p))
  elseif CP9=='I008' then
    set CR9="|c0000ff00"+GetObjectName('n0JN')+"|r"
    call Traffic_RegisterData("Rune"+CS9+"2",GetPlayerId(p))
  elseif CP9=='I00K' then
    set CR9="|c000000ff"+GetObjectName('n0K3')+"|r"
    call Traffic_RegisterData("Rune"+CS9+"3",GetPlayerId(p))
  elseif CP9=='I007' then
    set CR9="|c00afaf00"+GetObjectName('n0K2')+"|r"
    call Traffic_RegisterData("Rune"+CS9+"4",GetPlayerId(p))
  elseif CP9=='I00J' then
    set CR9="|c00652DC1"+GetObjectName('n0K4')+"|r"
    call Traffic_RegisterData("Rune"+CS9+"5",GetPlayerId(p))
  endif
  if CQ9 then
    set s=udg_Colors[GetPlayerId(p)]+GetUnitName(Hero)+"|r "+GetObjectName('n0GU')+"|r "+CR9+" "+GetObjectName('n0GW')
    set d=1
  else
    if VP7 then
      set s=udg_Colors[GetPlayerId(p)]+GetUnitName(Hero)+"|r "+GetObjectName('n0GV')+"|r "+CR9+" "+GetObjectName('n0GW')
    else
      set s=udg_Colors[GetPlayerId(p)]+GetUnitName(Hero)+"|r "+GetObjectName('n0GT')+"|r "+CR9+" "+GetObjectName('n0GW')
    endif
  endif
  if(IsPlayerAlly(GetLocalPlayer(),p)and GetLocalPlayer()!=p)or IsObserver(GetLocalPlayer())then
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,d,s)
  endif
  set p=null
endfunction


function SmoothHealingSystemDurForBottle takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit target=LoadUnitHandle(hashtable019,h,0)
  local integer buffid=LoadInteger(hashtable019,h,0)
  local real amounthp=LoadReal(hashtable019,h,0)
  local real amountmp=LoadReal(hashtable019,h,1)
  local real duration=LoadReal(hashtable019,h,2)
  if IsDead(target)==false and GetUnitAbilityLevel(target,buffid)>0 then
    if amountmp>0 then
      call SetUnitState(target,UNIT_STATE_MANA,GetUnitState(target,UNIT_STATE_MANA)+amountmp/duration*0.1)
    endif
    if amounthp>0 then
      call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+amounthp/duration*0.1)
    endif
  else
    //call echo(I2S(GetUnitAbilityLevel(target,buffid))+" lvl of "+Id2S(buffid))
    call SaveBoolean(MHT,GetHandleId(target),buffid,false)
    call PauseTimer(t)
    call FlushChildHashtable(hashtable019,h)
    call DestroyTimer(t)
  endif
  set t=null
  set target=null
endfunction

function SmoothHealingSystemForBottle takes real hp, real mp, real dur, integer buffid, unit target returns nothing
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call TimerStart(t,0.1,true,function SmoothHealingSystemDurForBottle)
  call SaveUnitHandle(hashtable019,h,0,target)
  //call echo("applied")
  call SaveBoolean(MHT,GetHandleId(target),buffid,true)
  call SaveInteger(hashtable019,h,0,buffid)
  call SaveReal(hashtable019,h,0,hp)
  call SaveReal(hashtable019,h,1,mp)
  call SaveReal(hashtable019,h,2,dur)
  set t=null
endfunction

function SmoothHealingSystemDur takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit target=LoadUnitHandle(hashtable019,h,0)
  local integer htype=LoadInteger(hashtable019,h,1)
  local integer buffid=LoadInteger(hashtable019,h,0)
  local real amount=LoadReal(hashtable019,h,0)
  local real duration=LoadReal(hashtable019,h,1)
  if IsDead(target)==false and GetUnitAbilityLevel(target,buffid)>0 then
    if htype=='00MP' then
      call SetUnitState(target,UNIT_STATE_MANA,GetUnitState(target,UNIT_STATE_MANA)+amount/duration*0.1)
    elseif htype=='00HP' then
      call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+amount/duration*0.1)
    endif
  else
    //call echo(I2S(GetUnitAbilityLevel(target,buffid))+" lvl of "+Id2S(buffid))
    call PauseTimer(t)
    call FlushChildHashtable(hashtable019,h)
    call DestroyTimer(t)
  endif
  set t=null
  set target=null
endfunction

function SmoothHealingSystem takes nothing returns nothing
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  local unit target=GetSpellTargetUnit()
  call TimerStart(t,0.1,true,function SmoothHealingSystemDur)
  call SaveUnitHandle(hashtable019,h,0,target)
  //call echo("applied")
  if GetSpellAbilityId()=='AIpl' or GetSpellAbilityId()=='A1WA' then//clarity
    call SaveInteger(hashtable019,h,0,'BIrm')
    call SaveInteger(hashtable019,h,1,'00MP')
    call SaveReal(hashtable019,h,0,100)
    call SaveReal(hashtable019,h,1,30)
  else//salve
    call SaveInteger(hashtable019,h,0,'B02Z')
    call SaveInteger(hashtable019,h,1,'00HP')
    call SaveReal(hashtable019,h,0,400)
    call SaveReal(hashtable019,h,1,10)
  endif
  set t=null
  set target=null
endfunction

function CT9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  if GetUnitAbilityLevel(Hero,'B01S')==0 or(GetUnitState(Hero,UNIT_STATE_LIFE)==GetUnitState(Hero,UNIT_STATE_MAX_LIFE)and GetUnitState(Hero,UNIT_STATE_MANA)==GetUnitState(Hero,UNIT_STATE_MAX_MANA)) then
    call UnitRemoveAbility(Hero,'B01S')
    call UnitRemoveAbility(Hero,'B04A')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Hero=null
  return false
endfunction

function Func3873 takes unit Hero,item Item returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function CT9))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  set t=null
  if LoadBoolean(MHT,GetHandleId(Hero),'B01S')==false then
    call SmoothHealingSystemForBottle(3000,2000,30,'B01S',Hero)
  endif
endfunction

function CV9 takes unit Hero,item Item returns nothing
  local unit u=Hero
  local real x=GetUnitX(u)
  local real y=GetUnitY(u)
  local unit Caster=CreateUnit(GetOwningPlayer(u),'e00E',x,y,0)
  call UnitAddAbility(Caster,'A0GR')
  call IssueTargetOrderById(Caster,852274,u)
  call IssueTargetOrderById(Caster,852274,u)
  set u=null
  set Caster=null
endfunction

function RemoveDefaultString2 takes nothing returns nothing
  local unit cho= LoadUnitHandle(hashtable019,690,1)
  local integer cha=0
  local timer t= GetExpiredTimer()
  loop
    exitwhen cha>6
    if GetItemTypeId(UnitItemInSlot(cho,cha))==0 then
      call UnitRemoveItemFromSlot(cho,cha)
    endif
    set cha=cha + 1
  endloop
  call Timer_End(t)
  set t=null
  set cho=null
endfunction

function RemoveDefaultString takes unit Hero, real i returns nothing
  local timer t =Timer_Get()
  call SaveUnitHandle(hashtable019,690,1,Hero)
  call TimerStart(t,i,false,function RemoveDefaultString2)
  set t=null
endfunction

function CW9 takes unit Hero,item Item returns nothing
  if GetItemTypeId(Item)=='I007' or GetItemTypeId(Item)=='I006' or GetItemTypeId(Item)=='I008' or GetItemTypeId(Item)=='I00K' or GetItemTypeId(Item)=='I00J' then
    call CO9(Hero,GetItemTypeId(Item),false)
  endif
  if GetItemTypeId(Item)=='I007' then
    call CV9(Hero,Item)
  elseif GetItemTypeId(Item)=='I00J' then
    if GetUnitAbilityLevel(Hero,'B09Y')>0 then
      call UnitRemoveAbility(Hero,'B09Y')
      call UnitRemoveAbility(Hero,'B01Q')
      call DisableTrigger(GetTriggeringTrigger())
      call UnitAddItemById(Hero,'I00J')
      call EnableTrigger(GetTriggeringTrigger())
    endif
  elseif GetItemTypeId(Item)=='I008' then
    call Func3873(Hero,Item)
  endif
  
  call RemoveDefaultString(Hero,.5)
endfunction

function MagicResFix takes unit u,integer id returns nothing
  local integer Level=GetUnitAbilityLevel(u,id)
  if Level>0 then
    call UnitRemoveAbility(u,id)
    call UnitAddAbility(u,id)
    call SetUnitAbilityLevel(u,id,Level)
    call UnitMakeAbilityPermanent(u,true,id)
  endif
endfunction

function Func4145 takes unit Hero,item Item returns nothing
  local integer AF8=0
  call UnitRemoveAbility(Hero,'A27S')
  call UnitRemoveAbility(Hero,'A27Q')
  call UnitRemoveAbility(Hero,'A27R')
  call UnitRemoveAbility(Hero,'A27T')
  if GetUnitAbilityLevel(Hero,'A28F')>0 then
    call UnitRemoveAbility(Hero,'A28F')
    call UnitAddAbility(Hero,'A28F')
  endif
  call UnitRemoveAbility(Hero,'Q135') //call MagicResFix(Hero,'A0KY')
  call UnitRemoveAbility(Hero,'Q307') //call MagicResFix(Hero,'A06D')
  call UnitRemoveAbility(Hero,'Q279') //call MagicResFix(Hero,'A0MM')
  call UnitRemoveAbility(Hero,'Q084') //call MagicResFix(Hero,'A0YK')
endfunction

function CY9 takes item Item,unit Source,boolean CZ9 returns nothing
  local integer indexId=GetIndex(Item)
  local integer Cache=GetHandleId(Source)
  local string s=""
  if(indexId==indexid_Gem and FindItemOfTypeEx(Source,indexid_Gem,Item)==null)or(indexId==indexid_GemCourier and FindItemOfTypeEx(Source,indexid_GemCourier,Item)==null)then
    if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Source)) or IsObserver(GetLocalPlayer())then
      set s="Abilities\\Spells\\Human\\MagicSentry\\MagicSentryCaster.mdl"
    endif
    if CZ9 then
      if GetEmptyInventorySlots(Source)>0 or GetItemType(Item)==ITEM_TYPE_PERMANENT or GetItemType(Item)==ITEM_TYPE_CAMPAIGN then
        if GetUnitAbilityLevel(Source,'A26A')==0 and GetUnitAbilityLevel(Source,'A26B')==0 then
          if s=="Abilities\\Spells\\Human\\MagicSentry\\MagicSentryCaster.mdl" then
            call UnitAddAbility2(Source,'A26A')
          else
            call UnitAddAbility2(Source,'A26B')
          endif
        endif
      endif
    else
      if not(GetUnitAbilityLevel(Source,'A26A')==0 and GetUnitAbilityLevel(Source,'A26B')==0)then
        call UnitRemoveAbility(Source,'A26B')
        call UnitRemoveAbility(Source,'A26A')
        call RemoveSavedHandle(hashtable019,(Cache),(670))
      endif
    endif
  endif
endfunction

function CA9 takes nothing returns boolean
  local unit Hero=GetTriggerUnit()
  local item Item=GetManipulatedItem()
  local integer id=GetItemTypeId(Item)
  if Item==null or IsUnitIllusion(Hero) or IsUnitType(Hero,UNIT_TYPE_HERO)==false or GetUnitTypeId(Hero)=='H00J' or GetItemTypeId(Item)=='I00E' or GetItemTypeId(Item)=='I02M' then
    set Hero=null
    set Item=null
    return false
  endif
  if(GetTriggerEventId()==EVENT_PLAYER_UNIT_DROP_ITEM and GetItemType(Item)!=ITEM_TYPE_PURCHASABLE)or GetTriggerEventId()==EVENT_PLAYER_UNIT_PAWN_ITEM then
    
    //call LoDMovement_Drop(Hero,GetItemTypeId(Item))
    
    call CY9(Item,Hero,false)
    call Traffic_RegisterData("DRI_"+I2S(GetPlayerId(GetOwningPlayer(Hero))),Item_Real[FindRealIndexId(GetIndex(Item))])
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_PICKUP_ITEM then
    
    //call LoDMovement_Pickup(Hero,Item_Real[GetIndex(Item)])
    
    call CY9(Item,Hero,true)
    call Traffic_RegisterData("PUI_"+I2S(GetPlayerId(GetOwningPlayer(Hero))),Item_Real[FindRealIndexId(GetIndex(Item))])
  endif
  call RemoveDefaultString(Hero,.1)
  set Hero=null
  set Item=null
  return false
endfunction

function CB9 takes nothing returns boolean
  local integer i
  if VU7>0 and VS7[1]<1 then
    set i=2
    loop
      exitwhen i>VU7
      set VS7[i-1]=VS7[i]
      set VT7[i-1]=VT7[i]
      set i=i+1
    endloop
    set VU7=VU7-1
  endif
  set i=1
  loop
    exitwhen i>VU7
    if VS7[i]>=1 then
      set VS7[i]=VS7[i]-1
      if VS7[i]<1 then
        call SetItemDroppable(VT7[i],true)
      endif
    endif
    set i=i+1
  endloop
  return false
endfunction

function Func4195 takes item Item returns nothing
  set VU7=VU7+1
  set VT7[VU7]=Item
  set VS7[VU7]=(Item_Cooldown[(F49(Item))])
  call SetItemDroppable(Item,false)
endfunction

function Func4249 takes nothing returns boolean
  if GetUnitTypeId(GetTriggerUnit())!='e00E' and(Item_Cooldown[(F49(GetManipulatedItem()))])>0 then
    call Func4195(GetManipulatedItem())
  endif
  return false
endfunction

function C69 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit u=(LoadUnitHandle(hashtable019,(Cache),(26)))
  local integer CL9=(LoadInteger(hashtable019,(Cache),(98)))
  local item Item=UnitItemInSlot(u,CL9)
  if Item!=null and Bottle_IsIndexRune(GetIndex(Item))==false and GetWidgetLife(Item)>0 and ES9(Item)==false then
    call SetItemDroppable(Item,true)
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set u=null
  set Item=null
  return false
endfunction

function Func4818 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit u=(LoadUnitHandle(hashtable019,(Cache),(26)))
  local integer CL9=(LoadInteger(hashtable019,(Cache),(98)))
  local item Item=UnitItemInSlot(u,CL9)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  if(u!=null and GetUnitTypeId(u)>1 and IsUnitType(u,UNIT_TYPE_DEAD)==false)and(Item!=null and GetWidgetLife(Item)>0)then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SetItemDroppable(Item,false)
    call SaveInteger(hashtable019,(Cache),(98),(CL9))
    call SaveUnitHandle(hashtable019,(Cache),(26),(u))
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_ISSUED_POINT_ORDER)
    call TriggerAddCondition(t,Condition(function C69))
  endif
  set Item=null
  set u=null
  set t=null
  return false
endfunction

function C09 takes nothing returns nothing
  local integer CL9
  local unit u=GetTriggerUnit()
  local trigger t
  local integer Cache
  local item Item
  if GetIssuedOrderId()==852008 then
    set CL9=0
  elseif GetIssuedOrderId()==852009 then
    set CL9=1
  elseif GetIssuedOrderId()==852010 then
    set CL9=2
  elseif GetIssuedOrderId()==852011 then
    set CL9=3
  elseif GetIssuedOrderId()==852012 then
    set CL9=4
  elseif GetIssuedOrderId()==852013 then
    set CL9=5
  endif
  set Item=UnitItemInSlot(u,CL9)
  if Item!=null and GetWidgetLife(Item)>0 then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveInteger(hashtable019,(Cache),(98),(CL9))
    call SaveUnitHandle(hashtable019,(Cache),(26),(u))
    call TriggerRegisterTimerEvent(t,0,false)
    call TriggerAddCondition(t,Condition(function Func4818))
  endif
  set Item=null
  set u=null
  set t=null
endfunction

function ItemCooldown_CheckOrderID takes nothing returns boolean
  if GetIssuedOrderId()==852008 or GetIssuedOrderId()==852009 or GetIssuedOrderId()==852010 or GetIssuedOrderId()==852011 or GetIssuedOrderId()==852012 or GetIssuedOrderId()==852013 then
    call C09()
  endif
  return false
endfunction

function Func4250 takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local item Item
  local integer i=0
  local real x=GetUnitX(u)
  local real y=GetUnitY(u)
  local integer indexId
  local item newItem
  call DisableTrigger(t_manipulateitem)
  loop
    exitwhen i>5
    set Item=UnitItemInSlot(u,i)
    //set indexId=DummyItem(GetIndex(Item))
    set indexId=GetIndex(Item)
    if indexId==indexid_Perseverance then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_RingOfHealth],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_VoidStone],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif indexId==indexid_RingOfBasilius or indexId==indexid_RingOfBasiliusHero then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_RingOfProtection],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_SobiMask],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif indexId==indexid_ShivasGuard then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_PlateMail],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_MysticStaff],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_RecipeShivasGuard],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif indexId==indexid_ShivasGuardCourier then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_PlateMail],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_MysticStaff],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_RecipeShivasGuard],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif (indexId)==indexid_Mjollnir then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_Hyperstone],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_Maelstrom],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_RecipeMjollnir],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif indexId==indexid_ArcaneBoots then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_BootsOfSpeed],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_EnergyBooster],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif indexId==indexid_HelmOfTheDominator then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_HelmOfIronWill],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_MaskOfDeath],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif indexId==indexid_HelmOfTheDominatorCourier then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_HelmOfIronWill],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_MaskOfDeath],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif indexId==indexid_MantaStyle then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_Yasha],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_UltimateOrb],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_RecipeMantaStyle],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif indexId==indexid_MantaStyleRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_Yasha],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_UltimateOrb],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_RecipeMantaStyle],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif indexId==indexid_EtherealBlade then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_Eaglehorn],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_GhostScepter],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      
    elseif indexId==indexid_SangeAndYasha then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_Sange],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_Yasha],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif indexId==indexid_RingOfAquila or indexId==indexid_RingOfAquilaHero then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_WraithBand],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_RingOfBasilius],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    elseif indexId==indexid_AbyssalBlade then //abyssal
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set newItem=CreateItem(Item_Dummy[indexid_CraniumBasher],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
      set newItem=CreateItem(Item_Dummy[indexid_SacredRelic],x,y)
      call SetItemPlayer(newItem,tt_player1,false)
      call SetItemUserData(newItem,1)
    endif
    set i=i+1
  endloop
  call EnableTrigger(t_manipulateitem)
  set u=null
  set Item=null
  set newItem=null
endfunction

function Func4819 takes nothing returns boolean
  if GetSpellAbilityId()=='A0K5' or GetSpellAbilityId()=='A1RF' then
    call Func4250()
  endif
  return false
endfunction

function L49 takes integer indexId returns boolean
  return indexId!=indexid_DivineRapier and indexId!=indexid_bloodstone and indexId!=indexid_Gem and indexId!=indexid_Aegis
endfunction

function L79 takes nothing returns nothing
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_PICKUP_ITEM then
    call SetItemPawnable(GetManipulatedItem(),false)
  else
    call SetItemPawnable(GetManipulatedItem(),true)
  endif
endfunction

function L89 takes nothing returns boolean
  if GetItemType(GetManipulatedItem())==ITEM_TYPE_PERMANENT and L49(F49(GetManipulatedItem()))and IsCourier(GetTriggerUnit())then
    call L79()
  endif
  return false
endfunction

function L99 takes nothing returns nothing
  local integer x=1
  local player p
  loop
    exitwhen x>16
    if FindItemOfType(udg_Hero[x],Item_Real[indexid_bloodstone])!=null then
      call RemoveUnit(VW7[GetPlayerId(GetOwningPlayer(udg_Hero[x]))])
    endif
    set x=x+1
  endloop
  set p=null
endfunction

function Bloodstone_ItemCondition takes nothing returns boolean
  return(GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_bloodstone]and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO))!=null
endfunction

function LD9 takes nothing returns boolean
  return(IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) and GetUnitTypeId(GetTriggerUnit())!='H00J' and FindItemOfType(GetTriggerUnit(),Item_Real[indexid_bloodstone])!=null)!=null
endfunction

function LE9 takes nothing returns boolean
  return(IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')!=1 and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>1)!=null
endfunction

function LF9 takes nothing returns nothing
  call SetUnitState(GetEnumUnit(),UNIT_STATE_LIFE,GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)+TmpReal378)
  call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\BloodstoneHealTarget.mdx",GetEnumUnit(),"origin"))
endfunction

function Bloodstone_RegisterUnit takes nothing returns nothing
  call AddTimedKeyToUnit(GetEnumUnit(),4254,40)
endfunction

function LG9 takes nothing returns nothing
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),1700,Condition(function LE9))
  set TmpReal378=400+30*GetItemCharges(FindItemOfType(GetTriggerUnit(),Item_Real[indexid_bloodstone]))
  call ForGroup(g,function LF9)
  call KillGroup(g)
  set g=null
endfunction

function LH9 takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'H00M',GetUnitX(Hero),GetUnitY(Hero),GetUnitFacing(Hero))
  set VW7[GetPlayerId(GetOwningPlayer(Hero))]=Caster
  call LG9()
  set Hero=null
  set Caster=null
endfunction

function LI9 takes unit u returns nothing
  local integer LJ9=GetItemCharges(FindItemOfType(u,Item_Real[indexid_bloodstone]))
  if LJ9>0 then
    call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MANA)+LJ9)
  endif
endfunction

function LK9 takes nothing returns boolean
  local integer i=1
  local unit Hero
  local integer id
  if TotalCount_Bloodstone>0 then
    loop
      exitwhen i>5
      set id=GetPlayerId(Sentinels[i])
      set Hero=udg_Hero[id]
      if HasItem_Bloodstone[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
        call LI9(Hero)
      endif
      set id=GetPlayerId(Scourges[i])
      set Hero=udg_Hero[id]
      if HasItem_Bloodstone[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
        call LI9(Hero)
      endif
      set i=i+1
    endloop
  endif
  set Hero=null
  return false
endfunction

function LM9 takes nothing returns nothing
  local unit LN9=GetSummonedUnit()
  local unit Source=GetSummoningUnit()
  local string fx=""
  if IsPlayerEnemy(GetLocalPlayer(),GetOwningPlayer(Source))and IsObserver(GetLocalPlayer())==false then
    set fx="war3mapImported\\WardMark_T2.mdx"
  endif
  call AddSpecialEffectTarget(fx,LN9,"origin")
  set LN9=null
  set Source=null
endfunction

function LO9 takes nothing returns boolean
  return true
endfunction

function LP9 takes unit Hero,unit LN9 returns nothing
  local integer LQ9
  local item Func1639
  if GetUnitTypeId(GetSummonedUnit())=='o004' then
    set LQ9=Item_Real[indexid_ObserverWards]
  else
    set LQ9=Item_Real[indexid_SentryWards]
  endif
  call DisableTrigger(t_manipulateitem)
  set Func1639=FindItemOfType(Hero,LQ9)
  if Func1639==null then
    set tt_player1=GetOwningPlayer(Hero)
    set tt_item1=CreateItem(LQ9,0,0)
    call UnitAddItem(Hero,tt_item1)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  else
    call SetItemCharges(Func1639,GetItemCharges(Func1639)+1)
  endif
  call EnableTrigger(t_manipulateitem)
  set Func1639=null
endfunction

function LS9 takes nothing returns nothing
  local unit LN9=GetSummonedUnit()
  local unit Hero=GetSummoningUnit()
  local unit u
  if GetUnitTypeId(GetSummonedUnit())=='o004' or GetUnitTypeId(GetSummonedUnit())=='oeye' then
    if IsUnitInRegion(ZJ7,LN9)then
      call LP9(Hero,LN9)
      call RemoveUnit(LN9)
    elseif IsCourier(Hero)then
      call LP9(Hero,LN9)
      call Error(GetOwningPlayer(LN9),"Couriers cannot place wards")
      call RemoveUnit(LN9)
    else
      call LM9()
      if(GetUnitTypeId(GetSummonedUnit())=='oeye')then
        call TimedReveal(GetOwningPlayer(GetSummonedUnit()),12,GetUnitX(GetSummonedUnit()),GetUnitY(GetSummonedUnit()),150)
        //				set u=CreateUnit(GetOwningPlayer(GetSummoningUnit()),'hSEN',GetUnitX(GetSummonedUnit()),GetUnitY(GetSummonedUnit()),0)
        //				call UnitApplyTimedLife(u,'BTLF',12-5)
        //				set u=null
      endif
    endif
  elseif GetUnitTypeId(LN9)=='osp4' or GetUnitTypeId(LN9)=='o008' or GetUnitTypeId(LN9)=='o009' or GetUnitTypeId(LN9)=='o01C' or GetUnitTypeId(LN9)=='o01D' or GetUnitTypeId(LN9)=='o01E' then
    call SelectUnitAddForPlayer(LN9,GetOwningPlayer(LN9))
  elseif GetUnitTypeId(LN9)=='o000' or GetUnitTypeId(LN9)=='o001' or GetUnitTypeId(LN9)=='o00A' or GetUnitTypeId(LN9)=='o00X' then
    call SelectUnitAddForPlayer(LN9,GetOwningPlayer(LN9))
  endif
  set LN9=null
  set Hero=null
endfunction

function LT9 takes nothing returns nothing
  local unit u=GetEnumUnit()
  local integer i=0
  local player p=GetOwningPlayer(GetTriggerUnit())
  local item Item
  local integer id=GetPlayerId(p)
  loop
    exitwhen i>5
    set Item=UnitItemInSlot(u,i)
    if Item!=null and GetItemPlayer(Item)==p then
      call UnitRemoveItem(u,Item)
      call SetItemPosition(Item,ItemSpawnX[id],ItemSpawnY[id])
    endif
    set i=i+1
  endloop
  set u=null
  set p=null
  set Item=null
endfunction

function LU9 takes nothing returns nothing
  local item Item=GetEnumItem()
  local unit u=VX7
  local player p=GetOwningPlayer(u)
  local integer id=GetPlayerId(p)
  if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==p then
    call SetItemPosition(Item,ItemSpawnX[id],ItemSpawnY[id])
    call UnitAddItem(CirclesOfPower[id],Item)
  endif
  set Item=null
  set u=null
  set p=null
endfunction

function LV9 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit u=(LoadUnitHandle(hashtable019,(Cache),(53)))
  set VX7=u
  if IsSentinel(GetOwningPlayer(VX7))then
    call EnumItemsInRect(boolean036,Condition(function ReturnTrue2),function LU9)
  else
    call EnumItemsInRect(Z5,Condition(function ReturnTrue2),function LU9)
  endif
  if GetTriggerEvalCount(t)==2 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set u=null
  return false
endfunction

function LW9 takes nothing returns boolean
  return IsCourier(GetFilterUnit())
endfunction

function LX9 takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer i=0
  local group g=GetAvailableGroup()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call GroupEnumUnitsInRange(g,GetUnitX(u),GetUnitY(u),1300,Condition(function LW9))
  call ForGroup(g,function LT9)
  call KillGroup(g)
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function LV9))
  call SaveUnitHandle(hashtable019,(Cache),(53),(u))
  set u=null
  set g=null
  set t=null
endfunction

function LY9 takes nothing returns nothing
  if GetSpellAbilityId()=='A14D' then
    call LX9()
  endif
endfunction

function LZ9 takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer i=0
  local item Item
  local integer id=GetPlayerId(GetOwningPlayer(u))
  local region r=CreateRegion()
  if IsSentinel(GetOwningPlayer(u))then
    call RegionAddRect(r,boolean036)
  else
    call RegionAddRect(r,Z5)
  endif
  loop
    exitwhen i>5
    set Item=UnitItemInSlot(u,i)
    if Bottle_IsIndexRune(GetIndex(Item))==false and GetIndex(Item)!=indexid_Aegis and ES9(Item)==false then
      call UnitRemoveItemFromSlot(u,i)
      if(GetUnitTypeId(u)=='ncop' or IsUnitInRegion(r,u))and IsPlayerAlly(GetItemPlayer(Item),GetOwningPlayer(u)) then
        set id=GetPlayerId(GetItemPlayer(Item))
        call SetItemPosition(Item,ItemSpawnX[id],ItemSpawnY[id])
      endif
    endif
    set i=i+1
  endloop
  call RemoveRegion(r)
  set u=null
  set Item=null
  set r=null
endfunction

function LA9 takes nothing returns nothing
  if GetSpellAbilityId()=='A138' or GetSpellAbilityId()=='A14C' then
    call LZ9()
  endif
endfunction

function LB9 takes unit Source returns boolean
  local integer Cache=GetHandleId(Source)
  local integer i=0
  local real Time=(TimerGetElapsed(GlobalTimer))
  local real LC9=13
  if(LoadReal(hashtable019,(Cache),(730)))<Time-LC9 then
    return false
  endif
  return true
endfunction

function L39 takes unit Source returns nothing
  local integer Cache=GetHandleId(Source)
  local integer L69=0
  call SaveReal(hashtable019,(Cache),(730),(((TimerGetElapsed(GlobalTimer)))*1.))
endfunction

function LL9 takes unit Hero returns nothing
  local integer i=0
  local item L19
  local integer indexId
  local boolean L09=false
  if LB9(Hero)then
    set L09=true
  endif
  loop
    exitwhen i>5
    set L19=UnitItemInSlot(Hero,i)
    set indexId=F49(L19)
    if indexId==indexid_TranquilBoots and L09 then
      call DisableTrigger(t_manipulateitem)
      set tt_player1=GetItemPlayer(L19)
      call RemoveItem(L19)
      set tt_item1=FM9(Hero,Item_Real[indexid_TranquilBootsBroken],i)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
      call EnableTrigger(t_manipulateitem)
    endif
    if indexId==indexid_TranquilBootsBroken and L09==false then
      call DisableTrigger(t_manipulateitem)
      set tt_player1=GetItemPlayer(L19)
      call RemoveItem(L19)
      set tt_item1=FM9(Hero,Item_Real[indexid_TranquilBoots],i)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
      call EnableTrigger(t_manipulateitem)
    endif
    set i=i+1
  endloop
  set Hero=null
  set L19=null
endfunction

function L59 takes unit Hero returns nothing
  local integer i=0
  local item L29
  local integer indexId
  local boolean D4D=false
  local real time=4
  if IsUnitType(Hero,UNIT_TYPE_MELEE_ATTACKER)==false then
    set time=6
  endif
  if VY7[GetPlayerId(GetOwningPlayer(Hero))]+time>(TimerGetElapsed(GlobalTimer))then
    set D4D=true
  endif
  loop
    exitwhen i>5
    set L29=UnitItemInSlot(Hero,i)
    set indexId=F49(L29)
    if indexId==indexid_HeartOfTarrasque and D4D then
      call DisableTrigger(t_manipulateitem)
      set tt_player1=GetItemPlayer(L29)
      call RemoveItem(L29)
      set tt_item1=FM9(Hero,Item_Real[indexid_DisabledHeartOfTarrasque],i)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
      call EnableTrigger(t_manipulateitem)
    endif
    if indexId==indexid_DisabledHeartOfTarrasque and D4D==false then
      call DisableTrigger(t_manipulateitem)
      set tt_player1=GetItemPlayer(L29)
      call RemoveItem(L29)
      set tt_item1=FM9(Hero,Item_Real[indexid_HeartOfTarrasque],i)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
      call EnableTrigger(t_manipulateitem)
    endif
    set i=i+1
  endloop
  set Hero=null
  set L29=null
endfunction

function TranquilBroke_Condition takes nothing returns nothing
  if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) then
    call L39(GetTriggerUnit())
  endif
  if IsUnitType(GetAttacker(),UNIT_TYPE_HERO) then
    call L39(GetAttacker())
  endif
endfunction

function D7D takes nothing returns nothing
  if IsRealDamage and GetEventDamage()>2 and (IsPlayerBelongToTeams(GetOwningPlayer(GetEventDamageSource()))or GetUnitTypeId(GetEventDamageSource())=='n00L') and WL7[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]==false then
    if GetEventDamageSource()!=GetTriggerUnit() or GetUnitAbilityLevel(GetTriggerUnit(),'B028')>0  then
      
      
      if GetEventDamage()>5 then
        
        set VY7[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]=(TimerGetElapsed(GlobalTimer))
      endif
      if GetEventDamage()>=20 then 
        set LastTimeDamaged_ForDagger[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]=(TimerGetElapsed(GlobalTimer))
      endif
      
      
    else
      
      
      if GetEventDamage()>=5 then
        set LastTimeDamaged_ForDagger[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]=(TimerGetElapsed(GlobalTimer))
      endif
      
      
    endif
  endif
endfunction

function D8D takes unit Hero returns nothing
  local integer i=0
  local item D9D
  local integer indexId
  local boolean DDD=false
  if LastTimeDamaged_ForDagger[GetPlayerId(GetOwningPlayer(Hero))]+3>(TimerGetElapsed(GlobalTimer))then
    set DDD=true
  endif
  loop
    exitwhen i>5
    set D9D=UnitItemInSlot(Hero,i)
    set indexId=F49(D9D)
    if indexId==indexid_KelensDagger and DDD then
      call DisableTrigger(t_manipulateitem)
      set tt_player1=GetItemPlayer(D9D)
      call RemoveItem(D9D)
      set tt_item1=FM9(Hero,Item_Real[indexid_DisabledKelensDagger],i)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
      call EnableTrigger(t_manipulateitem)
    endif
    if indexId==indexid_DisabledKelensDagger and DDD==false then
      call DisableTrigger(t_manipulateitem)
      set tt_player1=GetItemPlayer(D9D)
      call RemoveItem(D9D)
      set tt_item1=FM9(Hero,Item_Real[indexid_KelensDagger],i)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
      call EnableTrigger(t_manipulateitem)
    endif
    set i=i+1
  endloop
  set Hero=null
  set D9D=null
endfunction

function DED takes nothing returns boolean
  local integer i=1
  local unit Hero
  local integer id
  if TotalCount_Dagger>0 or TotalCount_Heart>0 or VN7>0 then
    loop
      exitwhen i>5
      set id=GetPlayerId(Sentinels[i])
      set Hero=udg_Hero[id]
      if HasItem_Dagger[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
        call D8D(Hero)
      endif
      if HasItem_Heart[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
        call L59(Hero)
      endif
      if HasItem_TranquilBoots[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
        call LL9(Hero)
      endif
      set id=GetPlayerId(Scourges[i])
      set Hero=udg_Hero[id]
      if HasItem_Dagger[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
        call D8D(Hero)
      endif
      if HasItem_Heart[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
        call L59(Hero)
      endif
      if HasItem_TranquilBoots[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
        call LL9(Hero)
      endif
      set i=i+1
    endloop
  endif
  set Hero=null
  return false
endfunction

function DFD takes nothing returns nothing
  local unit Hero=GetFilterUnit()
  local integer i=0
  local item Item
  local integer indexId
  loop
    exitwhen i>5
    set Item=UnitItemInSlot(Hero,i)
    set indexId=GetIndex(Item)
    if(indexId==indexid_Bottle0 or indexId==indexid_bottle1 or indexId==indexid_bottle2)and GetItemUserData(Item)>0 then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl",Hero,"overhead"))
      call SoundForPlayer(GetOwningPlayer(Hero),"Abilities\\Spells\\Human\\Heal\\HealTarget.wav")
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=FM9(Hero,Item_Real[indexid_bottle3],i)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    endif
    set i=i+1
  endloop
  set Hero=null
  set Item=null
endfunction

function DGD takes nothing returns boolean
  if UnitInventorySize(GetFilterUnit())>0 and IsSentinel(GetOwningPlayer(GetFilterUnit()))and IsUnitIllusion(GetFilterUnit())==false and IsDead(GetFilterUnit())==false then
    call DFD()
  endif
  return false
endfunction

function DHD takes nothing returns boolean
  if UnitInventorySize(GetFilterUnit())>0 and IsScourge(GetOwningPlayer(GetFilterUnit()))and IsUnitIllusion(GetFilterUnit())==false and IsDead(GetFilterUnit())==false then
    call DFD()
  endif
  return false
endfunction

function DID takes nothing returns boolean
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,real086,real087,750,Condition(function DGD))
  call KillGroup(g)
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,EC7,E37,750,Condition(function DHD))
  call KillGroup(g)
  set g=null
  return false
endfunction

function DJD takes unit DKD returns boolean
  local unit DMD=udg_Hero[GetPlayerId(GetOwningPlayer(DKD))]
  if((GetUnitX(DMD)-GetUnitX(DKD))*(GetUnitX(DMD)-GetUnitX(DKD))+(GetUnitY(DMD)-GetUnitY(DKD))*(GetUnitY(DMD)-GetUnitY(DKD))>=855625)then
    set DMD=null
    return true
  endif
  set DMD=null
  return false
endfunction

function DND takes nothing returns nothing
  local unit DOD=GetAttacker()
  local integer DPD=UnitInventorySize(DOD)
  local integer x=0
  local item i
  loop
    exitwhen x>DPD
    set i=UnitItemInSlot(DOD,x)
    if F49(i)==indexid_javelin and PRD_Get(DOD,'JAVL',20) and GenericCondition_IsDotAInvis(DOD)==false then
      if IsSpiritBear(DOD)then
        if DJD(DOD)==false then
          if GetUnitAbilityLevel(GetTriggerUnit(),'A04R')==0 then
            call DamageTarget(DOD,GetTriggerUnit(),2,40)
          endif
        endif
      else
        if GetUnitAbilityLevel(GetTriggerUnit(),'A04R')==0 then
          call DamageTarget(DOD,GetTriggerUnit(),2,40)
        endif
      endif
    endif
    set x=x+1
  endloop
  set i=null
  set DOD=null
endfunction

function DQD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real DRD=(LoadReal(hashtable019,(GetHandleId(Source)),(692)))
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or DRD<(TimerGetElapsed(GlobalTimer))then
    call UnitRemoveAbility(Source,'A265')
    call UnitRemoveAbility(Source,'B08N')
    call UnitRemoveAbility(Source,'A26C')
    call SaveReal(hashtable019,(GetHandleId(Source)),(692),((0)*1.))
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function DSD takes unit Source returns nothing
  local trigger t
  local integer Cache
  local real DRD=(LoadReal(hashtable019,(GetHandleId(Source)),(692)))
  call SaveReal(hashtable019,(GetHandleId(Source)),(692),(((TimerGetElapsed(GlobalTimer))+4)*1.))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,5+.01,false)
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerAddCondition(t,Condition(function DQD))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call UnitAddAbility2(Source,'A265')
  call UnitAddAbility2(Source,'A26C')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A265',false)
  set t=null
endfunction

function DTD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if GetEventDamageSource()==Source and GetEventDamage()>0 then
      if IsRealDamage then
        call FlushChildHashtable(hashtable019,(Cache))
        call CleanTrigger(t)
        if IsUnitBADWithSpellbooks(Target)==false then
          call DSD(Target)
        endif
      endif
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function DUD takes nothing returns nothing
  local unit Source=GetAttacker()
  local unit Target=GetTriggerUnit()
  local trigger t
  local integer Cache
  if((LoadInteger(hashtable019,(GetHandleId((Source))),((4309))))==1)==false then
    call AddTimedKeyToUnit(Source,4309,.2)
    if PRD_Get(Source,'MAIM'+1,16) then
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
      call TriggerRegisterTimerEvent(t,2.5,false)
      call TriggerAddCondition(t,Condition(function DTD))
      call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
      call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    endif
  endif
  set Source=null
  set Target=null
  set t=null
endfunction

function DVD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real DRD=(LoadReal(hashtable019,(GetHandleId(Source)),(693)))
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or DRD<(TimerGetElapsed(GlobalTimer))then
    call UnitRemoveAbility(Source,'A266')
    call UnitRemoveAbility(Source,'B02I')
    call UnitRemoveAbility(Source,'A26C')
    call SaveReal(hashtable019,(GetHandleId(Source)),(693),((0)*1.))
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function DWD takes unit Source returns nothing
  local trigger t
  local integer Cache
  local real DRD=(LoadReal(hashtable019,(GetHandleId(Source)),(693)))
  call SaveReal(hashtable019,(GetHandleId(Source)),(693),(((TimerGetElapsed(GlobalTimer))+4)*1.))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,4+.01,false)
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerAddCondition(t,Condition(function DVD))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call UnitAddAbility2(Source,'A266')
  call UnitAddAbility2(Source,'A26C')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A266',false)
  set t=null
endfunction

function DXD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if GetEventDamageSource()==Source and GetEventDamage()>0 then
      if IsRealDamage then
        call FlushChildHashtable(hashtable019,(Cache))
        call CleanTrigger(t)
        if IsUnitBADWithSpellbooks(Target)==false then
          call DWD(Target)
        endif
      endif
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function DYD takes nothing returns nothing
  local unit Source=GetAttacker()
  local unit Target=GetTriggerUnit()
  local trigger t
  local integer Cache
  if((LoadInteger(hashtable019,(GetHandleId((Source))),((4309))))==1)==false then
    call AddTimedKeyToUnit(Source,4309,.2)
    if PRD_Get(Source,'MAIM',15) then
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
      call TriggerRegisterTimerEvent(t,2.5,false)
      call TriggerAddCondition(t,Condition(function DXD))
      call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
      call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    endif
  endif
  set Source=null
  set Target=null
  set t=null
endfunction

function DZD takes nothing returns nothing
  local unit DOD=GetAttacker()
  local integer DAD=25
  local integer id=GetPlayerId(GetOwningPlayer(GetAttacker()))
  local integer Cache=GetHandleId(DOD)
  local real UK8=(TimerGetElapsed(GlobalTimer))
  local real DBD=(LoadReal(hashtable019,(Cache),(101)))
  local boolean DCD=(LoadBoolean(hashtable019,(Cache),(99)))
  local boolean D3D=(LoadBoolean(hashtable019,(Cache),(100)))
  local boolean D6D=UK8<DBD
  local boolean DLD=false
  if IsUnitType(DOD,UNIT_TYPE_MELEE_ATTACKER)==false then
    set DAD=10
  endif
  if PRD_Get(DOD,'BASH',DAD) then
    set DLD=true
  endif
  //P263==A0JJ; P275==A081
  if GetUnitAbilityLevel(DOD,'P263')>0 or GetUnitAbilityLevel(DOD,'P275')>0 or GetUnitAbilityLevel(DOD,'A0G5')>0 or GetUnitAbilityLevel(DOD,'QP1X')>0 or GetUnitAbilityLevel(DOD,'A09E')>0 then
    call UnitRemoveAbility(DOD,'A174')
    set DOD=null
    return
  endif
  if DCD and D6D==false and D3D==false then
    call SaveReal(hashtable019,(Cache),(101),((UK8+2)*1.))
    if DLD==false then
      call SaveBoolean(hashtable019,(Cache),(100),(true))
    endif
  elseif D6D or D3D then
    call UnitRemoveAbility(DOD,'A174')
    call SaveBoolean(hashtable019,(Cache),(99),(false))
    call SaveBoolean(hashtable019,(Cache),(100),(false))
  endif
  if DLD then
    call UnitAddAbility2(DOD,'A174')
    call UnitMakeAbilityPermanent(DOD,true,'A175')
    call SaveBoolean(hashtable019,(Cache),(99),(true))
  endif
  set DOD=null
endfunction

function D1D takes unit u returns unit
  if IsUnitType(u,UNIT_TYPE_HERO)or GetUnitAbilityLevel(u,'A04R')==0 then
    return u
  else
    return udg_Hero[GetPlayerId(GetOwningPlayer(u))]
  endif
endfunction

function D0D takes nothing returns boolean
  if IsUnitType(GetKillingUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitAlly(GetDyingUnit(),GetOwningPlayer(GetKillingUnit()))==false then
    if GetUnitTypeId(GetTriggerUnit())=='n00J' then
      call DamageTarget(GetDyingUnit(),D1D(GetKillingUnit()),3,400)
    elseif GetUnitTypeId(GetTriggerUnit())=='n00A' then
      call DamageTarget(GetDyingUnit(),D1D(GetKillingUnit()),3,500)
    elseif GetUnitTypeId(GetTriggerUnit())=='n006' then
      call DamageTarget(GetDyingUnit(),D1D(GetKillingUnit()),3,600)
    endif
  endif
  return false
endfunction

function D5D takes nothing returns boolean
  local unit Hero=GetTriggerUnit()
  local integer Level=1
  local integer id='EUL1'
  if FindItemOfType(Hero,Item_Real[indexid_TranquilBootsBroken])!=null then//60
    set Level=4//100
  endif
  if FindItemOfTypeEx(Hero,Item_Real[indexid_BootsOfSpeed],GetManipulatedItem())!=null then//50
    set Level=2//90
  endif
  if FindItemOfTypeEx(Hero,Item_Real[indexid_PhaseBoots],GetManipulatedItem())!=null then//55
    set Level=2//90
  endif
  if FindItemOfTypeEx(Hero,Item_Real[indexid_PowerTreadsAgility],GetManipulatedItem())!=null or FindItemOfTypeEx(Hero,Item_Real[indexid_PowerTreadsStrength],GetManipulatedItem())!=null or FindItemOfTypeEx(Hero,Item_Real[indexid_PowerTreadsIntelligence],GetManipulatedItem())!=null then
    set Level=2//90
  endif
  if FindItemOfTypeEx(Hero,Item_Real[indexid_ArcaneBoots],GetManipulatedItem())!=null then//60
    set Level=3//95
  endif
  if FindItemOfTypeEx(Hero,Item_Real[indexid_TranquilBoots],GetManipulatedItem())!=null then//75
    set id='EUL2'
    set Level=1//125
  endif
  if FindItemOfTypeEx(Hero,Item_Real[indexid_bootsOfTravel],GetManipulatedItem())!=null then//100
    set id='EUL2'
    set Level=2//140
  endif
  if FindItemOfTypeEx(Hero,Item_Real[indexid_Eul],GetManipulatedItem())!=null then
    call UnitAddAbility2(Hero,id)
    call SetUnitAbilityLevel(Hero,id,Level)
  else
    call UnitRemoveAbility(Hero,'EUL1')
    call UnitRemoveAbility(Hero,'EUL2')
  endif
  set Hero=null
  return false
endfunction

function D2D takes nothing returns boolean
  local unit Hero=GetTriggerUnit()
  local integer Level=1
  local integer id='EUL1'
  if FindItemOfType(Hero,Item_Real[indexid_TranquilBootsBroken])!=null then//60+40
    set Level=4//100
  endif
  if FindItemOfType(Hero,Item_Real[indexid_BootsOfSpeed])!=null then//50+40
    set Level=2//90
  endif
  if FindItemOfType(Hero,Item_Real[indexid_PhaseBoots])!=null then//50+40
    set Level=2//90
  endif
  if FindItemOfType(Hero,Item_Real[indexid_PowerTreadsAgility])!=null or FindItemOfType(Hero,Item_Real[indexid_PowerTreadsStrength])!=null or FindItemOfType(Hero,Item_Real[indexid_PowerTreadsIntelligence])!=null then
    set Level=2//90
  endif
  if FindItemOfType(Hero,Item_Real[indexid_ArcaneBoots])!=null then//55+40
    set Level=3//95
  endif
  if FindItemOfType(Hero,Item_Real[indexid_TranquilBoots])!=null then//90+40
    set Level=1//130
    set id='EUL2'
  endif
  if FindItemOfType(Hero,Item_Real[indexid_bootsOfTravel])!=null then//100+40
    set Level=2//140
    set id='EUL2'
  endif
  if FindItemOfType(Hero,Item_Real[indexid_Eul])!=null then
    //call echo(Id2S(id)+" "+I2S(Level))
    call UnitAddAbility2(Hero,id)
    call SetUnitAbilityLevel(Hero,id,Level)
  endif
  set Hero=null
  return false
endfunction


function Armlet_StrBonus takes unit u,integer d returns nothing
  local integer array b
  local integer a=d
  local integer c=1
  local integer i=0
  local integer z
  local real hp
  if d==0 then
    set hp=GetUnitState(u,UNIT_STATE_MAX_LIFE)-GetUnitState(u,UNIT_STATE_LIFE)
  endif
  if d<1 then
    call UnitRemoveAbility(u,ArmletStrBonus[0])
    call UnitRemoveAbility(u,ArmletStrBonus[1])
    call UnitRemoveAbility(u,ArmletStrBonus[2])
    call UnitRemoveAbility(u,ArmletStrBonus[3])
    call UnitRemoveAbility(u,ArmletStrBonus[4])
    call SetUnitState(u,UNIT_STATE_LIFE,RMaxIF(GetUnitState(u,UNIT_STATE_MAX_LIFE)-hp,1))
    return
  endif
  loop
    exitwhen c==0
    set c=a/ 2
    set b[i]=a-c*2
    set a=c
    set i=i+1
  endloop
  set z=4
  set i=0
  loop
    exitwhen i>z
    if b[i]==1 then
      call UnitAddAbility2(u,ArmletStrBonus[i])
    else
      call UnitRemoveAbility(u,ArmletStrBonus[i])
    endif
    set i=i+1
  endloop
endfunction

function Armlet_TogglingOn takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(MHT,h,0)
  local real KXD=LoadReal(MHT,h,0)
  
  call Armlet_StrBonus(u,GetTriggerEvalCount(t))
  if IsDead(u)==false then
    call SetUnitState(u,UNIT_STATE_LIFE,RMaxIF(GetUnitState(u,UNIT_STATE_MAX_LIFE)-KXD,1))
  endif
  if GetTriggerEvalCount(t)==25 then
    call FlushChildHashtable(MHT,h)
    call CleanTrigger(t)
  endif
  if FindItemOfType(u,Item_Real[indexid_ArmletOn])==null then
    call Armlet_StrBonus(u,0)
    //call SetUnitState(u,UNIT_STATE_LIFE,RMaxIF(GetUnitState(u,UNIT_STATE_MAX_LIFE)-KXD,1))
    if IsTriggerEnabled(t)==true then
      call FlushChildHashtable(MHT,h)
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set u=null
endfunction



function E4D takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t
  local real KXD
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_DROP_ITEM then
    
    if F49(GetManipulatedItem())==indexid_ArmletOff or F49(GetManipulatedItem())==indexid_ArmletOffCourier then
      call UnitRemoveAbility(Hero,'A0EX')
      if F49(GetManipulatedItem())==indexid_ArmletOff then
        call Armlet_StrBonus(Hero,0)
      endif
    endif
    if F49(GetManipulatedItem())==indexid_Satanic then
      call UnitRemoveAbility(Hero,'A1BW')
    endif
    if F49(GetManipulatedItem())==indexid_ArmletOn or F49(GetManipulatedItem())==indexid_ArmletOnCourier then
      call UnitRemoveAbility(Hero,'A0EX')
      call UnitRemoveAbility(Hero,'A0TC')
      call UnitRemoveAbility(Hero,'A0UK')
      if F49(GetManipulatedItem())==indexid_ArmletOn then
        call Armlet_StrBonus(Hero,0)
      endif
    endif
    if F49(GetManipulatedItem())==indexid_bloodstone then
      //			call UnitRemoveAbility(Hero,'A0G3')
      //			call UnitRemoveAbility(Hero,'A09M')
      //			call UnitRemoveAbility(Hero,'A0UX')
      //			call UnitRemoveAbility(Hero,'A2KL')
      //			call UnitRemoveAbility(Hero,'AItn')
    endif
  endif
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_PICKUP_ITEM then
    if F49(GetManipulatedItem())==indexid_ArmletOff  or F49(GetManipulatedItem())==indexid_ArmletOffCourier then
      call UnitAddAbility2(Hero,'A0EX')
      if F49(GetManipulatedItem())==indexid_ArmletOff then
        call Armlet_StrBonus(Hero,0)
      endif
    endif
    if F49(GetManipulatedItem())==indexid_Satanic then
      call UnitAddAbility2(Hero,'A1BW')
    endif
    if F49(GetManipulatedItem())==indexid_ArmletOn or F49(GetManipulatedItem())==indexid_ArmletOnCourier then
      call UnitAddAbility2(Hero,'A0EX')
      call UnitAddAbility2(Hero,'A0TC')
      call UnitAddAbility2(Hero,'A0UK')
      if F49(GetManipulatedItem())==indexid_ArmletOn then
        set t=CreateTrigger()
        call TriggerRegisterTimerEvent(t,0.7/25,true)
        set KXD=GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_LIFE)-GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)
        call SaveUnitHandle(MHT,GetHandleId(t),0,Hero)
        call SaveBoolean(HeroStats,GetHandleId(Hero),20,true)
        call SaveReal(MHT,GetHandleId(t),0,KXD)
        call TriggerAddCondition(t,Condition(function Armlet_TogglingOn))
        set t=null
        call AddTimedKeyToUnit(Hero,4298,.7)
      endif
    endif
    if F49(GetManipulatedItem())==indexid_bloodstone then
      //			call UnitAddAbility2(Hero,'A0G3')
      //			call UnitAddAbility2(Hero,'A09M')
      //			call UnitAddAbility2(Hero,'A0UX')
      //			call UnitAddAbility2(Hero,'A2KL')
      //			call UnitAddAbility2(Hero,'AItn')
    endif
  endif
  set Hero=null
endfunction

function E7D takes nothing returns boolean
  if GetItemType(GetManipulatedItem())==ITEM_TYPE_PERMANENT and(F49(GetManipulatedItem())==indexid_ArmletOn or F49(GetManipulatedItem())==indexid_ArmletOff or F49(GetManipulatedItem())==indexid_Satanic or F49(GetManipulatedItem())==indexid_bloodstone)then
    call E4D()
  endif
  return false
endfunction

function E8D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local item Item=(LoadItemHandle(hashtable019,(Cache),(96)))
  if GetTriggerEventId()==EVENT_UNIT_DROP_ITEM and GetManipulatedItem()==Item then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()!=EVENT_UNIT_DROP_ITEM then
    if((LoadInteger(hashtable019,(GetHandleId((Hero))),((4310))))==1)==false then
      call SetUnitState(Hero,UNIT_STATE_LIFE,RMaxIF(GetUnitState(Hero,UNIT_STATE_LIFE)-40.,1))
    endif
  endif
  set t=null
  set Hero=null
  set Item=null
  return false
endfunction

function E9D takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DROP_ITEM)
  call TriggerAddCondition(t,Condition(function E8D))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveItemHandle(hashtable019,(Cache),(96),(GetManipulatedItem()))
  set t=null
  set Hero=null
endfunction

function EDD takes nothing returns boolean
  if GetItemType(GetManipulatedItem())==ITEM_TYPE_PERMANENT and (F49(GetManipulatedItem())==indexid_ArmletOn or (F49(GetManipulatedItem())==indexid_ArmletOnCourier and IsUnitSpiritBear(GetTriggerUnit()))) then
    call E9D()
  endif
  return false
endfunction

function EED takes unit u returns boolean
  local item EFD=CreateItem('I0KK',GetUnitX(u),GetUnitY(u))
  local boolean result=UnitAddItem(u,EFD)
  if result==false then
    call RemoveItem(EFD)
  endif
  set EFD=null
  return result
endfunction

function EGD takes unit Hero,item Item,integer FO9 returns item
  local real x=FI9(Hero)
  local real y=FK9(Hero)
  local integer i=0
  local boolean array FP9
  local item FQ9
  loop
    exitwhen i>(UnitInventorySize(Hero)-1)
    if UnitItemInSlot(Hero,i)==null and i!=FO9 then
      set FQ9=CreateItem('I02M',x,y)
      call UnitAddItem(Hero,FQ9)
      set FP9[i]=true
    else
      set FP9[i]=false
    endif
    if i==FO9 then
      call UnitAddItem(Hero,Item)
    endif
    set i=i+1
  endloop
  set i=0
  loop
    exitwhen i>5
    if FP9[i] then
      call RemoveItem(UnitItemInSlot(Hero,i))
    endif
    set i=i+1
  endloop
  set tt_item1=Item
  set FQ9=null
  return tt_item1
endfunction

function EHD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer i=0
  local item EID
  local integer indexId
  local unit Caster
  local item EJD
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call SaveBoolean(hashtable019,(GetHandleId(Hero)),(102),(false))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif EED(Hero)==false then
    call TriggerRegisterTimerEvent(t,5.5,false)
  else
    call SaveBoolean(hashtable019,(GetHandleId(Hero)),(102),(false))
    call DisableTrigger(t_manipulateitem)
    if HasItem_LinkenSphere[GetPlayerId(GetOwningPlayer(Hero))]>0 then
      call SetItemVisible(UnitAddItemById(Hero,'I0HM'),false)
    endif
    loop
      exitwhen i>5
      set EID=UnitItemInSlot(Hero,i)
      set indexId=F49(EID)
      if indexId==indexid_LinkenDummy then
        set tt_player1=GetItemPlayer(EID)
        call RemoveItem(EID)
        set Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',GetUnitX(Hero),GetUnitY(Hero),0)
        call UnitAddAbility(Caster,'AInv')
        set EJD=UnitAddItemById(Caster,Item_Real[indexid_LinkensSphere])
        call UnitUseItem(Caster,EJD)
        set tt_item1=EGD(Hero,EJD,i)
        call SetItemPlayer(EJD,tt_player1,false)
        call SetItemUserData(EJD,1)
        call UnitRemoveAbility(Caster,'AInv')
        set Caster=null
        set EJD=null
      endif
      set EID=null
      set i=i+1
    endloop
    call EnableTrigger(t_manipulateitem)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Hero=null
  set EID=null
  set Caster=null
  set EJD=null
  return false
endfunction

function EKD takes unit Hero returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer i=0
  local item EID
  local integer indexId
  local unit Caster
  local item EJD
  call DisableTrigger(t_manipulateitem)
  call SaveBoolean(hashtable019,(GetHandleId(Hero)),(102),(true))
  call TriggerRegisterTimerEvent(t,17,false)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function EHD))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  loop
    exitwhen i>5
    set EID=UnitItemInSlot(Hero,i)
    set indexId=F49(EID)
    if indexId==indexid_LinkensSphere or indexId==indexid_LinkenDummy then
      set tt_player1=GetItemPlayer(EID)
      call RemoveItem(EID)
      set Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',GetUnitX(Hero),GetUnitY(Hero),0)
      call UnitAddAbility(Caster,'AInv')
      set EJD=UnitAddItemById(Caster,Item_Real[indexid_LinkenDummy])
      call UnitUseItem(Caster,EJD)
      set tt_item1=EGD(Hero,EJD,i)
      call SetItemPlayer(EJD,tt_player1,false)
      call SetItemUserData(EJD,1)
      call UnitRemoveAbility(Caster,'AInv')
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl",Hero,"origin"))
      set Caster=null
      set EJD=null
    endif
    set EID=null
    set i=i+1
  endloop
  call EnableTrigger(t_manipulateitem)
  set t=null
endfunction

function EMD takes nothing returns boolean
  local integer i=1
  local unit Hero
  local integer id
  if GameEnded then
    return false
  endif
  if TotalCount_LinkenSphere>0 then
    loop
      exitwhen i>5
      set id=GetPlayerId(Sentinels[i])
      set Hero=udg_Hero[id]
      if HasItem_LinkenSphere[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false and(LoadBoolean(hashtable019,(GetHandleId(Hero)),(102)))==false and IsBlocked(Hero)==false and(LoadBoolean(hashtable019,(GetHandleId(Hero)),(129)))==false then
        call EKD(Hero)
      endif
      set id=GetPlayerId(Scourges[i])
      set Hero=udg_Hero[id]
      if HasItem_LinkenSphere[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false and(LoadBoolean(hashtable019,(GetHandleId(Hero)),(102)))==false and IsBlocked(Hero)==false and(LoadBoolean(hashtable019,(GetHandleId(Hero)),(129)))==false then
        call EKD(Hero)
      endif
      set i=i+1
    endloop
  endif
  set Hero=null
  return false
endfunction

function GetBottleWithRuneId takes integer FN9 returns integer
  if FN9=='I006' then
    return indexid_BottleHaste
  elseif FN9=='I008' then
    return indexid_BottleRegen
  elseif FN9=='I00J' then
    return indexid_BottleInvis
  elseif FN9=='I00K' then
    return indexid_BottleDD
  elseif FN9=='I007' then
    return indexid_BottleIllusion
  endif
  return-1
endfunction

function EOD takes nothing returns boolean
  if GetSpellAbilityId()=='A0H6' then
    call SaveUnitHandle(hashtable019,(GetHandleId(GetTriggerUnit())),(103),(null))
    call SaveInteger(hashtable019,(GetHandleId(GetTriggerUnit())),(104),(0))
    if(FindItemOfType(GetTriggerUnit(),Item_Real[indexid_Bottle0])!=null or FindItemOfType(GetTriggerUnit(),Item_Mute[indexid_Bottle0])!=null)and(GetUnitTypeId(GetSpellTargetUnit())=='nfoh' or GetUnitTypeId(GetSpellTargetUnit())=='ndfl')then
      call SaveUnitHandle(hashtable019,(GetHandleId(GetTriggerUnit())),(103),(GetSpellTargetUnit()))
    elseif IsRune(GetItemTypeId(GetSpellTargetItem()))then
      call CO9(GetTriggerUnit(),GetItemTypeId(GetSpellTargetItem()),true)
      call SaveInteger(hashtable019,(GetHandleId(GetTriggerUnit())),(104),(GetItemTypeId(GetSpellTargetItem())))
      call DestroyItem(GetSpellTargetItem())
    endif
  endif
  return false
endfunction

function EPD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit u=(LoadUnitHandle(hashtable019,(Cache),(26)))
  local integer CL9=(LoadInteger(hashtable019,(Cache),(98)))
  local item Item=UnitItemInSlot(u,CL9)
  local integer EQD=(LoadInteger(hashtable019,(Cache),(105)))
  local item EJD
  local integer FO9
  if Item!=null and Bottle_IsIndexRune(GetIndex(Item))and GetHandleId(Item)==EQD and IsDead(u)==false and IsDead(u)==false then
    set EJD=CreateItem((LoadInteger(hashtable019,(GetHandleId(Item)),(GetHandleId(u)))),GetUnitX(u),GetUnitY(u))
    call FlushChildHashtable(hashtable019,(GetHandleId(Item)))
    set FO9=BC8(u,Item)
    set tt_player1=GetItemPlayer(Item)
    call DestroyItem(Item)
    set tt_item1=FM9(u,Item_Real[indexid_bottle3],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call UnitAddItem(u,EJD)
  endif
  set t=null
  set u=null
  set Item=null
  set EJD=null
  return false
endfunction

function ERD takes unit u,item EJD returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer CL9=BC8(u,EJD)
  call SaveInteger(hashtable019,(Cache),(98),(CL9))
  call SaveInteger(hashtable019,(Cache),(105),(GetHandleId(EJD)))
  call SaveUnitHandle(hashtable019,(Cache),(26),(u))
  call TriggerRegisterTimerEvent(t,120,true)
  call TriggerAddCondition(t,Condition(function EPD))
  set t=null
endfunction

function ESD takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local item Item=GetManipulatedItem()
  local integer indexId=GetIndex(Item)
  local unit ETD
  local integer EUD
  local boolean TargetFrog
  local integer FO9
  local item EJD
  local integer EVD
  if indexId==indexid_Bottle0 then
    set FO9=BC8(u,Item)
    set ETD=(LoadUnitHandle(hashtable019,(GetHandleId(u)),(103)))
    set EUD=(LoadInteger(hashtable019,(GetHandleId(u)),(104)))
    if GetUnitTypeId(ETD)=='nfoh' or GetUnitTypeId(ETD)=='ndfl' then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl",u,"overhead"))
      call SoundForPlayer(GetOwningPlayer(u),"Abilities\\Spells\\Human\\Heal\\HealTarget.wav")
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      set tt_item1=FM9(u,Item_Real[indexid_bottle3],FO9)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif IsRune(EUD)then
      set EVD=GetBottleWithRuneId(EUD)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl",u,"overhead"))
      set tt_player1=GetItemPlayer(Item)
      call DestroyItem(Item)
      call DisableTrigger(t_manipulateitem)
      if GetOwningPlayer(u)==tt_player1 then
        set tt_item1=FM9(u,Item_Real[EVD],FO9)
      else
        set tt_item1=FM9(u,Item_Mute[EVD],FO9)
      endif
      call EnableTrigger(t_manipulateitem)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
      set EJD=UnitItemInSlot(u,FO9)
      call SaveInteger(hashtable019,(GetHandleId(EJD)),(GetHandleId(u)),(EUD))
      call ERD(u,EJD)
    endif
  elseif indexId==indexid_bottle3 then
    set FO9=BC8(u,Item)
    set tt_player1=GetItemPlayer(Item)
    call DestroyItem(Item)
    set tt_item1=FM9(u,Item_Real[indexid_bottle2],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  elseif indexId==indexid_bottle2 then
    set FO9=BC8(u,Item)
    set tt_player1=GetItemPlayer(Item)
    call DestroyItem(Item)
    set tt_item1=FM9(u,Item_Real[indexid_bottle1],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  elseif indexId==indexid_bottle1 then
    set FO9=BC8(u,Item)
    set tt_player1=GetItemPlayer(Item)
    call DestroyItem(Item)
    set tt_item1=FM9(u,Item_Real[indexid_Bottle0],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,0)
  elseif Bottle_IsIndexRune(indexId)then
    //if(LoadInteger(HY,(GetHandleId(Item)),(GetHandleId(u))))>0 then
    set VP7=true
    set FO9=BC8(u,Item)
    set EJD=CreateItem((LoadInteger(hashtable019,(GetHandleId(Item)),(GetHandleId(u)))),GetUnitX(u),GetUnitY(u))
    call FlushChildHashtable(hashtable019,(GetHandleId(Item)))
    set tt_player1=GetItemPlayer(Item)
    call DestroyItem(Item)
    set tt_item1=FM9(u,Item_Real[indexid_bottle3],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    call UnitAddItem(u,EJD)
    set VP7=false
    //endif
  endif
  set u=null
  set Item=null
  set ETD=null
  set EJD=null
endfunction

function EWD takes nothing returns boolean
  if GetIssuedOrderId()==851971 then
    if GetOrderTargetItem()!=null and IsRune(GetItemTypeId(GetOrderTargetItem()))then
      call InterruptUnit(GetTriggerUnit())
      call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n0LU'))
    endif
  endif
  return false
endfunction

function EXD takes unit EYD returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,EYD,EVENT_UNIT_ISSUED_TARGET_ORDER)
  call TriggerAddCondition(t,Condition(function EWD))
  set t=null
endfunction

function EZD takes player p returns integer
  local integer r=GetRandomInt(1,6)
  if IsSentinel(p)then
    if r==1 then
      return 'n00I'
    elseif r==2 then
      return 'n022'
    elseif r==3 then
      return 'n021'
    elseif r==4 then
      return 'n0KY'
    elseif r==5 then
      return 'n0KZ'
    else
      return 'n0LE'
    endif
  else
    if r==1 then
      return 'n023'
    elseif r==2 then
      return 'n024'
    elseif r==3 then
      return 'n025'
    elseif r==4 then
      return 'n0L0'
    elseif r==5 then
      return 'n0L1'
    else
      return 'n0M4'
    endif
  endif
  return 0
endfunction

function EAD takes player p returns integer
  if GetRandomInt(1,3)==1 then
    return 'e02R'
  elseif IsSentinel(p)then
    return 'e01H'
  else
    return 'e01Z'
  endif
  return 0
endfunction

function EBD takes nothing returns nothing
  local unit ECD=CreateUnit(GetOwningPlayer(GetTriggerUnit()),EZD(GetOwningPlayer(GetTriggerUnit())),GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),GetUnitFacing(GetTriggerUnit()))
  local real x=GetUnitX(GetTriggerUnit())
  local real y=GetUnitY(GetTriggerUnit())
  local real a=GetUnitFacing(GetTriggerUnit())
  call Z89(ECD)
  call SetUnitPosition(ECD,x+25*Cos(a*bj_DEGTORAD),y+25*Sin(a*bj_DEGTORAD))
  if ShowCourierIcon[GetPlayerId(GetOwningPlayer(ECD))]==false then
    call UnitRemoveType(ECD,UNIT_TYPE_PEON)
  else
    call UnitAddType(ECD,UNIT_TYPE_PEON)
  endif
  set ECD=null
endfunction

function E3D takes nothing returns nothing
  local unit ECD=CreateUnit(GetOwningPlayer(GetTriggerUnit()),EAD(GetOwningPlayer(GetTriggerUnit())),GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),GetUnitFacing(GetTriggerUnit()))
  call Z89(ECD)
  if ShowCourierIcon[GetPlayerId(GetOwningPlayer(ECD))]==false then
    call UnitRemoveType(ECD,UNIT_TYPE_PEON)
  else
    call UnitAddType(ECD,UNIT_TYPE_PEON)
  endif
  call EXD(ECD)
  set ECD=null
endfunction

function E6D takes nothing returns boolean
  if GetSpellAbilityId()=='A0B6' then
    call EBD()
  endif
  if GetSpellAbilityId()=='A0JT' then
    call E3D()
  endif
  return false
endfunction

function ELD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit ECD=(LoadUnitHandle(hashtable019,(Cache),(124)))
  local integer E1D=(LoadInteger(hashtable019,(Cache),(125)))
  local integer E0D=(LoadInteger(hashtable019,(Cache),(106)))
  local integer E5D=(LoadInteger(hashtable019,(Cache),(107)))
  local integer E2D=(LoadInteger(hashtable019,(Cache),(108)))
  local integer F4D=(LoadInteger(hashtable019,(Cache),(109)))
  local integer F7D=(LoadInteger(hashtable019,(Cache),(110)))
  local integer F8D=(LoadInteger(hashtable019,(Cache),(111)))
  local player p0=(LoadPlayerHandle(hashtable019,(Cache),(118)))
  local player p1=(LoadPlayerHandle(hashtable019,(Cache),(119)))
  local player p2=(LoadPlayerHandle(hashtable019,(Cache),(120)))
  local player p3=(LoadPlayerHandle(hashtable019,(Cache),(121)))
  local player p4=(LoadPlayerHandle(hashtable019,(Cache),(122)))
  local player p5=(LoadPlayerHandle(hashtable019,(Cache),(123)))
  local integer F9D=(LoadInteger(hashtable019,(Cache),(112)))
  local integer FDD=(LoadInteger(hashtable019,(Cache),(113)))
  local integer FED=(LoadInteger(hashtable019,(Cache),(114)))
  local integer FFD=(LoadInteger(hashtable019,(Cache),(115)))
  local integer FGD=(LoadInteger(hashtable019,(Cache),(116)))
  local integer FHD=(LoadInteger(hashtable019,(Cache),(117)))
  call DisableTrigger(t_manipulateitem)
  if GetTriggerEvalCount(t)==1 then
    call UnitAddAbility(ECD,E1D)
    if ShowCourierIcon[GetPlayerId(GetOwningPlayer(ECD))]==false then
      call UnitRemoveType(ECD,UNIT_TYPE_PEON)
    else
      call UnitAddType(ECD,UNIT_TYPE_PEON)
    endif
  else
    if E0D>0 then
      set tt_item1=CreateItem(E0D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p0,false)
      call SetItemUserData(tt_item1,1)
    endif
    if F9D>0 then
      call SetItemCharges(tt_item1,F9D)
    endif
    if E5D>0 then
      set tt_item1=CreateItem(E5D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p1,false)
      call SetItemUserData(tt_item1,1)
    endif
    if FDD>0 then
      call SetItemCharges(tt_item1,FDD)
    endif
    if E2D>0 then
      set tt_item1=CreateItem(E2D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p2,false)
      call SetItemUserData(tt_item1,1)
    endif
    if FED>0 then
      call SetItemCharges(tt_item1,FED)
    endif
    if F4D>0 then
      set tt_item1=CreateItem(F4D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p3,false)
      call SetItemUserData(tt_item1,1)
    endif
    if FFD>0 then
      call SetItemCharges(tt_item1,FFD)
    endif
    if F7D>0 then
      set tt_item1=CreateItem(F7D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p4,false)
      call SetItemUserData(tt_item1,1)
    endif
    if FGD>0 then
      call SetItemCharges(tt_item1,FGD)
    endif
    if F8D>0 then
      set tt_item1=CreateItem(F8D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p5,false)
      call SetItemUserData(tt_item1,1)
    endif
    if FHD>0 then
      call SetItemCharges(tt_item1,FHD)
    endif
    if ShowCourierIcon[GetPlayerId(GetOwningPlayer(ECD))]==false then
      call UnitRemoveType(ECD,UNIT_TYPE_PEON)
    else
      call UnitAddType(ECD,UNIT_TYPE_PEON)
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  call EnableTrigger(t_manipulateitem)
  set t=null
  set ECD=null
  set p0=null
  set p1=null
  set p2=null
  set p3=null
  set p4=null
  set p5=null
  return false
endfunction

function itsNewDisabledConsumable takes integer id returns boolean
  return id==indexid_Tango or id==indexid_HealingSalve or id==indexid_ClarityPotion
endfunction

function FID takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit FJD=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer FKD=GetUnitTypeId(FJD)
  local real x=GetUnitX(FJD)
  local real y=GetUnitY(FJD)
  local item FMD
  local item FND
  local item FOD
  local item FPD
  local item FQD
  local item FRD
  local player p0
  local player p1
  local player p2
  local player p3
  local player p4
  local player p5
  local integer E0D
  local integer E5D
  local integer E2D
  local integer F4D
  local integer F7D
  local integer F8D
  local integer F9D=-1
  local integer FDD=-1
  local integer FED=-1
  local integer FFD=-1
  local integer FGD=-1
  local integer FHD=-1
  local integer E1D
  local item Item
  local integer i
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  if FJD==null or IsDead(FJD)then
    return false
  endif
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  set FMD=UnitItemInSlot(FJD,0)
  set FND=UnitItemInSlot(FJD,1)
  set FOD=UnitItemInSlot(FJD,2)
  set FPD=UnitItemInSlot(FJD,3)
  set FQD=UnitItemInSlot(FJD,4)
  set FRD=UnitItemInSlot(FJD,5)
  set E0D=GetItemTypeId(FMD)
  set E5D=GetItemTypeId(FND)
  set E2D=GetItemTypeId(FOD)
  set F4D=GetItemTypeId(FPD)
  set F7D=GetItemTypeId(FQD)
  set F8D=GetItemTypeId(FRD)
  set p0=GetItemPlayer(FMD)
  set p1=GetItemPlayer(FND)
  set p2=GetItemPlayer(FOD)
  set p3=GetItemPlayer(FPD)
  set p4=GetItemPlayer(FQD)
  set p5=GetItemPlayer(FRD)
  set Item=FMD
  set i=GetIndex(Item)
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(i) or (GetItemType(Item)==ITEM_TYPE_CAMPAIGN and itsNewDisabledConsumable(i)) then
    set F9D=GetItemCharges(Item)
  endif
  set Item=FND
  set i=GetIndex(Item)
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(i) or (GetItemType(Item)==ITEM_TYPE_CAMPAIGN and itsNewDisabledConsumable(i)) then
    set FDD=GetItemCharges(Item)
  endif
  set Item=FOD
  set i=GetIndex(Item)
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(i) or (GetItemType(Item)==ITEM_TYPE_CAMPAIGN and itsNewDisabledConsumable(i)) then
    set FED=GetItemCharges(Item)
  endif
  set Item=FPD
  set i=GetIndex(Item)
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(i) or (GetItemType(Item)==ITEM_TYPE_CAMPAIGN and itsNewDisabledConsumable(i)) then
    set FFD=GetItemCharges(Item)
  endif
  set Item=FQD
  set i=GetIndex(Item)
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(i) or (GetItemType(Item)==ITEM_TYPE_CAMPAIGN and itsNewDisabledConsumable(i)) then
    set FGD=GetItemCharges(Item)
  endif
  set Item=FRD
  set i=GetIndex(Item)
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(i) or (GetItemType(Item)==ITEM_TYPE_CAMPAIGN and itsNewDisabledConsumable(i)) then
    set FHD=GetItemCharges(Item)
  endif
  call DestroyItem(FMD)
  call DestroyItem(FND)
  call DestroyItem(FOD)
  call DestroyItem(FPD)
  call DestroyItem(FQD)
  call DestroyItem(FRD)
  if FKD=='n00I' then
    set E1D='S009'
  elseif FKD=='n022' then
    set E1D='S00V'
  elseif FKD=='n021' then
    set E1D='S00C'
  elseif FKD=='n023' then
    set E1D='S00E'
  elseif FKD=='n024' then
    set E1D='S00B'
  elseif FKD=='n025' then
    set E1D='S00F'
  elseif FKD=='n0KY' then
    set E1D='S00W'
  elseif FKD=='n0KZ' then
    set E1D='S00Y'
  elseif FKD=='n0L0' then
    set E1D='S00X'
  elseif FKD=='n0L1' then
    set E1D='S00D'
  elseif FKD=='n0LE' then
    set E1D='S01F'
  elseif FKD=='n0M4' then
    set E1D='S015'
  endif
  if GetRandomInt(1,10)==1 then
    set E1D='S00G'
  endif
  if GetRandomInt(1,10)<3 then
    set E1D='S016'
  endif
  if FKD=='n00M' then
    set E1D='S00L'
  elseif FKD=='n0LS' then
    set E1D='S00L'
  elseif FKD=='n0HV' then
    set E1D='S00F'
  endif
  if FKD=='e01H' then
    set E1D='S012'
  elseif FKD=='e01Z' then
    set E1D='S010'
  elseif FKD=='e02R' then
    set E1D='S014'
  elseif FKD=='e02T' then
    set E1D='S011'
  elseif FKD=='e02S' then
    set E1D='S017'
  elseif FKD=='e030' then
    set E1D='S013'
  endif
  call SavePlayerHandle(hashtable019,(Cache),(118),(p0))
  call SavePlayerHandle(hashtable019,(Cache),(119),(p1))
  call SavePlayerHandle(hashtable019,(Cache),(120),(p2))
  call SavePlayerHandle(hashtable019,(Cache),(121),(p3))
  call SavePlayerHandle(hashtable019,(Cache),(122),(p4))
  call SavePlayerHandle(hashtable019,(Cache),(123),(p5))
  call SaveInteger(hashtable019,(Cache),(106),(E0D))
  call SaveInteger(hashtable019,(Cache),(107),(E5D))
  call SaveInteger(hashtable019,(Cache),(108),(E2D))
  call SaveInteger(hashtable019,(Cache),(109),(F4D))
  call SaveInteger(hashtable019,(Cache),(110),(F7D))
  call SaveInteger(hashtable019,(Cache),(111),(F8D))
  call SaveInteger(hashtable019,(Cache),(112),(F9D))
  call SaveInteger(hashtable019,(Cache),(113),(FDD))
  call SaveInteger(hashtable019,(Cache),(114),(FED))
  call SaveInteger(hashtable019,(Cache),(115),(FFD))
  call SaveInteger(hashtable019,(Cache),(116),(FGD))
  call SaveInteger(hashtable019,(Cache),(117),(FHD))
  call SaveUnitHandle(hashtable019,(Cache),(124),(FJD))
  call SaveInteger(hashtable019,(Cache),(125),(E1D))
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function ELD))
  set t=null
  set FJD=null
  set FMD=null
  set FND=null
  set FOD=null
  set FPD=null
  set FQD=null
  set FRD=null
  set p0=null
  set p1=null
  set p2=null
  set p3=null
  set p4=null
  set p5=null
  set Item=null
  return false
endfunction

function FSD takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.05,false)
  call TriggerAddCondition(t,Condition(function FID))
  call SaveUnitHandle(hashtable019,(Cache),(2),(GetTriggerUnit()))
  set t=null
endfunction

function FTD takes nothing returns boolean
  if GetSpellAbilityId()=='A0OT' then
    call FSD()
  endif
  return false
endfunction

function FUD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit ECD=(LoadUnitHandle(hashtable019,(Cache),(124)))
  local integer E1D=(LoadInteger(hashtable019,(Cache),(125)))
  local integer E0D=(LoadInteger(hashtable019,(Cache),(106)))
  local integer E5D=(LoadInteger(hashtable019,(Cache),(107)))
  local integer E2D=(LoadInteger(hashtable019,(Cache),(108)))
  local integer F4D=(LoadInteger(hashtable019,(Cache),(109)))
  local integer F7D=(LoadInteger(hashtable019,(Cache),(110)))
  local integer F8D=(LoadInteger(hashtable019,(Cache),(111)))
  local player p0=(LoadPlayerHandle(hashtable019,(Cache),(118)))
  local player p1=(LoadPlayerHandle(hashtable019,(Cache),(119)))
  local player p2=(LoadPlayerHandle(hashtable019,(Cache),(120)))
  local player p3=(LoadPlayerHandle(hashtable019,(Cache),(121)))
  local player p4=(LoadPlayerHandle(hashtable019,(Cache),(122)))
  local player p5=(LoadPlayerHandle(hashtable019,(Cache),(123)))
  local integer F9D=(LoadInteger(hashtable019,(Cache),(112)))
  local integer FDD=(LoadInteger(hashtable019,(Cache),(113)))
  local integer FED=(LoadInteger(hashtable019,(Cache),(114)))
  local integer FFD=(LoadInteger(hashtable019,(Cache),(115)))
  local integer FGD=(LoadInteger(hashtable019,(Cache),(116)))
  local integer FHD=(LoadInteger(hashtable019,(Cache),(117)))
  call DisableTrigger(t_manipulateitem)
  if GetTriggerEvalCount(t)==1 then
    call UnitAddAbility(ECD,E1D)
    if ShowCourierIcon[GetPlayerId(GetOwningPlayer(ECD))]==false then
      call UnitRemoveType(ECD,UNIT_TYPE_PEON)
    else
      call UnitAddType(ECD,UNIT_TYPE_PEON)
    endif
  else
    if E0D>0 then
      set tt_item1=CreateItem(E0D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p0,false)
      call SetItemUserData(tt_item1,1)
    endif
    if F9D>0 then
      call SetItemCharges(tt_item1,F9D)
    endif
    if E5D>0 then
      set tt_item1=CreateItem(E5D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p1,false)
      call SetItemUserData(tt_item1,1)
    endif
    if FDD>0 then
      call SetItemCharges(tt_item1,FDD)
    endif
    if E2D>0 then
      set tt_item1=CreateItem(E2D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p2,false)
      call SetItemUserData(tt_item1,1)
    endif
    if FED>0 then
      call SetItemCharges(tt_item1,FED)
    endif
    if F4D>0 then
      set tt_item1=CreateItem(F4D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p3,false)
      call SetItemUserData(tt_item1,1)
    endif
    if FFD>0 then
      call SetItemCharges(tt_item1,FFD)
    endif
    if F7D>0 then
      set tt_item1=CreateItem(F7D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p4,false)
      call SetItemUserData(tt_item1,1)
    endif
    if FGD>0 then
      call SetItemCharges(tt_item1,FGD)
    endif
    if F8D>0 then
      set tt_item1=CreateItem(F8D,GetUnitX(ECD),GetUnitY(ECD))
      call UnitAddItem(ECD,tt_item1)
      call SetItemPlayer(tt_item1,p5,false)
      call SetItemUserData(tt_item1,1)
    endif
    if FHD>0 then
      call SetItemCharges(tt_item1,FHD)
    endif
    if ShowCourierIcon[GetPlayerId(GetOwningPlayer(ECD))]==false then
      call UnitRemoveType(ECD,UNIT_TYPE_PEON)
    else
      call UnitAddType(ECD,UNIT_TYPE_PEON)
    endif
    call SetUnitFlyHeight(ECD,240,0)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  call EnableTrigger(t_manipulateitem)
  set t=null
  set ECD=null
  set p0=null
  set p1=null
  set p2=null
  set p3=null
  set p4=null
  set p5=null
  return false
endfunction

function FVD takes unit FJD returns nothing
  local integer FKD=GetUnitTypeId(FJD)
  local real x=GetUnitX(FJD)
  local real y=GetUnitY(FJD)
  local item FMD
  local item FND
  local item FOD
  local item FPD
  local item FQD
  local item FRD
  local player p0
  local player p1
  local player p2
  local player p3
  local player p4
  local player p5
  local integer E0D
  local integer E5D
  local integer E2D
  local integer F4D
  local integer F7D
  local integer F8D
  local integer F9D=-1
  local integer FDD=-1
  local integer FED=-1
  local integer FFD=-1
  local integer FGD=-1
  local integer FHD=-1
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer E1D
  local item Item
  local integer i
  local item FWD
  set i=0
  loop
    exitwhen i>5
    set FWD=UnitItemInSlot(FJD,i)
    if GetIndex(FWD)==indexid_Gem then
      call UnitRemoveItem(FJD,FWD)
    endif
    set i=i+1
  endloop
  set FMD=UnitItemInSlot(FJD,0)
  set FND=UnitItemInSlot(FJD,1)
  set FOD=UnitItemInSlot(FJD,2)
  set FPD=UnitItemInSlot(FJD,3)
  set FQD=UnitItemInSlot(FJD,4)
  set FRD=UnitItemInSlot(FJD,5)
  set E0D=GetItemTypeId(FMD)
  set E5D=GetItemTypeId(FND)
  set E2D=GetItemTypeId(FOD)
  set F4D=GetItemTypeId(FPD)
  set F7D=GetItemTypeId(FQD)
  set F8D=GetItemTypeId(FRD)
  set p0=GetItemPlayer(FMD)
  set p1=GetItemPlayer(FND)
  set p2=GetItemPlayer(FOD)
  set p3=GetItemPlayer(FPD)
  set p4=GetItemPlayer(FQD)
  set p5=GetItemPlayer(FRD)
  set Item=FMD
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(GetIndex(Item))then
    set F9D=GetItemCharges(Item)
  endif
  set Item=FND
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(GetIndex(Item))then
    set FDD=GetItemCharges(Item)
  endif
  set Item=FOD
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(GetIndex(Item))then
    set FED=GetItemCharges(Item)
  endif
  set Item=FPD
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(GetIndex(Item))then
    set FFD=GetItemCharges(Item)
  endif
  set Item=FQD
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(GetIndex(Item))then
    set FGD=GetItemCharges(Item)
  endif
  set Item=FRD
  if GetItemType(Item)==ITEM_TYPE_ARTIFACT or IsIndexIdCharged(GetIndex(Item))then
    set FHD=GetItemCharges(Item)
  endif
  call DestroyItem(FMD)
  call DestroyItem(FND)
  call DestroyItem(FOD)
  call DestroyItem(FPD)
  call DestroyItem(FQD)
  call DestroyItem(FRD)
  if IsSentinel(GetOwningPlayer(FJD))then
    set E1D='S00I'
  else
    set E1D='S00J'
  endif
  if GetRandomInt(1,3)==1 then
    set E1D='S00Z'
  endif
  call SavePlayerHandle(hashtable019,(Cache),(118),(p0))
  call SavePlayerHandle(hashtable019,(Cache),(119),(p1))
  call SavePlayerHandle(hashtable019,(Cache),(120),(p2))
  call SavePlayerHandle(hashtable019,(Cache),(121),(p3))
  call SavePlayerHandle(hashtable019,(Cache),(122),(p4))
  call SavePlayerHandle(hashtable019,(Cache),(123),(p5))
  call SaveInteger(hashtable019,(Cache),(106),(E0D))
  call SaveInteger(hashtable019,(Cache),(107),(E5D))
  call SaveInteger(hashtable019,(Cache),(108),(E2D))
  call SaveInteger(hashtable019,(Cache),(109),(F4D))
  call SaveInteger(hashtable019,(Cache),(110),(F7D))
  call SaveInteger(hashtable019,(Cache),(111),(F8D))
  call SaveInteger(hashtable019,(Cache),(112),(F9D))
  call SaveInteger(hashtable019,(Cache),(113),(FDD))
  call SaveInteger(hashtable019,(Cache),(114),(FED))
  call SaveInteger(hashtable019,(Cache),(115),(FFD))
  call SaveInteger(hashtable019,(Cache),(116),(FGD))
  call SaveInteger(hashtable019,(Cache),(117),(FHD))
  call SaveUnitHandle(hashtable019,(Cache),(124),(FJD))
  call SaveInteger(hashtable019,(Cache),(125),(E1D))
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function FUD))
  set t=null
  set FJD=null
  set FMD=null
  set FND=null
  set FOD=null
  set FPD=null
  set FQD=null
  set FRD=null
  set p0=null
  set p1=null
  set p2=null
  set p3=null
  set p4=null
  set p5=null
  set Item=null
  set FWD=null
endfunction

function FXD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local item FYD=ZE8(Source,Item_Real[indexid_RecipeFlyingCourier])
  if FYD==null then
    set FYD=ZE8(Source,Item_Mute[indexid_RecipeFlyingCourier])
  endif
  if FYD!=null then
    call RemoveItem(FYD)
    call FVD(Source)
  else
    call Error(GetOwningPlayer(Source),GetObjectName('n02Q'))
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  set FYD=null
  return false
endfunction

function FZD takes unit Source returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call EXD(Source)
  call TriggerRegisterTimerEvent(t,.05,false)
  call TriggerAddCondition(t,Condition(function FXD))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=null
endfunction

function FAD takes nothing returns boolean
  if GetSpellAbilityId()=='A0GD' then
    call FZD(GetTriggerUnit())
  endif
  return false
endfunction

function FBD takes nothing returns boolean
  local unit Hero=GetTriggerUnit()
  local item Item=GetManipulatedItem()
  local integer id=GetItemTypeId(Item)
  local integer i
  if(id==Item_Real[indexid_ScrollOfTownPortal]or id==Item_Real[indexid_bootsOfTravel])and IsUnitType(Hero,UNIT_TYPE_HERO) then
    set V17[GetPlayerId(GetOwningPlayer(Hero))]=GetItemX(Item)
    set V07[GetPlayerId(GetOwningPlayer(Hero))]=GetItemY(Item)
  endif
  call CW9(Hero,Item)
  call RemoveDefaultString(Hero,1)
  call Func4145(Hero,Item)
  if(GetItemTypeId(Item)==Item_Real[indexid_ArmletOn]or GetItemTypeId(Item)==Item_Real[indexid_ArmletOff])and IsCourier(Hero)then
    call UnitRemoveItem(Hero,Item)
  elseif (GetItemTypeId(Item))==Item_Real[indexid_MagicWand]and IsUnitType(Hero,UNIT_TYPE_HERO) then
    set i=(LoadInteger(hashtable019,(GetHandleId(Hero)),(750)))
    if i>0 then
      if(LoadBoolean(hashtable019,(GetHandleId(Hero)),(751)))==false then
        call SaveBoolean(hashtable019,(GetHandleId(Hero)),(751),(true))
        call SetItemCharges(Item,i)
      endif
    endif
  elseif GetItemTypeId(Item)==Item_Real[indexid_Aegis]and GetUnitTypeId(Hero)!='n00L' and M47==false then
    set K27=Hero
    set M47=true
    call Traffic_RegisterData("AegisOn",GetPlayerId(GetOwningPlayer(Hero)))
    if (IsSentinel(GetOwningPlayer(Hero)) and LastRoshanSlayer==0) or (IsScourge(GetOwningPlayer(Hero)) and LastRoshanSlayer==1) then
      call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,udg_Colors[GetPlayerId(GetOwningPlayer(Hero))]+GetUnitName(Hero)+"|r "+GetObjectName('n0EQ'))
    else
      call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,udg_Colors[GetPlayerId(GetOwningPlayer(Hero))]+GetUnitName(Hero)+"|r "+"snatched Aegis of the Immortal!")
    endif
  elseif GetItemTypeId(Item)==Item_Real[indexid_RecipeFlyingCourier] and IsBasicCourier(Hero)then
    call FZD(Hero)
  elseif GetItemTypeId(Item)==Item_Real[indexid_AghanimEnchantress]and isPlayerPickedAbility(GetOwningPlayer(Hero),12)then
    call SetPlayerTechResearched(GetOwningPlayer(Hero),'R00J',1)
  elseif GetItemTypeId(Item)==Item_Real[indexid_AghanimMeepo]and GetUnitTypeId(Hero)=='H00I' then
    set tt_unit1=Hero
    call ExeFunc("FCD")
  elseif GetItemTypeId(Item)==Item_Real[indexid_AghanimTiny]and GetUnitTypeId(Hero)!='U01X' then
    if GetUnitTypeId(Hero)=='Ucrl' then //regular morph to tree tiny
      call SaveInteger(hashtable019,GetHandleId(LoadTriggerHandle(hashtable019,GetHandleId(Hero),'0PAS')),100,1)
      call TriggerEvaluate(LoadTriggerHandle(hashtable019,GetHandleId(Hero),'0PAS'))  //FORCE DISABLE PASSIVES WHEN MORPHING
      call UnitAddAbility(Hero,'A2KB')
      call UnitRemoveAbility(Hero,'A2KB')
      set HeroTypeId[GetPlayerId(GetOwningPlayer(Hero))]='U01X'
      call UnitMakeAbilityPermanent(Hero,true,'A1W0')
      call UnitMakeAbilityPermanent(Hero,true,'A2KK')
      call UnitMakeAbilityPermanent(Hero,true,'A1W4')
      call AddUnitAnimationProperties(Hero,"upgrade",true)
      call SetPlayerTechResearched(GetOwningPlayer(Hero),'R00K',1)
    else //add abilities
      call UnitAddAbility2(Hero,'A2KK')
      call UnitMakeAbilityPermanent(Hero,true,'A1W0')
      call UnitMakeAbilityPermanent(Hero,true,'A1W4')
      call SetPlayerTechResearched(GetOwningPlayer(Hero),'R00K',1)
    endif
  endif
  set Hero=null
  set Item=null
  return false
endfunction

function F3D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if GetSpellAbilityId()=='Aeat' or (GetSpellAbilityId()=='ANTG' and GetSpellTargetDestructable()!=null) then
      call SaveInteger(hashtable019,(Cache),(34),(16))
    endif
  elseif IsDead(Source)or GetTriggerEventId()==EVENT_UNIT_DEATH or Count==0 then
    call UnitRemoveAbility(Source,'A0PV')
    call UnitRemoveAbility(Source,'B07L')
    call SaveInteger(hashtable019,(GetHandleId((Source))),((4255)),(2))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)+115/ 16)
    call SaveInteger(hashtable019,(Cache),(34),(Count-1))
  endif
  set t=null
  set Source=null
  return false
endfunction

function F6D takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveInteger(hashtable019,(GetHandleId((Source))),((4255)),(1))
  call UnitAddAbility2(Source,'A0PV')
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(34),(16))
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function F3D))
  call TriggerEvaluate(t)
  set Source=null
  set t=null
endfunction

function TangoShare takes unit who, unit towho returns nothing
  call UnitAddItemById(towho,'INTG')
endfunction

function TangoUsed takes nothing returns nothing
  if GetSpellTargetDestructable()!=null and ((LoadInteger(hashtable019,(GetHandleId((GetTriggerUnit()))),((4255))))==1)==false then
    call F6D()
  elseif GetSpellTargetDestructable()==null and GetSpellTargetUnit()!=null then
    call TangoShare(GetTriggerUnit(),GetSpellTargetUnit())
  endif
endfunction

function FLD takes nothing returns nothing
  if GetSpellAbilityId()=='ANTG' then
    call TangoUsed()
  endif
  if GetSpellAbilityId()=='Aeat' and ((LoadInteger(hashtable019,(GetHandleId((GetTriggerUnit()))),((4255))))==1)==false then
    call F6D()
  endif
endfunction

function F1D takes integer id,real x,real y returns nothing
  if IsPointInRegion(WE7,x,y)==false then
    set W87=W87+1
    set V57[W87]=Player(id)
    set V27[W87]=x
    set W47[W87]=y
    set W77[W87]=(TimerGetElapsed(GlobalTimer))
  endif
endfunction

function F0D takes integer id,real x,real y returns integer
  local real Time=(TimerGetElapsed(GlobalTimer))
  local integer i=0
  local integer Count=0
  if IsPointInRegion(WE7,x,y) then
    return Count
  endif
  loop
    exitwhen i>W87
    if(Time<W77[i]+W97)and(DistanceBetweenXY(x,y,V27[i],W47[i])<WD7*2+50)and IsPlayerAlly(Player(id),V57[i]) then
      set Count=Count+1
    endif
    set i=i+1
  endloop
  return Count
endfunction

function F5D takes integer ZG8 returns integer
  if ZG8==GetPlayerId(Sentinels[1])then
    return 'h0BI'
  elseif ZG8==GetPlayerId(Sentinels[2])then
    return 'h0BK'
  elseif ZG8==GetPlayerId(Sentinels[3])then
    return 'h0BG'
  elseif ZG8==GetPlayerId(Sentinels[4])then
    return 'h0BF'
  elseif ZG8==GetPlayerId(Sentinels[5])then
    return 'h0BL'
  elseif ZG8==GetPlayerId(Scourges[1])then
    return 'h0BH'
  elseif ZG8==GetPlayerId(Scourges[2])then
    return 'h0BJ'
  elseif ZG8==GetPlayerId(Scourges[3])then
    return 'h0BM'
  elseif ZG8==GetPlayerId(Scourges[4])then
    return 'h0A5'
  elseif ZG8==GetPlayerId(Scourges[5])then
    return 'h0BN'
  endif
  return 'h0BN'
endfunction

function F2D takes integer ZG8 returns integer
  return 'h0AX'
endfunction

function G4D takes integer ZG8 returns string
  if ZG8==GetPlayerId(Sentinels[1])then
    return"war3mapImported\\TeleportTarget_Blue.mdx"
  elseif ZG8==GetPlayerId(Sentinels[2])then
    return"war3mapImported\\TeleportTarget_Teal.mdx"
  elseif ZG8==GetPlayerId(Sentinels[3])then
    return"war3mapImported\\TeleportTarget_Purple.mdx"
  elseif ZG8==GetPlayerId(Sentinels[4])then
    return"war3mapImported\\TeleportTarget_Yellow.mdx"
  elseif ZG8==GetPlayerId(Sentinels[5])then
    return"war3mapImported\\TeleportTarget_Orange.mdx"
  elseif ZG8==GetPlayerId(Scourges[1])then
    return"war3mapImported\\TeleportTarget_Pink.mdx"
  elseif ZG8==GetPlayerId(Scourges[2])then
    return"war3mapImported\\TeleportTarget_Gray.mdx"
  elseif ZG8==GetPlayerId(Scourges[3])then
    return"war3mapImported\\TeleportTarget_LightBlue.mdx"
  elseif ZG8==GetPlayerId(Scourges[4])then
    return"war3mapImported\\TeleportTarget_DarkGreen.mdx"
  elseif ZG8==GetPlayerId(Scourges[5])then
    return"war3mapImported\\TeleportTarget_Brown.mdx"
  endif
  return"Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl"
endfunction

function G7D takes integer ZG8 returns string
  return"Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl"
endfunction

function G8D takes nothing returns boolean
  local real d
  if IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>0 and GetUnitAbilityLevel(GetFilterUnit(),'Asud')==0 and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(tt_unit2)) and GetUnitTypeId(GetFilterUnit())!='u00S' and GetUnitTypeId(GetFilterUnit())!='ncop' and GetUnitTypeId(GetFilterUnit())!='emow' and GetUnitTypeId(GetFilterUnit())!='uzig' and IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false then
    set d=DistanceBetweenXY(real084,real085,GetUnitX(GetFilterUnit()),GetUnitY(GetFilterUnit()))
    if d<tt_real1 then
      set tt_real1=d
      set tt_unit1=GetFilterUnit()
    endif
  endif
  return false
endfunction

function G9D takes unit whichUnit,real x,real y returns unit
  local group g=GetAvailableGroup()
  set tt_unit1=null
  set tt_unit2=whichUnit
  set tt_real1=99999
  set real084=x
  set real085=y
  call GroupEnumUnitsInRange(g,x,y,99999,Condition(function G8D))
  call KillGroup(g)
  set g=null
  return tt_unit1
endfunction

function GDD takes unit u returns boolean
  local integer id=GetUnitTypeId(u)
  return id=='n0FH' or id=='n0F6' or id=='n0FI' or id=='n0FJ'
endfunction

function IsSiegeUnit takes unit u returns boolean
  local integer id=GetUnitTypeId(u)
  return id=='u00R' or id=='umtw' or id=='e026' or id=='ebal'
endfunction

function GFD takes nothing returns boolean
  local real d
  if(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 or IsSiegeUnit(GetFilterUnit())or GetUnitTypeId(GetFilterUnit())=='nfoh' or GetUnitTypeId(GetFilterUnit())=='ndfl' or GDD(GetFilterUnit()))and IsDead(GetFilterUnit())==false and GetUnitAbilityLevel(GetFilterUnit(),'Asud')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==false and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(tt_unit2)) and GetOwningPlayer(GetFilterUnit())!=Player15 and IsUnitIllusion(GetFilterUnit())==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_FLYING)==false and GetUnitTypeId(GetFilterUnit())!='n0F5' then
    set d=DistanceBetweenXY(real084,real085,GetUnitX(GetFilterUnit()),GetUnitY(GetFilterUnit()))
    if d<tt_real1 then
      set tt_real1=d
      set tt_unit1=GetFilterUnit()
    endif
  endif
  return false
endfunction

function GGD takes unit whichUnit,real x,real y returns unit
  local group g=GetAvailableGroup()
  set tt_unit1=null
  set tt_unit2=whichUnit
  set tt_real1=99999
  set real084=x
  set real085=y
  call GroupEnumUnitsInRange(g,x,y,99999,Condition(function GFD))
  call KillGroup(g)
  set g=null
  return tt_unit1
endfunction

function GHD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local unit GID=(LoadUnitHandle(hashtable019,(Cache),(448)))
  local unit GJD=(LoadUnitHandle(hashtable019,(Cache),(447)))
  local ubersplat Splat=(LoadUbersplatHandle(hashtable019,(Cache),(131)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local real DP9=(LoadReal(hashtable019,(Cache),(57)))
  local real Time=(LoadReal(hashtable019,(Cache),(442)))
  local integer id=GetPlayerId(GetOwningPlayer(Hero))
  local boolean GKD=false
  local integer i=0
  local integer charges
  if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST then
    if GetSpellAbilityId()=='A1R5' then
      set GKD=true
    endif
  else
    set Count=Count+1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    if Count==1 then
      if DP9>3 then
        call SetUnitAnimationByIndex(GID,1)
        call SetUnitAnimationByIndex(GJD,1)
      endif
    elseif Count==2 then
      set GKD=true
    else
    endif
  endif
  if GKD then
    call SaveInteger(hashtable019,(GetHandleId((Hero))),((4256)),(2))
    call KillUnit(GID)
    call KillUnit(GJD)
    call DestroyUbersplat(Splat)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if Count==2 then
      call DestroyEffect(AddSpecialEffect(G7D(id),GetUnitX(Hero),GetUnitY(Hero)))
      call DestroyEffect(AddSpecialEffect(G4D(id),x,y))
      call SetUnitX(Hero,x)
      call SetUnitY(Hero,y)
      call PauseUnit(Hero,true)
      call PauseUnit(Hero,false)
      call KillTrees(x,y,240)
    endif
  endif
  set t=null
  set Hero=null
  set GID=null
  set GJD=null
  set Splat=null
  return false
endfunction

function GMD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local unit GID=(LoadUnitHandle(hashtable019,(Cache),(448)))
  local unit GJD=(LoadUnitHandle(hashtable019,(Cache),(447)))
  local ubersplat Splat=(LoadUbersplatHandle(hashtable019,(Cache),(131)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local real DP9=(LoadReal(hashtable019,(Cache),(57)))
  local real Time=(LoadReal(hashtable019,(Cache),(442)))
  local integer id=GetPlayerId(GetOwningPlayer(Hero))
  local boolean GKD=false
  local integer i=0
  local integer charges
  if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST then
    if GetSpellAbilityId()=='A231' then
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(177))))
      call SaveInteger(hashtable019,(GetHandleId((Hero))),((4256)),(2))
      call KillUnit(GID)
      call KillUnit(GJD)
      call DestroyUbersplat(Splat)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call UnitRemoveType(Target,UNIT_TYPE_PEON)
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_DEATH then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(177))))
    call UnitRemoveType(Target,UNIT_TYPE_PEON)
    call SaveInteger(hashtable019,(GetHandleId((Hero))),((4256)),(2))
    call KillUnit(GID)
    call KillUnit(GJD)
    call DestroyUbersplat(Splat)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(177))))
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",GetUnitX(Hero),GetUnitY(Hero)))
    call SaveInteger(hashtable019,(GetHandleId((Hero))),((4256)),(2))
    call KillUnit(GID)
    call KillUnit(GJD)
    call DestroyUbersplat(Splat)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call UnitRemoveType(Target,UNIT_TYPE_PEON)
    call SetUnitX(Hero,GetUnitX(Target)-1)
    call SetUnitY(Hero,GetUnitY(Target)-1)
    call PauseUnit(Hero,true)
    call PauseUnit(Hero,false)
    call KillTrees(x,y,240)
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",GetUnitX(Hero),GetUnitY(Hero)))
  endif
  set t=null
  set Hero=null
  set GID=null
  set GJD=null
  set Splat=null
  set Target=null
  return false
endfunction

function ShowTPTimer takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit hero=LoadUnitHandle(hashtable019,h,0)
  local real time=LoadReal(hashtable019,h,0)
  local real curtime=GetTriggerEvalCount(t)*0.5-0.5
  local texttag tt
  if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST or curtime>=time then
    call FlushChildHashtable(hashtable019,h)
    call DestroyTrigger(t)
  else
    set tt=CreateTextTag()
    call SetTextTagText(tt,R2SW(time-curtime,1,1),.03)
    call SetTextTagPosUnit(tt,hero,0)
    call SetTextTagColorBJ(tt,150,75,255,15)
    call SetTextTagVelocity(tt,0,.035)
    call SetTextTagFadepoint(tt,3)
    call SetTextTagLifespan(tt,.5)
    call SetTextTagPermanent(tt,false)
    call SetTextTagVisibility(tt,IsUnitAlly(hero,GetLocalPlayer())or IsObserver(GetLocalPlayer()))
    set tt=null
  endif
  set t=null
  set hero=null
endfunction

function GND takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real x
  local real y
  local real a
  local trigger t
  local integer Cache
  local unit GID
  local unit GJD
  local ubersplat Splat
  local integer id=GetPlayerId(GetOwningPlayer(Hero))
  local integer Count
  local real GOD
  local trigger tt
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call SaveInteger(hashtable019,(GetHandleId((Hero))),((4256)),(1))
  if Target==null then
    set x=GetSpellTargetX()
    set y=GetSpellTargetY()
    if x==V17[id]and y==V07[id]then
      if IsSentinel(GetOwningPlayer(Hero))then
        set x=GetUnitX(SentFountain)
        set y=GetUnitY(SentFountain)
      else
        set x=GetUnitX(ScourgeFountain)
        set y=GetUnitY(ScourgeFountain)
      endif
    endif
    set Target=G9D(Hero,x,y)
  else
    set x=GetUnitX(Target)
    set y=GetUnitY(Target)
  endif
  if DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))>WD7 then
    set a=Atan2(y-GetUnitY(Target),x-GetUnitX(Target))
    set x=GetUnitX(Target)+WD7*Cos(a)
    set y=GetUnitY(Target)+WD7*Sin(a)
  elseif DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))<50 then
    set a=Atan2(y-GetUnitY(Target),x-GetUnitX(Target))
    set x=GetUnitX(Target)+120*Cos(a)
    set y=GetUnitY(Target)+120*Sin(a)
  endif
  if IsPointInRegion(RestrictedRegion,x,y) then
    set a=Atan2(y-GetUnitY(Target),x-GetUnitX(Target))
    set x=GetUnitX(Target)+200*Cos(a)
    set y=GetUnitY(Target)+200*Sin(a)
  endif
  set x=SafeX50(x)
  set y=SafeY50(y)
  if(IsUnitAlly(Hero,GetLocalPlayer())and GetLocalPlayer()!=GetOwningPlayer(Hero))or(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2))then
    call PingMinimapEx(x,y,3,255,255,255,false)
  endif
  set GJD=CreateUnit(GetOwningPlayer(Hero),F5D(id),x,y,0)
  set GID=CreateUnit(GetOwningPlayer(Hero),F2D(id),GetUnitX(Hero),GetUnitY(Hero),0)
  set Splat=CreateUbersplat(GetUnitX(Hero),GetUnitY(Hero),"SCTP",255,255,255,255,false,false)
  call SetUbersplatRenderAlways(Splat,IsUnitVisibleLoD(Hero,GetLocalPlayer()))
  set Count=F0D(GetPlayerId(GetOwningPlayer(Hero)),x,y)
  set GOD=3
  if Count>0 then
    set GOD=4.5+0.5*Count
  endif
  call F1D(GetPlayerId(GetOwningPlayer(Hero)),x,y)
  if Count>0 then
    call SetUnitAnimationByIndex(GID,2)
    call SetUnitAnimationByIndex(GJD,2)
  endif
  call TriggerRegisterTimerEvent(t,GOD-3,false)
  call TriggerRegisterTimerEvent(t,GOD,false)
  
  set tt=CreateTrigger()
  call TriggerRegisterTimerEvent(tt,0.5,true)
  call TriggerRegisterTimerEvent(tt,0,false)
  call SaveUnitHandle(hashtable019,GetHandleId(tt),0,Hero)
  call SaveReal(hashtable019,GetHandleId(tt),0,GOD)
  call TriggerAddCondition(tt,Condition(function ShowTPTimer))
  call TriggerRegisterUnitEvent(tt,Hero,EVENT_UNIT_SPELL_ENDCAST)
  set tt=null
  
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerAddCondition(t,Condition(function GHD))
  call TimedReveal(GetOwningPlayer(Hero),GOD,x,y,200)
  call SaveUnitHandle(hashtable019,(Cache),(447),(GJD))
  call SaveUnitHandle(hashtable019,(Cache),(448),(GID))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveReal(hashtable019,(Cache),(442),(((TimerGetElapsed(GlobalTimer)))*1.))
  call SaveReal(hashtable019,(Cache),(57),((GOD)*1.))
  call SaveUbersplatHandle(hashtable019,(Cache),(131),(Splat))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  call BB8(Hero,ZF,x,y,2400)
  set Hero=null
  set Target=null
  set GID=null
  set GJD=null
  set t=null
  set Splat=null
endfunction

function GPD takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real x
  local real y
  local real a
  local trigger t
  local integer Cache
  local unit GID
  local unit GJD
  local ubersplat Splat
  local integer id=GetPlayerId(GetOwningPlayer(Hero))
  local integer Count
  local real GOD
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  if Target==null then
    set x=GetSpellTargetX()
    set y=GetSpellTargetY()
    if x==V17[id]and y==V07[id]then
      if IsSentinel(GetOwningPlayer(Hero))then
        set x=GetUnitX(SentFountain)
        set y=GetUnitY(SentFountain)
      else
        set x=GetUnitX(ScourgeFountain)
        set y=GetUnitY(ScourgeFountain)
      endif
    endif
    set Target=GGD(Hero,x,y)
  endif
  set x=GetUnitX(Target)
  set y=GetUnitY(Target)
  if(IsUnitAlly(Hero,GetLocalPlayer())and GetLocalPlayer()!=GetOwningPlayer(Hero))or(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2))then
    call PingMinimapEx(x,y,3,255,255,255,false)
  endif
  set Splat=CreateUbersplat(GetUnitX(Hero),GetUnitY(Hero),"SCTP",255,255,255,255,false,false)
  call SetUbersplatRenderAlways(Splat,IsUnitVisibleLoD(Hero,GetLocalPlayer()))
  set GOD=3
  call UnitAddType(Target,UNIT_TYPE_PEON)
  call TriggerRegisterTimerEvent(t,GOD,false)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function GMD))
  call TimedReveal(GetOwningPlayer(Hero),GOD,x,y,200)
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveReal(hashtable019,(Cache),(442),(((TimerGetElapsed(GlobalTimer)))*1.))
  call SaveReal(hashtable019,(Cache),(57),((GOD)*1.))
  call SaveUbersplatHandle(hashtable019,(Cache),(131),(Splat))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl",Hero,"origin")))
  call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl",Hero,"origin")))
  call SaveEffectHandle(hashtable019,(Cache),(177),(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl",Target,"origin")))
  call BB8(Hero,ZF,x,y,2400)
  set Hero=null
  set Target=null
  set GID=null
  set GJD=null
  set t=null
  set Splat=null
endfunction

function GQD takes nothing returns nothing
  if GetSpellAbilityId()=='A1R5' and IsCourier(GetTriggerUnit())==false then
    call GND()
  endif
  if GetSpellAbilityId()=='A231' then
    call GPD()
  endif
endfunction

function GRD takes nothing returns nothing
  call KillUnit(GetEnumUnit())
endfunction

function GSD takes nothing returns boolean
  local integer i=GetUnitTypeId(GetFilterUnit())
  return i=='n00H' or i=='n00G' or i=='n00K' or i=='n00J' or i=='n00A' or i=='n006'
endfunction

function GTD takes nothing returns nothing
  local group g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,GetOwningPlayer(GetTriggerUnit()),Condition(function GSD))
  call ForGroup(g,function GRD)
  call KillGroup(g)
  set g=null
endfunction

function GUD takes nothing returns nothing
  if GetSpellAbilityId()=='A0HB' or GetSpellAbilityId()=='A0D3' or GetSpellAbilityId()=='A0DF' then
    call GTD()
  endif
endfunction

function GVD takes nothing returns nothing
  if GetSpellAbilityId()=='A1FP' then
    call Z48("Abilities\\Spells\\Items\\VampiricPotion\\VampPotionCaster.mdl",GetTriggerUnit(),"origin",3.5)
    call AddTimedAbility(GetTriggerUnit(),'A1CN',1,3.5)
  endif
endfunction

function GWDb takes nothing returns nothing
  local unit u= GetSpellTargetUnit()
  local integer info
  local integer p=GetPlayerId(GetOwningPlayer(u))
  if IsSentinel(GetOwningPlayer(u)) then
    call UnitShareVision(u,Scourges[0],false)
    call UnitShareVision(u,Scourges[1],false)
    call UnitShareVision(u,Scourges[2],false)
    call UnitShareVision(u,Scourges[3],false)
    call UnitShareVision(u,Scourges[4],false)
    call UnitShareVision(u,Scourges[5],false)
  else
    call UnitShareVision(u,Sentinels[0],false)
    call UnitShareVision(u,Sentinels[1],false)
    call UnitShareVision(u,Sentinels[2],false)
    call UnitShareVision(u,Sentinels[3],false)
    call UnitShareVision(u,Sentinels[4],false)
    call UnitShareVision(u,Sentinels[5],false)
  endif
  
  
  
  //call UnitApplyTimedLife(GetSpellTargetUnit(),'BTLF',1200)
  call UnitAddAbility(u,'Aeth')
  call UnitAddAbility(u,'ACrk')
  call YZ8(u)
  set info = GetHandleId(GetTriggerUnit())
  call KillUnit(LoadUnitHandle(MHT,info,'ACch'))
  call SaveUnitHandle(MHT,info,'ACch',u)
  set u = null
endfunction

function GWD takes nothing returns nothing
  if GetSpellAbilityId()=='ACch' then
    call GWDb()
  endif
endfunction

function GXD takes integer i returns integer//bkb shells 10-4
  if i=='A11F' then
    return 'A11B'
  endif
  if i=='A11E' then
    return 'A11A'
  endif
  if i=='A0S3' then
    return 'A0S2'
  endif
  if i=='A11D' then
    return 'A119'
  endif
  if i=='A11G' then
    return 'A11C'
  endif
  if i=='A11H' then
    return 'A118'
  endif
  if i=='A2LI' then
    return 'A2LH'
  endif
  return 0
endfunction

function GYD takes integer i returns integer
  if i=='A11F' then
    return 10
  endif
  if i=='A11E' then
    return 9
  endif
  if i=='A0S3' then
    return 8
  endif
  if i=='A11D' then
    return 7
  endif
  if i=='A11G' then
    return 6
  endif
  if i=='A11H' then
    return 5
  endif
  if i=='A2LI' then
    return 4
  endif
  return 0
endfunction

function GZD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  if IsDead(Hero)==false and Hero!=null then
    call SetUnitScale(Hero,U18(Hero)*DH8,U18(Hero)*DH8,U18(Hero)*DH8)
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  return false
endfunction

function GAD takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',GetUnitX(Hero),GetUnitY(Hero),0)
  local trigger t=CreateTrigger()
  local real DP9=GYD(GetSpellAbilityId())
  call A68(Hero,WS7,DP9)
  call UnitMakeAbilityPermanent(Hero,true,WS7)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),WS7,false)
  call UnitAddAbility(Caster,GXD(GetSpellAbilityId()))
  call IssueTargetOrderById(Caster,852186,Hero)
  call E79(Hero,0,0)
  if IsCourier(Hero)then
    call AA8(Hero,DP9,3)
  else
    call AA8(Hero,DP9,1.4)
  endif
  call TriggerRegisterTimerEvent(t,DP9+7,false)
  call TriggerAddCondition(t,Condition(function GZD))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(Hero))
  set t=null
  set Hero=null
  set Caster=null
endfunction

function GBD takes nothing returns nothing
  if GXD(GetSpellAbilityId())>0 then
    call GAD()
  endif
endfunction

function GCD takes nothing returns nothing
  if((LoadInteger(hashtable019,(GetHandleId((GetEnumUnit()))),((4258))))==1) then
    call Error(GetOwningPlayer(GetEnumUnit()),GetObjectName('n02M')+" "+GetUnitName(GetEnumUnit())+" "+GetObjectName('n02S'))
  else
    if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO) then
      call AddTimedKeyToUnit(GetEnumUnit(),4258,25)
    endif
    call SetUnitState(GetEnumUnit(),UNIT_STATE_LIFE,GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)+250)
  endif
endfunction

function G3D takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),775,Condition(function L18))
  call ForGroup(g,function GCD)
  call KillGroup(g)
  set Source=null
  set g=null
endfunction

function G6D takes nothing returns nothing
  if GetSpellAbilityId()=='A0CK' then
    call G3D()
  endif
endfunction

function GLD takes nothing returns nothing
  if((LoadInteger(hashtable019,(GetHandleId((GetEnumUnit()))),((4278))))==1) then
    call Error(GetOwningPlayer(GetEnumUnit()),GetObjectName('n02M'))
  else
    if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO) then
      call AddTimedKeyToUnit(GetEnumUnit(),4278,50)
    endif
    if GetUnitAbilityLevel(GetEnumUnit(),'B0BT')==0 and GetUnitAbilityLevel(GetEnumUnit(),'B0BU')==0 then
      call IssueTargetOrderById(WT7,852186,GetEnumUnit())
    endif
  endif
endfunction

function G1D takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local group g=GetAvailableGroup()
  set WT7=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
  call UnitAddAbility(WT7,'A1EV')
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),525,Condition(function L28))
  call ForGroup(g,function GLD)
  call KillGroup(g)
  set Source=null
  set g=null
endfunction

function G0D takes nothing returns nothing
  if GetSpellAbilityId()=='A1EW' then
    call G1D()
  endif
endfunction


function G5D takes nothing returns nothing
  if GetSpellAbilityId()=='A02W' then
    call UnitResetCooldown(GetTriggerUnit())
    call RemoveAbilsForUnit(GetTriggerUnit())
  endif
endfunction

function G2D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED or GetUnitAbilityLevel(GetTriggerUnit(),'B031')==0 then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    set PE8=true
    call DamageTarget(Source,Target,1,Damage)
    set PE8=false
    if Damage>0 then
      call TextTagOnUnit("+"+I2S(R2I(Damage)),1,Target,.023,255,0,0,216)
    endif
  elseif GetEventDamage()>1 then
    if IsRealDamage then
      call SaveReal(hashtable019,(Cache),(20),Damage+GetEventDamage()*0.3)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function H4D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Silence\\SilenceTarget.mdl",Target,"overhead")))
  call SaveReal(hashtable019,(Cache),(20),0)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(t,5,false)
  call TriggerAddCondition(t,Condition(function G2D))
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function H7D takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function H4D))
  call SaveUnitHandle(hashtable019,(Cache),(17),(GetSpellTargetUnit()))
  call SaveUnitHandle(hashtable019,(Cache),(2),(GetTriggerUnit()))
  set t=null
endfunction

function H8D takes nothing returns nothing
  if GetSpellAbilityId()=='A0FD' and IsBlocked(GetSpellTargetUnit())==false then
    call H7D()
  endif
endfunction

function H9D takes unit u,real d returns boolean
  if IsUnitType(u,UNIT_TYPE_HERO)or GetUnitAbilityLevel(u,'A04R')>0 then
    return d>5
  endif
  return true
endfunction

function HDD takes unit u returns unit
  local group g
  if GetUnitAbilityLevel(u,'A04R')==0 then
    return u
  endif
  set tt_unit1=WV7
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(u),GetUnitY(u),900,Condition(function DefaultEnemyFilter))
  set WU7=FirstOfGroup(g)
  call KillGroup(g)
  set g=null
  return WU7
endfunction

function StaticChargeAoE takes nothing returns nothing
  local unit u
  if StaticChargeCounter>0 then
    set StaticChargeCounter=StaticChargeCounter-1
    set u=CreateUnit(GetOwningPlayer(StaticChargeCaster),'e00E',GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),0)
    call UnitAddAbility(u,'A0K6')
    call IssueTargetOrder(u,"forkedlightning",GetEnumUnit())
    set u=null
  endif
endfunction

function HED takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster
  local unit Source
  local group g
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set g=GetAvailableGroup()
    set Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
    set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),0)
    call AddTimedKeyToUnit(GetTriggerUnit(),4257,1)
    call UnitAddAbility(Caster,'A0K6')
    set StaticChargeCaster=Source
    set StaticChargeCounter=6
    call GroupEnumUnitsInRange(g,GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),925,Condition(function NonImmuneEnemyFilter))
    if DistanceBetweenUnits(GetTriggerUnit(),GetEventDamageSource())<900 then
      if IssueTargetOrderById(Caster,852587,HDD(GetEventDamageSource())) then
        set StaticChargeCounter=5
      endif
    endif
    call ForGroup(g,function StaticChargeAoE)
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Caster=null
  set Source=null
endfunction

function HFD takes nothing returns boolean
  if(GetTriggerEventId()==EVENT_UNIT_DAMAGED and H9D(GetEventDamageSource(),GetEventDamage())and GetRandomInt(1,100)<21 and((LoadInteger(hashtable019,(GetHandleId((GetTriggerUnit()))),((4257))))==1)==false)or GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call HED()
  endif
  return false
endfunction

function HGD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  if Target==null then
    set Target=Source
  endif
  call AddTimedKeyToUnit(Target,4279,20)
  call TriggerRegisterTimerEvent(t,20,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function HFD))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldTarget.mdl",Target,"origin")))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=null
  set Source=null
  set Target=null
endfunction

function HHD takes nothing returns nothing
  if GetSpellAbilityId()=='A0JL' and((LoadInteger(hashtable019,(GetHandleId((GetSpellTargetUnit()))),((4279))))==1)==false then
    call HGD()
  endif
endfunction

function HID takes nothing returns nothing
  local unit HJD=GetTriggerUnit()
  local item FYD=ZE8(HJD,Item_Real[indexid_RecipeFlyingCourier])
  if FYD==null then
    set FYD=ZE8(HJD,Item_Mute[indexid_RecipeFlyingCourier])
  endif
  if FYD!=null then
    call DestroyItem(FYD)
    call UnitRemoveAbility(HJD,'A0VR')
    call UnitAddAbility(HJD,'A0VU')
    call SetUnitState(HJD,UNIT_STATE_MANA,400)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl",HJD,"origin"))
  else
    call Error(GetOwningPlayer(HJD),GetObjectName('n02Q'))
  endif
  set HJD=null
  set FYD=null
endfunction

function HKD takes nothing returns nothing
  if GetSpellAbilityId()=='A0VR' then
    call HID()
  endif
endfunction

function HMD takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local group HND=WW7
  local unit Source=WX7
  if IsUnitInGroup(Target,HND)==false then
    call GroupAddUnit(HND,Target)
    call IssueTargetOrderById(WY7,852075,Target)
    set PE8=true
    call DamageTarget(Source,Target,1,200)
    set PE8=false
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl",Target,"origin"))
  endif
  set Target=null
  set HND=null
  set Source=null
endfunction

function HOD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local real d
  local real x
  local real x0=GetUnitX(Source)
  local real y
  local real y0=GetUnitY(Source)
  local group g=GetAvailableGroup()
  local integer Count=GetTriggerEvalCount(t)
  local integer i
  call SetUnitX(Caster,GetUnitX(Source))
  call SetUnitY(Caster,GetUnitY(Source))
  set WW7=HND
  set WX7=Source
  set WY7=(LoadUnitHandle(hashtable019,(Cache),(132)))
  if GetTriggerEvalCount(t)>33 then
    call KillUnit(Caster)
    call KillGroup(HND)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set d=Count*21
    set i=0
    loop
      exitwhen i>36
      set x=x0+d*Cos(360*i/ 36*bj_DEGTORAD)
      set y=y0+d*Sin(360*i/ 36*bj_DEGTORAD)
      set tt_unit1=Source
      call GroupEnumUnitsInRange(g,x,y,150,Condition(function LT8))
      call ForGroup(g,function HMD)
      set i=i+1
    endloop
  endif
  call KillGroup(g)
  set t=null
  set Caster=null
  set HND=null
  set Source=null
  set g=null
  return false
endfunction

function HPD takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local real x=GetUnitX(Hero)
  local real y=GetUnitY(Hero)
  local group HND=GetAvailableGroup()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'h091',x,y,0)
  local unit HQD=CreateUnit(GetOwningPlayer(Hero),'e00E',GetUnitX(Hero),GetUnitY(Hero),0)
  call UnitAddAbility(HQD,'A0T0')
  call SaveGroupHandle(hashtable019,(Cache),(133),(HND))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveUnitHandle(hashtable019,(Cache),(132),(HQD))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Hero))
  call TriggerRegisterTimerEvent(t,.06,true)
  call TriggerAddCondition(t,Condition(function HOD))
  set t=null
  set HND=null
  set Caster=null
  set HQD=null
  set Hero=null
endfunction

function HRD takes nothing returns nothing
  if GetSpellAbilityId()=='A0T9' then
    call HPD()
  endif
endfunction

function HSD takes unit Source,integer HTD returns nothing
  local integer Cache=GetHandleId(Source)
  call SaveInteger(hashtable019,(Cache),(750),(HTD))
endfunction

function HUD takes nothing returns nothing
  local integer i=0
  local integer charges=0
  local boolean HVD=false
  if GetSpellAbilityId()=='A0JY' then
    loop
      exitwhen i>5
      if (F49(UnitItemInSlot(GetTriggerUnit(),i)))==indexid_MagicStick or (F49(UnitItemInSlot(GetTriggerUnit(),i)))==indexid_MagicWand then
        set charges=GetItemCharges(UnitItemInSlot(GetTriggerUnit(),i))
        if charges>0 then
          call SetItemCharges(UnitItemInSlot(GetTriggerUnit(),i),0)
          call HSD(GetTriggerUnit(),0)
          if HVD==false then
            set HVD=true
            call SetUnitState(GetTriggerUnit(),UNIT_STATE_MANA,GetUnitState(GetTriggerUnit(),UNIT_STATE_MANA)+15*charges)
            call SetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE,GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)+15*charges)
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIre\\AIreTarget.mdl",GetTriggerUnit(),"origin"))
          endif
        endif
        return
      endif
      set i=i+1
    endloop
  endif
endfunction

function IsNotADummyAbility takes integer id returns boolean
  local integer i=1
  loop
    exitwhen i>SomeDummyAbilitiesCounter
    if id==SomeDummyAbilitiesList[i]then
      return false
    endif
    set i=i+1
  endloop
  return true
endfunction

function HXD takes unit HYD,unit Source returns nothing
  if IsUnitVisibleLoD(HYD,GetOwningPlayer(Source))==false and GetRandomInt(1,100)<10 then
    call PlaySoundOnUnitBJ(sound030,100,Source)
  endif
endfunction

function HZD takes nothing returns nothing
  local unit Hero=GetEnumUnit()
  local integer i=0
  loop
    exitwhen i>5
    if IsUnitVisibleLoD(GetTriggerUnit(),GetOwningPlayer(GetEnumUnit())) then
      if (F49(UnitItemInSlot(Hero,i)))==indexid_MagicStick or (F49(UnitItemInSlot(Hero,i)))==indexid_MagicWand then
        if (F49(UnitItemInSlot(Hero,i)))==indexid_MagicWand then
          if GetItemCharges(UnitItemInSlot(Hero,i))==15 then
            call HXD(GetTriggerUnit(),Hero)
          endif
          call HSD(Hero,IMinIF(GetItemCharges(UnitItemInSlot(Hero,i))+1,15))
          call SetItemCharges(UnitItemInSlot(Hero,i),IMinIF(GetItemCharges(UnitItemInSlot(Hero,i))+1,15))
        else
          if GetItemCharges(UnitItemInSlot(Hero,i))==10 then
            call HXD(GetTriggerUnit(),Hero)
          endif
          call HSD(Hero,IMinIF(GetItemCharges(UnitItemInSlot(Hero,i))+1,10))
          call SetItemCharges(UnitItemInSlot(Hero,i),IMinIF(GetItemCharges(UnitItemInSlot(Hero,i))+1,10))
        endif
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl",Hero,"chest"))
        set i=5
      endif
    endif
    set i=i+1
  endloop
  set Hero=null
endfunction

function HAD takes nothing returns nothing
  local group g=GetAvailableGroup()
  local unit Source=GetTriggerUnit()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  call GroupEnumUnitsInRange(g,x,y,1225,Condition(function D89))
  call ForGroup(g,function HZD)
  call KillGroup(g)
  set g=null
  set Source=null
endfunction

function HBD takes nothing returns nothing
  if IsNotADummyAbility(GetSpellAbilityId()) and isAintItemAbility(GetSpellAbilityId()) and GetUnitAbilityLevel(GetTriggerUnit(),'A04R')==0 and isDummyAbility(GetSpellAbilityId())==false then
    call HAD()
  endif
endfunction

function HCD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit H3D=(LoadUnitHandle(hashtable019,(Cache),(134)))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    call HealUnitFor(GetTriggerUnit(),GetEventDamage())
  elseif GetTriggerEventId()==EVENT_UNIT_DEATH then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call UnitRemoveAbility(H3D,'A17R')
    call UnitRemoveAbility(H3D,'A24F')
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set H3D=null
  return false
endfunction

function H6D takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.5 and IsUnitAlly(GetFilterUnit(),WZ7) and GetOwningPlayer(GetFilterUnit())!=Player15 and GetUnitTypeId(GetFilterUnit())!='ncop' and GetUnitTypeId(GetFilterUnit())!='n0FJ' and GetUnitTypeId(GetFilterUnit())!='n0FI' and GetUnitTypeId(GetFilterUnit())!='n0F6' and GetUnitTypeId(GetFilterUnit())!='n0FH')!=null
endfunction

function HLD takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit H3D=GetEnumUnit()
  local string s
  call UnitAddAbility(H3D,'A17R')
  call UnitAddAbility(H3D,'A24F')
  if IsSentinel(WZ7)then
    set s="effects\\GlyphSent.mdx"
  else
    set s="effects\\GlyphScourge.mdx"
  endif
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget(s,H3D,"origin")))
  call SaveUnitHandle(hashtable019,(Cache),(134),(H3D))
  call TriggerRegisterUnitEvent(t,H3D,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,H3D,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(t,4,false)
  call TriggerAddCondition(t,Condition(function HCD))
  set t=null
  set H3D=null
endfunction

function H1D takes unit H0D,player p returns nothing
  local integer i
  if IsSentinel(p)then
    set i=1
    if H0D!=CirclesOfPower[i]then
      call IssueImmediateOrderById(CirclesOfPower[i],852244)
    endif
    set i=2
    if H0D!=CirclesOfPower[i]then
      call IssueImmediateOrderById(CirclesOfPower[i],852244)
    endif
    set i=3
    if H0D!=CirclesOfPower[i]then
      call IssueImmediateOrderById(CirclesOfPower[i],852244)
    endif
    set i=4
    if H0D!=CirclesOfPower[i]then
      call IssueImmediateOrderById(CirclesOfPower[i],852244)
    endif
    set i=5
    if H0D!=CirclesOfPower[i]then
      call IssueImmediateOrderById(CirclesOfPower[i],852244)
    endif
  else
    set i=7
    if H0D!=CirclesOfPower[i]then
      call IssueImmediateOrderById(CirclesOfPower[i],852244)
    endif
    set i=8
    if H0D!=CirclesOfPower[i]then
      call IssueImmediateOrderById(CirclesOfPower[i],852244)
    endif
    set i=9
    if H0D!=CirclesOfPower[i]then
      call IssueImmediateOrderById(CirclesOfPower[i],852244)
    endif
    set i=10
    if H0D!=CirclesOfPower[i]then
      call IssueImmediateOrderById(CirclesOfPower[i],852244)
    endif
    set i=11
    if H0D!=CirclesOfPower[i]then
      call IssueImmediateOrderById(CirclesOfPower[i],852244)
    endif
  endif
endfunction

function H5D takes nothing returns nothing
  local group g
  local unit H0D=GetTriggerUnit()
  local player p=GetOwningPlayer(H0D)
  if(IsSentinel(p)and WA7==false)or(IsSentinel(p)==false and WB7==false)then
    set g=GetAvailableGroup()
    set WZ7=p
    call GroupEnumUnitsInRange(g,0,0,12000,Condition(function H6D))
    call ForGroup(g,function HLD)
    call KillGroup(g)
    if IsSentinel(p)then
      set WA7=true
      call H1D(H0D,p)
      set WA7=false
    else
      set WB7=true
      call H1D(H0D,p)
      set WB7=false
    endif
  endif
  set g=null
  set H0D=null
  set p=null
endfunction

function H2D takes nothing returns nothing
  if GetSpellAbilityId()=='A141' or GetSpellAbilityId()=='A1WI' then
    call H5D()
  endif
endfunction

function I4D takes nothing returns nothing
  if GetSpellAbilityId()=='A12W' and GetUnitAbilityLevel(GetTriggerUnit(),'Bpsh')>0 then
    call UnitRemoveAbility(GetTriggerUnit(),'Bpsh')
  endif
endfunction

function I7D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if IsDamageReal(GetEventDamage())and IsUnitAlly(GetEventDamageSource(),GetOwningPlayer(GetTriggerUnit()))==false and IsUnitType(GetEventDamageSource(),UNIT_TYPE_STRUCTURE)==false and WC7==false then
      if IsUnitType(GetEventDamageSource(),UNIT_TYPE_HERO)or GetUnitAbilityLevel(GetEventDamageSource(),'A04R')==0 then
        call DisableTrigger(t)
        set WC7=true
        call DamageTarget(GetTriggerUnit(),GetEventDamageSource(),3,GetEventDamage())
        set WC7=false
        call EnableTrigger(t)
      else
        call DisableTrigger(t)
        set WC7=true
        call DamageTarget(GetTriggerUnit(),udg_Hero[GetPlayerId(GetOwningPlayer(GetEventDamageSource()))],3,GetEventDamage())
        set WC7=false
        call EnableTrigger(t)
      endif
    endif
  endif
  set t=null
  return false
endfunction

function I8D takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(t,4.5,false)
  call TriggerAddCondition(t,Condition(function I7D))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\SpikeBarrier\\SpikeBarrier.mdl",Source,"chest")))
  set t=null
  set Source=null
endfunction

function I9D takes nothing returns nothing
  if GetSpellAbilityId()=='A15W' then
    call I8D()
  endif
endfunction

function IDD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local real d=(LoadReal(hashtable019,(Cache),(138)))
  local real x=SafeX50(GetUnitX(Target)+d/ 10*Cos(a*bj_DEGTORAD))
  local real y=SafeY50(GetUnitY(Target)+d/ 10*Sin(a*bj_DEGTORAD))
  if GetTriggerEvalCount(t)==11 or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl",x,y))
    if((LoadInteger(hashtable019,(GetHandleId((Target))),((4306))))==1)==false and GetUnitAbilityLevel(Target,'B08V')==0 then
      call KillTrees(x,y,150)
      if IsUnitType(Target,UNIT_TYPE_HERO)then
        call SaveBoolean(HeroStats,GetHandleId(Target),99,true)
      endif
      call SetUnitX(Target,x)
      call SetUnitY(Target,y)
    endif
  endif
  set Target=null
  set t=null
  return false
endfunction

function IED takes nothing returns nothing
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real x
  local real y
  local real d
  local real a
  local integer i=-1
  local boolean IFD=false
  if GetSpellTargetItem()!=null then
    set Target=GetTriggerUnit()
  endif
  call AddTimedKeyToUnit(Target,4414,3)
  set a=GetUnitFacing(Target)
  loop
    exitwhen IFD or i==23
    set i=i+1
    set x=SafeX50(GetUnitX(Target)+(600-i*25)*Cos(a*bj_DEGTORAD))
    set y=SafeY50(GetUnitY(Target)+(600-i*25)*Sin(a*bj_DEGTORAD))
    if(IsPointInRegion(RestrictedRegion,((x)*1.),((y)*1.)))==false then
      set IFD=true
    endif
  endloop
  set d=DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))
  call TriggerRegisterTimerEvent(t,.04,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function IDD))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveReal(hashtable019,(Cache),(138),((d)*1.))
  set Target=null
  set t=null
endfunction

function IGD takes nothing returns nothing
  if GetSpellAbilityId()=='A19M' and GetUnitTypeId(GetSpellTargetUnit())!='n00L' and GetUnitAbilityLevel(GetSpellTargetUnit(),'B0FG')==0 and LoadBoolean(hashtable019,GetHandleId(GetSpellTargetUnit()),4306)==false then
    if IsUnitEnemy(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit())) or(LoadBoolean(hashtable019,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))==false then
      call IED()
    endif
  endif
endfunction

function IHD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if (GetTriggerEvalCount(t)>30) or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitRemoveAbility(Source,'A1QC')
    call UnitRemoveAbility(Source,'B0CY')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set Source=null
  set t=null
  return false
endfunction

function IID takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if (GetTriggerEvalCount(t)>LoadInteger(hashtable019,Cache,2)) or GetTriggerEventId()==EVENT_UNIT_DEATH or((LoadInteger(hashtable019,(GetHandleId((Source))),((4256))))==1)then
    call UnitRemoveAbility(Source,'Aetl')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set Source=null
  set t=null
  return false
endfunction

function IJD takes unit u,boolean enemy returns nothing
  local unit Source=u
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer c=40
  if enemy then
    set c=30
  endif
  call UnitAddAbility(Source,'Aetl')
  call UnitMakeAbilityPermanent(Source,true,'Aetl')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'Aetl',false)
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function IID))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,Cache,2,c)
  set Source=null
  set t=null
endfunction

function EtherBlast_AddToEnemies takes nothing returns nothing
  call IJD(GetEnumUnit(),false)
endfunction

function EtherBlast_DamageEnemies takes nothing returns nothing
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),1,W37)
endfunction

function IKD takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit1
  local unit Target=tt_unit2
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  local trigger t
  if Source!=Target then
    call IJD(Target,LoadBoolean(hashtable019,Cache,0))
    
    if LoadBoolean(hashtable019,Cache,0)then
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A1QC',false)
      call UnitAddAbility(Target,'A1QC')
      call UnitMakeAbilityPermanent(Target,true,'A1QC')
      call TriggerRegisterTimerEvent(t,.1,true)
      call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
      call TriggerAddCondition(t,Condition(function IHD))
      call SaveUnitHandle(hashtable019,(Cache),(2),(Target))
      
      call TextTagOnUnit("+"+I2S(R2I(Damage)),2,Target,.027,3,216,120,216)
      set PE8=true
      call DamageTarget(Source,Target,1,Damage)
      set PE8=false
    endif
  endif
  call IJD(Source,LoadBoolean(hashtable019,Cache,0))
  set t=null
  set Source=null
  set Target=null
endfunction

function IMD takes boolean b returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t2=AddProjectile(Source,Target,'h0BS',"IKD",1000,false)
  local integer Cache2=GetHandleId(t2)
  local integer stat = GetUnitPrimaryAttribute(Source)
  local real amount
  
  if b then
    if stat==1 then
      set amount = GetHeroInt(Source,true)*2.+75
    elseif stat==2 then
      set amount = GetHeroAgi(Source,true)*2.+75
    elseif stat==3 then
      set amount = GetHeroStr(Source,true)*2.+75
    endif
    
    call SaveReal(hashtable019,(Cache2),(20),amount)
  endif
  
  call SaveBoolean(hashtable019,Cache2,0,b)
  
  set Source=null
  set Target=null
  set t2=null
endfunction

function IOD takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local unit t = GetSpellTargetUnit()
  local boolean b = IsUnitEnemy(u,GetOwningPlayer(t))
  
  if GetSpellAbilityId()=='A1QD' and (IsBlocked(t)==false or b==false) then
    call IMD(b)
  endif
  
  set u = null
  set t = null
endfunction

function IPD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if GetTriggerEvalCount(t)>40 or GetTriggerEventId()==EVENT_UNIT_DEATH or IsMagicImmune(Source)or((LoadInteger(hashtable019,(GetHandleId((Source))),((4256))))==1)then
    call UnitRemoveAbility(Source,'Aetl')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set Source=null
  set t=null
  return false
endfunction

function IQD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t
  local integer Cache
  if IsCourier(Source)==false then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call UnitAddAbility(Source,'Aetl')
    call UnitMakeAbilityPermanent(Source,true,'Aetl')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'Aetl',false)
    call TriggerRegisterTimerEvent(t,.1,true)
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function IPD))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  endif
  set Source=null
  set t=null
endfunction

function IRD takes nothing returns nothing
  if GetSpellAbilityId()=='A1AC' and IsMagicImmune(GetTriggerUnit())==false then
    call IQD()
  endif
endfunction

function ISD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real ITD=(LoadReal(hashtable019,(Cache),(529)))
  local real IUD=(LoadReal(hashtable019,(Cache),(530)))
  local real IVD=GetUnitState(Source,UNIT_STATE_MANA)
  local real IWD=GetUnitState(Source,UNIT_STATE_MAX_MANA)
  local real IXD=(LoadReal(hashtable019,(Cache),(668)))
  local real IYD=GetUnitStatePercent(Source,UNIT_STATE_MANA,UNIT_STATE_MAX_MANA)
  local real IZD=(IXD-IYD)/ 100
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEvalCount(t)==20*10 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if ITD<150 then
      call SetUnitState(Source,UNIT_STATE_MANA,IVD-(150-ITD-IUD))
    endif
  else
    if IZD>0 then
      set ITD=ITD+IZD*IWD
      if IUD>0 then
        if IZD*IWD>IUD then
          call SetUnitState(Source,UNIT_STATE_MANA,IVD+IUD)
          set IUD=0
        else
          if IUD>(IWD-IVD)then
            set IUD=IUD-(IWD-IVD)
            call SetUnitState(Source,UNIT_STATE_MANA,IWD)
          else
            set IUD=IUD-IZD*IWD
            call SetUnitState(Source,UNIT_STATE_MANA,IVD+IZD*IWD)
          endif
        endif
      endif
    endif
    set IXD=IYD
    call SaveReal(hashtable019,(Cache),(668),((IXD)*1.))
    call SaveReal(hashtable019,(Cache),(529),((ITD)*1.))
    call SaveReal(hashtable019,(Cache),(530),((IUD)*1.))
  endif
  set t=null
  set Source=null
  return false
endfunction

function IAD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real IBD=GetUnitState(Source,UNIT_STATE_LIFE)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real IVD=GetUnitState(Source,UNIT_STATE_MANA)
  if IBD>151 then
    call SetUnitState(Source,UNIT_STATE_LIFE,IBD-150)
  else
    call SetUnitState(Source,UNIT_STATE_LIFE,1)
  endif
  call Z48("Abilities\\Spells\\Orc\\SpiritLink\\SpiritLinkZapTarget.mdl",Source,"origin",2)
  call SetUnitState(Source,UNIT_STATE_MANA,IVD+150)
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function ISD))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(242),((GetUnitState(Source,UNIT_STATE_MANA))*1.))
  call SaveReal(hashtable019,(Cache),(529),((0)*1.))
  call SaveReal(hashtable019,(Cache),(668),((GetUnitStatePercent(Source,UNIT_STATE_MANA,UNIT_STATE_MAX_MANA))*1.))
  if(IVD+150)>GetUnitState(Source,UNIT_STATE_MAX_MANA)then
    call SaveReal(hashtable019,(Cache),(530),(((IVD+150)-GetUnitState(Source,UNIT_STATE_MAX_MANA))*1.))
  endif
  set Source=null
  set t=null
endfunction

function ICD takes nothing returns nothing
  if GetSpellAbilityId()=='A1Q8' then
    call IAD()
  endif
endfunction

function I3D takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x
  local real y
  if IsSentinel(GetOwningPlayer(Source))then
    set x=GetRectCenterX(gg_rct_Hero_Creation_NE)
    set y=GetRectCenterY(gg_rct_Hero_Creation_NE)
  else
    set x=GetRectCenterX(gg_rct_Hero_Creation_UD)
    set y=GetRectCenterY(gg_rct_Hero_Creation_UD)
  endif
  call IssuePointOrderById(Source,851986,x,y)
  set Source=null
endfunction

function BSO takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x
  local real y
  if IsSentinel(GetOwningPlayer(Source))then
    set x=-4533
    set y=1158
  else
    set x=3190
    set y=-35
  endif
  call IssuePointOrderById(Source,851986,x,y)
  set Source=null
endfunction

function I6D takes nothing returns nothing
  if GetSpellAbilityId()=='A1AS' then
    call I3D()
  elseif GetSpellAbilityId()=='A2KS' then
    call BSO()
  endif
endfunction

function ILD takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  call SaveBoolean(hashtable019,(GetHandleId(Hero)),(129),(true))
  set Hero=null
endfunction

function I1D takes nothing returns nothing
  if(GetSpellAbilityId()=='A0B8' or GetSpellAbilityId()=='A1WE')and IsBlocked(GetTriggerUnit()) then
    call ILD()
  endif
endfunction

function I0D takes integer id returns boolean
  return id=='ugho' or id=='unec' or id=='esen' or id=='edry' or id=='u001' or id=='u002' or id=='e00V' or id=='e00W' or id=='ebal' or id=='e026' or id=='umtw' or id=='u00R'
endfunction

function I5D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>8 then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if GetUnitState(Target,UNIT_STATE_LIFE)>(150./ 8.+.5)then
      call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)-150./ 8.)
    else
      set WL7[GetPlayerId(GetOwningPlayer(Target))]=true
      set PE8=true
      call DamageTarget(Source,Target,1,50)
      set WL7[GetPlayerId(GetOwningPlayer(Target))]=false
      set PE8=false
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function I2D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_UNIT_DAMAGED and(I0D(GetUnitTypeId(GetEventDamageSource()))==false and(GetOwningPlayer(GetEventDamageSource())!=NeutralsPlayer or GetUnitTypeId(GetEventDamageSource())=='n00L')and GetEventDamage()>0)or W67)then
    call UnitRemoveAbility(Target,'B0CG')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  return false
endfunction

function J4D takes nothing returns nothing
  local trigger t
  local integer h
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster
  local integer i=0
  local boolean found=false
  local boolean IFD=false
  local integer charges
  if Target==null then
    set Target=GetTriggerUnit()
  endif
  set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  loop
    exitwhen i>5 or IFD
    if F49(UnitItemInSlot(Source,i))==indexid_UrnOfShadows then
      set charges=GetItemCharges(UnitItemInSlot(Source,i))
      if charges>0 then
        set found=true
        set charges=charges-1
      else
        set IFD=true
        set found=false
      endif
    endif
    set i=i+1
  endloop
  if found then
    set t=CreateTrigger()
    set h=GetHandleId(t)
    if IsUnitAlly(Target,GetOwningPlayer(Source)) then
      if GetUnitAbilityLevel(Target,'B0CG')==0 then
        call UnitAddAbility(Caster,'A1MM')
        call IssueTargetOrderById(Caster,852609,Target)
        call SmoothHealingSystemForBottle(400,0,8,'B0CG',Target)
      endif
      call SaveUnitHandle(hashtable019,h,17,Target)
      call TriggerRegisterTimerEvent(t,8,false)
      call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
      call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
      call TriggerAddCondition(t,Condition(function I2D))
    else
      call SaveUnitHandle(hashtable019,h,17,Target)
      call SaveUnitHandle(hashtable019,h,2,Source)
      call SaveEffectHandle(hashtable019,h,32,AddSpecialEffectTarget("war3mapImported\\Urn_Enemy.mdx",Target,"overhead"))
      call TriggerRegisterTimerEvent(t,1,true)
      call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
      call TriggerAddCondition(t,Condition(function I5D))
    endif
  endif
  set Source=null
  set Caster=null
  set Target=null
  set t=null
endfunction

function J7D takes nothing returns nothing
  if GetSpellAbilityId()=='A1MO' then
    call J4D()
  endif
endfunction

function J8D takes nothing returns nothing
  local integer i=0
  loop
    exitwhen i>16
    set WL7[i]=false
    set i=i+1
  endloop
endfunction

function J9D takes nothing returns nothing
  if IsUnitBADWithSpellbooks(GetEnumUnit())==false then
    call SetPlayerAbilityAvailable2(GetOwningPlayer(GetEnumUnit()),'A1ZX',false)
    call CN8(GetEnumUnit(),'A1ZX',1,W07,'B0DX')
  endif
endfunction

function JDD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local integer i=0
  local boolean found=false
  local boolean IFD=false
  local integer charges
  local group g
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),925,Condition(function LL8))
  call ForGroup(g,function J9D)
  call KillGroup(g)
  set g=null
  set Source=null
endfunction

function JED takes nothing returns nothing
  if GetSpellAbilityId()=='A1ZW' then
    call JDD()
  endif
endfunction

function JFD takes unit u returns boolean
  local integer U58=GetUnitTypeId(u)
  return U58=='H0B8' or U58=='n0FJ' or U58=='n0FI' or U58=='n0F6' or U58=='n0FH' or U58=='u00S'
endfunction

//primal spirit pandas
function integers138 takes integer W78 returns boolean
  return(W78=='npn3' or W78=='npn6' or W78=='n010' or W78=='n0GZ')or(W78=='npn2' or W78=='npn5' or W78=='n012' or W78=='n0H1')or(W78=='npn1' or W78=='npn4' or W78=='n011' or W78=='n0H0')
endfunction

function JGD takes nothing returns boolean
  return(IsUnitEnemy(GetFilterUnit(),W57)and integers138(GetUnitTypeId(GetFilterUnit()))==false  and IsDead(GetFilterUnit())==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) or IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE))and JFD(GetFilterUnit())==false)!=null
endfunction

function JHD takes unit Source returns boolean
  local group g=GetAvailableGroup()
  local boolean found
  set W57=GetOwningPlayer(Source)
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1050,Condition(function JGD))
  set found=FirstOfGroup(g)!=null
  call KillGroup(g)
  set g=null
  return found
endfunction

function JID takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local group g
  local integer Count
  local boolean JJD
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetAttacker()==Source then
      call UnitRemoveAbility(Source,'A20L')
      call UnitRemoveAbility(Source,'A20S')
      call UnitRemoveAbility(Source,'B0E2')
      call UnitRemoveAbility(Source,'B09Y')
      if((LoadInteger(hashtable019,(GetHandleId((Source))),((4302))))==1)==false then
        call UnitSetUsesAltIcon(Source,false)
      endif
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    set JJD=(LoadBoolean(hashtable019,(Cache),(671)))
    set Count=(LoadInteger(hashtable019,(Cache),(34)))
    set Count=Count+1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    set g=GetAvailableGroup()
    set W57=GetOwningPlayer(Source)
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1050,Condition(function JGD))
    if GetUnitAbilityLevel(Source,'B09Y')>0 then
      call SaveBoolean(hashtable019,(Cache),(671),(true))
    elseif JJD then
      call SaveBoolean(hashtable019,(Cache),(671),(false))
      call UnitRemoveAbility(Source,'A20L')
      call UnitAddAbility2(Source,'A20L')
    endif
    if Count>350 or FirstOfGroup(g)!=null then
      call UnitRemoveAbility(Source,'A20L')
      call UnitRemoveAbility(Source,'A20S')
      call UnitRemoveAbility(Source,'B0E2')
      call UnitRemoveAbility(Source,'B09Y')
      if((LoadInteger(hashtable019,(GetHandleId((Source))),((4302))))==1)==false then
        call UnitSetUsesAltIcon(Source,false)
      endif
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
    call KillGroup(g)
  endif
  set t=null
  set Source=null
  set g=null
  return false
endfunction

function JKD takes nothing returns nothing
  local unit Source=GetEnumUnit()
  local trigger t
  local integer Cache
  if IsPlayerBelongToTeams(GetOwningPlayer(Source))and JHD(Source)==false then
    if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Source))==false and IsObserver(GetLocalPlayer())==false then
      call UnitSetUsesAltIcon(Source,true)
    endif
    call UnitAddAbility2(Source,'A20L')
    call UnitMakeAbilityPermanent(Source,true,'A20L')
    if IsUnitBADWithSpellbooks(Source)==false then
      call UnitAddAbility2(Source,'A20S')
      call UnitMakeAbilityPermanent(Source,true,'A20S')
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A20S',false)
    endif
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveInteger(hashtable019,(Cache),(34),(0))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveBoolean(hashtable019,(Cache),(671),(false))
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\SmokeOfDeceit.mdx",Source,"chest")))
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
    call TriggerRegisterTimerEvent(t,.1,true)
    call TriggerAddCondition(t,Condition(function JID))
    set t=null
  endif
  set Source=null
endfunction

function JMD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1225,Condition(function L68))
  call ForGroup(g,function JKD)
  call KillGroup(g)
  set Source=null
  set g=null
endfunction

function JND takes nothing returns nothing
  if GetSpellAbilityId()=='A206' then
    call JMD()
  endif
endfunction

function JOD takes nothing returns nothing
  if IsUnitBADWithSpellbooks(GetEnumUnit())==false then
    call SetPlayerAbilityAvailable2(GetOwningPlayer(GetEnumUnit()),'A28F',false)
    call CN8(GetEnumUnit(),'A28F',1,W27,'B0EQ')
  endif
endfunction

function JPD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local group g=GetAvailableGroup()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  call GroupEnumUnitsInRange(g,x,y,625,Condition(function LR8))
  call ForGroup(g,function JOD)
  call KillGroup(g)
  call DestroyEffect(AddSpecialEffect("war3mapImported\\DarkLightningNova.mdx",x,y))
  set Source=null
  set g=null
endfunction

function JQD takes nothing returns nothing
  if GetSpellAbilityId()=='A28D' then
    call JPD()
  endif
endfunction

function Item_QuellingBlade_Start takes nothing returns nothing
  if IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))==false then
    call DamageTarget(GetTriggerUnit(),GetSpellTargetUnit(),2,100)
  endif
endfunction

function Item_QuellingBlade_Reg takes nothing returns nothing
  if GetSpellAbilityId()=='A1FD' then
    if GetUnitTypeId(GetSpellTargetUnit())=='o004' or GetUnitTypeId(GetSpellTargetUnit())=='oeye' then
      call Item_QuellingBlade_Start()
    endif
  endif
endfunction

function JRD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local real JSD=(LoadReal(hashtable019,(GetHandleId(Target)),(745)))
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or(TimerGetElapsed(GlobalTimer))>JSD then
    call UnitRemoveAbility(Target,'B0FU')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetUnitAbilityLevel(Target,'B0FU')==0 then
    call IssueTargetOrderById(Caster,852190,Target)
  endif
  set t=null
  set Target=null
  set Caster=null
  return false
endfunction

function CripplingStaff takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local real d=X47
  local trigger t
  local integer Cache
  if IsMagicImmune(Target)==false then
    call UnitAddAbility2(Caster,'A2JM')
    call IssueTargetOrderById(Caster,852190,Target)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A2EC',false)
    call CN8(Target,'A2EC',1,d,'B0F5')
  else
    call UnitAddAbility2(Caster,'A2JM')
    call SetUnitAbilityLevel(Caster,'A2JM',2)
    call IssueTargetOrderById(Caster,852190,Target)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A2EC',false)
    call CN8(Target,'A2EC',1,d,'B0F5')
  endif
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.01,true)
  call TriggerRegisterDeathEvent(t,Target)
  call TriggerAddCondition(t,Condition(function JRD))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveReal(hashtable019,(GetHandleId(Target)),(745),(((TimerGetElapsed(GlobalTimer))+d)*1.))
  set Source=null
  set Target=null
  set Caster=null
  set t=null
endfunction

function JTD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility(Caster,'A2K3')
  call IssueTargetOrderById(Caster,852075,Target)
  set Source=null
  set Target=null
  set Caster=null
endfunction

function JUD takes nothing returns nothing
  if GetSpellAbilityId()=='A2EA' and IsBlocked(GetSpellTargetUnit())==false then
    call JTD()
  endif
endfunction

function JVD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or Count==20 or(GetTriggerEventId()==EVENT_UNIT_DAMAGED and GetEventDamage()>20)then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    set Count=Count+1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)+12.5)
  endif
  set t=null
  set Source=null
  return false
endfunction

function JWD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function JVD))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\TranquilBootsHeal.mdx",Source,"origin")))
  set Source=null
  set t=null
endfunction

function JXD takes nothing returns nothing
  if GetSpellAbilityId()=='A2K1' then
    call JWD()
  endif
endfunction

function Item_Dust_Filter takes nothing returns boolean
  return IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==true and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit()))
endfunction

function Item_Dust_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=(LoadUnitHandle(hashtable019,(h),(2)))
  if GetUnitAbilityLevel(u,'Bdet')==0 then
    call UnitRemoveAbility(u,'A2SJ')
    call UnitRemoveAbility(u,'B0GR')
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
  else
    if GenericCondition_IsDotAInvis(u)==true then
      if GetUnitAbilityLevel(u,'B0GR')==0 then
        call UnitAddAbility2(u,'A2SJ')
      endif
    else
      if GetUnitAbilityLevel(u,'B0GR')>0 then
        call UnitRemoveAbility(u,'A2SJ')
        call UnitRemoveAbility(u,'B0GR')
      endif
    endif
  endif
  set u=null
  set t=null
  return false
endfunction

function Item_Dust_Start takes nothing returns nothing
  local unit u=GetEnumUnit()
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.02,true)
  call TriggerRegisterDeathEvent(t,u)
  call TriggerAddCondition(t,Condition(function Item_Dust_Duration))
  call SaveUnitHandle(hashtable019,(h),(2),(u))
  set t=null
  set u=null
endfunction

function Item_Dust_Init takes nothing returns nothing
  local group g=GetAvailableGroup()
  local unit u=GetTriggerUnit()
  call GroupEnumUnitsInRange(g,GetUnitX(u),GetUnitY(u),1075,Condition(function Item_Dust_Filter))
  call ForGroup(g,function Item_Dust_Start)
  call KillGroup(g)
  set g=null
  set u=null
endfunction

function Item_Dust_Reg takes nothing returns nothing
  if GetSpellAbilityId()=='AItb' then
    call Item_Dust_Init()
  endif
endfunction

function Item_Bloodstone_Act takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  call SetItemCharges(FindItemOfType(caster,Item_Real[indexid_bloodstone]),GetItemCharges(FindItemOfType(caster,Item_Real[indexid_bloodstone]))+1)
  call FlushChildHashtable(hashtable019,(h))
  call CleanTrigger(t)
  
  call KillUnit(caster)
  set caster=null
  set t=null
  return false
endfunction

function Item_Bloodstone_Init takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  call TriggerAddCondition(t,Condition(function Item_Bloodstone_Act))
  call TriggerRegisterTimerEvent(t,0.01,false)
  set t=null
  set caster=null
endfunction

function Item_Bloodstone_Reg takes nothing returns nothing
  if GetSpellAbilityId()=='A2TK' then
    call Item_Bloodstone_Init()
  endif
endfunction

function JYD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local integer Level=2
  if IsUnitType(Target,UNIT_TYPE_MELEE_ATTACKER) then
    set Level=1
  endif
  call UnitAddAbility(Caster,'A2K5')
  call SetUnitAbilityLevel(Caster,'A2K5',Level)
  call IssueTargetOrderById(Caster,852585,Target)
  set Source=null
  set Target=null
  set Caster=null
endfunction

function JZD takes nothing returns nothing
  if GetSpellAbilityId()=='A2K4' and IsBlocked(GetSpellTargetUnit())==false then
    call JYD()
  endif
endfunction




function Halberd_Start takes nothing returns nothing
  local unit u = GetSpellTargetUnit()
  
  if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==true then
    call Attack_Disable(u,3,LoDBuff_AbilID[33],LoDBuff_BuffID[33])
  else
    call Attack_Disable(u,4.5,LoDBuff_AbilID[33],LoDBuff_BuffID[33])
  endif
  
  set u = null
endfunction



function JAD takes integer Level,unit Source,unit Target returns nothing
  set PE8=true
  call DamageTarget(Source,Target,1,300+100*Level)
  set PE8=false
endfunction

function JBD takes nothing returns nothing
  local integer JCD=0
  if GetSpellAbilityId()=='A02O' then
    set JCD=1
  endif
  if GetSpellAbilityId()=='A08Y' then
    set JCD=2
  endif
  if GetSpellAbilityId()=='A08Z' then
    set JCD=3
  endif
  if GetSpellAbilityId()=='A090' then
    set JCD=4
  endif
  if GetSpellAbilityId()=='A092' then
    set JCD=5
  endif
  if JCD>0 and IsBlocked(GetSpellTargetUnit())==false then
    call JAD(JCD,GetTriggerUnit(),GetSpellTargetUnit())
  endif
endfunction

function J3D takes nothing returns nothing
  if GetSpellAbilityId()=='A2HQ' then
    call WL9(GetTriggerUnit(),GetSpellTargetUnit())
  endif
endfunction

function LinkenSphere_ShareRemove takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  if GetUnitAbilityLevel(u,'B0BI')==0 or GetTriggerEvalCount(t)>170 or GetTriggerEventId()==EVENT_UNIT_DEATH then
    //call echo("remove")
    call UnitRemoveAbility(u,'B0BI')
    call DestroyEffect(LoadEffectHandle(hashtable019,h,1))
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  endif
  set t=null
  set u=null
endfunction

function LinkenSphere_Share takes nothing returns nothing
  local unit u=GetSpellTargetUnit()
  local trigger t
  local item it
  if IsUnitIllusion(u)==false then
    call EKD(GetTriggerUnit())
    call UnitRemoveAbility(GetTriggerUnit(),'B0BI')
    call DisableTrigger(t_manipulateitem)
    set it=CreateItem('I0HM',GetUnitX(u),GetUnitY(u))
    if UnitAddItem(u,it) and GetWidgetLife(it)<=0 then
      //call echo("norm")
      set t=CreateTrigger()
      call TriggerRegisterTimerEvent(t,0.1,true)
      call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
      call TriggerAddCondition(t,Condition(function LinkenSphere_ShareRemove))
      call SaveEffectHandle(hashtable019,GetHandleId(t),1,AddSpecialEffectTarget("effects\\Linkens_Main.mdx",u,"chest"))
      call SaveUnitHandle(hashtable019,GetHandleId(t),0,u)
    else
      //call echo("fail")
      call RemoveItem(it)
    endif
    call EnableTrigger(t_manipulateitem)
  endif
  set it=null
  set u=null
  set t=null
endfunction

function J6D takes unit Source,integer W78,real x,real y returns nothing
  local unit JLD=CreateUnit(GetOwningPlayer(Source),W78,x,y,0)
  call UnitApplyTimedLife(JLD,'BTLF',15)
  set JLD=null
endfunction

function J1D takes nothing returns nothing
  local unit JLD
  local real x
  local real y
  if GetSpellAbilityId()=='A1ZL' then
    set x=GetDestructableX(GetSpellTargetDestructable())
    set y=GetDestructableY(GetSpellTargetDestructable())
    call J6D(GetTriggerUnit(),'n0LM',x,y)
  elseif GetSpellAbilityId()=='A1ZM' then
    set x=GetDestructableX(GetSpellTargetDestructable())
    set y=GetDestructableY(GetSpellTargetDestructable())
    call J6D(GetTriggerUnit(),'n0LN',x,y)
  endif
  set JLD=null
endfunction

function J0D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call UnitRemoveAbility(Source,'A1ZJ')
  call UnitRemoveAbility(Target,'A1ZJ')
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function J5D takes nothing returns nothing
  local trigger t
  local integer Cache
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,7,false)
  call TriggerAddCondition(t,Condition(function J0D))
  call SaveUnitHandle(hashtable019,(Cache),(2),(GetTriggerUnit()))
  call SaveUnitHandle(hashtable019,(Cache),(17),(GetSpellTargetUnit()))
  call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Cripple\\CrippleTarget.mdl",GetSpellTargetUnit(),"chest")))
  call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Cripple\\CrippleTarget.mdl",GetTriggerUnit(),"chest")))
  call UnitAddAbility(GetTriggerUnit(),'A1ZJ')
  call UnitAddAbility(GetSpellTargetUnit(),'A1ZJ')
  call UnitMakeAbilityPermanent(GetTriggerUnit(),true,'A1ZJ')
  call UnitMakeAbilityPermanent(GetSpellTargetUnit(),true,'A1ZJ')
  set t=null
endfunction

function J2D takes nothing returns nothing
  if GetSpellAbilityId()=='A1ZI' then
    call J5D()
  endif
endfunction

function K4D takes nothing returns nothing
  local unit whichUnit=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(whichUnit),'e00E',GetUnitX(whichUnit),GetUnitY(whichUnit),0)
  if GetSpellAbilityId()=='AIpl' then
    call UnitAddAbility(Caster,'A1WA')
  elseif GetSpellAbilityId()=='AIpr' then
    call UnitAddAbility(Caster,'AIpr')
  endif
  call IssueTargetOrderById(Caster,852609,whichUnit)
  set whichUnit=null
  set Target=null
  set Caster=null
endfunction

function K7D takes nothing returns nothing
  if GetSpellAbilityId()=='AIpl' or GetSpellAbilityId()=='AIpr' or GetSpellAbilityId()=='A1WA' then
    if GetSpellTargetItem()!=null then
      call K4D()
    else
      if (GetUnitAbilityLevel(GetSpellTargetUnit(),'BIrm')==0 and GetSpellAbilityId()!='AIpr') then
        call SmoothHealingSystemForBottle(0,100,30,'BIrm',GetSpellTargetUnit())
      elseif (GetUnitAbilityLevel(GetSpellTargetUnit(),'B02Z')==0 and GetSpellAbilityId()=='AIpr') then
        call SmoothHealingSystemForBottle(400,0,10,'B02Z',GetSpellTargetUnit())
      endif
    endif
  elseif GetSpellAbilityId()=='A0FO' and GetUnitAbilityLevel(GetTriggerUnit(),'B04A')==0 then
    call SmoothHealingSystemForBottle(135,70,3,'B04A',GetTriggerUnit())
  endif
  
endfunction


function RestoreWardIfFail takes unit Hero, integer ward returns nothing
  local integer indexid
  local item it
  if ward=='o004' then
    set indexid=Item_Real[indexid_ObserverWards]
  else
    set indexid=Item_Real[indexid_SentryWards]
  endif
  call DisableTrigger(t_manipulateitem)
  set it=FindItemOfType(Hero,indexid)
  if it==null then
    set tt_player1=GetOwningPlayer(Hero)
    set tt_item1=CreateItem(indexid,0,0)
    call UnitAddItem(Hero,tt_item1)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  else
    call SetItemCharges(it,GetItemCharges(it)+1)
  endif
  call EnableTrigger(t_manipulateitem)
  set it=null
endfunction

function NewWards takes nothing returns nothing
  local integer id=GetSpellAbilityId()
  local unit d
  local unit caster
  local real x
  local real y
  local item it
  local integer semiid
  local integer realid
  local integer index
  if id=='A02X' or id=='AIsw' then//observer ward
    if id=='A02X' then
      set semiid='o004'
      set realid='A33D'
      set index=indexid_ObserverWards
    else
      set semiid='oeye'
      set realid='A33E'
      set index=indexid_SentryWards
    endif
    set caster=GetTriggerUnit()
    set x=GetSpellTargetX()
    set y=GetSpellTargetY()
    if GetSpellTargetUnit()==null then
      if IsPointInRegion(ZJ7,x,y) then
        call RestoreWardIfFail(caster,semiid)
      else
        set d=CreateUnit(GetOwningPlayer(caster),'e00E',x,y,0)
        call UnitAddAbility(d,realid)
        if not IssuePointOrder(d,"evileye",x,y) then
          call RestoreWardIfFail(caster,semiid)
        endif
      endif
    else
      set d=GetSpellTargetUnit()
      set it=FindItemOfType(d,index)
      if it!=null then
        call SetItemCharges(it,GetItemCharges(it)+1)
      elseif GetEmptyInventorySlots(d)>0 then
        set it=CreateItem(Item_Real[index],0,0)
        call SetItemCharges(it,1)
        call UnitAddItem(d,it)
      else
        call DisplayTimedTextToPlayer(GetOwningPlayer(caster),0,0,5,"Target's inventory is full")
        call RestoreWardIfFail(caster,semiid)
      endif
      set it=null
    endif
  endif
  
  set caster=null
  set d=null
endfunction

function K8D takes integer Level returns integer
  if Level==1 then
    return 25
  elseif Level==2 then
    return 41
  elseif Level==3 then
    return 62
  elseif Level==4 then
    return 88
  elseif Level==5 then
    return 119
  elseif Level==6 then
    return 155
  endif
  return 25
endfunction

function K9D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(34)))
  if(GetTriggerEventId()==EVENT_UNIT_DEATH and GetKillingUnit()==Source)or(GetTriggerEventId()==EVENT_UNIT_DAMAGED and GetUnitAbilityLevel(Target,'B0ES')>0)then
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl",GetUnitX(Target),GetUnitY(Target)))
    call AddHeroXP(Source,R2I(LoadInteger(UnitStats,GetUnitTypeId(Target),EXP)*2.5),true)
    call ImitateBountyGain(GetOwningPlayer(Source),Target,190)
    set ReliableGold[GetPlayerId(GetOwningPlayer(Source))]=ReliableGold[GetPlayerId(GetOwningPlayer(Source))]+190
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call KillUnit(Target)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function KDD takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitLevel(Target)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(34),(Level))
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function K9D))
  set t=null
  set Source=null
  set Target=null
endfunction

function KED takes nothing returns nothing
  if GetSpellAbilityId()=='A28Y' then
    call KDD()
  endif
endfunction

function KFD takes nothing returns nothing
  call SetUnitState(GetEnumUnit(),UNIT_STATE_MANA,GetUnitState(GetEnumUnit(),UNIT_STATE_MANA)+135)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl",GetEnumUnit(),"origin"))
endfunction

function KGD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),25+600,Condition(function L08))
  call ForGroup(g,function KFD)
  call KillGroup(g)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set g=null
  set Source=null
  set t=null
  return false
endfunction

function KHD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t
  if GetSpellAbilityId()=='A0K7' then
    if GetUnitTypeId(Source)!='H00J' then
      set t=CreateTrigger()
      call TriggerRegisterTimerEvent(t,0,false)
      call TriggerAddCondition(t,Condition(function KGD))
      call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Source))
      set t=null
    elseif GetUnitTypeId(Source)=='H00J' then
      call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)+25)
    endif
  endif
  set Source=null
endfunction

function KID takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster
  if GetSpellAbilityId()=='A1T7' and(IsBlocked(GetSpellTargetUnit())==false or IsPlayerAlly(GetOwningPlayer(Source),GetOwningPlayer(Target)))then
    if GetSpellTargetItem()!=null then
      set Target=GetTriggerUnit()
    endif
    set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
    call UnitAddAbility(Caster,'AIcy')
    call IssueTargetOrderById(Caster,852144,Target)
  endif
  set Source=null
  set Target=null
  set Caster=null
endfunction

function KJD takes nothing returns boolean
  call K7D()
  call NewWards()
  if GetUnitTypeId(GetTriggerUnit())=='e00E' then
    return false
  endif
  call EOD()
  call E6D()
  call FTD()
  call FLD()
  call GQD()
  call GUD()
  call GWD()
  call GBD()
  call G6D()
  call GVD()
  call G5D()
  call H8D()
  call HHD()
  call HRD()
  call HKD()
  call HBD()
  call HUD()
  call LA9()
  call LY9()
  call H2D()
  call I4D()
  call I9D()
  call IGD()
  call IRD()
  call I6D()
  call FAD()
  call G0D()
  call I1D()
  call J7D()
  call ICD()
  call IOD()
  call KID()
  call KHD()
  call KED()
  call J2D()
  call J1D()
  call JED()
  call JND()
  call JQD()
  call JUD()
  call J3D()
  call JBD()
  call JXD()
  call Item_Bloodstone_Reg()
  call Item_Dust_Reg()
  call Item_QuellingBlade_Reg()
  if GetSpellAbilityId()=='A2K7' and IsBlocked(GetSpellTargetUnit())==false then
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\LevelerStunFX.mdx",GetSpellTargetUnit(),"head"))
  endif
  return false
endfunction

function KKD takes unit Hero returns nothing
  call SetUnitState(Hero,UNIT_STATE_LIFE,GetUnitState(Hero,UNIT_STATE_MAX_LIFE))
  call SetUnitState(Hero,UNIT_STATE_MANA,GetUnitState(Hero,UNIT_STATE_MAX_MANA))
endfunction

function KMD takes unit Hero,real x,real y returns nothing
  local integer Cache=GetHandleId(GetOwningPlayer(Hero))
  local unit JK9=(LoadUnitHandle(hashtable019,(Cache),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(Cache),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(Cache),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(Cache),(703)))
  set X77=true
  if JK9!=null then
    call ReviveHero(JK9,x,y,true)
    call KKD(JK9)
    call RemoveStuffFromHero(JK9)
    call SetUnitX(JK9,x)
    call SetUnitY(JK9,y)
  endif
  if JM9!=null then
    call ReviveHero(JM9,x,y,true)
    call KKD(JM9)
    call RemoveStuffFromHero(JM9)
    call SetUnitX(JM9,x)
    call SetUnitY(JM9,y)
  endif
  if JN9!=null then
    call ReviveHero(JN9,x,y,true)
    call KKD(JN9)
    call RemoveStuffFromHero(JN9)
    call SetUnitX(JN9,x)
    call SetUnitY(JN9,y)
  endif
  if JO9!=null then
    call ReviveHero(JO9,x,y,true)
    call KKD(JO9)
    call RemoveStuffFromHero(JO9)
    call SetUnitX(JO9,x)
    call SetUnitY(JO9,y)
  endif
  set JK9=null
  set JM9=null
  set JN9=null
  set JO9=null
endfunction

function KND takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  call KKD(Hero)
  call RemoveStuffFromHero(Hero)
  call ClearSelectionForPlayer(GetOwningPlayer(Hero))
  call SelectUnitAddForPlayer(Hero,GetOwningPlayer(Hero))
  if GetUnitTypeId(Hero)=='H00I' then
    //call KMD(Hero,GetUnitX(Hero),GetUnitY(Hero))
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  return false
endfunction

function KOD takes unit Hero,real x,real y returns nothing
  local integer Cache=GetHandleId(GetOwningPlayer(Hero))
  local unit JK9=(LoadUnitHandle(hashtable019,(Cache),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(Cache),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(Cache),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(Cache),(703)))
  call DisableTrigger(QF)
  if JK9!=null then
    call SetUnitX(JK9,x)
    call SetUnitY(JK9,y)
    call KillUnit(JK9)
  endif
  if JM9!=null then
    call SetUnitX(JM9,x)
    call SetUnitY(JM9,y)
    call KillUnit(JM9)
  endif
  if JN9!=null then
    call SetUnitX(JN9,x)
    call SetUnitY(JN9,y)
    call KillUnit(JN9)
  endif
  if JO9!=null then
    call SetUnitX(JO9,x)
    call SetUnitY(JO9,y)
    call KillUnit(JO9)
  endif
  call EnableTrigger(QF)
  set JK9=null
  set JM9=null
  set JN9=null
  set JO9=null
endfunction

function KPD takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local real x
  local real y
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call Traffic_RegisterData("AegisOff",GetPlayerId(GetOwningPlayer(Hero)))
  if GetUnitTypeId(Hero)=='H00I' then
    //call KOD(Hero,GetUnitX(Hero),GetUnitY(Hero))
  endif
  set K27=null
  call TriggerRegisterTimerEvent(t,5,false)
  call TriggerAddCondition(t,Condition(function KND))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call AddTimedKeyToUnit(Hero,4304,5)
  set t=null
  set Hero=null
endfunction

function KQD takes nothing returns nothing
  if F49(GetManipulatedItem())==indexid_Aegis then
    call KPD()
  endif
endfunction

function KRD takes nothing returns nothing
  local unit whichUnit=GetTriggerUnit()
  local item B38=GetManipulatedItem()
  local integer indexId=F49(B38)
  local integer FO9
  call DisableTrigger(t_manipulateitem)
  if GetUnitTypeId(whichUnit)!='H00J' then
    if indexId==indexid_PowerTreadsAgility then
      set FO9=BC8(whichUnit,B38)
      set tt_player1=GetItemPlayer(GetManipulatedItem())
      call RemoveItem(B38)
      call DisableTrigger(t_manipulateitem)
      set tt_item1=FM9(whichUnit,Item_Real[indexid_PowerTreadsStrength],FO9)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_PowerTreadsStrength then
      set FO9=BC8(whichUnit,B38)
      set tt_player1=GetItemPlayer(GetManipulatedItem())
      call RemoveItem(B38)
      call DisableTrigger(t_manipulateitem)
      set tt_item1=FM9(whichUnit,Item_Real[indexid_PowerTreadsIntelligence],FO9)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_PowerTreadsIntelligence then
      set FO9=BC8(whichUnit,B38)
      set tt_player1=GetItemPlayer(GetManipulatedItem())
      call RemoveItem(B38)
      call DisableTrigger(t_manipulateitem)
      set tt_item1=FM9(whichUnit,Item_Real[indexid_PowerTreadsAgility],FO9)
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    endif
  endif
  call EnableTrigger(t_manipulateitem)
  set whichUnit=null
  set B38=null
endfunction

function KSD takes nothing returns nothing
  local unit whichUnit=GetTriggerUnit()
  local item B38=GetManipulatedItem()
  local integer indexId=F49(B38)
  local integer FO9
  call DisableTrigger(t_manipulateitem)
  if indexId==indexid_RingOfBasilius then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_RingOfBasiliusHero],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  elseif indexId==indexid_RingOfBasiliusHero then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_RingOfBasilius],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  endif
  if indexId==indexid_RingOfAquila then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_RingOfAquilaHero],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  elseif indexId==indexid_RingOfAquilaHero then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_RingOfAquila],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  endif
  if indexId==indexid_MKBOn then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_MKBOff],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  elseif indexId==indexid_MKBOff then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_MKBOn],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  endif
  call EnableTrigger(t_manipulateitem)
  set whichUnit=null
  set B38=null
endfunction

function KTD takes nothing returns nothing
  local unit whichUnit=GetTriggerUnit()
  local item B38=GetManipulatedItem()
  local integer indexId=F49(B38)
  local integer FO9
  call DisableTrigger(t_manipulateitem)
  if indexId==indexid_RadianceOn then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_RadianceOff],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  elseif indexId==indexid_RadianceOff then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_RadianceOn],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  endif
  call EnableTrigger(t_manipulateitem)
  set whichUnit=null
  set B38=null
endfunction

function KUD takes nothing returns nothing
  local unit whichUnit=GetTriggerUnit()
  local item B38=GetManipulatedItem()
  local integer indexId=F49(B38)
  local integer FO9
  call DisableTrigger(t_manipulateitem)
  if (indexId)==indexid_DiffusalBlade and GetItemCharges(B38)==0 then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_DiffusalBlade_empty],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  elseif (indexId)==indexid_DiffusalBlade_upg and GetItemCharges(B38)==0 then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_DiffusalBlade_upg_empty],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  elseif indexId==indexid_janggo and GetItemCharges(B38)==0 then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_janggoempty],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
  endif
  call EnableTrigger(t_manipulateitem)
  set whichUnit=null
  set B38=null
endfunction

function KVD takes nothing returns nothing
  local unit whichUnit=GetTriggerUnit()
  local item B38=GetManipulatedItem()
  local integer indexId=F49(B38)
  local integer FO9
  call DisableTrigger(t_manipulateitem)
  if indexId==indexid_BlackKingBar10 then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_BlackKingBar09],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    call Func4195(tt_item1)
  elseif indexId==indexid_BlackKingBar09 then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_BlackKingBar08],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    call Func4195(tt_item1)
  elseif indexId==indexid_BlackKingBar08 then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_BlackKingBar07],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    call Func4195(tt_item1)
  elseif indexId==indexid_BlackKingBar07 then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_BlackKingBar06],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    call Func4195(tt_item1)
  elseif indexId==indexid_BlackKingBar06 then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_BlackKingBar05],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    call Func4195(tt_item1)
  elseif indexId==indexid_BlackKingBar05 then
    set FO9=BC8(whichUnit,B38)
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(B38)
    set tt_item1=FM9(whichUnit,Item_Real[indexid_BlackKingBar04],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    call Func4195(tt_item1)
  endif
  call EnableTrigger(t_manipulateitem)
  set whichUnit=null
  set B38=null
endfunction


function KWD takes nothing returns boolean
  local integer FO9
  local real KXD
  local trigger t
  local real hp
  call DisableTrigger(t_manipulateitem)
  
  if F49(GetManipulatedItem())==indexid_ArmletOff then
    
    set KXD=GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_LIFE)-GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)
    set hp=GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)
    set FO9=BC8(GetTriggerUnit(),GetManipulatedItem())
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(GetManipulatedItem())
    set tt_item1=FM9(GetTriggerUnit(),Item_Real[indexid_ArmletOn],FO9)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    call SetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE,hp)
    //call SetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE,RMaxIF(GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_LIFE)-KXD,1))
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,0.7/25,true)
    call SaveUnitHandle(MHT,GetHandleId(t),0,GetTriggerUnit())
    call SaveBoolean(HeroStats,GetHandleId(GetTriggerUnit()),20,true)
    call SaveReal(MHT,GetHandleId(t),0,KXD)
    call TriggerAddCondition(t,Condition(function Armlet_TogglingOn))
    set t=null
    call AddTimedKeyToUnit(GetTriggerUnit(),4298,.7)
  endif
  if F49(GetManipulatedItem())==indexid_ArmletOn then
    set KXD=GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_LIFE)-GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)
    set FO9=BC8(GetTriggerUnit(),GetManipulatedItem())
    set tt_player1=GetItemPlayer(GetManipulatedItem())
    call RemoveItem(GetManipulatedItem())
    set tt_item1=FM9(GetTriggerUnit(),Item_Real[indexid_ArmletOff],FO9)
    call SaveBoolean(HeroStats,GetHandleId(GetTriggerUnit()),20,false)
    call SetItemPlayer(tt_item1,tt_player1,false)
    call SetItemUserData(tt_item1,1)
    call Armlet_StrBonus(GetTriggerUnit(),0)
    call SetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE,RMaxIF(GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_LIFE)-KXD,1))
  endif
  call EnableTrigger(t_manipulateitem)
  return false
endfunction

function PerseveranceDisassemble takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local player p=GetItemPlayer(GetManipulatedItem())
  local item newItem
  call DisableTrigger(t_manipulateitem)
  call RemoveItem(GetManipulatedItem())
  set newItem=UnitAddItemById(Hero,Item_Real[indexid_RingOfHealth])
  call SetItemPlayer(newItem,p,false)
  call SetItemUserData(newItem,1)
  set newItem=UnitAddItemById(Hero,Item_Real[indexid_VoidStone])
  call SetItemPlayer(newItem,p,false)
  call SetItemUserData(newItem,1)
  call EnableTrigger(t_manipulateitem)
  set Hero=null
  set p=null
  set newItem=null
endfunction

function KYD takes nothing returns nothing
  if GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_Perseverance]then
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n0G1'))
  endif
endfunction

function KZD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local item it
  if EED(Source)then
    call DisableTrigger(t_manipulateitem)
    set it=CreateItem('I0HM',GetUnitX(Source),GetUnitY(Source))
    call UnitAddItem(Source,it)
    if GetWidgetLife(it)>0 then
      call RemoveItem(it)
    endif
    set it=null
    call EnableTrigger(t_manipulateitem)
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call SaveBoolean(hashtable019,(GetHandleId(Source)),(129),(false))
  set t=null
  set Source=null
  return false
endfunction

function KAD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local item B38=GetManipulatedItem()
  local integer indexId=F49(B38)
  local trigger t
  if(indexId==indexid_MantaStyle or indexId==indexid_MantaStyleRanged)and(LoadBoolean(hashtable019,(GetHandleId(Source)),(129))) then
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,.41,false)
    call TriggerAddCondition(t,Condition(function KZD))
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Source))
    set t=null
  endif
  set Source=null
  set B38=null
endfunction

function KBD takes nothing returns boolean
  local real x
  local real y
  local real a
  
  call KSD()
  call KTD()
  call KRD()
  call ESD()
  call KQD()
  call KWD()
  call KYD()
  call KVD()
  call KUD()
  call KAD()
  return false
endfunction

function KCD takes nothing returns boolean
  return GetOwningPlayer(GetTriggerUnit())==NeutralsPlayer
endfunction

function K3D takes nothing returns nothing
  call SaveInteger(hashtable019,(400+GetPlayerId(GetOwningPlayer(GetKillingUnit()))),(79),((LoadInteger(hashtable019,(400+GetPlayerId(GetOwningPlayer(GetKillingUnit()))),(79)))+1))
endfunction

function KLD takes nothing returns boolean
  if GetOwningPlayer(GetTriggerUnit())==Sentinels[0]then
    call IssuePointOrderByIdLoc(GetTriggerUnit(),851983,FrozenThroneCreepsWaypoint)
  elseif GetOwningPlayer(GetTriggerUnit())==Scourges[0]then
    call IssuePointOrderByIdLoc(GetTriggerUnit(),851983,TreeOfLifeCreepsWaypoint)
  endif
  return false
endfunction

function K1D takes nothing returns nothing
  set RangeCreepsSpawnAmount=RangeCreepsSpawnAmount+1
endfunction

function K0D takes nothing returns nothing
  set MeleeCreepsSpawnAmount=MeleeCreepsSpawnAmount+1
endfunction

function K5D takes nothing returns boolean
  if GetOwningPlayer(GetTriggerUnit())==Sentinels[0]then
    call IssuePointOrderByIdLoc(GetTriggerUnit(),851983,MidCreepsWaypoint)
  endif
  return false
endfunction

function K2D takes nothing returns boolean
  if GetOwningPlayer(GetTriggerUnit())==Scourges[0]then
    call IssuePointOrderByIdLoc(GetTriggerUnit(),851983,MidCreepsWaypoint)
  endif
  return false
endfunction

function M4D takes nothing returns boolean
  if GetOwningPlayer(GetTriggerUnit())==Sentinels[0]then
    call IssuePointOrderByIdLoc(GetTriggerUnit(),851983,TopCreepsWaypoint)
  endif
  return false
endfunction

function M7D takes nothing returns boolean
  if GetOwningPlayer(GetTriggerUnit())==Scourges[0]then
    call IssuePointOrderByIdLoc(GetTriggerUnit(),851983,TopCreepsWaypoint)
  endif
  return false
endfunction

function M8D takes nothing returns boolean
  if GetOwningPlayer(GetTriggerUnit())==Sentinels[0]then
    call IssuePointOrderByIdLoc(GetTriggerUnit(),851983,BottomCreepsWaypoint)
  endif
  return false
endfunction

function M9D takes nothing returns boolean
  if GetOwningPlayer(GetTriggerUnit())==Scourges[0]then
    call IssuePointOrderByIdLoc(GetTriggerUnit(),851983,BottomCreepsWaypoint)
  endif
  return false
endfunction

function MDD takes nothing returns nothing
  local integer i=1
  local integer id
  loop
    exitwhen i>5
    set id=GetPlayerId(Sentinels[i])
    call Traffic_RegisterData("CSK"+I2S(id),PlayerCS[id])
    call Traffic_RegisterData("CSD"+I2S(id),PlayerDenyCounter[id])
    call Traffic_RegisterData("NK"+I2S(id),(LoadInteger(hashtable019,(400+id),(79))))
    set id=GetPlayerId(Scourges[i])
    call Traffic_RegisterData("CSK"+I2S(id),PlayerCS[id])
    call Traffic_RegisterData("CSD"+I2S(id),PlayerDenyCounter[id])
    call Traffic_RegisterData("NK"+I2S(id),(LoadInteger(hashtable019,(400+id),(79))))
    set i=i+1
  endloop
endfunction

function MED takes boolean MFD returns nothing
  local unit u
  local string MGD="stand work alternate"
  local string MHD="stand work"
  local string MID="stand alternate"
  local string MJD="stand"
  set u=EE7
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MGD)
    else
      call SetUnitAnimation(u,MID)
    endif
  endif
  set u=EF7
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MGD)
    else
      call SetUnitAnimation(u,MID)
    endif
  endif
  set u=EG7
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MGD)
    else
      call SetUnitAnimation(u,MID)
    endif
  endif
  set u=EH7
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MGD)
    else
      call SetUnitAnimation(u,MID)
    endif
  endif
  set u=EI7
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MGD)
    else
      call SetUnitAnimation(u,MID)
    endif
  endif
  set u=EJ7
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MGD)
    else
      call SetUnitAnimation(u,MID)
    endif
  endif
  set u=HL7
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MHD)
    else
      call SetUnitAnimation(u,MJD)
    endif
  endif
  set u=H17
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MHD)
    else
      call SetUnitAnimation(u,MJD)
    endif
  endif
  set u=H07
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MHD)
    else
      call SetUnitAnimation(u,MJD)
    endif
  endif
  set u=H57
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MHD)
    else
      call SetUnitAnimation(u,MJD)
    endif
  endif
  set u=H27
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MHD)
    else
      call SetUnitAnimation(u,MJD)
    endif
  endif
  set u=I47
  if IsDead(u)==false then
    if MFD then
      call SetUnitAnimation(u,MHD)
    else
      call SetUnitAnimation(u,MJD)
    endif
  endif
  set u=null
endfunction

function MKD takes nothing returns boolean
  call MED(true)
  return false
endfunction

function Trig_Spawn_Conditions takes nothing returns boolean
  return true
endfunction

function MMD takes group g,integer MOD returns nothing
  local unit u
  loop
    set u=FirstOfGroup(g)
    exitwhen(u==null)
    call GroupRemoveUnit(g,u)
    call SetUnitAbilityLevel(u,WaypointAbilID,MOD)
    call IssuePointOrderByIdLoc(u,851983,WaypointLocations[MOD])//attack
  endloop
  set u=null
endfunction


function BoostOfflaneEnd takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  call SetUnitMoveSpeed(u,LoadReal(hashtable019,h,25))
  call FlushChildHashtable(hashtable019,h)
  call CleanTrigger(t)
  set t=null
  set u=null
endfunction

function BoostOfflane takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local real m
  local real d=10
  if TempInteger==1 then
    set m=1.25
  else
    set m=0.75
  endif
  call SaveReal(hashtable019,h,25,GetUnitMoveSpeed(GetEnumUnit()))
  call SetUnitMoveSpeed(GetEnumUnit(),GetUnitMoveSpeed(GetEnumUnit())*m)
  call SaveUnitHandle(hashtable019,h,0,GetEnumUnit())
  call TriggerRegisterTimerEvent(t,d,false)
  call TriggerAddCondition(t,Condition(function BoostOfflaneEnd))
  set t=null
endfunction

function MPD takes nothing returns nothing
  local boolean MQD=ModuloInteger(GetTriggerExecCount(integers004),7)==0
  if ZK7 then
    return
  endif
  call MED(false)
  if MQD then
    call MDD()
  endif
  if GetTriggerExecCount(integers004)==1 and Mode_OM==false then
    call UnitResetCooldown(CirclesOfPower[1])
    call UnitResetCooldown(CirclesOfPower[2])
    call UnitResetCooldown(CirclesOfPower[3])
    call UnitResetCooldown(CirclesOfPower[4])
    call UnitResetCooldown(CirclesOfPower[5])
    call UnitResetCooldown(CirclesOfPower[7])
    call UnitResetCooldown(CirclesOfPower[8])
    call UnitResetCooldown(CirclesOfPower[9])
    call UnitResetCooldown(CirclesOfPower[10])
    call UnitResetCooldown(CirclesOfPower[11])
    call SetUnitInvulAdvanced(SQ,false)
    call SetUnitInvulAdvanced(TQ,false)
    call SetUnitInvulAdvanced(integer025,false)
    call SetUnitInvulAdvanced(Towers_Scourge_Top_1,false)
    call SetUnitInvulAdvanced(Towers_Scourge_Mid_1,false)
    call SetUnitInvulAdvanced(Towers_Scourge_Bot_1,false)
  elseif GetTriggerExecCount(integers004)==1 and Mode_OM then
    call SetUnitInvulAdvanced(TQ,false)
    call SetUnitInvulAdvanced(Towers_Scourge_Mid_1,false)
  endif
  if GetTriggerExecCount(integers004)==1 then
    call EnableTrigger(TriggerGoldPerSecond)
  endif
  if Mode_OM==false and Mode_NT==false then
    if(SentinelTopMeleeRaxExists)then
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'ugho',Scourges[0],ScourgeTopMeleeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'u001',Scourges[0],ScourgeTopMeleeSpawn,bj_UNIT_FACING)
    endif
    if NeedBoost then
      set TempInteger=1
      call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
    endif
    call MMD(bj_lastCreatedGroup,2)
  endif
  if Mode_NM==false then
    if(SentinelMidMeleeRaxExists)then
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'ugho',Scourges[0],ScourgeMidMeleeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'u001',Scourges[0],ScourgeMidMeleeSpawn,bj_UNIT_FACING)
    endif
    call MMD(bj_lastCreatedGroup,3)
  endif
  if Mode_OM==false and Mode_NB==false then
    if(SentinelBottomMeleeRaxExists)then
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'ugho',Scourges[0],ScourgeBottomMeleeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'u001',Scourges[0],ScourgeBottomMeleeSpawn,bj_UNIT_FACING)
    endif
    if NeedBoost then
      set TempInteger=2
      call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
    endif
    call MMD(bj_lastCreatedGroup,4)
    
  endif
  if Mode_OM==false and Mode_NT==false then
    if(SentinelTopRangeRaxExists)then
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'unec',Scourges[0],ScourgeTopRangeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'u002',Scourges[0],ScourgeTopRangeSpawn,bj_UNIT_FACING)
    endif
    if NeedBoost then
      set TempInteger=1
      call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
    endif
    call MMD(bj_lastCreatedGroup,2)
  endif
  if Mode_NM==false then
    if(SentinelMidRangeRaxExists)then
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'unec',Scourges[0],ScourgeMidRangeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'u002',Scourges[0],ScourgeMidRangeSpawn,bj_UNIT_FACING)
    endif
    call MMD(bj_lastCreatedGroup,3)
  endif
  if Mode_OM==false and Mode_NB==false then
    if(SentinelBottomRangeRaxExists)then
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'unec',Scourges[0],ScourgeBottomRangeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'u002',Scourges[0],ScourgeBottomRangeSpawn,bj_UNIT_FACING)
    endif
    if NeedBoost then
      set TempInteger=2
      call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
    endif
    call MMD(bj_lastCreatedGroup,4)
  endif
  if MQD then
    if Mode_OM==false and Mode_NT==false then
      if(SentinelTopRangeRaxExists)then
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'umtw',Scourges[0],ScourgeTopRangeSpawn,bj_UNIT_FACING)
      else
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'u00R',Scourges[0],ScourgeTopRangeSpawn,bj_UNIT_FACING)
      endif
      if NeedBoost then
        set TempInteger=1
        call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
      endif
      call MMD(bj_lastCreatedGroup,2)
    endif
    if Mode_NM==false then
      if(SentinelMidRangeRaxExists)then
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'umtw',Scourges[0],ScourgeMidRangeSpawn,bj_UNIT_FACING)
      else
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'u00R',Scourges[0],ScourgeMidRangeSpawn,bj_UNIT_FACING)
      endif
      call MMD(bj_lastCreatedGroup,3)
    endif
    if Mode_OM==false and Mode_NB==false then
      if(SentinelBottomRangeRaxExists)then
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'umtw',Scourges[0],ScourgeBottomRangeSpawn,bj_UNIT_FACING)
      else
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'u00R',Scourges[0],ScourgeBottomRangeSpawn,bj_UNIT_FACING)
      endif
      if NeedBoost then
        set TempInteger=2
        call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
      endif
      call MMD(bj_lastCreatedGroup,4)
    endif
  endif
  if Mode_OM==false and Mode_NT==false then
    if(ScourgeTopMeleeRaxExists)then
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'esen',Sentinels[0],SentinelTopMeleeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'e00V',Sentinels[0],SentinelTopMeleeSpawn,bj_UNIT_FACING)
    endif
    if NeedBoost then
      set TempInteger=2
      call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
    endif
    call MMD(bj_lastCreatedGroup,2)
  endif
  if Mode_NM==false then
    if(ScourgeMidMeleeRaxExists)then
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'esen',Sentinels[0],SentinelMidMeleeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'e00V',Sentinels[0],SentinelMidMeleeSpawn,bj_UNIT_FACING)
    endif
    call MMD(bj_lastCreatedGroup,3)
  endif
  if Mode_OM==false and Mode_NB==false then
    if(ScourgeBottomMeleeRaxExists)then
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'esen',Sentinels[0],SentinelBottomMeleeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(MeleeCreepsSpawnAmount,'e00V',Sentinels[0],SentinelBottomMeleeSpawn,bj_UNIT_FACING)
    endif
    if NeedBoost then
      set TempInteger=1
      call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
    endif
    call MMD(bj_lastCreatedGroup,4)
  endif
  if Mode_OM==false and Mode_NT==false then
    if(ScourgeTopRangeRaxExists)then
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'edry',Sentinels[0],SentinelTopRangeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'e00W',Sentinels[0],SentinelTopRangeSpawn,bj_UNIT_FACING)
    endif
    if NeedBoost then
      set TempInteger=2
      call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
    endif
    call MMD(bj_lastCreatedGroup,2)
  endif
  if Mode_NM==false then
    if(ScourgeMidRangeRaxExists)then
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'edry',Sentinels[0],SentinelMidRangeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'e00W',Sentinels[0],SentinelMidRangeSpawn,bj_UNIT_FACING)
    endif
    call MMD(bj_lastCreatedGroup,3)
  endif
  if Mode_OM==false and Mode_NB==false then
    if(ScourgeBottomRangeRaxExists)then
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'edry',Sentinels[0],SentinelBottomRangeSpawn,bj_UNIT_FACING)
    else
      call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'e00W',Sentinels[0],SentinelBottomRangeSpawn,bj_UNIT_FACING)
    endif
    if NeedBoost then
      set TempInteger=1
      call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
    endif
    call MMD(bj_lastCreatedGroup,4)
  endif
  if MQD then
    if Mode_OM==false and Mode_NT==false then
      if(ScourgeBottomRangeRaxExists)then
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'ebal',Sentinels[0],SentinelTopRangeSpawn,bj_UNIT_FACING)
      else
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'e026',Sentinels[0],SentinelTopRangeSpawn,bj_UNIT_FACING)
      endif
      if NeedBoost then
        set TempInteger=2
        call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
      endif
      call MMD(bj_lastCreatedGroup,2)
    endif
    if Mode_NM==false then
      if(ScourgeMidRangeRaxExists)then
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'ebal',Sentinels[0],SentinelMidRangeSpawn,bj_UNIT_FACING)
      else
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'e026',Sentinels[0],SentinelMidRangeSpawn,bj_UNIT_FACING)
      endif
      call MMD(bj_lastCreatedGroup,3)
    endif
    if Mode_OM==false and Mode_NB==false then
      if(ScourgeBottomRangeRaxExists)then
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'ebal',Sentinels[0],SentinelBottomRangeSpawn,bj_UNIT_FACING)
      else
        call CreateNUnitsAtLoc(RangeCreepsSpawnAmount,'e026',Sentinels[0],SentinelBottomRangeSpawn,bj_UNIT_FACING)
      endif
      if NeedBoost then
        set TempInteger=1
        call ForGroup(bj_lastCreatedGroup,function BoostOfflane)
      endif
      call MMD(bj_lastCreatedGroup,4)
    endif
  endif
endfunction

function MRD takes nothing returns nothing
  set SentinelTopRangeRaxExists=false
  call DisableTrigger(BG)
  call Traffic_RegisterData("Rax"+I2S(0)+I2S(0)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function MSD takes nothing returns nothing
  set SentinelMidRangeRaxExists=false
  call DisableTrigger(reals001)
  call Traffic_RegisterData("Rax"+I2S(0)+I2S(1)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function MTD takes nothing returns nothing
  set SentinelBottomRangeRaxExists=false
  call DisableTrigger(DG)
  call Traffic_RegisterData("Rax"+I2S(0)+I2S(2)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function MUD takes nothing returns nothing
  set SentinelTopMeleeRaxExists=false
  call DisableTrigger(boolean004)
  call Traffic_RegisterData("Rax"+I2S(0)+I2S(0)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function MVD takes nothing returns nothing
  set SentinelMidMeleeRaxExists=false
  call DisableTrigger(FG)
  call Traffic_RegisterData("Rax"+I2S(0)+I2S(1)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function MWD takes nothing returns nothing
  set SentinelBottomMeleeRaxExists=false
  call DisableTrigger(integer012)
  call Traffic_RegisterData("Rax"+I2S(0)+I2S(2)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function MXD takes nothing returns nothing
  set ScourgeTopRangeRaxExists=false
  call DisableTrigger(real001)
  call Traffic_RegisterData("Rax"+I2S(1)+I2S(0)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function MYD takes nothing returns nothing
  set ScourgeMidRangeRaxExists=false
  call DisableTrigger(ZG)
  call Traffic_RegisterData("Rax"+I2S(1)+I2S(1)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function MZD takes nothing returns nothing
  set ScourgeBottomRangeRaxExists=false
  call DisableTrigger(VG)
  call Traffic_RegisterData("Rax"+I2S(1)+I2S(2)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function MAD takes nothing returns nothing
  set ScourgeTopMeleeRaxExists=false
  call DisableTrigger(WG)
  call Traffic_RegisterData("Rax"+I2S(1)+I2S(0)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function MBD takes nothing returns nothing
  set ScourgeMidMeleeRaxExists=false
  call DisableTrigger(integer014)
  call Traffic_RegisterData("Rax"+I2S(1)+I2S(1)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function MCD takes nothing returns nothing
  set ScourgeBottomMeleeRaxExists=false
  call DisableTrigger(YG)
  call Traffic_RegisterData("Rax"+I2S(1)+I2S(2)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
endfunction

function M3D takes nothing returns boolean
  local real M6D=GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)/ GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_LIFE)
  if M6D<.75 and XI7==false then
    set XI7=true
    call Traffic_RegisterData("Tree",75)
  endif
  if M6D<.5 and XH7==false then
    set XH7=true
    call Traffic_RegisterData("Tree",50)
  endif
  if M6D<.25 and XG7==false then
    set XG7=true
    call Traffic_RegisterData("Tree",25)
  endif
  if M6D<.1 and XF7==false then
    set XF7=true
    call Traffic_RegisterData("Tree",10)
  endif
  return false
endfunction

function MLD takes nothing returns boolean
  local real M6D=GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)/ GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_LIFE)
  if M6D<.75 and XE7==false then
    set XE7=true
    call Traffic_RegisterData("Throne",75)
  endif
  if M6D<.5 and XD7==false then
    set XD7=true
    call Traffic_RegisterData("Throne",50)
  endif
  if M6D<.25 and X97==false then
    set X97=true
    call Traffic_RegisterData("Throne",25)
  endif
  if M6D<.1 and X87==false then
    set X87=true
    call Traffic_RegisterData("Throne",10)
  endif
  return false
endfunction

function M1D takes nothing returns boolean
  return( not(ScourgeTopMeleeRaxExists or ScourgeMidMeleeRaxExists or ScourgeBottomMeleeRaxExists or ScourgeTopRangeRaxExists or ScourgeMidRangeRaxExists or ScourgeBottomRangeRaxExists))
endfunction

function M0D takes nothing returns nothing
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,GetObjectName('n04O')+" "+GetObjectName('n0C7'))
  call SetPlayerTechResearchedSwap('R00D',(GetPlayerTechCountSimple('R00D',Sentinels[0])+30),Sentinels[0])
  call SetPlayerTechResearchedSwap('R00C',(GetPlayerTechCountSimple('R00C',Sentinels[0])+30),Sentinels[0])
  call DisableTrigger(JG)
endfunction

function M5D takes nothing returns boolean
  return( not(SentinelTopMeleeRaxExists or SentinelMidMeleeRaxExists or SentinelBottomMeleeRaxExists or SentinelTopRangeRaxExists or SentinelMidRangeRaxExists or SentinelBottomRangeRaxExists))
endfunction

function M2D takes nothing returns nothing
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,GetObjectName('n04X')+" "+GetObjectName('n0C9'))
  call SetPlayerTechResearchedSwap('R009',(GetPlayerTechCountSimple('R009',Scourges[0])+30),Scourges[0])
  call SetPlayerTechResearchedSwap('R00B',(GetPlayerTechCountSimple('R00B',Scourges[0])+30),Scourges[0])
  call DisableTrigger(group002)
endfunction

function N4D takes nothing returns nothing
  call SetPlayerTechResearchedSwap('R007',(GetPlayerTechCountSimple('R007',Sentinels[0])+1),Sentinels[0])
  call SetPlayerTechResearchedSwap('R00C',(GetPlayerTechCountSimple('R00C',Sentinels[0])+1),Sentinels[0])
  call SetPlayerTechResearchedSwap('R008',(GetPlayerTechCountSimple('R008',Sentinels[0])+1),Sentinels[0])
  call SetPlayerTechResearchedSwap('R00D',(GetPlayerTechCountSimple('R00D',Sentinels[0])+1),Sentinels[0])
  call SetPlayerTechResearchedSwap('R009',(GetPlayerTechCountSimple('R009',Scourges[0])+1),Scourges[0])
  call SetPlayerTechResearchedSwap('R003',(GetPlayerTechCountSimple('R003',Scourges[0])+1),Scourges[0])
  call SetPlayerTechResearchedSwap('R00A',(GetPlayerTechCountSimple('R00A',Scourges[0])+1),Scourges[0])
  call SetPlayerTechResearchedSwap('R00B',(GetPlayerTechCountSimple('R00B',Scourges[0])+1),Scourges[0])
  set NeedBoost=false
endfunction

function N7D takes nothing returns nothing
  local location YT9=GetRectCenter(rect070)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nbdo',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nbds',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'ngst',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'n026',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nggr',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nbdk',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nbwm',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nogm',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nomg',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nfpc',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nfpu',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nsth',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nstl',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nsat',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nwlg',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nkol',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nkob',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nkot',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'ncnk',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'ncen',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'ngns',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nftb',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nfsh',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'ngh1',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'npfl',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nowe',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nowb',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nmrm',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nmrr',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'nmrl',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'ndtr',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'ndtw',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'n0LC',YT9,bj_UNIT_FACING))
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'n0LD',YT9,bj_UNIT_FACING))
  call RemoveLocation(YT9)
  set YT9=null
endfunction

function N8D takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'n0HW',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'n0HX',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'n0HW',x,y,0),x,y)
endfunction

function N9D takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'njg1',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'njg1',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'njga',x,y,0),x,y)
endfunction

function NDD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nbdo',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nbdo',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nbds',x,y,0),x,y)
endfunction

function NED takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nbdk',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nbdk',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nbwm',x,y,0),x,y)
endfunction

function NFD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'ngst',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'ngst',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nggr',x,y,0),x,y)
endfunction

function AncientLizards_AI takes nothing returns boolean
  call CleanTrigger(GetTriggeringTrigger())
  call IssueTargetOrderById(GetTriggerUnit(),852209,GetTriggerUnit())
  return false
endfunction

function NGD takes real x,real y returns nothing
  local unit u
  set u=CreateUnit(NeutralsPlayer,'n0LC',x,y,0)
  call SetUnitPosition(u,x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'n0LD',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'n0LD',x,y,0),x,y)
  set u=null
endfunction

function NHD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nogm',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nogm',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nomg',x,y,0),x,y)
endfunction

function NID takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nfpc',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nfpu',x,y,0),x,y)
endfunction

function NJD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nsth',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nstl',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nsat',x,y,0),x,y)
endfunction

function NKD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nstl',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nstl',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nsat',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nsat',x,y,0),x,y)
endfunction

function NMD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nwlg',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nwlg',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'n00S',x,y,0),x,y)
endfunction

function NND takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'n026',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'n026',x,y,0),x,y)
endfunction

function NOD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nkol',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nkob',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nkob',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nkob',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nkot',x,y,0),x,y)
endfunction

function NPD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nftb',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nftb',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nfsh',x,y,0),x,y)
endfunction

function NQD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'ncen',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'ncnk',x,y,0),x,y)
endfunction

function NRD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'ngns',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'ngns',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'ngns',x,y,0),x,y)
endfunction

function NSD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nftb',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nftb',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nkol',x,y,0),x,y)
endfunction

function NTD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'ngh1',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'npfl',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'npfl',x,y,0),x,y)
endfunction

function NUD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nowe',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nowb',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'nowb',x,y,0),x,y)
endfunction

function NVD takes real x,real y returns nothing
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'ndtr',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'ndtr',x,y,0),x,y)
  call SetUnitPosition(CreateUnit(NeutralsPlayer,'ndtw',x,y,0),x,y)
endfunction

function NWD takes real x,real y returns nothing
  local integer i=GetRandomInt(1,5)
  loop
    exitwhen i!=SpawnHistory[0]
    set i=GetRandomInt(1,5)
  endloop
  set SpawnHistory[0]=i
  if i==1 then
    call NID(x,y)
  elseif i==2 then
    call NJD(x,y)
  elseif i==3 then
    call NUD(x,y)
  elseif i==4 then
    call NVD(x,y)
  elseif i==5 then
    call NQD(x,y)
  endif
endfunction

function NXD takes real x,real y returns nothing
  local integer i=GetRandomInt(1,5)
  loop
    exitwhen i!=SpawnHistory[1]
    set i=GetRandomInt(1,5)
  endloop
  set SpawnHistory[1]=i
  if i==1 then
    call NID(x,y)
  elseif i==2 then
    call NJD(x,y)
  elseif i==3 then
    call NUD(x,y)
  elseif i==4 then
    call NVD(x,y)
  elseif i==5 then
    call NQD(x,y)
  endif
endfunction

function NYD takes real x,real y returns nothing
  local integer i=GetRandomInt(1,5)
  loop
    exitwhen i!=SpawnHistory[2]
    set i=GetRandomInt(1,5)
  endloop
  set SpawnHistory[2]=i
  if i==1 then
    call NID(x,y)
  elseif i==2 then
    call NJD(x,y)
  elseif i==3 then
    call NUD(x,y)
  elseif i==4 then
    call NVD(x,y)
  elseif i==5 then
    call NQD(x,y)
  endif
endfunction

function NZD takes real x,real y returns nothing
  local integer i=GetRandomInt(1,5)
  loop
    exitwhen i!=SpawnHistory[3]
    set i=GetRandomInt(1,5)
  endloop
  set SpawnHistory[3]=i
  if i==1 then
    call NID(x,y)
  elseif i==2 then
    call NJD(x,y)
  elseif i==3 then
    call NUD(x,y)
  elseif i==4 then
    call NVD(x,y)
  elseif i==5 then
    call NQD(x,y)
  endif
endfunction

function NAD takes real x,real y returns nothing
  local integer i=GetRandomInt(1,5)
  loop
    exitwhen i!=SpawnHistory[4]
    set i=GetRandomInt(1,5)
  endloop
  set SpawnHistory[4]=i
  if i==1 then
    call NND(x,y)
  elseif i==2 then
    call NHD(x,y)
  elseif i==3 then
    call NKD(x,y)
  elseif i==4 then
    call NMD(x,y)
  elseif i==5 then
    call NQD(x,y)
  endif
endfunction

function NBD takes real x,real y returns nothing
  local integer i=GetRandomInt(1,5)
  loop
    exitwhen i!=SpawnHistory[5]
    set i=GetRandomInt(1,5)
  endloop
  set SpawnHistory[5]=i
  if i==1 then
    call NND(x,y)
  elseif i==2 then
    call NHD(x,y)
  elseif i==3 then
    call NKD(x,y)
  elseif i==4 then
    call NMD(x,y)
  elseif i==5 then
    call NQD(x,y)
  endif
endfunction

function NCD takes real x,real y returns nothing
  local integer i=GetRandomInt(1,5)
  loop
    exitwhen i!=SpawnHistory[6]
    set i=GetRandomInt(1,5)
  endloop
  set SpawnHistory[6]=i
  if i==1 then
    call NND(x,y)
  elseif i==2 then
    call NHD(x,y)
  elseif i==3 then
    call NKD(x,y)
  elseif i==4 then
    call NMD(x,y)
  elseif i==5 then
    call NQD(x,y)
  endif
endfunction

function N3D takes real x,real y returns nothing
  local integer i=GetRandomInt(1,5)
  loop
    exitwhen i!=SpawnHistory[7]
    set i=GetRandomInt(1,5)
  endloop
  set SpawnHistory[7]=i
  if i==1 then
    call NND(x,y)
  elseif i==2 then
    call NHD(x,y)
  elseif i==3 then
    call NKD(x,y)
  elseif i==4 then
    call NMD(x,y)
  elseif i==5 then
    call NQD(x,y)
  endif
endfunction

function N6D takes real x,real y returns nothing
  local integer i=GetRandomInt(1,6)
  loop
    exitwhen i!=SpawnHistory[8]
    set i=GetRandomInt(1,6)
  endloop
  set SpawnHistory[8]=i
  if i==1 then
    call NTD(x,y)
  elseif i==2 then
    call NSD(x,y)
  elseif i==3 then
    call NRD(x,y)
  elseif i==4 then
    call NOD(x,y)
  elseif i==5 then
    call NPD(x,y)
  elseif i==6 then
    call N8D(x,y)
  endif
endfunction

function NLD takes real x,real y returns nothing
  local integer i=GetRandomInt(1,6)
  loop
    exitwhen i!=SpawnHistory[9]
    set i=GetRandomInt(1,6)
  endloop
  set SpawnHistory[9]=i
  if i==1 then
    call NTD(x,y)
  elseif i==2 then
    call NSD(x,y)
  elseif i==3 then
    call NRD(x,y)
  elseif i==4 then
    call NOD(x,y)
  elseif i==5 then
    call NPD(x,y)
  elseif i==6 then
    call N8D(x,y)
  endif
endfunction

function N1D takes real x,real y returns nothing//scourge's ancients
  local integer i=GetRandomInt(1,5)
  loop
    exitwhen i!=SpawnHistory[10]
    set i=GetRandomInt(1,5)
  endloop
  set SpawnHistory[10]=i
  if i==1 then
    call N9D(x,y)
  elseif i==2 then
    call NDD(x,y)
  elseif i==3 then
    call NED(x,y)
  elseif i==4 then
    call NFD(x,y)
  elseif i==5 then
    call NGD(x,y)
  endif
endfunction

function N0D takes real x,real y returns nothing
  local integer i=GetRandomInt(1,5)
  loop
    exitwhen i!=SpawnHistory[11]
    set i=GetRandomInt(1,5)
  endloop
  set SpawnHistory[11]=i
  if i==1 then
    call N9D(x,y)
  elseif i==2 then
    call NDD(x,y)
  elseif i==3 then
    call NED(x,y)
  elseif i==4 then
    call NFD(x,y)
  elseif i==5 then
    call NGD(x,y)
  endif
endfunction

function N5D takes nothing returns nothing
  if GetUnitAbilityLevel(GetEnumUnit(),'A0P4')!=0 or GetUnitTypeId(GetEnumUnit())=='o003' or GetUnitTypeId(GetEnumUnit())=='o01X' or IsDead(GetEnumUnit()) or IsCourier(GetEnumUnit()) then
    call GroupRemoveUnit(C2,GetEnumUnit())
  endif
endfunction

function N2D takes group g returns boolean
  set C2=g
  call ForGroup(g,function N5D)
  return FirstOfGroup(g)==null
endfunction

function O4D takes nothing returns boolean
  local group g
  local rect r1
  local rect r2
  if D78==false then
    return false
  endif
  set r1=U4
  set r2=Z4
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call N1D(GetRectCenterX(r2),GetRectCenterY(r2))//scourge ancients
  endif
  call KillGroup(g)
  set r1=unit006
  set r2=V4
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call N0D(GetRectCenterX(r2),GetRectCenterY(r2))//sent ancients
  endif
  call KillGroup(g)
  set r1=real015
  set r2=W4
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call NWD(GetRectCenterX(r2),GetRectCenterY(r2))//sent center
  endif
  call KillGroup(g)
  set r1=integer041
  set r2=X4
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call NYD(GetRectCenterX(r2),GetRectCenterY(r2))//scourge big pulled
  endif
  call KillGroup(g)
  set r1=B5
  set r2=Y4
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call NLD(GetRectCenterX(r2),GetRectCenterY(r2))//scourge pulling
  endif
  call KillGroup(g)
  set r1=real014
  set r2=J4
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call N6D(GetRectCenterX(r2),GetRectCenterY(r2))//sent pulling
  endif
  call KillGroup(g)
  set r1=SomeRect7
  set r2=K4
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call NCD(GetRectCenterX(r2),GetRectCenterY(r2))//scourge toprune
  endif
  call KillGroup(g)
  set r1=F5
  set r2=L4
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call N3D(GetRectCenterX(r2),GetRectCenterY(r2))//sent runewiev
  endif
  call KillGroup(g)
  set r1=integer039
  set r2=M4
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call NZD(GetRectCenterX(r2),GetRectCenterY(r2))//scourge big near base
  endif
  call KillGroup(g)
  set r1=integers010
  set r2=N4
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call NAD(GetRectCenterX(r2),GetRectCenterY(r2))//sentinel old small
  endif
  call KillGroup(g)
  set r1=V5
  set r2=W5
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call NBD(GetRectCenterX(r2),GetRectCenterY(r2))//scourge old small
  endif
  call KillGroup(g)
  set r1=integer040
  set r2=Y5
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,r1,Condition(function ReturnTrue2))
  if N2D(g)then
    call NXD(GetRectCenterX(r2),GetRectCenterY(r2))
  endif
  call KillGroup(g)
  set r1=null
  set r2=null
  set g=null
  return false
endfunction

function O7D takes nothing returns nothing
  local integer VA8=GetRandomInt(1,9)
  local location l
  if Mode_OM then
    set VA8=GetRandomInt(1,3)
    if VA8==1 then
      set VA8=2
    endif
    if VA8==2 then
      set VA8=5
    endif
    if VA8==3 then
      set VA8=8
    endif
  endif
  if(VA8==1)then
    set l=GetRectCenter(SomeRect6)
    call CreateNUnitsAtLoc(1,'n003',Sentinels[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n051'))
    call MMD(bj_lastCreatedGroup,4)
  endif
  if(VA8==2)then
    set l=GetRectCenter(TA)
    call CreateNUnitsAtLoc(1,'n003',Sentinels[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n052'))
    call MMD(bj_lastCreatedGroup,2)
  endif
  if(VA8==3)then
    set l=GetRectCenter(SA)
    call CreateNUnitsAtLoc(1,'n003',Sentinels[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n053'))
    call MMD(bj_lastCreatedGroup,3)
  endif
  if(VA8==4)then
    set l=GetRectCenter(SomeRect6)
    call CreateNUnitsAtLoc(1,'n00E',Sentinels[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n058'))
    call MMD(bj_lastCreatedGroup,4)
  endif
  if(VA8==5)then
    set l=GetRectCenter(TA)
    call CreateNUnitsAtLoc(1,'n00E',Sentinels[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n04Z'))
    call MMD(bj_lastCreatedGroup,2)
  endif
  if(VA8==6)then
    set l=GetRectCenter(SA)
    call CreateNUnitsAtLoc(1,'n00E',Sentinels[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n057'))
    call MMD(bj_lastCreatedGroup,3)
  endif
  if(VA8==7)and Mode_OM==false then
    set l=GetRectCenter(SomeRect6)
    call CreateNUnitsAtLoc(1,'n00D',Sentinels[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n056'))
    call MMD(bj_lastCreatedGroup,4)
  endif
  if(VA8==8)and Mode_OM==false then
    set l=GetRectCenter(TA)
    call CreateNUnitsAtLoc(1,'n00D',Sentinels[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n04T'))
    call MMD(bj_lastCreatedGroup,2)
  endif
  if(VA8==9)then
    set l=GetRectCenter(SA)
    call CreateNUnitsAtLoc(1,'n00D',Sentinels[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n05C'))
    call MMD(bj_lastCreatedGroup,3)
  endif
  if(VA8==1)then
    set l=GetRectCenter(string001)
    call CreateNUnitsAtLoc(1,'n003',Scourges[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n0CD'))
    call MMD(bj_lastCreatedGroup,4)
  endif
  if(VA8==2)then
    set l=GetRectCenter(LA)
    call CreateNUnitsAtLoc(1,'n003',Scourges[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n0CE'))
    call MMD(bj_lastCreatedGroup,2)
  endif
  if(VA8==3)then
    set l=GetRectCenter(NA)
    call CreateNUnitsAtLoc(1,'n003',Scourges[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n0CC'))
    call MMD(bj_lastCreatedGroup,3)
  endif
  if(VA8==4)then
    set l=GetRectCenter(string001)
    call CreateNUnitsAtLoc(1,'n00E',Scourges[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n0CG'))
    call MMD(bj_lastCreatedGroup,4)
  endif
  if(VA8==5)then
    set l=GetRectCenter(LA)
    call CreateNUnitsAtLoc(1,'n00E',Scourges[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n0CH'))
    call MMD(bj_lastCreatedGroup,2)
  endif
  if(VA8==6)then
    set l=GetRectCenter(NA)
    call CreateNUnitsAtLoc(1,'n00E',Scourges[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n0CF'))
    call MMD(bj_lastCreatedGroup,3)
  endif
  if(VA8==7)then
    set l=GetRectCenter(string001)
    call CreateNUnitsAtLoc(1,'n00D',Scourges[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n0CJ'))
    call MMD(bj_lastCreatedGroup,4)
  endif
  if(VA8==8)then
    set l=GetRectCenter(LA)
    call CreateNUnitsAtLoc(1,'n00D',Scourges[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n0CK'))
    call MMD(bj_lastCreatedGroup,2)
  endif
  if(VA8==9)then
    set l=GetRectCenter(NA)
    call CreateNUnitsAtLoc(1,'n00D',Scourges[0],l,bj_UNIT_FACING)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n0CI'))
    call MMD(bj_lastCreatedGroup,3)
  endif
  set l=null
endfunction

function Trig_display_leaderboard_Actions takes nothing returns nothing
  local integer VT8
  local integer VU8
  local integer O9D
  local integer ODD
  local integer i
  local player p
  set XM7=XM7+1
  set SentinelsIngame=0
  set ScourgesIngame=0
  set i=0
  loop
    exitwhen i>5
    set p=Sentinels[i]
    if VI8(p)then
      set SentinelsIngame=SentinelsIngame+1
    endif
    set p=Scourges[i]
    if VI8(p)then
      set ScourgesIngame=ScourgesIngame+1
    endif
    set i=i+1
  endloop
  if boolean191==false then
    set integer542=SentinelsIngame
    set integer543=ScourgesIngame
  endif
  set VT8=1
  set VU8=5
  set O9D=1
  loop
    exitwhen VT8>VU8
    set p=Sentinels[VT8]
    if VI8(p)then
      set S1[O9D]=p
      set O9D=O9D+1
    endif
    set VT8=VT8+1
  endloop
  set VT8=1
  set VU8=5
  set O9D=1
  loop
    exitwhen VT8>VU8
    set p=Scourges[VT8]
    if VI8(p)then
      set T1[O9D]=p
      set O9D=O9D+1
    endif
    set VT8=VT8+1
  endloop
  if XM7==1 then
    set CSBoard=CreateMultiboardBJ(8+6,3+ScourgesIngame+SentinelsIngame," ")
    call MultiboardMinimize(CSBoard,true)
  endif
  if NumberOfExtraAbilities>=2 then
    call TP8(CSBoard,2,1,"CD1")
    call TP8(CSBoard,3,1,"CD2")
  else
    call TP8(CSBoard,2,1,"CD")
    call TP8(CSBoard,3,1," ")
  endif
  call TP8(CSBoard,4,1,"|c00838B8BL|r")
  call TP8(CSBoard,5,1,XR7+"K|r")
  call TP8(CSBoard,6,1,XT7+"D|r")
  call TP8(CSBoard,7,1,XU7+"A|r")
  call TP8(CSBoard,1,2,GetObjectName('n0DK'))
  call TP8(CSBoard,5,2,XR7+"0|r")
  call TP8(CSBoard,6,2,XT7+"0|r")
  call TP8(CSBoard,1,3+SentinelsIngame,GetObjectName('n0DO'))
  call TP8(CSBoard,5,3+SentinelsIngame,XR7+"0|r")
  call TP8(CSBoard,6,3+SentinelsIngame,XT7+"0|r")
  call TY8(CSBoard,1,2,(VL8(SubString(udg_Colors[GetPlayerId((Sentinels[0]))],4,6)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((Sentinels[0]))],6,8)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((Sentinels[0]))],8,10)))/255.*100,0)
  call TY8(CSBoard,1,3+SentinelsIngame,(VL8(SubString(udg_Colors[GetPlayerId((Scourges[0]))],4,6)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((Scourges[0]))],6,8)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((Scourges[0]))],8,10)))/255.*100,0)
  set VT8=1
  set VU8=3+ScourgesIngame+SentinelsIngame
  loop
    exitwhen VT8>VU8
    call T38(CSBoard,1,VT8,10.8)
    call T38(CSBoard,2,VT8,2)
    if NumberOfExtraAbilities>=2 then
      call T38(CSBoard,3,VT8,2)
    else
      call T38(CSBoard,3,VT8,.01)
    endif
    call T38(CSBoard,4,VT8,2)
    call T38(CSBoard,5,VT8,1.3)
    call T38(CSBoard,6,VT8,1.3)
    call T38(CSBoard,7,VT8,1.3)
    call T38(CSBoard,8,VT8,2.5)
    call T38(CSBoard,9,VT8,.01)
    call T38(CSBoard,10,VT8,.01)
    call T38(CSBoard,11,VT8,.01)
    call T38(CSBoard,12,VT8,.01)
    call T38(CSBoard,13,VT8,.01)
    call T38(CSBoard,14,VT8,.01)
    set VT8=VT8+1
  endloop
  set VT8=1
  set VU8=8+6
  loop
    exitwhen VT8>VU8
    set O9D=1
    set ODD=3+ScourgesIngame+SentinelsIngame
    loop
      exitwhen O9D>ODD
      call TV8(CSBoard,VT8,O9D,true,false)
      set O9D=O9D+1
    endloop
    set VT8=VT8+1
  endloop
  set VT8=1
  set VU8=SentinelsIngame
  loop
    exitwhen VT8>VU8
    call TV8(CSBoard,1,VT8+2,true,true)
    call TY8(CSBoard,8,VT8+2,255,204,0,0)
    set XJ7[GetPlayerId(S1[VT8])]=1-1
    set XK7[GetPlayerId(S1[VT8])]=VT8+2-1
    call TP8(CSBoard,1,VT8+2,(IL7[GetPlayerId((S1[VT8]))]))
    if IsPlayer(S1[VT8])then
      call TY8(CSBoard,1,VT8+2,(VL8(SubString(udg_Colors[GetPlayerId((S1[VT8]))],4,6)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((S1[VT8]))],6,8)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((S1[VT8]))],8,10)))/255.*100,0)
      call TY8(CSBoard,2,VT8+2,(VL8(SubString(udg_Colors[GetPlayerId((S1[VT8]))],4,6)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((S1[VT8]))],6,8)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((S1[VT8]))],8,10)))/255.*100,0)
      call TY8(CSBoard,3,VT8+2,(VL8(SubString(udg_Colors[GetPlayerId((S1[VT8]))],4,6)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((S1[VT8]))],6,8)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((S1[VT8]))],8,10)))/255.*100,0)
    else
      call TP8(CSBoard,1,VT8+2,"|c00333333"+(IL7[GetPlayerId((S1[VT8]))])+"|r")
    endif
    call TP8(CSBoard,5,(VT8+2),XR7+"0|r")
    call TP8(CSBoard,6,(VT8+2),XT7+"0|r")
    call TP8(CSBoard,7,(VT8+2),XU7+"0|r")
    set VT8=VT8+1
  endloop
  set VT8=1
  set VU8=ScourgesIngame
  loop
    exitwhen VT8>VU8
    call TV8(CSBoard,1,VT8+3+SentinelsIngame,true,true)
    call TY8(CSBoard,8,VT8+3+SentinelsIngame,255,204,0,0)
    set XJ7[GetPlayerId(T1[VT8])]=1-1
    set XK7[GetPlayerId(T1[VT8])]=VT8+3+SentinelsIngame-1
    call TP8(CSBoard,1,VT8+3+SentinelsIngame,(IL7[GetPlayerId((T1[VT8]))]))
    if IsPlayer(T1[VT8])then
      call TY8(CSBoard,1,VT8+3+SentinelsIngame,(VL8(SubString(udg_Colors[GetPlayerId((T1[VT8]))],4,6)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((T1[VT8]))],6,8)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((T1[VT8]))],8,10)))/255.*100,0)
      call TY8(CSBoard,2,VT8+3+SentinelsIngame,(VL8(SubString(udg_Colors[GetPlayerId((T1[VT8]))],4,6)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((T1[VT8]))],6,8)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((T1[VT8]))],8,10)))/255.*100,0)
      call TY8(CSBoard,3,VT8+3+SentinelsIngame,(VL8(SubString(udg_Colors[GetPlayerId((T1[VT8]))],4,6)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((T1[VT8]))],6,8)))/255.*100,(VL8(SubString(udg_Colors[GetPlayerId((T1[VT8]))],8,10)))/255.*100,0)
    else
      call TP8(CSBoard,1,VT8+3+SentinelsIngame,"|c00333333"+(IL7[GetPlayerId((T1[VT8]))])+"|r")
    endif
    call TP8(CSBoard,5,(VT8+3+SentinelsIngame),XR7+"0|r")
    call TP8(CSBoard,6,(VT8+3+SentinelsIngame),XT7+"0|r")
    call TP8(CSBoard,7,(VT8+3+SentinelsIngame),XU7+"0|r")
    set VT8=VT8+1
  endloop
  set XN7=1
  set XO7=3+ScourgesIngame+SentinelsIngame-2
  if udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2)and XM7==1 then
    call MultiboardDisplay(CSBoard,false)
  endif
  call TV8(CSBoard,8,1,false,true)
  call TT8(CSBoard,8,1,"UI\\Feedback\\Resources\\ResourceGold.blp")
  if XM7>1 then
    call TriggerExecute(trigger021)
  endif
  set p=null
endfunction

function OED takes nothing returns nothing
  local integer VT8
  local integer VU8
  call TP8(CSBoard,5,2,XR7+I2S(GlobalKillsCounter[GetPlayerId(Sentinels[0])])+"|r")
  call TP8(CSBoard,6,2,XT7+I2S(GlobalDeathCounter[GetPlayerId(Sentinels[0])])+"|r")
  call TP8(CSBoard,5,3+SentinelsIngame,XR7+I2S(GlobalKillsCounter[GetPlayerId(Scourges[0])])+"|r")
  call TP8(CSBoard,6,3+SentinelsIngame,XT7+I2S(GlobalDeathCounter[GetPlayerId(Scourges[0])])+"|r")
  set VT8=1
  set VU8=SentinelsIngame
  loop
    exitwhen VT8>VU8
    call TP8(CSBoard,5,(VT8+2),XR7+I2S(GlobalKillsCounter[GetPlayerId(S1[VT8])])+"|r")
    call TP8(CSBoard,6,(VT8+2),XT7+I2S(GlobalDeathCounter[GetPlayerId(S1[VT8])])+"|r")
    call TP8(CSBoard,7,(VT8+2),XU7+I2S(GlobalAssistsCounter[GetPlayerId(S1[VT8])])+"|r")
    set VT8=VT8+1
  endloop
  set VT8=1
  set VU8=ScourgesIngame
  loop
    exitwhen VT8>VU8
    call TP8(CSBoard,5,(VT8+3+SentinelsIngame),XR7+I2S(GlobalKillsCounter[GetPlayerId(T1[VT8])])+"|r")
    call TP8(CSBoard,6,(VT8+3+SentinelsIngame),XT7+I2S(GlobalDeathCounter[GetPlayerId(T1[VT8])])+"|r")
    call TP8(CSBoard,7,(VT8+3+SentinelsIngame),XU7+I2S(GlobalAssistsCounter[GetPlayerId(T1[VT8])])+"|r")
    set VT8=VT8+1
  endloop
endfunction

function OJD takes integer a returns integer
  local integer i=0
  local integer x=0
  local string s=I2S(a)
  loop
    exitwhen i>StringLength(s)
    if SubString(s,i,i+1)=="1"then
      set x=x+1
    endif
    set i=i+1
  endloop
  return x
endfunction

function OKD takes player p,integer OMD returns string
  if IsPlayerAlly(GetLocalPlayer(),p) then
    if SpellInfoShown[GetPlayerId(GetLocalPlayer())] then
      if OMD<=4+NumberOfExtraAbilities then
        return SkillIcon[PlayerSkillNumber[GetPlayerId(p)*PlayerSkillOffset+OMD]]
      else
        return EmptySlotPath
      endif
    endif
    return FD9(UnitItemInSlot(udg_Hero[GetPlayerId(p)],OMD-1))
  else
    return EmptySlotPath
  endif
endfunction

function OND takes nothing returns nothing
  local integer VT8
  local integer VU8
  local string Time
  local real YO8
  local string s1=" "
  local integer r
  local integer i
  local integer array time_1a
  local string array color_1a
  local integer index_1a=0
  local integer array time_1b
  local string array color_1b
  local integer index_1b=0
  local integer x=0
  local integer id
  local string OOD
  local string OPD
  local string OQD
  local string ORD
  local string OSD
  local string s2=" "
  local string s
  local string sbis
  local real OTD
  local real OTDbis
  local string spacer
  local integer OUD=0
  local string OVD=""
  local string OWD=""
  local integer OXD=0
  local integer OYD=0
  local string OZD=""
  if CSBoard==null then
    return
  endif
  set i=1
  loop
    exitwhen i>5
    set r=R2I(TimerGetRemaining(HeroRespawnTimer[GetPlayerId(Sentinels[i])]))
    if r>0 then
      set OUD=OUD+OJD(r)
      if OXD==0 then
        if r<10 then
          set OVD=udg_Colors[GetPlayerId(Sentinels[i])]+"0"+I2S(r)+" |r"
        else
          set OVD=udg_Colors[GetPlayerId(Sentinels[i])]+I2S(r)+" |r"
        endif
      else
        if r<10 then
          set OVD=OVD+XV7+"| |r"+udg_Colors[GetPlayerId(Sentinels[i])]+"0"+I2S(r)+" |r"
        else
          set OVD=OVD+XV7+"| |r"+udg_Colors[GetPlayerId(Sentinels[i])]+I2S(r)+" |r"
        endif
      endif
      set OXD=OXD+1
    endif
    set i=i+1
  endloop
  if OXD>0 then
    if IsPlayerAlly(GetLocalPlayer(),Sentinels[0]) then
      set OVD=XV7+"["+GetObjectName('n0JS')+" |r"+OVD+XV7+"]|r"
    else
      set OVD=XS7+"["+GetObjectName('n0JR')+" |r"+OVD+XS7+"]|r"
    endif
  endif
  set i=1
  loop
    exitwhen i>5
    set r=R2I(TimerGetRemaining(HeroRespawnTimer[GetPlayerId(Scourges[i])]))
    if r>0 then
      set OUD=OUD+OJD(r)
      if OYD==0 then
        if r<10 then
          set OWD=udg_Colors[GetPlayerId(Scourges[i])]+"0"+I2S(r)+" |r"
        else
          set OWD=udg_Colors[GetPlayerId(Scourges[i])]+I2S(r)+" |r"
        endif
      else
        if r<10 then
          set OWD=OWD+XV7+"| |r"+udg_Colors[GetPlayerId(Scourges[i])]+"0"+I2S(r)+" |r"
        else
          set OWD=OWD+XV7+"| |r"+udg_Colors[GetPlayerId(Scourges[i])]+I2S(r)+" |r"
        endif
      endif
      set OYD=OYD+1
    endif
    set i=i+1
  endloop
  if OYD>0 then
    if IsPlayerAlly(GetLocalPlayer(),Scourges[0]) then
      set OWD=XV7+"["+GetObjectName('n0JS')+" |r"+OWD+XV7+"]|r"
    else
      set OWD=XS7+"["+GetObjectName('n0JR')+" |r"+OWD+XS7+"]|r"
    endif
  endif
  if CSBoard!=null then
    set id=GetPlayerId(GetLocalPlayer())
    if id>=0 and id<16 then
      if CSONStatus1[x]then
        set OOD=I2S(GlobalKillsCounter[id])
        set OPD=I2S(GlobalDeathCounter[id])
        set OQD=I2S(GlobalAssistsCounter[id])
        set ORD=I2S(PlayerCS[id])
        set OSD=I2S(PlayerDenyCounter[id])
        set s2=" |c00838B8B("+OOD+"/"+OPD+"/"+OQD+" - "+ORD+"/"+OSD+" - |r|c00FFDC00"+I2S(ReliableGold[id])+"|r |c00838B8B)|r"
        //set s2="|cFFFFFFFF"+I2S(DPS[id])+"|r "+" |c00838B8B("+OOD+"/"+OPD+"/"+OQD+" - "+ORD+"/"+OSD+" - |r|c00FFDC00"+I2S(ReliableGold[id])+"|r |c00838B8B)|r"
      endif
    endif
  endif
  if OYD==0 and OXD==0 then
    call MultiboardSetTitleText(CSBoard,s2)
  else
    if IsPlayerAlly(GetLocalPlayer(),Sentinels[0]) then
      call MultiboardSetTitleText(CSBoard,OWD+" "+OVD+" "+s2)
    else
      call MultiboardSetTitleText(CSBoard,OVD+" "+OWD+" "+s2)
    endif
  endif
  if not b_isPickTime then
    if(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2))==false then
      call MultiboardDisplay(CSBoard,true)
    endif
  endif
  if CustomWaterColor[GetPlayerId(GetLocalPlayer())]==false then
    call SetWaterBaseColor(0,0,255,255)
  endif
  set VT8=1
  set VU8=SentinelsIngame
  loop
    exitwhen VT8>VU8
    // if DPS[GetPlayerId(S1[VT8])]==0 then
    // call TP8(CSBoard,2,VT8+2," ")
    // else
    // call TP8(CSBoard,2,VT8+2,"|cFFFFFFFF"+I2S(DPS[GetPlayerId(S1[VT8])])+"|r")
    // endif
    call TT8(CSBoard,1,VT8+2,US8(udg_Hero[GetPlayerId(S1[VT8])]))
    call TP8(CSBoard,4,VT8+2,"|c00838B8B"+I2S(GetHeroLevel(udg_Hero[GetPlayerId(S1[VT8])]))+"|r")
    if ItemInfoShown[GetPlayerId(GetLocalPlayer())]then
      call T38(CSBoard,8,1,3)
      call T38(CSBoard,9,1,2.8)
      call T38(CSBoard,10,1,.8)
      call T38(CSBoard,11,1,.8)
      call T38(CSBoard,12,1,.8)
      call T38(CSBoard,13,1,.8)
      call T38(CSBoard,14,1,.1)
      call T38(CSBoard,8,VT8+2,3)
      call T38(CSBoard,9,VT8+2,1.1)
      call T38(CSBoard,10,VT8+2,1.1)
      call T38(CSBoard,11,VT8+2,1.1)
      call T38(CSBoard,12,VT8+2,1.1)
      call T38(CSBoard,13,VT8+2,1.1)
      call T38(CSBoard,14,VT8+2,.1)
      call TV8(CSBoard,9,VT8+2,false,true)
      call TV8(CSBoard,10,VT8+2,false,true)
      call TV8(CSBoard,11,VT8+2,false,true)
      call TV8(CSBoard,12,VT8+2,false,true)
      call TV8(CSBoard,13,VT8+2,false,true)
      call TV8(CSBoard,14,VT8+2,false,true)
      call TP8(CSBoard,9,1,"Items")
    elseif SpellInfoShown[GetPlayerId(GetLocalPlayer())]then
      
      
      //call BJDebugMsg("sent?")
      
      call T38(CSBoard,8,1,3)
      call T38(CSBoard,9,1,2.8)
      call T38(CSBoard,10,1,.8)
      call T38(CSBoard,11,1,.8)
      call T38(CSBoard,12,1,.8)
      call T38(CSBoard,13,1,.8)
      call T38(CSBoard,14,1,.1)
      call T38(CSBoard,8,VT8+2,3)
      call T38(CSBoard,9,VT8+2,1.1)
      call T38(CSBoard,10,VT8+2,1.1)
      call T38(CSBoard,11,VT8+2,1.1)
      if NumberOfExtraAbilities>=1 then
        call T38(CSBoard,12,VT8+2,1.1)
      else
        call T38(CSBoard,12,VT8+2,.1)
      endif
      if NumberOfExtraAbilities>=2 then
        call T38(CSBoard,13,VT8+2,1.1)
      else
        call T38(CSBoard,13,VT8+2,.1)
      endif
      call T38(CSBoard,14,VT8+2,.1)
      call TV8(CSBoard,9,VT8+2,false,true)
      call TV8(CSBoard,10,VT8+2,false,true)
      call TV8(CSBoard,11,VT8+2,false,true)
      call TV8(CSBoard,12,VT8+2,false,true)
      if NumberOfExtraAbilities>=1 then
        call TV8(CSBoard,13,VT8+2,false,true)
      else
        call TV8(CSBoard,13,VT8+2,false,false)
      endif
      if NumberOfExtraAbilities>=2 then
        call TV8(CSBoard,14,VT8+2,false,true)
      else
        call TV8(CSBoard,14,VT8+2,false,false)
      endif
      call TP8(CSBoard,9,1,"Spells")
    else
      call T38(CSBoard,8,1,2)
      call T38(CSBoard,9,1,.1)
      call T38(CSBoard,10,1,.1)
      call T38(CSBoard,11,1,.1)
      call T38(CSBoard,12,1,.1)
      call T38(CSBoard,13,1,.1)
      call T38(CSBoard,14,1,.1)
      call T38(CSBoard,8,VT8+2,2.5)
      call T38(CSBoard,9,VT8+2,.1)
      call T38(CSBoard,10,VT8+2,.1)
      call T38(CSBoard,11,VT8+2,.1)
      call T38(CSBoard,12,VT8+2,.1)
      call T38(CSBoard,13,VT8+2,.1)
      call T38(CSBoard,14,VT8+2,.1)
      call TV8(CSBoard,9,VT8+2,false,false)
      call TV8(CSBoard,10,VT8+2,false,false)
      call TV8(CSBoard,11,VT8+2,false,false)
      call TV8(CSBoard,12,VT8+2,false,false)
      call TV8(CSBoard,13,VT8+2,false,false)
      call TV8(CSBoard,14,VT8+2,false,false)
      call TP8(CSBoard,9,1," ")
    endif
    call TT8(CSBoard,9,VT8+2,OKD(S1[VT8],1))
    call TT8(CSBoard,10,VT8+2,OKD(S1[VT8],2))
    call TT8(CSBoard,11,VT8+2,OKD(S1[VT8],3))
    call TT8(CSBoard,12,VT8+2,OKD(S1[VT8],4))
    call TT8(CSBoard,13,VT8+2,OKD(S1[VT8],5))
    call TT8(CSBoard,14,VT8+2,OKD(S1[VT8],6))
    if(UA8(udg_Hero[GetPlayerId(S1[VT8])])and udg_Hero[GetPlayerId(S1[VT8])]!=null and TimerGetRemaining(HeroRespawnTimer[GetPlayerId(S1[VT8])])>0)then
      if IsPlayerAlly(GetLocalPlayer(),S1[VT8])then
        set OZD=XV7+" ("+(I2S(R2I(TimerGetRemaining(HeroRespawnTimer[GetPlayerId(S1[VT8])]))))+")|r"
      else
        set OZD=XS7+" ("+(I2S(R2I(TimerGetRemaining(HeroRespawnTimer[GetPlayerId(S1[VT8])]))))+")|r"
      endif
    else
      set OZD="  "
    endif
    if IsPlayerLeftGame[GetPlayerId(S1[VT8])]then
      call TP8(CSBoard,1,VT8+2,TabTab+"|c00333333"+(IL7[GetPlayerId((S1[VT8]))])+"|r"+OZD)
    else
      call TP8(CSBoard,1,VT8+2,TabTab+(IL7[GetPlayerId((S1[VT8]))])+OZD)
    endif
    set OTD=(TimerGetRemaining(PrimaryUltiCooldownTimer[GetPlayerId((S1[VT8]))]))
    if OTD>0 then
      set s=I2S(R2I(OTD))
    else
      set s=" "
    endif
    set OTDbis=(TimerGetRemaining(SecondaryUltiCooldownTimer[GetPlayerId((S1[VT8]))]))
    if OTDbis>0 then
      set sbis=I2S(R2I(OTDbis))
    else
      set sbis=" "
    endif
    if IsPlayerAlly(GetLocalPlayer(),S1[VT8])==false then
      call TP8(CSBoard,8,VT8+2," ")
      set s=" "
      set sbis=" "
    else
      call TP8(CSBoard,8,VT8+2,"|cffffcc00"+I2S(R2I(GetPlayerState(S1[VT8],PLAYER_STATE_RESOURCE_GOLD)))+"|r")
    endif
    call TP8(CSBoard,2,VT8+2,s)
    call TP8(CSBoard,3,VT8+2,sbis)
    set VT8=VT8+1
  endloop
  set VT8=1
  set VU8=ScourgesIngame
  loop
    exitwhen VT8>VU8
    // if DPS[GetPlayerId(T1[VT8])]==0 then
    // call TP8(CSBoard,2,VT8+3+SentinelsIngame," ")
    // else
    // call TP8(CSBoard,2,VT8+3+SentinelsIngame,"|cFFFFFFFF"+I2S(DPS[GetPlayerId(T1[VT8])])+"|r")
    // endif
    call TT8(CSBoard,1,VT8+3+SentinelsIngame,US8(udg_Hero[GetPlayerId(T1[VT8])]))
    call TP8(CSBoard,4,VT8+3+SentinelsIngame,"|c00838B8B"+I2S(GetHeroLevel(udg_Hero[GetPlayerId(T1[VT8])]))+"|r")
    if ItemInfoShown[GetPlayerId(GetLocalPlayer())]then
      call T38(CSBoard,8,1,3)
      call T38(CSBoard,9,1,2.8)
      call T38(CSBoard,10,1,.8)
      call T38(CSBoard,11,1,.8)
      call T38(CSBoard,12,1,.8)
      call T38(CSBoard,13,1,.8)
      call T38(CSBoard,14,1,.1)
      call T38(CSBoard,8,VT8+3+SentinelsIngame,3)
      call T38(CSBoard,9,VT8+3+SentinelsIngame,1.1)
      call T38(CSBoard,10,VT8+3+SentinelsIngame,1.1)
      call T38(CSBoard,11,VT8+3+SentinelsIngame,1.1)
      call T38(CSBoard,12,VT8+3+SentinelsIngame,1.1)
      call T38(CSBoard,13,VT8+3+SentinelsIngame,1.1)
      call T38(CSBoard,14,VT8+3+SentinelsIngame,.1)
      call TV8(CSBoard,9,VT8+3+SentinelsIngame,false,true)
      call TV8(CSBoard,10,VT8+3+SentinelsIngame,false,true)
      call TV8(CSBoard,11,VT8+3+SentinelsIngame,false,true)
      call TV8(CSBoard,12,VT8+3+SentinelsIngame,false,true)
      call TV8(CSBoard,13,VT8+3+SentinelsIngame,false,true)
      call TV8(CSBoard,14,VT8+3+SentinelsIngame,false,true)
      call TP8(CSBoard,9,1,"Items")
    elseif SpellInfoShown[GetPlayerId(GetLocalPlayer())]then
      
      
      //call BJDebugMsg("scourge?")
      
      call T38(CSBoard,8,1,3)
      call T38(CSBoard,9,1,2.8)
      call T38(CSBoard,10,1,.8)
      call T38(CSBoard,11,1,.8)
      call T38(CSBoard,12,1,.8)
      call T38(CSBoard,13,1,.8)
      call T38(CSBoard,14,1,.1)
      call T38(CSBoard,8,VT8+3+SentinelsIngame,3)
      call T38(CSBoard,9,VT8+3+SentinelsIngame,1.1)
      call T38(CSBoard,10,VT8+3+SentinelsIngame,1.1)
      call T38(CSBoard,11,VT8+3+SentinelsIngame,1.1)
      if NumberOfExtraAbilities>=1 then
        call T38(CSBoard,12,VT8+3+SentinelsIngame,1.1)
      else
        call T38(CSBoard,12,VT8+3+SentinelsIngame,.1)
      endif
      if NumberOfExtraAbilities>=2 then
        call T38(CSBoard,13,VT8+3+SentinelsIngame,1.1)
      else
        call T38(CSBoard,13,VT8+3+SentinelsIngame,.1)
      endif
      call T38(CSBoard,14,VT8+3+SentinelsIngame,.1)
      call TV8(CSBoard,9,VT8+3+SentinelsIngame,false,true)
      call TV8(CSBoard,10,VT8+3+SentinelsIngame,false,true)
      call TV8(CSBoard,11,VT8+3+SentinelsIngame,false,true)
      call TV8(CSBoard,12,VT8+3+SentinelsIngame,false,true)
      if NumberOfExtraAbilities>=1 then
        call TV8(CSBoard,13,VT8+3+SentinelsIngame,false,true)
      else
        call TV8(CSBoard,13,VT8+3+SentinelsIngame,false,false)
      endif
      if NumberOfExtraAbilities>=2 then
        call TV8(CSBoard,14,VT8+3+SentinelsIngame,false,true)
      else
        call TV8(CSBoard,14,VT8+3+SentinelsIngame,false,false)
      endif
      call TP8(CSBoard,9,1,"Spells")
    else
      call T38(CSBoard,8,1,2)
      call T38(CSBoard,9,1,.1)
      call T38(CSBoard,10,1,.1)
      call T38(CSBoard,11,1,.1)
      call T38(CSBoard,12,1,.1)
      call T38(CSBoard,13,1,.1)
      call T38(CSBoard,14,1,.1)
      call T38(CSBoard,8,VT8+3+SentinelsIngame,2.5)
      call T38(CSBoard,9,VT8+3+SentinelsIngame,.1)
      call T38(CSBoard,10,VT8+3+SentinelsIngame,.1)
      call T38(CSBoard,11,VT8+3+SentinelsIngame,.1)
      call T38(CSBoard,12,VT8+3+SentinelsIngame,.1)
      call T38(CSBoard,13,VT8+3+SentinelsIngame,.1)
      call T38(CSBoard,14,VT8+3+SentinelsIngame,.1)
      call TV8(CSBoard,9,VT8+3+SentinelsIngame,false,false)
      call TV8(CSBoard,10,VT8+3+SentinelsIngame,false,false)
      call TV8(CSBoard,11,VT8+3+SentinelsIngame,false,false)
      call TV8(CSBoard,12,VT8+3+SentinelsIngame,false,false)
      call TV8(CSBoard,13,VT8+3+SentinelsIngame,false,false)
      call TV8(CSBoard,14,VT8+3+SentinelsIngame,false,false)
      call TP8(CSBoard,9,1," ")
    endif
    call TT8(CSBoard,9,VT8+3+SentinelsIngame,OKD(T1[VT8],1))
    call TT8(CSBoard,10,VT8+3+SentinelsIngame,OKD(T1[VT8],2))
    call TT8(CSBoard,11,VT8+3+SentinelsIngame,OKD(T1[VT8],3))
    call TT8(CSBoard,12,VT8+3+SentinelsIngame,OKD(T1[VT8],4))
    call TT8(CSBoard,13,VT8+3+SentinelsIngame,OKD(T1[VT8],5))
    call TT8(CSBoard,14,VT8+3+SentinelsIngame,OKD(T1[VT8],6))
    if(UA8(udg_Hero[GetPlayerId(T1[VT8])])and udg_Hero[GetPlayerId(T1[VT8])]!=null and TimerGetRemaining(HeroRespawnTimer[GetPlayerId(T1[VT8])])>0)then
      if IsPlayerAlly(GetLocalPlayer(),T1[VT8])then
        set OZD=XV7+" ("+(I2S(R2I(TimerGetRemaining(HeroRespawnTimer[GetPlayerId(T1[VT8])]))))+")|r"
      else
        set OZD=XS7+" ("+(I2S(R2I(TimerGetRemaining(HeroRespawnTimer[GetPlayerId(T1[VT8])]))))+")|r"
      endif
    else
      set OZD="  "
    endif
    if IsPlayerLeftGame[GetPlayerId(T1[VT8])]then
      call TP8(CSBoard,1,VT8+3+SentinelsIngame,TabTab+"|c00333333"+(IL7[GetPlayerId((T1[VT8]))])+"|r"+OZD)
    else
      call TP8(CSBoard,1,VT8+3+SentinelsIngame,TabTab+(IL7[GetPlayerId((T1[VT8]))])+OZD)
    endif
    set OTD=(TimerGetRemaining(PrimaryUltiCooldownTimer[GetPlayerId((T1[VT8]))]))
    if OTD>0 then
      set s=I2S(R2I(OTD))
    else
      set s=" "
    endif
    set OTDbis=(TimerGetRemaining(SecondaryUltiCooldownTimer[GetPlayerId((S1[VT8]))]))
    if OTDbis>0 then
      set sbis=I2S(R2I(OTDbis))
    else
      set sbis=" "
    endif
    if IsPlayerAlly(GetLocalPlayer(),T1[VT8])==false then
      call TP8(CSBoard,8,VT8+3+SentinelsIngame," ")
      set s=" "
      set sbis=" "
    else
      call TP8(CSBoard,8,VT8+3+SentinelsIngame,"|cffffcc00"+I2S(R2I(GetPlayerState(T1[VT8],PLAYER_STATE_RESOURCE_GOLD)))+"|r")
    endif
    call TP8(CSBoard,2,VT8+3+SentinelsIngame,s)
    call TP8(CSBoard,3,VT8+3+SentinelsIngame,sbis)
    set VT8=VT8+1
  endloop
endfunction

function EndScore_GameMode takes nothing returns string
  return integers009
endfunction

function EndScore_GetWinner takes nothing returns string
  return string021
endfunction

function OAD takes player p returns string
  return udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r"
endfunction

function OBD takes player p returns string
  local string OCD=I2S(AssistsBonusGoldCounter[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function O6D takes player p returns string
  local string OCD=I2S(AssistsBonusExpCounter[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function I59 takes nothing returns nothing
  local integer i=1
  local multiboarditem mbitem
  loop
    exitwhen i>XA7
    if(L3[GetPlayerId((XZ7[i]))])!="Here"then
      set mbitem=MultiboardGetItem(XW7,XX7[i],XY7[i])
      call MultiboardSetItemStyle(mbitem,true,false)
      call MultiboardSetItemValue(mbitem,"|c00555555"+(L3[GetPlayerId((XZ7[i]))])+"|r")
      call MultiboardSetItemWidth(mbitem,.07)
      call MultiboardReleaseItem(mbitem)
    endif
    set i=i+1
  endloop
  set mbitem=null
endfunction

function OLD takes player p returns string
  local string OCD=I2S(GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD))
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function O1D takes player p returns string
  local string OCD=I2S(ItemStats_Consumables[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function O0D takes player p returns string
  local string OCD=I2S(GetUnitLevel(udg_Hero[GetPlayerId(p)]))
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function O5D takes player p returns string
  local string OCD=I2S(ItemStats_Wards[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function O2D takes player p returns string
  local string OCD=I2S(GoldEarnedByKills[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function P4D takes player p returns string
  local string OCD=I2S(PlayerGoldCash[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function P7D takes player p returns string
  local string OCD=I2S(GlobalAssistsCounter[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function P8D takes player p returns string
  local string OCD=I2S(GlobalKillsCounter[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function P9D takes player p returns string
  local string OCD=I2S(GlobalDeathCounter[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function PDD takes player p returns string
  local string OCD=I2S(PlayerCS[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function PED takes player p returns string
  local string OCD=I2S(PlayerDenyCounter[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function PFD takes player p returns string
  local string OCD=I2S((LoadInteger(hashtable019,(400+GetPlayerId(p)),(79))))
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function PGD takes player p returns string
  local string OCD=I2S(DoubleKillsCounter[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function PHD takes player p returns string
  local string OCD=I2S(TrippleKillsCounter[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function PID takes player p returns string
  local string OCD=I2S(PlayerBestStreak[GetPlayerId(p)])
  local string O3D=OCD
  if p==GetLocalPlayer()then
    set O3D=XB7+OCD+"|r"
  endif
  return O3D
endfunction

function PJD takes player p returns string
  local string PKD
  local string PMD
  local string O3D
  local integer k=PlayerTowersKilled[GetPlayerId(p)]
  local integer d=PlayerTowersDenied[GetPlayerId(p)]
  if k<1 then
    set k=0
  endif
  if d<1 then
    set d=0
  endif
  set PKD=I2S(k)
  set PMD=I2S(d)
  set O3D=PKD+"/"+PMD
  if p==GetLocalPlayer()then
    set O3D=XB7+PKD+"|r/"+XB7+PMD+"|r"
  endif
  return O3D
endfunction

function PND takes player p returns string
  local integer POD=PlayerTimeDead[GetPlayerId(p)]
  local string Time
  local integer Minutes
  local integer Seconds
  set Minutes=(POD/ 60)-(1/ 2)
  set Seconds=ModuloInteger(POD,60)
  if(Seconds<10)then
    set Time=I2S(Minutes)+":0"+I2S(Seconds)
  else
    set Time=I2S(Minutes)+":"+I2S(Seconds)
  endif
  if p==GetLocalPlayer()then
    set Time=XB7+Time+"|r"
  endif
  return Time
endfunction

function PPD takes player Source,player Target returns string
  local string PKD
  local string PMD
  local string O3D
  local integer k=(LoadInteger(hashtable019,(400+GetPlayerId(Source)),(450+GetPlayerId(Target))))
  local integer d=(LoadInteger(hashtable019,(400+GetPlayerId(Source)),(500+GetPlayerId(Target))))
  if k<1 then
    set k=0
  endif
  if d<1 then
    set d=0
  endif
  set PKD=I2S(k)
  set PMD=I2S(d)
  set O3D=PKD+"/"+PMD
  if Source==GetLocalPlayer()then
    set O3D=XB7+PKD+"|r/"+XB7+PMD+"|r"
  endif
  return O3D
endfunction

function EndScore_AllKD takes nothing returns string
  return"|c00ff0303"+I2S(GlobalKillsCounter[GetPlayerId(Sentinels[0])])+"|r/|c0020c000"+I2S(GlobalDeathCounter[GetPlayerId(Sentinels[0])])+"|r"
endfunction

function PQD takes nothing returns nothing
  local integer PRD=SentinelsIngame
  local integer PSD=ScourgesIngame
  local player array PTD
  local player array PUD
  local integer curRow
  local integer curCol
  local integer numRows=21+IMaxIF(PRD,PSD)+1
  local integer numCols=1+(PRD+PSD)*2
  local multiboarditem mbitem
  local integer i
  local integer x
  local integer curRow1
  local integer curRow2
  local string e="|r"
  local string c0="|cff99ccff"
  local integer PZD
  local integer PAD
  call DisableTrigger(trigger022)
  call DestroyMultiboard(CSBoard)
  if PRD>0 and PSD>0 then
    set numRows=numRows+2
  endif
  set XW7=CreateMultiboard()
  call MultiboardSetItemsWidth(XW7,0)
  call MultiboardSetRowCount(XW7,numRows)
  call MultiboardSetColumnCount(XW7,numCols)
  call MultiboardSetTitleText(XW7,GetObjectName('n0E3')+" "+" - "+(integers009))
  call MultiboardMinimize(XW7,true)
  call MultiboardSetItemsStyle(XW7,false,false)
  call MultiboardDisplay(XW7,true)
  call MultiboardMinimize(XW7,false)
  call MultiboardSetTitleText(XW7,GetObjectName('n0E3')+" "+" - "+(integers009)+" - "+("|c00ff0303"+I2S(GlobalKillsCounter[GetPlayerId(Sentinels[0])])+"|r/|c0020c000"+I2S(GlobalDeathCounter[GetPlayerId(Sentinels[0])])+"|r"))
  set x=1
  set i=1
  loop
    exitwhen i>5
    if IsPlayer(Sentinels[i])or GetPlayerSlotState(Sentinels[i])==PLAYER_SLOT_STATE_LEFT then
      set PTD[x]=Sentinels[i]
      set x=x+1
    endif
    set i=i+1
  endloop
  set x=1
  set i=1
  loop
    exitwhen i>5
    if IsPlayer(Scourges[i])or GetPlayerSlotState(Scourges[i])==PLAYER_SLOT_STATE_LEFT then
      set PUD[x]=Scourges[i]
      set x=x+1
    endif
    set i=i+1
  endloop
  set i=0
  set curCol=0
  loop
    exitwhen i>numRows
    set mbitem=MultiboardGetItem(XW7,i,curCol)
    call MultiboardSetItemWidth(mbitem,.075)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=0
  set curCol=0
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem," ")
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,false,false)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,OAD(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,OAD(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,false,false)
  call MultiboardReleaseItem(mbitem)
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,true)
    call MultiboardSetItemValue(mbitem,O0D(PTD[i]))
    call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PTD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,true)
    call MultiboardSetItemValue(mbitem,O0D(PUD[i]))
    call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PUD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0EB')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(1)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(2)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(1)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(2)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+" "+e)
  call MultiboardReleaseItem(mbitem)
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(3)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(4)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(3)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(4)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+" "+e)
  call MultiboardReleaseItem(mbitem)
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(5)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(6)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(5)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(6)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0E2')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,OLD(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,OLD(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0E1')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,P8D(PTD[i])+"/"+P9D(PTD[i])+"/"+P7D(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,P8D(PUD[i])+"/"+P9D(PUD[i])+"/"+P7D(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DZ')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PDD(PTD[i])+"/"+PED(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PDD(PUD[i])+"/"+PED(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0JU')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,OBD(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,OBD(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0KF')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,O6D(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,O6D(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0E0')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,O5D(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,O5D(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DT')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PJD(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PJD(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DY')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PFD(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PFD(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DU')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,O2D(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,O2D(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DV')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PND(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PND(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DW')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,P4D(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,P4D(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DN')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,O1D(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,O1D(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0D8')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PGD(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PGD(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DI')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PHD(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PHD(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DM')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PID(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PID(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  if PRD>0 and PSD>0 then
    set curCol=0
    set PZD=curRow
    set PAD=curCol
    set curRow=curRow+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DL')+e)
    call MultiboardReleaseItem(mbitem)
    set curRow=PZD
    set x=1
    loop
      exitwhen x>PRD
      set curCol=0
      set curRow=PZD
      set i=1
      loop
        exitwhen i>PSD
        set curCol=x+(x-1)
        set curRow=curRow+1
        set mbitem=MultiboardGetItem(XW7,curRow,curCol)
        call MultiboardSetItemStyle(mbitem,false,true)
        call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PTD[x]))])))
        call MultiboardSetItemWidth(mbitem,.01)
        call MultiboardReleaseItem(mbitem)
        set curCol=curCol+1
        set mbitem=MultiboardGetItem(XW7,curRow,curCol)
        call MultiboardSetItemStyle(mbitem,true,true)
        call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PUD[i]))])))
        call MultiboardSetItemValue(mbitem," "+PPD(PTD[x],PUD[i]))
        call MultiboardSetItemWidth(mbitem,.059)
        call MultiboardReleaseItem(mbitem)
        set i=i+1
      endloop
      set x=x+1
    endloop
    set x=PRD+1
    loop
      exitwhen x>(PSD+PRD)
      set curCol=0
      set curRow=PZD
      set i=1
      loop
        exitwhen i>PRD
        set curCol=x+(x-1)
        set curRow=curRow+1
        set mbitem=MultiboardGetItem(XW7,curRow,curCol)
        call MultiboardSetItemStyle(mbitem,false,true)
        call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PUD[x-PRD]))])))
        call MultiboardSetItemWidth(mbitem,.01)
        call MultiboardReleaseItem(mbitem)
        set curCol=curCol+1
        set mbitem=MultiboardGetItem(XW7,curRow,curCol)
        call MultiboardSetItemStyle(mbitem,true,true)
        call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PTD[i]))])))
        call MultiboardSetItemValue(mbitem," "+PPD(PUD[x-PRD],PTD[i]))
        call MultiboardSetItemWidth(mbitem,.059)
        call MultiboardReleaseItem(mbitem)
        set i=i+1
      endloop
      set x=x+1
    endloop
  endif
  set curRow=curRow+1
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0CZ')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(L3[GetPlayerId((PTD[i]))]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set XA7=XA7+1
    set XX7[XA7]=curRow
    set XY7[XA7]=curCol
    set XZ7[XA7]=PTD[i]
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(XW7,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(L3[GetPlayerId((PUD[i]))]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set XA7=XA7+1
    set XX7[XA7]=curRow
    set XY7[XA7]=curCol
    set XZ7[XA7]=PUD[i]
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(XW7,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0D9')+e)
  call MultiboardReleaseItem(mbitem)
  set mbitem=MultiboardGetItem(XW7,curRow,curCol+1)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,(string021))
  call MultiboardSetItemWidth(mbitem,.07)
  call MultiboardReleaseItem(mbitem)
  call MultiboardMinimize(XW7,true)
  call MultiboardMinimize(XW7,false)
  set mbitem=null
endfunction

function ObsBoard_GameMode takes nothing returns string
  return integers009
endfunction

function PBD takes player p returns string
  return udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r"
endfunction

function PCD takes player p returns string
  local integer k=PlayerTowersKilled[GetPlayerId(p)]
  local integer d=PlayerTowersDenied[GetPlayerId(p)]
  if k<1 then
    set k=0
  endif
  if d<1 then
    set d=0
  endif
  return I2S(k)+"/"+I2S(d)
endfunction

function P3D takes player p returns string
  local integer POD=PlayerTimeDead[GetPlayerId(p)]
  local string Time
  local integer Minutes
  local integer Seconds
  set Minutes=(POD/ 60)-(1/ 2)
  set Seconds=ModuloInteger(POD,60)
  if(Seconds<10)then
    set Time=I2S(Minutes)+":0"+I2S(Seconds)
  else
    set Time=I2S(Minutes)+":"+I2S(Seconds)
  endif
  return Time
endfunction

function P6D takes player Source,player Target returns string
  local integer k=(LoadInteger(hashtable019,(400+GetPlayerId(Source)),(450+GetPlayerId(Target))))
  local integer d=(LoadInteger(hashtable019,(400+GetPlayerId(Source)),(500+GetPlayerId(Target))))
  if k<1 then
    set k=0
  endif
  if d<1 then
    set d=0
  endif
  return I2S(k)+"/"+I2S(d)
endfunction

function PLD takes player Source returns string
  local string P1D
  if IsDead(udg_Hero[GetPlayerId(Source)])then
    set P1D=I2S(R2I(TimerGetRemaining(HeroRespawnTimer[GetPlayerId(Source)])))
  else
    set P1D=" "
  endif
  return P1D
endfunction

function P0D takes player Source returns string
  local real r=(TimerGetRemaining(PrimaryUltiCooldownTimer[GetPlayerId((Source))]))
  local string P1D
  if r>0 then
    set P1D=I2S(R2I(r))
  else
    set P1D=" "
  endif
  return P1D
endfunction

function P5D takes integer P2D,integer Q4D returns nothing
  set ObsBoard=CreateMultiboard()
  call MultiboardSetItemsWidth(ObsBoard,0)
  call MultiboardSetRowCount(ObsBoard,P2D)
  call MultiboardSetColumnCount(ObsBoard,Q4D)
  call MultiboardSetTitleText(ObsBoard,GetObjectName('n0E3')+" "+" - "+(integers009))
  call MultiboardMinimize(ObsBoard,true)
  call MultiboardSetItemsStyle(ObsBoard,false,false)
  if (GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2) then
    call MultiboardDisplay(ObsBoard,true)
  endif
endfunction

function ObsBoard_AllKD takes nothing returns string
  return"|c00ff0303"+I2S(GlobalKillsCounter[GetPlayerId(Sentinels[0])])+"|r/|c0020c000"+I2S(GlobalDeathCounter[GetPlayerId(Sentinels[0])])+"|r"
endfunction

function Q7D takes nothing returns nothing
  local integer PRD=integer542
  local integer PSD=integer543
  local player array PTD
  local player array PUD
  local integer curRow
  local integer curCol
  local integer numRows=1+21+IMaxIF(PRD,PSD)
  local integer numCols=1+(PRD+PSD)*2
  local multiboarditem mbitem
  local integer i
  local integer x
  local integer curRow1
  local integer curRow2
  local string e="|r"
  local string c0="|cff99ccff"
  local integer PZD
  local integer PAD
  local integer Q8D=131
  local integer Q9D=139
  local integer QDD=139
  local integer QED=255
  local integer OUD=0
  local string OVD=""
  local string OWD=""
  local integer OXD=0
  local integer OYD=0
  local integer r
  if PRD>0 and PSD>0 then
    set numRows=numRows+2
  endif
  if GetTriggerExecCount(GetTriggeringTrigger())==1 then
    call P5D(numRows,numCols)
  endif
  if udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2) then
    call MultiboardDisplay(ObsBoard,true)
  endif
  set i=1
  loop
    exitwhen i>5
    set r=R2I(TimerGetRemaining(HeroRespawnTimer[GetPlayerId(Sentinels[i])]))
    if r>0 then
      set OUD=OUD+OJD(r)
      if OXD==0 then
        if r<10 then
          set OVD=udg_Colors[GetPlayerId(Sentinels[i])]+"0"+I2S(r)+" |r"
        else
          set OVD=udg_Colors[GetPlayerId(Sentinels[i])]+I2S(r)+" |r"
        endif
      else
        if r<10 then
          set OVD=OVD+XV7+"| |r"+udg_Colors[GetPlayerId(Sentinels[i])]+"0"+I2S(r)+" |r"
        else
          set OVD=OVD+XV7+"| |r"+udg_Colors[GetPlayerId(Sentinels[i])]+I2S(r)+" |r"
        endif
      endif
      set OXD=OXD+1
    endif
    set i=i+1
  endloop
  if OXD>0 then
    set OVD=XV7+"[Sentinel: |r"+OVD+XV7+"]|r"
  endif
  set i=1
  loop
    exitwhen i>5
    set r=R2I(TimerGetRemaining(HeroRespawnTimer[GetPlayerId(Scourges[i])]))
    if r>0 then
      set OUD=OUD+OJD(r)
      if OYD==0 then
        if r<10 then
          set OWD=udg_Colors[GetPlayerId(Scourges[i])]+"0"+I2S(r)+" |r"
        else
          set OWD=udg_Colors[GetPlayerId(Scourges[i])]+I2S(r)+" |r"
        endif
      else
        if r<10 then
          set OWD=OWD+XV7+"| |r"+udg_Colors[GetPlayerId(Scourges[i])]+"0"+I2S(r)+" |r"
        else
          set OWD=OWD+XV7+"| |r"+udg_Colors[GetPlayerId(Scourges[i])]+I2S(r)+" |r"
        endif
      endif
      set OYD=OYD+1
    endif
    set i=i+1
  endloop
  if OYD>0 then
    set OWD=XV7+"[Scourge: |r"+OWD+XV7+"]|r"
  endif
  call MultiboardSetTitleText(ObsBoard,OVD+" "+OWD+" "+GetObjectName('n0E3')+" "+" - "+(integers009)+" - "+("|c00ff0303"+I2S(GlobalKillsCounter[GetPlayerId(Sentinels[0])])+"|r/|c0020c000"+I2S(GlobalDeathCounter[GetPlayerId(Sentinels[0])])+"|r"))
  set x=1
  set i=1
  loop
    exitwhen i>5
    if IsPlayer(Sentinels[i])or GetPlayerSlotState(Sentinels[i])==PLAYER_SLOT_STATE_LEFT then
      set PTD[x]=Sentinels[i]
      set x=x+1
    endif
    set i=i+1
  endloop
  set x=1
  set i=1
  loop
    exitwhen i>5
    if IsPlayer(Scourges[i])or GetPlayerSlotState(Scourges[i])==PLAYER_SLOT_STATE_LEFT then
      set PUD[x]=Scourges[i]
      set x=x+1
    endif
    set i=i+1
  endloop
  set i=0
  set curCol=0
  loop
    exitwhen i>numRows
    set mbitem=MultiboardGetItem(ObsBoard,i,curCol)
    call MultiboardSetItemWidth(mbitem,.075)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=0
  set curCol=0
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem," ")
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,false,false)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PBD(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PBD(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,false,false)
  call MultiboardReleaseItem(mbitem)
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,true)
    call MultiboardSetItemValue(mbitem,"("+(I2S(GetUnitLevel(udg_Hero[GetPlayerId((PTD[i]))])))+")")
    call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PTD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,true)
    call MultiboardSetItemValue(mbitem,"("+(I2S(GetUnitLevel(udg_Hero[GetPlayerId((PUD[i]))])))+")")
    call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PUD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0EB')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(1)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(2)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(1)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(2)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+" "+e)
  call MultiboardReleaseItem(mbitem)
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(3)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(4)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(3)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(4)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+" "+e)
  call MultiboardReleaseItem(mbitem)
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(5)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PTD[i]))],(6)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(5)-1))))
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,(FD9(UnitItemInSlot(udg_Hero[GetPlayerId((PUD[i]))],(6)-1))))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0E2')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(GetPlayerState((PTD[i]),PLAYER_STATE_RESOURCE_GOLD))))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(GetPlayerState((PUD[i]),PLAYER_STATE_RESOURCE_GOLD))))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0LT')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemValueColor(mbitem,Q8D,Q9D,QDD,QED)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(BuybackUnitCost[DefineBuybackUnitIndex(GetHeroLevel(udg_Hero[GetPlayerId((PTD[i]))]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemValueColor(mbitem,Q8D,Q9D,QDD,QED)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(BuybackUnitCost[DefineBuybackUnitIndex(GetHeroLevel(udg_Hero[GetPlayerId((PUD[i]))]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DZ')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(PlayerCS[GetPlayerId((PTD[i]))]))+"/"+(I2S(PlayerDenyCounter[GetPlayerId((PTD[i]))]))+"/"+(I2S((LoadInteger(hashtable019,(400+GetPlayerId((PTD[i]))),(79))))))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(PlayerCS[GetPlayerId((PUD[i]))]))+"/"+(I2S(PlayerDenyCounter[GetPlayerId((PUD[i]))]))+"/"+(I2S((LoadInteger(hashtable019,(400+GetPlayerId((PUD[i]))),(79))))))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0E1')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemValueColor(mbitem,Q8D,Q9D,QDD,QED)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(GlobalKillsCounter[GetPlayerId((PTD[i]))]))+"/"+(I2S(GlobalDeathCounter[GetPlayerId((PTD[i]))]))+"/"+(I2S(GlobalAssistsCounter[GetPlayerId((PTD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemValueColor(mbitem,Q8D,Q9D,QDD,QED)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(GlobalKillsCounter[GetPlayerId((PUD[i]))]))+"/"+(I2S(GlobalDeathCounter[GetPlayerId((PUD[i]))]))+"/"+(I2S(GlobalAssistsCounter[GetPlayerId((PUD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0E0')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(ItemStats_Wards[GetPlayerId((PTD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(ItemStats_Wards[GetPlayerId((PUD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DT')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemValueColor(mbitem,Q8D,Q9D,QDD,QED)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PCD(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemValueColor(mbitem,Q8D,Q9D,QDD,QED)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,PCD(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DU')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(GoldEarnedByKills[GetPlayerId((PTD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(GoldEarnedByKills[GetPlayerId((PUD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+"Skills"+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PTD[i])*PlayerSkillOffset+1]])
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId((PTD[i]))],1)))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PUD[i])*PlayerSkillOffset+1]])
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId((PUD[i]))],1)))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+" "+e)
  call MultiboardReleaseItem(mbitem)
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PTD[i])*PlayerSkillOffset+2]])
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId((PTD[i]))],2)))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PUD[i])*PlayerSkillOffset+2]])
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId(PUD[i])],2)))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+" "+e)
  call MultiboardReleaseItem(mbitem)
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PTD[i])*PlayerSkillOffset+3]])
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId((PTD[i]))],3)))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PUD[i])*PlayerSkillOffset+3]])
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId((PUD[i]))],3)))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curRow=curRow+1
  set curCol=0
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+" "+e)
  call MultiboardReleaseItem(mbitem)
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PTD[i])*PlayerSkillOffset+4]])
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId((PTD[i]))],4)))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PUD[i])*PlayerSkillOffset+4]])
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId((PUD[i]))],4)))
    call MultiboardSetItemWidth(mbitem,.054)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  if NumberOfExtraAbilities>=1 then
    set curRow=curRow+1
    set curCol=0
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,c0+" "+e)
    call MultiboardReleaseItem(mbitem)
    set i=1
    loop
      exitwhen i>PRD
      set curCol=curCol+1
      set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
      call MultiboardSetItemStyle(mbitem,false,true)
      call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PTD[i])*PlayerSkillOffset+5]])
      call MultiboardSetItemWidth(mbitem,.015)
      call MultiboardReleaseItem(mbitem)
      set curCol=curCol+1
      set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
      call MultiboardSetItemStyle(mbitem,true,false)
      call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId((PTD[i]))],5)))
      call MultiboardSetItemWidth(mbitem,.054)
      call MultiboardReleaseItem(mbitem)
      set i=i+1
    endloop
    set i=1
    loop
      exitwhen i>PSD
      set curCol=curCol+1
      set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
      call MultiboardSetItemStyle(mbitem,false,true)
      call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PUD[i])*PlayerSkillOffset+5]])
      call MultiboardSetItemWidth(mbitem,.015)
      call MultiboardReleaseItem(mbitem)
      set curCol=curCol+1
      set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
      call MultiboardSetItemStyle(mbitem,true,false)
      call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId((PUD[i]))],5)))
      call MultiboardSetItemWidth(mbitem,.054)
      call MultiboardReleaseItem(mbitem)
      set i=i+1
    endloop
  endif
  if NumberOfExtraAbilities>=2 then
    set curRow=curRow+1
    set curCol=0
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,c0+" "+e)
    call MultiboardReleaseItem(mbitem)
    set i=1
    loop
      exitwhen i>PRD
      set curCol=curCol+1
      set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
      call MultiboardSetItemStyle(mbitem,false,true)
      call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PTD[i])*PlayerSkillOffset+6]])
      call MultiboardSetItemWidth(mbitem,.015)
      call MultiboardReleaseItem(mbitem)
      set curCol=curCol+1
      set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
      call MultiboardSetItemStyle(mbitem,true,false)
      call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId((PTD[i]))],6)))
      call MultiboardSetItemWidth(mbitem,.054)
      call MultiboardReleaseItem(mbitem)
      set i=i+1
    endloop
    set i=1
    loop
      exitwhen i>PSD
      set curCol=curCol+1
      set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
      call MultiboardSetItemStyle(mbitem,false,true)
      call MultiboardSetItemIcon(mbitem,SkillIcon[PlayerSkillNumber[GetPlayerId(PUD[i])*PlayerSkillOffset+6]])
      call MultiboardSetItemWidth(mbitem,.015)
      call MultiboardReleaseItem(mbitem)
      set curCol=curCol+1
      set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
      call MultiboardSetItemStyle(mbitem,true,false)
      call MultiboardSetItemValue(mbitem,I2S(GetHeroAbilityLevel(udg_Hero[GetPlayerId((PUD[i]))],6)))
      call MultiboardSetItemWidth(mbitem,.054)
      call MultiboardReleaseItem(mbitem)
      set i=i+1
    endloop
  endif
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DV')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,P3D(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,P3D(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DW')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemValueColor(mbitem,Q8D,Q9D,QDD,QED)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(PlayerGoldCash[GetPlayerId((PTD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemValueColor(mbitem,Q8D,Q9D,QDD,QED)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(PlayerGoldCash[GetPlayerId((PUD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DN')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(ItemStats_Consumables[GetPlayerId((PTD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,(I2S(ItemStats_Consumables[GetPlayerId((PUD[i]))])))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  if PRD>0 and PSD>0 then
    set curCol=0
    set PZD=curRow
    set PAD=curCol
    set curRow=curRow+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemStyle(mbitem,true,false)
    call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0DL')+e)
    call MultiboardReleaseItem(mbitem)
    set curRow=PZD
    set x=1
    loop
      exitwhen x>PRD
      set curCol=0
      set curRow=PZD
      set i=1
      loop
        exitwhen i>PSD
        set curCol=x+(x-1)
        set curRow=curRow+1
        set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
        call MultiboardSetItemStyle(mbitem,false,true)
        call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PTD[x]))])))
        call MultiboardSetItemWidth(mbitem,.01)
        call MultiboardReleaseItem(mbitem)
        set curCol=curCol+1
        set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
        call MultiboardSetItemStyle(mbitem,true,true)
        call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PUD[i]))])))
        call MultiboardSetItemValue(mbitem," "+P6D(PTD[x],PUD[i]))
        call MultiboardSetItemWidth(mbitem,.059)
        call MultiboardReleaseItem(mbitem)
        set i=i+1
      endloop
      set x=x+1
    endloop
    set x=PRD+1
    loop
      exitwhen x>(PSD+PRD)
      set curCol=0
      set curRow=PZD
      set i=1
      loop
        exitwhen i>PRD
        set curCol=x+(x-1)
        set curRow=curRow+1
        set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
        call MultiboardSetItemStyle(mbitem,false,true)
        call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PUD[x-PRD]))])))
        call MultiboardSetItemWidth(mbitem,.01)
        call MultiboardReleaseItem(mbitem)
        set curCol=curCol+1
        set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
        call MultiboardSetItemStyle(mbitem,true,true)
        call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PTD[i]))])))
        call MultiboardSetItemValue(mbitem," "+P6D(PUD[x-PRD],PTD[i]))
        call MultiboardSetItemWidth(mbitem,.059)
        call MultiboardReleaseItem(mbitem)
        set i=i+1
      endloop
      set x=x+1
    endloop
  endif
  set curRow=curRow+1
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0HS')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemValueColor(mbitem,Q8D,Q9D,QDD,QED)
    if PLD(PTD[i])==" "then
      call MultiboardSetItemStyle(mbitem,true,false)
    else
      call MultiboardSetItemStyle(mbitem,true,false)
      call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PTD[i]))])))
    endif
    call MultiboardSetItemValue(mbitem,P0D(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    call MultiboardSetItemValueColor(mbitem,Q8D,Q9D,QDD,QED)
    if PLD(PUD[i])==" "then
      call MultiboardSetItemStyle(mbitem,true,false)
    else
      call MultiboardSetItemStyle(mbitem,true,false)
      call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PUD[i]))])))
    endif
    call MultiboardSetItemValue(mbitem,P0D(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set curCol=0
  set curRow=curRow+1
  set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,c0+GetObjectName('n0E4')+e)
  call MultiboardReleaseItem(mbitem)
  set curCol=0
  set i=1
  loop
    exitwhen i>PRD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    if PLD(PTD[i])==" "then
      call MultiboardSetItemStyle(mbitem,true,false)
    else
      call MultiboardSetItemStyle(mbitem,true,true)
      call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PTD[i]))])))
    endif
    call MultiboardSetItemValue(mbitem,PLD(PTD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>PSD
    set curCol=curCol+1
    set mbitem=MultiboardGetItem(ObsBoard,curRow,curCol)
    if PLD(PUD[i])==" "then
      call MultiboardSetItemStyle(mbitem,true,false)
    else
      call MultiboardSetItemStyle(mbitem,true,true)
      call MultiboardSetItemIcon(mbitem,(US8(udg_Hero[GetPlayerId((PUD[i]))])))
    endif
    call MultiboardSetItemValue(mbitem,PLD(PUD[i]))
    call MultiboardSetItemWidth(mbitem,.07)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set mbitem=null
endfunction

function CreateObsBoard takes nothing returns nothing
  local trigger t
  if udg_ObserverMode then
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddAction(t,function Q7D)
    set X37=t
  endif
  set t=null
endfunction

function QGD takes nothing returns boolean
  local integer id=GetUnitTypeId(GetTriggerUnit())
  local string U28
  if GetLocalPlayer()==GetTriggerPlayer()then
    if id=='hC95' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='n01K' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='nC38' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='e025' then
    elseif id=='n00V' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='n00W' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='n002' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='n00X' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='n009' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='n0HE' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='nC35' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='u00Q' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='uC74' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='u010' then
      call ResetUnitAnimation(GetTriggerUnit())
    elseif id=='u00Z' then
      call ResetUnitAnimation(GetTriggerUnit())
    endif
  endif
  return false
endfunction

function QHD takes nothing returns boolean
  local integer id=GetUnitTypeId(GetTriggerUnit())
  local string U28
  if GetLocalPlayer()==GetTriggerPlayer()then
    if id=='hC95' then
      set U28="stand work"
    elseif id=='n01K' then
      set U28="stand third"
    elseif id=='nC38' then
      call SetUnitAnimationByIndex(GetTriggerUnit(),3)
    elseif id=='e025' then
    elseif id=='n00V' then
      set U28="spell attack"
    elseif id=='n00W' then
      set U28="spell"
    elseif id=='n002' then
      call SetUnitAnimationByIndex(GetTriggerUnit(),3)
    elseif id=='n00X' then
      set U28="stand work"
    elseif id=='n009' then
      set U28="stand work"
    elseif id=='n0HE' then
      set U28="stand victory"
    elseif id=='nC35' then
      set U28="stand work"
    elseif id=='u00Q' then
      set U28="stand work"
    elseif id=='uC74' then
      set U28="stand work gold"
    elseif id=='u010' then
      set U28="stand work"
    elseif id=='u00Z' then
      set U28="stand work"
    endif
    if U28!=""then
      call SetUnitAnimation(GetTriggerUnit(),U28)
      call QueueUnitAnimation(GetTriggerUnit(),U28)
    endif
  endif
  return false
endfunction

function QID takes unit u,integer d returns nothing
  local texttag t=CreateTextTag()
  call SetTextTagText(t,"+"+I2S(d)+" "+GetObjectName('n0LQ'),.03)
  call SetTextTagPosUnit(t,u,0)
  call SetTextTagColorBJ(t,50,75,255,15)
  call SetTextTagVelocity(t,0,.035)
  call SetTextTagFadepoint(t,3)
  call SetTextTagLifespan(t,2.5)
  call SetTextTagPermanent(t,false)
  call SetTextTagVisibility(t,IsUnitVisibleLoD(u,GetLocalPlayer())or IsObserver(GetLocalPlayer()))
  set t=null
endfunction

function Lich_DarkRitual_Delayed takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local real mp=LoadReal(hashtable019,h,0)
  call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MANA)+mp)
  call FlushChildHashtable(hashtable019,h)
  call CleanTrigger(t)
  set t=null
  set u=null
endfunction

function Lich_DarkRitual_Delayed_Test takes nothing returns nothing
  call SetUnitState(TEMPUNIT,UNIT_STATE_MANA,GetUnitState(TEMPUNIT,UNIT_STATE_MANA)+TempReal)
endfunction


function QJD takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t
  local integer h
  if GetUnitTypeId(Source)=='e00C' then
    set Source=udg_Hero[GetPlayerId(GetOwningPlayer(Source))]
  endif
  if GetUnitState(Source,UNIT_STATE_LIFE)>1 then
    
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,0,false)
    call TriggerAddCondition(t,Condition(function Lich_DarkRitual_Delayed))
    call SaveUnitHandle(hashtable019,h,0,Source)
    call SaveReal(hashtable019,h,0,GetUnitState(Target,UNIT_STATE_LIFE)*GetUnitAbilityLevel(Source,'A053')*.15)
    //set TEMPUNIT=Source
    //set TempReal=GetUnitState(Target,UNIT_STATE_LIFE)*GetUnitAbilityLevel(Source,'A053')*.15
    //call ExecuteFunc("Lich_DarkRitual_Delayed_Test")
    //call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)+GetUnitState(Target,UNIT_STATE_LIFE)*GetUnitAbilityLevel(Source,'A053')*.15)
    call QID(Target,R2I(GetUnitState(Target,UNIT_STATE_LIFE)*(GetUnitAbilityLevel(Source,'A053')*(.15)+0.1)))
    set SacrificedByLich=true
    if SacrificedByLich then
      call echo("???")
    endif
    call DamageTarget(Source,Target,1,99999)
    call DamageTarget(Source,Target,2,99999)
    call DamageTarget(Source,Target,3,99999)
    set t=null
  endif
  set Source=null
  set Target=null
endfunction

function QKD takes nothing returns boolean
  if GetSpellAbilityId()=='A053' and IsCourier(GetSpellTargetUnit())==false then
    call QJD()
  endif
  return false
endfunction

function Lich_DarkRitual takes nothing returns nothing
  if IsCourier(GetSpellTargetUnit())==false then
    call QJD()
  endif
endfunction

function Lich_FrostNove_Remove takes nothing returns nothing 
  call UnitRemoveAbility(GetEnumUnit(),'A30B')
  call UnitRemoveAbility(GetEnumUnit(),'B30A')
endfunction

function Lich_FrostNova_End takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local group g=LoadGroupHandle(hashtable019,h,1)
  call ForGroup(g,function Lich_FrostNove_Remove)
  call GroupClear(g)
  call DestroyGroup(g)
  set g=null
  set t=null
endfunction

function Lich_FrostNova_Targets takes nothing returns boolean 
  return IsUnitAlly(GetFilterUnit(),GetOwningPlayer(TEMPUNIT))==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsMagicImmune(GetFilterUnit())==false
endfunction

function Lich_FrostNova_Group takes nothing returns nothing
  local unit u=GetEnumUnit()
  local integer lvl=tt_int1
  call DamageTarget(TEMPUNIT,u,1,50+25*lvl)
  call UnitAddAbility2(u,'A30B')
  call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A30B',false)
  call UnitMakeAbilityPermanent(u,true,'A30A')
  
  set u=null
endfunction

function Lich_FrostNova_Start takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local group g=CreateGroup()
  call TriggerRegisterTimerEvent(t,4,false)
  call TriggerAddCondition(t,Condition(function Lich_FrostNova_End))
  call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DEATH)
  call DamageTarget(u,target,1,50*GetUnitAbilityLevel(u,GetSpellAbilityId()))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl",target,"origin"))
  set TEMPUNIT=u
  call GroupEnumUnitsInRange(g,GetUnitX(target),GetUnitY(target),225,Condition(function Lich_FrostNova_Targets))
  call GroupAddUnit(g,target)
  set TEMPUNIT=u
  set tt_int1=GetUnitAbilityLevel(u,'A07F')
  call ForGroup(g,function Lich_FrostNova_Group)
  call SaveGroupHandle(hashtable019,h,1,g)
  set g=null
  set target=null
  set u=null
  set t=null
endfunction


function Lich_FrostArmor_Remove takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local unit u=LoadUnitHandle(hashtable019,GetHandleId(t),0)
  if IsDead(u)==false then
    call UnitRemoveAbility(u,'A309')
    call UnitRemoveAbility(u,'B308')
  endif
  if GetUnitAbilityLevel(u,'B308')==0 then
    call DestroyEffect(LoadEffectHandle(hashtable019,GetHandleId(t),1))
    call SaveBoolean(hashtable019,GetHandleId(u),1991,false)
    call RemoveSavedHandle(hashtable019,GetHandleId(u),1991)
    call FlushChildHashtable(hashtable019,GetHandleId(t))
    call DestroyTimer(t)
  else
    call TimerStart(t,1,true,function Lich_FrostArmor_Remove)
  endif
  set t=null
  set u=null
endfunction

function Lich_FrostArmor_RangedAttack takes unit u, unit t returns nothing
  local timer tt
  if IsMagicImmune(u)==false then
    call UnitAddAbility2(u,'A309')
    call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A309',false)
    call UnitMakeAbilityPermanent(u,true,'A308')
    if(LoadBoolean(hashtable019,GetHandleId(u),1991))then
      set tt=LoadTimerHandle(hashtable019,GetHandleId(u),1991)
      call TimerStart(tt,2,false,function Lich_FrostArmor_Remove)
    else
      set tt=CreateTimer()
      call TimerStart(tt,2,false,function Lich_FrostArmor_Remove)
      call SaveUnitHandle(hashtable019,GetHandleId(tt),0,u)
      call SaveBoolean(hashtable019,GetHandleId(u),1991,true)
      call SaveTimerHandle(hashtable019,GetHandleId(u),1991,tt)
      call SaveEffectHandle(hashtable019,GetHandleId(tt),1,AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostArmor\\FrostArmorDamage.mdl",u,"origin"))
    endif
    set tt=null
  endif
  
endfunction

function Lich_FrostArmor_Check takes nothing returns nothing
  if GetUnitAbilityLevel(GetTriggerUnit(),'BUfa')>0 and IsUnitType(GetAttacker(),UNIT_TYPE_RANGED_ATTACKER) then
    call Lich_FrostArmor_RangedAttack(GetAttacker(),GetTriggerUnit())
  endif
endfunction

function Lich_FrostArmor_Reg takes nothing returns nothing
  //	local trigger t=CreateTrigger()
  //	call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  //	call TriggerAddCondition(t,Condition(function Lich_FrostArmor_Check))
  //	set t=null
endfunction

function QOD takes nothing returns boolean
  local real r
  local real k
  local unit u
  if YC7==false then
    set u=boolean031
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-X67)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
  endif
  if Y37==false then
    set u=integer027
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-XL7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
  endif
  if Y67==false then
    set u=string005
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-X17)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
  endif
  if YB7==false then
    set u=E47
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-X07)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=E77
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-X57)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=E87
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-X27)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=E97
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-Y47)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=ED7
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-Y77)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=EE7
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-Y87)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=EF7
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-Y97)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=EG7
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YD7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=EH7
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YE7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=EI7
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YF7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=EJ7
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YG7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
  endif
  if YY7==false then
    set u=Towers_Scourge_Top_2
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YH7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
  endif
  if YZ7==false then
    set u=Towers_Scourge_Mid_2
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YI7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
  endif
  if YA7==false then
    set u=Towers_Scourge_Bot_2
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YJ7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
  endif
  if YX7==false then
    set u=Towers_Scourge_Top_3
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YK7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=Towers_Scourge_Mid_3
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YM7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=Towers_Scourge_Bot_3
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YN7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=Towers_Scourge_Throne1
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YO7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=Towers_Scourge_Throne2
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YP7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=HL7
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YQ7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=H17
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YR7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=H07
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YS7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=H57
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YT7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=H27
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YU7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
    set u=I47
    if u!=null then
      set r=GetUnitState(u,UNIT_STATE_LIFE)
      set k=r+AntiBDRegenRate
      if k<(GetUnitState(u,UNIT_STATE_MAX_LIFE)-YV7)then
        call SetUnitState(u,UNIT_STATE_LIFE,k)
      endif
    endif
  endif
  set u=null
  return false
endfunction

function AntiBackdoorHealing takes unit u, unit source, real dmg returns nothing
  if IsUnitIllusion(source) then
    call SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_LIFE)+.75*dmg)
  else
    call SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_LIFE)+.25*dmg)
  endif
endfunction

function QRD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YY7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YH7=YH7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QSD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YZ7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YI7=YI7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QTD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YA7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YJ7=YJ7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QUD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YX7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YK7=YK7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QVD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YX7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YM7=YM7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QWD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YX7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YN7=YN7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QXD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YX7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YO7=YO7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QYD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YX7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YP7=YP7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QZD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YX7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YQ7=YQ7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QAD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YX7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YR7=YR7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QBD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YX7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YS7=YS7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QCD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YX7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YT7=YT7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function Q3D takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YX7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YU7=YU7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function Q6D takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YX7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YV7=YV7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function QLD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YC7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set X67=X67+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function Q1D takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if Y37 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set XL7=XL7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function Q0D takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if Y67 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set X17=X17+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function Q5D takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YB7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set X07=X07+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function Q2D takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YB7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set X57=X57+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function R4D takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YB7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set X27=X27+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function R7D takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YB7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set Y47=Y47+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function R8D takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YB7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set Y77=Y77+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function R9D takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YB7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set Y87=Y87+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function RDD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YB7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set Y97=Y97+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function RED takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YB7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YD7=YD7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function RFD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YB7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YE7=YE7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function RGD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YB7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YF7=YF7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function RHD takes nothing returns boolean
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if YB7 or IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) then
      set YG7=YG7+GetEventDamage()
    else
      call AntiBackdoorHealing(GetTriggerUnit(),GetEventDamageSource(),GetEventDamage())
    endif
  else
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function RID takes nothing returns boolean
  if not YB7 then
    set YB7=GetOwningPlayer(GetFilterUnit())==Scourges[0]
  endif
  //	if GetOwningPlayer(GetFilterUnit())==Scourges[0]then
  //		set YB7=true
  //	endif
  return false
endfunction

function RJD takes nothing returns boolean
  if not YC7 then
    set YC7=GetOwningPlayer(GetFilterUnit())==Scourges[0]
  endif
  //	if GetOwningPlayer(GetFilterUnit())==Scourges[0]then
  //		set YC7=true
  //	endif
  return false
endfunction

function RKD takes nothing returns boolean
  if not Y37 then
    set Y37=GetOwningPlayer(GetFilterUnit())==Scourges[0]
  endif
  //	if GetOwningPlayer(GetFilterUnit())==Scourges[0]then
  //		set Y37=true
  //	endif
  return false
endfunction

function RMD takes nothing returns boolean
  if not Y67 then
    set Y67=GetOwningPlayer(GetFilterUnit())==Scourges[0]
  endif
  //	if GetOwningPlayer(GetFilterUnit())==Scourges[0]then
  //		set Y67=true
  //	endif
  return false
endfunction

function RND takes nothing returns boolean
  if not YX7 then
    set YX7=GetOwningPlayer(GetFilterUnit())==Sentinels[0]
  endif
  //	if GetOwningPlayer(GetFilterUnit())==Sentinels[0]then
  //		set YX7=true
  //	endif
  return false
endfunction

function ROD takes nothing returns boolean
  if not YY7 then
    set YY7=GetOwningPlayer(GetFilterUnit())==Sentinels[0]
  endif
  //	if GetOwningPlayer(GetFilterUnit())==Sentinels[0]then
  //		set YY7=true
  //	endif
  return false
endfunction

function RPD takes nothing returns boolean
  if not YZ7 then
    set YZ7=GetOwningPlayer(GetFilterUnit())==Sentinels[0]
  endif
  //	if GetOwningPlayer(GetFilterUnit())==Sentinels[0]then
  //		set YZ7=true
  //	endif
  return false
endfunction

function RQD takes nothing returns boolean
  if not YA7 then
    set YA7=GetOwningPlayer(GetFilterUnit())==Sentinels[0]
  endif
  //	if GetOwningPlayer(GetFilterUnit())==Sentinels[0]then
  //		set YA7=true
  //	endif
  return false
endfunction

function RRD takes nothing returns boolean
  local group g=GetAvailableGroup()
  set YX7=false
  set YY7=false
  set YZ7=false
  set YA7=false
  set YB7=false
  set YC7=false
  set Y37=false
  set Y67=false
  call GroupEnumUnitsInRect(g,A6,Condition(function RID))
  call GroupEnumUnitsInRect(g,B6,Condition(function RID))
  call GroupEnumUnitsInRect(g,C6,Condition(function RID))
  call GroupEnumUnitsInRect(g,DB,Condition(function RID))
  call GroupEnumUnitsInRect(g,EB,Condition(function RID))
  call GroupEnumUnitsInRect(g,FB,Condition(function RID))
  call GroupEnumUnitsInRect(g,BB,Condition(function RJD))
  call GroupEnumUnitsInRect(g,VB,Condition(function RKD))
  call GroupEnumUnitsInRect(g,CB,Condition(function RMD))
  call GroupEnumUnitsInRect(g,D6,Condition(function RND))
  call GroupEnumUnitsInRect(g,E6,Condition(function RND))
  call GroupEnumUnitsInRect(g,F6,Condition(function RND))
  call GroupEnumUnitsInRect(g,ZB,Condition(function RND))
  call GroupEnumUnitsInRect(g,GB,Condition(function RND))
  call GroupEnumUnitsInRect(g,HB,Condition(function RND))
  call GroupEnumUnitsInRect(g,IB,Condition(function ROD))
  call GroupEnumUnitsInRect(g,OB,Condition(function RPD))
  call GroupEnumUnitsInRect(g,SomeRect1,Condition(function RQD))
  call KillGroup(g)
  set g=null
  return false
endfunction

function RSD takes nothing returns boolean
  call CleanTrigger(GetTriggeringTrigger())
  call TriggerEvaluate(trigger019)
  return false
endfunction

function RTD takes nothing returns boolean
  local real r=TimerGetRemaining(NK)
  local real Y59=r
  local integer YO8=R2I(Y59)
  local integer Minutes=YO8/ 60-1/ 2
  local integer Seconds=ModuloInteger(YO8,60)
  local trigger t
  local integer i
  if r==0 then
    if b_isPickTime then
      set b_isPickTime=false
      call ExeFunc("RUD")
      return false
    endif
    set YL7=true
    call Traffic_RegisterData("GameStart",1)
    set i=1
    loop
      exitwhen i>11
      if IsPlayer(Player(i)) then
        call Traffic_RegisterData("SP1_"+I2S(i),SkillID[PlayerSkillNumber[GetPlayerId(Player(i))*PlayerSkillOffset+1]])
        call Traffic_RegisterData("SP2_"+I2S(i),SkillID[PlayerSkillNumber[GetPlayerId(Player(i))*PlayerSkillOffset+2]])
        call Traffic_RegisterData("SP3_"+I2S(i),SkillID[PlayerSkillNumber[GetPlayerId(Player(i))*PlayerSkillOffset+3]])
        call Traffic_RegisterData("SP4_"+I2S(i),SkillID[PlayerSkillNumber[GetPlayerId(Player(i))*PlayerSkillOffset+4]])
        if NumberOfExtraAbilities>=1 then
          call Traffic_RegisterData("SP5_"+I2S(i),SkillID[PlayerSkillNumber[GetPlayerId(Player(i))*PlayerSkillOffset+5]])
        endif
        if NumberOfExtraAbilities>=2 then
          call Traffic_RegisterData("SP6_"+I2S(i),SkillID[PlayerSkillNumber[GetPlayerId(Player(i))*PlayerSkillOffset+6]])
        endif
      endif
      set i=i+1
      if i==6 then//skip scourge
        set i=7
      endif
    endloop
    call L98(Minutes,Seconds,true)
    set boolean033=true
    set GameStartsTime=TimerGetElapsed(GlobalTimer)
    call CleanTrigger(GetTriggeringTrigger())
    call SetFloatGameState(GAME_STATE_TIME_OF_DAY,6.)
    call SuspendTimeOfDay(false)
    //call SetTimeOfDayScale(.625)
    if Mode_NP==false then
      if Mode_ER then
        call TriggerRegisterTimerEvent(T47,60,true)
      else
        call TriggerRegisterTimerEvent(T47,120,true)
      endif
      call TriggerEvaluate(T47)
    endif
    call TriggerRegisterTimerEvent(trigger019,60,true)
    if not Mode_FN then
      set t=CreateTrigger()
      call TriggerRegisterTimerEvent(t,30,false)
      call TriggerAddCondition(t,Condition(function RSD))
      set t=null
    endif
    call TriggerRegisterTimerEventPeriodic(integers004,30.)
    call TriggerExecute(integers004)
    call TriggerRegisterTimerEventPeriodic(LG,450.)
    call TriggerRegisterTimerEventSingle(unit001,2699.)
    call TriggerRegisterTimerEventSingle(integers005,999.)
    call TriggerRegisterTimerEventSingle(integers005,1999.)
    call TriggerRegisterTimerEventSingle(integers005,2999.)
    call TriggerRegisterTimerEvent(M87,300,true)
    call TriggerRegisterTimerEvent(ZI7,300,true)
    call TriggerRegisterTimerEvent(PN,30,true)
    call TriggerEvaluate(PN)
    if Mode_SC then
      call TriggerRegisterTimerEvent(SG,600,true)
    endif
    call ExeFunc("RVD")
  elseif r==7 and not b_isPickTime then
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,30,true)
    call TriggerAddCondition(t,Condition(function MKD))
  elseif Y59<12 and boolean185==false and not b_isPickTime then
    set boolean185=true
    call PlaySoundBJ(QD)
    call L98(Minutes,Seconds,true)
  elseif Y59==20 then
    
  elseif Y59==15 and b_isPickTime and (CanAddTime[0]>0 or CanAddTime[1]>0) then
    if not b_isPlayerReady[GetPlayerId(GetLocalPlayer())] then
      call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,20,"|c006699CC"+"If you need more time to pick your skills, enter -addtime"+"|r")
    endif
  else
    call L98(Minutes,Seconds,true)
  endif
  return false
endfunction

function RWD takes nothing returns boolean
  if IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetAttacker()))and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(GetAttacker()))and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>1 and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==false and GetOwningPlayer(GetFilterUnit())!=NeutralsPlayer then
    if IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE) then
      set Y17=GetFilterUnit()
    else
      set Y07=GetFilterUnit()
    endif
  endif
  return false
endfunction

function RXD takes nothing returns nothing
  local unit MQD=GetAttacker()
  local unit Target=GetTriggerUnit()
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(MQD),GetUnitY(MQD),900,Condition(function RWD))
  call KillGroup(g)
  call DisableTrigger(GetTriggeringTrigger())
  if Y17!=null then
    call IssueTargetOrderById(MQD,851983,Y17)
    call GroupAddUnit(Y57,MQD)
  elseif IsUnitType(Target,UNIT_TYPE_HERO) and Y07!=null then
    call IssueTargetOrderById(MQD,851983,Y07)
    call GroupAddUnit(Y57,MQD)
  endif
  call EnableTrigger(GetTriggeringTrigger())
  set Y17=null
  set Y07=null
  set MQD=null
  set Target=null
  set g=null
endfunction

function RYD takes nothing returns nothing
  if GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)<1 then
    call GroupRemoveUnit(Y57,GetEnumUnit())
  endif
  if GetUnitCurrentOrder(GetEnumUnit())!=851983then
    call GroupRemoveUnit(Y57,GetEnumUnit())
    call IssuePointOrderByIdLoc(GetEnumUnit(),851983,WaypointLocations[GetUnitAbilityLevel(GetEnumUnit(),WaypointAbilID)])
  endif
endfunction

function RZD takes nothing returns boolean
  call ForGroup(Y57,function RYD)
  return false
endfunction

function RAD takes string s returns nothing
  set Z77=Z77+1
  set Z87[Z77]=s
endfunction

function RBD takes nothing returns boolean
  local integer i=1
  loop
    exitwhen i>Z77
    call ExeFunc(Z87[i])
    set i=i+1
  endloop
  call ExeFunc("V59")
  call ExeFunc("D7D")
  return false
endfunction

function RCD takes unit Hero returns nothing
  local trigger t=CreateTrigger()
  call SaveBoolean(hashtable019,(GetHandleId(GetTriggerUnit())),(38),(true))
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function RBD))
  set t=null
endfunction

function R3D takes nothing returns boolean
  if b_isPickTime==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) and GetUnitTypeId(GetTriggerUnit())!='H0B8' and GetUnitTypeId(GetTriggerUnit())!='H00M' and GetUnitTypeId(GetTriggerUnit())!='H07G' and GetUnitTypeId(GetTriggerUnit())!='H00Y' and IsUnitIllusion(GetTriggerUnit())==false and HaveSavedBoolean(hashtable019,GetHandleId(GetTriggerUnit()),38)==false then
    if HeroDamageTracking_Enabled and(GetUnitTypeId(GetTriggerUnit())!='O00P' or(GetUnitTypeId(GetTriggerUnit())=='O00P' and Z47))then
      call RCD(GetTriggerUnit())
    endif
  endif
  return false
endfunction

function R6D takes nothing returns boolean
  local unit u
  local real RLD
  local boolean R1D=IsDayTime()
  set u=EK7
  if u!=null and GetUnitState(u,UNIT_STATE_LIFE)>1 then
    set RLD=GetUnitState(u,UNIT_STATE_MANA)
    if R1D then
      set RLD=RMaxIF(RLD-25,0)
    else
      set RLD=RMinIF(RLD+5,300)
    endif
    call SetUnitState(u,UNIT_STATE_MANA,RLD)
  endif
  set u=EM7
  if u!=null and GetUnitState(u,UNIT_STATE_LIFE)>1 then
    set RLD=GetUnitState(u,UNIT_STATE_MANA)
    if R1D then
      set RLD=RMaxIF(RLD-25,0)
    else
      set RLD=RMinIF(RLD+5,300)
    endif
    call SetUnitState(u,UNIT_STATE_MANA,RLD)
  endif
  set u=EN7
  if u!=null and GetUnitState(u,UNIT_STATE_LIFE)>1 then
    set RLD=GetUnitState(u,UNIT_STATE_MANA)
    if R1D then
      set RLD=RMaxIF(RLD-25,0)
    else
      set RLD=RMinIF(RLD+5,300)
    endif
    call SetUnitState(u,UNIT_STATE_MANA,RLD)
  endif
  set u=EO7
  if u!=null and GetUnitState(u,UNIT_STATE_LIFE)>1 then
    set RLD=GetUnitState(u,UNIT_STATE_MANA)
    if R1D then
      set RLD=RMaxIF(RLD-25,0)
    else
      set RLD=RMinIF(RLD+5,300)
    endif
    call SetUnitState(u,UNIT_STATE_MANA,RLD)
  endif
  set u=EP7
  if u!=null and GetUnitState(u,UNIT_STATE_LIFE)>1 then
    set RLD=GetUnitState(u,UNIT_STATE_MANA)
    if R1D then
      set RLD=RMaxIF(RLD-25,0)
    else
      set RLD=RMinIF(RLD+5,300)
    endif
    call SetUnitState(u,UNIT_STATE_MANA,RLD)
  endif
  set u=EQ7
  if u!=null and GetUnitState(u,UNIT_STATE_LIFE)>1 then
    set RLD=GetUnitState(u,UNIT_STATE_MANA)
    if R1D then
      set RLD=RMaxIF(RLD-25,0)
    else
      set RLD=RMinIF(RLD+5,300)
    endif
    call SetUnitState(u,UNIT_STATE_MANA,RLD)
  endif
  set u=ER7
  if u!=null and GetUnitState(u,UNIT_STATE_LIFE)>1 then
    set RLD=GetUnitState(u,UNIT_STATE_MANA)
    if R1D then
      set RLD=RMaxIF(RLD-25,0)
    else
      set RLD=RMinIF(RLD+5,300)
    endif
    call SetUnitState(u,UNIT_STATE_MANA,RLD)
  endif
  set u=ES7
  if u!=null and GetUnitState(u,UNIT_STATE_LIFE)>1 then
    set RLD=GetUnitState(u,UNIT_STATE_MANA)
    if R1D then
      set RLD=RMaxIF(RLD-25,0)
    else
      set RLD=RMinIF(RLD+5,300)
    endif
    call SetUnitState(u,UNIT_STATE_MANA,RLD)
  endif
  set u=ET7
  if u!=null and GetUnitState(u,UNIT_STATE_LIFE)>1 then
    set RLD=GetUnitState(u,UNIT_STATE_MANA)
    if R1D then
      set RLD=RMaxIF(RLD-25,0)
    else
      set RLD=RMinIF(RLD+5,300)
    endif
    call SetUnitState(u,UNIT_STATE_MANA,RLD)
  endif
  set u=EU7
  if u!=null and GetUnitState(u,UNIT_STATE_LIFE)>1 then
    set RLD=GetUnitState(u,UNIT_STATE_MANA)
    if R1D then
      set RLD=RMaxIF(RLD-25,0)
    else
      set RLD=RMinIF(RLD+5,300)
    endif
    call SetUnitState(u,UNIT_STATE_MANA,RLD)
  endif
  set u=EV7
  if u!=null and GetUnitState(u,UNIT_STATE_LIFE)>1 then
    set RLD=GetUnitState(u,UNIT_STATE_MANA)
    if R1D then
      set RLD=RMaxIF(RLD-25,0)
    else
      set RLD=RMinIF(RLD+5,300)
    endif
    call SetUnitState(u,UNIT_STATE_MANA,RLD)
  endif
  set u=null
  return false
endfunction

function R0D takes nothing returns boolean
  local real d
  if GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==false and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(tt_unit2)) then
    set d=DistanceBetweenXY(real084,real085,GetUnitX(GetFilterUnit()),GetUnitY(GetFilterUnit()))
    if d<tt_real1 then
      set tt_real1=d
      set tt_unit1=GetFilterUnit()
    endif
  endif
  return false
endfunction

function BootsOfTravel_TowersPriority takes nothing returns boolean
  local real d
  if IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE) and IsDead(GetFilterUnit())==false and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(tt_unit2)) then
    set d=DistanceBetweenXY(real084,real085,GetUnitX(GetFilterUnit()),GetUnitY(GetFilterUnit()))
    if d<tt_real1 then
      set tt_real1=d
      set tt_unit1=GetFilterUnit()
    endif
  endif
  return false
endfunction

function R5D takes unit whichUnit,real x,real y returns unit
  local group g=GetAvailableGroup()
  set tt_unit1=null
  set tt_unit2=whichUnit
  set tt_real1=99999
  set real084=x
  set real085=y
  call GroupEnumUnitsInRange(g,x,y,350,Condition(function BootsOfTravel_TowersPriority))
  if tt_unit1==null then
    set tt_unit1=null
    set tt_unit2=whichUnit
    set tt_real1=99999
    set real084=x
    set real085=y
    call GroupEnumUnitsInRange(g,x,y,2000,Condition(function R0D))
  endif
  call KillGroup(g)
  set g=null
  return tt_unit1
endfunction

function TeleportationEffect_Remove takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target
  if GetSpellAbilityId()=='A231' then
    set Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
    call UnitRemoveAbility(Target,'Binf')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  return false
endfunction

function R2D takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local real x
  local real y
  local unit Target=GetSpellTargetUnit()
  call AddTimedKeyToUnit(Hero,4256,1)
  if Target==null then
    set x=GetSpellTargetX()
    set y=GetSpellTargetY()
    if GetSpellAbilityId()=='A1R5' then
      set Target=G9D(Hero,x,y)
    else
      set Target=R5D(Hero,x,y)
    endif
    set x=GetUnitX(Target)
    set y=GetUnitY(Target)
  else
    set x=GetUnitX(GetSpellTargetUnit())
    set y=GetUnitY(GetSpellTargetUnit())
  endif
  if(IsUnitAlly(Hero,GetLocalPlayer())and GetLocalPlayer()!=GetOwningPlayer(Hero))or(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2))then
    call PingMinimapEx(x,y,3,255,255,255,false)
  endif
  set Hero=null
  set Target=null
endfunction

function TeleportationEffect_Main takes nothing returns boolean
  if GetSpellAbilityId()=='A231' then
    call R2D()
  endif
  return false
endfunction

function RestrictHeroes takes nothing returns nothing
  call TechHeroForAll('E02F')
  call TechHeroForAll('N00R')
  call TechHeroForAll('N0M0')
  call TechHeroForAll('E032')
  call TechHeroForAll('E02K')
  call TechHeroForAll('N0M7')
  call TechHeroForAll('N0MK')
  call TechHeroForAll('H0DO')
endfunction

function S7D takes nothing returns nothing
  if IsCourier(GetEnumUnit())and IsUnitAlly(GetEnumUnit(),Sentinels[0])==false and GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)>.5 then
    call UnitRemoveAbility(GetEnumUnit(),'B08H')
    call DamageTarget(SentFountain,GetEnumUnit(),2,500)
  endif
endfunction

function S8D takes nothing returns nothing
  if IsCourier(GetEnumUnit())and IsUnitAlly(GetEnumUnit(),Scourges[0])==false and GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)>.5 then
    call UnitRemoveAbility(GetEnumUnit(),'B08H')
    call DamageTarget(ScourgeFountain,GetEnumUnit(),2,500)
  endif
endfunction

function S9D takes nothing returns boolean
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,boolean036,Condition(function ReturnTrue2))
  call ForGroup(g,function S7D)
  call KillGroup(g)
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRect(g,Z5,Condition(function ReturnTrue2))
  call ForGroup(g,function S8D)
  call KillGroup(g)
  set g=null
  return false
endfunction

function SDD takes string winner returns nothing
  local integer i
  local player p
  local string id
  local integer YO8=R2I(TimerGetElapsed(GlobalTimer)-GameStartsTime)
  local integer Minutes=YO8/ 60-1/ 2
  local integer Seconds=ModuloInteger(YO8,60)
  
  // RMD Winners
  if winner=="1" then
    //31 = Slots 0-5
    call Traffic_RegisterCustomGlobalData("w","0",31)
  else
    //992 = Slots 6-10
    call Traffic_RegisterCustomGlobalData("w","0",992)
  endif
  
  call W18()
  set i=1
  loop
    exitwhen i>5
    set p=Sentinels[i]
    set id=I2S(GetPlayerId(p))
    call StoreInteger(MN,id,"1",(GlobalKillsCounter[GetPlayerId((p))]))
    call StoreInteger(MN,id,"2",(GlobalDeathCounter[GetPlayerId((p))]))
    call StoreInteger(MN,id,"3",(PlayerCS[GetPlayerId((p))]))
    call StoreInteger(MN,id,"4",(PlayerDenyCounter[GetPlayerId((p))]))
    call StoreInteger(MN,id,"5",(GlobalAssistsCounter[GetPlayerId((p))]))
    call StoreInteger(MN,id,"6",(GetPlayerState((p),PLAYER_STATE_RESOURCE_GOLD)))
    call StoreInteger(MN,id,"7",(LoadInteger(hashtable019,(400+GetPlayerId((p))),(79))))
    call StoreInteger(MN,id,"8_0",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(0)))))
    call StoreInteger(MN,id,"8_1",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(1)))))
    call StoreInteger(MN,id,"8_2",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(2)))))
    call StoreInteger(MN,id,"8_3",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(3)))))
    call StoreInteger(MN,id,"8_4",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(4)))))
    call StoreInteger(MN,id,"8_5",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(5)))))
    call StoreInteger(MN,id,"9",(GetUnitTypeId(udg_Hero[GetPlayerId((p))])))
    call StoreInteger(MN,id,"id",i)
    set p=Scourges[i]
    set id=I2S(GetPlayerId(p))
    call StoreInteger(MN,id,"1",(GlobalKillsCounter[GetPlayerId((p))]))
    call StoreInteger(MN,id,"2",(GlobalDeathCounter[GetPlayerId((p))]))
    call StoreInteger(MN,id,"3",(PlayerCS[GetPlayerId((p))]))
    call StoreInteger(MN,id,"4",(PlayerDenyCounter[GetPlayerId((p))]))
    call StoreInteger(MN,id,"5",(GlobalAssistsCounter[GetPlayerId((p))]))
    call StoreInteger(MN,id,"6",(GetPlayerState((p),PLAYER_STATE_RESOURCE_GOLD)))
    call StoreInteger(MN,id,"7",(LoadInteger(hashtable019,(400+GetPlayerId((p))),(79))))
    call StoreInteger(MN,id,"8_0",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(0)))))
    call StoreInteger(MN,id,"8_1",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(1)))))
    call StoreInteger(MN,id,"8_2",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(2)))))
    call StoreInteger(MN,id,"8_3",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(3)))))
    call StoreInteger(MN,id,"8_4",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(4)))))
    call StoreInteger(MN,id,"8_5",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(5)))))
    call StoreInteger(MN,id,"9",(GetUnitTypeId(udg_Hero[GetPlayerId((p))])))
    call StoreInteger(MN,id,"id",i+5)
    if GetLocalPlayer()==PlayerModeTyper then
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"1")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"2")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"3")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"4")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"5")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"6")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"7")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"8_0")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"8_1")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"8_2")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"8_3")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"8_4")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"8_5")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"9")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"id")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"1")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"2")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"3")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"4")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"5")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"6")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"7")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"8_0")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"8_1")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"8_2")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"8_3")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"8_4")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"8_5")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"9")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"id")
    endif
    set i=i+1
  endloop
  if Z97==false then
    call StoreInteger(MN,"Global","Winner",ZD7)
    call StoreInteger(MN,"Global","m",Minutes)
    call StoreInteger(MN,"Global","s",Seconds)
    if GetLocalPlayer()==PlayerModeTyper then
      call SyncStoredInteger(MN,"Global","Winner")
      call SyncStoredInteger(MN,"Global","m")
      call SyncStoredInteger(MN,"Global","s")
    endif
  endif
  set p=null
endfunction

function I09 takes nothing returns nothing
  call SDD("1")
endfunction

function I19 takes nothing returns nothing
  local player p=ZE7
  local string id=I2S(GetPlayerId(p))
  call StoreInteger(MN,id,"8_0",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(0)))))
  call StoreInteger(MN,id,"8_1",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(1)))))
  call StoreInteger(MN,id,"8_2",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(2)))))
  call StoreInteger(MN,id,"8_3",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(3)))))
  call StoreInteger(MN,id,"8_4",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(4)))))
  call StoreInteger(MN,id,"8_5",(GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId((p))],(5)))))
  if GetLocalPlayer()==PlayerModeTyper then
    call SyncStoredInteger(MN,I2S(GetPlayerId(p)),"8_0")
    call SyncStoredInteger(MN,I2S(GetPlayerId(p)),"8_1")
    call SyncStoredInteger(MN,I2S(GetPlayerId(p)),"8_2")
    call SyncStoredInteger(MN,I2S(GetPlayerId(p)),"8_3")
    call SyncStoredInteger(MN,I2S(GetPlayerId(p)),"8_4")
    call SyncStoredInteger(MN,I2S(GetPlayerId(p)),"8_5")
  endif
  set p=null
endfunction

function SED takes nothing returns boolean
  call ExeFunc("PQD")
  return false
endfunction

function SFD takes nothing returns nothing
  call V78(GetEnumUnit())
endfunction

function SGD takes nothing returns nothing
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,0,0,12000,Condition(function LR8))
  call ForGroup(g,function SFD)
  call KillGroup(g)
  set g=null
endfunction

//function PidToChar takes integer i returns string
//	if i==10 then
//		return ":"
//	elseif i==11 then
//		return ";"
//	endif
//	return I2S(i)
//endfunction

function SHD takes nothing returns nothing
  local integer i=1
  local player p
  set bj_changeLevelShowScores=true
  call DisableTrigger(trigger024)
  call DisableTrigger(trigger025)
  call ExeFunc("L99")
  if udg_ObserverMode then
    call DisableTrigger(X37)
  endif
  call DisableTrigger(TriggerUpdateGameTime)
  call ClearTextMessages()
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,60,string021+" "+GetObjectName('n054')+" www.legendsofdota.com.")
  set GameEnded=true
  call AD8()
  call DisableTrigger(integers004)
  call DisableTrigger(trigger022)
  call DisableTrigger(TriggerGoldPerSecond)
  // RMD - Stats
  call RMD_SendStats()
  
  call UD8()
endfunction

function SID takes nothing returns nothing
  local trigger t=CreateTrigger()
  call PanCameraToTimed(GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),0)
  call TriggerRegisterTimerEvent(t,2.5,false)
  call TriggerAddCondition(t,Condition(function SED))
  set ZD7=2
  set string021="|c0020c000"+GetObjectName('n03O')+"|r"
  call SHD()
  call SGD()
  call SDD("2")
  set t=null
endfunction

function SJD takes nothing returns boolean
  call SetUnitVertexColorBJ(FrozenThrone,100,100,100,GetTriggerEvalCount(GetTriggeringTrigger()))
  if GetTriggerEvalCount(GetTriggeringTrigger())==100 then
    call ShowUnit(FrozenThrone,false)
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function SKD takes nothing returns nothing
  local trigger t=CreateTrigger()
  call PanCameraToTimed(GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),0)
  call TriggerRegisterTimerEvent(t,1.5,false)
  call TriggerAddCondition(t,Condition(function SED))
  set ZD7=1
  set string021="|c00ff0303"+GetObjectName('n03N')+"|r"
  call SHD()
  call SGD()
  call SDD("1")
  call AddSpecialEffect("war3mapImported\\FrozenThronesDeath2.mdx",GetUnitX(FrozenThrone)+150,GetUnitY(FrozenThrone)+100)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function SJD))
  set t=null
endfunction

function SMD takes real Y08 returns boolean
  return(100*GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)/ GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_LIFE))<Y08
endfunction

function SND takes nothing returns boolean
  return(SMD(10)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE) and GetUnitTypeId(GetTriggerUnit())!='etol' and GetUnitTypeId(GetTriggerUnit())!='unpl')!=null
endfunction

function AntiTK_Hero takes nothing returns boolean
  return SMD(25)and(GetUnitAbilityLevel(GetTriggerUnit(),'BNdo')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'BEsh')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B001')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B0AQ')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B0AP')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B05D')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B05M')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B05N')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B05O')>0)
endfunction

function AntiTK_Creep takes nothing returns boolean
  return(SMD(50)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==false and(IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false or GetUnitTypeId(GetTriggerUnit())=='ebal' or GetUnitTypeId(GetTriggerUnit())=='e026' or GetUnitTypeId(GetTriggerUnit())=='umtw' or GetUnitTypeId(GetTriggerUnit())=='u00R'))!=null
endfunction

function AntiTK_Exception takes nothing returns boolean
  return GetUnitTypeId(GetTriggerUnit())=='u00S' or GetUnitTypeId(GetTriggerUnit())=='o01V'
endfunction

function SOD takes nothing returns nothing
  if not((SMD(10)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE) and GetUnitTypeId(GetTriggerUnit())!='etol' and GetUnitTypeId(GetTriggerUnit())!='unpl')or(SMD(25)and(GetUnitAbilityLevel(GetTriggerUnit(),'BNdo')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'BEsh')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B001')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B0AQ')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B0AP')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B05D')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B05M')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B05N')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B05O')>0))or(SMD(50)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==false and(IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false or GetUnitTypeId(GetTriggerUnit())=='ebal' or GetUnitTypeId(GetTriggerUnit())=='e026' or GetUnitTypeId(GetTriggerUnit())=='umtw' or GetUnitTypeId(GetTriggerUnit())=='u00R'))or(GetUnitTypeId(GetTriggerUnit())=='u00S' or GetUnitTypeId(GetTriggerUnit())=='o01V') or (LoadInteger(hashtable019,GetHandleId(GetAttacker()),4328)==1)==true) then
    call IssueImmediateOrderById(GetAttacker(),851972)
  endif
endfunction

function SPD takes nothing returns boolean
  
  if IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))then
    call SOD()
  elseif IsUnitType(GetAttacker(),UNIT_TYPE_HERO) or IsSpiritBear(GetAttacker())then
    set ZF7=GetPlayerId(GetOwningPlayer(GetAttacker()))
    if HasItem_Javelin[ZF7]>0 and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(GetTriggerUnit())!='n00L' and IsUnitIllusion(GetAttacker())==false and EM9(GetAttacker(),Item_Real[indexid_javelin]) then
      call DND()
    endif
    if HasItem_CraniumBasher[ZF7]>0 and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitIllusion(GetAttacker())==false and(EM9(GetAttacker(),Item_Real[indexid_CraniumBasher]) or EM9(GetAttacker(),Item_Real[indexid_AbyssalBlade]))then
      call DZD()
    endif
    if HasItem_SangeNYasha[ZF7]>0 and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitIllusion(GetAttacker())==false and EM9(GetAttacker(),Item_Real[indexid_SangeAndYasha]) then
      call DUD()
    elseif(HasItem_Sange[ZF7]>0 or HasItem_HeavensHalberd[ZF7]>0)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitIllusion(GetAttacker())==false and(EM9(GetAttacker(),Item_Real[indexid_Sange]) or EM9(GetAttacker(),Item_Real[indexid_HeavensHalberd]))then
      call DYD()
    endif
  elseif GetUnitAbilityLevel(GetAttacker(),'A17S')>0 and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false then
    call RXD()
  endif
  return false
endfunction

function SQD takes nothing returns nothing
  call Z99()
  call ZE9()
endfunction

function SRD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT or(LoadBoolean(hashtable019,(GetHandleId(Hero)),(140))) then
    if(LoadBoolean(hashtable019,(GetHandleId(Hero)),(140))) then
      call SaveBoolean(hashtable019,(GetHandleId(Hero)),(140),(false))
      call SaveInteger(hashtable019,(GetHandleId((Hero))),((4259)),(2))
      call UnitRemoveAbility(Hero,'A04R')
      call SetUnitInvulAdvanced(Hero,false)
      call PauseUnit(Hero,false)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    elseif GetSpellTargetUnit()==Hero and GetSpellAbilityId()==ZH7 and(GetPlayerSlotState(GetOwningPlayer((Hero)))==PLAYER_SLOT_STATE_LEFT)and((LoadInteger(hashtable019,(GetHandleId((Hero))),((4259))))==1) then
      call SaveInteger(hashtable019,(GetHandleId((Hero))),((4259)),(2))
      call UnitRemoveAbility(Hero,'A04R')
      call SetUnitInvulAdvanced(Hero,false)
      call PauseUnit(Hero,false)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  elseif IsDead(Hero)==false then
    call SetUnitX(Hero,x)
    call SetUnitY(Hero,y)
    call SaveInteger(hashtable019,(GetHandleId((Hero))),((4259)),(1))
    call UnitAddAbility(Hero,'A04R')
    call SetUnitInvulAdvanced(Hero,true)
    call PauseUnit(Hero,true)
  endif
  set Hero=null
  set t=null
  return false
endfunction

function SSD takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetSpellTargetUnit()
  call SaveBoolean(hashtable019,(GetHandleId(Hero)),(140),(false))
  call SaveInteger(hashtable019,(GetHandleId((Hero))),((4259)),(1))
  call UnitAddAbility(Hero,'A04R')
  call SetUnitInvulAdvanced(Hero,true)
  call PauseUnit(Hero,true)
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Hero))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Hero))*1.))
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function SRD))
  set t=null
  set Hero=null
endfunction

function STD takes nothing returns boolean
  if GetSpellAbilityId()==ZG7 and(GetPlayerSlotState(GetOwningPlayer((GetSpellTargetUnit())))==PLAYER_SLOT_STATE_LEFT)and((LoadInteger(hashtable019,(GetHandleId((GetSpellTargetUnit()))),((4259))))==1)==false then
    call SSD()
  elseif(GetSpellAbilityId()==ZH7 or GetSpellAbilityId()==ZG7)and(GetPlayerSlotState(GetOwningPlayer((GetSpellTargetUnit())))==PLAYER_SLOT_STATE_LEFT)==false then
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n02N'))
  endif
  if GetSpellAbilityId()=='AIpg' or GetSpellAbilityId()=='A1SA' or GetSpellAbilityId()=='A2T2' or GetSpellAbilityId()=='A2TN' then
    call ExeFunc("OnPurge")
  endif
  return false
endfunction

function SUD takes destructable d returns boolean
  local real x=GetDestructableX(d)
  local real y=GetDestructableY(d)
  local group g=GetAvailableGroup()
  local boolean SVD
  call GroupEnumUnitsInRange(g,x,y,250,Condition(function DI9))
  set SVD=FirstOfGroup(g)!=null
  call KillGroup(g)
  set g=null
  return SVD
endfunction

function SWD takes nothing returns nothing
  if WA8(GetEnumDestructable())and GetDestructableLife(GetEnumDestructable())<1 and GetDestructableTypeId(GetEnumDestructable())!='B002' and GetDestructableTypeId(GetEnumDestructable())!='B003' then
    if SUD(GetEnumDestructable())==false then
      call DestructableRestoreLife(GetEnumDestructable(),GetDestructableMaxLife(GetEnumDestructable()),false)
      if SL[GetPlayerId(GetLocalPlayer())]==1 and GetDestructableTypeId(GetEnumDestructable())=='ATtr' then
        call SetDestructableAnimation(GetEnumDestructable(),"stand alternate")
      endif
    endif
  endif
endfunction

function SXD takes nothing returns nothing
  call EnumDestructablesInRectAll(bj_mapInitialPlayableArea,function SWD)
endfunction

function SYD takes nothing returns boolean
  if GetUnitTypeId(GetTriggerUnit())=='n00L' then
    if IsUnitIllusion(GetAttacker()) then
      call KillUnit(GetAttacker())
    elseif IsUnitInRegion(ZJ7,GetAttacker())==false then
      call Error(GetOwningPlayer(GetAttacker()),GetObjectName('n035'))
      call IssueImmediateOrderById(GetAttacker(),851972)
    endif
  endif
  return false
endfunction

function SZD takes nothing returns boolean
  return GetUnitTypeId(GetEnteringUnit())=='e00E' or GetUnitTypeId(GetEnteringUnit())=='e022'
endfunction

function SAD takes nothing returns nothing
  call ShowUnitHide(GetEnteringUnit())
  call SetUnitPathing(GetEnteringUnit(),false)
  call SetUnitInvulnerable(GetEnteringUnit(),true)
  call UnitApplyTimedLifeBJ(20.,'BTLF',GetEnteringUnit())
endfunction

function SBD takes nothing returns boolean
  return(GetUnitTypeId(GetDyingUnit())=='e00R')or(GetUnitTypeId(GetDyingUnit())=='e011')or(GetUnitTypeId(GetDyingUnit())=='e00S')or(GetUnitTypeId(GetDyingUnit())=='e019')
endfunction

function SCD takes nothing returns boolean
  return(GetDyingUnit()==E97)and(IsDead(ED7))
endfunction

function S3D takes nothing returns boolean
  return(GetDyingUnit()==ED7)and(IsDead(E97))
endfunction

function S6D takes nothing returns nothing
  if IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit()))then
    set PlayerTowersKilled[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerTowersKilled[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
  endif
  if(GetDyingUnit()==SQ)then
    call Traffic_RegisterData("Tower"+I2S(0)+I2S(1)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(boolean031,false)
    call WF8(GetKillingUnit(),1)
  endif
  if(GetDyingUnit()==TQ)then
    call Traffic_RegisterData("Tower"+I2S(0)+I2S(1)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(integer027,false)
    call WF8(GetKillingUnit(),1)
  endif
  if(GetDyingUnit()==integer025)then
    call Traffic_RegisterData("Tower"+I2S(0)+I2S(1)+I2S(2),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(string005,false)
    call WF8(GetKillingUnit(),1)
  endif
  if(GetDyingUnit()==boolean031)then
    call Traffic_RegisterData("Tower"+I2S(0)+I2S(2)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(E47,false)
    call WF8(GetKillingUnit(),2)
  endif
  if(GetDyingUnit()==integer027)then
    call Traffic_RegisterData("Tower"+I2S(0)+I2S(2)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(E77,false)
    call WF8(GetKillingUnit(),2)
  endif
  if(GetDyingUnit()==string005)then
    call Traffic_RegisterData("Tower"+I2S(0)+I2S(2)+I2S(2),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(E87,false)
    call WF8(GetKillingUnit(),2)
  endif
  if(GetDyingUnit()==E47)then
    call Traffic_RegisterData("Tower"+I2S(0)+I2S(3)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call WF8(GetKillingUnit(),3)
    call SetUnitInvulAdvanced(EE7,false)
    call SetUnitInvulAdvanced(EH7,false)
    call SetUnitInvulAdvanced(E97,false)
    call SetUnitInvulAdvanced(ED7,false)
    call SetUnitInvulAdvanced(EW7,false)
    call SetUnitInvulAdvanced(EX7,false)
    call SetUnitInvulAdvanced(EY7,false)
    call SetUnitInvulAdvanced(EZ7,false)
    call SetUnitInvulAdvanced(EK7,false)
    call SetUnitInvulAdvanced(EM7,false)
    call SetUnitInvulAdvanced(EN7,false)
    call SetUnitInvulAdvanced(EO7,false)
    call SetUnitInvulAdvanced(EP7,false)
    call SetUnitInvulAdvanced(EQ7,false)
    call SetUnitInvulAdvanced(ER7,false)
    call SetUnitInvulAdvanced(ES7,false)
    call SetUnitInvulAdvanced(ET7,false)
    call SetUnitInvulAdvanced(EU7,false)
    call SetUnitInvulAdvanced(EV7,false)
  endif
  if(GetDyingUnit()==E77)then
    call Traffic_RegisterData("Tower"+I2S(0)+I2S(3)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call WF8(GetKillingUnit(),3)
    call SetUnitInvulAdvanced(EF7,false)
    call SetUnitInvulAdvanced(EI7,false)
    call SetUnitInvulAdvanced(E97,false)
    call SetUnitInvulAdvanced(ED7,false)
    call SetUnitInvulAdvanced(EW7,false)
    call SetUnitInvulAdvanced(EX7,false)
    call SetUnitInvulAdvanced(EY7,false)
    call SetUnitInvulAdvanced(EZ7,false)
    call SetUnitInvulAdvanced(EK7,false)
    call SetUnitInvulAdvanced(EM7,false)
    call SetUnitInvulAdvanced(EN7,false)
    call SetUnitInvulAdvanced(EO7,false)
    call SetUnitInvulAdvanced(EP7,false)
    call SetUnitInvulAdvanced(EQ7,false)
    call SetUnitInvulAdvanced(ER7,false)
    call SetUnitInvulAdvanced(ES7,false)
    call SetUnitInvulAdvanced(ET7,false)
    call SetUnitInvulAdvanced(EU7,false)
    call SetUnitInvulAdvanced(EV7,false)
  endif
  if(GetDyingUnit()==E87)then
    call Traffic_RegisterData("Tower"+I2S(0)+I2S(3)+I2S(2),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call WF8(GetKillingUnit(),3)
    call SetUnitInvulAdvanced(EG7,false)
    call SetUnitInvulAdvanced(EJ7,false)
    call SetUnitInvulAdvanced(E97,false)
    call SetUnitInvulAdvanced(ED7,false)
    call SetUnitInvulAdvanced(EW7,false)
    call SetUnitInvulAdvanced(EX7,false)
    call SetUnitInvulAdvanced(EY7,false)
    call SetUnitInvulAdvanced(EZ7,false)
    call SetUnitInvulAdvanced(EK7,false)
    call SetUnitInvulAdvanced(EM7,false)
    call SetUnitInvulAdvanced(EN7,false)
    call SetUnitInvulAdvanced(EO7,false)
    call SetUnitInvulAdvanced(EP7,false)
    call SetUnitInvulAdvanced(EQ7,false)
    call SetUnitInvulAdvanced(ER7,false)
    call SetUnitInvulAdvanced(ES7,false)
    call SetUnitInvulAdvanced(ET7,false)
    call SetUnitInvulAdvanced(EU7,false)
    call SetUnitInvulAdvanced(EV7,false)
  endif
  if GetDyingUnit()==E97 or GetDyingUnit()==ED7 then
    call Traffic_RegisterData("Tower"+I2S(0)+I2S(4)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call WF8(GetKillingUnit(),4)
  endif
  if(SCD())then
    call SetUnitInvulAdvanced(NQ,false)
  endif
  if(S3D())then
    call SetUnitInvulAdvanced(NQ,false)
  endif
endfunction

function SLD takes nothing returns boolean
  return(GetUnitTypeId(GetDyingUnit())=='u00M')or(GetUnitTypeId(GetDyingUnit())=='u00D')or(GetUnitTypeId(GetDyingUnit())=='u00N')or(GetUnitTypeId(GetDyingUnit())=='u00T')
endfunction

function S1D takes nothing returns boolean
  return(GetDyingUnit()==Towers_Scourge_Throne1)and(IsDead(Towers_Scourge_Throne2))
endfunction

function S0D takes nothing returns boolean
  return(GetDyingUnit()==Towers_Scourge_Throne2)and(IsDead(Towers_Scourge_Throne1))
endfunction

function S5D takes nothing returns nothing
  if IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetKillingUnit()))then
    set PlayerTowersKilled[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]=PlayerTowersKilled[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]+1
  endif
  if(GetDyingUnit()==Towers_Scourge_Top_1)then
    call Traffic_RegisterData("Tower"+I2S(1)+I2S(1)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(Towers_Scourge_Top_2,false)
    call WF8(GetKillingUnit(),1)
  endif
  if(GetDyingUnit()==Towers_Scourge_Mid_1)then
    call Traffic_RegisterData("Tower"+I2S(1)+I2S(1)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(Towers_Scourge_Mid_2,false)
    call WF8(GetKillingUnit(),1)
  endif
  if(GetDyingUnit()==Towers_Scourge_Bot_1)then
    call Traffic_RegisterData("Tower"+I2S(1)+I2S(1)+I2S(2),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(Towers_Scourge_Bot_2,false)
    call WF8(GetKillingUnit(),1)
  endif
  if(GetDyingUnit()==Towers_Scourge_Top_2)then
    call Traffic_RegisterData("Tower"+I2S(1)+I2S(2)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(Towers_Scourge_Top_3,false)
    call WF8(GetKillingUnit(),2)
  endif
  if(GetDyingUnit()==Towers_Scourge_Mid_2)then
    call Traffic_RegisterData("Tower"+I2S(1)+I2S(2)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(Towers_Scourge_Mid_3,false)
    call WF8(GetKillingUnit(),2)
  endif
  if(GetDyingUnit()==Towers_Scourge_Bot_2)then
    call Traffic_RegisterData("Tower"+I2S(1)+I2S(2)+I2S(2),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call SetUnitInvulAdvanced(Towers_Scourge_Bot_3,false)
    call WF8(GetKillingUnit(),2)
  endif
  if(GetDyingUnit()==Towers_Scourge_Top_3)then
    call Traffic_RegisterData("Tower"+I2S(1)+I2S(3)+I2S(0),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call WF8(GetKillingUnit(),3)
    call SetUnitInvulAdvanced(HL7,false)
    call SetUnitInvulAdvanced(H57,false)
    call SetUnitInvulAdvanced(Towers_Scourge_Throne1,false)
    call SetUnitInvulAdvanced(Towers_Scourge_Throne2,false)
    call SetUnitInvulAdvanced(IM7,false)
    call SetUnitInvulAdvanced(IN7,false)
    call SetUnitInvulAdvanced(IO7,false)
    call SetUnitInvulAdvanced(IP7,false)
    call SetUnitInvulAdvanced(I77,false)
    call SetUnitInvulAdvanced(I87,false)
    call SetUnitInvulAdvanced(I97,false)
    call SetUnitInvulAdvanced(ID7,false)
    call SetUnitInvulAdvanced(IE7,false)
    call SetUnitInvulAdvanced(IF7,false)
    call SetUnitInvulAdvanced(IG7,false)
    call SetUnitInvulAdvanced(IH7,false)
    call SetUnitInvulAdvanced(II7,false)
    call SetUnitInvulAdvanced(IJ7,false)
    call SetUnitInvulAdvanced(IK7,false)
  endif
  if(GetDyingUnit()==Towers_Scourge_Mid_3)then
    call Traffic_RegisterData("Tower"+I2S(1)+I2S(3)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call WF8(GetKillingUnit(),3)
    call SetUnitInvulAdvanced(H17,false)
    call SetUnitInvulAdvanced(H27,false)
    call SetUnitInvulAdvanced(Towers_Scourge_Throne1,false)
    call SetUnitInvulAdvanced(Towers_Scourge_Throne2,false)
    call SetUnitInvulAdvanced(IM7,false)
    call SetUnitInvulAdvanced(IN7,false)
    call SetUnitInvulAdvanced(IO7,false)
    call SetUnitInvulAdvanced(IP7,false)
    call SetUnitInvulAdvanced(I77,false)
    call SetUnitInvulAdvanced(I87,false)
    call SetUnitInvulAdvanced(I97,false)
    call SetUnitInvulAdvanced(ID7,false)
    call SetUnitInvulAdvanced(IE7,false)
    call SetUnitInvulAdvanced(IF7,false)
    call SetUnitInvulAdvanced(IG7,false)
    call SetUnitInvulAdvanced(IH7,false)
    call SetUnitInvulAdvanced(II7,false)
    call SetUnitInvulAdvanced(IJ7,false)
    call SetUnitInvulAdvanced(IK7,false)
  endif
  if(GetDyingUnit()==Towers_Scourge_Bot_3)then
    call Traffic_RegisterData("Tower"+I2S(1)+I2S(3)+I2S(2),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call WF8(GetKillingUnit(),3)
    call SetUnitInvulAdvanced(H07,false)
    call SetUnitInvulAdvanced(I47,false)
    call SetUnitInvulAdvanced(Towers_Scourge_Throne1,false)
    call SetUnitInvulAdvanced(Towers_Scourge_Throne2,false)
    call SetUnitInvulAdvanced(IM7,false)
    call SetUnitInvulAdvanced(IN7,false)
    call SetUnitInvulAdvanced(IO7,false)
    call SetUnitInvulAdvanced(IP7,false)
    call SetUnitInvulAdvanced(I77,false)
    call SetUnitInvulAdvanced(I87,false)
    call SetUnitInvulAdvanced(I97,false)
    call SetUnitInvulAdvanced(ID7,false)
    call SetUnitInvulAdvanced(IE7,false)
    call SetUnitInvulAdvanced(IF7,false)
    call SetUnitInvulAdvanced(IG7,false)
    call SetUnitInvulAdvanced(IH7,false)
    call SetUnitInvulAdvanced(II7,false)
    call SetUnitInvulAdvanced(IJ7,false)
    call SetUnitInvulAdvanced(IK7,false)
  endif
  if GetDyingUnit()==Towers_Scourge_Throne1 or GetDyingUnit()==Towers_Scourge_Throne2 then
    call Traffic_RegisterData("Tower"+I2S(1)+I2S(4)+I2S(1),GetPlayerId(GetOwningPlayer(GetKillingUnit())))
    call WF8(GetKillingUnit(),4)
  endif
  if(S1D())then
    call SetUnitInvulAdvanced(FrozenThrone,false)
  endif
  if(S0D())then
    call SetUnitInvulAdvanced(FrozenThrone,false)
  endif
endfunction

function S2D takes nothing returns boolean
  local integer x=0
  if GetPlayerSlotState(Sentinels[1])==PLAYER_SLOT_STATE_EMPTY then
    set x=x+1
  endif
  if GetPlayerSlotState(Sentinels[2])==PLAYER_SLOT_STATE_EMPTY then
    set x=x+1
  endif
  if GetPlayerSlotState(Sentinels[3])==PLAYER_SLOT_STATE_EMPTY then
    set x=x+1
  endif
  if GetPlayerSlotState(Sentinels[4])==PLAYER_SLOT_STATE_EMPTY then
    set x=x+1
  endif
  if GetPlayerSlotState(Sentinels[5])==PLAYER_SLOT_STATE_EMPTY then
    set x=x+1
  endif
  if GetPlayerSlotState(Scourges[1])==PLAYER_SLOT_STATE_EMPTY then
    set x=x+1
  endif
  if GetPlayerSlotState(Scourges[2])==PLAYER_SLOT_STATE_EMPTY then
    set x=x+1
  endif
  if GetPlayerSlotState(Scourges[3])==PLAYER_SLOT_STATE_EMPTY then
    set x=x+1
  endif
  if GetPlayerSlotState(Scourges[4])==PLAYER_SLOT_STATE_EMPTY then
    set x=x+1
  endif
  if GetPlayerSlotState(Scourges[5])==PLAYER_SLOT_STATE_EMPTY then
    set x=x+1
  endif
  return x==9
endfunction

function SinglePlayer_Condition takes nothing returns boolean
  return bj_isSinglePlayer and S2D()
endfunction

function Testmode_Spawnon takes nothing returns nothing
  set ZK7=false
endfunction

function Testmode_Roshan takes nothing returns nothing
  set ZM7=true
endfunction

function Testmode_Spawnoff takes nothing returns nothing
  set ZK7=true
endfunction

function Testmode_NHL takes nothing returns nothing
  set NoHeroLimitOff=false
endfunction

function TDD takes nothing returns boolean
  if IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false then
    call KillUnit(GetFilterUnit())
  endif
  return false
endfunction

function Testmode_KillScrg takes nothing returns nothing
  local group g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,Scourges[0],Condition(function TDD))
  call KillGroup(g)
  set g=null
endfunction

function Testmode_KillSent takes nothing returns nothing
  local group g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,Sentinels[0],Condition(function TDD))
  call KillGroup(g)
  set g=null
endfunction

function TGD takes nothing returns boolean
  if GetUnitTypeId(GetFilterUnit())=='o004' or GetUnitTypeId(GetFilterUnit())=='oeye' then
    call KillUnit(GetFilterUnit())
  endif
  return false
endfunction

function Testmode_KillWards takes nothing returns nothing
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,0,0,9999,Condition(function TGD))
  call KillGroup(g)
  set g=null
endfunction

function Testmode_KillAll takes nothing returns nothing
  call Testmode_KillSent()
  call Testmode_KillScrg()
endfunction

function TJD takes nothing returns boolean
  if IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) then
    call SetHeroLevel(GetFilterUnit(),GetHeroLevel(GetFilterUnit())+IMaxIF(tt_int1,1),true)
  endif
  return false
endfunction

function Testmode_Lvlup takes nothing returns nothing
  local string TMD=SubString(GetEventPlayerChatString(),6,StringLength(GetEventPlayerChatString()))
  local integer Level=S2I(TMD)
  local group g=GetAvailableGroup()
  if Level<1 then
    set Level=1
  endif
  set tt_int1=Level
  call GroupEnumUnitsOfPlayer(g,GetTriggerPlayer(),Condition(function TJD))
  call KillGroup(g)
  set g=null
endfunction

function Testmode_Spawncreeps takes nothing returns nothing
  call TriggerExecute(integers004)
endfunction

function TOD takes nothing returns boolean
  local unit u = GetFilterUnit()
  
  if IsUnitType(u,UNIT_TYPE_HERO) then
    call UnitResetCooldown(u)
    call TimerStart(PrimaryUltiCooldownTimer[GetPlayerId((GetOwningPlayer(u)))],0,false,null)
    call TimerStart(SecondaryUltiCooldownTimer[GetPlayerId((GetOwningPlayer(u)))],0,false,null)
    call SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_MAX_LIFE))
    call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MAX_MANA))
  endif
  
  set u = null
  return false
endfunction

function Testmode_Refresh takes nothing returns nothing
  local group g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,GetTriggerPlayer(),Condition(function TOD))
  call KillGroup(g)
  set g=null
endfunction

function Testmode_Kill takes nothing returns nothing
  call KillUnit(udg_Hero[GetPlayerId(GetTriggerPlayer())])
endfunction

function Testmode_Time takes nothing returns nothing
  local string TSD=SubString(GetEventPlayerChatString(),5,StringLength(GetEventPlayerChatString()))
  local integer Time=S2I(TSD)
  if Time<0 or Time>24 then
    set Time=0
  endif
  call SetFloatGameState(GAME_STATE_TIME_OF_DAY,Time)
endfunction

function Testmode_Gold takes nothing returns nothing
  local string TUD=SubString(GetEventPlayerChatString(),5,StringLength(GetEventPlayerChatString()))
  local integer W98=S2I(TUD)
  call SetPlayerState(GetTriggerPlayer(),PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(GetTriggerPlayer(),PLAYER_STATE_RESOURCE_GOLD)+W98)
endfunction

function Testmode_Respawn takes nothing returns nothing
  local unit CE8=udg_Hero[GetPlayerId(GetTriggerPlayer())]
  local player WU9=GetTriggerPlayer()
  local location WQ9
  if IsScourge(WU9)then
    set WQ9=GetRectCenter(gg_rct_Hero_Creation_UD)
  else
    set WQ9=GetRectCenter(gg_rct_Hero_Creation_NE)
  endif
  if GameEnded==false and IsDead(CE8)then
    call J89(CE8,WU9,GetLocationX(WQ9),GetLocationY(WQ9),true)
    if WM9(CE8)==false or GetUnitAbilityLevel(CE8,'A0MW')==0 then
      call ReviveHeroLoc(CE8,WQ9,true)
    else
      call WP9(CE8,WQ9)
    endif
  endif
  call RemoveLocation(WQ9)
  set CE8=null
  set WU9=null
  set WQ9=null
endfunction

function Testmode_Dummy takes nothing returns nothing
  local unit Source=udg_Hero[GetPlayerId(GetTriggerPlayer())]
  local player TXD
  local unit TYD
  local real x=GetRectCenterX(rect070)
  local real y=GetRectCenterX(rect070)
  if IsScourge(GetOwningPlayer(Source))then
    set TXD=Sentinels[1]
  else
    set TXD=Scourges[1]
  endif
  //set TYD=CreateUnit(TXD,'H000',0,0,0)
  //call SetHeroLevel(TYD,10,false)
  set TYD=CreateUnit(Scourges[1],'H000',-400,-400,0)
  call SetHeroLevel(TYD,10,false)
  set udg_Hero[GetPlayerId(Scourges[1])]=TYD
  //	
  //	set TYD=CreateUnit(Scourges[2],'H000',0,0,0)
  //	call SetHeroLevel(TYD,10,false)
  //	set udg_Hero[GetPlayerId(Scourges[2])]=TYD
  //	
  //	set TYD=CreateUnit(Scourges[3],'H000',0,0,0)
  //	call SetHeroLevel(TYD,10,false)
  //	set udg_Hero[GetPlayerId(Scourges[3])]=TYD
  //	
  //	set TYD=CreateUnit(Scourges[4],'H000',0,0,0)
  //	call SetHeroLevel(TYD,10,false)
  //	set udg_Hero[GetPlayerId(Scourges[4])]=TYD
  //	
  //	set TYD=CreateUnit(Scourges[5],'H000',0,0,0)
  //	call SetHeroLevel(TYD,10,false)
  //	set udg_Hero[GetPlayerId(Scourges[5])]=TYD
  set Source=null
  set TYD=null
  set TXD=null
endfunction

function Testmode_Powerup takes nothing returns nothing
  call TriggerEvaluate(T47)
endfunction

function Testmode_Neutrals takes nothing returns nothing
  call TriggerEvaluate(trigger019)
endfunction

function Testmode_Trees takes nothing returns nothing
  call EnumDestructablesInRectAll(bj_mapInitialPlayableArea,function SWD)
endfunction

function TCD takes nothing returns boolean
  call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,60,"**** REMINDER ****")
  call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,60,"Single player commands enabled. You may use commands like -lvlup xx, -refresh, -spawncreeps, -powerup, -neutrals, -kill, -gold xxxx, -time xx, -killsent, -killscourge, -killall, -noherolimit, -trees, -killwards, -spawnoff, -spawnon, -roshan, -respawn, -dummy")
  call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,60,"**** REMINDER ****")
  return false
endfunction

function T3D takes nothing returns nothing
  local player OnlyPlayer=PlayerModeTyper
  local trigger t
  set quest_test=true
  call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,60,"Single player commands enabled. You may use commands like -lvlup xx, -refresh, -spawncreeps, -powerup, -neutrals, -kill, -gold xxxx, -time xx, -killsent, -killscourge, -killall, -noherolimit, -trees, -killwards, -spawnoff, -spawnon, -roshan, -respawn, -dummy")
  set t=CreateTrigger()
  call TriggerAddCondition(t,Condition(function TCD))
  call TriggerRegisterTimerEvent(t,GetRandomReal(60,100),false)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-lvlup",false)
  call TriggerAddAction(t,function Testmode_Lvlup)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-spawncreeps",true)
  call TriggerRegisterPlayersChat(t,"-sc",true)
  call TriggerAddAction(t,function Testmode_Spawncreeps)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-refresh",true)
  call TriggerAddAction(t,function Testmode_Refresh)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-kill",true)
  call TriggerAddAction(t,function Testmode_Kill)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-gold",false)
  call TriggerAddAction(t,function Testmode_Gold)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-time",false)
  call TriggerAddAction(t,function Testmode_Time)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-powerup",true)
  call TriggerAddAction(t,function Testmode_Powerup)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-killall",true)
  call TriggerAddAction(t,function Testmode_KillAll)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-killsent",true)
  call TriggerAddAction(t,function Testmode_KillSent)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-killscourge",true)
  call TriggerAddAction(t,function Testmode_KillScrg)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-neutrals",true)
  call TriggerAddAction(t,function Testmode_Neutrals)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-noherolimit",true)
  call TriggerAddAction(t,function Testmode_NHL)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-trees",true)
  call TriggerAddAction(t,function Testmode_Trees)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-killwards",true)
  call TriggerAddAction(t,function Testmode_KillWards)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-spawnoff",true)
  call TriggerAddAction(t,function Testmode_Spawnoff)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-spawnon",true)
  call TriggerAddAction(t,function Testmode_Spawnon)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-roshan",true)
  call TriggerAddAction(t,function Testmode_Roshan)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-respawn",true)
  call TriggerAddAction(t,function Testmode_Respawn)
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-dummy",true)
  call TriggerAddAction(t,function Testmode_Dummy)
  set OnlyPlayer=null
  set t=null
endfunction

function T6D takes nothing returns boolean
  return not IsHeroesAvailable
endfunction

function TLD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Unit=(LoadUnitHandle(hashtable019,(Cache),(26)))
  if GetUnitTypeId(Unit)!='ncop' then
    call UnitResetCooldown(Unit)
    call SetUnitManaPercentBJ(Unit,100)
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Unit=null
  return false
endfunction

function T1D takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function TLD))
  call SaveUnitHandle(hashtable019,(Cache),(26),(GetTriggerUnit()))
  set t=null
endfunction

function T0D takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer T5D=CountPlayersInForce(Force_SentPlayers)+CountPlayersInForce(Force_ScourgePlayers)
  local integer NumRequired=IMinIF(T5D,T5D/ 2+1)
  local integer Cache=GetHandleId(t)
  if AQ7==false then
    set ZN7=true
    call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,60.," ")
    call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,90.,GetObjectName('n077'))
    call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,90.,GetObjectName('n078'))
    set t=CreateTrigger()
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
    call TriggerAddAction(t,function T1D)
  endif
  set t=null
endfunction

function T2D takes nothing returns boolean
  if V99(GetTriggerUnit())and IsUnitIllusion(GetTriggerUnit())==false then
    call GR9(GetOwningPlayer(GetTriggerUnit()))
    call Traffic_RegisterData("Level"+I2S(GetHeroLevel(GetTriggerUnit())),GetPlayerId(GetOwningPlayer(GetTriggerUnit())))
  endif
  return false
endfunction

function U4D takes nothing returns nothing
  if AQ7==false then
    call T3D()
    call CleanTrigger(GetTriggeringTrigger())
  endif
endfunction

function U7D takes nothing returns boolean
  if IsHeroesAvailable==false and(bj_isSinglePlayer and S2D())==false then
    call U4D()
  endif
  return false
endfunction

function U8D takes nothing returns boolean
  local integer i=0
  local real U9D
  local real UDD
  local real x
  local real y
  local boolean UED
  loop
    exitwhen i>11
    if GetLocalPlayer()==Player(i)then
      set U9D=GetCameraTargetPositionX()
      set UDD=GetCameraTargetPositionY()
    endif
    set i=i+1
  endloop
  set i=0
  call PauseGame(true)
  call TriggerSleepAction(0)
  loop
    exitwhen i>11
    if GetLocalPlayer()==Player(i)then
      call SetCameraPosition(U9D+1,UDD+1)
    endif
    set i=i+1
  endloop
  call TriggerSleepAction(0)
  call PauseGame(false)
  set i=0
  loop
    exitwhen i>11
    if GetLocalPlayer()==Player(i)then
      set x=GetCameraTargetPositionX()
      if x==U9D+1 then
        set UED=false
      else
        set UED=true
      endif
      call SetCameraPosition(U9D,UDD)
    endif
    set i=i+1
  endloop
  return UED
endfunction

function CinematicModeEx takes boolean cineMode, force forForce, real interfaceFadeTime returns nothing
  // If the game hasn't started yet, perform interface fades immediately
  if (not bj_gameStarted) then
    set interfaceFadeTime = 0
  endif
  
  if (cineMode) then
    // Save the UI state so that we can restore it later.
    if (not bj_cineModeAlreadyIn) then
      set bj_cineModeAlreadyIn = true
      set bj_cineModePriorSpeed = GetGameSpeed()
      set bj_cineModePriorFogSetting = IsFogEnabled()
      set bj_cineModePriorMaskSetting = IsFogMaskEnabled()
      set bj_cineModePriorDawnDusk = IsDawnDuskEnabled()
      set bj_cineModeSavedSeed = GetRandomInt(0, 1000000)
    endif
    
    // Perform local changes
    if (IsPlayerInForce(GetLocalPlayer(), forForce)) then
      // Use only local code (no net traffic) within this block to avoid desyncs.
      //call ClearTextMessages()
      call ShowInterface(false, interfaceFadeTime)
      call EnableUserControl(false)
      call EnableOcclusion(false)
      call SetCineModeVolumeGroupsBJ()
    endif
    
    // Perform global changes
    call SetGameSpeed(bj_CINEMODE_GAMESPEED)
    call SetMapFlag(MAP_LOCK_SPEED, true)
    call FogMaskEnable(false)
    call FogEnable(false)
    call EnableWorldFogBoundary(false)
    call EnableDawnDusk(false)
    
    // Use a fixed random seed, so that cinematics play consistently.
    //call SetRandomSeed(0)
  else
    set bj_cineModeAlreadyIn = false
    
    // Perform local changes
    if (IsPlayerInForce(GetLocalPlayer(), forForce)) then
      // Use only local code (no net traffic) within this block to avoid desyncs.
      call ShowInterface(true, interfaceFadeTime)
      call EnableUserControl(true)
      call EnableOcclusion(true)
      call VolumeGroupReset()
      call EndThematicMusic()
      call CameraResetSmoothingFactorBJ()
    endif
    
    // Perform global changes
    call SetMapFlag(MAP_LOCK_SPEED, false)
    call SetGameSpeed(bj_cineModePriorSpeed)
    call FogMaskEnable(bj_cineModePriorMaskSetting)
    call FogEnable(bj_cineModePriorFogSetting)
    call EnableWorldFogBoundary(true)
    call EnableDawnDusk(bj_cineModePriorDawnDusk)
    call SetRandomSeed(bj_cineModeSavedSeed)
  endif
endfunction



function UFD takes nothing returns nothing
  call CinematicModeEx(true,bj_FORCE_ALL_PLAYERS,0.5)
  call PauseGame(false)
  call TriggerSleepAction(.0)
  call BJDebugMsg("1")
  call EnableUserControl(false)
  call BJDebugMsg("2")
  call TriggerSleepAction(.0)
  call BJDebugMsg("3")
  if U8D()==false then
    set IsNotReplay=true
  endif
  call EnableUserControl(true)
  //call SA8(1)
  call CinematicModeEx(false,bj_FORCE_ALL_PLAYERS,0.5)
endfunction

function UGD takes nothing returns boolean
  local integer i=1
  local unit Hero
  loop
    exitwhen i>5
    set Hero=udg_Hero[GetPlayerId(Sentinels[i])]
    if Hero!=null and IsDead(Hero)==false and IsUnitEnemy(Hero,GetLocalPlayer()) then
      if IsNotReplay and(udg_ObserverMode==false or(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2)))then
        if IsUnitVisibleLoD(Hero,GetLocalPlayer())==false then
          if LK==2 then
            call FU9(Hero)
          endif
        else
          if LK==2 then
            call FS9(Hero)
          endif
        endif
      endif
    endif
    set Hero=udg_Hero[GetPlayerId(Scourges[i])]
    if Hero!=null and IsDead(Hero)==false and IsUnitEnemy(Hero,GetLocalPlayer()) then
      if IsNotReplay and(udg_ObserverMode==false or(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2)))then
        if IsUnitVisibleLoD(Hero,GetLocalPlayer())==false then
          if LK==2 then
            call FU9(Hero)
          endif
        else
          if LK==2 then
            call FS9(Hero)
          endif
        endif
      endif
    endif
    set i=i+1
  endloop
  set Hero=null
  return false
endfunction

function UHD takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.2,true)
  call TriggerAddCondition(t,Condition(function UGD))
  set t=null
endfunction

function UID takes nothing returns nothing
  //call UFD()
  call UHD()
endfunction

function IsCreep takes unit whichUnit returns boolean
  return (GetOwningPlayer(whichUnit)==Sentinels[0] or GetOwningPlayer(whichUnit)==Scourges[0]) and GetUnitTypeId(whichUnit)!='hFFD'
endfunction

function RestoreNormalCreepsAggro takes nothing returns nothing
  call SetUnitUserData(GetEnumUnit(),0)
  call IssuePointOrderByIdLoc(GetEnumUnit(),851983,(WaypointLocations[GetUnitAbilityLevel((GetEnumUnit()),WaypointAbilID)]))
endfunction

function AggroCreepOnTarget takes nothing returns nothing
  call IssueTargetOrderById(GetEnumUnit(),851983,HeroAttackedLogic_TempUnit)
  call GroupAddUnit(HeroAttackedLogic_TempGroup,GetEnumUnit())
  call SetUnitUserData(GetEnumUnit(),HeroAttackedLogic_TempInt)
endfunction

function HeroAttackedLogic_CreepsFilter takes nothing returns boolean
  local integer id=GetUnitTypeId(GetFilterUnit())
  if id=='ebal' or id=='e026' or id=='umtw' or id=='u00R' then
    return false
  endif
  if IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(HeroAttackedLogic_TempUnit))and(GetOwningPlayer(GetFilterUnit())==Sentinels[0]or GetOwningPlayer(GetFilterUnit())==Scourges[0])and GetUnitUserData(GetFilterUnit())==0 then
    return true
  endif
  return false
endfunction

function RestoreNormalCreepsAggroIf2Far takes nothing returns nothing
  if GetUnitCurrentOrder(GetEnumUnit())==0 and IsUnitInRange(GetEnumUnit(),HeroAttackedLogic_TempUnit,GetUnitAcquireRange(GetEnumUnit()))==false then
    call GroupRemoveUnit(HeroAttackedLogic_TempGroup,GetEnumUnit())
    call SetUnitUserData(GetEnumUnit(),0)
    call IssuePointOrderByIdLoc(GetEnumUnit(),851983,(WaypointLocations[GetUnitAbilityLevel((GetEnumUnit()),WaypointAbilID)]))
  endif
endfunction

function HeroAttackedLogic_RestoreDefault takes nothing returns nothing
  local integer Cache=GetHandleId((LoadUnitHandle(hashtable019,(GetHandleId(GetExpiredTimer())),(2))))
  local integer id=(LoadInteger(hashtable019,(Cache),(143)))
  local group associatedGroup=(LoadGroupHandle(hashtable019,(Cache),(144)))
  set HeroAttackedLogic_Attackers[id]=null
  call ForGroup(associatedGroup,function RestoreNormalCreepsAggro)
  call GroupClear(associatedGroup)
  set associatedGroup=null
endfunction

function HeroAttackedLogic_Action takes unit victim,unit aggressor returns nothing
  local integer Cache=GetHandleId(victim)
  local group associatedGroup=LoadGroupHandle(hashtable019,Cache,144)
  local integer id=LoadInteger(hashtable019,Cache,143)
  local unit haunted=HeroAttackedLogic_Attackers[id]
  local group g
  if haunted!=null and haunted!=aggressor then
    call ForGroup(associatedGroup,function RestoreNormalCreepsAggro)
    call GroupClear(associatedGroup)
  endif
  set HeroAttackedLogic_Attackers[id]=aggressor
  set HeroAttackedLogic_TempGroup=associatedGroup
  set HeroAttackedLogic_TempUnit=aggressor
  set HeroAttackedLogic_TempInt=id
  call ForGroup(associatedGroup,function RestoreNormalCreepsAggroIf2Far)
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(aggressor),GetUnitY(aggressor),500,Condition(function HeroAttackedLogic_CreepsFilter))
  call ForGroup(g,function AggroCreepOnTarget)
  call KillGroup(g)
  call TimerStart(LoadTimerHandle(hashtable019,Cache,141),2,false,function HeroAttackedLogic_RestoreDefault)
  set associatedGroup=null
  set haunted=null
  set g=null
endfunction

function HeroAttackedLogic_OrderIssued takes nothing returns boolean
  local unit Hero=GetTriggerUnit()
  local unit Target=GetOrderTargetUnit()
  local integer order=GetIssuedOrderId()
  local integer id
  if IsUnitType(Target,UNIT_TYPE_HERO) and IsUnitIllusion(Target)==false and(order==851983 or order==851971)and IsUnitEnemy(Target,GetOwningPlayer(Hero))and IsUnitVisibleLoD(Hero,GetOwningPlayer(Target))then
    set id=(LoadInteger(hashtable019,(GetHandleId(Target)),(143)))
    if HeroAttackedLogic_Attackers[id]==null or HeroAttackedLogic_Attackers[id]==Target or IsDead(HeroAttackedLogic_Attackers[id])then
      call HeroAttackedLogic_Action(Target,Hero)
    endif
  endif
  set Hero=null
  set Target=null
  return false
endfunction

function HeroAttackedLogic_Attacked takes nothing returns boolean
  local unit u=GetAttacker()
  local unit Hero=GetTriggerUnit()
  local integer id
  if IsCreep(u)==false then
    set id=(LoadInteger(hashtable019,(GetHandleId(Hero)),(143)))//load internal hero's number
    if HeroAttackedLogic_Attackers[id]==null or HeroAttackedLogic_Attackers[id]==Hero or IsDead(HeroAttackedLogic_Attackers[id])then//if 
      call HeroAttackedLogic_Action(Hero,u)
    endif
  endif
  set u=null
  set Hero=null
  return false
endfunction

function HeroAttackedLogic_Register takes unit Hero returns nothing
  local group g
  local trigger t
  local timer tm
  local integer Cache=GetHandleId(Hero)
  set HeroAttackedLogic_Counter=HeroAttackedLogic_Counter+1
  call SaveBoolean(hashtable019,(Cache),(142),(true))
  call SaveInteger(hashtable019,(Cache),(143),(HeroAttackedLogic_Counter))
  set g=GetAvailableGroup()
  call SaveGroupHandle(hashtable019,(Cache),(144),(g))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_ISSUED_TARGET_ORDER)
  call TriggerAddCondition(t,Condition(function HeroAttackedLogic_OrderIssued))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function HeroAttackedLogic_Attacked))
  set tm=CreateTimer()
  call SaveTimerHandle(hashtable019,(GetHandleId(Hero)),(141),(tm))
  call SaveUnitHandle(hashtable019,(GetHandleId(tm)),(2),(Hero))
  set g=null
  set t=null
  set tm=null
endfunction

function HeroAttackedLogic_Init takes nothing returns boolean
  if IsRealHero(GetTriggerUnit())and(LoadBoolean(hashtable019,(GetHandleId(GetTriggerUnit())),(142)))==false and (not b_isPickTime) then
    call HeroAttackedLogic_Register(GetTriggerUnit())
  endif
  return false
endfunction

function UZD takes nothing returns boolean
  if GetOwningPlayer(GetTriggerUnit())==Sentinels[0]then
    call SetUnitAbilityLevel(GetTriggerUnit(),WaypointAbilID,5)
    if HeroAttackedLogic_Attackers[GetUnitUserData(GetTriggerUnit())]==null then
      call SetUnitUserData(GetTriggerUnit(),0)
      call IssuePointOrderByIdLoc(GetTriggerUnit(),851983,(WaypointLocations[GetUnitAbilityLevel((GetTriggerUnit()),WaypointAbilID)]))
    endif
  elseif GetOwningPlayer(GetTriggerUnit())==Scourges[0]then
    call SetUnitAbilityLevel(GetTriggerUnit(),WaypointAbilID,1)
    if HeroAttackedLogic_Attackers[GetUnitUserData(GetTriggerUnit())]==null then
      call SetUnitUserData(GetTriggerUnit(),0)
      call IssuePointOrderByIdLoc(GetTriggerUnit(),851983,(WaypointLocations[GetUnitAbilityLevel((GetTriggerUnit()),WaypointAbilID)]))
    endif
  endif
  return false
endfunction

function UAD takes nothing returns nothing
  local unit H3D=GetTriggerUnit()
  local unit UBD=(LoadUnitHandle(hashtable019,(GetHandleId(H3D)),(145)))
  call RemoveUnit(UBD)
  set H3D=null
  set UBD=null
endfunction

function UCD takes nothing returns nothing
  local group g
  local unit H3D
  local unit UBD
  local trigger t
  local integer i
  set t=CreateTrigger()
  call TriggerAddAction(t,function UAD)
  set g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,Sentinels[0],Condition(function ReturnTrue2))
  loop
    set H3D=FirstOfGroup(g)
    exitwhen H3D==null
    call GroupRemoveUnit(g,H3D)
    if GetUnitAbilityLevel(H3D,'Adts')>0 or GetUnitAbilityLevel(H3D,'Atru')>0 then
      call TriggerRegisterUnitEvent(t,H3D,EVENT_UNIT_DEATH)
      set UBD=CreateUnit(Sentinels[1],('u00B'),-5000,-5100,0)
      call SetUnitScale(UBD,0,0,0)
      call SetUnitPathing(UBD,false)
      call SetUnitInvulnerable(UBD,true)
      call SetUnitX(UBD,GetUnitX(H3D))
      call SetUnitY(UBD,GetUnitY(H3D))
      call SaveUnitHandle(hashtable019,(GetHandleId(H3D)),(145),(UBD))
    endif
  endloop
  call KillGroup(g)
  set g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,Scourges[0],Condition(function ReturnTrue2))
  loop
    set H3D=FirstOfGroup(g)
    exitwhen H3D==null
    call GroupRemoveUnit(g,H3D)
    if GetUnitAbilityLevel(H3D,'Adts')>0 or GetUnitAbilityLevel(H3D,'Atru')>0 then
      call TriggerRegisterUnitEvent(t,H3D,EVENT_UNIT_DEATH)
      set UBD=CreateUnit(Scourges[1],('u00B'),3400,4400,0)
      call SetUnitScale(UBD,0,0,0)
      call SetUnitPathing(UBD,false)
      call SetUnitInvulnerable(UBD,true)
      call SetUnitX(UBD,GetUnitX(H3D))
      call SetUnitY(UBD,GetUnitY(H3D))
      call SaveUnitHandle(hashtable019,(GetHandleId(H3D)),(145),(UBD))
    endif
  endloop
  call KillGroup(g)
  set g=null
  set t=null
  set UBD=null
  set H3D=null
endfunction

function U3D takes nothing returns nothing
  local unit U6D=GetTriggerUnit()
  local unit Target=HeroAttackedLogic_Attackers[GetUnitUserData(U6D)]
  call SetUnitPosition(U6D,GetUnitX(U6D),GetUnitY(U6D))
  if Target!=null and IsDead(Target)==false and IsUnitVisibleLoD(Target,GetOwningPlayer(Target))then
    call IssueTargetOrderById(U6D,851983,Target)
  else
    call DisableTrigger(GetTriggeringTrigger())
    call IssuePointOrderByIdLoc(U6D,851983,(WaypointLocations[GetUnitAbilityLevel((U6D),WaypointAbilID)]))
    call EnableTrigger(GetTriggeringTrigger())
  endif
  set U6D=null
  set Target=null
endfunction

function ULD takes nothing returns boolean
  if IsCreep(GetTriggerUnit())then
    call U3D()
  endif
  return false
endfunction

function U1D takes nothing returns nothing
  local unit U6D=GetTriggerUnit()
  local unit Target=HeroAttackedLogic_Attackers[GetUnitUserData(U6D)]
  call SetUnitPosition(U6D,GetUnitX(U6D),GetUnitY(U6D))
  if Target!=null and IsDead(Target)==false and IsUnitVisibleLoD(Target,GetOwningPlayer(Target))then
    call IssueTargetOrderById(U6D,851983,Target)//attack
  else
    call DisableTrigger(GetTriggeringTrigger())
    call IssuePointOrderByIdLoc(U6D,851983,(WaypointLocations[GetUnitAbilityLevel((U6D),WaypointAbilID)]))//attack
    call EnableTrigger(GetTriggeringTrigger())
  endif
  set U6D=null
  set Target=null
endfunction

function U0D takes nothing returns boolean
  if GetIssuedOrderId()==851986 then//move
    call U1D()
  endif
  return false
endfunction

function U5D takes nothing returns boolean
  if GetOwningPlayer(GetTriggerUnit())==Sentinels[0]then
    if IsUnitFogged(GetAttacker(),Sentinels[1])or IsUnitFogged(GetAttacker(),Scourges[1])then
      call A28(CreateFogModifierRadius(Sentinels[1],FOG_OF_WAR_VISIBLE,GetUnitX(GetAttacker()),GetUnitY(GetAttacker()),128,true,false),1)
    endif
  elseif GetOwningPlayer(GetTriggerUnit())==Scourges[0]then
    if IsUnitFogged(GetAttacker(),Sentinels[1])or IsUnitFogged(GetAttacker(),Scourges[1])then
      call A28(CreateFogModifierRadius(Scourges[1],FOG_OF_WAR_VISIBLE,GetUnitX(GetAttacker()),GetUnitY(GetAttacker()),128,true,false),1)
    endif
  endif
  return false
endfunction

function U2D takes nothing returns boolean
  local trigger t
  local group g
  local unit u
  if udg_ObserverMode then
    set t=CreateTrigger()
    call TriggerRegisterPlayerUnitEvent(t,Sentinels[0],EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER,Condition(function ReturnTrue2))
    call TriggerRegisterPlayerUnitEvent(t,Scourges[0],EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER,Condition(function ReturnTrue2))
    call TriggerAddCondition(t,Condition(function U0D))
    set t=CreateTrigger()
    set g=GetAvailableGroup()
    call GroupEnumUnitsOfPlayer(g,Sentinels[0],Condition(function ReturnTrue2))
    loop
      set u=FirstOfGroup(g)
      exitwhen u==null
      call GroupRemoveUnit(g,u)
      if GetUnitAcquireRange(u)!=0 then
        call TriggerRegisterUnitInRange(t,u,600,Condition(function ReturnTrue2))
      endif
    endloop
    call KillGroup(g)
    set g=GetAvailableGroup()
    call GroupEnumUnitsOfPlayer(g,Scourges[0],Condition(function ReturnTrue2))
    loop
      set u=FirstOfGroup(g)
      exitwhen u==null
      call GroupRemoveUnit(g,u)
      if GetUnitAcquireRange(u)!=0 and IsUnitType(u,UNIT_TYPE_STRUCTURE)then
        call TriggerRegisterUnitInRange(t,u,600,Condition(function ReturnTrue2))
      endif
    endloop
    call KillGroup(g)
    call TriggerAddCondition(t,Condition(function ULD))
    set t=CreateTrigger()
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
    call TriggerAddCondition(t,Condition(function U5D))
  endif
  call CleanTrigger(GetTriggeringTrigger())
  set t=null
  set g=null
  set u=null
  return false
endfunction

function V4D takes unit whichUnit returns nothing
  local integer i=0
  loop
    exitwhen(i==16)
    if IsUnitAlly(whichUnit,Player(i))then
      call UnitShareVision(whichUnit,Player(i),true)
    endif
    set i=i+1
  endloop
endfunction

function V7D takes nothing returns nothing
  call V4D(GetEnumUnit())
endfunction

function V8D takes nothing returns nothing
  local integer x
  local group g
  set x=1
  loop
    exitwhen x>5
    call SetPlayerAlliance(Sentinels[0],Sentinels[x],ConvertAllianceType(5),false)
    call SetPlayerAlliance(Scourges[0],Scourges[x],ConvertAllianceType(5),false)
    set x=x+1
  endloop
  set g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,Sentinels[0],Condition(function ReturnTrue2))
  call ForGroup(g,function V7D)
  call KillGroup(g)
  set g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,Scourges[0],Condition(function ReturnTrue2))
  call ForGroup(g,function V7D)
  call KillGroup(g)
  set g=null
endfunction

function V9D takes nothing returns nothing
  local integer x
  set x=0
  loop
    exitwhen x>5
    call SetPlayerAlliance(Sentinels[x],NeutralsPlayer,ConvertAllianceType(0),false)
    call SetPlayerAlliance(Sentinels[x],NeutralsPlayer,ConvertAllianceType(1),false)
    call SetPlayerAlliance(Sentinels[x],NeutralsPlayer,ConvertAllianceType(2),false)
    call SetPlayerAlliance(Sentinels[x],NeutralsPlayer,ConvertAllianceType(3),false)
    call SetPlayerAlliance(Sentinels[x],NeutralsPlayer,ConvertAllianceType(4),false)
    call SetPlayerAlliance(Sentinels[x],NeutralsPlayer,ConvertAllianceType(5),false)
    call SetPlayerAlliance(Sentinels[x],NeutralsPlayer,ConvertAllianceType(6),false)
    call SetPlayerAlliance(Sentinels[x],NeutralsPlayer,ConvertAllianceType(7),false)
    call SetPlayerAlliance(Scourges[x],NeutralsPlayer,ConvertAllianceType(0),false)
    call SetPlayerAlliance(Scourges[x],NeutralsPlayer,ConvertAllianceType(1),false)
    call SetPlayerAlliance(Scourges[x],NeutralsPlayer,ConvertAllianceType(2),false)
    call SetPlayerAlliance(Scourges[x],NeutralsPlayer,ConvertAllianceType(3),false)
    call SetPlayerAlliance(Scourges[x],NeutralsPlayer,ConvertAllianceType(4),false)
    call SetPlayerAlliance(Scourges[x],NeutralsPlayer,ConvertAllianceType(5),false)
    call SetPlayerAlliance(Scourges[x],NeutralsPlayer,ConvertAllianceType(6),false)
    call SetPlayerAlliance(Scourges[x],NeutralsPlayer,ConvertAllianceType(7),false)
    
    call SetPlayerAlliance(NeutralsPlayer,Sentinels[x],ConvertAllianceType(0),false)
    call SetPlayerAlliance(NeutralsPlayer,Sentinels[x],ConvertAllianceType(1),false)
    call SetPlayerAlliance(NeutralsPlayer,Sentinels[x],ConvertAllianceType(2),false)
    call SetPlayerAlliance(NeutralsPlayer,Sentinels[x],ConvertAllianceType(3),false)
    call SetPlayerAlliance(NeutralsPlayer,Sentinels[x],ConvertAllianceType(4),false)
    call SetPlayerAlliance(NeutralsPlayer,Sentinels[x],ConvertAllianceType(5),false)
    call SetPlayerAlliance(NeutralsPlayer,Sentinels[x],ConvertAllianceType(6),false)
    call SetPlayerAlliance(NeutralsPlayer,Sentinels[x],ConvertAllianceType(7),false)
    call SetPlayerAlliance(NeutralsPlayer,Scourges[x],ConvertAllianceType(0),false)
    call SetPlayerAlliance(NeutralsPlayer,Scourges[x],ConvertAllianceType(1),false)
    call SetPlayerAlliance(NeutralsPlayer,Scourges[x],ConvertAllianceType(2),false)
    call SetPlayerAlliance(NeutralsPlayer,Scourges[x],ConvertAllianceType(3),false)
    call SetPlayerAlliance(NeutralsPlayer,Scourges[x],ConvertAllianceType(4),false)
    call SetPlayerAlliance(NeutralsPlayer,Scourges[x],ConvertAllianceType(5),false)
    call SetPlayerAlliance(NeutralsPlayer,Scourges[x],ConvertAllianceType(6),false)
    call SetPlayerAlliance(NeutralsPlayer,Scourges[x],ConvertAllianceType(7),false)
    set x=x+1
  endloop
endfunction

function VDD takes nothing returns boolean
  return IsCreep(GetTriggerUnit())
endfunction

function VED takes nothing returns nothing
  call V4D(GetTriggerUnit())
endfunction

function VFD takes nothing returns nothing
  local trigger t
  if not udg_ObserverMode then
    return
  endif
  call V8D()
  call V9D()
  set t=CreateTrigger()
  call TriggerRegisterEnterRectSimple(t,GetWorldBounds())
  call TriggerAddCondition(t,Condition(function VDD))
  call TriggerAddAction(t,function VED)
  set t=null
endfunction

function LOLWTF_OHGODWHAT takes nothing returns boolean
  local integer PlayerId=1
  local integer i
  local unit Hero
  local integer MorphID1
  local integer MorphID2
  loop
    exitwhen PlayerId>11
    set Hero=udg_Hero[PlayerId]
    if Hero!=null and IsDead(Hero)==false and GetUnitTypeId(Hero)==HeroTypeId[PlayerId] and IsHexed(Hero)==false then
      loop
        set i=GetRandomInt(1,108)
        exitwhen (IsUnitIdType(HeroID[i],UNIT_TYPE_MELEE_ATTACKER) and IsUnitIdType(HeroTypeId[PlayerId],UNIT_TYPE_MELEE_ATTACKER)) or (IsUnitIdType(HeroID[i],UNIT_TYPE_RANGED_ATTACKER) and IsUnitIdType(HeroTypeId[PlayerId],UNIT_TYPE_RANGED_ATTACKER))
      endloop
      call SaveInteger(hashtable019,GetHandleId(LoadTriggerHandle(hashtable019,GetHandleId(Hero),'0PAS')),100,1)
      call TriggerEvaluate(LoadTriggerHandle(hashtable019,GetHandleId(Hero),'0PAS'))  //FORCE DISABLE PASSIVES WHEN MORPHING
      set MorphID1=GetMorphId(HeroTypeId[PlayerId])
      set MorphID2=GetMorphId(HeroID[i])
      call UnitAddAbility(Hero,MorphID1)
      call UnitRemoveAbility(Hero,MorphID1)
      call UnitAddAbility(Hero,MorphID2+1)
      call UnitRemoveAbility(Hero,MorphID2+1)
      set HeroTypeId[PlayerId]=HeroID[i]
    endif
    set PlayerId=PlayerId+1
  endloop
  set Hero=null
  return false
endfunction

function fasdasddasd takes nothing returns boolean
  call UnitRemoveAbility(GetFilterUnit(),'Aloc')
  
  return false
endfunction

function TESTMYFAITH takes nothing returns nothing
  if bj_isSinglePlayer then
    call SetPlayerAlliance(Player(0),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(1),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(2),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(3),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(4),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(5),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(6),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(7),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(8),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(9),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(10),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(11),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(12),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(13),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(14),Player(1),ConvertAllianceType(6),true)
    call SetPlayerAlliance(Player(15),Player(1),ConvertAllianceType(6),true)
  endif
endfunction

function HelpPlayerIfNotReady takes nothing returns nothing
  local integer i
  local integer aid
  local integer rnd
  local player p
  local integer k=1
  local integer te=0
  
  loop
    set p=Player(k)
    set i=k
    if b_isPlayerReady[i]==false and GetPlayerController(p)==MAP_CONTROL_USER and GetPlayerSlotState(p)==PLAYER_SLOT_STATE_PLAYING then
      loop
        exitwhen b_isPlayerReady[i]
        if s_MainMode=="sd" or s_MainMode=="md" then
          loop
            set rnd=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
            exitwhen(b_HeroAvailableForPlayer[i*NumberOfHeroes+rnd] and IsHeroIngame[rnd-1]==false) 
          endloop
          set aid=(rnd*4)-4
          set aid=aid+GetRandomInt(1,4)
          call SaveInteger(hashtable019,'0REA','0PID',i)
          call SaveInteger(hashtable019,'0REA','0SID',aid)
          call SaveBoolean(hashtable019,'0REA','000B',false)
          call ExeFunc("BUD")
        else
          loop//[lich] add -ready support to other modes
            set aid=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes*4))
            set te=(aid+3)/4
            exitwhen IsHeroIngame[te-1]==false// and GetPlayerTechMaxAllowed(GetTriggerPlayer(),HeroID[te])>0
          endloop
          //set aid=GetRandomInt(1,NumberOfHeroes*4)
          call SaveInteger(hashtable019,'0REA','0PID',i)
          call SaveInteger(hashtable019,'0REA','0SID',aid)
          call SaveBoolean(hashtable019,'0REA','000B',false)
          call ExeFunc("BUD")
        endif
      endloop
    endif
    set k=k+1
    if k==6 then
      set k=7
    endif
    exitwhen k>11
  endloop
  
  call ExeFunc("BMD")
endfunction

function AddSkillForGroup takes nothing returns nothing
  call UnitAddAbility2(GetEnumUnit(),TempInteger)
  if TempReal==1.0 then
    call SetPlayerAbilityAvailable(GetOwningPlayer(GetEnumUnit()),TempInteger,false)
    set TempReal=.0
  endif
endfunction

function AddSkillFn takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),4,99999)
  local group g
  if bj_isSinglePlayer then
    set TempInteger=String2Id(said)
    set TempReal=.0
    if SubString(said,0,2)=="QU" then
      set TempReal=1.0
    endif
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function AddSkillForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function RSkillForGroup takes nothing returns nothing
  call UnitRemoveAbility(GetEnumUnit(),TempInteger)
endfunction

function RSkillFn takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),4,99999)
  local group g
  if bj_isSinglePlayer then
    set TempInteger=String2Id(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function RSkillForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function GSkillForGroup takes nothing returns nothing
  call BJDebugMsg(GetObjectName(GetUnitTypeId(GetEnumUnit()))+"'s lvl of "+Id2String(TempInteger)+" is "+I2S(GetUnitAbilityLevel(GetEnumUnit(),TempInteger)))
endfunction

function GSkillFn takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),4,99999)
  local group g
  if bj_isSinglePlayer then
    set TempInteger=String2Id(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function GSkillForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function HSkillForGroup takes nothing returns nothing
  call SetPlayerAbilityAvailable(GetOwningPlayer(GetEnumUnit()),TempInteger,false)
endfunction

function HSkillFn takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),4,99999)
  local group g
  if bj_isSinglePlayer then
    set TempInteger=String2Id(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function HSkillForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function AddItemDebugForGroup takes nothing returns nothing
  local item it=UnitAddItemById(GetEnumUnit(),TempInteger)
  call SetItemPlayer(it,GetOwningPlayer(GetEnumUnit()),false)
  set it=null
endfunction

function AddItemDebug takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),4,99999)
  local group g
  if bj_isSinglePlayer then
    set TempInteger=String2Id(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function AddItemDebugForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function OUnitForGroup takes nothing returns nothing
  call SetUnitOwner(GetEnumUnit(),Player(TempInteger),true)
  if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO)then
    set udg_Hero[TempInteger]=GetEnumUnit()
  endif
endfunction

function OUnitFn takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),3,5)
  local group g
  if bj_isSinglePlayer then
    set TempInteger=S2I(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function OUnitForGroup)
    call KillGroup(g)
  endif
  set g=null
  
endfunction

function HidePassivesFunction takes unit u returns nothing
  local integer i=1
  local integer k
  local integer lvl
  //local unit u=GetEnumUnit()
  local player p=GetOwningPlayer(u)
  local boolean b=HidePassivesForPlayer[GetPlayerId(p)]
  set HidePassivesForPlayer[GetPlayerId(p)]=not b
  if HidePassivesForPlayer[GetPlayerId(p)] then
    call DisplayTimedTextToPlayer(p,0,0,10,"Passives become hidden")
    loop
      //call BJDebugMsg( B2S(UnitAddAbility2(u,PassivesUpgradeID[i]))+" "+Id2String(PassivesUpgradeID[i]))
      if PassivesUpgradeID[i]>0 then
        call UnitAddAbility2(u,PassivesUpgradeID[i])
        if GetUnitAbilityLevel(u,PassivesLearningSkillUpg[i])>0 then
          //call BJDebugMsg(Id2String(PassivesUpgradeID[i]))
          set lvl=GetUnitAbilityLevel(u,PassivesLearningSkillUpg[i])
          call UnitRemoveAbility(u,PassivesLearningSkillUpg[i])
          call UnitAddAbility2(u,PassivesLearningSkillUpg[i])
          call SetUnitAbilityLevel(u,PassivesLearningSkillUpg[i],lvl)
        endif
      endif
      set i=i+1
      exitwhen i>PassivesCount
    endloop
    call SetPlayerAbilityAvailable(p,'A13T',b)//tidebringer
    call SetPlayerAbilityAvailable(p,'A0MB',b)//riki's ulty
    call SetPlayerAbilityAvailable(p,'P247',b)// hunter in the night
    call SetPlayerAbilityAvailable(p,'A1IQ',b)//jinada
    //call UnitRemoveAbility(udg_Hero[GetPlayerId(p)],'A1IQ')
    //call SetPlayerAbilityAvailable(p,'A0O8',b)//liquid fire
    if NumberOfExtraAbilities>0 then
      set k=GetPassiveLearnNumber(SkillID[PlayerSkillNumber[GetPlayerId(p)*PlayerSkillOffset+5]])
      if k>0 then
        call SetPlayerAbilityAvailable(p,PassivesLearningSkill[k],b)
      endif
    endif
    if NumberOfExtraAbilities>1 then
      set k=GetPassiveLearnNumber(SkillID[PlayerSkillNumber[GetPlayerId(p)*PlayerSkillOffset+6]])
      if k>0 then
        call SetPlayerAbilityAvailable(p,PassivesLearningSkill[k],b)
      endif
    endif
    
  else
    call DisplayTimedTextToPlayer(p,0,0,10,"Passives become shown")
    loop
      if PassivesUpgradeID[i]>0 then
        call UnitRemoveAbility(u,PassivesUpgradeID[i])
        if GetUnitAbilityLevel(u,PassivesLearningSkill[i])>0 then
          set lvl=GetUnitAbilityLevel(u,PassivesLearningSkill[i])
          call UnitRemoveAbility(u,PassivesLearningSkill[i])
          call UnitAddAbility2(u,PassivesLearningSkill[i])
          call SetUnitAbilityLevel(u,PassivesLearningSkill[i],lvl)
        endif
      endif
      set i=i+1
      exitwhen i>PassivesCount
      
    endloop
    call SetPlayerAbilityAvailable(p,'A13T',b)
    call SetPlayerAbilityAvailable(p,'A0MB',b)
    call SetPlayerAbilityAvailable(p,'P247',b)
    call SetPlayerAbilityAvailable(p,'A1IQ',b)
    //call UnitRemoveAbility(udg_Hero[GetPlayerId(p)],'A1IQ')
    //call SetPlayerAbilityAvailable(p,'A0O8',b)
    if NumberOfExtraAbilities>0 then
      set k=GetPassiveLearnNumber(SkillID[PlayerSkillNumber[GetPlayerId(p)*PlayerSkillOffset+5]])
      if k>0 then
        call SetPlayerAbilityAvailable(p,PassivesLearningSkill[k],b)
      endif
    endif
    if NumberOfExtraAbilities>1 then
      set k=GetPassiveLearnNumber(SkillID[PlayerSkillNumber[GetPlayerId(p)*PlayerSkillOffset+6]])
      if k>0 then
        call SetPlayerAbilityAvailable(p,PassivesLearningSkill[k],b)
      endif
    endif
  endif
  
  set u=null
  
endfunction

function HidePassivesOnLearn takes nothing returns nothing
  call HidePassivesFunctionSup(TEMPUNIT)
endfunction

function HidePassivesFunctionInit takes nothing returns nothing
  local unit u=udg_Hero[GetPlayerId(GetTriggerPlayer())]
  if u!=null and IsDead(u)==false and b_isPickTime==false  then//and Z3
    call HidePassivesFunction(u)
  else
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,"You cant use this command for a while")
  endif
  set u=null
  
endfunction

function DebugRemoveBuggedItem takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),18,19)
  local integer i=S2I(said)
  local integer id
  if i>0 and i<7 then
    if GetItemTypeId(UnitItemInSlot(udg_Hero[GetPlayerId(GetTriggerPlayer())],i-1))<'I000' then
      call UnitRemoveItemFromSlot(udg_Hero[GetPlayerId(GetTriggerPlayer())],i-1)
    else
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,"This item isnt considered as bugged")
    endif
  endif
  
endfunction

function SetmsForGroup takes nothing returns nothing
  call SetUnitMoveSpeed(GetEnumUnit(),(TempReal))
endfunction


function setmsfunc takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),7,999)
  local group g
  if bj_isSinglePlayer then
    set TempReal=S2R(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function SetmsForGroup)
    call KillGroup(g)
  endif
  set g=null
  
endfunction


function ispawnableitemForGroup takes nothing returns nothing
  if IsItemPawnable(UnitItemInSlot(GetEnumUnit(),TempInteger)) then
    call BJDebugMsg("pawn")
  else
    call BJDebugMsg("unpawn")
  endif
endfunction

function ispawnableitem takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),4,999)
  local group g
  if bj_isSinglePlayer then
    set TempInteger=S2I(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function ispawnableitemForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function AddTypeForGroup takes nothing returns nothing
  call UnitAddType(GetEnumUnit(),ConvertUnitType(TempInteger))
  if IsUnitType(GetEnumUnit(),ConvertUnitType(TempInteger)) then
    call BJDebugMsg("added")
  endif
endfunction

function AddTypeDebug takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),4,999)
  local group g
  if bj_isSinglePlayer then
    set TempInteger=S2I(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function AddTypeForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function SelectHeroF takes nothing returns nothing
  if bj_isSinglePlayer then
    //call SelectUnit(udg_Hero[GetPlayerId(GetTriggerPlayer())],true)
    
    //set bj_mapInitialPlayableArea=Rect(-8500,-8500,8500,8500)
  endif
endfunction

function SetAnimFnForGroup takes nothing returns nothing
  call SetUnitAnimationByIndex(GetEnumUnit(),TempInteger)
  call ClearTextMessages()
  call BJDebugMsg(I2S(TempInteger))
endfunction

function SetAnimFn takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),6,999)
  local group g
  local integer i=S2I(said)
  if bj_isSinglePlayer then
    set TempInteger=S2I(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function SetAnimFnForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function SetHPFnForGroup takes nothing returns nothing
  call SetUnitState(GetEnumUnit(),UNIT_STATE_LIFE,TempInteger)
endfunction

function SetHPFn takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),4,999)
  local group g
  local integer i=S2I(said)
  if bj_isSinglePlayer then
    set TempInteger=S2I(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function SetHPFnForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function SetMPFnForGroup takes nothing returns nothing
  call SetUnitState(GetEnumUnit(),UNIT_STATE_MANA,TempInteger)
endfunction

function SetMPFn takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),4,999)
  local group g
  local integer i=S2I(said)
  if bj_isSinglePlayer then
    set TempInteger=S2I(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function SetMPFnForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function AddRuneFnForGroup takes nothing returns nothing
  call CreateItem(TempInteger,GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()))
endfunction

function AddRuneFn takes nothing returns nothing
  local string said=SubString(GetEventPlayerChatString(),4,9)
  local group g
  local integer i=S2I(said)
  if bj_isSinglePlayer then
    set TempInteger=String2Id(said)
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function AddRuneFnForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function GetXYofUnitForGroup takes nothing returns nothing
  call BJDebugMsg(R2S(GetUnitX(GetEnumUnit()))+" "+R2S(GetUnitY(GetEnumUnit())))
endfunction

function GetXYofUnit takes nothing returns nothing
  local group g
  if bj_isSinglePlayer then
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function GetXYofUnitForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function ChangeCamDistance takes nothing returns nothing
  local real r=S2R(SubString(GetEventPlayerChatString(),5,9))
  if r<=0 then
    set r=1
    call Error(GetTriggerPlayer(),"Incorrect multiplier, camera changed to default.")
  elseif r>3 then
    set r=3
    call Error(GetTriggerPlayer(),"Incorrect multiplier, camera changed to 3x distance.")
  endif
  call SetCameraFieldForPlayer(GetTriggerPlayer(),CAMERA_FIELD_TARGET_DISTANCE,1500*r,0)
endfunction


function RemoveUnitFnForGroup takes nothing returns nothing
  call RemoveUnit(GetEnumUnit())
endfunction

function RemoveUnitFn takes nothing returns nothing
  local group g
  if bj_isSinglePlayer then
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,GetTriggerPlayer(),null)
    call ForGroup(g,function RemoveUnitFnForGroup)
    call KillGroup(g)
  endif
  set g=null
endfunction

function VGD takes nothing returns nothing
  local string VHD=StringCase(GetEventPlayerChatString(),false)
  local boolean VID=false
  local boolean VJD=false
  local boolean VKD=VHD=="-gameinfo"
  local boolean VMD=SubString(VHD,0,5)=="-swap"
  local boolean VND=VHD=="-recreate"
  local boolean VOD=VHD=="-unstuck"
  local boolean VPD=VHD=="-matchup"or VHD=="-ma"
  local boolean VQD=VHD=="-movespeed"or VHD=="-ms"
  local boolean VRD=VHD=="-msa"
  local boolean VSD=VHD=="-disablehelp"
  local boolean VTD=VHD=="-enablehelp"
  local boolean VUD=VHD=="-creepstats"or VHD=="-cs"
  local boolean VVD=VHD=="-cson"or VHD=="-csoff"
  local boolean VWD=VHD=="-hidemsg"
  local boolean VXD=VHD=="-showmsg"
  local boolean VYD=VHD=="-weather snow"or VHD=="-weather rain"or VHD=="-weather off"or VHD=="-weather random"or VHD=="-weather wind"or VHD=="-weather moonlight"
  local boolean VZD=VHD=="-showdeny"or VHD=="-hidedeny"
  local boolean VAD=VHD=="-denyinfo"or VHD=="-di"
  local boolean VBD=VHD=="-don"or VHD=="-deathon"or VHD=="-doff"or VHD=="-deathoff"
  local boolean VCD=SubString(VHD,0,5)=="-roll"and VHD!="-rollhero"
  local boolean V3D=VHD=="-hhn"or VHD=="-hideheronames"
  local boolean V6D=VHD=="-mute"
  local boolean VLD=VHD=="-afk"
  local boolean V1D=SubString(VHD,0,8)=="-kickafk"
  local boolean V0D=VHD=="-apm"
  local boolean V5D=VHD=="-clear"
  local boolean Y09=VHD=="-courier"
  local boolean AH=VHD=="-ah"
  local boolean V2D=VHD=="-invokelist"or VHD=="-il"
  local boolean W7D=VHD=="-rolloff"
  local boolean W8D=VHD=="-rollon"
  local boolean W9D=SubString(VHD,0,6)=="-music"
  local boolean WDD=SubString(VHD,0,6)=="-water"
  local boolean WED=SubString(VHD,0,6)=="-quote"
  local boolean WFD=SubString(VHD,0,3)=="-cm"
  local boolean WGD=SubString(VHD,0,9)=="-itemswap"
  local boolean WHD=VHD=="-bonus"
  local boolean WID=VHD=="-rollhero"or VHD=="-rh"
  local boolean WJD=SubString(VHD,0,9)=="-rickroll"
  local boolean NoSwitch=VHD=="-noswitch"
  local boolean WKD=SubString(VHD,0,7)=="-switch"or VHD=="-ok"or VHD=="-no"
  local boolean WND=VHD=="-ii"or VHD=="-iteminfo"
  local boolean SpellInfo=VHD=="-si"or VHD=="-skillinfo"or VHD=="-spellinfo"
  local boolean WOD=VHD=="-center"or VHD=="-centeroff"or VHD=="-c"or VHD=="-co"
  local boolean WPD=VHD=="-unlock"
  local boolean WQD=VHD=="-disableselection"or VHD=="-ds"
  local boolean WRD=VHD=="-enableselection"or VHD=="-es"
  local boolean WSD=VHD=="-sleep"
  local boolean WTD=VHD=="-calm"
  local boolean WE8=VHD=="-st"
  local boolean TESTLICH=VHD=="-control"
  local boolean HIDEPASS=VHD=="-sp"// and Mode_S5==false and Mode_S6==false
  local boolean AddSkill=SubString(VHD,0,4)=="-aa "
  local boolean GetXY=VHD=="-xy"
  local boolean SelectHero=VHD=="-s"
  local boolean AddType=SubString(VHD,0,4)=="-at "
  local boolean RSkill=SubString(VHD,0,4)=="-ra "
  local boolean GSkill=SubString(VHD,0,4)=="-ga "
  local boolean HSkill=SubString(VHD,0,4)=="-ha "
  local boolean AItem=SubString(VHD,0,4)=="-ai "
  local boolean OUnit=SubString(VHD,0,3)=="-o "
  local boolean setms=SubString(VHD,0,7)=="-setms "
  local boolean setanim=SubString(VHD,0,6)=="-anim "
  local boolean sethp=SubString(VHD,0,4)=="-hp "
  local boolean setmp=SubString(VHD,0,4)=="-mp "
  local boolean addrune=SubString(VHD,0,4)=="-ar "
  local boolean ispawnable=SubString(VHD,0,4)=="-ip "
  local boolean showdetonate=VHD=="-show"
  local boolean CD = VHD=="-cd" or VHD=="-cooldown"
  local integer i=0
  local boolean FixPassivesRequest=VHD=="-fix"
  local integer SJ8=0
  local integer BJD=0
  local integer te
  local boolean removeiteminslot=SubString(VHD,0,18)=="-removeiteminslot "
  local boolean res=VHD=="-reset"
  local boolean remove=VHD=="-remove"
  local boolean resone=SubString(VHD,0,2)=="-r" and (SubString(VHD,2,3)==" " or S2I(SubString(VHD,2,3))>0)
  local boolean cam=SubString(VHD,0,4)=="-cam"
  call RunIfTrue("RemoveUnitFn",remove)
  call RunIfTrue("ChangeCamDistance",cam)
  call RunIfTrue("SetHPFn",sethp)
  call RunIfTrue("AddRuneFn",addrune)
  call RunIfTrue("GetXYofUnit",GetXY)
  call RunIfTrue("SetMPFn",setmp)
  call RunIfTrue("SetAnimFn",setanim)
  call RunIfTrue("ResetSpells",res)
  call RunIfTrue("ResetSpellsSingle",resone)
  call RunIfTrue("DebugRemoveBuggedItem",removeiteminslot)
  call RunIfTrue("SelectHeroF",SelectHero)
  call RunIfTrue("AddItemDebug",AItem)
  call RunIfTrue("AddTypeDebug",AddType)
  call RunIfTrue("setmsfunc",setms)
  call RunIfTrue("ispawnableitem",ispawnable)
  if showdetonate then
    if GetUnitAbilityLevel(udg_Hero[GetPlayerId(GetTriggerPlayer())],'A0AK')>0 or GetUnitAbilityLevel(udg_Hero[GetPlayerId(GetTriggerPlayer())],'A1FY')>0 then
      if GetUnitAbilityLevel(udg_Hero[GetPlayerId(GetTriggerPlayer())],'A1WF')==0 then
        call UnitAddAbility2(udg_Hero[GetPlayerId(GetTriggerPlayer())],'A1WF')
      else
        call UnitRemoveAbility(udg_Hero[GetPlayerId(GetTriggerPlayer())],'A1WF')
      endif
    endif
  endif
  
  if CD then
    set CD = LoadBoolean(MHT,GetHandleId(GetTriggerPlayer()),4)
    
    if CD then
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),.0,.0,10.,"Turning passive cooldown display |c00FF0000OFF|r")
      call SaveBoolean(MHT,GetHandleId(GetTriggerPlayer()),4,false)
    else
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),.0,.0,10.,"Turning passive cooldown display |c0000FF00ON|r")
      call SaveBoolean(MHT,GetHandleId(GetTriggerPlayer()),4,true)
    endif
    
    
    
    //call SaveBoolean(MHT,GetHandleId(GetTriggerPlayer()),4,cd==false)
  endif
  
  if b_isPickTime==false and s_MainMode!="md" then//[lich] and s_MainMode!="sd" 
    set VID=VHD=="-random"or VHD=="-random int"or VHD=="-random agi"or VHD=="-random str" or VHD=="-random melee" or VHD=="-random range"
    set VJD=VHD=="-repick"
  endif
  if VHD=="-sddon" then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),.0,.0,10.,"|cffff0000[SDD] |r"+"|c006699CC"+"System Display Damage |c0000FF00ON|r"+"|c006699CC"+"."+"|r")
    set b_isDamageShowed[GetPlayerId(GetTriggerPlayer())]=true
  elseif VHD=="-sddoff" then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),.0,.0,10.,"|cffff0000[SDD] |r"+"|c006699CC"+"System Display Damage |c00FF0000OFF|r"+"|c006699CC"+"."+"|r")
    set b_isDamageShowed[GetPlayerId(GetTriggerPlayer())]=false
  endif
  if Mode_FF then
    if VHD=="-ff"  then
      call RN8(GetPlayerId(GetTriggerPlayer()),false)
    endif
    if VHD=="-wff" then
      call RO8(GetTriggerPlayer())
    endif
  endif
  //	if SubString(VHD,0,3)=="-sp"  then//and StringLength(VHD)<7 and (Mode_S6 or Mode_S5)
  //		set i=S2I(SubString(VHD,4,5))
  //		call SN8(GetPlayerId(GetTriggerPlayer()),i)
  
  //endif
  if SR8(GetTriggerPlayer()) then
    if SubString(VHD,0,5)=="-swth" then
      call SaveInteger(hashtable019,'00FS',1,PlayersId[S2I(SubStringBJ(GetEventPlayerChatString(),7,7))])
      call SaveInteger(hashtable019,'00FS',2,PlayersId[6+S2I(SubStringBJ(GetEventPlayerChatString(),9,9))])
      call ExeFunc("WVD")
    endif
    if VHD=="-ff fast" then
      if RH8(GetPlayerId(GetTriggerPlayer()))<6 then
        call RF8(1)
      else
        call RF8(2)
      endif
    endif
  endif
  if VHD=="-addtime" and b_isPickTime and TimerGetRemaining(NK)>0 and ((IsSentinel(GetTriggerPlayer()) and CanAddTime[0]>0) or (IsScourge(GetTriggerPlayer()) and CanAddTime[1]>0))then
    if IsSentinel(GetTriggerPlayer())then
      set CanAddTime[0]=CanAddTime[0]-1
    else
      set CanAddTime[1]=CanAddTime[1]-1
    endif
    set i=R2I(TimerGetRemaining(NK))
    call TimerStart(NK,i+60,false,function HelpPlayerIfNotReady)
    
    call DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,10.,udg_Colors[GetPlayerId(GetTriggerPlayer())]+GetPlayerName(GetTriggerPlayer())+"|r"+" has added 1 minute to the picking time.")
  endif
  if VHD=="-ready" and b_isPickTime then
    if TimerGetElapsed(GlobalTimer)>ReadyCooldown[GetPlayerId(GetTriggerPlayer())] then
      if IsHeroesAvailable==false then
        call DisplayTimedTextToPlayer(GetTriggerPlayer(),.0,.0,10.,"|cff99ccff"+"You cannot use this command yet."+"|r")
      else
        if b_isPlayerReady[GetPlayerId(GetTriggerPlayer())] then
          call DisplayTimedTextToPlayer(GetTriggerPlayer(),.0,.0,10.,"|cff99ccff"+"You have already chosen all your spells."+"|r")
        else
          set ReadyCooldown[GetPlayerId(GetTriggerPlayer())]=TimerGetElapsed(GlobalTimer)+4
          set i=GetPlayerId(GetTriggerPlayer())
          loop
            exitwhen b_isPlayerReady[i]
            if s_MainMode=="sd" or s_MainMode=="md" then
              loop
                set BJD=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
                exitwhen(b_HeroAvailableForPlayer[i*NumberOfHeroes+BJD] and IsHeroIngame[BJD-1]==false) 
              endloop
              set SJ8=(BJD*4)-4
              set SJ8=SJ8+GetRandomInt(1,4)
              call SaveInteger(hashtable019,'0REA','0PID',i)
              call SaveInteger(hashtable019,'0REA','0SID',SJ8)
              call SaveBoolean(hashtable019,'0REA','000B',false)
              call ExeFunc("BUD")
            else
              
              loop//add -ready support to other modes
                set SJ8=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes*4))
                set te=(SJ8+3)/4
                exitwhen(IsHeroIngame[te]==false and GetPlayerTechMaxAllowed(GetTriggerPlayer(),HeroID[te])>0)
              endloop
              //set SJ8=GetRandomInt(1,NumberOfHeroes*4)
              call SaveInteger(hashtable019,'0REA','0PID',i)
              call SaveInteger(hashtable019,'0REA','0SID',SJ8)
              call SaveBoolean(hashtable019,'0REA','000B',false)
              call ExeFunc("BUD")
            endif
          endloop
          call DisplayTimedTextToPlayer(GetTriggerPlayer(),.0,.0,10.,"|cff99ccff"+"You are now ready, your remaining spells have been chosen randomly."+"|r")
          call ExeFunc("BMD")
        endif
      endif
    else
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),.0,.0,10.,"|cff99ccffYou can't use this command so often. Wait.|r")
    endif
  endif
  if VHD=="-lolwtf" and false then //HERPDERP
    if LOLWTF==false then
      set LOLWTF=true
      set LOLWTF_Trig=CreateTrigger()
      call TriggerRegisterTimerEvent(LOLWTF_Trig,2,true)
      call TriggerAddCondition(LOLWTF_Trig,Condition(function LOLWTF_OHGODWHAT))
    else
      call CleanTrigger(LOLWTF_Trig)
    endif
  endif
  call RunIfTrue("AddSkillFn",AddSkill)
  call RunIfTrue("RSkillFn",RSkill)
  call RunIfTrue("GSkillFn",GSkill)
  call RunIfTrue("HSkillFn",HSkill)
  call RunIfTrue("OUnitFn",OUnit)
  
  call RunIfTrue("TESTMYFAITH",TESTLICH)
  call RunIfTrue("WWD",VID)
  call RunIfTrue("HidePassivesFunctionInit",HIDEPASS)
  call RunIfTrue("FixPassivesPlz",FixPassivesRequest)
  call RunIfTrue("WXD",VJD)
  call RunIfTrue("WYD",VKD)
  call RunIfTrue("WZD",VMD)
  call RunIfTrue("WAD",VND)
  call RunIfTrue("WBD",VOD)
  call RunIfTrue("WCD",VPD)
  call RunIfTrue("W3D",VQD)
  call RunIfTrue("W6D",VRD)
  call RunIfTrue("WLD",VSD)
  call RunIfTrue("W1D",VTD)
  call RunIfTrue("W0D",VUD)
  call RunIfTrue("W5D",VVD)
  call RunIfTrue("W2D",VWD)
  call RunIfTrue("X4D",VXD)
  call RunIfTrue("X7D",VYD)
  call RunIfTrue("X8D",VZD)
  call RunIfTrue("X9D",VAD)
  call RunIfTrue("XDD",VBD)
  call RunIfTrue("XED",VCD)
  call RunIfTrue("XFD",V3D)
  call RunIfTrue("XGD",V6D)
  call RunIfTrue("XHD",VLD)
  call RunIfTrue("XID",V1D)
  call RunIfTrue("XJD",V0D)
  call RunIfTrue("XKD",V5D)
  call RunIfTrue("XMD",Y09)
  call RunIfTrue("XND",AH)
  call RunIfTrue("XOD",V2D)
  call RunIfTrue("XQD",W7D)
  call RunIfTrue("XRD",W8D)
  call RunIfTrue("XSD",W9D)
  call RunIfTrue("XTD",WDD)
  call RunIfTrue("XUD",WED)
  call RunIfTrue("XVD",WFD)
  call RunIfTrue("XWD",WGD)
  call RunIfTrue("XXD",WHD)
  call RunIfTrue("XYD",WID)
  call RunIfTrue("XZD",WJD)
  call RunIfTrue("XAD",WKD)
  call RunIfTrue("XBD",WND)
  call RunIfTrue("ShowSpellInfo",SpellInfo)
  call RunIfTrue("X3D",WOD)
  call RunIfTrue("X6D",WPD)
  call RunIfTrue("XLD",WQD)
  call RunIfTrue("X1D",WRD)
  call RunIfTrue("X0D",WSD)
  call RunIfTrue("X5D",WE8)
  call RunIfTrue("X2D",WTD)
endfunction

function XZD takes nothing returns nothing
  local integer a=S2I(SubString(GetEventPlayerChatString(),10,StringLength(GetEventPlayerChatString())))
  local integer ZG8=GetPlayerId(GetTriggerPlayer())
  set ZU7[ZG8]=ZU7[ZG8]+1
  if ZU7[ZG8]>10 then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,GetObjectName('n0DQ'))
    return
  endif
  if a<1 or a>8 then
    set a=GetRandomInt(1,8)
  endif
  if a==1 then
    call DisplayTimedTextToForceEx(AllPlayers,5,udg_Colors[GetPlayerId(GetTriggerPlayer())]+(IL7[GetPlayerId((GetTriggerPlayer()))])+"|r's never gonna give you up")
  elseif a==2 then
    call DisplayTimedTextToForceEx(AllPlayers,5,udg_Colors[GetPlayerId(GetTriggerPlayer())]+(IL7[GetPlayerId((GetTriggerPlayer()))])+"|r's never gonna let you down")
  elseif a==3 then
    call DisplayTimedTextToForceEx(AllPlayers,5,udg_Colors[GetPlayerId(GetTriggerPlayer())]+(IL7[GetPlayerId((GetTriggerPlayer()))])+"|r's never gonna run around")
  elseif a==4 then
    call DisplayTimedTextToForceEx(AllPlayers,5,udg_Colors[GetPlayerId(GetTriggerPlayer())]+(IL7[GetPlayerId((GetTriggerPlayer()))])+"|r's never gonna desert you")
  elseif a==5 then
    call DisplayTimedTextToForceEx(AllPlayers,5,udg_Colors[GetPlayerId(GetTriggerPlayer())]+(IL7[GetPlayerId((GetTriggerPlayer()))])+"|r's never gonna make you cry")
  elseif a==6 then
    call DisplayTimedTextToForceEx(AllPlayers,5,udg_Colors[GetPlayerId(GetTriggerPlayer())]+(IL7[GetPlayerId((GetTriggerPlayer()))])+"|r's never gonna say goodbye")
  elseif a==7 then
    call DisplayTimedTextToForceEx(AllPlayers,5,udg_Colors[GetPlayerId(GetTriggerPlayer())]+(IL7[GetPlayerId((GetTriggerPlayer()))])+"|r's never gonna tell a lie")
  elseif a==8 then
    call DisplayTimedTextToForceEx(AllPlayers,5,udg_Colors[GetPlayerId(GetTriggerPlayer())]+(IL7[GetPlayerId((GetTriggerPlayer()))])+"|r's never gonna hurt you")
  endif
endfunction

function Y7D takes nothing returns boolean
  return(udg_Allow_Random)and(not(PlayerUseRandomStatus[GetPlayerId(TempPlayer_OnRandom)]))and(IsHeroesAvailable)and( not(udg_Hero[GetPlayerId(TempPlayer_OnRandom)]!=null and Mode_RV==false))and(not(PlayerHaveRealHero[GetPlayerId(TempPlayer_OnRandom)]))and(not(HasAlreadyPickedHero[GetPlayerId(TempPlayer_OnRandom)]and Mode_RV==false))and(not(Mode_RV and F3[GetPlayerId(TempPlayer_OnRandom)]))
endfunction


function GetRandomHeroSD takes player p,integer tip returns nothing
  local integer WO8
  local integer WP8
  local location WQ8
  local integer VA8
  local boolean GotHero=false
  local integer i=0
  local boolean melee=tip==1
  local boolean range=tip==2
  local boolean common=tip==0
  set PlayerUseRandomStatus[GetPlayerId(p)]=true
  if IsSentinel(p) then
    set WO8=FirstSentinelHeroIndexid
    set WP8=LastSentinelHeroIndexid
    set WQ8=GetRectCenter(gg_rct_Hero_Creation_NE)
  else
    set WO8=FirstScourgeHeroIndexid
    set WP8=LastScourgeHeroIndexid
    set WQ8=GetRectCenter(gg_rct_Hero_Creation_UD)
  endif
  if Mode_AP then
    if(GetRandomInt(1,2)==1)then
      set WO8=FirstSentinelHeroIndexid
      set WP8=LastSentinelHeroIndexid
    else
      set WO8=FirstScourgeHeroIndexid
      set WP8=LastScourgeHeroIndexid
    endif
  endif
  loop
    set VA8=GetRandomInt(WO8,WP8)
    set i=i+1
    exitwhen GetPlayerTechMaxAllowed(p,HeroID[VA8])>0 and IsHeroIngame[VA8]==false and (common or (melee and IsUnitIdType(HeroID[VA8],UNIT_TYPE_MELEE_ATTACKER)) or (range and IsUnitIdType(HeroID[VA8],UNIT_TYPE_MELEE_ATTACKER)==false))
  endloop
  //if i>8000 and (b_isHeroPicked[VA8]==false and IsUnitIdType(HeroID[VA8],UNIT_TYPE_MELEE_ATTACKER) and GetPlayerTechMaxAllowed(p,HeroID[VA8])>0)==false then
  //call DisplayTimedTextToPlayer(p,0,0,10,"No melee heroes left.")
  //call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+100)
  //else
  if Mode_DU==false then
    call VR8(HeroID[VA8])
    set b_isHeroPicked[VA8]=true
    set IsHeroIngame[VA8]=true
  endif
  call CreateUnitAtLoc(p,HeroID[VA8],WQ8,0)
  //endif
  call RemoveLocation(WQ8)
  set WQ8=null
endfunction

function getFromPlayersPool takes player p, integer tip returns integer
  local boolean melee=tip==1
  local boolean range=tip==2
  local boolean common=tip==0
  local integer i=0
  local integer limit=NumberOfHeroes
  local integer k=0
  loop
    exitwhen i>limit
    if GetPlayerTechMaxAllowed(p,HeroID[i])>0 then
      if melee and IsUnitIdType(HeroID[i],UNIT_TYPE_MELEE_ATTACKER) then
        set k=k+1
      elseif range and IsUnitIdType(HeroID[i],UNIT_TYPE_MELEE_ATTACKER)==false then
        set k=k+1
      elseif common then
        set k=k+1
      endif
    endif
    set i=i+1
  endloop
  return k
endfunction

function Y8D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local string Y9D=(LoadStr(hashtable019,(Cache),(146)))
  set TempPlayer_OnRandom=p
  if Y7D()then
    set PlayerUseRandomStatus[GetPlayerId(p)]=true
    if Y9D=="-random int"then
      call RandomIntHero(p)
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-150)
    elseif Y9D=="-random str"then
      call WR8(p)
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-150)
    elseif Y9D=="-random agi"then
      call WS8(p)
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-150)
    elseif Y9D=="-random melee"then
      call GetRandomMeleeHero(p)
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-150)
    elseif Y9D=="-random range"then
      call GetRandomRangeHero(p)
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-150)
    else
      call WT8(p)
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-50)
    endif
  else
    call DisplayTimedTextToPlayer(p,0,group008,10,GetObjectName('n079'))
  endif
  set t=null
  set p=null
  return false
endfunction

function WWD takes nothing returns nothing
  local player p=GetTriggerPlayer()
  local trigger t
  local string s=StringCase(GetEventPlayerChatString(),false)
  set TempPlayer_OnRandom=p
  if Y7D()and booleans050[GetPlayerId(p)]==false then
    if MeleeOrRangedRestricted[GetPlayerId(p)]==2 and s=="-random melee" then
      call DisplayTimedTextToPlayer(p,0,group008,10,"You selected at least one |c00ff0000range only|r skill. You cant use melee units.")
    elseif MeleeOrRangedRestricted[GetPlayerId(p)]==1 and s=="-random range" then
      call DisplayTimedTextToPlayer(p,0,group008,10,"You selected at least one |c00ff0000melee only|r skill. You cant use ranged units.")
    elseif s_MainMode=="sd" then
      if s=="-random melee"then
        if getFromPlayersPool(p,1)>0 then
          set booleans050[GetPlayerId(p)]=true
          //call DisplayTimedTextToPlayer(p,0,I3,10,"You will be given a random melee hero soon.")
          call GetRandomHeroSD(p,1)
          call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-100)
          return
        else
          call DisplayTimedTextToPlayer(p,0,0,10,"You have no melee heroes to chose from.")
        endif
      elseif s=="-random range"then
        if getFromPlayersPool(p,2)>0 then
          set booleans050[GetPlayerId(p)]=true
          //call DisplayTimedTextToPlayer(p,0,I3,10,"You will get random ranged hero soon")
          call GetRandomHeroSD(p,2)
          call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-100)
          return
        else
          call DisplayTimedTextToPlayer(p,0,0,10,"You have no range heroes to chose from.")
        endif
      elseif s=="-random"then
        set booleans050[GetPlayerId(p)]=true
        //call DisplayTimedTextToPlayer(p,0,I3,10,"You will get random  hero soon")
        call GetRandomHeroSD(p,0)
        return
      endif
    else
      set booleans050[GetPlayerId(p)]=true
      call VS8(p)
      if s=="-random melee" then
        call DisplayTimedTextToPlayer(p,0,group008,10,"You will be given a random melee hero soon.")
      elseif s=="-random range" then
        call DisplayTimedTextToPlayer(p,0,group008,10,"You will be given a random range hero soon.")
      else
        call DisplayTimedTextToPlayer(p,0,group008,10,GetObjectName('n07A'))
      endif
      set t=CreateTrigger()
      call TriggerRegisterTimerEvent(t,6,false)
      call TriggerAddCondition(t,Condition(function Y8D))
      call SavePlayerHandle(hashtable019,(GetHandleId(t)),(54),(p))
      call SaveStr(hashtable019,(GetHandleId(t)),(146),(StringCase(GetEventPlayerChatString(),false)))
    endif
  endif
  set t=null
  set p=null
endfunction

function YDD takes nothing returns boolean
  local unit Hero=udg_Hero[GetPlayerId(GetTriggerPlayer())]
  if DF8 then
    call Error(GetTriggerPlayer(),GetObjectName('n030'))
    set Hero=null
    return false
  endif
  if udg_Allow_Repick==false then
    if Mode_SD==false and Mode_VR==false and BB7==false and Mode_CD==false and LZ7==false and L67==false and Mode_RV==false and Mode_MM_Activated==false then
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,"-repick "+GetObjectName('n05B'))
    endif
    set Hero=null
    return false
  endif
  if(PlayerHaveRealHero[GetPlayerId(GetTriggerPlayer())]) or (udg_Hero[GetPlayerId(GetTriggerPlayer())]==null)then
    set Hero=null
    return false
  endif
  if Mode_DM or Mode_VR or Mode_RV then
    set Hero=null
    return false
  endif
  if(boolean179)then
    set Hero=null
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n050'))
    return false
  endif
  if(GetPlayerState(GetTriggerPlayer(),PLAYER_STATE_RESOURCE_GOLD)<MinGoldForRepick)then
    set Hero=null
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n059'))
    return false
  endif
  if GetPlayerState(GetTriggerPlayer(),PLAYER_STATE_RESOURCE_GOLD)<350 and Mode_AP or Mode_Normal then
    set Hero=null
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n05U'))
    return false
  endif
  if GetUnitState(Hero,UNIT_STATE_MANA)!=GetUnitState(Hero,UNIT_STATE_MAX_MANA)or GetUnitState(Hero,UNIT_STATE_LIFE)!=GetUnitState(Hero,UNIT_STATE_MAX_LIFE)then
    set Hero=null
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n05J'))
    return false
  endif
  set Hero=null
  return true
endfunction

function YED takes nothing returns nothing
  if(IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO))then
    if(GetUnitTypeId(GetEnumUnit())=='U006')then
      call ExeFunc("XJ9")
    elseif GetUnitTypeId(GetEnumUnit())=='U008' or GetUnitTypeId(GetEnumUnit())=='E015' then
      set VK=GetEnumUnit()
      call ExeFunc("YD9")
    endif
    call DisplayTimedTextToForceEx(S58(GetTriggerPlayer()),10.,GetObjectName('n05L')+" "+UQ8(GetEnumUnit())+".")
  endif
  if(GetUnitTypeId(GetEnumUnit())=='n004')then
    call RemoveUnit(GetEnumUnit())
  endif
  if(GetUnitTypeId(GetEnumUnit())=='n018')then
    call RemoveUnit(GetEnumUnit())
  endif
  if(GetUnitTypeId(GetEnumUnit())=='n01C')then
    call RemoveUnit(GetEnumUnit())
  endif
  if(GetUnitTypeId(GetEnumUnit())=='n01G')then
    call RemoveUnit(GetEnumUnit())
  endif
  if(GetUnitTypeId(GetEnumUnit())=='o01X')then
    call RemoveUnit(GetEnumUnit())
  endif
endfunction

function IsHeroOnMap takes integer id returns boolean
  return GetUnitTypeId(udg_Hero[1])==id or GetUnitTypeId(udg_Hero[2])==id or GetUnitTypeId(udg_Hero[3])==id or GetUnitTypeId(udg_Hero[4])==id or GetUnitTypeId(udg_Hero[5])==id or GetUnitTypeId(udg_Hero[6])==id or GetUnitTypeId(udg_Hero[7])==id or GetUnitTypeId(udg_Hero[8])==id or GetUnitTypeId(udg_Hero[9])==id or GetUnitTypeId(udg_Hero[10])==id
endfunction

function HeroAttackTypeRestrictionForPlayer takes player p, integer i returns nothing
  local integer k=1
  if i==0 then
    return
  endif
  if i==1 then
    loop
      call SetPlayerTechMaxAllowed(p,RangeHeroesArray[k],0)
      set k=k+1
      exitwhen k>RangeHeroesAmount
    endloop
  elseif i==2 then
    loop
      call SetPlayerTechMaxAllowed(p,MeleeHeroesArray[k],0)
      set k=k+1
      exitwhen k>MeleeHeroesAmount
    endloop
  endif
endfunction

function YFD takes nothing returns nothing
  local player p=GetTriggerPlayer()
  local group g=GetAvailableGroup()
  local integer WO8
  local integer WP8
  local location WQ8
  local unit RepickedUnit
  local integer VA8
  local integer VT8
  local integer VU8
  local unit YGD
  local integer hn=1
  local integer PlayerId=GetPlayerId(p)
  local location SpawnSent=GetRectCenter(gg_rct_Allpick_Sent)
  local location SpawnScourge=GetRectCenter(gg_rct_Allpick_Scourge)
  local integer i=0
  set tt_int1=GetPlayerId(p)
  call ExeFunc("FixPassiveSkills_DisableAbilitiesForPlayerFromGlobal")
  set bj_groupEnumOwningPlayer=p
  call GroupEnumUnitsInRect(g,GetWorldBounds(),filterGetUnitsInRectOfPlayer)
  if(IsSentinel(p))then
    set WO8=FirstSentinelHeroIndexid
    set WP8=LastSentinelHeroIndexid
    set WQ8=GetRectCenter(G4)
  else
    set WO8=FirstScourgeHeroIndexid
    set WP8=LastScourgeHeroIndexid
    set WQ8=GetRectCenter(F4)
  endif
  if Mode_AR then
    if(GetRandomInt(1,2)==1)then
      set WO8=FirstSentinelHeroIndexid
      set WP8=LastSentinelHeroIndexid
    else
      set WO8=FirstScourgeHeroIndexid
      set WP8=LastScourgeHeroIndexid
    endif
  endif
  if Mode_AP or Mode_SD or Mode_Normal then
    set MinGoldForRepick=0
  endif
  set YGD=(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggerPlayer())),(147)))
  if YGD!=null and GetUnitTypeId(YGD)=='e00C' then
    call RemoveUnit(YGD)
  endif
  call AdjustPlayerStateBJ(-1*MinGoldForRepick,p,PLAYER_STATE_RESOURCE_GOLD)
  set PlayerHaveRealHero[GetPlayerId(p)]=true
  set PlayerHaveHero[GetPlayerId(p)]=false
  call ForGroup(g,function YED)
  set b_isHeroPicked[GetUnitPointValueByType(GetUnitTypeId(udg_Hero[GetPlayerId(p)]))]=false
  set IsHeroIngame[GetUnitPointValueByType(GetUnitTypeId(udg_Hero[GetPlayerId(p)]))]=false
  call RemoveHero(udg_Hero[GetPlayerId(p)])
  set HeroTypeId[GetPlayerId(p)]=0
  set udg_Hero[GetPlayerId(GetTriggerPlayer())]=null
  if Mode_AP or Mode_SD or Mode_Normal then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,60,GetObjectName('N05Y'))
    if Mode_AP or Mode_SD then
      set VT8=FirstSentinelHeroIndexid
      set VU8=LastScourgeHeroIndexid
    endif
    if IsSentinel(p)then
      if Mode_Normal then
        set VT8=FirstSentinelHeroIndexid
        set VU8=LastSentinelHeroIndexid
        call CreateUnitAtLoc(p,'n00C',SpawnSent,bj_UNIT_FACING)
      else
        call CreateUnitAtLoc(p,'n00C',SpawnSent,bj_UNIT_FACING)
        call CreateUnitAtLoc(p,'n00C',SpawnScourge,bj_UNIT_FACING)
      endif
      call PanCameraToTimedLocForPlayer(p,SpawnSent,0)
    else
      if Mode_Normal then
        set VT8=FirstScourgeHeroIndexid
        set VU8=LastScourgeHeroIndexid
        call CreateUnitAtLoc(p,'n00C',SpawnScourge,bj_UNIT_FACING)
      else
        call CreateUnitAtLoc(p,'n00C',SpawnSent,bj_UNIT_FACING)
        call CreateUnitAtLoc(p,'n00C',SpawnScourge,bj_UNIT_FACING)
      endif
      call PanCameraToTimedLocForPlayer(p,SpawnScourge,0)
    endif
    loop
      exitwhen VT8>VU8
      
      if Mode_AP then
        if IsHeroIngame[VT8]==false then
          call SetPlayerTechMaxAllowed(p,HeroID[VT8],999)
        endif
      elseif Mode_SD then
        set i=0
        loop
          if SDHeroesIDs[GetPlayerId(p)*100+i]==HeroID[VT8] then
            call SetPlayerTechMaxAllowed(p,HeroID[VT8],999)
            //call echo(GetObjectName(HeroID[VT8]))
          endif
          set i=i+1
          exitwhen i>SDHeroesPoolInc[GetPlayerId(p)]
        endloop
      endif
      
      
      set VT8=VT8+1
    endloop
    call HeroAttackTypeRestrictionForPlayer(Player(PlayerId),MeleeOrRangedRestricted[PlayerId])
    call RemoveLocation(SpawnSent)
    call RemoveLocation(SpawnScourge)
    return
  endif
  loop
    set VA8=GetRandomInt(WO8,WP8)
    if(IsHeroIngame[VA8]==false)then
      set b_isHeroPicked[VA8]=true
      set IsHeroIngame[VA8]=true
      set udg_Hero[GetPlayerId(p)]=CreateUnitAtLoc(p,HeroID[VA8],WQ8,bj_UNIT_FACING)
      set HeroTypeId[GetPlayerId(p)]=HeroID[VA8]
      call TechHeroForAll(HeroID[VA8])
    endif
    exitwhen udg_Hero[GetPlayerId(GetTriggerPlayer())]!=null
  endloop
  call KillGroup(g)
  call RemoveLocation(WQ8)
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  set g=null
  set RepickedUnit=null
  set YGD=null
  set WQ8=null
  set SpawnSent=null
  set SpawnScourge=null
endfunction

function WXD takes nothing returns nothing
  if YDD()then
    call YFD()
  endif
endfunction

function WYD takes nothing returns nothing
  local player p=GetTriggerPlayer()
  local string color="|c006699CC"
  if LZ7 then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"League Mode"+"|r:	  "+GetObjectName('n075'))
  endif
  if L67 then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Extended League"+"|r:	  "+GetObjectName('n07B'))
    call DisplayTimedTextToPlayer(p,0,group008,20,"								 "+GetObjectName('n070'))
  endif
  if Mode_DM then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Death Match"+"|r:		"+GetObjectName('n06Z'))
    call DisplayTimedTextToPlayer(p,0,group008,20,"							  "+GetObjectName('n06Y')+" "+I2S(IMinIF(LastSentinelHeroIndexid,LastScourgeHeroIndexid-FirstScourgeHeroIndexid+1))+" "+GetObjectName('n07C'))
  endif
  if Mode_MM_Activated then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Mirror Match"+"|r:	   "+GetObjectName('n06W'))
  endif
  if Mode_AP then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"All Pick"+"|r:				 "+GetObjectName('n06V'))
  endif
  if Mode_MA then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Mass Aghanims"+"|r:				 "+"Aghanim's scepter improve both ultimates hero have")
  endif
  if BB7 then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Random Draft"+"|r:				 "+GetObjectName('n072'))
  endif
  if Mode_SD then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Single Draft"+"|r:				 You may pick a hero and abilities from 11 options")
  endif
  if Mode_AR then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"All Random"+"|r:		  "+GetObjectName('n071'))
  endif
  if Mode_VR then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Vote Random"+"|r:		 "+GetObjectName('n074'))
  endif
  if Mode_TR then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Team Random"+"|r:	 "+GetObjectName('n06M'))
  endif
  if Mode_RV then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Reverse"+"|r:				 "+GetObjectName('n073'))
  endif
  if Mode_SP then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Shuffle Players"+"|r:	 "+GetObjectName('n07H'))
  endif
  if Mode_AA then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"All Agility"+"|r:			 "+GetObjectName('n07L'))
  endif
  if Mode_AS then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"All Strength"+"|r:		 "+GetObjectName('n07K'))
  endif
  if Mode_AI then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"All Intelligence"+"|r:	"+GetObjectName('n07J'))
  endif
  if Mode_RO then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Range Only"+"|r:	"+GetObjectName('n0G4'))
  endif
  if Mode_MO then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Melee Only"+"|r:	"+GetObjectName('n0G5'))
  endif
  if Mode_DU then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Duplicate Mode"+"|r:   "+GetObjectName('n07I'))
  endif
  if Mode_ID then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Item Drop"+"|r:			 "+GetObjectName('n07F'))
  endif
  if Mode_NP then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"No Powerups"+"|r:		"+GetObjectName('n07M'))
  endif
  if Mode_SC then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Super Creeps"+"|r:		"+GetObjectName('n07N'))
    call DisplayTimedTextToPlayer(p,0,group008,20,"							 "+GetObjectName('n07O'))
  endif
  if Mode_EM then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Easy Mode"+"|r:		   "+GetObjectName('n07T'))
  endif
  if Mode_SH then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Same Hero"+"|r:		   "+GetObjectName('n07U')+" "+(IL7[GetPlayerId((PlayerModeTyper))])+"|r"+" "+GetObjectName('n07W'))
  endif
  if Mode_OM then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Only Mid"+"|r:		   "+GetObjectName('n080'))
  endif
  if Mode_NB then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"No Bot"+"|r:		   "+GetObjectName('n07V'))
  endif
  if Mode_NM then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"No Mid"+"|r:		   "+GetObjectName('n07S'))
  endif
  if Mode_NT then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"No Top"+"|r:		   "+GetObjectName('n07R'))
  endif
  if Mode_NS then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"No Swap"+"|r:		   "+GetObjectName('n07X'))
  endif
  if Mode_NR then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"No Repick"+"|r:		   "+GetObjectName('n07Q'))
  endif
  if Mode_PM then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Pool Mode"+"|r:		   "+GetObjectName('n07Y'))
  endif
  if Mode_OI then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Observer Info"+"|r:		   "+GetObjectName('n07Z'))
  endif
  if Mode_MI then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Mini Hereos"+"|r:		   "+GetObjectName('n0EC'))
  endif
  if Mode_FR then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Fast Respawn"+"|r:		   "+GetObjectName('n0DP'))
  endif
  if Mode_CM then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Captains Mode"+"|r:		   "+GetObjectName('n0ED'))
  endif
  if Mode_ER then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Experimental Runes"+"|r:		   "+GetObjectName('n0G6'))
  endif
  if Mode_CD then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Captains Draft"+"|r:		   "+GetObjectName('n0GF'))
  endif
  if Mode_CP then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Capture Point"+"|r:		   "+GetObjectName('n0KH'))
  endif
  if Mode_ZM then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Zoom mode"+"|r:		   "+GetObjectName('n0KI'))
  endif
  if Mode_Normal then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Normal Mode"+"|r:		   	"+GetObjectName('n07P'))
  endif
  if Mode_UL then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Unlimited Level"+"|r:		   Hero levels are infinite")
  endif
  if Mode_SS then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"See skills"+"|r:		   You can see skills picked by enemies")
  endif
  if Mode_AB then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Antibackdoor"+"|r:		   Backdoor regeneration increased heavily")
  endif
  if Mode_S5 then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Five skills"+"|r:		   You can pick a 5th normal spell (slot 5)")
  endif
  if Mode_S6 then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Six skills"+"|r:		   You can pick a 2nd ultimate spell (slot 6)")
  endif
  if Mode_FN then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Fast neutrals"+"|r:		   First neutrals spawn already after drafting")
  endif
  if Mode_D2 then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Draft 20"+"|r:		   Draft of 20 heroes in the taverns")
  endif
  if Mode_D3 then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Draft 30"+"|r:		   Draft of 30 heroes in the taverns")
  endif
  if Mode_D4 then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Draft 40"+"|r:		   Draft of 40 heroes in the taverns")
  endif
  if Mode_D5 then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Draft 50"+"|r:				Draft of 50 heroes in the taverns")
  endif
  if Mode_OS then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"One skill"+"|r:		   Skills may only be chosen once in your team")
  endif
  if Mode_BO then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Balance off"+"|r:		   Balance turned off")
  endif
  if Mode_RA then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Random extra abilities"+"|r:		   Your 5th & 6th skills are randomed")
  endif
  if Mode_LS3 then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Limit skills (3)"+"|r:		   You can only pick 3 skills from the same hero")
  endif
  if Mode_LS then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Limit skills"+"|r:		   You can only pick 2 skills from the same hero")
  endif
  if Mode_FF then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Fast Finish"+"|r:		   You can vote to fast finish the game using -ff command, -wff to check who ff'd")
  endif
  if Mode_EB then
    call DisplayTimedTextToPlayer(p,0,group008,20,color+"Extended Balance"+"|r:		   Add some more extra balance features.")
  endif
  //if Mode_MA then
  //	call DisplayTimedTextToPlayer(p,0,I3,20,color+"Mass Aghanims"+"|r:		   Sixth ability is also upgraded by Aghanim's Scepter.")
  //endif
endfunction

function YID takes nothing returns nothing
  if GetUnitTypeId(GetEnumUnit())=='n004' then
    call RemoveUnit(GetEnumUnit())
  endif
  if GetUnitTypeId(GetEnumUnit())=='o003' then
    call RemoveUnit(GetEnumUnit())
  endif
endfunction

function YJD takes unit u1,unit u2 returns nothing
  local player Me=GetOwningPlayer(u1)
  local player YKD=GetOwningPlayer(u2)
  local unit YMD=CreateUnit(Me,'e01F',0,0,0)
  local group g
  local item FWD
  local integer YND
  local integer i=1
  local integer array megusta
  if PlayerUseRandomStatus[GetPlayerId(Me)]==true then
    if GetPlayerState(Me,PLAYER_STATE_RESOURCE_GOLD)<100 then
      return
    endif
  endif
  if PlayerUseRandomStatus[GetPlayerId(YKD)]==true then
    if GetPlayerState(YKD,PLAYER_STATE_RESOURCE_GOLD)<100 then
      return
    endif
  endif
  if PlayerUseRandomStatus[GetPlayerId(Me)]==true and PlayerHaveRealHero[GetPlayerId(Me)]==false and Prevent100GoldPerSwap[GetPlayerId(Me)]==0 then
    set Prevent100GoldPerSwap[GetPlayerId(Me)]=1
    call SetPlayerState(Me,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(Me,PLAYER_STATE_RESOURCE_GOLD)-100)
  endif
  if PlayerUseRandomStatus[GetPlayerId(YKD)]==true and PlayerHaveRealHero[GetPlayerId(YKD)]==false and Prevent100GoldPerSwap[GetPlayerId(YKD)]==0 then
    set Prevent100GoldPerSwap[GetPlayerId(YKD)]=1
    call SetPlayerState(YKD,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(YKD,PLAYER_STATE_RESOURCE_GOLD)-100)
  endif
  set TempInteger=UltimatesHeroId[GetPlayerId(Me)]
  set UltimatesHeroId[GetPlayerId(Me)]=UltimatesHeroId[GetPlayerId(YKD)]
  set UltimatesHeroId[GetPlayerId(YKD)]=TempInteger
  set YND=ReliableGold[GetPlayerId(Me)]
  set ReliableGold[GetPlayerId(Me)]=ReliableGold[GetPlayerId(YKD)]
  set ReliableGold[GetPlayerId(YKD)]=YND
  call DisableTrigger(t_manipulateitem)
  if IMaxIF(GetUnitAbilityLevel(u1,'A03E'),GetUnitAbilityLevel(u1,'QP0Q'))>0 then
    set group003=u1
    set group006=u2
    call ExeFunc("YOD")
  elseif IMaxIF(GetUnitAbilityLevel(u2,'A03E'),GetUnitAbilityLevel(u2,'QP0Q'))>0 then
    set group003=u2
    set group006=u1
    call ExeFunc("YOD")
  endif
  if GetUnitAbilityLevel(u1,'A0CY')>0 or GetUnitAbilityLevel(u1,'QP1K')>0 then
    set group003=u1
    set group006=u2
    call ExeFunc("YPD")
  endif
  if GetUnitAbilityLevel(u2,'A0CY')>0 or GetUnitAbilityLevel(u2,'QP1K')>0 then
    set group003=u2
    set group006=u1
    call ExeFunc("YPD")
  endif
  call FlushChildHashtable(hashtable019,(800+GetPlayerId(GetOwningPlayer(u1))))
  call FlushChildHashtable(hashtable019,(800+GetPlayerId(GetOwningPlayer(u2))))
  set g=GetAvailableGroup()
  set bj_groupEnumOwningPlayer=Me
  call GroupEnumUnitsInRect(g,GetWorldBounds(),filterGetUnitsInRectOfPlayer)
  call ForGroup(g,function YID)
  call KillGroup(g)
  set g=GetAvailableGroup()
  set bj_groupEnumOwningPlayer=YKD
  call GroupEnumUnitsInRect(g,GetWorldBounds(),filterGetUnitsInRectOfPlayer)
  call ForGroup(g,function YID)
  call KillGroup(g)
  call SetUnitOwner(u2,Me,true)
  call SetUnitOwner(u1,YKD,true)
  set udg_Hero[GetPlayerId(Me)]=u2
  set HeroTypeId[GetPlayerId(Me)]=GetUnitTypeId(u2)
  call SaveInteger(hashtable019,GetPlayerId(Me),'hHid',GetUnitPointValue(u2))//[lich] fix swap icons
  
  set udg_Hero[GetPlayerId(YKD)]=u1
  call SaveInteger(hashtable019,GetPlayerId(YKD),'hHid',GetUnitPointValue(u1))//[lich] fix swap icons
  set HeroTypeId[GetPlayerId(YKD)]=GetUnitTypeId(u1)
  call SetPlayerName(Me,(IL7[GetPlayerId((Me))])+" ("+UQ8(udg_Hero[GetPlayerId(Me)])+")")
  call SetPlayerName(YKD,(IL7[GetPlayerId((YKD))])+" ("+UQ8(udg_Hero[GetPlayerId(YKD)])+")")
  call UnitAddItem(YMD,UnitItemInSlot(u2,0))
  call UnitAddItem(YMD,UnitItemInSlot(u2,1))
  call UnitAddItem(YMD,UnitItemInSlot(u2,2))
  call UnitAddItem(YMD,UnitItemInSlot(u2,3))
  call UnitAddItem(YMD,UnitItemInSlot(u2,4))
  call UnitAddItem(YMD,UnitItemInSlot(u2,5))
  set FWD=UnitItemInSlot(u1,0)
  if FWD!=null then
    call SetItemPlayer(FWD,Me,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u2,FWD)
  endif
  set FWD=UnitItemInSlot(u1,1)
  if FWD!=null then
    call SetItemPlayer(FWD,Me,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u2,FWD)
  endif
  set FWD=UnitItemInSlot(u1,2)
  if FWD!=null then
    call SetItemPlayer(FWD,Me,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u2,FWD)
  endif
  set FWD=UnitItemInSlot(u1,3)
  if FWD!=null then
    call SetItemPlayer(FWD,Me,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u2,FWD)
  endif
  set FWD=UnitItemInSlot(u1,4)
  if FWD!=null then
    call SetItemPlayer(FWD,Me,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u2,FWD)
  endif
  set FWD=UnitItemInSlot(u1,5)
  if FWD!=null then
    call SetItemPlayer(FWD,Me,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u2,FWD)
  endif
  set FWD=UnitItemInSlot(YMD,0)
  if FWD!=null then
    call SetItemPlayer(FWD,YKD,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u1,FWD)
  endif
  set FWD=UnitItemInSlot(YMD,1)
  if FWD!=null then
    call SetItemPlayer(FWD,YKD,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u1,FWD)
  endif
  set FWD=UnitItemInSlot(YMD,2)
  if FWD!=null then
    call SetItemPlayer(FWD,YKD,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u1,FWD)
  endif
  set FWD=UnitItemInSlot(YMD,3)
  if FWD!=null then
    call SetItemPlayer(FWD,YKD,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u1,FWD)
  endif
  set FWD=UnitItemInSlot(YMD,4)
  if FWD!=null then
    call SetItemPlayer(FWD,YKD,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u1,FWD)
  endif
  set FWD=UnitItemInSlot(YMD,5)
  if FWD!=null then
    call SetItemPlayer(FWD,YKD,false)
    call SetItemUserData(FWD,1)
    call UnitAddItem(u1,FWD)
  endif
  call RemoveUnit(YMD)
  call EnableTrigger(t_manipulateitem)
  if(IsUnitType(u1,UNIT_TYPE_MELEE_ATTACKER) or GetUnitTypeId(u1)=='H06S')and FindItemOfType(u1,Item_Real[indexid_QuellingBladeRanged])!=null then
    call UnitRemoveItem(u1,FindItemOfType(u1,Item_Real[indexid_QuellingBladeRanged]))
  elseif(IsUnitType(u1,UNIT_TYPE_RANGED_ATTACKER) or GetUnitTypeId(u1)=='H06S')and FindItemOfType(u1,Item_Real[indexid_QuellingBlade])!=null then
    call UnitRemoveItem(u1,FindItemOfType(u1,Item_Real[indexid_QuellingBlade]))
  endif
  if(IsUnitType(u2,UNIT_TYPE_MELEE_ATTACKER) or GetUnitTypeId(u1)=='H06S')and FindItemOfType(u2,Item_Real[indexid_QuellingBladeRanged])!=null then
    call UnitRemoveItem(u1,FindItemOfType(u2,Item_Real[indexid_QuellingBladeRanged]))
  elseif(IsUnitType(u2,UNIT_TYPE_RANGED_ATTACKER) or GetUnitTypeId(u1)=='H06S')and FindItemOfType(u2,Item_Real[indexid_QuellingBlade])!=null then
    call UnitRemoveItem(u1,FindItemOfType(u2,Item_Real[indexid_QuellingBlade]))
  endif
  if GetUnitTypeId(u1)=='H06S' and FindItemOfType(u1,Item_Real[indexid_QuellingBlade])!=null then
    call UnitRemoveItem(u1,FindItemOfType(u1,Item_Real[indexid_QuellingBlade]))
  elseif GetUnitTypeId(u1)=='H06S' and FindItemOfType(u1,Item_Real[indexid_QuellingBladeRanged])!=null then
    call UnitRemoveItem(u1,FindItemOfType(u1,Item_Real[indexid_QuellingBladeRanged]))
  endif
  if GetUnitTypeId(u2)=='H06S' and FindItemOfType(u2,Item_Real[indexid_QuellingBlade])!=null then
    call UnitRemoveItem(u2,FindItemOfType(u2,Item_Real[indexid_QuellingBlade]))
  elseif GetUnitTypeId(u2)=='H06S' and FindItemOfType(u2,Item_Real[indexid_QuellingBladeRanged])!=null then
    call UnitRemoveItem(u2,FindItemOfType(u2,Item_Real[indexid_QuellingBladeRanged]))
  endif
  if(IsUnitType(u1,UNIT_TYPE_MELEE_ATTACKER))and FindItemOfType(u1,Item_Real[indexid_PoormansShieldRanged])!=null then
    call UnitRemoveItem(u1,FindItemOfType(u1,Item_Real[indexid_PoormansShieldRanged]))
  elseif(IsUnitType(u1,UNIT_TYPE_RANGED_ATTACKER))and FindItemOfType(u1,Item_Real[indexid_QuellingBlade])!=null then
    call UnitRemoveItem(u1,FindItemOfType(u1,Item_Real[indexid_QuellingBlade]))
  endif
  if(IsUnitType(u2,UNIT_TYPE_MELEE_ATTACKER))and FindItemOfType(u2,Item_Real[indexid_PoormansShieldRanged])!=null then
    call UnitRemoveItem(u1,FindItemOfType(u2,Item_Real[indexid_PoormansShieldRanged]))
  elseif(IsUnitType(u2,UNIT_TYPE_RANGED_ATTACKER))and FindItemOfType(u2,Item_Real[indexid_PoormansShield])!=null then
    call UnitRemoveItem(u1,FindItemOfType(u2,Item_Real[indexid_PoormansShield]))
  endif
  call SetPlayerAbilityAvailable2(Me,EngineeringUpgradeSkillID[PlayerSkillNumber[GetPlayerId(YKD)*PlayerSkillOffset+1]],false)
  call SetPlayerAbilityAvailable2(Me,EngineeringUpgradeSkillID[PlayerSkillNumber[GetPlayerId(YKD)*PlayerSkillOffset+2]],false)
  call SetPlayerAbilityAvailable2(Me,EngineeringUpgradeSkillID[PlayerSkillNumber[GetPlayerId(YKD)*PlayerSkillOffset+3]],false)
  call SetPlayerAbilityAvailable2(Me,EngineeringUpgradeSkillID[PlayerSkillNumber[GetPlayerId(YKD)*PlayerSkillOffset+4]],false)
  call SetPlayerAbilityAvailable2(YKD,EngineeringUpgradeSkillID[PlayerSkillNumber[GetPlayerId(Me)*PlayerSkillOffset+1]],false)
  call SetPlayerAbilityAvailable2(YKD,EngineeringUpgradeSkillID[PlayerSkillNumber[GetPlayerId(Me)*PlayerSkillOffset+2]],false)
  call SetPlayerAbilityAvailable2(YKD,EngineeringUpgradeSkillID[PlayerSkillNumber[GetPlayerId(Me)*PlayerSkillOffset+3]],false)
  call SetPlayerAbilityAvailable2(YKD,EngineeringUpgradeSkillID[PlayerSkillNumber[GetPlayerId(Me)*PlayerSkillOffset+4]],false)
  loop
    exitwhen i>4+NumberOfExtraAbilities
    set megusta[i]=PlayerSkillNumber[GetPlayerId(Me)*PlayerSkillOffset+i]
    set PlayerSkillNumber[GetPlayerId(Me)*PlayerSkillOffset+i]=PlayerSkillNumber[GetPlayerId(YKD)*PlayerSkillOffset+i]
    set PlayerSkillNumber[GetPlayerId(YKD)*PlayerSkillOffset+i]=megusta[i]
    set i=i+1
  endloop
  call ClearSelectionForPlayer(Me)
  call SelectUnitAddForPlayer(u2,Me)
  call ClearSelectionForPlayer(YKD)
  call SelectUnitAddForPlayer(u1,YKD)
  call FlushChildHashtable(hashtable019,(800+GetPlayerId(Me)))
  call FlushChildHashtable(hashtable019,(800+GetPlayerId(YKD)))
  set tt_unit1=u1
  call ExeFunc("VW9")
  set tt_unit1=u2
  call ExeFunc("VW9")
  call FV9(GetOwningPlayer(u1),"9",GetUnitTypeId(u1))
  call FV9(GetOwningPlayer(u2),"9",GetUnitTypeId(u2))
  call Traffic_RegisterData("SWAP_"+I2S(GetPlayerId(GetOwningPlayer(u1)))+"_"+I2S(GetPlayerId(GetOwningPlayer(u2))),GetUnitTypeId(u1))
  call Traffic_RegisterData("SWAP_"+I2S(GetPlayerId(GetOwningPlayer(u2)))+"_"+I2S(GetPlayerId(GetOwningPlayer(u1))),GetUnitTypeId(u2))
  call GR9(Me)
  call GR9(YKD)
  set Me=null
  set YKD=null
  set g=null
  set YMD=null
  set FWD=null
endfunction

function YRD takes unit u1,unit u2 returns boolean
  return(LoadBoolean(hashtable019,(800+GetPlayerId(GetOwningPlayer(u2))),(GetUnitTypeId(u1)+GetUnitTypeId(u2))))
endfunction

function SwapHero_Off takes nothing returns nothing
  call FlushChildHashtable(hashtable019,(800+GetPlayerId(GetTriggerPlayer())))
endfunction

function YSD takes player p returns integer
  local integer i=1
  loop
    exitwhen i>5
    if Sentinels[i]==p or Scourges[i]==p then
      return i
    endif
    set i=i+1
  endloop
  return-1
endfunction

function YTD takes unit u1,unit u2,boolean YUD returns boolean
  call SaveBoolean(hashtable019,(800+GetPlayerId(GetOwningPlayer(u1))),(GetUnitTypeId(u1)+GetUnitTypeId(u2)),(true))
  if YRD(u1,u2)then
    call YJD(u1,u2)
    return true
  else
    call DisplayTimedTextToPlayer(GetOwningPlayer(u2),0,group008,30,"  ")
    call DisplayTimedTextToPlayer(GetOwningPlayer(u2),0,group008,30,"						 "+udg_Colors[GetPlayerId(GetOwningPlayer(u1))]+GetUnitName(u1)+"|r |cff99ccff"+GetObjectName('n082')+" "+GetObjectName('n083')+"|r |c00ff0303-swap "+I2S(YSD(GetOwningPlayer(u1)))+"|r |cff99ccff"+GetObjectName('n081')+"|r")
    call DisplayTimedTextToPlayer(GetOwningPlayer(u2),0,group008,30,"  ")
    if YUD then
      call DisplayTimedTextToPlayer(GetOwningPlayer(u1),0,group008,30,"  ")
      call DisplayTimedTextToPlayer(GetOwningPlayer(u1),0,group008,30,"|cff99ccff"+GetObjectName('n08C')+" |r"+udg_Colors[GetPlayerId(GetOwningPlayer(u2))]+GetUnitName(u2)+"|r")
      call DisplayTimedTextToPlayer(GetOwningPlayer(u1),0,group008,30,"  ")
    endif
  endif
  return false
endfunction

function YVD takes nothing returns nothing
  local integer i=S2I(SubString(GetEventPlayerChatString(),6,StringLength(GetEventPlayerChatString())))
  if GetEventPlayerChatString()=="-swapall"then
    set i=1
    set tt_unit2=udg_Hero[GetPlayerId(GetTriggerPlayer())]
    loop
      exitwhen i>5
      if IsSentinel(GetTriggerPlayer())then
        set tt_player1=Sentinels[i]
      else
        set tt_player1=Scourges[i]
      endif
      set tt_unit1=udg_Hero[GetPlayerId(tt_player1)]
      if not(tt_unit2==null or GetOwningPlayer(tt_unit2)!=GetTriggerPlayer()or tt_unit1==null or GetOwningPlayer(tt_unit1)!=tt_player1 or tt_player1==GetTriggerPlayer())then
        if YTD(tt_unit2,tt_unit1,false)then
          return
        endif
      endif
      set i=i+1
    endloop
    return
  elseif i<1 or i>5 then
    call Error(GetTriggerPlayer(),GetObjectName('n02Z'))
    return
  endif
  set tt_unit2=udg_Hero[GetPlayerId(GetTriggerPlayer())]
  if IsSentinel(GetTriggerPlayer())then
    set tt_player1=Sentinels[i]
  else
    set tt_player1=Scourges[i]
  endif
  set tt_unit1=udg_Hero[GetPlayerId(tt_player1)]
  if tt_unit2==null or GetOwningPlayer(tt_unit2)!=GetTriggerPlayer()or tt_unit1==null or GetOwningPlayer(tt_unit1)!=tt_player1 or tt_player1==GetTriggerPlayer()then
    call Error(GetTriggerPlayer(),GetObjectName('n02Z'))
    return
  endif
  call YTD(tt_unit2,tt_unit1,true)
endfunction

function YWD takes nothing returns nothing
  local integer i
  local player p
  local unit u
  local string s
  if GetLocalPlayer()==GetTriggerPlayer()then
    call ClearTextMessages()
  endif
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,45,"|cff99ccff"+GetObjectName('n08B')+"|r")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,45," ")
  set i=1
  loop
    exitwhen i>5
    set p=Sentinels[i]
    set u=udg_Hero[GetPlayerId(p)]
    if IsPlayerAlly(GetTriggerPlayer(),p)and GetTriggerPlayer()!=p and u!=null and GetOwningPlayer(u)==p then
      set s=" "
      if YRD(udg_Hero[GetPlayerId(GetTriggerPlayer())],u)then
        set s=" |c00ff0303("+GetObjectName('n085')+")|r"
      endif
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,45,udg_Colors[GetPlayerId(p)]+I2S(i)+"|r"+" - "+"|cff99ccff"+GetUnitName(u)+"|r"+s)
    endif
    set p=Scourges[i]
    set u=udg_Hero[GetPlayerId(p)]
    if IsPlayerAlly(GetTriggerPlayer(),p)and GetTriggerPlayer()!=p and u!=null and GetOwningPlayer(u)==p then
      set s=" "
      if YRD(udg_Hero[GetPlayerId(GetTriggerPlayer())],u)then
        set s=" |c00ff0303("+GetObjectName('n085')+")|r"
      endif
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,45,udg_Colors[GetPlayerId(p)]+I2S(i)+"|r"+" - "+"|cff99ccff"+GetUnitName(u)+"|r"+s)
    endif
    set i=i+1
  endloop
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,45," ")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,45,"|cff99ccff"+GetObjectName('n083')+"|r |c00ff0303-swap #|r |cff99ccff"+GetObjectName('n086')+" -swapcancel "+GetObjectName('n087')+"|r")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,45," ")
  set u=null
  set p=null
endfunction

function YXD takes player whichPlayer returns boolean
  local integer VT8=1
  local integer YYD=0
  loop
    exitwhen VT8>5
    if IsSentinel(whichPlayer)then
      if udg_Hero[GetPlayerId(Sentinels[VT8])]!=null and Sentinels[VT8]!=whichPlayer and GetHeroLevel(udg_Hero[GetPlayerId(Sentinels[VT8])])==1 then
        set YYD=YYD+1
      endif
    else
      if udg_Hero[GetPlayerId(Scourges[VT8])]!=null and Scourges[VT8]!=whichPlayer and GetHeroLevel(udg_Hero[GetPlayerId(Scourges[VT8])])==1 then
        set YYD=YYD+1
      endif
    endif
    set VT8=VT8+1
  endloop
  if YYD>0 then
    return true
  else
    return false
  endif
endfunction

function YZD takes nothing returns boolean
  if Mode_NR or Mode_NS then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,"-swaphero "+GetObjectName('n088'))
    return false
  endif
  if PlayerUseRandomStatus[GetPlayerId(GetTriggerPlayer())]==true then
    if GetPlayerState(GetTriggerPlayer(),PLAYER_STATE_RESOURCE_GOLD)<100 then
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,"Need at least 100 gold to swap after randoming.")
      return false
    endif
  else
    
  endif
  if GetUnitState(udg_Hero[GetPlayerId(GetTriggerPlayer())],UNIT_STATE_LIFE)<1 then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n08F'))
    return false
  endif
  if boolean033 then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n08G')+" -swaphero.")
    return false
  endif
  if YXD(GetTriggerPlayer())==false then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n08H'))
    return false
  endif
  return true
endfunction

function WZD takes nothing returns nothing
  if YZD()then
    if GetEventPlayerChatString()=="-swap"or GetEventPlayerChatString()=="-swaphero"then
      call YWD()
    elseif GetEventPlayerChatString()=="-swapcancel"then
      call FlushChildHashtable(hashtable019,(800+GetPlayerId(GetTriggerPlayer())))
    else
      call YVD()
    endif
  endif
endfunction

function YAD takes nothing returns boolean
  return false
  return GetSpellAbilityId()=='A0FI'
endfunction

function YBD takes integer AF8,unit YCD,unit Y3D returns nothing
  local integer VT8=1
  local integer VU8=GetUnitAbilityLevel(YCD,AF8)
  loop
    exitwhen VT8>VU8
    call SelectHeroSkill(Y3D,AF8)
    set VT8=VT8+1
  endloop
endfunction

function Y6D takes nothing returns nothing
  local integer VT8
  local integer VU8
  local unit YLD
  local location YT9=GetUnitLoc(GetTriggerUnit())
  set YLD=CreateUnitAtLoc(GetOwningPlayer(GetTriggerUnit()),GetUnitTypeId(GetTriggerUnit()),YT9,bj_UNIT_FACING)
  call SetHeroXP(YLD,GetHeroXP(GetTriggerUnit()),false)
  set VT8=1
  set VU8=GetUnitAbilityLevel(GetTriggerUnit(),'Aamk')
  loop
    exitwhen VT8>VU8
    call SelectHeroSkill(bj_lastCreatedUnit,'Aamk')
    set VT8=VT8+1
  endloop
  set VT8=0
  set VU8=5
  loop
    exitwhen VT8>VU8
    call UnitAddItem(YLD,UnitItemInSlot(GetTriggerUnit(),VT8))
    set VT8=VT8+1
  endloop
  if(GetUnitTypeId(GetTriggerUnit())=='Eevi')then
    call YBD('A04L',GetTriggerUnit(),YLD)
    call YBD('A0H4',GetTriggerUnit(),YLD)
    call YBD('AEvi',GetTriggerUnit(),YLD)
    call YBD('A07Q',GetTriggerUnit(),YLD)
  endif
  if(GetUnitTypeId(GetTriggerUnit())=='U008')then
    call YBD('A03D',GetTriggerUnit(),YLD)
    call YBD('A02G',GetTriggerUnit(),YLD)
    call YBD('A03E',GetTriggerUnit(),YLD)
    call YBD('A093',GetTriggerUnit(),YLD)
    call YBD('QB02',GetTriggerUnit(),YLD)
  endif
  if(GetUnitTypeId(GetTriggerUnit())=='U007')then
    call YBD('A0F9',GetTriggerUnit(),YLD)
    call YBD('A06Y',GetTriggerUnit(),YLD)
    call YBD('A01E',GetTriggerUnit(),YLD)
    call YBD('A028',GetTriggerUnit(),YLD)
    call YBD('QM00',GetTriggerUnit(),YLD)
  endif
  if(GetUnitTypeId(GetTriggerUnit())=='Hlgr')then
    call YBD('A03G',GetTriggerUnit(),YLD)
    call YBD('A03F',GetTriggerUnit(),YLD)
    call YBD('A0O3',GetTriggerUnit(),YLD)
    call YBD('AEim',GetTriggerUnit(),YLD)
  endif
  if(GetUnitTypeId(GetTriggerUnit())=='Ekee')then
    call YBD('A035',GetTriggerUnit(),YLD)
    call YBD('A06W',GetTriggerUnit(),YLD)
    call YBD('A06V',GetTriggerUnit(),YLD)
    call YBD('A06X',GetTriggerUnit(),YLD)
  endif
  call RemoveHero(GetTriggerUnit())
  call RemoveLocation(YT9)
  set udg_Hero[GetPlayerId(GetOwningPlayer(YLD))]=YLD
  set HeroTypeId[GetPlayerId(GetOwningPlayer(YLD))]=GetUnitTypeId(YLD)
  set YLD=null
  set YT9=null
endfunction

function Y1D takes nothing returns boolean
  local integer UZ8=GetUnitTypeId(udg_Hero[GetPlayerId(GetTriggerPlayer())])
  return(UZ8=='U008' or UZ8=='U007' or UZ8=='Hlgr' or UZ8=='Eevi' or UZ8=='Ekee')and(RectContainsUnit(boolean036,udg_Hero[GetPlayerId(GetTriggerPlayer())])or RectContainsUnit(Z5,udg_Hero[GetPlayerId(GetTriggerPlayer())]))
endfunction

function Y0D takes nothing returns nothing
  local unit Hero=udg_Hero[GetPlayerId(GetTriggerPlayer())]
  call UnitAddAbility(Hero,'A0FI')
  call IssueImmediateOrderById(Hero,852663)
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,120.,"|c00ff0303"+GetObjectName('n08I')+" "+UQ8(GetEnumUnit())+". "+GetObjectName('n08J')+"|r")
  set Hero=null
endfunction

function WAD takes nothing returns nothing
  if Y1D()then
    call Y0D()
  endif
endfunction

function Y5D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Count=GetTriggerEvalCount(t)
  local real x
  local real y
  if GetTriggerEventId()==EVENT_UNIT_DEATH or Count>60 then
    if((LoadInteger(hashtable019,(GetHandleId((Hero))),((4259))))==1)==false then
      if IsSentinel(GetOwningPlayer(Hero))then
        set x=GetRectCenterX(gg_rct_Hero_Creation_NE)
        set y=GetRectCenterY(gg_rct_Hero_Creation_NE)
      else
        set x=GetRectCenterX(gg_rct_Hero_Creation_UD)
        set y=GetRectCenterY(gg_rct_Hero_Creation_UD)
      endif
      call SetUnitPosition(Hero,x,y)
      call PauseUnit(Hero,false)
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call PauseUnit(Hero,true)
  endif
  set t=null
  set Hero=null
  return false
endfunction

function Y2D takes player p returns nothing
  local unit Hero=udg_Hero[GetPlayerId(p)]
  local trigger t
  if IsDead(Hero)==false then
    set t=CreateTrigger()
    call DisplayTimedTextToPlayer(p,0,group008,30.,GetObjectName('n08K'))
    call UnitRemoveBuffs(Hero,true,false)
    call UnitRemoveAbility(Hero,'Bcyc')
    call UnitRemoveAbility(Hero,'Bcy2')
    call UnitRemoveAbility(Hero,'B02J')
    call UnitRemoveAbility(Hero,'BUsp')
    call UnitRemoveAbility(Hero,'Bust')
    call UnitRemoveAbility(Hero,'B02F')
    call PauseUnit(Hero,true)
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function Y5D))
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(Hero))
  endif
  set p=null
  set Hero=null
  set t=null
endfunction

function Z4D takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call Y2D(p)
  endif
  set t=null
  set p=null
  return false
endfunction

function WBD takes nothing returns nothing
  local player p=GetTriggerPlayer()
  local unit Hero=udg_Hero[GetPlayerId(p)]
  local trigger t
  if IsDead(Hero)==false then
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,3.5,false)
    call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DAMAGED)
    call TriggerAddCondition(t,Condition(function Z4D))
    call SavePlayerHandle(hashtable019,(GetHandleId(t)),(54),(p))
  endif
  set p=null
  set Hero=null
  set t=null
endfunction

function Z7D takes player p returns string
  local string s=L3[GetPlayerId(p)]
  if L3[GetPlayerId(p)]!="Here"then
    return" |c00ff0303("+GetObjectName('n089')+" at "+SubString(s,10,StringLength(s))+"|c00ff0303)|r"
  endif
  return" "
endfunction

function WCD takes nothing returns nothing
  local integer VT8=1
  local integer VU8=5
  local integer ZG8
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,20," ")
  if(IsScourge(GetTriggerPlayer()))then
    loop
      exitwhen VT8>VU8
      set ZG8=GetPlayerId(Sentinels[VT8])
      if(udg_Hero[ZG8]!=null)then
        call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,20,udg_Colors[ZG8]+(IL7[GetPlayerId((Sentinels[VT8]))])+"|r "+GetObjectName('n08M')+" "+GetUnitName(udg_Hero[ZG8])+" ("+GetObjectName('n08L')+" "+I2S(GetUnitLevel(udg_Hero[ZG8]))+")"+Z7D(Sentinels[VT8]))
      endif
      set VT8=VT8+1
    endloop
  else
    loop
      exitwhen VT8>VU8
      set ZG8=GetPlayerId(Scourges[VT8])
      if(udg_Hero[ZG8]!=null)then
        call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,20,udg_Colors[ZG8]+(IL7[GetPlayerId((Scourges[VT8]))])+"|r "+GetObjectName('n08M')+" "+GetUnitName(udg_Hero[ZG8])+" ("+GetObjectName('n08L')+" "+I2S(GetUnitLevel(udg_Hero[ZG8]))+")"+Z7D(Scourges[VT8]))
      endif
      set VT8=VT8+1
    endloop
  endif
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,20," ")
endfunction

function Z8D takes unit u returns boolean
  return GetUnitTypeId(u)=='N01O' or GetUnitTypeId(u)=='N013' or GetUnitTypeId(u)=='N014' or GetUnitTypeId(u)=='N015'
endfunction

function Z9D takes unit u returns unit
  local integer Cache=GetHandleId(GetOwningPlayer(u))
  return(LoadUnitHandle(hashtable019,(Cache),(333)))
endfunction

function W3D takes nothing returns nothing
  local unit u
  local integer i=0
  if(udg_Hero[GetPlayerId(GetTriggerPlayer())]==null)then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetObjectName('n08A'))
  else
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetUnitName(udg_Hero[GetPlayerId(GetTriggerPlayer())])+" "+GetObjectName('n08N')+" "+I2S(R2I(.5+GetUnitMoveSpeedLOD(udg_Hero[GetPlayerId(GetTriggerPlayer())]))))
    if Z8D(udg_Hero[GetPlayerId(GetTriggerPlayer())])then
      set u=Z9D(udg_Hero[GetPlayerId(GetTriggerPlayer())])
      if u!=null then
        call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetUnitName(u)+" "+GetObjectName('n08N')+" "+I2S(R2I(.5+GetUnitMoveSpeedLOD(u))))
      endif
    endif
  endif
  set u=null
endfunction

function W6D takes nothing returns nothing
  local unit u
  local integer i=0
  if(udg_Hero[GetPlayerId(GetTriggerPlayer())]==null)then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetObjectName('n08A'))
  else
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetUnitName(udg_Hero[GetPlayerId(GetTriggerPlayer())])+" "+GetObjectName('n08N')+" "+I2S(R2I(.5+GetUnitMoveSpeedLOD(udg_Hero[GetPlayerId(GetTriggerPlayer())]))))
    if Z8D(udg_Hero[GetPlayerId(GetTriggerPlayer())])then
      set u=Z9D(udg_Hero[GetPlayerId(GetTriggerPlayer())])
      if u!=null then
        call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetUnitName(u)+" "+GetObjectName('n08N')+" "+I2S(R2I(.5+GetUnitMoveSpeedLOD(u))))
      endif
    endif
    loop
      exitwhen i>16
      set u=udg_Hero[i]
      if u!=null and u!=udg_Hero[GetPlayerId(GetTriggerPlayer())]and IsUnitAlly(u,GetTriggerPlayer()) then
        call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetUnitName(u)+" "+GetObjectName('n08N')+" "+I2S(R2I(.5+GetUnitMoveSpeedLOD(u))))
      endif
      set i=i+1
    endloop
  endif
  set u=null
endfunction

function WLD takes nothing returns nothing
  call SaveBoolean(hashtable019,(GetHandleId(GetTriggerPlayer())),(139),(true))
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n08R'))
endfunction

function W1D takes nothing returns nothing
  call SaveBoolean(hashtable019,(GetHandleId(GetTriggerPlayer())),(139),(false))
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n08O'))
endfunction

function W0D takes nothing returns nothing
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,"   "+GetObjectName('n08P')+" "+I2S(PlayerCS[GetPlayerId(GetTriggerPlayer())])+" "+GetObjectName('n08Q')+" "+I2S(PlayerDenyCounter[GetPlayerId(GetTriggerPlayer())])+" "+GetObjectName('n08S')+" "+I2S(PlayerNeutralsCounter[GetPlayerId(GetTriggerPlayer())]))
endfunction

function W5D takes nothing returns nothing
  local integer x=GetPlayerId(GetTriggerPlayer())
  if(GetEventPlayerChatString()=="-cson")then
    set CSONStatus1[x]=true
    set CSONStatus2[x]=true
  else
    set CSONStatus1[x]=false
    set CSONStatus2[x]=false
  endif
endfunction

function ZDD takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer i=(LoadInteger(hashtable019,(Cache),(34)))
  local real x
  local real y
  if FixedCameraOnHero[i]==false then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif udg_Hero[i]!=null and IsDead(udg_Hero[i])==false then
    set x=GetUnitX(udg_Hero[i])
    set y=GetUnitY(udg_Hero[i])
    call PanCameraToTimedForPlayer(Player(i),x,y,0)
  endif
  set t=null
  return false
endfunction

function X3D takes nothing returns nothing
  local integer x=GetPlayerId(GetTriggerPlayer())
  local trigger t
  local integer Cache
  local integer i
  if FixedCameraOnHero[x]==false and(GetEventPlayerChatString()=="-center"or GetEventPlayerChatString()=="-c")then
    set FixedCameraOnHero[x]=true
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,.01,true)
    call TriggerAddCondition(t,Condition(function ZDD))
    call SaveInteger(hashtable019,(Cache),(34),(x))
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,GetObjectName('n0JW'))
  elseif GetEventPlayerChatString()=="-centeroff"or GetEventPlayerChatString()=="-co"then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,GetObjectName('n0JX'))
    set FixedCameraOnHero[x]=false
  endif
  set t=null
endfunction

function XLD takes nothing returns nothing
  set AutoselectionStatus[GetPlayerId(GetTriggerPlayer())]=false
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,5,GetObjectName('n0JZ'))
endfunction

function X1D takes nothing returns nothing
  set AutoselectionStatus[GetPlayerId(GetTriggerPlayer())]=true
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,5,GetObjectName('n0K0'))
endfunction

function X6D takes nothing returns nothing
  local integer i=0
  local integer id=GetPlayerId(GetTriggerPlayer())
  local integer Count=0
  local integer ZED=0
  local player p
  if ZY7==false or EL==false then
    return
  endif
  if ZA7+90<(TimerGetElapsed(GlobalTimer))then
    loop
      exitwhen i>15
      set ZZ7[i]=false
      set i=i+1
    endloop
  endif
  set ZA7=(TimerGetElapsed(GlobalTimer))+90
  set ZZ7[id]=true
  set i=0
  loop
    exitwhen i>15
    if IsSentinel(GetTriggerPlayer())then
      if IsSentinel(Player(i))and IsPlayer(Player(i))then
        set ZED=ZED+1
        if ZZ7[i]then
          set Count=Count+1
        endif
      endif
    else
      if IsScourge(Player(i))and IsPlayer(Player(i))then
        set ZED=ZED+1
        if ZZ7[i]then
          set Count=Count+1
        endif
      endif
    endif
    set i=i+1
  endloop
  if Count*2>ZED then
    if IsSentinel(GetTriggerPlayer())then
      set i=0
      loop
        exitwhen i>5
        set p=Sentinels[i]
        if IsPlayerLeftGame[GetPlayerId(p)] and HeroHasBeenUnlocked[GetPlayerId(p)]==false then
          call DisplayTimedTextToForceEx(Force_SentPlayers,10,GetObjectName('n0KD')+" "+(IL7[GetPlayerId((p))]))
          call C08(p)
          set HeroHasBeenUnlocked[GetPlayerId(p)]=true
        endif
        set i=i+1
      endloop
    else
      set i=0
      loop
        exitwhen i>5
        set p=Scourges[i]
        if IsPlayerLeftGame[GetPlayerId(p)] and HeroHasBeenUnlocked[GetPlayerId(p)]==false then
          call DisplayTimedTextToForceEx(Force_ScourgePlayers,10,GetObjectName('n0KD')+" "+(IL7[GetPlayerId((p))]))
          call C08(p)
          set HeroHasBeenUnlocked[GetPlayerId(p)]=true
        endif
        set i=i+1
      endloop
    endif
  else
    if IsSentinel(GetTriggerPlayer())then
      call DisplayTimedTextToForceEx(Force_SentPlayers,10,GetObjectName('n0KB')+" "+I2S(Count)+"/"+I2S(ZED)+" ("+(IL7[GetPlayerId((GetTriggerPlayer()))])+")")
    else
      call DisplayTimedTextToForceEx(Force_ScourgePlayers,10,GetObjectName('n0KB')+" "+I2S(Count)+"/"+I2S(ZED)+" ("+(IL7[GetPlayerId((GetTriggerPlayer()))])+")")
    endif
  endif
  set p=null
endfunction

function ZFD takes nothing returns nothing
  local integer i=1
  local integer time
  local player p
  loop
    exitwhen i>5
    set p=Sentinels[i]
    set time=R2I(TimerGetRemaining(HeroRespawnTimer[GetPlayerId(p)]))
    if time>0 and ShowDeathTimer[GetPlayerId(p)]and CL==false and GameEnded==false then
      call PlayerSetLeaderboard(p,ZC7[GetPlayerId(p)])
      call LeaderboardDisplay(ZC7[GetPlayerId(p)],true)
      call LeaderboardSetLabel(ZC7[GetPlayerId(p)],"   "+GetObjectName('n08V')+" "+I2S(time)+" "+GetObjectName('n095'))
    else
      call LeaderboardDisplay(ZC7[GetPlayerId(p)],false)
    endif
    set p=Scourges[i]
    set time=R2I(TimerGetRemaining(HeroRespawnTimer[GetPlayerId(p)]))
    if time>0 and ShowDeathTimer[GetPlayerId(p)]and CL==false and GameEnded==false then
      call PlayerSetLeaderboard(p,ZC7[GetPlayerId(p)])
      call LeaderboardDisplay(ZC7[GetPlayerId(p)],true)
      call LeaderboardSetLabel(ZC7[GetPlayerId(p)],"   "+GetObjectName('n08V')+" "+I2S(time)+" "+GetObjectName('n095'))
    else
      call LeaderboardDisplay(ZC7[GetPlayerId(p)],false)
    endif
    set i=i+1
  endloop
  set p=null
endfunction

function ZGD takes nothing returns nothing
  local integer x=0
  set x=x+1
  set ZC7[GetPlayerId(Sentinels[x])]=CreateLeaderboard()
  call PlayerSetLeaderboard(Sentinels[x],ZC7[GetPlayerId(Sentinels[x])])
  call LeaderboardDisplay(ZC7[GetPlayerId(Sentinels[x])],false)
  call LeaderboardSetLabel(ZC7[GetPlayerId(Sentinels[x])],GetObjectName('n0E4')+": ")
  set ZC7[GetPlayerId(Scourges[x])]=CreateLeaderboard()
  call PlayerSetLeaderboard(Scourges[x],ZC7[GetPlayerId(Scourges[x])])
  call LeaderboardDisplay(ZC7[GetPlayerId(Scourges[x])],false)
  call LeaderboardSetLabel(ZC7[GetPlayerId(Scourges[x])],GetObjectName('n0E4')+": ")
  set x=x+1
  set ZC7[GetPlayerId(Sentinels[x])]=CreateLeaderboard()
  call PlayerSetLeaderboard(Sentinels[x],ZC7[GetPlayerId(Sentinels[x])])
  call LeaderboardDisplay(ZC7[GetPlayerId(Sentinels[x])],false)
  call LeaderboardSetLabel(ZC7[GetPlayerId(Sentinels[x])],GetObjectName('n0E4')+": ")
  set ZC7[GetPlayerId(Scourges[x])]=CreateLeaderboard()
  call PlayerSetLeaderboard(Scourges[x],ZC7[GetPlayerId(Scourges[x])])
  call LeaderboardDisplay(ZC7[GetPlayerId(Scourges[x])],false)
  call LeaderboardSetLabel(ZC7[GetPlayerId(Scourges[x])],GetObjectName('n0E4')+": ")
  set x=x+1
  set ZC7[GetPlayerId(Sentinels[x])]=CreateLeaderboard()
  call PlayerSetLeaderboard(Sentinels[x],ZC7[GetPlayerId(Sentinels[x])])
  call LeaderboardDisplay(ZC7[GetPlayerId(Sentinels[x])],false)
  call LeaderboardSetLabel(ZC7[GetPlayerId(Sentinels[x])],GetObjectName('n0E4')+": ")
  set ZC7[GetPlayerId(Scourges[x])]=CreateLeaderboard()
  call PlayerSetLeaderboard(Scourges[x],ZC7[GetPlayerId(Scourges[x])])
  call LeaderboardDisplay(ZC7[GetPlayerId(Scourges[x])],false)
  call LeaderboardSetLabel(ZC7[GetPlayerId(Scourges[x])],GetObjectName('n0E4')+": ")
  set x=x+1
  set ZC7[GetPlayerId(Sentinels[x])]=CreateLeaderboard()
  call PlayerSetLeaderboard(Sentinels[x],ZC7[GetPlayerId(Sentinels[x])])
  call LeaderboardDisplay(ZC7[GetPlayerId(Sentinels[x])],false)
  call LeaderboardSetLabel(ZC7[GetPlayerId(Sentinels[x])],GetObjectName('n0E4')+": ")
  set ZC7[GetPlayerId(Scourges[x])]=CreateLeaderboard()
  call PlayerSetLeaderboard(Scourges[x],ZC7[GetPlayerId(Scourges[x])])
  call LeaderboardDisplay(ZC7[GetPlayerId(Scourges[x])],false)
  call LeaderboardSetLabel(ZC7[GetPlayerId(Scourges[x])],GetObjectName('n0E4')+": ")
  set x=x+1
  set ZC7[GetPlayerId(Sentinels[x])]=CreateLeaderboard()
  call PlayerSetLeaderboard(Sentinels[x],ZC7[GetPlayerId(Sentinels[x])])
  call LeaderboardDisplay(ZC7[GetPlayerId(Sentinels[x])],false)
  call LeaderboardSetLabel(ZC7[GetPlayerId(Sentinels[x])],GetObjectName('n0E4')+": ")
  set ZC7[GetPlayerId(Scourges[x])]=CreateLeaderboard()
  call PlayerSetLeaderboard(Scourges[x],ZC7[GetPlayerId(Scourges[x])])
  call LeaderboardDisplay(ZC7[GetPlayerId(Scourges[x])],false)
  call LeaderboardSetLabel(ZC7[GetPlayerId(Scourges[x])],GetObjectName('n0E4')+": ")
endfunction

function XDD takes nothing returns nothing
  local integer x=GetPlayerId(GetTriggerPlayer())
  if GetEventPlayerChatString()=="-don"or GetEventPlayerChatString()=="-deathon"then
    set ShowDeathTimer[x]=true
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n08W'))
  else
    set ShowDeathTimer[x]=false
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n08X'))
  endif
endfunction

function ZHD takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerAddAction(t,function ZGD)
  call TriggerRegisterTimerEvent(t,.5,false)
  set t=CreateTrigger()
  call TriggerAddAction(t,function ZFD)
  call TriggerRegisterTimerEvent(t,1,true)
  set t=null
endfunction

function X8D takes nothing returns nothing
  if(GetEventPlayerChatString()=="-showdeny")then
    set CSONStatus2[GetPlayerId(GetTriggerPlayer())]=true
  else
    set CSONStatus2[GetPlayerId(GetTriggerPlayer())]=false
  endif
endfunction

function X9D takes nothing returns nothing
  call Error(GetTriggerPlayer(),GetObjectName('n0HG'))
endfunction

function ZID takes nothing returns nothing
  local integer i=0
  loop
    exitwhen i>16
    set CSONStatus2[i]=true
    set CSONStatus1[i]=true
    set i=i+1
  endloop
endfunction

function W2D takes nothing returns nothing
  call ForceRemovePlayer(AllPlayers,GetTriggerPlayer())
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n08U'))
endfunction

function X4D takes nothing returns nothing
  call ForceAddPlayer(AllPlayers,GetTriggerPlayer())
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n08Z'))
endfunction

function ZJD takes nothing returns boolean
  local integer x=GetRandomInt(1,4)
  if x==1 then
    set ZL7=Weather_Snow
  elseif x==2 then
    set ZL7=Weather_Rain
  elseif x==3 then
    set ZL7=Weather_Moonlight
  elseif x==4 then
    set ZL7=Weather_Wind
  endif
  if Z17[GetPlayerId(GetLocalPlayer())]then
    call EnableWeatherEffect(Weather_Snow,false)
    call EnableWeatherEffect(Weather_Rain,false)
    call EnableWeatherEffect(Weather_Moonlight,false)
    call EnableWeatherEffect(Weather_Wind,false)
    call EnableWeatherEffect(ZL7,true)
  endif
  return false
endfunction

function ZKD takes nothing returns nothing
  local integer x=GetRandomInt(1,4)
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,300,true)
  call TriggerAddCondition(t,Condition(function ZJD))
  set Z17[GetPlayerId(Sentinels[1])]=false
  set Z17[GetPlayerId(Sentinels[2])]=false
  set Z17[GetPlayerId(Sentinels[3])]=false
  set Z17[GetPlayerId(Sentinels[4])]=false
  set Z17[GetPlayerId(Sentinels[5])]=false
  set Z17[GetPlayerId(Scourges[1])]=false
  set Z17[GetPlayerId(Scourges[2])]=false
  set Z17[GetPlayerId(Scourges[3])]=false
  set Z17[GetPlayerId(Scourges[4])]=false
  set Z17[GetPlayerId(Scourges[5])]=false
  if udg_ObserverMode then
    set Z17[GetPlayerId(udg_Observer1)]=false
    set Z17[GetPlayerId(udg_Observer2)]=false
  endif
  if x==1 then
    set ZL7=Weather_Snow
  elseif x==2 then
    set ZL7=Weather_Rain
  elseif x==3 then
    set ZL7=Weather_Moonlight
  elseif x==4 then
    set ZL7=Weather_Wind
  endif
  set t=null
endfunction

function X7D takes nothing returns nothing
  local string VHD=StringCase(GetEventPlayerChatString(),false)
  if Z67 then
    set Z67=false
    call ZKD()
  endif
  if VHD=="-weather snow"and GetLocalPlayer()==GetTriggerPlayer()then
    set Z17[GetPlayerId(GetTriggerPlayer())]=false
    call EnableWeatherEffect(Weather_Snow,true)
    call EnableWeatherEffect(Weather_Rain,false)
    call EnableWeatherEffect(Weather_Moonlight,false)
    call EnableWeatherEffect(Weather_Wind,false)
  endif
  if VHD=="-weather rain"and GetLocalPlayer()==GetTriggerPlayer()then
    set Z17[GetPlayerId(GetTriggerPlayer())]=false
    call EnableWeatherEffect(Weather_Snow,false)
    call EnableWeatherEffect(Weather_Rain,true)
    call EnableWeatherEffect(Weather_Moonlight,false)
    call EnableWeatherEffect(Weather_Wind,false)
  endif
  if VHD=="-weather moonlight"and GetLocalPlayer()==GetTriggerPlayer()then
    set Z17[GetPlayerId(GetTriggerPlayer())]=false
    call EnableWeatherEffect(Weather_Snow,false)
    call EnableWeatherEffect(Weather_Rain,false)
    call EnableWeatherEffect(Weather_Moonlight,true)
    call EnableWeatherEffect(Weather_Wind,false)
  endif
  if VHD=="-weather wind"and GetLocalPlayer()==GetTriggerPlayer()then
    set Z17[GetPlayerId(GetTriggerPlayer())]=false
    call EnableWeatherEffect(Weather_Snow,false)
    call EnableWeatherEffect(Weather_Rain,false)
    call EnableWeatherEffect(Weather_Moonlight,false)
    call EnableWeatherEffect(Weather_Wind,true)
  endif
  if VHD=="-weather off"and GetLocalPlayer()==GetTriggerPlayer()then
    set Z17[GetPlayerId(GetTriggerPlayer())]=false
    call EnableWeatherEffect(Weather_Snow,false)
    call EnableWeatherEffect(Weather_Rain,false)
    call EnableWeatherEffect(Weather_Moonlight,false)
    call EnableWeatherEffect(Weather_Wind,false)
  endif
  if VHD=="-weather random"then
    set Z17[GetPlayerId(GetTriggerPlayer())]=true
    if GetLocalPlayer()==GetTriggerPlayer()then
      call EnableWeatherEffect(Weather_Snow,false)
      call EnableWeatherEffect(Weather_Rain,false)
      call EnableWeatherEffect(Weather_Moonlight,false)
      call EnableWeatherEffect(Weather_Wind,false)
      call EnableWeatherEffect(ZL7,true)
    endif
  endif
endfunction

function XED takes nothing returns nothing
  local integer a=S2I(SubString(GetEventPlayerChatString(),6,StringLength(GetEventPlayerChatString())))
  local integer ZG8=GetPlayerId(GetTriggerPlayer())
  set TL[ZG8]=TL[ZG8]+1
  if TL[ZG8]>20 then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,GetObjectName('n0DQ'))
    return
  endif
  if GetEventPlayerChatString()=="-rollon"or GetEventPlayerChatString()=="-rolloff"then
    return
  endif
  if a==0 then
    set a=100
  endif
  if a>0 and a<2001 then
    call YL8(AllPlayers,5,udg_Colors[GetPlayerId(GetTriggerPlayer())]+(IL7[GetPlayerId((GetTriggerPlayer()))])+"|r "+GetObjectName('n05I')+" "+I2S(GetRandomInt(1,a))+" "+GetObjectName('n05M')+" "+I2S(a))
  else
    call Error(GetTriggerPlayer(),GetObjectName('n02Y'))
  endif
endfunction

function XYD takes nothing returns nothing
  local integer a
  if GetRandomInt(1,2)==1 then
    set a=GetRandomInt(FirstScourgeHeroIndexid,LastScourgeHeroIndexid)
  else
    set a=GetRandomInt(FirstSentinelHeroIndexid,LastSentinelHeroIndexid)
  endif
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,GetObjectName('n0GS')+" "+UR8(a))
endfunction

function XVD takes nothing returns nothing
  local integer a=S2I(SubString(GetEventPlayerChatString(),4,StringLength(GetEventPlayerChatString())))
  if GetTriggerPlayer()!=Sentinels[1]or a>2 or a<1 or Mode_CM==false or TimerGetElapsed(GlobalTimer)>14 or ModeCM_Started then
    return
  endif
  set ModeCM_Order=a
  set ModeCM_Current=a
  set ModeCM_Manual=true
  if a==1 then
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(Sentinels[1])]+(IL7[GetPlayerId((Sentinels[1]))])+"|r "+GetObjectName('n0DS'))
  else
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(Scourges[1])]+(IL7[GetPlayerId((Scourges[1]))])+"|r "+GetObjectName('n0DS'))
  endif
endfunction

function XQD takes nothing returns nothing
  set ShowRollNumbers[GetPlayerId(GetTriggerPlayer())]=false
endfunction

function XRD takes nothing returns nothing
  set ShowRollNumbers[GetPlayerId(GetTriggerPlayer())]=true
endfunction

function XFD takes nothing returns nothing
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n090'))
  set hhnActive[GetPlayerId(GetTriggerPlayer())]=true
  if GetLocalPlayer()==GetTriggerPlayer()then
    call SetPlayerName(Sentinels[1],IL7[GetPlayerId(Sentinels[1])])
    call SetPlayerName(Sentinels[2],IL7[GetPlayerId(Sentinels[2])])
    call SetPlayerName(Sentinels[3],IL7[GetPlayerId(Sentinels[3])])
    call SetPlayerName(Sentinels[4],IL7[GetPlayerId(Sentinels[4])])
    call SetPlayerName(Sentinels[5],IL7[GetPlayerId(Sentinels[5])])
    call SetPlayerName(Scourges[1],IL7[GetPlayerId(Scourges[1])])
    call SetPlayerName(Scourges[2],IL7[GetPlayerId(Scourges[2])])
    call SetPlayerName(Scourges[3],IL7[GetPlayerId(Scourges[3])])
    call SetPlayerName(Scourges[4],IL7[GetPlayerId(Scourges[4])])
    call SetPlayerName(Scourges[5],IL7[GetPlayerId(Scourges[5])])
  endif
endfunction

function XGD takes nothing returns nothing
  local integer id=GetPlayerId(GetTriggerPlayer())
  if SoundsMuted[id] then
    set SoundsMuted[id]=false
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,GetObjectName('n08T'))
  else
    set SoundsMuted[id]=true
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,GetObjectName('n091'))
  endif
endfunction

function ShowSpellInfo takes nothing returns nothing
  local integer id=GetPlayerId(GetTriggerPlayer())
  set ItemInfoShown[id]=false
  set SpellInfoShown[id]=true
endfunction

function XBD takes nothing returns nothing
  local integer id=GetPlayerId(GetTriggerPlayer())
  set ItemInfoShown[id]=true
  set SpellInfoShown[id]=false
endfunction

function XJD takes nothing returns nothing
  local integer i=1
  local player p
  local real ZMD
  loop
    exitwhen i>5
    set p=Sentinels[i]
    if IsPlayer(p)then
      set ZMD=PlayerAPM[GetPlayerId(p)]/(TimerGetElapsed(GlobalTimer))*60
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r"+" "+GetObjectName('n084')+" "+R2S(ZMD))
    endif
    set p=Scourges[i]
    if IsPlayer(p)then
      set ZMD=PlayerAPM[GetPlayerId(p)]/(TimerGetElapsed(GlobalTimer))*60
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r"+" "+GetObjectName('n084')+" "+R2S(ZMD))
    endif
    set i=i+1
  endloop
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.," ")
  set p=null
endfunction

function XKD takes nothing returns nothing
  call BL8(GetTriggerPlayer())
endfunction

function ZND takes nothing returns boolean
  call CleanTrigger(GetTriggeringTrigger())
  set AFK_Check=true
  return false
endfunction

function ZOD takes real d returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,d,false)
  call TriggerAddCondition(t,Condition(function ZND))
  set t=null
endfunction

function ZPD takes player whichPlayer returns nothing
  local integer ZQD
  local player ZRD
  set ZQD=0
  loop
    set ZRD=Player(ZQD)
    if(PlayersAreCoAllied(whichPlayer,ZRD)and whichPlayer!=ZRD)then
      call SetPlayerAlliance(whichPlayer,ZRD,ALLIANCE_SHARED_VISION,true)
      call SetPlayerAlliance(whichPlayer,ZRD,ALLIANCE_SHARED_CONTROL,true)
      call SetPlayerAlliance(ZRD,whichPlayer,ALLIANCE_SHARED_CONTROL,true)
    endif
    set ZQD=ZQD+1
    exitwhen ZQD==12
  endloop
  set ZRD=null
endfunction

function XID takes nothing returns nothing
  local integer ZG8=S2I(SubString(GetEventPlayerChatString(),9,StringLength(GetEventPlayerChatString())))
  local integer i=1
  local player p
  local string Time
  if AFK_Check then
    if(SecondsForTime<10)then
      set Time=I2S(MinutesForTime)+":0"+I2S(SecondsForTime)
    else
      set Time=I2S(MinutesForTime)+":"+I2S(SecondsForTime)
    endif
    if ZG8<1 or A47[ZG8]==false then
      loop
        exitwhen i>5
        set p=Sentinels[i]
        if IsPlayer(p)and((TimerGetElapsed(GlobalTimer))-LastTimeActivity[GetPlayerId(p)])>300. and A47[GetPlayerId(p)]==false and b_isPickTime==false then
          set A47[GetPlayerId(p)]=true
          call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r"+" "+GetObjectName('n05G')+" "+R2S(((TimerGetElapsed(GlobalTimer))-LastTimeActivity[GetPlayerId(p)])/ 60)+" "+GetObjectName('N05F'))
          call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.,GetObjectName('n05O')+" |cff99ccff-kickafk "+I2S(GetPlayerId(p))+" |r "+GetObjectName('n05P'))
          call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.," ")
        endif
        set p=Scourges[i]
        if IsPlayer(p)and((TimerGetElapsed(GlobalTimer))-LastTimeActivity[GetPlayerId(p)])>300. and A47[GetPlayerId(p)]==false and b_isPickTime==false then
          set A47[GetPlayerId(p)]=true
          call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r"+" "+GetObjectName('n05G')+" "+R2S(((TimerGetElapsed(GlobalTimer))-LastTimeActivity[GetPlayerId(p)])/ 60)+" "+GetObjectName('N05F'))
          call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.,GetObjectName('n05O')+" |cff99ccff-kickafk "+I2S(GetPlayerId(p))+" |r "+GetObjectName('n05P'))
          call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.," ")
        endif
        set i=i+1
      endloop
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.," ")
    elseif IsPlayer(Player(ZG8)) and IsPlayerAlly(GetTriggerPlayer(),Player(ZG8)) then
      call DisplayTimedTextToPlayer(Player(ZG8),0,group008,3600,"|c00ff0303"+GetObjectName('n05E')+"|r")
      call I69(Player(ZG8))
      set L3[GetPlayerId(Player(ZG8))]="|c00555555"+Time+"|r"
      call RemovePlayer(Player(ZG8),PLAYER_GAME_RESULT_DEFEAT)
      call ZPD(Player(ZG8))
      if EL then
        call CL8(Player(ZG8))
      endif
      set IsPlayerLeftGame[GetPlayerId(Player(ZG8))]=true
      call I39(Player(ZG8))
      call DisplayTimedTextToForceEx(AllPlayers,30.,"|c00ff0303"+(IL7[GetPlayerId((Player(ZG8)))])+" "+GetObjectName('n05E')+"|r")
    endif
  endif
  set p=null
endfunction

function XHD takes nothing returns nothing
  local integer i=1
  local player p
  local integer x=0
  if AFK_Check then
    loop
      exitwhen i>5
      set p=Sentinels[i]
      if IsPlayer(p)and((TimerGetElapsed(GlobalTimer))-LastTimeActivity[GetPlayerId(p)])/ 60>.2 then
        set x=x+1
        call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r"+" "+GetObjectName('n05D')+" "+R2S(((TimerGetElapsed(GlobalTimer))-LastTimeActivity[GetPlayerId(p)])/ 60)+" "+GetObjectName('N05F'))
      endif
      set p=Scourges[i]
      if IsPlayer(p)and((TimerGetElapsed(GlobalTimer))-LastTimeActivity[GetPlayerId(p)])/ 60>.2 then
        set x=x+1
        call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r"+" "+GetObjectName('n05D')+" "+R2S(((TimerGetElapsed(GlobalTimer))-LastTimeActivity[GetPlayerId(p)])/ 60)+" "+GetObjectName('N05F'))
      endif
      set i=i+1
    endloop
    if x<1 then
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.,GetObjectName('N05Q'))
    else
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.," ")
    endif
  endif
  set p=null
endfunction

function ZSD takes nothing returns boolean
  local integer i=1
  local player p
  local real Time=(TimerGetElapsed(GlobalTimer))
  if AFK_Check then
    loop
      exitwhen i>5
      set p=Sentinels[i]
      if IsPlayer(p)and(Time-LastTimeActivity[GetPlayerId(p)])>300. and A47[GetPlayerId(p)]==false then
        set A47[GetPlayerId(p)]=true
        call DisplayTimedTextToForceEx(Force_SentPlayers,15,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r"+" "+GetObjectName('n05G')+" "+R2S((Time-LastTimeActivity[GetPlayerId(p)])/ 60)+" "+GetObjectName('N05F'))
        call DisplayTimedTextToForceEx(Force_SentPlayers,15,GetObjectName('n05O')+" |cff99ccff-kickafk "+I2S(GetPlayerId(p))+" |r "+GetObjectName('n05P'))
        call DisplayTimedTextToForceEx(Force_SentPlayers,15," ")
      endif
      set p=Scourges[i]
      if IsPlayer(p)and(Time-LastTimeActivity[GetPlayerId(p)])>300. and A47[GetPlayerId(p)]==false then
        set A47[GetPlayerId(p)]=true
        call DisplayTimedTextToForceEx(Force_ScourgePlayers,15,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r"+" "+GetObjectName('n05G')+" "+R2S((Time-LastTimeActivity[GetPlayerId(p)])/ 60)+" "+GetObjectName('N05F'))
        call DisplayTimedTextToForceEx(Force_ScourgePlayers,15,GetObjectName('n05O')+" |cff99ccff-kickafk "+I2S(GetPlayerId(p))+" |r "+GetObjectName('n05P'))
        call DisplayTimedTextToForceEx(Force_ScourgePlayers,15," ")
      endif
      set i=i+1
    endloop
  endif
  set p=null
  return false
endfunction

function ZTD takes nothing returns boolean
  
  if GetOwningPlayer(GetTriggerUnit())!=Sentinels[0]and GetOwningPlayer(GetTriggerUnit())!=Scourges[0]then
    set PlayerAPM[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]=PlayerAPM[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]+1
    if GetIssuedOrderId()!=851983 then
      set LastTimeActivity[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]=(TimerGetElapsed(GlobalTimer))
      set A47[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]=false
    endif
    if(GetIssuedOrderId()==851983 or GetIssuedOrderId()==851971)and GetOrderTargetItem()!=null then
      if GetIssuedOrderId()==851983 or(GetIssuedOrderId()==851971 and(LoadBoolean(hashtable019,(GetHandleId(GetItemPlayer(GetOrderTargetItem()))),(139))))then
        if GetItemPlayer(GetOrderTargetItem())!=GetOwningPlayer(GetTriggerUnit())and IsPointInRegion(integer031,GetItemX(GetOrderTargetItem()),GetItemY(GetOrderTargetItem())) then
          call DisableTrigger(GetTriggeringTrigger())
          call InterruptUnit(GetTriggerUnit())
          call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n0G7'))
          call EnableTrigger(GetTriggeringTrigger())
        endif
      endif
    endif
  endif
  return false
endfunction

function ZUD takes nothing returns boolean
  return IsCourier(GetFilterUnit())and GetOwningPlayer(GetFilterUnit())==GetTriggerPlayer()
endfunction

function Courier_Add takes nothing returns nothing
  call UnitAddType(GetEnumUnit(),UNIT_TYPE_PEON)
endfunction

function Courier_Remove takes nothing returns nothing
  call UnitRemoveType(GetEnumUnit(),UNIT_TYPE_PEON)
endfunction

function XMD takes nothing returns nothing
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,0,0,12000,Condition(function ZUD))
  call KillGroup(g)
  set g=null
endfunction

function ZVD takes nothing returns nothing
  local string VHD=StringCase(GetEventPlayerChatString(),false)
  local boolean ZWD=VHD=="-mode1"
  local boolean ZXD=VHD=="-mode2"
  if ZWD==false and ZXD==false then
    return
  endif
  if(TimerGetElapsed(GlobalTimer))>60 then
    call ErrorDefault2s(GetTriggerPlayer(),GetObjectName('n02X'))
    return
  elseif(TimerGetElapsed(GlobalTimer))<15 then
    call ErrorDefault2s(GetTriggerPlayer(),GetObjectName('n02X'))
    return
  endif
  if ZWD then
    set LK=1
  elseif ZXD then
    set LK=2
  endif
  call UID()
  call DisplayTimedTextToForceEx(AllPlayers,15,GetObjectName('n05N')+" "+GetObjectName('n055'))
  call DisplayTimedTextToForceEx(AllPlayers,15,GetObjectName('n05R'))
  call CleanTrigger(GetTriggeringTrigger())
endfunction

function ZYD takes nothing returns boolean
  call ExeFunc("ZVD")
  return false
endfunction

function AH_RegisterCommands takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterPlayerChatEvent(t,PlayerModeTyper,"-",false)
  call TriggerAddCondition(t,Condition(function ZYD))
  call DisplayTimedTextToForceEx(AllPlayers,30,"|cff99ccff"+GetObjectName('n05S')+"|r")
  call DisplayTimedTextToForceEx(AllPlayers,30,GetObjectName('n05T')+" "+GetObjectName('n05H')+" "+GetObjectName('n05V')+" ")
  call DisplayTimedTextToForceEx(AllPlayers,30," ")
  call DisplayTimedTextToForceEx(AllPlayers,30,"|cff99ccff-mode1|r "+GetObjectName('n05W')+". ("+GetObjectName('n05X')+")")
  call DisplayTimedTextToForceEx(AllPlayers,30,"|cff99ccff-mode2|r "+GetObjectName('n062'))
  set t=null
endfunction

function AH_RegisterCommands_Delayed takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.5,false)
  set t=null
endfunction

function XND takes nothing returns nothing
  if(TimerGetElapsed(GlobalTimer))>60 then
    call ErrorDefault2s(GetTriggerPlayer(),GetObjectName('n02X'))
    return
  elseif(TimerGetElapsed(GlobalTimer))<15 then
    call ErrorDefault2s(GetTriggerPlayer(),GetObjectName('n02X'))
    return
  endif
  if GetTriggerPlayer()!=PlayerModeTyper then
    call ErrorDefault2s(GetTriggerPlayer(),GetObjectName('n02W'))
    return
  endif
  if boolean035==false then
    set boolean035=true
    set LK=2
    call UID()
    call DisplayTimedTextToForceEx(AllPlayers,15,GetObjectName('n05N')+" "+GetObjectName('n055'))
    call DisplayTimedTextToForceEx(AllPlayers,15,GetObjectName('n05R'))
  else
    call Error(GetTriggerPlayer(),GetObjectName('n02V'))
  endif
endfunction

function XOD takes nothing returns nothing
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0CV')+" [|cffff0000E|r|cffff0000E|r|cffff0000E|r] - [|cffffcc00T|r]")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0CU')+" [|cffff0000E|r|cffff0000E|r|cff00ffffW|r] - [|cffffcc00D|r]")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0CT')+" [|cffff0000E|r|cffff0000E|r|cff0000ffQ|r] - [|cffffcc00F|r]")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0C6')+" [|cff0000ffQ|r|cff0000ffQ|r|cff0000ffQ|r] - [|cffffcc00Y|r]")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0CL')+" [|cff0000ffQ|r|cff0000ffQ|r|cff00ffffW|r] - [|cffffcc00V|r]")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0CN')+" [|cff0000ffQ|r|cff0000ffQ|r|cffff0000E|r] - [|cffffcc00G|r]")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0CS')+" [|cff00ffffW|r|cff00ffffW|r|cffff0000E|r] - [|cffffcc00Z|r]")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0CO')+" [|cff00ffffW|r|cff00ffffW|r|cff0000ffQ|r] - [|cffffcc00X|r]")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0CP')+" [|cff00ffffW|r|cff00ffffW|r|cff00ffffW|r] - [|cffffcc00C|r]")
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0CQ')+" [|cff0000ffQ|r|cff00ffffW|r|cffff0000E|r] - [|cffffcc00B|r]")
endfunction

function ZZD takes string s returns nothing
  call StopMusic(true)
  call PlayMusic(s)
endfunction

function XSD takes nothing returns nothing
  local string s=GetEventPlayerChatString()
  local integer VA8=GetRandomInt(1,A87)
  if GetLocalPlayer()==GetTriggerPlayer()then
    if s=="-music off"then
      call StopMusic(false)
    elseif s=="-music random"then
      call ZZD(A77[VA8])
    elseif s=="-music nightelf1"then
      call ZZD(string025)
    elseif s=="-music nightelf2"then
      call ZZD(string026)
    elseif s=="-music nightelf3"then
      call ZZD(OD)
    elseif s=="-music human1"then
      call ZZD(string022)
    elseif s=="-music human2"then
      call ZZD(string023)
    elseif s=="-music human3"then
      call ZZD(string024)
    elseif s=="-music orc1"then
      call ZZD(string028)
    elseif s=="-music orc2"then
      call ZZD(string029)
    elseif s=="-music orc3"then
      call ZZD(string030)
    elseif s=="-music undead1"then
      call ZZD(string036)
    elseif s=="-music undead2"then
      call ZZD(string037)
    elseif s=="-music undead3"then
      call ZZD(string038)
    elseif s=="-music other1"then
      call ZZD(string031)
    elseif s=="-music other2"then
      call ZZD(string032)
    elseif s=="-music other3"then
      call ZZD(string033)
    elseif s=="-music other4"then
      call ZZD(string034)
    elseif s=="-music other5"then
      call ZZD(string035)
    elseif s=="-music other6"then
      call ZZD(string039)
    elseif s=="-music other7"then
      call ZZD(string040)
    elseif s=="-music other8"then
      call ZZD(string041)
    elseif s=="-music other9"then
      call ZZD(string042)
    elseif s=="-music special"then
      call ZZD(A97)
    else
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0CW')+" ")
      call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,"off, random, nightelf1, nightelf2, nightelf3, human1, human2, human3, orc1, orc2, orc3, undead1, undead2, undead3, other1, other2, other3, other4, other5, other6, other7, other8, other9, special")
    endif
  endif
endfunction

function ZAD takes nothing returns boolean
  set A87=A87+1
  set A77[A87]=string025
  set A87=A87+1
  set A77[A87]=string026
  set A87=A87+1
  set A77[A87]=OD
  set A87=A87+1
  set A77[A87]=string022
  set A87=A87+1
  set A77[A87]=string023
  set A87=A87+1
  set A77[A87]=string024
  set A87=A87+1
  set A77[A87]=string028
  set A87=A87+1
  set A77[A87]=string029
  set A87=A87+1
  set A77[A87]=string030
  set A87=A87+1
  set A77[A87]=string036
  set A87=A87+1
  set A77[A87]=string037
  set A87=A87+1
  set A77[A87]=string038
  set A87=A87+1
  set A77[A87]=string031
  set A87=A87+1
  set A77[A87]=string032
  set A87=A87+1
  set A77[A87]=string033
  set A87=A87+1
  set A77[A87]=string034
  set A87=A87+1
  set A77[A87]=string035
  set A87=A87+1
  set A77[A87]=string039
  set A87=A87+1
  set A77[A87]=string040
  set A87=A87+1
  set A77[A87]=string041
  set A87=A87+1
  set A77[A87]=string042
  set A87=A87+1
  set A77[A87]=A97
  return false
endfunction

function ZBD takes player p,integer r,integer g,integer b,integer a returns nothing
  if GetLocalPlayer()==p then
    call SetWaterBaseColor(r,g,b,a)
  endif
endfunction

function ZCD takes string s returns nothing
  local string Z3D=""
  local string Z6D=""
  local string ZLD=""
  local integer i=0
  local integer E29=StringLength(s)
  local integer Z1D=1
  loop
    exitwhen i>E29
    if SubString(s,i,i+1)==" "then
      set Z1D=Z1D+1
    else
      if Z1D==1 then
        set Z3D=Z3D+SubString(s,i,i+1)
      elseif Z1D==2 then
        set Z6D=Z6D+SubString(s,i,i+1)
      else
        set ZLD=ZLD+SubString(s,i,i+1)
      endif
    endif
    set i=i+1
  endloop
  set AE7=S2I(Z3D)
  set AF7=S2I(Z6D)
  set AG7=S2I(ZLD)
endfunction

function XTD takes nothing returns nothing
  local string Z0D=SubString(GetEventPlayerChatString(),7,StringLength(GetEventPlayerChatString()))
  local player p=GetTriggerPlayer()
  local integer r
  local integer g
  local integer b
  set CustomWaterColor[GetPlayerId(p)]=true
  if Z0D=="red"then
    call ZBD(p,255,0,0,255)
  elseif Z0D=="blue"then
    call ZBD(p,0,0,255,255)
  elseif Z0D=="green"then
    call ZBD(p,0,255,0,255)
  elseif Z0D=="default"then
    call ZBD(p,0,0,255,255)
  elseif Z0D=="random"then
    set r=GetRandomInt(0,255)
    set g=GetRandomInt(0,255)
    set b=GetRandomInt(0,255)
    call ZBD(p,r,g,b,255)
    call DisplayTimedTextToPlayer(p,0,0,5,GetObjectName('n0HD')+" r="+I2S(r)+" g="+I2S(g)+" b="+I2S(b))
  else
    call ZCD(Z0D)
    set r=AE7
    set g=AF7
    set b=AG7
    if r==0 and g==0 and b==0 and Z0D!="0 0 0"then
      return
    endif
    if r>=0 and r<=255 and g>=0 and g<=255 and b>=0 and b<=255 then
      call ZBD(p,r,g,b,255)
    endif
  endif
  set p=null
endfunction

function XWD takes nothing returns nothing
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,15.,"This command has been temporarily disabled")
endfunction

function XXD takes nothing returns boolean
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,"Total Bonus XP/Gold: "+I2S(AssistsBonusExpCounter[GetPlayerId(GetTriggerPlayer())])+"/"+I2S(AssistsBonusGoldCounter[GetPlayerId(GetTriggerPlayer())]))
  return false
endfunction

function X5D takes nothing returns boolean
  if E48>0 then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetObjectName('n0LO')+": "+I2S(E48))
  endif
  return false
endfunction

function Quote_ReplaySound takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer x=(LoadInteger(hashtable019,(Cache),(148)))
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  call SoundForPlayer(p,AH7[x])
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set p=null
  return false
endfunction

function XUD takes nothing returns nothing
  local string s=GetEventPlayerChatString()
  local integer x=S2I(SubString(GetEventPlayerChatString(),7,StringLength(GetEventPlayerChatString())))
  local integer i=1
  if x<1 or x>AJ7 then
    set x=GetRandomInt(1,AJ7)
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10,GetObjectName('n0E5')+" "+I2S(x))
  endif
  if AK7 then
    loop
      exitwhen i>AJ7
      call CS8(AH7[i])
      set i=i+1
    endloop
    set AK7=false
  endif
  if AI7[x]==false then
  endif
  call SoundForPlayer(GetTriggerPlayer(),AH7[x])
endfunction

function Z5D takes player p1 returns string
  local string s=GetObjectName('n0GB')
  set s=FA9(s,"$c1","|c00ff0303")
  set s=FA9(s,"$p1",udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r")
  return s
endfunction

function Z2D takes nothing returns string
  local string s=GetObjectName('n0GA')//$c1If you want veto this, type |r $c2-no|r
  set s=FA9(s,"$c1","|c006699CC")
  set s=FA9(s,"$c2","|c00ff0303")
  return s
endfunction

function A4D takes nothing returns nothing
  local integer i=1
  local unit Hero
  if boolean035 then
    loop
      exitwhen i>5
      set Hero=udg_Hero[GetPlayerId(Sentinels[i])]
      if Hero!=null then
        if LK==2 then
          call FS9(Hero)
        endif
        call UnitSetUsesAltIcon(Hero,false)
      endif
      set Hero=udg_Hero[GetPlayerId(Scourges[i])]
      if Hero!=null then
        if LK==2 then
          call FS9(Hero)
        endif
        call UnitSetUsesAltIcon(Hero,false)
      endif
      set i=i+1
    endloop
    set Hero=null
  endif
endfunction

function A7D takes player p1,player p2 returns string
  local string s=GetObjectName('n0G2')//$c1Type|r $c2-switch accept|r $c1or|r $c2-ok|r $c1to allow|r $p1 $c1to switch with|r $p2
  set s=FA9(s,"$c1","|c006699CC")
  set s=FA9(s,"$c1","|c006699CC")
  set s=FA9(s,"$c1","|c006699CC")
  set s=FA9(s,"$c1","|c006699CC")
  set s=FA9(s,"$c2","|c00ff0303")
  set s=FA9(s,"$c2","|c00ff0303")
  set s=FA9(s,"$p1",udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r")
  set s=FA9(s,"$p2",udg_Colors[GetPlayerId(p2)]+(IL7[GetPlayerId((p2))])+"|r")
  return s
endfunction

function A8D takes string A9D,string ADD returns string
  local string s=GetObjectName('n0FV')
  set s=FA9(s,"$c1","|c006699CC")
  set s=FA9(s,"$c1","|c006699CC")
  set s=FA9(s,"$c1","|c006699CC")
  set s=FA9(s,"$c1","|c006699CC")
  set s=FA9(s,"$p1",A9D)
  set s=FA9(s,"$p2",ADD)
  return s
endfunction

function AED takes player p2 returns string
  local string s=GetObjectName('n0FS')
  set s=FA9(s,"$p2",udg_Colors[GetPlayerId(p2)]+(IL7[GetPlayerId((p2))])+"|r")
  set s=FA9(s,"$c1","|c006699CC")
  return s
endfunction

function AFD takes player p returns nothing
  local integer VT8
  local integer VU8
  if(IsSentinel(p))then
    set VT8=1
    set VU8=5
    loop
      exitwhen VT8>VU8
      if(Sentinels[VT8]!=p)then
        if(IsPlayer(Sentinels[VT8]))then
          call SetPlayerAllianceStateBJ(p,Sentinels[VT8],4)
        endif
      endif
      set VT8=VT8+1
    endloop
  else
    set VT8=1
    set VU8=5
    loop
      exitwhen VT8>VU8
      if(Scourges[VT8]!=p)then
        if(IsPlayer(Scourges[VT8]))then
          call SetPlayerAllianceStateBJ(p,Scourges[VT8],4)
        endif
      endif
      set VT8=VT8+1
    endloop
  endif
endfunction

function AGD takes nothing returns nothing
  if GetOwningPlayer(GetEnumUnit())==player009 then
    call SetUnitOwner(GetEnumUnit(),player010,true)
  elseif GetOwningPlayer(GetEnumUnit())==player010 then
    call SetUnitOwner(GetEnumUnit(),player009,true)
  endif
endfunction

function AHD takes unit u,player p returns nothing
  local real x1
  local real y1
  local real x2
  local real y2
  local integer i
  local item Item
  if IsSentinel(p)then
    set x1=GetRectCenterX(gg_rct_Hero_Creation_UD)
    set y1=GetRectCenterY(gg_rct_Hero_Creation_UD)
    set x2=GetRectCenterX(gg_rct_Hero_Creation_NE)
    set y2=GetRectCenterY(gg_rct_Hero_Creation_NE)
  else
    set x1=GetRectCenterX(gg_rct_Hero_Creation_NE)
    set y1=GetRectCenterY(gg_rct_Hero_Creation_NE)
    set x2=GetRectCenterX(gg_rct_Hero_Creation_UD)
    set y2=GetRectCenterY(gg_rct_Hero_Creation_UD)
  endif
  call SetUnitX(u,x1)
  call SetUnitY(u,y1)
  if IsCourier(u)then
    call IssueImmediateOrderById(u,852246)
  endif
  if IsUnitType(u,UNIT_TYPE_HERO) then
    call SaveBoolean(hashtable019,(GetHandleId(u)),(140),(true))
    call SaveInteger(hashtable019,(GetHandleId((u))),((4259)),(2))
    call UnitRemoveAbility(u,'A04R')
    call SetUnitInvulnerable(u,false)
    call PauseUnit(u,false)
    set i=0
    loop
      exitwhen i>5
      set Item=UnitItemInSlot(u,i)
      if GetUnitTypeId(u)!='H00J' and Item!=null and(GetItemPlayer(Item)!=GetOwningPlayer(u)and GetIndex(Item)!=indexid_DivineRapier and GetIndex(Item)!=indexid_DivineRapierFree)and GetItemTypeId(Item)!=Item_Real[indexid_Aegis]then
        call UnitRemoveItem(u,Item)
      endif
      set i=i+1
    endloop
  endif
  call SetUnitX(u,x2)
  call SetUnitY(u,y2)
  call SetUnitColor(u,GetPlayerColor(p))
  set Item=null
endfunction

function AID takes nothing returns boolean
  if IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) or IsCourier(GetFilterUnit())then
    call AHD(GetFilterUnit(),player011)
  elseif GetUnitTypeId(GetFilterUnit())=='ncop' then
    call IssueImmediateOrderById(GetFilterUnit(),852246)//drop item from circle
  elseif GetUnitTypeId(GetFilterUnit())=='u00B' then
    return true
  endif
  return false
endfunction

function AJD takes item i,player p returns nothing
  local real x
  local real y
  if IsSentinel(p)then
    set x=GetRectCenterX(gg_rct_Hero_Creation_NE)
    set y=GetRectCenterY(gg_rct_Hero_Creation_NE)
  else
    set x=GetRectCenterX(gg_rct_Hero_Creation_UD)
    set y=GetRectCenterY(gg_rct_Hero_Creation_UD)
  endif
  call SetItemPosition(i,x,y)
endfunction

function AKD takes nothing returns nothing
  if GetItemPlayer(GetEnumItem())==player011 then
    call AJD(GetEnumItem(),player011)
  endif
endfunction

function AMD takes player p1,player p2 returns nothing
  local group g1=GetAvailableGroup()
  local group g2=GetAvailableGroup()
  set player011=p1
  call GroupEnumUnitsOfPlayer(g1,p1,Condition(function AID))
  set player011=p2
  call GroupEnumUnitsOfPlayer(g2,p2,Condition(function AID))
  call ForGroup(g1,function AGD)
  call ForGroup(g2,function AGD)
  set player011=p1
  call EnumItemsInRect(GetWorldBounds(),Condition(function ReturnTrue),function AKD)
  set player011=p2
  call EnumItemsInRect(GetWorldBounds(),Condition(function ReturnTrue),function AKD)
  call KillGroup(g1)
  call KillGroup(g2)
  set g1=null
  set g2=null
endfunction

function NeverTakesSuchName takes player p1,player p2 returns nothing
  local integer x
  local integer y
  local integer i
  local integer i1
  local integer i2
  local real x1
  local real y1
  local real x2
  local real y2
  local player p
  local string A9D=udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"
  local string ADD=udg_Colors[GetPlayerId(p2)]+(IL7[GetPlayerId((p2))])+"|r"
  local integer YND
  local integer AOD
  local integer APD
  set YND=ReliableGold[GetPlayerId(p1)]
  set ReliableGold[GetPlayerId(p1)]=ReliableGold[GetPlayerId(p2)]
  set ReliableGold[GetPlayerId(p2)]=YND
  call Traffic_RegisterData("SWITCH_"+I2S(GetPlayerId(p1))+"_"+I2S(GetPlayerId(p2)),0)
  call Traffic_RegisterData("SWITCH_"+I2S(GetPlayerId(p2))+"_"+I2S(GetPlayerId(p1)),0)
  if IsSentinel(p1)then
    set x1=GetRectCenterX(gg_rct_Hero_Creation_UD)
    set y1=GetRectCenterY(gg_rct_Hero_Creation_UD)
  else
    set x1=GetRectCenterX(gg_rct_Hero_Creation_NE)
    set y1=GetRectCenterY(gg_rct_Hero_Creation_NE)
  endif
  if IsSentinel(p2)then
    set x2=GetRectCenterX(gg_rct_Hero_Creation_UD)
    set y2=GetRectCenterY(gg_rct_Hero_Creation_UD)
  else
    set x2=GetRectCenterX(gg_rct_Hero_Creation_NE)
    set y2=GetRectCenterY(gg_rct_Hero_Creation_NE)
  endif
  set i=1
  loop
    exitwhen i>5
    if Sentinels[i]==p1 or Scourges[i]==p1 then
      set i1=i
    endif
    if Sentinels[i]==p2 or Scourges[i]==p2 then
      set i2=i
    endif
    set i=i+1
  endloop
  if IsSentinel(p1)then
    set Scourges[i2]=p1
    set Sentinels[i1]=p2
  else
    set Sentinels[i2]=p1
    set Scourges[i1]=p2
  endif
  call SetPlayerTeam(Sentinels[0],0)
  call SetPlayerTeam(Sentinels[1],0)
  call SetPlayerTeam(Sentinels[2],0)
  call SetPlayerTeam(Sentinels[3],0)
  call SetPlayerTeam(Sentinels[4],0)
  call SetPlayerTeam(Sentinels[5],0)
  call SetPlayerTeam(Scourges[0],1)
  call SetPlayerTeam(Scourges[1],1)
  call SetPlayerTeam(Scourges[2],1)
  call SetPlayerTeam(Scourges[3],1)
  call SetPlayerTeam(Scourges[4],1)
  call SetPlayerTeam(Scourges[5],1)
  call HK9()
  set x=0
  set y=0
  loop
    exitwhen x>5
    loop
      exitwhen y>5
      call SetPlayerAllianceStateBJ(Sentinels[x],Sentinels[y],3)
      call SetPlayerAllianceStateBJ(Scourges[x],Scourges[y],3)
      call SetPlayerAllianceStateBJ(Sentinels[x],Scourges[y],0)
      call SetPlayerAllianceStateBJ(Scourges[x],Sentinels[y],0)
      set y=y+1
    endloop
    set y=0
    set x=x+1
  endloop
  call ForceClear(Force_SentPlayers)
  call ForceClear(Force_ScourgePlayers)
  call ForceAddPlayer(Force_SentPlayers,Sentinels[0])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[1])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[2])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[3])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[4])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[5])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[0])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[1])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[2])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[3])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[4])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[5])
  call ExeFunc("HM9")
  call AMD(p1,p2)
  set boolean191=true
  call PanCameraToTimedForPlayer(p1,x1,y1,0)
  call PanCameraToTimedForPlayer(p2,x2,y2,0)
  call StorePlayersColorValues()
  set boolean190=false
  if trigger026!=null then
    call TriggerEvaluate(trigger026)
  endif
  if GetPlayerSlotState(p2)==PLAYER_SLOT_STATE_EMPTY then
    set IL7[GetPlayerId(p2)]=GetPlayerName(p2)
  endif
  set i=1
  loop
    exitwhen i>5
    set p=Sentinels[i]
    if IsPlayerLeaver(p)then
      call AFD(p)
    endif
    set p=Scourges[i]
    if IsPlayerLeaver(p)then
      call AFD(p)
    endif
    set i=i+1
  endloop
  call A4D()
  call Trig_display_leaderboard_Actions()
  call ClearTextMessages()
  call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20," ")
  call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20,A8D(A9D,ADD))
  call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20," ")
  call Func1094(p1)
  call Func1094(p2)
  set AOD=RH8(GetPlayerId(p1))
  set APD=RH8(GetPlayerId(p2))
  set YND=PlayersId[AOD]
  set PlayersId[AOD]=PlayersId[APD]
  set PlayersId[APD]=YND
  set PlayerFFed[GetPlayerId(p1)]=false
  set PlayerFFed[GetPlayerId(p2)]=false
  set p=null
endfunction

function WVD takes nothing returns nothing
  call NeverTakesSuchName(Player(LoadInteger(hashtable019,'00FS',1)),Player(LoadInteger(hashtable019,'00FS',2)))
endfunction

function AQD takes nothing returns nothing
  local integer i=1
  local player p
  set integer556=0
  set integer557=0
  loop
    exitwhen i>5
    set p=Sentinels[i]
    if IsPlayer(p)then
      set integer557=integer557+1
      if booleans057[GetPlayerId(p)] then
        set integer556=integer556+1
      endif
    endif
    set p=Scourges[i]
    if IsPlayer(p)then
      set integer557=integer557+1
      if booleans057[GetPlayerId(p)] then
        set integer556=integer556+1
      endif
    endif
    set i=i+1
  endloop
  set p=null
endfunction

function ARD takes nothing returns nothing
  set boolean190=false
  if trigger026!=null then
    call TriggerEvaluate(trigger026)
  endif
  call ClearTextMessages()
  call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20,Z5D(GetTriggerPlayer()))
endfunction

function ASD takes nothing returns nothing
  local integer i=1
  local player p
  local integer ATD=0
  local integer AUD=0
  local integer AVD=0
  if booleans057[GetPlayerId(GetTriggerPlayer())]==false then
    set booleans057[GetPlayerId(GetTriggerPlayer())]=true
    call AQD()
    call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20,udg_Colors[GetPlayerId(GetTriggerPlayer())]+(IL7[GetPlayerId((GetTriggerPlayer()))])+"|r|c006699CC "+GetObjectName('n0FT')+"|r ("+I2S(integer556)+"/"+I2S(integer557)+")")
  endif
  loop
    exitwhen i>5
    set p=Sentinels[i]
    if IsPlayer(p)and booleans057[GetPlayerId(p)]==false then
      set ATD=ATD+1
      set AVD=AVD+1
    endif
    if IsPlayer(p)and booleans057[GetPlayerId(p)] then
      set AUD=AUD+1
      set AVD=AVD+1
    endif
    set p=Scourges[i]
    if IsPlayer(p)and booleans057[GetPlayerId(p)]==false then
      set ATD=ATD+1
      set AVD=AVD+1
    endif
    if IsPlayer(p)and booleans057[GetPlayerId(p)] then
      set AUD=AUD+1
      set AVD=AVD+1
    endif
    set i=i+1
  endloop
  if ATD<2 and AUD>=R2I(AVD/ 2)then
    if(AVD==2 and AUD>1)or AVD!=2 then
      call NeverTakesSuchName(player009,player010)
    endif
  endif
  set p=null
endfunction

function AWD takes nothing returns nothing
  local integer i=1
  local player p=GetTriggerPlayer()
  local player AXD
  local string s
  local string s2
  loop
    exitwhen i>5
    set s=""
    set s2=""
    if IsSentinel(p)then
      set AXD=Scourges[i]
    else
      set AXD=Sentinels[i]
    endif
    if GetPlayerSlotState(AXD)==PLAYER_SLOT_STATE_LEFT and GetPlayerController(AXD)==MAP_CONTROL_USER then
      set s="|c00ff0303["+GetObjectName('n0FY')+"]|r"
    endif
    if udg_Hero[GetPlayerId(AXD)]!=null then
      set s2=" ("+GetUnitName(udg_Hero[GetPlayerId(AXD)])+")"
    endif
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,15,GetObjectName('n083')+"|c006699CC "+"-switch "+I2S(i)+"|r "+GetObjectName('n0FQ')+" "+udg_Colors[GetPlayerId(AXD)]+(IL7[GetPlayerId((AXD))])+s2+"|r "+s)
    set i=i+1
  endloop
  set p=null
endfunction

function AYD takes nothing returns boolean
  local integer i=0
  if boolean190 then
    call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20,"|c00ff0303"+GetObjectName('n0FU')+"|r")
  endif
  set ZY7=true
  set boolean190=false
  set player009=null
  set player010=null
  loop
    exitwhen i>16
    set booleans057[i]=false
    set i=i+1
  endloop
  call CleanTrigger(GetTriggeringTrigger())
  set trigger026=null
  return false
endfunction

function AZD takes player p1,player p2 returns nothing
  local trigger t=CreateTrigger()
  local integer i=0
  local string s
  local string OZD
  local string msg2
  local string msg3
  local player p
  local string s2
  set ZY7=false
  set boolean190=true
  set player009=p1
  set player010=p2
  loop
    exitwhen i>16
    set booleans057[i]=false
    set i=i+1
  endloop
  set booleans057[GetPlayerId(player009)]=true
  call TriggerRegisterTimerEvent(t,60,false)
  call TriggerAddCondition(t,Condition(function AYD))
  set trigger026=t
  set s=A7D(p1,p2)
  set s2=Z2D()
  set i=1
  loop
    exitwhen i>5
    set p=Sentinels[i]
    if p!=p1 then
      call DisplayTimedTextToPlayer(p,0,0,20,s)
      call DisplayTimedTextToPlayer(p,0,0,20,s2)
    endif
    set p=Scourges[i]
    if p!=p1 then
      call DisplayTimedTextToPlayer(p,0,0,20,s)
      call DisplayTimedTextToPlayer(p,0,0,20,s2)
    endif
    set i=i+1
  endloop
  set s=AED(p2)
  call DisplayTimedTextToPlayer(p1,0,0,20,s)
  set t=null
  set p=null
endfunction

function XAD takes nothing returns nothing
  if EL==false then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,GetObjectName('n0GX'))
    return
  endif
  if GetEventPlayerChatString()=="-switch accept"or GetEventPlayerChatString()=="-ok"then
    if boolean190 then
      call ASD()
    endif
  elseif GetEventPlayerChatString()=="-no"then
    if boolean190 then
      call ARD()
    endif
  elseif GetEventPlayerChatString()=="-switch"then
    if boolean190==false then
      call AWD()
    endif
  elseif boolean190==false then
    set integer555=S2I(SubString(GetEventPlayerChatString(),8,StringLength(GetEventPlayerChatString())))
    if integer555>0 and integer555<6 then
      if IsSentinel(GetTriggerPlayer())then
        if HeroHasBeenUnlocked[GetPlayerId(Scourges[integer555])]==false then
          call AZD(GetTriggerPlayer(),Scourges[integer555])
        else
          call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,GetObjectName('n0HY'))//The enemy team has unlocked that hero's items. He cannot be switched.
        endif
      else
        if HeroHasBeenUnlocked[GetPlayerId(Sentinels[integer555])]==false then
          call AZD(GetTriggerPlayer(),Sentinels[integer555])
        else
          call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,GetObjectName('n0HY'))
        endif
      endif
    endif
  endif
endfunction

function Command_NoSwitch takes nothing returns nothing
  if IsHeroesAvailable==false and EL and GetTriggerPlayer()==PlayerModeTyper then
    set EL=false
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,GetObjectName('n0GX'))
  endif
endfunction

function X0D takes nothing returns nothing
  call SetUnitAnimation(udg_Hero[GetPlayerId(GetTriggerPlayer())],"sleep")
endfunction

function X2D takes nothing returns nothing
  call SetUnitAnimationByIndex(udg_Hero[GetPlayerId(GetTriggerPlayer())],23)
endfunction

function XCD takes nothing returns nothing
endfunction

function RemindAboutSP takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer i=1
  local player p
  
  loop
    set p=Player(i)
    if HidePassivesForPlayer[i]==false then
      call DisplayTimedTextToPlayer(p,0,0,15,"|c006699CCTIP: Hide passive spells by writing -SP (You can still level them)|r")
    endif
    
    set i=i+1
    exitwhen i>11
  endloop
  
  call DestroyTimer(t)
  set t=null
endfunction

function RemindAboutSI takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer i=1
  local player p
  loop
    set p=Player(i)
    if SpellInfoShown[i]==false then
      call DisplayTimedTextToPlayer(p,0,0,15,"|c006699CCTIP: View your allies' spells in the scoreboard by writing -SI|r")
    endif
    
    set i=i+1
    exitwhen i>11
  endloop
  call DestroyTimer(t)
  set t=null
endfunction

function ModePicked takes nothing returns nothing
  local trigger t
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerAddCondition(t,Condition(function RTD))
  set NK=CreateTimer()
  if b_isPickTime then
    if s_MainMode=="sd" then
      set CreepSpawnTime=CreepSpawnTimeForSD+(NumberOfExtraAbilities*30)
    elseif s_MainMode=="md" then
      set CreepSpawnTime=CreepSpawnTimeForMD+(NumberOfExtraAbilities*30)
    elseif s_MainMode=="ap" then
      set CreepSpawnTime=baseCreepSpawnTime+(NumberOfExtraAbilities*30)
    else
      set CreepSpawnTime=90
    endif
    if Mode_RA then
      set CreepSpawnTime=CreepSpawnTime-(NumberOfExtraAbilities*30)
    endif
  else
    set CreepSpawnTime=90
  endif
  call TimerStart(NK,CreepSpawnTime+1,false,function HelpPlayerIfNotReady)
  
  set TIMERIMG[1]=false
  set TIMERIMG[2]=false
  set TIMERIMG[3]=false
  call ExeFunc("ShowTimersInit")
  set t=null
endfunction

function IsInvokersOrbs takes integer spell returns boolean
  return spell=='A21V' or spell=='A21W' or spell=='A21X'
endfunction

function Reduced_Spell takes integer spell returns boolean
  return spell=='A0FW' or spell=='A0GP' or spell=='A1EL' or spell=='A2BE' or spell=='A1S4' or spell=='A020' or spell=='A02Z'
endfunction

function Reduced_Spell_Proc takes unit u, integer spell returns boolean
  local integer info = GetHandleId(u)
  local boolean b = LoadBoolean(MHT,info,spell)
  
  call SaveBoolean(MHT,info,spell,b==false)
  
  return b==false
endfunction

function Semi_Valid_Spell takes integer spell returns boolean
  if IsInvokersOrbs(spell) then
    return false
  endif
  if Reduced_Spell(spell)then
    return LoadBoolean(MHT,GetHandleId(GetTriggerUnit()),spell)
  endif
  return true
endfunction

function BED takes integer Q28 returns boolean
  return (Mode_BO==false and Reduced_Spell(Q28))or IsInvokersOrbs(Q28)
endfunction

function isItemSpellOrNoCd takes integer x returns boolean
  return x=='A0JT' or x=='A2TH' or x=='A0DI' or x=='A231' or x=='A1ZH' or x=='A1ZI' or x=='A1ZW' or x=='A28D' or x=='A2KG' or x=='A2K3' or x=='A2EA' or x=='A2K1' or x=='A2K4' or x=='A2K7' or x=='A06X' or x=='A0AQ' or x=='A14O' or x=='A0NE' or x=='A14O' or x=='A1C0' or x=='A0K7' or x==1093682645 or x=='A0ZF' or x=='A1AC' or x=='A1QD' or x=='A0JL' or x=='AIpg' or x=='A11F' or x=='A0T9' or x=='A1T7' or x=='AIcy' or x=='A19M' or x=='A02O' or x=='A0FD' or x=='AChx' or x=='A1EW' or x=='A332' or x=='A2N1' or x=='A590' or x=='A591' or x=='A592' or x=='A593'
endfunction

function BGD takes integer si returns boolean
  return BED(si)==false and isItemSpellOrNoCd(si)==false and isDummyAbility(si)==false and isAintItemAbility(si) and IsItemAbilityById(si)==false
endfunction

function isFormlessAbility takes integer spell returns boolean//[lich] formless excluded from valid spells
  return spell=='A590' or spell=='A591' or spell=='A592' or spell=='A593'
endfunction

function isSkillWithZeroCD takes integer spell returns boolean
  return spell=='A02Z'//[lich] pugna's aghanim drain
endfunction

function Valid_Spell takes integer spell returns boolean
  return Semi_Valid_Spell(spell) and isPoisonArrowSkill(spell)==false and isItemSpellOrNoCd(spell)==false and isDummyAbility(spell)==false and isAintItemAbility(spell) and IsItemAbilityById(spell)==false and GetUnitAbilityLevel(GetTriggerUnit(),'A04R')==0 and isFormlessAbility(spell)==false and isSkillWithZeroCD(spell)==false
endfunction

function IsSpellInMulticastRestrictionList takes integer id returns boolean
  return id=='A2T5' or id=='A2TJ' or id=='A2QI' or id=='A1A1' or id=='A1B3' or id=='A0QR'
endfunction

function IsPurge takes integer id returns boolean
  return id=='AIpg' or id=='A1SA' or id=='A2T2' or id=='A2TN'
  
endfunction

function BalanceOffSpellChecker takes integer spell returns boolean
  return isPoisonArrowSkill(spell)==false and isItemSpellOrNoCd(spell)==false and isDummyAbility(spell)==false and isAintItemAbility(spell) and IsItemAbilityById(spell)==false and isFormlessAbility(spell)==false
endfunction

function MulticastSpellRestriction takes integer si returns boolean
  return IsSpellInMulticastRestrictionList(si)==false and isItemSpellOrNoCd(si)==false and isDummyAbility(si)==false and isAintItemAbility(si) and IsItemAbilityById(si)==false and IsInvokersOrbs(si)==false and si!='A2M0' and si!='Z603' and si!='A32G' and si!='A32E' and si!='A32D' and si!='A32C' and si!='A32A'
endfunction

function BHD takes nothing returns nothing
  local integer PlayerId
  local integer hn
  local integer xx
  local integer id
  set PlayerId=0
  
  if IsObserver(GetLocalPlayer())==false then
    call ClearSelection()
  endif
  
  loop
    if IsObserver(Player(PlayerId))==false then
      call BL8(Player(PlayerId))
      call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"|cff99ccff"+" "+"Your spells:"+"|r")
      set xx=1
      loop
        set id=PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]
        if id>600 then
          call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"	"+GetObjectName(SkillID[id])+"|cffffcc00"+" ("+"Invoker"+")"+"|r")
        else
          if xx==4 or xx==6 then
            call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"	"+"|c00ff0303"+GetObjectName(SkillID[id])+"|r"+"|cffffcc00"+" ("+GetObjectName(HeroID[(id+3)/4])+")"+"|r")
          else
            call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"	"+GetObjectName(SkillID[id])+"|cffffcc00"+" ("+GetObjectName(HeroID[(id+3)/4])+")"+"|r")
          endif
        endif
        set xx=xx+1
        exitwhen xx>4+NumberOfExtraAbilities
      endloop
      if MeleeOrRangedRestricted[PlayerId]==1 then
        call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15," ")
        call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"|c00FF0000[LoD]|r|c006699CC"+" "+"You can only pick MELEE heroes."+"|r")
      elseif MeleeOrRangedRestricted[PlayerId]==2 then
        call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15," ")
        call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"|c00FF0000[LoD]|r|c006699CC"+" "+"You can only pick RANGED heroes."+"|r")
      endif
      call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15," ")
      call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15," ")
      call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15,"|cff99ccff"+"You can now pick your hero."+"|r")
      call DisplayTimedTextToPlayer(Player(PlayerId),0,0,15," ")
      call SoundForPlayer(Player(PlayerId),"Sound\\Interface\\Rescue.wav")
      call SuspendTimeOfDay(false)
      set hn=1
      call HeroAttackTypeRestrictionForPlayer(Player(PlayerId),MeleeOrRangedRestricted[PlayerId])
    endif
    set PlayerId=PlayerId+1
    exitwhen PlayerId>11
  endloop
endfunction

function BID takes integer SJ8 returns nothing
  local integer BJD=R2I((I2R(SJ8)+3.)/ 4.)
  if BJD>151 then
    set BJD=151
  endif
  if not(b_IsHeroAlreadyPreloaded[BJD])then
    call JU9(BJD)
    set b_IsHeroAlreadyPreloaded[BJD]=true
  endif
endfunction

function BKD takes integer PlayerId returns nothing
  local integer xx=1
  loop
    call BID(PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx])
    set xx=xx+1
    exitwhen xx>4+NumberOfExtraAbilities
  endloop
endfunction


function DelayedUpgradedCourier_Go takes nothing returns nothing
  call DestroyTimer(GetExpiredTimer())//n0KG
  set FlyingCourierAllowed=true
endfunction

function AddFlyingCourierIfSolo takes nothing returns nothing
  local unit u
  set FlyingCourierAllowed=true
  call AddUnitToStock(ScourgeBuilding_ShopGraveyard,'h03Q',1,1)
  call AddUnitToStock(SentinelBuilding_ShopChimaera,'h03Q',1,1)
  set u=CreateUnit(Player(15),'uC74',-7360,-6388,270)
  call SetUnitVertexColor(u,255,100,0,255)
  set u=CreateUnit(Player(15),'uC74',6724,6592,270)
  call SetUnitVertexColor(u,255,100,0,255)
  set u=null
endfunction

function DisableRepick takes nothing returns nothing
  set boolean179=true
endfunction

function ShowCredits takes nothing returns nothing
  if Mode_S5 or Mode_S6 then
    call TimerStart(CreateTimer(),20+180,false,function RemindAboutSP)
  endif
  call TimerStart(CreateTimer(),20+300,false,function RemindAboutSI)
  call TimerStart(CreateTimer(),20,false,function DisableRepick)
  call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30,"|c00FF0000MAP BY:  DracoL1ch & ResQ|r")
  call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30,"|c006699CCGet updates about LoD, view changelogs|r")
  call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30,"|c006699CCand post any suggestions on:|r")
  call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30," ")
  call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30," |cFFFF8000www.LegendsOfDotA.com|r")
  call TimerStart(CreateTimer(),20+180,false,function DelayedUpgradedCourier_Go)
endfunction

function CleanTaverns takes nothing returns nothing
  call TechHeroForAll('HIV2')
  call TechHeroForAll('HIV3')
  call TechHeroForAll('HnUT')
endfunction

function BMD takes nothing returns nothing
  local trigger t
  local integer PlayerId
  local timer credits
  set PlayerId=0
  if TimerGetRemaining(NK)>0 then
    loop
      if QV8(PlayerId)then
        if not(b_isPlayerReady[PlayerId]) then
          return
        endif
      endif
      set PlayerId=PlayerId+1
      exitwhen PlayerId>12
    endloop
  endif
  set b_AllPlayersReady=true
  set PlayerId=0
  loop
    if QV8(PlayerId)then
      call CreateUnit(Player(PlayerId),'n00C',-6990.,6840.,.0)   //-7008.,6816. changed
      call BKD(PlayerId)
      call SM8(PlayerId)
    endif
    call RemoveUnit(SpellPickingDummy[PlayerId])
    set PlayerId=PlayerId+1
    exitwhen PlayerId>12
  endloop
  call PanCameraToTimed(-6990.,6840.,.0)   //-7008.,6816.	changed because it was strangecam
  call DestroyMultiboard(AbilityDraftMultiboard)
  call MultiboardDisplay(CSBoard,true)
  call AddUnitToStock(ScourgeBuilding_ShopGraveyard,'h02C',1,2)
  call AddUnitToStock(SentinelBuilding_ShopChimaera,'h02C',1,2)
  
  set b_isPickTime=false
  call CleanTaverns()
  call DestroyTimer(NK)
  set NK=CreateTimer()
  call TimerStart(NK,90+1,false,null)
  set credits=CreateTimer()
  call TimerStart(credits,70,false,function ShowCredits)
  if Mode_FN then
    call O4D()
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,30,false)
    call TriggerRegisterTimerEvent(t,90,false)
    call TriggerAddCondition(t,Condition(function O4D))
    set t=null
  endif
  call EnableTrigger(HeroEnters)
  set credits=null
  call BHD()
endfunction

function BND takes integer PlayerId,integer sn,integer VR9 returns nothing
  local multiboarditem mi
  local string BOD=SkillIcon[VR9]
  if Mode_Debug then
    if IsScourge(Player(PlayerId)) then
      set mi=MultiboardGetItem(AbilityDraftMultiboard,(PlayerId+2)-1,sn-1)
    else
      set mi=MultiboardGetItem(AbilityDraftMultiboard,(PlayerId+1)-1,sn-1)
    endif
  else
    set mi=MultiboardGetItem(AbilityDraftMultiboard,XK7[PlayerId]-1,sn-1)
  endif
  if IsSentinel(Player(PlayerId)) and Mode_SS==false then
    if IsScourge(GetLocalPlayer()) then
      if VR9==0 then
        set BOD=SkillIcon[0]
      else
        //if IsNotReplay then
        set BOD="ReplaceableTextures\\CommandButtons\\BTNQuestion.blp"
        //endif
      endif
    endif
  elseif IsScourge(Player(PlayerId)) and Mode_SS==false then
    if IsSentinel(GetLocalPlayer()) then
      if VR9==0 then
        set BOD=SkillIcon[0]
      else
        //if IsNotReplay then
        set BOD="ReplaceableTextures\\CommandButtons\\BTNQuestion.blp"
        //wendif
      endif
    endif
  endif
  call MultiboardSetItemIcon(mi,BOD)
  call MultiboardReleaseItem(mi)
  set mi=null
endfunction



function BanStunsFomComboing takes nothing returns nothing
  set DisablesList[0]=28+1//Fissure
  set DisablesList[1]=20+1//Storm bolt
  set DisablesList[2]=21*4+2//Avalanche
  set DisablesList[3]=45*4+1//Torrent
  set DisablesList[4]=36*4+4//Primal roar
  set DisablesList[5]=32*4+2//Dragon tail
  set DisablesList[6]=38*4+2//Unstable Conconction
  set DisablesList[7]=13*4+4//Overgrowth
  set DisablesList[8]=30*4+4//Hoof stomp
  set DisablesList[9]=76*4+4//Dismember
  set DisablesList[10]=80*4+1//Burrowstrike
  set DisablesList[11]=65*4+2//Slithereen crush
  set DisablesList[12]=73*4+4//Ravage
  set DisablesList[13]=62*4+1//Hellfire blast
  set DisablesList[14]=107*4+1//Chaos bolt
  set DisablesList[15]=105*4+4//Reverse polarity
  set DisablesList[16]=1//Magic missile
  set DisablesList[17]=39*4+2//Elunes arrow
  set DisablesList[18]=47*4+2//Homing missile
  set DisablesList[19]=6*4+2//Ensnare
  set DisablesList[20]=53*4+1//Xin's chains
  set DisablesList[21]=68*4+4//Chronosphere
  set DisablesList[22]=88*4+1//Earthbind
  set DisablesList[23]=64*4+1//Impale
  set DisablesList[24]=60*4+4//Stone gaze
  set DisablesList[25]=4*4+2//Frostbite
  set DisablesList[26]=40*4+2//Storm's thing
  set DisablesList[27]=46*4+1//Shackleshot
  set DisablesList[28]=10*4+2//Light strike array
  set DisablesList[29]=27*4+2//Hex
  set DisablesList[30]=27*4+3//Rhasta's net
  set DisablesList[31]=37*4+2//Ice path
  set DisablesList[32]=17*4+1//Fireblast
  set DisablesList[33]=52*4+1//Telekinesis
  set DisablesList[34]=74*4+3//Nightmare
  set DisablesList[35]=74*4+4//Bane's ulti
  set DisablesList[36]=103*4+1//Impale
  set DisablesList[37]=103*4+2//Hex
  set DisablesList[38]=85*4+1//WD's casks
  set DisablesList[39]=94*4+1//Malefice
  set DisablesList[40]=99*4+1//Split earth
  set DisablesList[41]=96*4+1//Cold feet
  set DisablesList[42]=86*4+2//Astral imprisonment
  set DisablesList[43]=100*4+1//Disruption
  set DisablesList[44]=111*4+1//Oracle's purge
  set DisablesList[45]=30*4+1//Hoof stomp
  set DisablesList[46]=45*4+4//Ghost ship
  set DisablesList[47]=110*4+3//Geomagnetic Grip
  set DisablesList[48]=77*4+1//Charge of darkness
  set DisablesListCount=48
endfunction


function CheckDisablesPicked takes integer pid returns integer
  local integer k=0
  local integer c=0
  loop
    if PlayerSkillNumber[pid*PlayerSkillOffset+1]==DisablesList[k] or PlayerSkillNumber[pid*PlayerSkillOffset+2]==DisablesList[k]  or PlayerSkillNumber[pid*PlayerSkillOffset+3]==DisablesList[k] or PlayerSkillNumber[pid*PlayerSkillOffset+4]==DisablesList[k] or (NumberOfExtraAbilities>=1 and PlayerSkillNumber[pid*PlayerSkillOffset+5]==DisablesList[k]) or (NumberOfExtraAbilities>=2 and PlayerSkillNumber[pid*PlayerSkillOffset+6]==DisablesList[k]) then
      set c=c+1
    endif
    set k=k+1
    exitwhen k>DisablesListCount
  endloop
  return c
endfunction

function IsDisableSkill takes integer skillid returns boolean
  local integer i=0
  local integer k=0
  local boolean b=false
  loop
    if skillid==DisablesList[k] then
      set b=true
    endif
    set k=k+1
    exitwhen b or k>DisablesListCount
  endloop
  return b
endfunction

function CheckAbilitiesForStacking takes integer newindex,integer PlayerId,boolean showMsgs returns boolean
  local string BQD=StackingLimitations[newindex]
  local boolean BRD=I2R(newindex/ 4)==I2R(newindex)/ 4.
  local boolean pr=true
  local integer ns=0  //stacking id for passives and number of abilities from the same hero
  local integer ns2=0 //2nd id
  local integer ns3=0 //3rd id
  local integer xx=0
  local integer RG8=0
  local integer BSD=0
  local integer BTD=0
  local string desc=""
  local integer abilityhero=0
  local integer abilityhero2=0
  local boolean toomanydisables=false
  local boolean toomanydisablescauseteam=false
  //	if (newindex+3)/4==94 or (newindex+3)/4==194 or (newindex+3)/4==195 then //Invoker
  //		//set newindex=InvokerSkill[PlayerId*4+newindex-93*4]
  //		//set BQD=StackingLimitations[newindex]
  //	endif
  if newindex==464 or newindex==(116-1)*4+4 or newindex==(115-1)*4+4  or newindex==(114-1)*4+4 then //Invoker has no ult :<
    set BRD=false
  endif
  //if(StackingLimitations_Balanced[newindex]!=null)and(not(Mode_BO))then
  //	set BQD=BQD+", "+StackingLimitations_Balanced[newindex]
  //endif
  
  
  if b_isPlayerReady[PlayerId]then
    call QB8(Player(PlayerId),showMsgs,"You are ready")
    return false
  endif
  if RA8(BQD,"not work",null)or(not(Mode_BO)and RA8(StackingLimitations_Balanced[newindex],"not work",null))then
    call QB8(Player(PlayerId),showMsgs,"This skill doesn't work :(")
    return false
  endif
  
  if Mode_S5 or Mode_S6 then
    if RA8(BQD,"multi-icon",null)then
      call QA8(Player(PlayerId),showMsgs,"WARNING: This skill is Multi-icon type.")
    endif
  endif
  if Mode_DM or s_MainMode=="ar" then
    if newindex==12 or newindex==88 or newindex==98 or newindex==99 or newindex==103 or newindex==131 or newindex==171 or newindex==231 or newindex==234 or newindex==248 then
      return false
    endif
  endif
  if Mode_OS then
    if IsSentinel(Player(PlayerId)) then
      set RG8=1
    else
      set RG8=2
    endif
    if OneSkillCheckArray[RG8*OneSkillOffsetCheck+newindex]!=0 then
      call QB8(Player(PlayerId),showMsgs,"A player has already picked this ability: "+udg_Colors[OneSkillCheckArray[RG8*OneSkillOffsetCheck+newindex]]+IL7[OneSkillCheckArray[RG8*OneSkillOffsetCheck+newindex]]+"|r")
      return false
    endif
  endif
  set xx=1
  loop
    if BRD then
      if xx==4 or xx==6 then
        if PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]==0 then
          set BTD=xx
          exitwhen true
        endif
      endif
    else
      if not(xx==4 or xx==6)then
        if PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]==0 then
          set BSD=xx
          exitwhen true
        endif
      endif
    endif
    set xx=xx+1
    exitwhen xx>4+NumberOfExtraAbilities
  endloop
  if BTD==0 and BRD then
    call QB8(Player(PlayerId),showMsgs,"You need to pick a regular skill (not an ultimate).")
    return false
  endif
  if BSD==0 and not(BRD)then
    call QB8(Player(PlayerId),showMsgs,"You need to pick an ultimate.")
    return false
  endif
  if Mode_RA then
    if PlayerSkillNumber[PlayerId*PlayerSkillOffset+5]==0 and NumberOfExtraAbilities>=1 then
      set BSD=5
    endif
    if PlayerSkillNumber[PlayerId*PlayerSkillOffset+6]==0 and NumberOfExtraAbilities>=2 then
      set BTD=6
    endif
  endif
  if RA8(BQD,"melee only",null)or(not(Mode_BO)and RA8(StackingLimitations_Balanced[newindex],"melee only",null))or RA8(BQD,"melee morph",null)then
    set xx=1
    loop
      if RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"range only",null)or(not(Mode_BO)and RA8(StackingLimitations_Balanced[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"range only",null))or RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"range morph",null)then
        set ns=xx
        if RA8(BQD,"melee morph",null)then
          set desc="You cannot pick a melee transformation skill"
        else
          set desc="You cannot pick a melee only skill"
        endif
        exitwhen true
      endif
      set xx=xx+1
      exitwhen xx>4+NumberOfExtraAbilities
    endloop
    set xx=1
    loop
      if RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],BQD,"melee only")or(not(Mode_BO)and RA8(StackingLimitations_Balanced[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],BQD,"melee only"))then
        set ns=xx
        
        
        
        set desc="buggy/orderids"
        exitwhen true
      endif
      set xx=xx+1
      exitwhen xx>4+NumberOfExtraAbilities
    endloop
  elseif RA8(BQD,"range only",null)or(not(Mode_BO)and RA8(StackingLimitations_Balanced[newindex],"range only",null))or RA8(BQD,"range morph",null)then
    set xx=1
    loop
      if RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"melee only",null)or(not(Mode_BO)and RA8(StackingLimitations_Balanced[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"melee only",null))or RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"melee morph",null)then
        set ns=xx
        if RA8(BQD,"range morph",null)then
          set desc="You cannot pick a ranged transformation skill"
        else
          set desc="You cannot pick a ranged only skill"
        endif
        exitwhen true
      endif
      set xx=xx+1
      exitwhen xx>4+NumberOfExtraAbilities
    endloop
    set xx=1
    loop
      if RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],BQD,"range only")or(not(Mode_BO)and RA8(StackingLimitations_Balanced[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],BQD,"range only"))then
        set ns=xx
        set desc="buggy/orderids"
        exitwhen true
      endif
      set xx=xx+1
      exitwhen xx>4+NumberOfExtraAbilities
    endloop
  else
    set xx=1
    loop
      if RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],BQD,null)or(not(Mode_BO)and RA8(StackingLimitations_Balanced[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],BQD,null))then
        set ns=xx
        set desc="buggy/orderids"
        exitwhen true
      endif
      set xx=xx+1
      exitwhen xx>4+NumberOfExtraAbilities
    endloop
  endif
  if ns==0 then
    if FindString(BQD,"passive") and (Mode_LS) then
      set xx=1
      loop
        if FindString(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"passive") or FindString(StackingLimitations_Balanced[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"passive") then
          if ns2==0 then
            set ns2=xx
          elseif Mode_LS3 then
            if ns3==0 then
              set ns3=xx
            else
              set ns=xx
              set desc="no more than 3 passives"
              exitwhen true
            endif
          else
            set ns=xx
            set desc="no more than 2 passives"
            exitwhen true
          endif
        endif
        set xx=xx+1
        exitwhen (xx>4+NumberOfExtraAbilities) or (xx>4 and Mode_RA)
      endloop
    endif
  endif
  if IsDisableSkill(newindex) then
    set toomanydisables=CheckDisablesPicked(PlayerId)>=2
    if toomanydisables==false then
      if IsSentinel(Player(PlayerId)) then
        set toomanydisables=(CheckDisablesPicked(GetPlayerId(Sentinels[1]))+CheckDisablesPicked(GetPlayerId(Sentinels[2]))+CheckDisablesPicked(GetPlayerId(Sentinels[3]))+CheckDisablesPicked(GetPlayerId(Sentinels[4]))+CheckDisablesPicked(GetPlayerId(Sentinels[5])))>=7
      else
        set toomanydisables=(CheckDisablesPicked(GetPlayerId(Scourges[1]))+CheckDisablesPicked(GetPlayerId(Scourges[2]))+CheckDisablesPicked(GetPlayerId(Scourges[3]))+CheckDisablesPicked(GetPlayerId(Scourges[4]))+CheckDisablesPicked(GetPlayerId(Scourges[5])))>=7
      endif
      set toomanydisablescauseteam=toomanydisables
    endif
  endif
  if ns==0 then
    if (Mode_LS) then
      
      if toomanydisables==false then
        set ns2=0
        set ns3=0
        set abilityhero=(newindex-1)/4
        set xx=1
        loop
          if PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]!=0  then
            set abilityhero2=(PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]-1)/4
            //call echo("Selected hero: "+I2S(abilityhero)+"; Ability #"+I2S(PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx])+" (slot "+I2S(xx)+") hero:"+I2S(abilityhero2)+"; ns="+I2S(ns)+"; ns2="+I2S(ns2)+"; ns3="+I2S(ns3))
            if (abilityhero2==abilityhero) then
              //call echo("abilityhero2==abilityhero")
              if ns2==0 then
                set ns2=xx
              elseif Mode_LS3 then
                if ns3==0 then
                  set ns3=xx
                else
                  set ns=xx
                  set desc="no more than 3 abilities from the same hero"
                  exitwhen true
                endif
              else
                set ns=xx
                set desc="no more than 2 abilities from the same hero"
                exitwhen true
              endif
            endif
          endif
          set xx=xx+1
          exitwhen (xx>4+NumberOfExtraAbilities) or (xx>4 and Mode_RA)
        endloop
      endif
    endif
  endif
  if ns!=0 then
    if desc!="" then
      if ns3!=0 then
        call QB8(Player(PlayerId),showMsgs,"Does not stack with : "+GetObjectName(SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+ns]])+"/"+GetObjectName(SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+ns2]])+"/"+GetObjectName(SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+ns3]])+" ("+desc+")")
      elseif ns2!=0 then
        call QB8(Player(PlayerId),showMsgs,"Does not stack with : "+GetObjectName(SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+ns]])+"/"+GetObjectName(SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+ns2]])+" ("+desc+")")
      else
        call QB8(Player(PlayerId),showMsgs,"Does not stack with : "+GetObjectName(SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+ns]])+" ("+desc+")")
      endif
    else
      call QB8(Player(PlayerId),showMsgs,"Does not stack with : "+GetObjectName(SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+ns]]))
    endif
    return false
  endif
  if toomanydisables then
    if toomanydisablescauseteam==false then
      call QB8(Player(PlayerId),showMsgs,"This spell cannot be picked, you already have 2 disables!")
    else
      call QB8(Player(PlayerId),showMsgs,"You cannot pick this disable! Your team already has 7 disables!")
    endif
    return false
  endif
  if BRD then
    set PlayerSkillNumber[PlayerId*PlayerSkillOffset+BTD]=newindex
    call BND(PlayerId,BTD,newindex)
    if UltimatesHeroId[PlayerId]==0 then
      set UltimatesHeroId[PlayerId]=HeroID[R2I((I2R(newindex)+3.)/ 4.)]
      if GetScepterIndexId(PlayerId)==indexid_AghanimBasic then
        set UltimatesHeroId[PlayerId]=0
      endif
    endif
  else
    set PlayerSkillNumber[PlayerId*PlayerSkillOffset+BSD]=newindex
    call BND(PlayerId,BSD,newindex)
  endif
  if Mode_OS then
    if OneSkillCheckArray[RG8*OneSkillOffsetCheck+newindex]==0 then
      set OneSkillCheckArray[RG8*OneSkillOffsetCheck+newindex]=PlayerId
    endif
  endif
  set xx=1
  loop
    if PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]==0 then
      set pr=false
      exitwhen true
    endif
    set xx=xx+1
    exitwhen xx>4+NumberOfExtraAbilities
  endloop
  if pr then
    set b_isPlayerReady[PlayerId]=true
  endif
  if RA8(BQD,"melee only",null) then
    set MeleeOrRangedRestricted[PlayerId]=1
    call DisplayWithoutClear(Player(PlayerId),showMsgs,"WARNING: This skill is melee only.")
  endif
  if RA8(BQD,"range only",null) then
    set MeleeOrRangedRestricted[PlayerId]=2
    call DisplayWithoutClear(Player(PlayerId),showMsgs,"WARNING: This skill is ranged only.")
  endif
  if RA8(BQD,"melee morph",null) then
    call DisplayWithoutClear(Player(PlayerId),showMsgs,"WARNING: This skill is a melee transformation.")
  endif
  if RA8(BQD,"range morph",null) then
    call DisplayWithoutClear(Player(PlayerId),showMsgs,"WARNING: This skill is a ranged transformation.")
  endif
  if SkillID[newindex]=='A2CI' then//Duel
    call DisplayWithoutClear(Player(PlayerId),showMsgs,"WARNING: Duel disables most passives on both the target and the caster.")
  endif
  if (not(Mode_BO)and BalanceStrings[newindex]!="")then
    call DisplayWithoutClear(Player(PlayerId),showMsgs,"BALANCE: "+BalanceStrings[newindex])
  endif
  if (Mode_EB and ExBalanceStrings[newindex]!="")then
    call DisplayWithoutClear(Player(PlayerId),showMsgs,"EXTENDED BALANCE: "+ExBalanceStrings[newindex])
  endif
  return true
endfunction

function VV9 takes nothing returns nothing
  local unit u=LoadUnitHandle(hashtable019,'hRUT',1)
  local integer PlayerId=GetPlayerId(GetOwningPlayer(u))
  local integer SJ8
  local integer i=0
  local integer te
  set PlayerSkillNumber[PlayerId*PlayerSkillOffset+1]=LoadInteger(hashtable019,'hRUT',2)
  set PlayerSkillNumber[PlayerId*PlayerSkillOffset+2]=LoadInteger(hashtable019,'hRUT',3)
  set PlayerSkillNumber[PlayerId*PlayerSkillOffset+3]=LoadInteger(hashtable019,'hRUT',4)
  set PlayerSkillNumber[PlayerId*PlayerSkillOffset+4]=LoadInteger(hashtable019,'hRUT',5)
  set PlayerSkillNumber[PlayerId*PlayerSkillOffset+5]=LoadInteger(hashtable019,'hRUT',6)
  set PlayerSkillNumber[PlayerId*PlayerSkillOffset+6]=LoadInteger(hashtable019,'hRUT',7)
  set ExtraAbilityLevel[PlayerId*2+1]=LoadInteger(hashtable019,'hRUT',8)
  set ExtraAbilityLevel[PlayerId*2+2]=LoadInteger(hashtable019,'hRUT',9)
  set UltimatesHeroId[PlayerId]=LoadInteger(hashtable019,'hRUT',10)
  
  loop
    set SJ8=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
    loop
      set SJ8=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes*4))
      //exitwhen (SJ8+3)/4!=94//not Invoker
      set te=(SJ8+3)/4//[lich] ^ and v is useful. really!
      exitwhen IsHeroIngame[te]==false//GetPlayerTechMaxAllowed(Player(PlayerId),HeroID[te])>0 and 
    endloop
    if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)then
      if not RA8(StackingLimitations[SJ8],"range only","0")then
        call SaveInteger(hashtable019,'0REA','0PID',PlayerId)
        call SaveInteger(hashtable019,'0REA','0SID',SJ8)
        call SaveBoolean(hashtable019,'0REA','000B',false)
        call ExeFunc("BUD")
      endif
    else
      if not RA8(StackingLimitations[SJ8],"melee only","0")then
        call SaveInteger(hashtable019,'0REA','0PID',PlayerId)
        call SaveInteger(hashtable019,'0REA','0SID',SJ8)
        call SaveBoolean(hashtable019,'0REA','000B',false)
        call ExeFunc("BUD")
      endif
    endif
    set i=i+1
    exitwhen b_isPlayerReady[PlayerId]
  endloop
  if not b_isPlayerReady[PlayerId] then
    
    call SaveInteger(hashtable019,'hRUT',2,PlayerSkillNumber[PlayerId*PlayerSkillOffset+1])
    call SaveInteger(hashtable019,'hRUT',3,PlayerSkillNumber[PlayerId*PlayerSkillOffset+2])
    call SaveInteger(hashtable019,'hRUT',4,PlayerSkillNumber[PlayerId*PlayerSkillOffset+3])
    call SaveInteger(hashtable019,'hRUT',5,PlayerSkillNumber[PlayerId*PlayerSkillOffset+4])
    call SaveInteger(hashtable019,'hRUT',6,PlayerSkillNumber[PlayerId*PlayerSkillOffset+5])
    call SaveInteger(hashtable019,'hRUT',7,PlayerSkillNumber[PlayerId*PlayerSkillOffset+6])
    call SaveInteger(hashtable019,'hRUT',8,ExtraAbilityLevel[PlayerId*2+1])
    call SaveInteger(hashtable019,'hRUT',9,ExtraAbilityLevel[PlayerId*2+2])
    call SaveInteger(hashtable019,'hRUT',10,UltimatesHeroId[PlayerId])
    call ExeFunc("VV9")
  endif
  call FlushChildHashtable(hashtable019,'hRUT')
  call VP9(u,Player(PlayerId))
  call BKD(PlayerId)
  call SM8(PlayerId)
  set b_isPlayerReady[PlayerId]=false
  set u=null
endfunction

function RUD takes nothing returns nothing
  local integer SJ8
  local integer BJD
  local integer PlayerId
  local integer te
  set PlayerId=0
  loop
    if QV8(PlayerId)then
      loop
        exitwhen b_isPlayerReady[PlayerId]
        if s_MainMode=="sd" or s_MainMode=="md" then
          loop
            set BJD=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
            exitwhen(b_HeroAvailableForPlayer[PlayerId*NumberOfHeroes+BJD] and IsHeroIngame[BJD-1]==false)
          endloop
          set SJ8=(BJD*4)-4
          set SJ8=SJ8+GetRandomInt(1,4)
          call SaveInteger(hashtable019,'0REA','0PID',PlayerId)
          call SaveInteger(hashtable019,'0REA','0SID',SJ8)
          call SaveBoolean(hashtable019,'0REA','000B',false)
          call ExeFunc("BUD")
        else
          loop//[lich] add -ready support to other modes
            set SJ8=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes*4))
            set te=(SJ8+3)/4
            exitwhen(IsHeroIngame[te]==false and GetPlayerTechMaxAllowed(GetTriggerPlayer(),HeroID[te])>0)
          endloop
          //set SJ8=GetRandomInt(1,NumberOfHeroes*4)
          call SaveInteger(hashtable019,'0REA','0PID',PlayerId)
          call SaveInteger(hashtable019,'0REA','0SID',SJ8)
          call SaveBoolean(hashtable019,'0REA','000B',false)
          call ExeFunc("BUD")
        endif
      endloop
      call BMD()
    endif
    set PlayerId=PlayerId+1
    exitwhen PlayerId>12
  endloop
endfunction

function BVD takes integer PlayerId,integer SJ8 returns boolean
  local integer xx
  local integer RG8
  local integer sn
  local integer PlayerId2
  if SJ8>600 then
    set sn=1
    loop
      exitwhen InvokerSkill[PlayerId*4+sn]==SJ8 or sn>4
      set sn=sn+1
    endloop
  else
    set sn=R2I((I2R(SJ8)+3.)/ 4.)
    set sn=SJ8-((sn-1)*4)
  endif
  if Mode_RA then
    if PlayerSkillNumber[PlayerId*PlayerSkillOffset+5]==SJ8 and NumberOfExtraAbilities>=1 then
      call QB8(Player(PlayerId),true,"You cannot remove this skill on \"Random Extra Abilities\" mode.")
      return false
    endif
    if PlayerSkillNumber[PlayerId*PlayerSkillOffset+6]==SJ8 and NumberOfExtraAbilities>=2 then
      call QB8(Player(PlayerId),true,"You cannot remove this skill on \"Random Extra Abilities\" mode.")
      return false
    endif
  endif
  set xx=1
  loop
    if(PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]==SJ8)then
      set PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]=0
      call BND(PlayerId,xx,0)
      if(xx==4 or xx==6)and UltimatesHeroId[PlayerId]==HeroID[R2I((I2R(SJ8)+3.)/ 4.)] and SJ8<=600 then
        set UltimatesHeroId[PlayerId]=0
      endif
      exitwhen true
    endif
    set xx=xx+1
    exitwhen xx>4+NumberOfExtraAbilities
  endloop
  set MeleeOrRangedRestricted[PlayerId]=0
  set xx=1
  loop
    if RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"melee only","") or (Mode_BO==false and RA8(StackingLimitations_Balanced[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"melee only","")) then
      set MeleeOrRangedRestricted[PlayerId]=1
      exitwhen true
    elseif RA8(StackingLimitations[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"range only","") or (Mode_BO==false and RA8(StackingLimitations_Balanced[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],"range only",""))then
      set MeleeOrRangedRestricted[PlayerId]=2
      exitwhen true
    endif
    set xx=xx+1
    exitwhen xx>4+NumberOfExtraAbilities
  endloop
  call UnitRemoveAbility(SpellPickingDummy[PlayerId],('Z004'-1)+sn)
  call UnitAddAbility(SpellPickingDummy[PlayerId],('Z000'-1)+sn)
  if Mode_OS then
    set xx=0
    loop
      if IsSentinel(Player(PlayerId)) then
        set PlayerId2=GetPlayerId(Sentinels[xx])
      else
        set PlayerId2=GetPlayerId(Scourges[xx])
      endif
      if GetUnitAbilityLevel(SpellPickingDummy[PlayerId2],SkillID[SJ8])>0 then
        //				if SJ8>600 then //Invoker
        //					set sn=1
        //					loop
        //						if InvokerSkill[PlayerId2*4+sn]==SJ8 then
        //							call UnitRemoveAbility(SpellPickingDummy[PlayerId2],('Z010'-1)+sn)
        //							call UnitAddAbility(SpellPickingDummy[PlayerId2],('Z000'-1)+sn)
        //							exitwhen true
        //						endif
        //						set sn=sn+1
        //						exitwhen sn>4
        //					endloop
        //				else
        call UnitRemoveAbility(SpellPickingDummy[PlayerId2],('Z010'-1)+sn)
        call UnitAddAbility(SpellPickingDummy[PlayerId2],('Z000'-1)+sn)
        //				endif
      endif
      set xx=xx+1
      exitwhen xx>5
    endloop
    if IsSentinel(Player(PlayerId)) then
      set RG8=1
    else
      set RG8=2
    endif
    if OneSkillCheckArray[RG8*OneSkillOffsetCheck+SJ8]==PlayerId then
      set OneSkillCheckArray[RG8*OneSkillOffsetCheck+SJ8]=0
    endif
  endif
  return true
endfunction

function ResetSpellsSingle takes nothing returns nothing
  local integer PlayerId=GetPlayerId(GetTriggerPlayer())
  local integer i=S2I(SubString(GetEventPlayerChatString(),2,3))
  if i==0 then
    set i=S2I(SubString(GetEventPlayerChatString(),3,4))
  endif
  if b_isPickTime==true then
    if TimerGetElapsed(GlobalTimer)>ResetCooldown[PlayerId]+4 then
      if i<7 and i>0 then
        //local integer i=(SelectedSkillHeroPointValue[PlayerId]*4)-4
        set ResetCooldown[PlayerId]=TimerGetElapsed(GlobalTimer)
        call BVD(PlayerId,PlayerSkillNumber[PlayerId*PlayerSkillOffset+i])
        set b_isPlayerReady[PlayerId]=false
      else
        call Error(GetTriggerPlayer(),"Wrong index, try [1-6]")
      endif
    else
      call Error(GetTriggerPlayer(),"Do not spam. Try later.")
    endif
  endif
  
  
endfunction

function ResetSpells takes nothing returns nothing
  local integer PlayerId=GetPlayerId(GetTriggerPlayer())
  if b_isPickTime==true then
    if TimerGetElapsed(GlobalTimer)>ResetCooldown[PlayerId]+4 then
      //local integer i=(SelectedSkillHeroPointValue[PlayerId]*4)-4
      set ResetCooldown[PlayerId]=TimerGetElapsed(GlobalTimer)
      call BVD(PlayerId,PlayerSkillNumber[PlayerId*PlayerSkillOffset+1])
      call BVD(PlayerId,PlayerSkillNumber[PlayerId*PlayerSkillOffset+2])
      call BVD(PlayerId,PlayerSkillNumber[PlayerId*PlayerSkillOffset+3])
      call BVD(PlayerId,PlayerSkillNumber[PlayerId*PlayerSkillOffset+4])
      call BVD(PlayerId,PlayerSkillNumber[PlayerId*PlayerSkillOffset+5])
      call BVD(PlayerId,PlayerSkillNumber[PlayerId*PlayerSkillOffset+6])
      set b_isPlayerReady[PlayerId]=false
    else
      call Error(GetTriggerPlayer(),"Do not spam. Try later.")
    endif
  endif
endfunction

function BWD takes nothing returns nothing
  local integer PlayerId=GetPlayerId(GetTriggerPlayer())
  local integer xx
  if not(b_AllPlayersReady)and s_MainMode!="ar" then
    set xx=1
    loop
      call BVD(PlayerId,PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx])
      set xx=xx+1
      exitwhen xx>4+NumberOfExtraAbilities
    endloop
  endif
endfunction

function BXD takes nothing returns nothing
  local integer PlayerId=GetPlayerId(GetOwningPlayer(GetSpellAbilityUnit()))
  local integer VR9=(SelectedSkillHeroPointValue[PlayerId]*4)-4
  local integer sn
  if GetSpellAbilityId()=='Z004' then
    //		if SelectedSkillHeroPointValue[PlayerId]==94 then
    //			set VR9=InvokerSkill[4*PlayerId+1]
    //		else
    set VR9=VR9+1
    //		endif
    set sn=1
  elseif GetSpellAbilityId()=='Z005' then
    //		if SelectedSkillHeroPointValue[PlayerId]==94 then
    //			set VR9=InvokerSkill[4*PlayerId+2]
    //		else
    set VR9=VR9+2
    //		endif
    set sn=2
  elseif GetSpellAbilityId()=='Z006' then
    //		if SelectedSkillHeroPointValue[PlayerId]==94 then
    //			set VR9=InvokerSkill[4*PlayerId+3]
    //		else
    set VR9=VR9+3
    //		endif
    set sn=3
  elseif GetSpellAbilityId()=='Z007' then
    //		if SelectedSkillHeroPointValue[PlayerId]==94 then
    //			set VR9=InvokerSkill[4*PlayerId+4]
    //		else
    set VR9=VR9+4
    //		endif
    set sn=4
  else
    return
  endif
  if BVD(PlayerId,VR9)then
    set b_isPlayerReady[PlayerId]=false
  endif
endfunction

function BYD takes nothing returns nothing
  local integer PlayerId=GetPlayerId(GetOwningPlayer(GetSpellAbilityUnit()))
  local integer VR9=(SelectedSkillHeroPointValue[PlayerId]*4)-4
  local integer sn
  local integer xx
  local integer PlayerId2
  if not ((GetSpellAbilityId()>='Z000' and GetSpellAbilityId()<='Z003') or (GetSpellAbilityId()>='Z010' and GetSpellAbilityId()<='Z013')) then
    return
  endif
  if GetSpellAbilityId()=='Z000' or GetSpellAbilityId()=='Z010' then
    //		if SelectedSkillHeroPointValue[PlayerId]==94 then
    //			set VR9=InvokerSkill[4*PlayerId+1]
    //		else
    set VR9=VR9+1
    //		endif
    set sn=1
  elseif GetSpellAbilityId()=='Z001' or GetSpellAbilityId()=='Z011' then
    //		if SelectedSkillHeroPointValue[PlayerId]==94 then
    //			set VR9=InvokerSkill[4*PlayerId+2]
    //		else
    set VR9=VR9+2
    //		endif
    set sn=2
  elseif GetSpellAbilityId()=='Z002' or GetSpellAbilityId()=='Z012' then
    //		if SelectedSkillHeroPointValue[PlayerId]==94 then
    //			set VR9=InvokerSkill[4*PlayerId+3]
    //		else
    set VR9=VR9+3
    //		endif
    set sn=3
  elseif GetSpellAbilityId()=='Z003' or GetSpellAbilityId()=='Z013' then
    //		if SelectedSkillHeroPointValue[PlayerId]==94 then
    //			set VR9=InvokerSkill[4*PlayerId+4]
    //		else
    set VR9=VR9+4
    //		endif
    set sn=4
  else
    return
  endif
  if not CheckAbilitiesForStacking(VR9,PlayerId,true) then
    
    return
  endif
  if isPlayerPickedAbility(Player(PlayerId),VR9)then
    
    call UnitRemoveAbility(SpellPickingDummy[PlayerId],('Z000'-1)+sn)
    call UnitAddAbility(SpellPickingDummy[PlayerId],('Z004'-1)+sn)
    if Mode_OS then
      set xx=1
      loop
        if IsSentinel(Player(PlayerId)) then
          set PlayerId2=GetPlayerId(Sentinels[xx])
        else
          set PlayerId2=GetPlayerId(Scourges[xx])
        endif
        if GetUnitAbilityLevel(SpellPickingDummy[PlayerId2],SkillID[VR9])>0 and PlayerId!=PlayerId2 then
          //					if VR9>600 then //Invoker
          //						set sn=1
          //						loop
          //							if InvokerSkill[PlayerId2*4+sn]==VR9 then
          //								call UnitRemoveAbility(SpellPickingDummy[PlayerId2],('Z000'-1)+sn)
          //								call UnitAddAbility(SpellPickingDummy[PlayerId2],('Z010'-1)+sn)
          //								exitwhen true
          //							endif
          //							set sn=sn+1
          //							exitwhen sn>4
          //						endloop
          //					else
          call UnitRemoveAbility(SpellPickingDummy[PlayerId2],('Z000'-1)+sn)
          call UnitAddAbility(SpellPickingDummy[PlayerId2],('Z010'-1)+sn)
          //					endif
        endif
        set xx=xx+1
        exitwhen xx>5
      endloop
    endif
  endif
  if b_isPlayerReady[PlayerId]then
    call BMD()
  endif
endfunction

function BZD takes integer PlayerId,integer i returns nothing
  local integer rnd
  local integer PlayerId1=GetPlayerId(Sentinels[PlayerId])
  local integer PlayerId2=GetPlayerId(Scourges[PlayerId])
  local integer herocount=11
  if PlayerId==0 or PlayerId==6 or i==0 then
    return
  endif
  if i_BonusDraftAmount>0 then
    if i>(PlayerId*20)-20 and i<=(PlayerId*20) then
      call SetPlayerTechMaxAllowed(Player(PlayerId1),HeroID[HeroNumArrayRandomized[i]],999)
      set b_HeroAvailableForPlayer[PlayerId1*NumberOfHeroes+HeroNumArrayRandomized[i]]=true
      call SetPlayerTechMaxAllowed(Player(PlayerId2),HeroID[HeroNumArrayRandomized[i]],999)
      set b_HeroAvailableForPlayer[PlayerId2*NumberOfHeroes+HeroNumArrayRandomized[i]]=true
    endif
  else
    if i>(PlayerId*herocount)-herocount and i<=(PlayerId*herocount) then
      call SetPlayerTechMaxAllowed(Player(PlayerId1),HeroID[HeroNumArrayRandomized[i]],999)
      set b_HeroAvailableForPlayer[PlayerId1*NumberOfHeroes+HeroNumArrayRandomized[i]]=true
      set SDHeroesPool[PlayerId1*100+SDHeroesPoolInc[PlayerId1]]=HeroIcon[HeroNumArrayRandomized[i]]
      set SDHeroesIDs[PlayerId1*100+SDHeroesPoolInc[PlayerId1]]=HeroID[HeroNumArrayRandomized[i]]
      set SDHeroesPoolInc[PlayerId1]=SDHeroesPoolInc[PlayerId1]+1
      call SetPlayerTechMaxAllowed(Player(PlayerId2),HeroID[HeroNumArrayRandomized[i]],999)
      set b_HeroAvailableForPlayer[PlayerId2*NumberOfHeroes+HeroNumArrayRandomized[i]]=true
      set SDHeroesPool[PlayerId2*100+SDHeroesPoolInc[PlayerId2]]=HeroIcon[HeroNumArrayRandomized[i]]
      set SDHeroesIDs[PlayerId2*100+SDHeroesPoolInc[PlayerId2]]=HeroID[HeroNumArrayRandomized[i]]
      set SDHeroesPoolInc[PlayerId2]=SDHeroesPoolInc[PlayerId2]+1
    endif
  endif
  if i_BonusHeroCounter[PlayerId]<i_BonusDraftAmount-10 then
    if i_BonusDraftAmount>0 then
      loop
        set rnd=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
        exitwhen((rnd>(PlayerId*20))or(rnd<=(PlayerId*20)-20)) and IsHeroIngame[rnd]==false//and b_HeroAvailableForPlayer[PlayerId1*NumberOfHeroes+rnd]==true  
      endloop
    else
      loop
        set rnd=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
        exitwhen((rnd>(PlayerId*herocount))or(rnd<=(PlayerId*herocount)-herocount)) and IsHeroIngame[rnd]==false//and b_HeroAvailableForPlayer[PlayerId1*NumberOfHeroes+HeroNumArrayRandomized[rnd]]==true and b_isHeroPicked[rnd]==false
      endloop
    endif
    call SetPlayerTechMaxAllowed(Player(PlayerId1),HeroID[HeroNumArrayRandomized[rnd]],999)
    set b_HeroAvailableForPlayer[PlayerId1*NumberOfHeroes+HeroNumArrayRandomized[rnd]]=true
    call SetPlayerTechMaxAllowed(Player(PlayerId2),HeroID[HeroNumArrayRandomized[rnd]],999)
    set b_HeroAvailableForPlayer[PlayerId2*NumberOfHeroes+HeroNumArrayRandomized[rnd]]=true
    set i_BonusHeroCounter[PlayerId]=i_BonusHeroCounter[PlayerId]+1
  endif
endfunction

function BAD takes nothing returns nothing
  local integer PlayerId=0
  local integer i
  local integer j
  local integer n
  local integer f
  set i=0
  //	loop //mirror the Invoker spells on each side
  //		set j=GetPlayerId(Sentinels[i])
  //		set n=GetPlayerId(Scourges[i])
  //		set InvokerSkill[n*4+1]=InvokerSkill[j*4+1]
  //		set InvokerSkill[n*4+2]=InvokerSkill[j*4+2]
  //		set InvokerSkill[n*4+3]=InvokerSkill[j*4+3]
  //		set InvokerSkill[n*4+4]=InvokerSkill[j*4+4]
  //		set i=i+1
  //		exitwhen i>5
  //	endloop
  set i=0
  loop
    set HeroNumArrayRandomized[i]=AdjustHeroNumber(i)
    set i=i+1
    exitwhen(i>NumberOfHeroes)
  endloop
  set i=0
  loop
    set j=(GetRandomInt(1,NumberOfHeroes))
    set n=(GetRandomInt(1,NumberOfHeroes))
    set f=HeroNumArrayRandomized[j]
    set HeroNumArrayRandomized[j]=HeroNumArrayRandomized[n]
    set HeroNumArrayRandomized[n]=f
    set i=i+1
    exitwhen(i>NumberOfHeroes*4)
  endloop
  set PlayerId=0
  loop
    set i=0
    loop
      call SetPlayerTechMaxAllowed(Player(PlayerId),HeroID[HeroNumArrayRandomized[i]],0)
      set b_HeroAvailableForPlayer[PlayerId*NumberOfHeroes+i]=false
      set i=i+1
      exitwhen(i>NumberOfHeroes)
    endloop
    set PlayerId=PlayerId+1
    exitwhen(PlayerId>12)
  endloop
  set PlayerId=0
  call CleanTaverns()
  //call ExeFunc("RollSpellsForInvokerSD")
  loop
    set i=0
    loop
      call BZD(PlayerId,i)
      set i=i+1
      exitwhen(i>NumberOfHeroes)
    endloop
    set PlayerId=PlayerId+1
    exitwhen(PlayerId>5)
  endloop
  call VS9()
  call PanCameraToTimed(-7008.,6816.,.0)
endfunction

function RollSpellsForInvokerSD takes nothing returns nothing
  local integer i=0
  local integer k=0
  local integer j=1
  local integer array s
  local string array imgs
  local string array orders
  local integer array ids
  local integer array upg
  //call echo("called")
  set s[1]=0
  set s[2]=0
  set s[3]=0
  set s[4]=0
  loop
    set k=GetRandomInt(1,10)
    if s[1]!=k and s[2]!=k and s[3]!=k and s[4]!=k then
      set s[j]=k
      set j=j+1
    endif
    exitwhen j>4
  endloop
  
  set imgs[1]="ReplaceableTextures\\CommandButtons\\BTNSunstrike.blp"
  set imgs[2]="ReplaceableTextures\\CommandButtons\\BTNFireRocks.blp"
  set imgs[3]="ReplaceableTextures\\CommandButtons\\BTNLavaSpawn.blp"
  set imgs[4]="ReplaceableTextures\\CommandButtons\\BTNLament.blp"
  set imgs[5]="ReplaceableTextures\\CommandButtons\\BTNManaShield.blp"
  set imgs[6]="ReplaceableTextures\\CommandButtons\\BTNFreezingBreath.blp"
  set imgs[7]="ReplaceableTextures\\CommandButtons\\BTNAnimalWarTraining.blp"
  set imgs[8]="ReplaceableTextures\\CommandButtons\\BTNInvokeTornado.blp"
  set imgs[9]="ReplaceableTextures\\CommandButtons\\BTNEMP.blp"
  set imgs[10]="ReplaceableTextures\\CommandButtons\\BTNScatterRockets.blp"
  
  set orders[1]="request_hero, r23"
  set orders[2]="mechanicalcritter"
  set orders[3]="militia"
  set orders[4]="militiaconvert"
  set orders[5]="windwalk"
  set orders[6]="militiaoff"
  set orders[7]="militiaunconvert"
  set orders[8]="mindrot"
  set orders[9]="monsoon"
  set orders[10]="mount"
  set i=1
  loop
    set ids[i]='Z600'+i
    set upg[i]='Y600'+i
    set i=i+1
    exitwhen i>9
  endloop
  set ids[10]='Z610'
  set upg[10]='Y610'
  
  set i=114-1
  call CSD(i*4+1,imgs[s[1]],orders[s[1]],ids[s[1]],0,upg[s[1]],"","")
  call CSD(i*4+2,imgs[s[2]],orders[s[2]],ids[s[2]],0,upg[s[2]],"","")
  call CSD(i*4+3,imgs[s[3]],orders[s[3]],ids[s[3]],0,upg[s[3]],"","")
  call CSD(i*4+4,imgs[s[4]],orders[s[4]],ids[s[4]],0,upg[s[4]],"","")
  set i=115-1
  call CSD(i*4+1,imgs[s[1]],orders[s[1]],ids[s[1]],0,upg[s[1]],"","")
  call CSD(i*4+2,imgs[s[2]],orders[s[2]],ids[s[2]],0,upg[s[2]],"","")
  call CSD(i*4+3,imgs[s[3]],orders[s[3]],ids[s[3]],0,upg[s[3]],"","")
  call CSD(i*4+4,imgs[s[4]],orders[s[4]],ids[s[4]],0,upg[s[4]],"","")
  set i=116-1
  call CSD(i*4+1,imgs[s[1]],orders[s[1]],ids[s[1]],0,upg[s[1]],"","")
  call CSD(i*4+2,imgs[s[2]],orders[s[2]],ids[s[2]],0,upg[s[2]],"","")
  call CSD(i*4+3,imgs[s[3]],orders[s[3]],ids[s[3]],0,upg[s[3]],"","")
  call CSD(i*4+4,imgs[s[4]],orders[s[4]],ids[s[4]],0,upg[s[4]],"","")
  set i=94-1
  call CSD(i*4+1,imgs[s[1]],orders[s[1]],ids[s[1]],0,upg[s[1]],"","")
  call CSD(i*4+2,imgs[s[2]],orders[s[2]],ids[s[2]],0,upg[s[2]],"","")
  call CSD(i*4+3,imgs[s[3]],orders[s[3]],ids[s[3]],0,upg[s[3]],"","")
  call CSD(i*4+4,imgs[s[4]],orders[s[4]],ids[s[4]],0,upg[s[4]],"","")
  
endfunction

function BBD takes integer pid,integer i returns nothing//SD mode
  local integer num
  local integer AdjID=pid
  local integer herocount=11
  
  if pid==0 or pid==6 or i==0 then
    return
  endif
  if pid>6 then
    set AdjID=AdjID-1
  endif
  if i>(AdjID*herocount)-herocount and i<=(AdjID*herocount) then
    call SetPlayerTechMaxAllowed(Player(pid),HeroID[(HeroNumArrayRandomized[i])],999)
    set b_HeroAvailableForPlayer[pid*NumberOfHeroes+(HeroNumArrayRandomized[i])]=true
    set SDHeroesPool[pid*100+SDHeroesPoolInc[pid]]=HeroIcon[HeroNumArrayRandomized[i]]
    set SDHeroesIDs[pid*100+SDHeroesPoolInc[pid]]=HeroID[HeroNumArrayRandomized[i]]
    set SDHeroesPoolInc[pid]=SDHeroesPoolInc[pid]+1
  endif
  if i_BonusHeroCounter[pid]<i_BonusDraftAmount then
    loop
      set num=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
      exitwhen((num>(AdjID*herocount))or(num<=(AdjID*herocount)-herocount))
    endloop
    call SetPlayerTechMaxAllowed(Player(pid),HeroID[HeroNumArrayRandomized[num]],999)
    set b_HeroAvailableForPlayer[pid*NumberOfHeroes+HeroNumArrayRandomized[num]]=true
    set i_BonusHeroCounter[pid]=i_BonusHeroCounter[pid]+1
  endif
endfunction

function BCD takes nothing returns nothing
  local integer PlayerId=0
  local integer i
  local integer j
  local integer n
  local integer f
  set i=1
  loop
    set HeroNumArrayRandomized[i]=AdjustHeroNumber(i)
    set i=i+1
    exitwhen(i>NumberOfHeroes)
  endloop
  set i=1
  loop
    set j=(GetRandomInt(1,NumberOfHeroes))
    set n=(GetRandomInt(1,NumberOfHeroes))
    set f=HeroNumArrayRandomized[j]
    set HeroNumArrayRandomized[j]=HeroNumArrayRandomized[n]
    set HeroNumArrayRandomized[n]=f
    set i=i+1
    exitwhen(i>NumberOfHeroes*4) 
  endloop
  set PlayerId=0
  loop
    set i=1
    loop
      call SetPlayerTechMaxAllowed(Player(PlayerId),HeroID[HeroNumArrayRandomized[i]],0)
      set b_HeroAvailableForPlayer[PlayerId*NumberOfHeroes+i]=false
      set i=i+1
      exitwhen(i>NumberOfHeroes)
    endloop
    set PlayerId=PlayerId+1
    exitwhen(PlayerId>12)
  endloop
  set PlayerId=0
  call CleanTaverns()
  call RollSpellsForInvokerSD()
  loop
    set i=1
    loop
      call BBD(PlayerId,i)
      set i=i+1
      exitwhen(i>NumberOfHeroes)
    endloop
    set PlayerId=PlayerId+1
    if PlayerId==6 then
      set PlayerId=7
    endif
    exitwhen(PlayerId>12)
  endloop
  call VS9()
  call PanCameraToTimed(-7008.,6816.,.0)
endfunction

function BUD takes nothing returns nothing
  local integer PlayerId=LoadInteger(hashtable019,'0REA','0PID')
  local integer SJ8=LoadInteger(hashtable019,'0REA','0SID')
  local boolean QY8=LoadBoolean(hashtable019,'0REA','000B')
  call CheckAbilitiesForStacking(SJ8,PlayerId,QY8)
endfunction

function B3D takes nothing returns nothing
  local integer PlayerId=0
  local integer SJ8=0
  local integer BJD=0
  set PlayerId=0
  loop
    if QV8(PlayerId)then
      if NumberOfExtraAbilities>=1 then
        loop
          if s_MainMode=="sd" or s_MainMode=="md" then
            loop
              set BJD=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
              exitwhen b_HeroAvailableForPlayer[PlayerId*NumberOfHeroes+BJD] and IsHeroIngame[BJD-1]==false
            endloop
            set BJD=HeroNumArrayRandomized[BJD]
          else
            loop//[lich] add support to other modes
              set BJD=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
              exitwhen(IsHeroIngame[BJD-1]==false and GetPlayerTechMaxAllowed(GetTriggerPlayer(),HeroID[BJD-1])>0)
            endloop
            //set BJD=GetRandomInt(1,NumberOfHeroes)
          endif
          set SJ8=(BJD-1)*4
          set SJ8=SJ8+GetRandomInt(1,3)
          call SaveInteger(hashtable019,'0REA','0PID',PlayerId)
          call SaveInteger(hashtable019,'0REA','0SID',SJ8)
          call SaveBoolean(hashtable019,'0REA','000B',false)
          call ExeFunc("BUD")
          exitwhen PlayerSkillNumber[PlayerId*PlayerSkillOffset+5]!=0
        endloop
      endif
      if NumberOfExtraAbilities>=2 then
        loop
          if s_MainMode=="sd" or s_MainMode=="md" then
            loop
              set BJD=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
              exitwhen b_HeroAvailableForPlayer[PlayerId*NumberOfHeroes+BJD] and IsHeroIngame[BJD-1]==false
            endloop
            set BJD=HeroNumArrayRandomized[BJD]
          else
            loop//[lich] add support to other modes
              set BJD=AdjustHeroNumber(GetRandomInt(1,NumberOfHeroes))
              exitwhen(IsHeroIngame[BJD-1]==false and GetPlayerTechMaxAllowed(GetTriggerPlayer(),HeroID[BJD-1])>0)
            endloop
          endif
          set SJ8=(BJD-1)*4
          set SJ8=SJ8+4
          call SaveInteger(hashtable019,'0REA','0PID',PlayerId)
          call SaveInteger(hashtable019,'0REA','0SID',SJ8)
          call SaveBoolean(hashtable019,'0REA','000B',false)
          call ExeFunc("BUD")
          exitwhen PlayerSkillNumber[PlayerId*PlayerSkillOffset+6]!=0
        endloop
      endif
    endif
    set PlayerId=PlayerId+1
    exitwhen(PlayerId>12)
  endloop
endfunction



function B6D takes nothing returns nothing
  local string mn=MainModeInTxt
  local trigger t
  local timer credits
  if mn=="Allrandom" or mn=="Deathmatch" then
    set s_MainMode="ar"
    set b_isPickTime=false
    call AddUnitToStock(ScourgeBuilding_ShopGraveyard,'h02C',1,2)
    call AddUnitToStock(SentinelBuilding_ShopChimaera,'h02C',1,2)
    
    call CleanTaverns()
    set credits=CreateTimer()
    call TimerStart(credits,70,false,function ShowCredits)
    set credits=null
    if Mode_FN then
      call O4D()
      set t=CreateTrigger()
      call TriggerRegisterTimerEvent(t,30,false)
      call TriggerRegisterTimerEvent(t,90,false)
      call TriggerAddCondition(t,Condition(function O4D))
      set t=null
    endif
  elseif mn=="Allpick" then
    set s_MainMode="ap"
    call VS9()
    if Mode_RA then
      call B3D()
    endif
  elseif mn=="Singledraft" then
    set s_MainMode="sd"
    call BCD()
    if Mode_RA then
      call B3D()
    endif
  elseif mn=="Mirrordraft" then
    set s_MainMode="md"
    call BAD()
    if Mode_RA then
      call B3D()
    endif
  endif
endfunction





function Abbadon_Frostmourne_Attack takes unit u, unit t returns nothing
  local integer level =IMaxIF(GetUnitAbilityLevel(u,'P335'),GetUnitAbilityLevel(u,'P336'))
  if IsUnitType(u,UNIT_TYPE_STRUCTURE)==true or IsUnitType(t,UNIT_TYPE_STRUCTURE)==true or IsUnitAlly(u,GetOwningPlayer(t)) then
    return
  endif
  if level>0 then
    call Buff_Add(u,'C107' + level,'D105',4.5)
    set level = GetHandleId(t)
    
    if LoadBoolean(MHT,level,1)==false then
      call SaveBoolean(MHT,level,1,true)
      call TriggerRegisterUnitEvent(GAME_TRIGGER,t,EVENT_UNIT_DAMAGED)
    endif
    
    return
  endif
  
  if GetUnitAbilityLevel(t,'D107')==1 then
    //set level = LoadInteger(HY,GetHandleId(t),166882)
    set level=GetUnitAbilityLevel(t,'C104') + 2*GetUnitAbilityLevel(t,'C105') + 3*GetUnitAbilityLevel(t,'C106') +  4*GetUnitAbilityLevel(t,'C107')
    //call BJDebugMsg(I2S(GetUnitAbilityLevel(t,'C104'))+I2S(GetUnitAbilityLevel(t,'C105'))+I2S(GetUnitAbilityLevel(t,'C106'))+I2S(GetUnitAbilityLevel(t,'C107')))
    if level > 4 then
      set level = 4
    endif
    if level>0 then
      call Buff_Add(u,'C107' + level,'D105',4.5)
    endif
  endif
endfunction

function Abbadon_Frostmourne_Learn takes nothing returns nothing
  local unit u = GetTriggerUnit()
  
  if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==true then
    call UnitRemoveAbility(u,'P336')
    call UnitMakeAbilityPermanent(u,true,'P335')
  else
    call UnitRemoveAbility(u,'P335')
    call UnitMakeAbilityPermanent(u,true,'P336')
  endif
  
  set u = null
endfunction

function Abbadon_Frostmourne_Transform takes unit u returns nothing
  if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==true then
    if GetUnitAbilityLevel(u,'P336')==1 then
      call UnitRemoveAbility(u,'Q335')
      call UnitAddAbility(u,'Q335')
      call UnitRemoveAbility(u,'P336')
      call UnitMakeAbilityPermanent(u,true,'P335')
      call UnitMakeAbilityPermanent(u,true,'Q335')
    endif
  else
    if GetUnitAbilityLevel(u,'P335')==1 then
      call UnitRemoveAbility(u,'Q335')
      call UnitAddAbility(u,'Q335')
      call UnitRemoveAbility(u,'P335')
      call UnitMakeAbilityPermanent(u,true,'P336')
      call UnitMakeAbilityPermanent(u,true,'Q335')
    endif
  endif
endfunction

function Abbadon_Frostmourne_Transform_helper takes nothing returns nothing
  //call Abbadon_Frostmourne_Transform(TEMPUNIT)
  
endfunction

function StoreAllUnitsSightRange takes nothing returns nothing
  call SaveInteger(UnitStats,'ugho',SIGHT,850)
  call SaveInteger(UnitStats,'u001',SIGHT,850)
  call SaveInteger(UnitStats,'unec',SIGHT,850)
  call SaveInteger(UnitStats,'u002',SIGHT,850)
  
  call SaveInteger(UnitStats,'esen',SIGHT,850)
  call SaveInteger(UnitStats,'e00V',SIGHT,850)
  call SaveInteger(UnitStats,'edry',SIGHT,850)
  call SaveInteger(UnitStats,'e00W',SIGHT,850)
  
  call SaveInteger(UnitStats,'ebal',SIGHT,850)
  call SaveInteger(UnitStats,'ebal',NSIGHT,850)
  call SaveInteger(UnitStats,'e026',SIGHT,850)
  call SaveInteger(UnitStats,'e026',NSIGHT,850)
  call SaveInteger(UnitStats,'umtw',SIGHT,850)
  call SaveInteger(UnitStats,'umtw',NSIGHT,850)
  call SaveInteger(UnitStats,'u00R',SIGHT,850)
  call SaveInteger(UnitStats,'u00R',NSIGHT,850)
  
  call SaveInteger(UnitStats,'u00T',SIGHT,1900)
  call SaveInteger(UnitStats,'u00N',SIGHT,1900)
  call SaveInteger(UnitStats,'u00D',SIGHT,1900)
  call SaveInteger(UnitStats,'u00M',SIGHT,1900)
  
  call SaveInteger(UnitStats,'e00R',SIGHT,1900)
  call SaveInteger(UnitStats,'e011',SIGHT,1900)
  call SaveInteger(UnitStats,'e00S',SIGHT,1900)
  call SaveInteger(UnitStats,'e019',SIGHT,1900)
  
  call SaveInteger(UnitStats,'n01Q',SIGHT,500)
  call SaveInteger(UnitStats,'n01Q',NSIGHT,500)
  call SaveInteger(UnitStats,'n01M',SIGHT,1400)
  call SaveInteger(UnitStats,'n01R',SIGHT,1600)
  call SaveInteger(UnitStats,'n01R',NSIGHT,1200)
  call SaveInteger(UnitStats,'n01S',SIGHT,1400)
  
  
  call SaveInteger(UnitStats,'n004',SIGHT,1400)
  call SaveInteger(UnitStats,'n018',SIGHT,1400)
  call SaveInteger(UnitStats,'n01C',SIGHT,1400)
  call SaveInteger(UnitStats,'n01G',SIGHT,1400)
  
  call SaveInteger(UnitStats,'efon',SIGHT,1200)
  call SaveInteger(UnitStats,'osp4',SIGHT,1200)
  call SaveInteger(UnitStats,'o008',SIGHT,1200)
  call SaveInteger(UnitStats,'o009',SIGHT,1200)
  call SaveInteger(UnitStats,'o01C',SIGHT,1200)
  call SaveInteger(UnitStats,'o01D',SIGHT,1200)
  call SaveInteger(UnitStats,'o01E',SIGHT,1200)
  
  call SaveInteger(UnitStats,'o005',SIGHT,1200)
  call SaveInteger(UnitStats,'o006',SIGHT,1200)
  call SaveInteger(UnitStats,'o007',SIGHT,1200)
  call SaveInteger(UnitStats,'o00F',SIGHT,1200)
  
  call SaveInteger(UnitStats,'o00T',SIGHT,1200)
  call SaveInteger(UnitStats,'o00U',SIGHT,1200)
  call SaveInteger(UnitStats,'o00V',SIGHT,1200)
  call SaveInteger(UnitStats,'o00W',SIGHT,1200)
  call SaveInteger(UnitStats,'o00T',NSIGHT,800)
  call SaveInteger(UnitStats,'o00U',NSIGHT,800)
  call SaveInteger(UnitStats,'o00V',NSIGHT,800)
  call SaveInteger(UnitStats,'o00W',NSIGHT,800)
  
  call SaveInteger(UnitStats,'hwat',SIGHT,1200)
  call SaveInteger(UnitStats,'hwt2',SIGHT,1200)
  call SaveInteger(UnitStats,'hwt3',SIGHT,1200)
  call SaveInteger(UnitStats,'h006',SIGHT,1200)
  
  call SaveInteger(UnitStats,'n00U',NSIGHT,1800)
  call SaveInteger(UnitStats,'n00Y',NSIGHT,1800)
  call SaveInteger(UnitStats,'n00Z',NSIGHT,1800)
  
  call SaveInteger(UnitStats,'n0KU',NSIGHT,1800)
  call SaveInteger(UnitStats,'n0KV',NSIGHT,1800)
  call SaveInteger(UnitStats,'n0KW',NSIGHT,1800)
  
  call SaveInteger(UnitStats,'n027',SIGHT,1200)
  
  call SaveInteger(UnitStats,'o004',SIGHT,1600)
  call SaveInteger(UnitStats,'o004',NSIGHT,1600)
  
  call SaveInteger(UnitStats,'Usyl',NSIGHT,1000)
  call SaveInteger(UnitStats,'Naka',NSIGHT,1000)
  
  call SaveInteger(UnitStats,'N01I',NSIGHT,1400)
  call SaveInteger(UnitStats,'N01H',NSIGHT,1400)
  call SaveInteger(UnitStats,'N01T',NSIGHT,1400)
  call SaveInteger(UnitStats,'N01J',NSIGHT,1400)
  call SaveInteger(UnitStats,'N0HT',NSIGHT,1400)
  call SaveInteger(UnitStats,'H600',NSIGHT,1400)
  call SaveInteger(UnitStats,'H601',NSIGHT,1400)
  call SaveInteger(UnitStats,'H602',NSIGHT,1400)
  
  call SaveInteger(UnitStats,'Udre',SIGHT,1200)
  call SaveInteger(UnitStats,'Udre',NSIGHT,1800)
  call SaveInteger(UnitStats,'H071',NSIGHT,1800)
  call SaveInteger(UnitStats,'o01N',NSIGHT,1800)
  
  
endfunction

function StoreAllUnitsBounty takes nothing returns nothing
  //Bounty - gold per kill; LastTimeActivity - lower, H - higher. Hope 
  //Exp - exp per kill
  
  //creeps
  call SaveInteger(UnitStats,'ugho',BOUNTYL,38) //ghouls
  call SaveInteger(UnitStats,'ugho',BOUNTYH,48)
  call SaveInteger(UnitStats,'ugho',EXP,62)
  call SaveInteger(UnitStats,'u001',BOUNTYL,18) //mega ghouls
  call SaveInteger(UnitStats,'u001',BOUNTYH,26)
  call SaveInteger(UnitStats,'u001',EXP,25)
  call SaveInteger(UnitStats,'unec',BOUNTYL,43) //necros
  call SaveInteger(UnitStats,'unec',BOUNTYH,53)
  call SaveInteger(UnitStats,'unec',EXP,41)
  call SaveInteger(UnitStats,'u002',BOUNTYL,18) //mega necros
  call SaveInteger(UnitStats,'u002',BOUNTYH,26)
  call SaveInteger(UnitStats,'u002',EXP,25)
  
  call SaveInteger(UnitStats,'esen',BOUNTYL,38) //treant
  call SaveInteger(UnitStats,'esen',BOUNTYH,48)
  call SaveInteger(UnitStats,'esen',EXP,62)
  call SaveInteger(UnitStats,'e00V',BOUNTYL,18) //mega treant
  call SaveInteger(UnitStats,'e00V',BOUNTYH,26)
  call SaveInteger(UnitStats,'e00V',EXP,25)
  call SaveInteger(UnitStats,'edry',BOUNTYL,43) //druids
  call SaveInteger(UnitStats,'edry',BOUNTYH,53)
  call SaveInteger(UnitStats,'edry',EXP,41)
  call SaveInteger(UnitStats,'e00W',BOUNTYL,18) //mega druids
  call SaveInteger(UnitStats,'e00W',BOUNTYH,26)
  call SaveInteger(UnitStats,'e00W',EXP,25)
  
  call SaveInteger(UnitStats,'ebal',BOUNTYL,66) //ballista
  call SaveInteger(UnitStats,'ebal',BOUNTYH,80)
  call SaveInteger(UnitStats,'ebal',EXP,88)
  call SaveInteger(UnitStats,'e026',BOUNTYL,66) //mega ballista
  call SaveInteger(UnitStats,'e026',BOUNTYH,80)
  call SaveInteger(UnitStats,'e026',EXP,88)
  call SaveInteger(UnitStats,'umtw',BOUNTYL,66) //meat wagon
  call SaveInteger(UnitStats,'umtw',BOUNTYH,80)
  call SaveInteger(UnitStats,'umtw',EXP,88)
  call SaveInteger(UnitStats,'u00R',BOUNTYL,66) //mega meat wagon
  call SaveInteger(UnitStats,'u00R',BOUNTYH,80)
  call SaveInteger(UnitStats,'u00R',EXP,88)
  
  //buildings sent
  call SaveInteger(UnitStats,'e019',BOUNTYL,150) //Ancient protector Tier 4
  call SaveInteger(UnitStats,'e019',BOUNTYH,250)
  call SaveInteger(UnitStats,'e019',EXP,25)
  call SaveInteger(UnitStats,'e00S',BOUNTYL,150) //Ancient protector Tier 3
  call SaveInteger(UnitStats,'e00S',BOUNTYH,250)
  call SaveInteger(UnitStats,'e00S',EXP,25)
  call SaveInteger(UnitStats,'e011',BOUNTYL,150) //Ancient protector Tier 2
  call SaveInteger(UnitStats,'e011',BOUNTYH,250)
  call SaveInteger(UnitStats,'e011',EXP,25)
  call SaveInteger(UnitStats,'e00R',BOUNTYL,150) //Ancient protector Tier 1
  call SaveInteger(UnitStats,'e00R',BOUNTYH,250)
  call SaveInteger(UnitStats,'e00R',EXP,25)
  
  call SaveInteger(UnitStats,'eaom',BOUNTYL,352) //Melee rax (Ancient of war)
  call SaveInteger(UnitStats,'eaom',BOUNTYH,370)
  call SaveInteger(UnitStats,'eaom',EXP,25)
  call SaveInteger(UnitStats,'eaoe',BOUNTYL,352) //Ranged rax (Ancient of Lore)
  call SaveInteger(UnitStats,'eaoe',BOUNTYH,370)
  call SaveInteger(UnitStats,'eaoe',EXP,25)
  
  call SaveInteger(UnitStats,'edob',BOUNTYL,252) //Hunters Hall
  call SaveInteger(UnitStats,'edob',BOUNTYH,270)
  call SaveInteger(UnitStats,'edob',EXP,0)
  call SaveInteger(UnitStats,'eaow',BOUNTYL,302) //Ancient of wind
  call SaveInteger(UnitStats,'eaow',BOUNTYH,320)
  call SaveInteger(UnitStats,'eaow',EXP,25)
  call SaveInteger(UnitStats,'emow',BOUNTYL,102) //Moon wells
  call SaveInteger(UnitStats,'emow',BOUNTYH,120)
  call SaveInteger(UnitStats,'emow',EXP,25)
  
  //buildings scourge
  call SaveInteger(UnitStats,'u00T',BOUNTYL,150) //Zigg Tier 4
  call SaveInteger(UnitStats,'u00T',BOUNTYH,250)
  call SaveInteger(UnitStats,'u00T',EXP,25)
  call SaveInteger(UnitStats,'u00N',BOUNTYL,150) //Zigg Tier 3
  call SaveInteger(UnitStats,'u00N',BOUNTYH,250)
  call SaveInteger(UnitStats,'u00N',EXP,25)
  call SaveInteger(UnitStats,'u00D',BOUNTYL,150) //Zigg Tier 2
  call SaveInteger(UnitStats,'u00D',BOUNTYH,250)
  call SaveInteger(UnitStats,'u00D',EXP,25)
  call SaveInteger(UnitStats,'u00M',BOUNTYL,150) //Zigg Tier 1
  call SaveInteger(UnitStats,'u00M',BOUNTYH,250)
  call SaveInteger(UnitStats,'u00M',EXP,25)
  
  call SaveInteger(UnitStats,'usep',BOUNTYL,352) //Melee rax
  call SaveInteger(UnitStats,'usep',BOUNTYH,370)
  call SaveInteger(UnitStats,'usep',EXP,25)
  call SaveInteger(UnitStats,'utod',BOUNTYL,352) //Ranged rax
  call SaveInteger(UnitStats,'utod',BOUNTYH,370)
  call SaveInteger(UnitStats,'utod',EXP,25)
  
  call SaveInteger(UnitStats,'ubon',BOUNTYL,252) //Wyrm nest
  call SaveInteger(UnitStats,'ubon',BOUNTYH,270)
  call SaveInteger(UnitStats,'ubon',EXP,0)
  call SaveInteger(UnitStats,'usap',BOUNTYL,302) //Sacrifice pit
  call SaveInteger(UnitStats,'usap',BOUNTYH,320)
  call SaveInteger(UnitStats,'usap',EXP,25)
  call SaveInteger(UnitStats,'uzig',BOUNTYL,102) //Ziggs
  call SaveInteger(UnitStats,'uzig',BOUNTYH,120)
  call SaveInteger(UnitStats,'uzig',EXP,25)
  
  //neutrals
  call SaveInteger(UnitStats,'ndtw',BOUNTYL,54) //Dark troll warlord
  call SaveInteger(UnitStats,'ndtw',BOUNTYH,62)
  call SaveInteger(UnitStats,'ndtw',EXP,119)
  call SaveInteger(UnitStats,'ndtr',BOUNTYL,26) //Dark troll
  call SaveInteger(UnitStats,'ndtr',BOUNTYH,33)
  call SaveInteger(UnitStats,'ndtr',EXP,62)
  call SaveInteger(UnitStats,'uske',BOUNTYL,6) //Skeleton warrior
  call SaveInteger(UnitStats,'uske',BOUNTYH,12)
  call SaveInteger(UnitStats,'uske',EXP,25)
  
  
  call SaveInteger(UnitStats,'nfsh',BOUNTYL,21) //Forest troll priest
  call SaveInteger(UnitStats,'nfsh',BOUNTYH,25)
  call SaveInteger(UnitStats,'nfsh',EXP,41)
  call SaveInteger(UnitStats,'nftb',BOUNTYL,22) //Forest troll berserker
  call SaveInteger(UnitStats,'nftb',BOUNTYH,26)
  call SaveInteger(UnitStats,'nftb',EXP,41)
  call SaveInteger(UnitStats,'nkol',BOUNTYL,23) //Kobold Taskmaster
  call SaveInteger(UnitStats,'nkol',BOUNTYH,29)
  call SaveInteger(UnitStats,'nkol',EXP,41)
  
  call SaveInteger(UnitStats,'nowe',BOUNTYL,67) //Enraged wildkin
  call SaveInteger(UnitStats,'nowe',BOUNTYH,87)
  call SaveInteger(UnitStats,'nowe',EXP,119)
  call SaveInteger(UnitStats,'nowb',BOUNTYL,15) //Wildkin
  call SaveInteger(UnitStats,'nowb',BOUNTYH,20)
  call SaveInteger(UnitStats,'nowb',EXP,25)
  
  call SaveInteger(UnitStats,'nomg',BOUNTYL,43) //Ogre magi
  call SaveInteger(UnitStats,'nomg',BOUNTYH,61)
  call SaveInteger(UnitStats,'nomg',EXP,62)
  call SaveInteger(UnitStats,'nogm',BOUNTYL,23) //Ogre Mauler
  call SaveInteger(UnitStats,'nogm',BOUNTYH,47)
  call SaveInteger(UnitStats,'nogm',EXP,41)
  
  call SaveInteger(UnitStats,'n026',BOUNTYL,54) //Mud golem
  call SaveInteger(UnitStats,'n026',BOUNTYH,62)
  call SaveInteger(UnitStats,'n026',EXP,119)
  
  call SaveInteger(UnitStats,'ncnk',BOUNTYL,66) //Centaur Khan
  call SaveInteger(UnitStats,'ncnk',BOUNTYH,78)
  call SaveInteger(UnitStats,'ncnk',EXP,119)
  call SaveInteger(UnitStats,'ncen',BOUNTYL,20) //Centaur outrunner
  call SaveInteger(UnitStats,'ncen',BOUNTYH,24)
  call SaveInteger(UnitStats,'ncen',EXP,41)
  
  call SaveInteger(UnitStats,'ngns',BOUNTYL,21) //Gnoll Assassin
  call SaveInteger(UnitStats,'ngns',BOUNTYH,29)
  call SaveInteger(UnitStats,'ngns',EXP,41)
  
  call SaveInteger(UnitStats,'nfpu',BOUNTYL,76) //Polar Furbolg Ursa Warrior
  call SaveInteger(UnitStats,'nfpu',BOUNTYH,86)
  call SaveInteger(UnitStats,'nfpu',EXP,119)
  call SaveInteger(UnitStats,'nfpc',BOUNTYL,60) //Polar Furbolg Champion
  call SaveInteger(UnitStats,'nfpc',BOUNTYH,70)
  call SaveInteger(UnitStats,'nfpc',EXP,88)
  
  call SaveInteger(UnitStats,'n0HW',BOUNTYL,24) //Harpy Scout
  call SaveInteger(UnitStats,'n0HW',BOUNTYH,27)
  call SaveInteger(UnitStats,'n0HW',EXP,41)
  call SaveInteger(UnitStats,'n0HX',BOUNTYL,34) //Harpy Storm
  call SaveInteger(UnitStats,'n0HX',BOUNTYH,37)
  call SaveInteger(UnitStats,'n0HX',EXP,62)
  
  call SaveInteger(UnitStats,'ngh1',BOUNTYL,30) //Ghost
  call SaveInteger(UnitStats,'ngh1',BOUNTYH,40)
  call SaveInteger(UnitStats,'ngh1',EXP,62)
  call SaveInteger(UnitStats,'npfl',BOUNTYL,20) //Fel Beast
  call SaveInteger(UnitStats,'npfl',BOUNTYH,24)
  call SaveInteger(UnitStats,'npfl',EXP,41)
  
  call SaveInteger(UnitStats,'nkot',BOUNTYL,17) //Kobold Tunneler
  call SaveInteger(UnitStats,'nkot',BOUNTYH,19)
  call SaveInteger(UnitStats,'nkot',EXP,25)
  call SaveInteger(UnitStats,'nkob',BOUNTYL,7) //Kobold
  call SaveInteger(UnitStats,'nkob',BOUNTYH,9)
  call SaveInteger(UnitStats,'nkob',EXP,25)
  
  call SaveInteger(UnitStats,'nsat',BOUNTYL,15) //Satyr Trickster
  call SaveInteger(UnitStats,'nsat',BOUNTYH,17)
  call SaveInteger(UnitStats,'nsat',EXP,41)
  call SaveInteger(UnitStats,'nstl',BOUNTYL,27) //Satyr Soulstealer
  call SaveInteger(UnitStats,'nstl',BOUNTYH,33)
  call SaveInteger(UnitStats,'nstl',EXP,62)
  call SaveInteger(UnitStats,'nsth',BOUNTYL,97) //Satyr Hellcaster
  call SaveInteger(UnitStats,'nsth',BOUNTYH,111)
  call SaveInteger(UnitStats,'nsth',EXP,119)
  
  call SaveInteger(UnitStats,'n00S',BOUNTYL,22) //Alpha wolf
  call SaveInteger(UnitStats,'n00S',BOUNTYH,26)
  call SaveInteger(UnitStats,'n00S',EXP,62)
  call SaveInteger(UnitStats,'nwlg',BOUNTYL,22) //Giant wolf
  call SaveInteger(UnitStats,'nwlg',BOUNTYH,26)
  call SaveInteger(UnitStats,'nwlg',EXP,62)
  
  
  
  //Ancients
  call SaveInteger(UnitStats,'ngst',BOUNTYL,54) //Rock golem
  call SaveInteger(UnitStats,'ngst',BOUNTYH,62)
  call SaveInteger(UnitStats,'ngst',EXP,119)
  call SaveInteger(UnitStats,'nggr',BOUNTYL,107) //Emerald Golem
  call SaveInteger(UnitStats,'nggr',BOUNTYH,121)
  call SaveInteger(UnitStats,'nggr',EXP,155)
  
  call SaveInteger(UnitStats,'nbwm',BOUNTYL,164) //Black dragon
  call SaveInteger(UnitStats,'nbwm',BOUNTYH,234)
  call SaveInteger(UnitStats,'nbwm',EXP,155)
  call SaveInteger(UnitStats,'nbdk',BOUNTYL,44) //Black drake
  call SaveInteger(UnitStats,'nbdk',BOUNTYH,56)
  call SaveInteger(UnitStats,'nbdk',EXP,62)
  
  call SaveInteger(UnitStats,'njga',BOUNTYL,152) //Elder Jungle stalker
  call SaveInteger(UnitStats,'njga',BOUNTYH,170)
  call SaveInteger(UnitStats,'njga',EXP,155)
  call SaveInteger(UnitStats,'njg1',BOUNTYL,52) //Jungle Stalker
  call SaveInteger(UnitStats,'njg1',BOUNTYH,70)
  call SaveInteger(UnitStats,'njg1',EXP,119)
  
  call SaveInteger(UnitStats,'nbdo',BOUNTYL,86) //Blue Dragonspawn overseer
  call SaveInteger(UnitStats,'nbdo',BOUNTYH,98)
  call SaveInteger(UnitStats,'nbdo',EXP,119)
  call SaveInteger(UnitStats,'nbds',BOUNTYL,74) //Blue Dragonspawn Sorcerer
  call SaveInteger(UnitStats,'nbds',BOUNTYH,82)
  call SaveInteger(UnitStats,'nbds',EXP,62)
  
  call SaveInteger(UnitStats,'n0LC',BOUNTYL,89) //Thunder Lizard big
  call SaveInteger(UnitStats,'n0LC',BOUNTYH,97)
  call SaveInteger(UnitStats,'n0LC',EXP,155)
  call SaveInteger(UnitStats,'n0LD',BOUNTYL,79) //Thunder Lizard
  call SaveInteger(UnitStats,'n0LD',BOUNTYH,87)
  call SaveInteger(UnitStats,'n0LD',EXP,119)
  //super creeps
  call SaveInteger(UnitStats,'n003',BOUNTYL,106) //Siege golem
  call SaveInteger(UnitStats,'n003',BOUNTYH,700)
  call SaveInteger(UnitStats,'n003',EXP,349)
  call SaveInteger(UnitStats,'n00E',BOUNTYL,158) //Scary Fish
  call SaveInteger(UnitStats,'n00E',BOUNTYH,950)
  call SaveInteger(UnitStats,'n00E',EXP,410)
  call SaveInteger(UnitStats,'n00D',BOUNTYL,111) //Ancient Hydra
  call SaveInteger(UnitStats,'n00D',BOUNTYH,1200)
  call SaveInteger(UnitStats,'n00D',EXP,476)
  
  //Roshan
  call SaveInteger(UnitStats,'n00L',BOUNTYL,150) //Roshan
  call SaveInteger(UnitStats,'n00L',BOUNTYH,400)
  call SaveInteger(UnitStats,'n00L',EXP,1789)
  
  //Summons
  //Rexxar
  call SaveInteger(UnitStats,'n01Q',BOUNTYL,30) //Scout Hawk
  call SaveInteger(UnitStats,'n01Q',BOUNTYH,30)
  call SaveInteger(UnitStats,'n01Q',EXP,41)
  call SaveInteger(UnitStats,'n01M',BOUNTYL,26) //Quilbeast
  call SaveInteger(UnitStats,'n01M',BOUNTYH,38)
  call SaveInteger(UnitStats,'n01M',EXP,119)
  call SaveInteger(UnitStats,'n01R',BOUNTYL,65) //Greater Scout Hawk
  call SaveInteger(UnitStats,'n01R',BOUNTYH,65)
  call SaveInteger(UnitStats,'n01R',EXP,155)
  call SaveInteger(UnitStats,'n01S',BOUNTYL,26) //Greater Quilbeast
  call SaveInteger(UnitStats,'n01S',BOUNTYH,38)
  call SaveInteger(UnitStats,'n01S',EXP,119)
  
  //Brewmaster primal split
  call SaveInteger(UnitStats,'npn1',BOUNTYL,11) //Fire 1
  call SaveInteger(UnitStats,'npn1',BOUNTYH,15)
  call SaveInteger(UnitStats,'npn1',EXP,196)
  call SaveInteger(UnitStats,'npn4',BOUNTYL,11) //Fire 2
  call SaveInteger(UnitStats,'npn4',BOUNTYH,15)
  call SaveInteger(UnitStats,'npn4',EXP,242)
  call SaveInteger(UnitStats,'n011',BOUNTYL,31) //Fire 3
  call SaveInteger(UnitStats,'n011',BOUNTYH,35)
  call SaveInteger(UnitStats,'n011',EXP,242)
  
  call SaveInteger(UnitStats,'npn2',BOUNTYL,11) //Storm 1
  call SaveInteger(UnitStats,'npn2',BOUNTYH,15)
  call SaveInteger(UnitStats,'npn2',EXP,196)
  call SaveInteger(UnitStats,'npn5',BOUNTYL,11) //Storm 2
  call SaveInteger(UnitStats,'npn5',BOUNTYH,15)
  call SaveInteger(UnitStats,'npn5',EXP,242)
  call SaveInteger(UnitStats,'n012',BOUNTYL,31) //Storm 3
  call SaveInteger(UnitStats,'n012',BOUNTYH,35)
  call SaveInteger(UnitStats,'n012',EXP,242)
  
  call SaveInteger(UnitStats,'npn3',BOUNTYL,11) //Earth 1
  call SaveInteger(UnitStats,'npn3',BOUNTYH,15)
  call SaveInteger(UnitStats,'npn3',EXP,196)
  call SaveInteger(UnitStats,'npn5',BOUNTYL,11) //Earth 2
  call SaveInteger(UnitStats,'npn5',BOUNTYH,15)
  call SaveInteger(UnitStats,'npn5',EXP,242)
  call SaveInteger(UnitStats,'n010',BOUNTYL,31) //Earth 3
  call SaveInteger(UnitStats,'n010',BOUNTYH,35)
  call SaveInteger(UnitStats,'n010',EXP,242)
  
  //Tuskar
  call SaveInteger(UnitStats,'o01J',BOUNTYL,90) //Frozen Sigil 1
  call SaveInteger(UnitStats,'o01J',BOUNTYH,90)
  call SaveInteger(UnitStats,'o01J',EXP,0)
  call SaveInteger(UnitStats,'o01K',BOUNTYL,100) //Frozen Sigil 2
  call SaveInteger(UnitStats,'o01K',BOUNTYH,100)
  call SaveInteger(UnitStats,'o01K',EXP,0)
  call SaveInteger(UnitStats,'o01L',BOUNTYL,110) //Frozen Sigil 3
  call SaveInteger(UnitStats,'o01L',BOUNTYH,110)
  call SaveInteger(UnitStats,'o01L',EXP,0)
  call SaveInteger(UnitStats,'o01M',BOUNTYL,120) //Frozen Sigil 4
  call SaveInteger(UnitStats,'o01M',BOUNTYH,120)
  call SaveInteger(UnitStats,'o01M',EXP,0)
  
  //Lone druid
  call SaveInteger(UnitStats,'n004',BOUNTYL,300) //Spirit Bear 1
  call SaveInteger(UnitStats,'n004',BOUNTYH,300)
  call SaveInteger(UnitStats,'n004',EXP,300)
  call SaveInteger(UnitStats,'n018',BOUNTYL,300) //Spirit Bear 2
  call SaveInteger(UnitStats,'n018',BOUNTYH,300)
  call SaveInteger(UnitStats,'n018',EXP,300)
  call SaveInteger(UnitStats,'n01C',BOUNTYL,300) //Spirit Bear 3
  call SaveInteger(UnitStats,'n01C',BOUNTYH,300)
  call SaveInteger(UnitStats,'n01C',EXP,300)
  call SaveInteger(UnitStats,'n01G',BOUNTYL,300) //Spirit Bear 4
  call SaveInteger(UnitStats,'n01G',BOUNTYH,300)
  call SaveInteger(UnitStats,'n01G',EXP,300)
  
  //Prophet furion
  call SaveInteger(UnitStats,'efon',BOUNTYL,14) //Force of nature
  call SaveInteger(UnitStats,'efon',BOUNTYH,20)
  call SaveInteger(UnitStats,'efon',EXP,30)
  
  //Rhasta Shadow Shaman
  call SaveInteger(UnitStats,'osp4',BOUNTYL,26) //Mass serpents 1
  call SaveInteger(UnitStats,'osp4',BOUNTYH,38)
  call SaveInteger(UnitStats,'osp4',EXP,62)
  call SaveInteger(UnitStats,'o008',BOUNTYL,26) //Mass serpents 2
  call SaveInteger(UnitStats,'o008',BOUNTYH,38)
  call SaveInteger(UnitStats,'o008',EXP,62)
  call SaveInteger(UnitStats,'o009',BOUNTYL,26) //Mass serpents 3
  call SaveInteger(UnitStats,'o009',BOUNTYH,38)
  call SaveInteger(UnitStats,'o009',EXP,62)
  call SaveInteger(UnitStats,'o01C',BOUNTYL,26) //Mass serpents 1
  call SaveInteger(UnitStats,'o01C',BOUNTYH,38)
  call SaveInteger(UnitStats,'o01C',EXP,62)
  call SaveInteger(UnitStats,'o01D',BOUNTYL,26) //Mass serpents 2
  call SaveInteger(UnitStats,'o01D',BOUNTYH,38)
  call SaveInteger(UnitStats,'o01D',EXP,62)
  call SaveInteger(UnitStats,'o01E',BOUNTYL,26) //Mass serpents 3
  call SaveInteger(UnitStats,'o01E',BOUNTYH,38)
  call SaveInteger(UnitStats,'o01E',EXP,62)
  
  //Lycan Wolf
  call SaveInteger(UnitStats,'o005',BOUNTYL,21) //Wolves 1
  call SaveInteger(UnitStats,'o005',BOUNTYH,21)
  call SaveInteger(UnitStats,'o005',EXP,41)
  call SaveInteger(UnitStats,'o006',BOUNTYL,26) //Wolves 2
  call SaveInteger(UnitStats,'o006',BOUNTYH,26)
  call SaveInteger(UnitStats,'o006',EXP,41)
  call SaveInteger(UnitStats,'o007',BOUNTYL,36) //Wolves 3
  call SaveInteger(UnitStats,'o007',BOUNTYH,36)
  call SaveInteger(UnitStats,'o007',EXP,41)
  call SaveInteger(UnitStats,'o00F',BOUNTYL,41) //Wolves 4
  call SaveInteger(UnitStats,'o00F',BOUNTYH,41)
  call SaveInteger(UnitStats,'o00F',EXP,41)
  
  //Undying zombie
  call SaveInteger(UnitStats,'n0F5',BOUNTYL,5) //Tombstone zombie
  call SaveInteger(UnitStats,'n0F5',BOUNTYH,7)
  call SaveInteger(UnitStats,'n0F5',EXP,25)
  
  call SaveInteger(UnitStats,'n0FJ',BOUNTYL,70) //Tombstone 1
  call SaveInteger(UnitStats,'n0FJ',BOUNTYH,70)
  call SaveInteger(UnitStats,'n0FJ',EXP,0)
  call SaveInteger(UnitStats,'n0FI',BOUNTYL,90) //Tombstone 2
  call SaveInteger(UnitStats,'n0FI',BOUNTYH,90)
  call SaveInteger(UnitStats,'n0FI',EXP,0)
  call SaveInteger(UnitStats,'n0F6',BOUNTYL,110) //Tombstone 3
  call SaveInteger(UnitStats,'n0F6',BOUNTYH,110)
  call SaveInteger(UnitStats,'n0F6',EXP,0)
  call SaveInteger(UnitStats,'n0FH',BOUNTYL,130) //Tombstone 4
  call SaveInteger(UnitStats,'n0FH',BOUNTYH,130)
  call SaveInteger(UnitStats,'n0FH',EXP,0)
  
  call SaveInteger(UnitStats,'h0CH',BOUNTYL,20) //Homing missile
  call SaveInteger(UnitStats,'h0CH',BOUNTYH,30)
  call SaveInteger(UnitStats,'h0CF',BOUNTYL,20) //Homing missile
  call SaveInteger(UnitStats,'h0CF',BOUNTYH,30)
  call SaveInteger(UnitStats,'h0C1',BOUNTYL,20) //Homing missile
  call SaveInteger(UnitStats,'h0C1',BOUNTYH,30)
  call SaveInteger(UnitStats,'h0CG',BOUNTYL,20) //Homing missile
  call SaveInteger(UnitStats,'h0CG',BOUNTYH,30)
  
  //Brood
  call SaveInteger(UnitStats,'n019',BOUNTYL,11) //Spiderling
  call SaveInteger(UnitStats,'n019',BOUNTYH,13)
  call SaveInteger(UnitStats,'n019',EXP,62)
  call SaveInteger(UnitStats,'n01E',BOUNTYL,16) //Spiderite
  call SaveInteger(UnitStats,'n01E',BOUNTYH,21)
  call SaveInteger(UnitStats,'n01E',EXP,41)
  
  //Weaver
  call SaveInteger(UnitStats,'u01K',BOUNTYL,32) //Swarm 1
  call SaveInteger(UnitStats,'u01K',BOUNTYH,34)
  call SaveInteger(UnitStats,'u01K',EXP,41)
  call SaveInteger(UnitStats,'u01H',BOUNTYL,32) //Swarm 2
  call SaveInteger(UnitStats,'u01H',BOUNTYH,34)
  call SaveInteger(UnitStats,'u01H',EXP,41)
  call SaveInteger(UnitStats,'u01J',BOUNTYL,32) //Swarm 3
  call SaveInteger(UnitStats,'u01J',BOUNTYH,34)
  call SaveInteger(UnitStats,'u01J',EXP,41)
  call SaveInteger(UnitStats,'u01L',BOUNTYL,32) //Swarm 4
  call SaveInteger(UnitStats,'u01L',BOUNTYH,34)
  call SaveInteger(UnitStats,'u01L',EXP,41)
  
  //Venomancer
  call SaveInteger(UnitStats,'o00T',BOUNTYL,14) //Plague ward 1
  call SaveInteger(UnitStats,'o00T',BOUNTYH,17)
  call SaveInteger(UnitStats,'o00T',EXP,20)
  call SaveInteger(UnitStats,'o00U',BOUNTYL,14) //Plague ward 2
  call SaveInteger(UnitStats,'o00U',BOUNTYH,17)
  call SaveInteger(UnitStats,'o00U',EXP,25)
  call SaveInteger(UnitStats,'o00V',BOUNTYL,14) //Plague ward 3
  call SaveInteger(UnitStats,'o00V',BOUNTYH,17)
  call SaveInteger(UnitStats,'o00V',EXP,30)
  call SaveInteger(UnitStats,'o00W',BOUNTYL,14) //Plague ward 4
  call SaveInteger(UnitStats,'o00W',BOUNTYH,17)
  call SaveInteger(UnitStats,'o00W',EXP,35)
  
  //Enigma
  call SaveInteger(UnitStats,'hwat',BOUNTYL,22) //Lesser eidolon
  call SaveInteger(UnitStats,'hwat',BOUNTYH,36)
  call SaveInteger(UnitStats,'hwat',EXP,25)
  call SaveInteger(UnitStats,'hwt2',BOUNTYL,22) //Eidolon
  call SaveInteger(UnitStats,'hwt2',BOUNTYH,36)
  call SaveInteger(UnitStats,'hwt2',EXP,25)
  call SaveInteger(UnitStats,'hwt3',BOUNTYL,22) //Greater eidolon
  call SaveInteger(UnitStats,'hwt3',BOUNTYH,36)
  call SaveInteger(UnitStats,'hwt3',EXP,25)
  call SaveInteger(UnitStats,'h006',BOUNTYL,22) //Dire eidolon
  call SaveInteger(UnitStats,'h006',BOUNTYH,36)
  call SaveInteger(UnitStats,'h006',EXP,25)
  
  //Oblivion Pugna
  call SaveInteger(UnitStats,'o00M',BOUNTYL,20) //Nether ward 1
  call SaveInteger(UnitStats,'o00M',BOUNTYH,20)
  call SaveInteger(UnitStats,'o00M',EXP,0)
  call SaveInteger(UnitStats,'o00L',BOUNTYL,40) //Nether ward 2
  call SaveInteger(UnitStats,'o00L',BOUNTYH,40)
  call SaveInteger(UnitStats,'o00L',EXP,0)
  call SaveInteger(UnitStats,'o00O',BOUNTYL,60) //Nether ward 3
  call SaveInteger(UnitStats,'o00O',BOUNTYH,60)
  call SaveInteger(UnitStats,'o00O',EXP,0)
  call SaveInteger(UnitStats,'o00N',BOUNTYL,80) //Nether ward 4
  call SaveInteger(UnitStats,'o00N',BOUNTYH,80)
  call SaveInteger(UnitStats,'o00N',EXP,0)
  
  //Warlock WL
  call SaveInteger(UnitStats,'n00U',BOUNTYL,100) //Rain of Chaos 1
  call SaveInteger(UnitStats,'n00U',BOUNTYH,100)
  call SaveInteger(UnitStats,'n00U',EXP,196)
  call SaveInteger(UnitStats,'n00Y',BOUNTYL,150) //Rain of Chaos 2
  call SaveInteger(UnitStats,'n00Y',BOUNTYH,150)
  call SaveInteger(UnitStats,'n00Y',EXP,196)
  call SaveInteger(UnitStats,'n00Z',BOUNTYL,200) //Rain of Chaos 3
  call SaveInteger(UnitStats,'n00Z',BOUNTYH,200)
  call SaveInteger(UnitStats,'n00Z',EXP,196)
  
  call SaveInteger(UnitStats,'n0KU',BOUNTYL,50) //Rain of Chaos upg 1
  call SaveInteger(UnitStats,'n0KU',BOUNTYH,50)
  call SaveInteger(UnitStats,'n0KU',EXP,196)
  call SaveInteger(UnitStats,'n0KV',BOUNTYL,75) //Rain of Chaos upg 2
  call SaveInteger(UnitStats,'n0KV',BOUNTYH,75)
  call SaveInteger(UnitStats,'n0KV',EXP,196)
  call SaveInteger(UnitStats,'n0KW',BOUNTYL,100) //Rain of Chaos upg 3
  call SaveInteger(UnitStats,'n0KW',BOUNTYH,100)
  call SaveInteger(UnitStats,'n0KW',EXP,196)
  
  //Invoker Forge
  call SaveInteger(UnitStats,'n027',BOUNTYL,32) //Forge spirit
  call SaveInteger(UnitStats,'n027',BOUNTYH,46)
  call SaveInteger(UnitStats,'n027',EXP,62)
  
  call SaveInteger(UnitStats,'fRG1',BOUNTYL,32) //Forge spirit
  call SaveInteger(UnitStats,'fRG1',BOUNTYH,46)
  call SaveInteger(UnitStats,'fRG1',EXP,62)
  
  call SaveInteger(UnitStats,'fRG2',BOUNTYL,32) //Forge spirit
  call SaveInteger(UnitStats,'fRG2',BOUNTYH,46)
  call SaveInteger(UnitStats,'fRG2',EXP,62)
  
  call SaveInteger(UnitStats,'fRG3',BOUNTYL,32) //Forge spirit
  call SaveInteger(UnitStats,'fRG3',BOUNTYH,46)
  call SaveInteger(UnitStats,'fRG3',EXP,62)
  
  call SaveInteger(UnitStats,'fRG4',BOUNTYL,32) //Forge spirit
  call SaveInteger(UnitStats,'fRG4',BOUNTYH,46)
  call SaveInteger(UnitStats,'fRG4',EXP,62)
  
  //Clockwerk Cogs
  call SaveInteger(UnitStats,'u00S',BOUNTYL,16) //Cogs
  call SaveInteger(UnitStats,'u00S',BOUNTYH,20)
  call SaveInteger(UnitStats,'u00S',EXP,0)
  //Visage
  call SaveInteger(UnitStats,'u014',BOUNTYL,100) //Familiar 1-1
  call SaveInteger(UnitStats,'u014',BOUNTYH,100)
  call SaveInteger(UnitStats,'u014',EXP,41)
  call SaveInteger(UnitStats,'u01D',BOUNTYL,100) //Familiar 1-2
  call SaveInteger(UnitStats,'u01D',BOUNTYH,100)
  call SaveInteger(UnitStats,'u01D',EXP,41)
  call SaveInteger(UnitStats,'u01R',BOUNTYL,100) //Familiar 1-3
  call SaveInteger(UnitStats,'u01R',BOUNTYH,100)
  call SaveInteger(UnitStats,'u01R',EXP,41)
  
  call SaveInteger(UnitStats,'u015',BOUNTYL,100) //Familiar 2-1
  call SaveInteger(UnitStats,'u015',BOUNTYH,100)
  call SaveInteger(UnitStats,'u015',EXP,41)
  call SaveInteger(UnitStats,'u01E',BOUNTYL,100) //Familiar 2-2
  call SaveInteger(UnitStats,'u01E',BOUNTYH,100)
  call SaveInteger(UnitStats,'u01E',EXP,41)
  call SaveInteger(UnitStats,'u01S',BOUNTYL,100) //Familiar 2-3
  call SaveInteger(UnitStats,'u01S',BOUNTYH,100)
  call SaveInteger(UnitStats,'u01S',EXP,41)
  
  call SaveInteger(UnitStats,'u016',BOUNTYL,100) //Familiar 3-1
  call SaveInteger(UnitStats,'u016',BOUNTYH,100)
  call SaveInteger(UnitStats,'u016',EXP,41)
  call SaveInteger(UnitStats,'u01F',BOUNTYL,100) //Familiar 3-2
  call SaveInteger(UnitStats,'u01F',BOUNTYH,100)
  call SaveInteger(UnitStats,'u01F',EXP,41)
  call SaveInteger(UnitStats,'u01T',BOUNTYL,100) //Familiar 3-3
  call SaveInteger(UnitStats,'u01T',BOUNTYH,100)
  call SaveInteger(UnitStats,'u01T',EXP,41)
  
  //Items
  //Necro
  call SaveInteger(UnitStats,'n00J',BOUNTYL,100) //warrior 1
  call SaveInteger(UnitStats,'n00J',BOUNTYH,100)
  call SaveInteger(UnitStats,'n00J',EXP,119)
  call SaveInteger(UnitStats,'n00H',BOUNTYL,100) //archer 1
  call SaveInteger(UnitStats,'n00H',BOUNTYH,100)
  call SaveInteger(UnitStats,'n00H',EXP,119)
  call SaveInteger(UnitStats,'n00A',BOUNTYL,150) //warrior 2
  call SaveInteger(UnitStats,'n00A',BOUNTYH,150)
  call SaveInteger(UnitStats,'n00A',EXP,119)
  call SaveInteger(UnitStats,'n00G',BOUNTYL,150) //archer 2
  call SaveInteger(UnitStats,'n00G',BOUNTYH,150)
  call SaveInteger(UnitStats,'n00G',EXP,119)
  call SaveInteger(UnitStats,'n006',BOUNTYL,200) //warrior 3
  call SaveInteger(UnitStats,'n006',BOUNTYH,200)
  call SaveInteger(UnitStats,'n006',EXP,119)
  call SaveInteger(UnitStats,'n00K',BOUNTYL,200) //archer 3
  call SaveInteger(UnitStats,'n00K',BOUNTYH,200)
  call SaveInteger(UnitStats,'n00K',EXP,119)
  
  call SaveInteger(UnitStats,'o004',BOUNTYL,50) //observer wards
  call SaveInteger(UnitStats,'o004',BOUNTYH,50)
  call SaveInteger(UnitStats,'o004',EXP,0)
endfunction

function StoreAllTints takes nothing returns nothing
  call SaveStr(HeroStats,'H00F',COLOR,"255255200")//dk morphed
  call SaveStr(HeroStats,'H00E',COLOR,"255200200")//
  call SaveStr(HeroStats,'H00G',COLOR,"255200200")//
  call SaveStr(HeroStats,'HC92',COLOR,"130100255")//riki
  call SaveStr(HeroStats,'U008',COLOR,"255075255")//lycan
  call SaveStr(HeroStats,'E015',COLOR,"255100255")//lycan wolf
  call SaveStr(HeroStats,'NC00',COLOR,"100125100")//leoric
  call SaveStr(HeroStats,'UC11',COLOR,"150150100")//magnus
  call SaveStr(HeroStats,'Hvsh',COLOR,"250150150")//BS
  call SaveStr(HeroStats,'Ubal',COLOR,"255200200")//weaver
  call SaveStr(HeroStats,'Nfir',COLOR,"000000000")//sf
  call SaveStr(HeroStats,'EC77',COLOR,"075255025")//viper
  call SaveStr(HeroStats,'Oshd',COLOR,"150000150")//bane
  call SaveStr(HeroStats,'UC18',COLOR,"050100255")//lion
  call SaveStr(HeroStats,'UC60',COLOR,"150150150")//necrolic	
  call SaveStr(HeroStats,'UC91',COLOR,"175075200")//slardar
  call SaveStr(HeroStats,'EC45',COLOR,"000255150")//void
  call SaveStr(HeroStats,'U00C',COLOR,"100100100")//naix
  call SaveStr(HeroStats,'EC57',COLOR,"150200255")//veno
endfunction

function StoreAghaUpgrades takes nothing returns nothing
  local integer i=1
  set AghaBaseSpellID[i]='A0O2'
  set AghaUpgradeID[i]='A28A'
  set AghaUpgradedSpellID[i]='A289'
  set i=i+1
  set AghaBaseSpellID[i]='A0DH'
  set AghaUpgradeID[i]='A1MZ'
  set AghaUpgradedSpellID[i]='A1OB'
  set i=i+1
  set AghaBaseSpellID[i]='A0ER'
  set AghaUpgradeID[i]='A2S7'
  set AghaUpgradedSpellID[i]='A2S8'
  set i=i+1
  set AghaBaseSpellID[i]='A0MQ'
  set AghaUpgradeID[i]='A1BS'
  set AghaUpgradedSpellID[i]='A1B6'
  set i=i+1
  set AghaBaseSpellID[i]='A0Z8'
  set AghaUpgradeID[i]='A1CW'
  set AghaUpgradedSpellID[i]='A1CV'
  set i=i+1
  set AghaBaseSpellID[i]='A0QR'
  set AghaUpgradeID[i]='A1BL'
  set AghaUpgradedSpellID[i]='A1B3'
  set i=i+1
  set AghaBaseSpellID[i]='A0M1'
  set AghaUpgradeID[i]='A1BR'
  set AghaUpgradedSpellID[i]='A1AX'
  set i=i+1
  set AghaBaseSpellID[i]='A054'
  set AghaUpgradeID[i]='A0UE'
  set AghaUpgradedSpellID[i]='A00U'
  set i=i+1
  set AghaBaseSpellID[i]='A1T5'
  set AghaUpgradeID[i]='A236'
  set AghaUpgradedSpellID[i]='A235'
  set i=i+1
  set AghaBaseSpellID[i]='A0IN'
  set AghaUpgradeID[i]='A1BT'
  set AghaUpgradedSpellID[i]='A1AW'
  set i=i+1
  set AghaBaseSpellID[i]='A03R'
  set AghaUpgradeID[i]='A0U2'
  set AghaUpgradedSpellID[i]='A0AV'
  set i=i+1
  set AghaBaseSpellID[i]='A0S8'
  set AghaUpgradeID[i]='A1QR'
  set AghaUpgradedSpellID[i]='A1QP'
  set i=i+1
  set AghaBaseSpellID[i]='A0LT'
  set AghaUpgradeID[i]='A1CT'
  set AghaUpgradedSpellID[i]='A1CS'
  set i=i+1
  set AghaBaseSpellID[i]='A29G'
  set AghaUpgradeID[i]='A0U0'
  set AghaUpgradedSpellID[i]='A29H'
  set i=i+1
  set AghaBaseSpellID[i]='A1W8'
  set AghaUpgradeID[i]='A0U8'
  set AghaUpgradedSpellID[i]='A1W9'
  set i=i+1
  set AghaBaseSpellID[i]='A0L3'
  set AghaUpgradeID[i]='A2QB'
  set AghaUpgradedSpellID[i]='A2QC'
  set i=i+1
  set AghaBaseSpellID[i]='A01P'
  set AghaUpgradeID[i]='A0TO'
  set AghaUpgradedSpellID[i]='A09Z'
  set i=i+1
  set AghaBaseSpellID[i]='A12P'
  set AghaUpgradeID[i]='A1DC'
  set AghaUpgradedSpellID[i]='A1D6'
  set i=i+1
  set AghaBaseSpellID[i]='A0AK'
  set AghaUpgradeID[i]='A1G0'
  set AghaUpgradedSpellID[i]='A1FY'
  set i=i+1
  set AghaBaseSpellID[i]='A0O5'
  set AghaUpgradeID[i]='A1BN'
  set AghaUpgradedSpellID[i]='A1B1'
  set i=i+1
  set AghaBaseSpellID[i]='A00H'
  set AghaUpgradeID[i]='A0TY'
  set AghaUpgradedSpellID[i]='A0A1'
  set i=i+1
  set AghaBaseSpellID[i]='A0E2'
  set AghaUpgradeID[i]='A1MS'
  set AghaUpgradedSpellID[i]='A1MR'
  set i=i+1
  set AghaBaseSpellID[i]='A0MU'
  set AghaUpgradeID[i]='A0UI'
  set AghaUpgradedSpellID[i]='A0A2'
  set i=i+1
  set AghaBaseSpellID[i]='A0NS'
  set AghaUpgradeID[i]='A1DE'
  set AghaUpgradedSpellID[i]='A1DA'
  set i=i+1
  set AghaBaseSpellID[i]='DRKN'
  set AghaUpgradeID[i]='A1BO'
  set AghaUpgradedSpellID[i]='DRKU'
  set i=i+1
  set AghaBaseSpellID[i]='A0FL'
  set AghaUpgradeID[i]='A1D5'
  set AghaUpgradedSpellID[i]='A1CX'
  set i=i+1
  set AghaBaseSpellID[i]='A0G4'
  set AghaUpgradeID[i]='A1DG'
  set AghaUpgradedSpellID[i]='A1D8'
  set i=i+1
  set AghaBaseSpellID[i]='A06R'
  set AghaUpgradeID[i]='A1BM'
  set AghaUpgradedSpellID[i]='A1B4'
  set i=i+1
  set AghaBaseSpellID[i]='A013'
  set AghaUpgradeID[i]='A0UA'
  set AghaUpgradedSpellID[i]='A0A6'
  set i=i+1
  set AghaBaseSpellID[i]='A080'
  set AghaUpgradeID[i]='A1V0'
  set AghaUpgradedSpellID[i]='A1UZ'
  set i=i+1
  set AghaBaseSpellID[i]='A1AO'
  set AghaUpgradeID[i]='A1UW'
  set AghaUpgradedSpellID[i]='A1UV'
  set i=i+1
  set AghaBaseSpellID[i]='A0J1'
  set AghaUpgradeID[i]='A1DD'
  set AghaUpgradedSpellID[i]='A1D7'
  //Divided We Stand isnt supported
  set i=i+1
  set AghaBaseSpellID[i]='A02Q'
  set AghaUpgradeID[i]='A1DH'
  set AghaUpgradedSpellID[i]='A1D9'
  set i=i+1
  set AghaBaseSpellID[i]='A0QK'
  set AghaUpgradeID[i]='A21R'
  set AghaUpgradedSpellID[i]='A21Q'
  set i=i+1
  set AghaBaseSpellID[i]='A095'
  set AghaUpgradeID[i]='A0TQ'
  set AghaUpgradedSpellID[i]='A09W'
  set i=i+1
  set AghaBaseSpellID[i]='A05T'
  set AghaUpgradeID[i]='A0U4'
  set AghaUpgradedSpellID[i]='A08H'
  set i=i+1
  set AghaBaseSpellID[i]='A067'
  set AghaUpgradeID[i]='A0UC'
  set AghaUpgradedSpellID[i]='A08P'
  set i=i+1
  set AghaBaseSpellID[i]='A0CC'
  set AghaUpgradeID[i]='A0TU'
  set AghaUpgradedSpellID[i]='A02Z'
  set i=i+1
  set AghaBaseSpellID[i]='A0OK'
  set AghaUpgradeID[i]='A1VX'
  set AghaUpgradedSpellID[i]='A1VW'
  set i=i+1
  set AghaBaseSpellID[i]='A28R'
  set AghaUpgradeID[i]='A0TW'
  set AghaUpgradedSpellID[i]='A28S'
  set i=i+1
  set AghaBaseSpellID[i]='S008'
  set AghaUpgradeID[i]='A1US'
  set AghaUpgradedSpellID[i]='S00U'
  set i=i+1
  set AghaBaseSpellID[i]='A10Q'
  set AghaUpgradeID[i]='A1DF'
  set AghaUpgradedSpellID[i]='A1DB'
  set i=i+1
  set AghaBaseSpellID[i]='A21Y'
  set AghaUpgradeID[i]='A1BK'
  set AghaUpgradedSpellID[i]='A1GU'
  set i=i+1
  set AghaBaseSpellID[i]='A1NE'
  set AghaUpgradeID[i]='A2IH'
  set AghaUpgradedSpellID[i]='A2IG'
  set i=i+1
  set AghaBaseSpellID[i]='A21F'
  set AghaUpgradeID[i]='A0U6'
  set AghaUpgradedSpellID[i]='A21G'
  set i=i+1
  set AghaBaseSpellID[i]='A0NT'
  set AghaUpgradeID[i]='A0UG'
  set AghaUpgradedSpellID[i]='A0NX'
  set i=i+1
  set AghaBaseSpellID[i]='A1MI'
  set AghaUpgradeID[i]='A2QF'
  set AghaUpgradedSpellID[i]='A2QE'
  set i=i+1
  set AghaBaseSpellID[i]='A2BG'
  set AghaUpgradeID[i]='A30I'
  set AghaUpgradedSpellID[i]='A30H'
  set i=i+1
  set AghaBaseSpellID[i]='A27H'
  set AghaUpgradeID[i]='A30K'
  set AghaUpgradedSpellID[i]='A30J'
  set i=i+1
  set AghaBaseSpellID[i]='A1BX'
  set AghaUpgradeID[i]='A30M'
  set AghaUpgradedSpellID[i]='A30L'
  set i=i+1
  set AghaBaseSpellID[i]='A1U6'
  set AghaUpgradeID[i]='A30O'
  set AghaUpgradedSpellID[i]='A30N'
  set AghaCounter=i
  
endfunction




function StoreAllPassives takes nothing returns nothing
  local integer i=1
  local integer j=1
  local integer k=0
  set PassivesRealID[i]='ACac'//command aura
  set PassivesSpellbookID[i]='Q003'
  set PassivesLearningSkill[i]='P003'
  set PassivesBuffID[i]='BOac'
  set PassivesUpgradeID[i]='QU03'
  set PassivesLearningSkillUpg[i]='QP03'
  set PassivesBaseUpgradeID[i]='Y003'
  set PassivesVisualID[i]='A31F'
  set i=i+1
  set PassivesRealID[i]='P009'//untouchable
  set PassivesSpellbookID[i]='Q009'
  set PassivesLearningSkill[i]='A0DW'
  set PassivesUpgradeID[i]='QU04'
  set PassivesLearningSkillUpg[i]='QP04'
  set PassivesBaseUpgradeID[i]='Y009'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='AHab'//brilliance aura
  set PassivesSpellbookID[i]='Q019'
  set PassivesLearningSkill[i]='P019'
  set PassivesBuffID[i]='B07M'
  set PassivesUpgradeID[i]='QU05'
  set PassivesLearningSkillUpg[i]='QP05'
  set PassivesBaseUpgradeID[i]='Y019'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P022'//cleave
  set PassivesSpellbookID[i]='Q022'
  set PassivesLearningSkill[i]='A01K'
  set PassivesUpgradeID[i]='QU06'
  set PassivesLearningSkillUpg[i]='QP06'
  set PassivesBaseUpgradeID[i]='Y022'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P035'//backstab
  set PassivesSpellbookID[i]='Q035'
  set PassivesLearningSkill[i]='A0DZ'
  set PassivesUpgradeID[i]='QU07'
  set PassivesLearningSkillUpg[i]='QP07'
  set PassivesBaseUpgradeID[i]='Y035'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='A00J'//permanent invis
  set PassivesSpellbookID[i]='Q036'
  set PassivesLearningSkill[i]='A0MB'
  set PassivesUpgradeID[i]='QU08'
  set PassivesLearningSkillUpg[i]='QP08'
  set PassivesBaseUpgradeID[i]='Y036'
  set PassivesVisualID[i]='A31G'
  set i=i+1
  set PassivesRealID[i]='P047'//blade dance
  set PassivesSpellbookID[i]='Q047'
  set PassivesLearningSkill[i]='A00K'
  set PassivesUpgradeID[i]='QU09'
  set PassivesLearningSkillUpg[i]='QP09'
  set PassivesBaseUpgradeID[i]='Y047'
  set PassivesVisualID[i]='A31H'
  set i=i+1
  set PassivesRealID[i]='ANic'//fury swipes
  set PassivesSpellbookID[i]='Q067'
  set PassivesLearningSkill[i]='P067'
  set PassivesUpgradeID[i]='QU0A'
  set PassivesLearningSkillUpg[i]='QP0A'
  set PassivesBaseUpgradeID[i]='Y067'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P083'//Juxtapose
  set PassivesSpellbookID[i]='Q083'
  set PassivesLearningSkill[i]='A0DB'
  set PassivesBuffID[i]='B03B'
  set PassivesUpgradeID[i]='QU0B'
  set PassivesLearningSkillUpg[i]='QP0B'
  set PassivesBaseUpgradeID[i]='Y083'
  set PassivesVisualID[i]='A31I'
  set i=i+1
  set PassivesRealID[i]='P084'//Phantom Edge
  set PassivesSpellbookID[i]='Q084'
  set PassivesLearningSkill[i]='A0YK'
  set PassivesUpgradeID[i]='QU0C'
  set PassivesLearningSkillUpg[i]='QP0C'
  set PassivesBaseUpgradeID[i]='Y084'
  set PassivesVisualID[i]='A31J'
  set i=i+1
  set PassivesRealID[i]='P098'//moon glaive
  set PassivesSpellbookID[i]='Q098'
  set PassivesLearningSkill[i]='A041'
  set PassivesUpgradeID[i]='QU0D'
  set PassivesLearningSkillUpg[i]='QP0D'
  set PassivesBaseUpgradeID[i]='Y098'
  set PassivesVisualID[i]='A31K'
  set i=i+1
  set PassivesRealID[i]='P099'//Lunar blessing
  set PassivesSpellbookID[i]='Q099'
  set PassivesLearningSkill[i]='A062'
  set PassivesBuffID[i]='B01W'
  set PassivesUpgradeID[i]='QU0E'
  set PassivesLearningSkillUpg[i]='QP0E'
  set PassivesBaseUpgradeID[i]='Y099'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P102'//Headshot
  set PassivesSpellbookID[i]='Q102'
  set PassivesLearningSkill[i]='A03S'
  set PassivesUpgradeID[i]='QU0F'
  set PassivesLearningSkillUpg[i]='QP0F'
  set PassivesBaseUpgradeID[i]='Y102'
  set PassivesVisualID[i]='A31L'
  set i=i+1
  set PassivesRealID[i]='P107'//fervor
  set PassivesSpellbookID[i]='Q107'
  set PassivesLearningSkill[i]='A0O0'
  set PassivesUpgradeID[i]='QU0G'
  set PassivesLearningSkillUpg[i]='QP0G'
  set PassivesBaseUpgradeID[i]='Y107'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P119'//Drunken brawler
  set PassivesSpellbookID[i]='Q119'
  set PassivesLearningSkill[i]='A0MX'
  set PassivesUpgradeID[i]='QU0H'
  set PassivesLearningSkillUpg[i]='QP0H'
  set PassivesBaseUpgradeID[i]='Y119'
  set PassivesVisualID[i]='A31M'
  set i=i+1
  set PassivesRealID[i]='P123'//Return
  set PassivesSpellbookID[i]='Q123'
  set PassivesLearningSkill[i]='A00V'
  set PassivesBuffID[i]='B00M'
  set PassivesUpgradeID[i]='QU0I'
  set PassivesLearningSkillUpg[i]='QP0I'
  set PassivesBaseUpgradeID[i]='Y123'
  set PassivesVisualID[i]='A31N'
  set i=i+1
  set PassivesRealID[i]='P131'//Dragon Blood
  set PassivesSpellbookID[i]='Q131'
  set PassivesLearningSkill[i]='A0CL'
  set PassivesBuffID[i]='B04D'
  set PassivesUpgradeID[i]='QU0J'
  set PassivesLearningSkillUpg[i]='QP0J'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P133'//Mana break
  set PassivesSpellbookID[i]='Q133'
  set PassivesLearningSkill[i]='A022'
  set PassivesUpgradeID[i]='QU0K'
  set PassivesLearningSkillUpg[i]='QP0K'
  set PassivesBaseUpgradeID[i]='Y133'
  set PassivesVisualID[i]='A31O'
  set i=i+1
  set PassivesRealID[i]='P135'//Spell Shield
  set PassivesSpellbookID[i]='Q135'
  set PassivesLearningSkill[i]='A0KY'
  set PassivesUpgradeID[i]='QU0L'
  set PassivesLearningSkillUpg[i]='QP0L'
  set PassivesBaseUpgradeID[i]='Y135'
  set PassivesVisualID[i]='A31P'
  set i=i+1
  set PassivesRealID[i]='P143'//Degen Aura
  set PassivesSpellbookID[i]='Q143'
  set PassivesLearningSkill[i]='A06A'
  set PassivesBuffID[i]='B01B'
  set PassivesUpgradeID[i]='QU0M'
  set PassivesLearningSkillUpg[i]='QP0M'
  set PassivesBaseUpgradeID[i]='Y143'
  set PassivesVisualID[i]='A31Q'
  set i=i+1
  set PassivesRealID[i]='P147'//Inner Beast
  set PassivesSpellbookID[i]='Q147'
  set PassivesLearningSkill[i]='A0BD'
  set PassivesBuffID[i]='B00E'
  set PassivesUpgradeID[i]='QU0N'
  set PassivesLearningSkillUpg[i]='QP0N'
  set PassivesBaseUpgradeID[i]='Y147'
  set PassivesVisualID[i]='A31R'
  set i=i+1
  set PassivesRealID[i]='P155'//Goblin's Greed
  set PassivesSpellbookID[i]='Q155'
  set PassivesLearningSkill[i]='A0O3'
  set PassivesBuffID[i]='B00X'
  set PassivesUpgradeID[i]='QU0O'
  set PassivesLearningSkillUpg[i]='QP0O'
  set PassivesBaseUpgradeID[i]='Y155'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P211'//Null Field
  set PassivesSpellbookID[i]='Q211'
  set PassivesLearningSkill[i]='A27V'
  set PassivesBuffID[i]='B0EO'
  set PassivesUpgradeID[i]='QU0P'
  set PassivesLearningSkillUpg[i]='QP0P'
  set PassivesBaseUpgradeID[i]='Y211'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P231'//Feral Impulse
  set PassivesSpellbookID[i]='Q231'
  set PassivesLearningSkill[i]='A03E'
  set PassivesBuffID[i]='B096'
  set PassivesUpgradeID[i]='QU0Q'
  set PassivesLearningSkillUpg[i]='QP0Q'
  set PassivesBaseUpgradeID[i]='Y231'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P239'//Blur
  set PassivesSpellbookID[i]='Q239'
  set PassivesLearningSkill[i]='A03P'
  set PassivesUpgradeID[i]='QU0R'
  set PassivesLearningSkillUpg[i]='QP0R'
  set PassivesBaseUpgradeID[i]='Y239'
  set PassivesVisualID[i]='A31S'
  set i=i+1
  set PassivesRealID[i]='P240'//Coup de grace
  set PassivesSpellbookID[i]='Q240'
  set PassivesLearningSkill[i]='A03Q'
  set PassivesUpgradeID[i]='QU0S'
  set PassivesLearningSkillUpg[i]='QP0S'
  set PassivesBaseUpgradeID[i]='Y240'
  set PassivesVisualID[i]='A31T'
  set i=i+1
  set PassivesRealID[i]='S00A'//Hunter in the Night
  set PassivesSpellbookID[i]='Q247'
  set PassivesLearningSkill[i]='A086'
  set PassivesBuffID[i]='B02L'
  set PassivesUpgradeID[i]='QU0T'
  set PassivesLearningSkillUpg[i]='QP0T'
  set PassivesBaseUpgradeID[i]='Y247'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='AUav'//Vampiric Aura
  set PassivesSpellbookID[i]='Q250'
  set PassivesLearningSkill[i]='P250'
  set PassivesBuffID[i]='BVA1'
  set PassivesUpgradeID[i]='QU0U'
  set PassivesLearningSkillUpg[i]='QP0U'
  set PassivesBaseUpgradeID[i]='Y250'
  set PassivesVisualID[i]='A31U'
  set i=i+1
  set PassivesRealID[i]='AOcr'//Mortal Strike
  set PassivesSpellbookID[i]='Q251'
  set PassivesLearningSkill[i]='A2S0'
  set PassivesUpgradeID[i]='QU0V'
  set PassivesLearningSkillUpg[i]='QP0W'
  set PassivesBaseUpgradeID[i]='Y251'
  set PassivesVisualID[i]='A31V'
  set i=i+1
  set PassivesRealID[i]='P263'//Slardar Bash
  set PassivesSpellbookID[i]='Q263'
  set PassivesLearningSkill[i]='A0JJ'
  set PassivesUpgradeID[i]='QU0W'
  set PassivesLearningSkillUpg[i]='QP0V'
  set PassivesBaseUpgradeID[i]='Y263'
  set PassivesVisualID[i]='A31W'
  set i=i+1
  set PassivesRealID[i]='P275'//Time Lock
  set PassivesSpellbookID[i]='Q275'
  set PassivesLearningSkill[i]='A081'
  set PassivesUpgradeID[i]='QU0X'
  set PassivesLearningSkillUpg[i]='QP0X'
  set PassivesBaseUpgradeID[i]='Y275'
  set PassivesVisualID[i]='A31X'
  set i=i+1
  set PassivesRealID[i]='P279'//Backtrack
  set PassivesSpellbookID[i]='Q279'
  set PassivesLearningSkill[i]='A0MM'
  set PassivesUpgradeID[i]='QU0Y'
  set PassivesLearningSkillUpg[i]='QP0Y'
  set PassivesBaseUpgradeID[i]='Y279'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P283'//Unstable current
  set PassivesSpellbookID[i]='Q283'
  set PassivesLearningSkill[i]='A1E6'
  set PassivesBuffID[i]='B03X'
  set PassivesUpgradeID[i]='QU0Z'
  set PassivesLearningSkillUpg[i]='QP0Z'
  set PassivesBaseUpgradeID[i]='Y283'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P294'//Kraken Shell
  set PassivesSpellbookID[i]='Q294'
  set PassivesLearningSkill[i]='A04E'
  set PassivesUpgradeID[i]='QU10'
  set PassivesLearningSkillUpg[i]='QP10'
  set PassivesBaseUpgradeID[i]='Y294'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P302'//Heartstopper aura
  set PassivesSpellbookID[i]='Q302'
  set PassivesLearningSkill[i]='A01N'
  set PassivesBuffID[i]='B084'
  set PassivesUpgradeID[i]='QU11'
  set PassivesLearningSkillUpg[i]='QP11'
  set PassivesBaseUpgradeID[i]='Y302'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P303'//Sadist
  set PassivesSpellbookID[i]='Q303'
  set PassivesLearningSkill[i]='A060'
  set PassivesUpgradeID[i]='QU12'
  set PassivesLearningSkillUpg[i]='QP12'
  set PassivesBaseUpgradeID[i]='Y303'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P307'//Flesh Heap
  set PassivesSpellbookID[i]='Q307'
  set PassivesLearningSkill[i]='A06D'
  set PassivesUpgradeID[i]='QU13'
  set PassivesLearningSkillUpg[i]='QP13'
  set PassivesBaseUpgradeID[i]='Y307'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P310'//Empowering haste
  set PassivesSpellbookID[i]='Q310'
  set PassivesLearningSkill[i]='A0ES'
  set PassivesBuffID[i]='B03Y'
  set PassivesUpgradeID[i]='QU14'
  set PassivesLearningSkillUpg[i]='QP14'
  set PassivesBaseUpgradeID[i]='Y310'
  set PassivesVisualID[i]='A31Y'
  set i=i+1
  set PassivesRealID[i]='P319'//Present of the dark lord
  set PassivesSpellbookID[i]='Q319'
  set PassivesLearningSkill[i]='A0FU'
  set PassivesUpgradeID[i]='QU15'
  set PassivesLearningSkillUpg[i]='QP15'
  set PassivesBaseUpgradeID[i]='Y319'
  set PassivesVisualID[i]='A31Z'
  set i=i+1
  set PassivesRealID[i]='P323'//Caustic Finale
  set PassivesSpellbookID[i]='Q323'
  set PassivesLearningSkill[i]='A0FA'
  set PassivesUpgradeID[i]='QU16'
  set PassivesLearningSkillUpg[i]='QP16'
  set PassivesBaseUpgradeID[i]='Y323'
  set PassivesVisualID[i]='A320'
  set i=i+1
  set PassivesRealID[i]='P327'//Counter Helix
  set PassivesSpellbookID[i]='Q327'
  set PassivesLearningSkill[i]='A0C6'
  set PassivesBuffID[i]='B03P'
  set PassivesUpgradeID[i]='QU17'
  set PassivesLearningSkillUpg[i]='QP17'
  set PassivesBaseUpgradeID[i]='Y327'
  set PassivesVisualID[i]='A321'
  set i=i+1
  set PassivesRealID[i]='P335'//Frostmourne
  set PassivesSpellbookID[i]='Q335'
  set PassivesLearningSkill[i]='A0MG'
  set PassivesUpgradeID[i]='QU18'
  set PassivesLearningSkillUpg[i]='QP18'
  set PassivesBaseUpgradeID[i]='Y335'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P338'//Desolate
  set PassivesSpellbookID[i]='Q338'
  set PassivesLearningSkill[i]='A0FX'
  set PassivesUpgradeID[i]='QU19'
  set PassivesLearningSkillUpg[i]='QP19'
  set PassivesBaseUpgradeID[i]='Y338'
  set PassivesVisualID[i]='A322'
  set i=i+1
  set PassivesRealID[i]='P347'//Essense aura
  set PassivesSpellbookID[i]='Q347'
  set PassivesLearningSkill[i]='A0IF'
  set PassivesBuffID[i]='B06X'
  set PassivesUpgradeID[i]='QU1A'
  set PassivesLearningSkillUpg[i]='QP1A'
  set PassivesBaseUpgradeID[i]='Y347'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P355'//Geostrike
  set PassivesSpellbookID[i]='Q355'
  set PassivesLearningSkill[i]='A0N7'
  set PassivesUpgradeID[i]='QU1B'
  set PassivesLearningSkillUpg[i]='QP1B'
  set PassivesBaseUpgradeID[i]='Y355'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P363'//Diffusion Aura
  set PassivesSpellbookID[i]='Q363'
  set PassivesLearningSkill[i]='AIcd'
  set PassivesUpgradeID[i]='QU1C'
  set PassivesLearningSkillUpg[i]='QP1C'
  set PassivesBaseUpgradeID[i]='Y363'
  set PassivesVisualID[i]='A323'
  set i=i+1
  set PassivesRealID[i]='P418'//Poison sting
  set PassivesSpellbookID[i]='Q418'
  set PassivesLearningSkill[i]='A0MY'
  set PassivesUpgradeID[i]='QU1D'
  set PassivesLearningSkillUpg[i]='QP1D'
  set PassivesBaseUpgradeID[i]='Y418'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='P431'//Critical Strike
  set PassivesSpellbookID[i]='Q431'
  set PassivesLearningSkill[i]='A03N'
  set PassivesUpgradeID[i]='QU1E'
  set PassivesLearningSkillUpg[i]='QP1E'
  set PassivesBaseUpgradeID[i]='Y431'
  set PassivesVisualID[i]='A324'
  
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A1HR'//essence shift
  set PassivesUpgradeID[i]='QU1F'
  set PassivesLearningSkillUpg[i]='QP1F'
  set PassivesBaseUpgradeID[i]='Y391'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0DJ'//aftershock
  set PassivesUpgradeID[i]='QU1G'
  set PassivesLearningSkillUpg[i]='QP1G'
  set PassivesBaseUpgradeID[i]='Y031'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='QF85'//aftershock balanced
  set PassivesUpgradeID[i]='QU1H'
  set PassivesLearningSkillUpg[i]='QP1H'
  set PassivesBaseUpgradeID[i]='QY85'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A1CD'//natural order
  set PassivesUpgradeID[i]='QU1I'
  set PassivesLearningSkillUpg[i]='QP1I'
  set PassivesBaseUpgradeID[i]='Y059'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A19Q'//craggy ext
  set PassivesUpgradeID[i]='QU1J'
  set PassivesLearningSkillUpg[i]='QP1J'
  set PassivesBaseUpgradeID[i]='Y087'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0CY'//Grow!
  set PassivesUpgradeID[i]='QU1K'
  set PassivesLearningSkillUpg[i]='QP1K'
  set PassivesBaseUpgradeID[i]='Y088'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0QQ'//Berserker blood
  set PassivesUpgradeID[i]='QU1L'
  set PassivesLearningSkillUpg[i]='QP1L'
  set PassivesBaseUpgradeID[i]='Y167'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0M3'//Bristleback
  set PassivesUpgradeID[i]='QU1M'
  set PassivesLearningSkillUpg[i]='QP1M'
  set PassivesBaseUpgradeID[i]='Y207'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0FV'//Warpath
  set PassivesUpgradeID[i]='QU1N'
  set PassivesLearningSkillUpg[i]='QP1N'
  set PassivesBaseUpgradeID[i]='Y208'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A2EY'//Moment of courage
  set PassivesUpgradeID[i]='QU1O'
  set PassivesLearningSkillUpg[i]='QP1O'
  set PassivesBaseUpgradeID[i]='Y219'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A2E4'//Reactive armor
  set PassivesUpgradeID[i]='QU1P'
  set PassivesLearningSkillUpg[i]='QP1P'
  set PassivesBaseUpgradeID[i]='Y227'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A03U'//Take aim
  set PassivesUpgradeID[i]='QU1Q'
  set PassivesLearningSkillUpg[i]='QP1Q'
  set PassivesBaseUpgradeID[i]='Y103'
  set PassivesVisualID[i]=0
  //	set i=i+1
  //	set PassivesRealID[i]=0
  //	set PassivesSpellbookID[i]=0
  //	set PassivesLearningSkill[i]='A2O2'//Trueshot
  //	set PassivesUpgradeID[i]='QU1R'
  //	set PassivesLearningSkillUpg[i]='QP1R'
  //	set PassivesBaseUpgradeID[i]='Y139'
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0RO'//Psi blades
  set PassivesUpgradeID[i]='QU1S'
  set PassivesLearningSkillUpg[i]='QP1S'
  set PassivesBaseUpgradeID[i]='Y171'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0N5'//Static field
  set PassivesUpgradeID[i]='QU1T'
  set PassivesLearningSkillUpg[i]='QP1T'
  set PassivesBaseUpgradeID[i]='Y007'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A18X'//Fiery Soul
  set PassivesUpgradeID[i]='QU1U'
  set PassivesLearningSkillUpg[i]='QP1U'
  set PassivesBaseUpgradeID[i]='Y043'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0QW'//Overload
  set PassivesUpgradeID[i]='QU1V'
  set PassivesLearningSkillUpg[i]='QP1V'
  set PassivesBaseUpgradeID[i]='Y163'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0SS'//Feast
  set PassivesUpgradeID[i]='QU1W'
  set PassivesLearningSkillUpg[i]='QP1W'
  set PassivesBaseUpgradeID[i]='Y286'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0G5'//Greater Bash
  set PassivesUpgradeID[i]='QU1X'
  set PassivesLearningSkillUpg[i]='QP1X'
  set PassivesBaseUpgradeID[i]='Y311'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0LE'//Bloodbath
  set PassivesUpgradeID[i]='QU1Y'
  set PassivesLearningSkillUpg[i]='QP1Y'
  set PassivesBaseUpgradeID[i]='Y330'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0I8'//Strygwyr's thrist
  set PassivesUpgradeID[i]='QU1Z'
  set PassivesLearningSkillUpg[i]='QP1Z'
  set PassivesBaseUpgradeID[i]='Y331'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0NA'//Dispersion
  set PassivesUpgradeID[i]='QU20'
  set PassivesLearningSkillUpg[i]='QP20'
  set PassivesBaseUpgradeID[i]='Y339'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A1A3'//Nethertoxin
  set PassivesUpgradeID[i]='QU21'
  set PassivesLearningSkillUpg[i]='QP21'
  set PassivesBaseUpgradeID[i]='Y278'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0CZ'//Backtrack
  set PassivesUpgradeID[i]='QU22'
  set PassivesLearningSkillUpg[i]='QP22'
  set PassivesBaseUpgradeID[i]='Y274'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A0VX'//Gravekeeper's Cloak
  set PassivesUpgradeID[i]='QU23'
  set PassivesLearningSkillUpg[i]='QP23'
  set PassivesBaseUpgradeID[i]='Y427'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]=0
  set PassivesSpellbookID[i]=0
  set PassivesLearningSkill[i]='A088'//Multi cast
  set PassivesUpgradeID[i]='QU24'
  set PassivesLearningSkillUpg[i]='QP24'
  set PassivesBaseUpgradeID[i]='Y072'
  set PassivesVisualID[i]=0
  set i=i+1
  set PassivesRealID[i]='A33O'
  set PassivesSpellbookID[i]='A33P'
  set PassivesLearningSkill[i]='A33Q'//Last word passive
  set PassivesUpgradeID[i]='A33S'
  set PassivesLearningSkillUpg[i]='A33R'
  set PassivesBaseUpgradeID[i]='Y459'
  set PassivesVisualID[i]=0
  
  set PassivesCount=i
  set PassivesHiddenCount=i
  
  
  
  
  loop
    set k=0
    loop
      call SetPlayerAbilityAvailable(Player(k),PassivesSpellbookID[j],false)
      call SetPlayerAbilityAvailable(Player(k),PassivesUpgradeID[j],false)
      set k=k+1
      exitwhen k>12
    endloop
    set j=j+1
    exitwhen j>i
  endloop
  
endfunction

function FixPassiveSkills_Init takes nothing returns nothing
  local integer i=0
  local integer loopA = 0
  
  set BuggedPassiveMax=i
  
  set i = 0
  
  loop
    exitwhen i==BuggedPassiveMax
    if PassiveBuffId[i]!=0 then
      set morph_passives[loopA] = PassiveBuffId[i]
      set loopA = loopA + 1
    endif
    set i = i + 1
  endloop
  
  set morph_passives_count = loopA
  
  call ExeFunc("FixPassiveSkills_DisableAbilities")
endfunction

function FixPassiveSkills_IsMorphAbility takes integer id returns boolean
  local boolean a=id=='A03G' or id=='QM00' or id=='A19Z' or id=='QM04' or id=='A11T' or id=='QM01' or id=='A0AG' or id=='A2H0' or id=='QB0L' or id=='A093' or id=='A15J' or id=='QM03' or id=='A1RI' or id=='A1C0'
  return a or id=='A0BE' or id=='A0B8' or id=='A1WE' or id=='A03O' or id=='A063' or id=='ANcr' or id=='QB0K'
endfunction

function FixPassiveSkills_FindPassiveIndex takes integer id returns integer
  local integer i=0
  loop
    exitwhen i>BuggedPassiveMax
    if id==BuggedPassive[i] then
      return i
    endif
    set i=i+1
  endloop
  return -1
endfunction

function FixPassiveSkills_EnableAbilitiesForPlayer takes integer PlayerId returns nothing
  local integer i=0
  loop
    exitwhen i>BuggedPassiveMax
    call SetPlayerAbilityAvailable2(Player(PlayerId),PassiveHiddenAbilityId[i],true)
    set i=i+1
  endloop
endfunction

function FixPassiveSkills_DisableAbilitiesForPlayer takes integer PlayerId returns nothing
  local integer i=0
  loop
    exitwhen i>BuggedPassiveMax
    call SetPlayerAbilityAvailable2(Player(PlayerId),PassiveHiddenAbilityId[i],false)
    call SetPlayerAbilityAvailable2(Player(PlayerId),PassiveHiddenSpellBookId[i],false)
    
    call UnitRemoveAbility(udg_Hero[PlayerId],PassiveBuffId[i])
    set i=i+1
  endloop
endfunction

function FixPassiveSkills_DisableAbilitiesForPlayerFromGlobal takes nothing returns nothing
  call FixPassiveSkills_DisableAbilitiesForPlayer(tt_int1)
endfunction

function FixPassiveSkills_DisableAbilities takes nothing returns nothing
  local integer PlayerId=0
  loop
    exitwhen PlayerId>11
    call FixPassiveSkills_DisableAbilitiesForPlayer(PlayerId)
    set PlayerId=PlayerId+1
  endloop
endfunction

function FixPassiveSkills_DisableMorphedAbilities takes unit u returns nothing
  local player p=GetOwningPlayer(u)
  call SetPlayerAbilityAvailable2(p,'QF9E',false)
  //call SetPlayerAbilityAvailable2(p,'A09E',false)
  //call SetPlayerAbilityAvailable2(p,'A03B',false)
  //call SetPlayerAbilityAvailable2(p,'A15K',false)
  call SetPlayerAbilityAvailable2(p,'A1ET',false)
  call SetPlayerAbilityAvailable2(p,'A1ES',false)
  call SetPlayerAbilityAvailable2(p,'A1EQ',false)
  call SetPlayerAbilityAvailable2(p,'A1ER',false)
  call SetPlayerAbilityAvailable2(p,'A23F',false)
  set p=null
endfunction

function FixPassiveSkills_RemoveMorphedAbilities takes unit u returns nothing
  local integer id=GetUnitTypeId(u)
  if id!='N017' and id!='N02B' then
    //call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'QF9E',false)
    //call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A09E',false)
  endif
  if id!='E015' then
    //call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A521',false)
    //call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'Aeth',false)
    //call UnitRemoveAbility(u,'A521')
    //call UnitRemoveAbility(u,'Aeth')
  endif
  if id!='H07I' then
    //call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A15K',false)
    //call UnitRemoveAbility(u,'A15K')
  endif
  if id!='H08D' then
    //call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A1ET',false)
    //call UnitRemoveAbility(u,'A1ET')
  endif
  if id!='H08C' then
    //call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A1ES',false)
    //call UnitRemoveAbility(u,'A1ES')
  endif
  if id!='H084' then
    //call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A1EQ',false)
    //call UnitRemoveAbility(u,'A1EQ')
  endif
  if id!='H08B' then
    //call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A1ER',false)
    //call UnitRemoveAbility(u,'A1ER')
  endif
  if id!='H08D' and id!='H08C' and id!='H084' and id!='H08B' then
    //call UnitRemoveAbility(u,'A23F')
    //call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A23F',false)
  endif
  
  call Abbadon_Frostmourne_Transform(u)
endfunction


function FixPassiveSkills_RemoveAllPassiveEx takes unit Hero, unit Reference, boolean RemoveBuffs returns nothing
  local integer PlayerId=GetPlayerId(GetOwningPlayer(Reference))
  local integer id1=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+1]
  local integer id2=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+2]
  local integer id3=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+3]
  local integer id4=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+4]
  local integer id5=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+5]
  local integer id6=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+6]
  local integer i=0
  if NumberOfExtraAbilities<2 then
    set id6=-1
  endif
  if NumberOfExtraAbilities<1 then
    set id5=-1
  endif
  loop
    exitwhen i>BuggedPassiveMax
    if i!=id1 and i!=id2 and i!=id3 and i!=id4 and i!=id5 and i!=id6 then
      if GetUnitAbilityLevel(Hero,PassiveHiddenAbilityId[i])>0 or GetUnitAbilityLevel(Hero,PassiveHiddenSpellBookId[i])>0 then
        //call UnitRemoveAbility(Hero,PassiveHiddenAbilityId[i])
        call UnitRemoveAbility(Hero,PassiveHiddenSpellBookId[i])
        //call BJDebugMsg(I2S(i)+" removed")
      endif
      if RemoveBuffs then
        if PassiveBuffId[i]!=null then
          call UnitRemoveAbility(Hero,PassiveBuffId[i])
        endif
      endif
    else
      if GetUnitAbilityLevel(Reference,PassiveReferenceId[i])==0 then
        if GetUnitAbilityLevel(Hero,PassiveHiddenAbilityId[i])>0 or GetUnitAbilityLevel(Hero,PassiveHiddenSpellBookId[i])>0 then
          //call UnitRemoveAbility(Hero,PassiveHiddenAbilityId[i])
          call UnitRemoveAbility(Hero,PassiveHiddenSpellBookId[i])
          //call BJDebugMsg(I2S(i)+" removed")
        endif
        if RemoveBuffs then
          if PassiveBuffId[i]!=null then
            call UnitRemoveAbility(Hero,PassiveBuffId[i])
          endif
        endif
      endif
    endif
    set i=i+1
  endloop
endfunction

function FixPassiveSkills_LevelIllusions takes nothing returns boolean
  local unit Illusion=GetSummonedUnit()
  local integer PlayerId=GetPlayerId(GetOwningPlayer(Illusion))
  local integer i=1
  local integer PassiveId
  local unit IllusionOriginal=LoadUnitHandle(hashtable019,GetHandleId(GetSummoningUnit()),'0ILU')
  local integer MorphID1
  local integer MorphID2
  local integer UnitID
  local real hp
  if IsUnitIllusion(Illusion)==false or GetUnitTypeId(Illusion)<1 then
    set Illusion=null
    set IllusionOriginal=null
    return false
  endif
  if GetUnitAbilityLevel(Illusion,'B0EN')>0 then
    set PlayerId=TempInteger
  endif
  if IllusionOriginal!=null then
    //call BJDebugMsg(GetUnitName(IllusionOriginal))
    set PlayerId=GetPlayerId(GetOwningPlayer(IllusionOriginal))
  else
    //call BJDebugMsg("found no source info for illusion, assuming player's hero")
    set IllusionOriginal=udg_Hero[PlayerId]
  endif
  call SaveUnitHandle(hashtable019,GetHandleId(Illusion),'0ILU',IllusionOriginal) //generic illu source info
  set UnitID=GetUnitTypeId(IllusionOriginal)
  if GetUnitTypeId(Illusion)==UnitID then
    loop
      if GetUnitAbilityLevel(IllusionOriginal,PassivesLearningSkill[i])==0 and GetUnitAbilityLevel(IllusionOriginal,PassivesLearningSkillUpg[i])==0 then
        call UnitRemoveAbility(Illusion,PassivesRealID[i])
        call UnitRemoveAbility(Illusion,PassivesSpellbookID[i])
        call UnitRemoveAbility(Illusion,PassivesBuffID[i])
      else
        //call ExeFunc("zz"+I2S(GetUnitAbilityLevel(IllusionOriginal,PassivesLearningSkill[i])+GetUnitAbilityLevel(IllusionOriginal,PassivesLearningSkillUpg[i])))
        //call SetUnitAbilityLevel(Illusion,PassivesRealID[i],GetUnitAbilityLevel(IllusionOriginal,PassivesLearningSkill[i])+GetUnitAbilityLevel(IllusionOriginal,PassivesLearningSkillUpg[i]))
        //call ExeFunc("2")
        call UnitMakeAbilityPermanent(Illusion,true,PassivesRealID[i])
        //call ExeFunc("3")
        call UnitMakeAbilityPermanent(Illusion,true,PassivesSpellbookID[i])
        //call ExeFunc("4")
        call UnitAddAbility(Illusion,PassivesVisualID[i])
        call UnitMakeAbilityPermanent(Illusion,true,PassivesVisualID[i])
        //call ExeFunc("5")
      endif
      set i=i+1
      exitwhen i>PassivesCount
    endloop
  endif
  set i=1
  if GetUnitTypeId(Illusion)!=UnitID then
    set hp=GetUnitState(Illusion,UNIT_STATE_MAX_LIFE)
    call UnitMakeAbilityPermanent(Illusion,true,'A09J') //Split Shot fix
    set MorphID1=GetMorphId(GetUnitTypeId(Illusion))
    set MorphID2=GetMorphId(UnitID)
    call UnitAddAbility(Illusion,MorphID1)
    call UnitRemoveAbility(Illusion,MorphID1)
    call UnitAddAbility(Illusion,MorphID2+1)
    call UnitRemoveAbility(Illusion,MorphID2+1)
    loop
      if GetUnitAbilityLevel(IllusionOriginal,PassivesLearningSkill[i])==0 and GetUnitAbilityLevel(IllusionOriginal,PassivesLearningSkillUpg[i])==0 then
        call UnitRemoveAbility(Illusion,PassivesRealID[i])
        call UnitRemoveAbility(Illusion,PassivesSpellbookID[i])
        call UnitRemoveAbility(Illusion,PassivesBuffID[i])
      else
        //call SetUnitAbilityLevel(Illusion,PassivesRealID[i],GetUnitAbilityLevel(IllusionOriginal,PassivesLearningSkill[i])+GetUnitAbilityLevel(IllusionOriginal,PassivesLearningSkillUpg[i]))
        call UnitMakeAbilityPermanent(Illusion,true,PassivesRealID[i])
        call UnitMakeAbilityPermanent(Illusion,true,PassivesSpellbookID[i])
      endif
      set i=i+1
      exitwhen i>PassivesCount
    endloop
    loop
      exitwhen GetUnitState(Illusion,UNIT_STATE_MAX_LIFE)<=hp
      call UnitAddAbility(Illusion,'Z999')
      call SetUnitAbilityLevel(Illusion,'Z999',2)
      call UnitRemoveAbility(Illusion,'Z999')
    endloop
  endif
  
  call FixPassiveSkills_RemoveMorphedAbilities(Illusion)
  call FixPassiveSkills_RemoveAllPassiveEx(Illusion,IllusionOriginal,true)
  set i=1
  loop
    exitwhen i>4+NumberOfExtraAbilities
    set PassiveId=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+i]
    if PassiveId!=-1 then
      //call BJDebugMsg(GetObjectName(PassiveReferenceId[PassiveId])+" found level "+I2S(GetUnitAbilityLevel(IllusionOriginal,PassiveHiddenAbilityId[PassiveId]))+" for illu")
      call SetUnitAbilityLevel(Illusion,PassiveHiddenAbilityId[PassiveId],GetUnitAbilityLevel(IllusionOriginal,PassiveHiddenAbilityId[PassiveId]))
    endif
    set i=i+1
  endloop
  set Illusion=null
  set IllusionOriginal=null
  return false
endfunction



function FixPassiveSkills_LevelHiddenSkills takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=LoadUnitHandle(hashtable019,Cache,2)
  local integer PlayerAbilityId
  local integer PlayerId=GetPlayerId(GetOwningPlayer(Hero))
  local integer i=1
  local integer PassiveId
  local integer Level
  local integer ShouldHideSomeMore=LoadInteger(hashtable019,Cache,100)
  if Hero==null then
    //call BJDebugMsg("ded")
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,Cache)
    set Hero=null
    set t=null
    return false
  endif
  if GetTriggerEvalCount(t)<=1 then
    loop
      exitwhen i>4+NumberOfExtraAbilities
      set PlayerAbilityId=PlayerSkillNumber[PlayerId*PlayerSkillOffset+i]
      //call BJDebugMsg("Player has "+I2S(PlayerAbilityId)+" "+GetObjectName(SkillID[PlayerAbilityId]))
      set PlayerPassiveSkill[PlayerId*PlayerSkillOffset+i]=FixPassiveSkills_FindPassiveIndex(PlayerAbilityId)
      //call SaveInteger(HY,GetHandleId(Hero),'0PA0'+i,PlayerPassiveSkill[PlayerId*PlayerSkillOffset+i])
      //call BJDebugMsg("------ found "+I2S(PlayerPassiveSkill[PlayerId*PlayerSkillOffset+i]))
      set i=i+1
    endloop
    call FixPassiveSkills_DisableMorphedAbilities(Hero)
    call FixPassiveSkills_RemoveAllPassiveEx(Hero,Hero,false)
  endif
  if IsDead(Hero) then //OH GOD IF I DON'T DO THAT THE MAP WILL FATAL
    //call BJDebugMsg("ded")
    set Hero=null
    set t=null
    return false
  endif
  if ((GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT or GetTriggerEventId()==EVENT_UNIT_SPELL_FINISH) and FixPassiveSkills_IsMorphAbility(GetSpellAbilityId())) then
    call FixPassiveSkills_TempDisableAbilitiesForHero(Hero)
    call TriggerRegisterTimerEvent(t,0.005,false)
    //call BJDebugMsg("temp disabling all passive effects 1")
    call SaveInteger(hashtable019,Cache,100,1)
    
    
    call MorphUnit_RemoveBuffs(Hero)
  elseif ShouldHideSomeMore==1 then
    call FixPassiveSkills_TempDisableAbilitiesForHero(Hero)
    //call BJDebugMsg("temp disabling all passive effects 2")
    call SaveInteger(hashtable019,Cache,100,2)
  elseif ShouldHideSomeMore==2 then
    call FixPassiveSkills_TempDisableAbilitiesForHero(Hero)
    //call BJDebugMsg("temp disabling all passive effects 3")
    call SaveInteger(hashtable019,Cache,100,3)
  elseif ShouldHideSomeMore==3 then
    call FixPassiveSkills_EnableAbilitiesForPlayer(PlayerId)
    //call BJDebugMsg("reenabling all passive effects 4")
    call SaveInteger(hashtable019,Cache,100,4)
  endif
  call FixPassiveSkills_RemoveMorphedAbilities(Hero)
  call FixPassiveSkills_RemoveAllPassiveEx(Hero,Hero,false)
  set i=1
  loop
    exitwhen i>4+NumberOfExtraAbilities
    set PassiveId=PlayerPassiveSkill[PlayerId*PlayerSkillOffset+i]
    if PassiveId!=-1 then
      set Level=GetUnitAbilityLevel(Hero,PassiveReferenceId[PassiveId])
      //call BJDebugMsg(GetObjectName(PassiveReferenceId[PassiveId])+" found level "+I2S(Level))
      if Level>0 and GetUnitAbilityLevel(Hero,PassiveHiddenAbilityId[PassiveId])!=Level then
        //call BJDebugMsg("found difference: "+GetObjectName(PassiveReferenceId[PassiveId])+", currently "+I2S(Level)+", effect is level: "+I2S(GetUnitAbilityLevel(Hero,PassiveHiddenAbilityId[PassiveId])))
        call UnitAddAbility2(Hero,PassiveHiddenSpellBookId[PassiveId])
        call SetUnitAbilityLevel(Hero,PassiveHiddenAbilityId[PassiveId],Level)
        call UnitMakeAbilityPermanent(Hero,true,PassiveHiddenAbilityId[PassiveId])
        //call BJDebugMsg("adding ability/changing level, now level: "+I2S(GetUnitAbilityLevel(Hero,PassiveHiddenAbilityId[PassiveId])))
      endif
      //call BJDebugMsg(Id2String(PassiveHiddenAbilityId[PassiveId])+" now level "+I2S(GetUnitAbilityLevel(Hero,PassiveHiddenAbilityId[PassiveId])))
    endif
    set i=i+1
  endloop
  set Hero=null
  set t=null
  return false
endfunction

function FixPassiveSkills_ReincarnationFix takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=LoadUnitHandle(hashtable019,Cache,2)
  local integer ShouldHideSomeMore=LoadInteger(hashtable019,Cache,100)
  if Hero==null then
    //call BJDebugMsg("ded")
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,Cache)
    set Hero=null
    set t=null
    return false
  endif
  if GetTriggerEventId()==EVENT_WIDGET_DEATH then
    
    if FindItemOfType(Hero,Item_Real[indexid_Aegis])!=null then
      call TriggerRegisterTimerEvent(t,5.1,false) //Aegis
      call SaveInteger(hashtable019,Cache,100,1)
      call FixVisionGlitchOnBuyBach(Hero)
    elseif GetUnitState(Hero,UNIT_STATE_MANA)>=140 and GetUnitAbilityLevel(Hero,'A01Y')>0 and ((TimerGetRemaining(PrimaryUltiCooldownTimer[GetPlayerId(GetOwningPlayer(Hero))])==0 and SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Hero))*PlayerSkillOffset+4]]=='A01Y') or TimerGetRemaining(SecondaryUltiCooldownTimer[GetPlayerId(GetOwningPlayer(Hero))])==0) then
      call TriggerRegisterTimerEvent(t,3.1,false) //Leoric Reincarnation
      call SaveInteger(hashtable019,Cache,100,1)
      call FixVisionGlitchOnBuyBach(Hero)
    else
      call TriggerRegisterTimerEvent(t,101,false) //check for null
    endif
  else
    if ShouldHideSomeMore==1 then
      call SaveInteger(hashtable019,Cache,100,2)
      call SaveInteger(hashtable019,GetHandleId(LoadTriggerHandle(hashtable019,GetHandleId(Hero),'0PAS')),100,1)
      call TriggerEvaluate(LoadTriggerHandle(hashtable019,GetHandleId(Hero),'0PAS'))
    endif
    call RemoveAbilsForUnit(Hero)
  endif
  set Hero=null
  set t=null
  return false
endfunction

function FixPassiveSkills_FixHero takes nothing returns boolean
  local unit Hero=GetTriggerUnit()
  local integer PlayerId=GetPlayerId(GetOwningPlayer(Hero))
  local trigger t
  local integer Cache
  if (IsUnitType(Hero,UNIT_TYPE_HERO)==false or GetUnitTypeId(Hero)=='H00M' or GetUnitTypeId(Hero)=='H00Y' or GetUnitTypeId(Hero)=='H07G' or GetUnitTypeId(Hero)=='H0B8') or b_isPickTime then
    set Hero=null
    return false
  endif
  call FixPassiveSkills_DisableAbilitiesForPlayer(PlayerId)
  set t=CreateTrigger()
  call SaveTriggerHandle(hashtable019,GetHandleId(Hero),'0PAS',t)
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.5,true)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_HERO_SKILL)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_SPELL_EFFECT) //metamorphosis \(o_o)/
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_SPELL_FINISH) //metamorphosis \(o_o)/
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_HERO_REVIVE_START)
  call TriggerAddCondition(t,Condition(function FixPassiveSkills_LevelHiddenSkills))
  call SaveUnitHandle(hashtable019,Cache,2,Hero)
  call SaveInteger(hashtable019,Cache,100,1)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterDeathEvent(t,Hero)
  call TriggerAddCondition(t,Condition(function FixPassiveSkills_ReincarnationFix))
  call SaveUnitHandle(hashtable019,Cache,2,Hero)
  call SaveInteger(hashtable019,Cache,100,2)
  //	set t=CreateTrigger()
  //	call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_HERO_SKILL)
  //	call TriggerAddCondition(t,Condition(function GeneralLearnC))
  set Hero=null
  set t=null
  return false
endfunction



function Fix_EnteringHeroes takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local unit rHero=u
  local player p=GetOwningPlayer(u)
  local integer i=1
  local integer lvl=0
  local trigger t
  if (IsUnitType(u,UNIT_TYPE_HERO)==false or GetUnitTypeId(u)=='H00M' or GetUnitTypeId(u)=='H00Y' or GetUnitTypeId(u)=='H07G' or GetUnitTypeId(u)=='H0B8') or b_isPickTime then
    if IsUnitIllusion(u)==false then
      set u=null
      set rHero=null
      return
    endif
  endif
  if IsUnitIllusion(u) then
    set rHero=udg_Hero[GetPlayerId(p)]
  else
    set t=CreateTrigger()
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_HERO_SKILL)
    call TriggerAddCondition(t,Condition(function GeneralLearnC))
    set t=CreateTrigger()
    //call TriggerRegisterTimerEvent(t,0.02,true)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_SPELL_EFFECT)
    call TriggerAddCondition(t,Condition(function Wait0SecPlz))
    call SaveUnitHandle(hashtable019,GetHandleId(t),0,u)
  endif
  loop
    set lvl=GetUnitAbilityLevel(rHero,PassivesLearningSkill[i])
    if lvl==0 then
      set lvl=GetUnitAbilityLevel(rHero,PassivesLearningSkillUpg[i])
    endif
    if lvl==0 then
      call UnitRemoveAbility(u,PassivesSpellbookID[i])
      call UnitRemoveAbility(u,PassivesBuffID[i])
    endif
    set i=i+1
    exitwhen i>PassivesCount
  endloop
  
  
  
  set u=null
  set rHero=null
  set t=null
endfunction

function FixPassiveSkills takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterEnterRectSimple(t,GetWorldBounds())
  call TriggerAddCondition(t,Condition(function FixPassiveSkills_FixHero))
  call TriggerAddCondition(t,Condition(function Fix_EnteringHeroes))
  
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function FixPassiveSkills_LevelIllusions))
  call ExeFunc("FixPassiveSkills_Init")
  call ExeFunc("StoreAllPassives")
  
  set t=null
endfunction

function BLD takes string Y9D returns boolean
  if Y9D=="-ma"or Y9D=="-ms"or Y9D=="-cs"or Y9D=="-cson"or Y9D=="-disablehelp"or Y9D=="-enablehelp"or Y9D=="-unstuck"or Y9D=="-recreate"then
    return true
  elseif Y9D=="-swaphero"or Y9D=="-showmsg"or Y9D=="-hidemsg"or Y9D=="-showdeny"or Y9D=="-hidedeny"or Y9D=="-weather rain"or Y9D=="-weather snow"or Y9D=="-weather moonlight"or Y9D=="-weather wind"or Y9D=="-weather random"or Y9D=="-weather off"or Y9D=="-denyinfo"or Y9D=="-di"or Y9D=="-deathon"or Y9D=="-don"or Y9D=="-deathoff"or Y9D=="-doff"or Y9D=="-roll"or Y9D=="-hideheronames"or Y9D=="-hhn"or Y9D=="-test"or Y9D=="-mute"or Y9D=="-wtf"or Y9D=="-fleshstr"or Y9D=="-fs"or Y9D=="-switchon"then
    return true
  endif
  return false
endfunction

function B1D takes nothing returns boolean
  return not IsHeroesAvailable
endfunction

function B0D takes string B5D returns nothing
  if FullModesString==""then
    set FullModesString="|c006699CC"+B5D+"|r"
  else
    set FullModesString=FullModesString+"/|c006699CC"+B5D+"|r"
  endif
endfunction

function B2D takes string s returns nothing
  if FullModesString=="" then
    set FullModesString="|c00C83264"+s+"|r"
  else
    set FullModesString=FullModesString+"/|c00C83264"+s+"|r"
  endif
endfunction

function C4D takes string C7D,integer C8D,integer C9D returns string
  return SubString(C7D,0,C8D)+SubString(C7D,C9D,StringLength(C7D))
endfunction

function CDD takes string C7D returns string
  return StringCase(SubString(C7D,1,StringLength(C7D)),false)
endfunction

function AddFormlessBack takes integer id returns nothing
  call SetPlayerTechMaxAllowed(Sentinels[1],id,999)
  call SetPlayerTechMaxAllowed(Sentinels[2],id,999)
  call SetPlayerTechMaxAllowed(Sentinels[3],id,999)
  call SetPlayerTechMaxAllowed(Sentinels[4],id,999)
  call SetPlayerTechMaxAllowed(Sentinels[5],id,999)
  call SetPlayerTechMaxAllowed(Scourges[1],id,999)
  call SetPlayerTechMaxAllowed(Scourges[2],id,999)
  call SetPlayerTechMaxAllowed(Scourges[3],id,999)
  call SetPlayerTechMaxAllowed(Scourges[4],id,999)
  call SetPlayerTechMaxAllowed(Scourges[5],id,999)
endfunction

function blablablawork takes nothing returns nothing
  //call UFD()
  
endfunction 

function blablabla takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,2,false)
  call TriggerAddCondition(t,Condition(function blablablawork))
  set t=null
endfunction

function HideFunHeroes takes nothing returns nothing
  call TechHeroForAll(HeroID[117])
  
endfunction

function CED takes string CFD,integer A5D returns nothing
  local string VHD=CDD(CFD)
  local string array CGD
  local string array CHD
  local string array GameModeString
  local boolean array CID
  local integer CJD
  local integer F69=StringLength(VHD)
  local integer x=0
  local integer y=0
  local integer z=0
  local trigger t
  local boolean AP
  local boolean AR
  local boolean LM
  local boolean MM
  local boolean TR
  local boolean DM
  local boolean MR
  local boolean SP
  local boolean AA
  local boolean AI
  local boolean AS
  local boolean ID
  local boolean NP
  local boolean SC
  local boolean EM
  local boolean DU
  local boolean SH
  local boolean VR
  local boolean RV
  local boolean RD
  local boolean OM
  local boolean NT
  local boolean NB
  local boolean NM
  local boolean NS
  local boolean SO
  local boolean NR
  local boolean XL
  local boolean SD
  local boolean PM
  local boolean OI
  local boolean MI
  local boolean CM
  local boolean FR
  local boolean MO
  local boolean RO
  local boolean ER
  local boolean CD
  local boolean RS
  local boolean CP
  local boolean ZM
  local boolean UB
  local boolean UL
  local boolean SS
  local boolean AB
  local boolean S5
  local boolean S6
  local boolean FN
  local boolean D2
  local boolean D3
  local boolean D4
  local boolean D5
  local boolean OS
  local boolean BO
  local boolean MD
  local boolean RA
  local boolean LS
  local boolean LS3
  local boolean string041
  local boolean FUNHERO
  local boolean EBa
  local boolean MassAgh
  set ModeForTitle=VHD
  set CGD[1]="allpick"
  set CHD[1]="ap"
  set CGD[2]="allrandom"
  set CHD[2]="ar"
  set CGD[3]="leaguemode"
  set CHD[3]="lm"
  set CGD[4]="mirrormatch"
  set CHD[4]="mm"
  set CGD[5]="teamrandom"
  set CHD[5]="tr"
  set CGD[6]="deathmatch"
  set CHD[6]="dm"
  set CGD[7]="moderandom"
  set CHD[7]="mr"
  set CGD[8]="shuffleplayers"
  set CHD[8]="sp"
  set CGD[9]="allagility"
  set CHD[9]="aa"
  set CGD[10]="allintelligence"
  set CHD[10]="ai"
  set CGD[11]="allstrength"
  set CHD[11]="as"
  set CGD[12]="itemdrop"
  set CHD[12]="id"
  set CGD[13]="nopowerups"
  set CHD[13]="np"
  set CGD[14]="supercreeps"
  set CHD[14]="sc"
  set CGD[15]="easymode"
  set CHD[15]="em"
  set CGD[16]="duplicatemode"
  set CHD[16]="du"
  set CGD[17]="samehero"
  set CHD[17]="sh"
  set CGD[18]="voterandom"
  set CHD[18]="vr"
  set CGD[19]="reverse"
  set CHD[19]="rv"
  set CGD[20]="randomdraft"
  set CHD[20]="rd"
  set CGD[21]="onlymid"
  set CHD[21]="om"
  set CGD[22]="extendedleague"
  set CHD[22]="xl"
  set CGD[23]="nomid"
  set CHD[23]="nm"
  set CGD[24]="notop"
  set CHD[24]="nt"
  set CGD[25]="nobot"
  set CHD[25]="nb"
  set CGD[26]="noswap"
  set CHD[26]="ns"
  set CGD[27]="norepick"
  set CHD[27]="nr"
  set CGD[28]="captainsdraft"
  set CHD[28]="cd"
  set CGD[29]="singledraft"
  set CHD[29]="sd"
  set CGD[30]="poolingmode"
  set CHD[30]="pm"
  set CGD[31]="observerinfo"
  set CHD[31]="oi"
  set CGD[32]="miniheroes"
  set CHD[32]="mi"
  set CGD[33]="captainsmode"
  set CHD[33]="cm"
  set CGD[34]="fastrespawn"
  set CHD[34]="fr"
  set CGD[35]="meleeonly"
  set CHD[35]="mo"
  set CGD[36]="rangeonly"
  set CHD[36]="ro"
  set CGD[37]="experimentalrunes"
  set CHD[37]="er"
  set CGD[38]="randomside"
  set CHD[38]="rs"
  set CGD[39]="switchon"
  set CHD[39]="so"
  set CGD[40]="zoommode"
  set CHD[40]="zm"
  set CGD[41]="capturepoint"
  set CHD[41]="cp"
  set CGD[42]="unban"
  set CHD[42]="ub"
  set CGD[43]="unlimitedlevel"
  set CHD[43]="ul"
  set CGD[44]="seeskills"
  set CHD[44]="ss"
  set CGD[45]="antibackdoor"
  set CHD[45]="ab"
  set CGD[46]="fiveskills"
  set CHD[46]="s5"
  set CGD[47]="sixskills"
  set CHD[47]="s6"
  set CGD[48]="fastneutrals"
  set CHD[48]="fn"
  set CGD[49]="draft20"
  set CHD[49]="d2"
  set CGD[50]="draft30"
  set CHD[50]="d3"
  set CGD[51]="draft40"
  set CHD[51]="d4"
  set CGD[52]="draft50"
  set CHD[52]="d5"
  set CGD[53]="oneskill"
  set CHD[53]="os"
  set CGD[54]="balanceoff"
  set CHD[54]="bo"
  set CGD[55]="mirrordraft"
  set CHD[55]="md"
  set CGD[56]="randomabilities"
  set CHD[56]="ra"
  set CGD[57]="3limitskills"
  set CHD[57]="3ls"
  set CGD[58]="limitskills"
  set CHD[58]="ls"
  set CGD[59]="ff"
  set CHD[59]="ff"
  set CGD[60]="eb"
  set CHD[60]="eb"
  set CGD[61]="funhero"
  set CHD[61]="fh"
  set CGD[62]="massaghanims"
  set CHD[62]="ma"
  
  set CJD=62
  
  set x=-1
  loop
    exitwhen x==F69-1
    set x=x+1
    set y=x
    loop
      exitwhen y==F69
      set y=y+1
      set z=1
      loop
        exitwhen z>CJD
        if CHD[z]==SubString(VHD,x,y)then
          set CID[z]=true
          set z=CJD+1
          set VHD=C4D(VHD,x,y)
          set x=-1
          set F69=StringLength(VHD)
          set y=F69
        else
          set z=z+1
        endif
      endloop
    endloop
  endloop
  set AP=CID[1]
  set AR=CID[2]
  set LM=CID[3]
  set MM=CID[4]
  set TR=CID[5]
  set DM=CID[6]
  set MR=CID[7]
  set SP=CID[8]
  set AA=CID[9]
  set AI=CID[10]
  set AS=CID[11]
  set ID=CID[12]
  set NP=CID[13]
  set SC=CID[14]
  set EM=CID[15]
  set DU=CID[16]
  set SH=CID[17]
  set VR=CID[18]
  set RV=CID[19]
  set RD=CID[20]
  set OM=CID[21]
  set XL=CID[22]
  set NM=CID[23]
  set NT=CID[24]
  set NB=CID[25]
  set NS=CID[26]
  set NR=CID[27]
  set CD=CID[28]
  set SD=CID[29]
  set PM=CID[30]
  set OI=CID[31]
  set MI=CID[32]
  set CM=CID[33]
  set FR=CID[34]
  set MO=CID[35]
  set RO=CID[36]
  set ER=CID[37]
  set RS=CID[38]
  set SO=CID[39]
  set ZM=CID[40]
  set CP=CID[41]
  set UB=CID[42]
  set UL=CID[43]
  set SS=CID[44]
  set AB=CID[45]
  set S5=CID[46]
  set S6=CID[47]
  set FN=CID[48]
  set D2=CID[49]
  set D3=CID[50]
  set D4=CID[51]
  set D5=CID[52]
  set OS=CID[53]
  set BO=CID[54]
  set MD=CID[55]
  set RA=CID[56]
  set LS3=CID[57]
  set LS=CID[58]
  set string041=CID[59]
  set EBa=CID[60]
  set FUNHERO=CID[61]
  set MassAgh=CID[62]
  if VHD!=""or BLD(CFD)then
    return
  endif
  if LS3 and LS then
    call Error(PlayerModeTyper,GetObjectName('n02U'))
    return
  endif
  if FUNHERO then
    set b_isHeroPicked[117]=false
    set IsHeroIngame[117]=false
    set NumberOfHeroes=NumberOfHeroes+FunHeroesTotal
  else
    call TechHeroForAll(HeroID[117])
    set IsHeroIngame[117]=true
    set b_isHeroPicked[117]=true
  endif
  if(AR and(CM or AP or TR or LM or MR or RV or RD or CD or SD or MD))or(AP and(TR or MR))or(TR and(LM or MR))or(LM and MR)or(MM and SH)then
    call Error(PlayerModeTyper,GetObjectName('n02U'))
    return
  endif
  if(AA and(AI or AS or DM))or(AS and(AI or DM))or(AI and DM)then
    call Error(PlayerModeTyper,GetObjectName('n02U'))
    return
  endif
  if(RO and(MO or DM))or(MO and DM)then
    call Error(PlayerModeTyper,GetObjectName('n02U'))
    return
  endif
  if RV and(CM or AR or TR or MR or LM or DM or SH)then
    call Error(PlayerModeTyper,GetObjectName('n02U'))
    return
  endif
  if(DM and(CM or TR or LM or MR or SH or RV or RD or CD or SD or MD))or(MM and DM)or(SH and DM)then
    call Error(PlayerModeTyper,GetObjectName('n02T'))
    return
  endif
  if LM and(CM or AP or RD or CD or AR or SD or MD or MM or TR or DM or MR or AA or AI or AS or ID or NP or SC or EM or DU or SH or RV or OM or NB or NM or NT or XL or MO or RO)then
    call Error(PlayerModeTyper,GetObjectName('n031'))
    return
  endif
  if XL and(CM or AP or RD or CD or AR or SD or MD or MM or TR or DM or MR or AA or AI or AS or ID or NP or SC or EM or DU or SH or RV or OM or NB or NM or NT or LM or RO or MO)then
    call Error(PlayerModeTyper,GetObjectName('n032'))
    return
  endif
  if CM and(SP or XL or AP or RD or CD or AR or SD or MD or MM or TR or DM or MR or AA or AI or AS or ID or NP or SC or EM or DU or SH or RV or OM or NB or NM or NT or LM or MO or RO)then
    call Error(PlayerModeTyper,GetObjectName('n032'))
    return
  endif
  if RD and(CD or CM or AP or LM or AR or SD or MD or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
    call Error(PlayerModeTyper,GetObjectName('n02U'))
    return
  endif
  if CD and(RD or CM or AP or LM or AR or SD or MD or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
    call Error(PlayerModeTyper,GetObjectName('n02U'))
    return
  endif
  if MR and(CM or AP or LM or AR or SD or MD or MM or TR or DM or AA or AI or AS or SH or RV or RO or MO)then
    call Error(PlayerModeTyper,GetObjectName('n02U'))
    return
  endif
  if SD and(CM or AP or LM or AR or RD or CD or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO or MD)then
    call Error(PlayerModeTyper,GetObjectName('n02U'))
    return
  endif
  if VR and(CM or LM or RD or CD or SD or MD or AR or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
    call Error(PlayerModeTyper,GetObjectName('n02U'))
    return
  endif
  if MM and CountPlayersInForce(Force_SentPlayers)!=CountPlayersInForce(Force_ScourgePlayers)then
    call Error(PlayerModeTyper,GetObjectName('n034'))
    return
  endif
  if VR and CountPlayersInForce(Force_SentPlayers)!=CountPlayersInForce(Force_ScourgePlayers)then
    call Error(PlayerModeTyper,GetObjectName('n034'))
    return
  endif
  if RV and CountPlayersInForce(Force_SentPlayers)!=CountPlayersInForce(Force_ScourgePlayers)then
    call Error(PlayerModeTyper,GetObjectName('n034'))
    return
  endif
  if S5 and S6 then
    call Error(PlayerModeTyper,"Modes <s5> and <s6> do not stack.")
    return
  endif
  if RA and not(S5 or S6)then
    call Error(PlayerModeTyper,"Mode <ra> only works with modes <s5> and <s6>.")
    return
  endif
  if RA and not(AP or SD or MD)then
    call Error(PlayerModeTyper,"Mode <ra> only works with modes <sd>, <ap> and <md>.")
    return
  endif
  if(D2 and(D3 or D4 or D5))or(D3 and(D2 or D4 or D5))or(D4 and(D2 or D3 or D5))or(D5 and(D2 or D3 or D4))then
    call Error(PlayerModeTyper,"Modes <d#> do not stack.")
    return
  endif
  if not(SD or MD)and(D2 or D3 or D4 or D5)then
    call Error(PlayerModeTyper,"Modes <d#> only work with modes <sd> and <md>.")
    return
  endif
  if not(AP or SD or MD)and SS then
    call Error(PlayerModeTyper,"Modes <ss> only work with modes <sd>, <ap> and <md>.")
    return
  endif
  if not(AP or SD or MD)and SP then
    call Error(PlayerModeTyper,"Mode -sp only work with modes <sd>, <ap> and <md>.")
    return
  endif
  if LM and not(IsPlayer(Sentinels[1])and IsPlayer(Sentinels[2])and IsPlayer(Sentinels[3])and IsPlayer(Sentinels[4])and IsPlayer(Sentinels[5])and IsPlayer(Scourges[1])and IsPlayer(Scourges[2])and IsPlayer(Scourges[3])and IsPlayer(Scourges[4])and IsPlayer(Scourges[5]))then
  endif
  if XL and not(IsPlayer(Sentinels[1])and IsPlayer(Sentinels[2])and IsPlayer(Sentinels[3])and IsPlayer(Sentinels[4])and IsPlayer(Sentinels[5])and IsPlayer(Scourges[1])and IsPlayer(Scourges[2])and IsPlayer(Scourges[3])and IsPlayer(Scourges[4])and IsPlayer(Scourges[5]))then
  endif
  if ZM or CP or FR or CM or AP or AR or LM or MM or TR or DM or MR or SP or AA or AI or AS or ID or NP or SC or DU or EM or SH or VR or RV or RD or CD or OM or NB or NM or NT or NS or NR or XL or SD or MD or PM or OI or MI or MO or RO or ER or RS or SO then
    call DisableTrigger(AR7)
  else
    return
  endif
  if CM==false then
    call Trig_display_leaderboard_Actions()
    call CreateObsBoard()
  endif
  if LM==false and XL==false then
    call ZHD()
  endif
  set integers009=CDD(CFD)
  if AQ7 then
    call Traffic_RegisterData("Mode"+integers009,0)
  else
    call Traffic_RegisterData("Mode"+integers009,GetPlayerId(PlayerModeTyper))
  endif
  set Mode_Normal=false
  if LM then
    set MainModeInTxt=GetObjectName('n0HZ')
  elseif XL then
    set MainModeInTxt=GetObjectName('n0I8')
  elseif RD then
    set MainModeInTxt=GetObjectName('n0IN')
  elseif CD then
    set MainModeInTxt=GetObjectName('n0I9')
  elseif MM then
    set MainModeInTxt=GetObjectName('n0IH')
  elseif DM then
    set MainModeInTxt=GetObjectName('n0II')
  elseif RV then
    set MainModeInTxt=GetObjectName('n0IC')
  elseif AP then
    set MainModeInTxt=GetObjectName('n0ID')
  elseif AR then
    set MainModeInTxt=GetObjectName('n0I7')
  elseif TR then
    set MainModeInTxt=GetObjectName('n0I6')
  elseif MR then
    set MainModeInTxt=GetObjectName('n0IJ')
  elseif VR then
    set MainModeInTxt=GetObjectName('n0I5')
  elseif SD then
    set MainModeInTxt=GetObjectName('n0I4')
  elseif MD then
    set MainModeInTxt="Mirrordraft"
    call HideFunHeroes()
  elseif CM then
    set MainModeInTxt=GetObjectName('n0IG')
  endif
  if MD then
    set Mode_MD=true
    call B2D("Mirror Draft")
  endif
  if CM then
    call B0D(GetObjectName('n0IK'))
  endif
  if LM then
    call B0D(GetObjectName('n0I3'))
  endif
  if XL then
    call B0D(GetObjectName('n0I2'))
  endif
  if RD then
    call B0D(GetObjectName('n0IF'))
  endif
  if CD then
    call B0D(GetObjectName('n0I1'))
  endif
  if DM then
    call B0D(GetObjectName('n0IA'))
  endif
  if MM then
    call B0D(GetObjectName('n0I0'))
  endif
  if AP then
    call B0D(GetObjectName('n0IL'))
  endif
  if AR then
    call RollSpellsForInvokerSD()
    call B0D(GetObjectName('n0IQ'))
  endif
  if VR then
    call B0D(GetObjectName('n0IM'))
  endif
  if MR then
    call B0D(GetObjectName('n0IE'))
  endif
  if TR then
    call B0D(GetObjectName('n0IB'))
  endif
  if SP then
    call B0D(GetObjectName('n0IO'))
  endif
  if AA then
    call B0D(GetObjectName('n0IU'))
  endif
  if AS then
    call B0D(GetObjectName('n0IP'))
  endif
  if AI then
    call B0D(GetObjectName('n0IS'))
  endif
  if RO then
    call B0D(GetObjectName('n0IT'))
  endif
  if MO then
    call B0D(GetObjectName('n032'))
  endif
  if DU then
    call B0D(GetObjectName('n0IX'))
  endif
  if ID then
    call B0D(GetObjectName('n0IZ'))
  endif
  if NP then
    call B0D(GetObjectName('n0J6'))
  endif
  if SC then
    call B0D(GetObjectName('n0J7'))
  endif
  if EM then
    call B0D(GetObjectName('n0J9'))
  endif
  if SH then
    call B0D(GetObjectName('n0JA'))
  endif
  if RV then
    call B0D(GetObjectName('n0IW'))
  endif
  if OM then
    call B0D(GetObjectName('n0IV'))
  endif
  if NM then
    call B0D(GetObjectName('n0IR'))
  endif
  if NB then
    call B0D(GetObjectName('n0JB'))
  endif
  if NT then
    call B0D(GetObjectName('n0J8'))
  endif
  if NS then
    call B0D(GetObjectName('n0JC'))
  endif
  if NR then
    call B0D(GetObjectName('n0JF'))
  endif
  if SD then
    call B0D(GetObjectName('n0J0'))
    call HideFunHeroes()
    set Mode_SD=true
  endif
  if PM then
    call B0D(GetObjectName('n0IY'))
  endif
  if OI then
    call B0D(GetObjectName('n0J5'))
  endif
  if MI then
    call B0D(GetObjectName('n0J4'))
  endif
  if FR then
    call B0D(GetObjectName('n0JD'))
  endif
  if ER then
    call B0D(GetObjectName('n0JE'))
  endif
  if RS then
    call B0D(GetObjectName('n0J1'))
  endif
  if SO then
    call B0D(GetObjectName('n0J2'))
  endif
  if ZM then
    call B0D(GetObjectName('n0KA'))
  endif
  if CP then
    call B0D(GetObjectName('n0KC'))
  endif
  if UB then
    call B0D(GetObjectName('n0L2'))
  endif
  if D2 then
    call B2D("Draft 20")
    set Mode_D2=true
    set i_BonusDraftAmount=10
  endif
  if D3 then
    call B2D("Draft 30")
    set Mode_D3=true
    set i_BonusDraftAmount=20
  endif
  if D4 then
    call B2D("Draft 40")
    set Mode_D4=true
    set i_BonusDraftAmount=30
  endif
  if D5 then
    call B2D("Draft 50")
    set Mode_D5=true
    set i_BonusDraftAmount=40
  endif
  if EBa then
    call B2D("Extended Balance")
    set Mode_EB=true
    
  endif
  if S5 then
    call B2D("Five Skills")
    set NumberOfExtraAbilities=1
    set Mode_S5=true
    call UnitAddAbility(ScourgeFountain,'ACrk')
    call UnitAddAbility(SentFountain,'ACrk')
    call UnitAddAbility(ScourgeFountain,'A1BY')
    call UnitAddAbility(SentFountain,'A1BY')
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30," ")
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30,"|c0066FF66"+"ATTENTION: FIFTH SKILL IS ADDED AT LEVEL: <5>, <8>, <11>, <14>"+"|r")
  endif
  if S6 then
    call B2D("Six Skills")
    set NumberOfExtraAbilities=2
    call Trig_display_leaderboard_Actions()
    set Mode_S6=true
    call UnitAddAbility(ScourgeFountain,'ACrk')
    call UnitAddAbility(SentFountain,'ACrk')
    call UnitAddAbility(ScourgeFountain,'A1BY')
    call UnitAddAbility(SentFountain,'A1BY')
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30," ")
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30,"|c0066FF66"+"ATTENTION: FIFTH SKILL IS ADDED AT LEVEL: <5>, <8>, <11>, <14>"+"|r")
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30,"|c0066FF66"+"ATTENTION: SIXTH SKILL IS ADDED AT LEVEL: <8>, <13>, <18>"+"|r")
    call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30," ")
    if Mode_BO==false and Mode_MA==false then
      call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30,"|c00FF0000"+"WARNING: AGHANIM'S SCEPTER ONLY WORKS WITH YOUR FIRST ULT (4>6)"+"|r")
    else
      call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,30,"|c00FF0000"+"Note: Aghanim's Scepter upgrade both ultimates you have"+"|r")
    endif
  endif
  if string041 then
    call B2D("Fast Finish")
    set Mode_FF=true
  endif
  if OS then
    call B2D("One Skill")
    set Mode_OS=true
  endif
  if RA then
    call B2D("Random Extra Abilities")
    set Mode_RA=true
  endif
  if BO then
    call B2D("Balance Off")
    set Mode_BO=true
  endif
  if UL then
    call B2D("Unlimited Level")
    set MaximumLevel=2048
    set Mode_UL=true
  endif
  if SS then
    call B2D("See Skills")
    set Mode_SS=true
  endif
  if AB then
    call TriggerRegisterTimerEvent(BDRegen,0.02,true)
    call B2D("Anti Backdoor")
    set Mode_AB=true
  endif
  if FN then
    call B2D("Fast Neutrals")
    set Mode_FN=true
  endif
  if LS then
    call B2D("Limit Skills")
    set Mode_LS=true
  endif
  if FUNHERO then
    call B0D("Fun heroes")
  endif
  if MassAgh then
    call B2D("Mass Aghanims")
    set Mode_MA=true
  endif
  if LS3 then
    call B2D("Limit Skills (3)")
    set Mode_LS=true
    set Mode_LS3=true
  endif
  if LS or LS3 then
    call BanStunsFomComboing()
  endif
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.," ")
  if A5D==1 then
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,udg_Colors[GetPlayerId(PlayerModeTyper)]+(IL7[GetPlayerId((PlayerModeTyper))])+"|r"+" has selected "+FullModesString)
  else
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,"Game mode automatically set to "+FullModesString)
  endif
  //call blablabla()
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,"For more information about the game modes use -gameinfo.")
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.," ")
  call ExecuteFunc("SZ8")
  call RunIfTrue("CZD",SP)
  call RunIfTrue("CAD",RS)
  call RunIfTrue("CBD",UB)
  call RunIfTrue("CCD",DM)
  call RunIfTrue("C3D",MM)
  call RunIfTrue("C6D",SH)
  call RunIfTrue("CLD",AA)
  call RunIfTrue("C1D",AI)
  call RunIfTrue("C0D",AS)
  call RunIfTrue("C5D",RO)
  call RunIfTrue("C2D",MO)
  call RunIfTrue("L4D",DU)
  call RunIfTrue("L7D",AR)
  call RunIfTrue("L8D",VR)
  call RunIfTrue("L9D",AP)
  call RunIfTrue("LDD",TR)
  call RunIfTrue("LED",RV)
  call RunIfTrue("LFD",LM)
  call RunIfTrue("LGD",XL)
  call RunIfTrue("ModeCM",CM)
  call RunIfTrue("LID",RD)
  call RunIfTrue("LJD",SD)
  call RunIfTrue("LKD",MR)
  call RunIfTrue("LMD",ID)
  call RunIfTrue("LND",NP)
  call RunIfTrue("InitSuperCreepsMode",SC)
  call RunIfTrue("LPD",EM)
  call RunIfTrue("LQD",OM)
  call RunIfTrue("LRD",NB)
  call RunIfTrue("LSD",NT)
  call RunIfTrue("LTD",NM)
  call RunIfTrue("LUD",SO)
  call RunIfTrue("LVD",NS)
  call RunIfTrue("LWD",NR)
  call RunIfTrue("LXD",PM)
  call RunIfTrue("LYD",OI)
  call RunIfTrue("LZD",MI)
  call RunIfTrue("LAD",FR)
  call RunIfTrue("LBD",ER)
  call RunIfTrue("LCD",CD)
  call RunIfTrue("L3D",ZM)
  call RunIfTrue("L6D",CP)
  call ExeFunc("FixPassiveSkills")
  call ExeFunc("StoreAghaUpgrades")
  call ExeFunc("B6D")
  set SK=true
  call L98(0,0,false)
  if Mode_CM==false and Mode_CD==false then
    call ModePicked()
  endif
  if SO==false then
    set HeroHasBeenUnlocked[0]=true
    set HeroHasBeenUnlocked[1]=true
    set HeroHasBeenUnlocked[2]=true
    set HeroHasBeenUnlocked[3]=true
    set HeroHasBeenUnlocked[4]=true
    set HeroHasBeenUnlocked[5]=true
    set HeroHasBeenUnlocked[6]=true
    set HeroHasBeenUnlocked[7]=true
    set HeroHasBeenUnlocked[8]=true
    set HeroHasBeenUnlocked[9]=true
    set HeroHasBeenUnlocked[10]=true
    set HeroHasBeenUnlocked[11]=true
    set HeroHasBeenUnlocked[12]=true
    set HeroHasBeenUnlocked[13]=true
    set HeroHasBeenUnlocked[14]=true
    set HeroHasBeenUnlocked[15]=true
    set HeroHasBeenUnlocked[16]=true
  endif
  set t=null
endfunction

function LLD takes nothing returns nothing
  call CED(GetEventPlayerChatString(),1)
endfunction


function ActionSelect takes nothing returns nothing
  local player p=GetTriggerPlayer()
  local unit u=GetTriggerUnit()
  local group g
  if u==ShowPickUnit  then
    call BJDebugMsg("select")
    set g=GetAvailableGroup()
    call GroupEnumUnitsSelected(g,p,null)
    if IsUnitInGroup(u,g) then
      call BJDebugMsg("still in seletion")
      set amhCounter[GetPlayerId(p)]=amhCounter[GetPlayerId(p)]+1
      if amhCounter[GetPlayerId(p)]>10 and amhCounter[GetPlayerId(p)]<13 then
        call BJDebugMsg("|c00ff0000Player "+GetPlayerName(p)+" is maphacker|r")
      endif
    endif
    call KillGroup(g)
  endif
  set g=null
  set u=null
endfunction


function DetectMh takes nothing returns nothing
  
  set Intended=true
  call SelectUnit(ShowPickUnit, true)
  
  //call SelectUnit(ShowPickUnit, false)
endfunction

 
function AntiMH takes nothing returns nothing
  
  //	local integer i=0
  //	
  //	set ShowPickUnit=CreateUnit(Player(12), 'nfpc', GetRectMaxX(bj_mapInitialPlayableArea), GetRectMinY(bj_mapInitialPlayableArea), 0.00)
  //
  //	set TriggerEn1=CreateTrigger()
  //	loop
  //		exitwhen i > 12
  //		call TriggerRegisterPlayerUnitEvent(TriggerEn1, Player(i), EVENT_PLAYER_UNIT_SELECTED, null)
  //		set i=i + 1
  //	endloop
  //	call TriggerAddAction(TriggerEn1, function ActionSelect)
  //	set TimerMh=CreateTimer()
  //	call TimerStart(TimerMh, 1, true, function DetectMh)
  
  
  
endfunction

function L1D takes nothing returns boolean
  call AntiMH()
  if HCLstring=="rgc" then//rgc
    set HCLstring="sdzm3lsebfh"
  elseif HCLstring=="rgc2" then//rgc
    set HCLstring="sds5ebzmfh3ls"
  elseif HCLstring=="rgc3" then//rgc
    set HCLstring="sds6d2osebfh"
  elseif HCLstring=="chev1" then
    set HCLstring="sds6sofnulboabd3"
  elseif HCLstring=="chev2" then
    set HCLstring="ardms6sofnulboab"
  elseif HCLstring=="chev3" then
    set HCLstring="aps6fnulboabssosls"
  elseif HCLstring=="md" then
    set HCLstring="mds6d5ulabosfnzm"
  elseif HCLstring=="sd" then
    set HCLstring="sds6d5ulabosfnzm"
  elseif HCLstring=="ap" then
    set HCLstring="aps6ulabosfnzm"
  elseif HCLstring=="ar" then
    set HCLstring="ardms6omfrulabzm"
  endif
  if(HCLstring)!=""and SK==false then
    set AQ7=true
    call CED("-"+(HCLstring),2)
  else
    call TriggerRegisterPlayerChatEvent(AR7,PlayerModeTyper,"-",false)
  endif
  return false
endfunction

function E7E takes string S,real SizeX,real SizeY,real PosX,real PosY,real PosZ,boolean Show returns nothing
  set tt_image1=CreateImage(S,SizeX,SizeY,0,PosX-(SizeX/ 2),PosY-(SizeY/ 2),PosZ,0,0,0,2)
  call SetImageRenderAlways(tt_image1,true)
  call ShowImage(tt_image1,Show)
endfunction

function E8E takes integer boolean131,integer r,integer g,integer b,integer a,real x,real y,integer Cache returns nothing
  if StringLength(I2S(boolean131))>1 then
    //		if StringLength(I2S(E9E))>2 then
    //		call E7E("Fonts\\"+SubString(I2S(E9E),0,1)+".blp",90,90,x-20,y,0,true)
    //		call SetImageColor(tt_image1,r,g,b,a)
    //		call SaveImageHandle(HY,(Cache),(158),(tt_image1))
    //		call E7E("Fonts\\"+SubString(I2S(E9E),1,2)+".blp",90,90,x+20,y,0,true)
    //		call SetImageColor(tt_image1,r,g,b,a)
    //		call SaveImageHandle(HY,(Cache),(159),(tt_image1))
    //		call E7E("Fonts\\"+SubString(I2S(E9E),2,3)+".blp",90,90,x+60,y,0,true)
    //		call SetImageColor(tt_image1,r,g,b,a)
    //		call SaveImageHandle(HY,(Cache),(160),(tt_image1))
    //	   else
    call E7E("Fonts\\"+SubString(I2S(boolean131),0,1)+".blp",90,90,x-20,y,0,true)
    call SetImageColor(tt_image1,r,g,b,a)
    call SaveImageHandle(hashtable019,(Cache),(158),(tt_image1))
    call E7E("Fonts\\"+SubString(I2S(boolean131),1,2)+".blp",90,90,x+20,y,0,true)
    call SetImageColor(tt_image1,r,g,b,a)
    call SaveImageHandle(hashtable019,(Cache),(159),(tt_image1))
    //	   endif
  else
    call E7E("Fonts\\0.blp",90,90,x-20,y,0,true)
    call SetImageColor(tt_image1,r,g,b,a)
    call SaveImageHandle(hashtable019,(Cache),(158),(tt_image1))
    call E7E("Fonts\\"+SubString(I2S(boolean131),0,1)+".blp",90,90,x+20,y,0,true)
    call SetImageColor(tt_image1,r,g,b,a)
    call SaveImageHandle(hashtable019,(Cache),(159),(tt_image1))
  endif
endfunction


function L9D takes nothing returns nothing
  local location SpawnSent=GetRectCenter(gg_rct_Allpick_Sent)
  local location SpawnScourge=GetRectCenter(gg_rct_Allpick_Scourge)
  local integer x=1
  local trigger t
  local integer h
  set Mode_AP=true
  set CreepSpawnTime=120
  loop
    exitwhen x>5
    if IsPlayer(Sentinels[x])then
      call CreateUnitAtLoc(Sentinels[x],'n00C',SpawnScourge,bj_UNIT_FACING)
    endif
    if IsPlayer(Scourges[x])then
      call CreateUnitAtLoc(Scourges[x],'n00C',SpawnSent,bj_UNIT_FACING)
    endif
    set x=x+1
  endloop
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  set SpawnSent=null
  set SpawnScourge=null
  set t=null
endfunction

function CM_CreateImageEx takes string S,real SizeX,real SizeY,real PosX,real PosY,real PosZ,boolean Show,integer r,integer g,integer b returns image
  set tt_image1=CreateImage(S,SizeX,SizeY,0,PosX-(SizeX/ 2),PosY-(SizeY/ 2),PosZ,0,0,0,2)
  call SetImageRenderAlways(tt_image1,true)
  call ShowImage(tt_image1,Show)
  call SetImageColor(tt_image1,r,g,b,255)
  return tt_image1
endfunction

function ModeCM_KillImage takes image i returns nothing
  call ShowImage(i,false)
  call DestroyImage(i)
endfunction

function ModeCM_DisplayPhase takes integer Phase returns nothing
  local real x=RD_CenterX_Sent+40
  local real y=RD_CenterY_Sent-50
  local integer RGB_R_Ban=255
  local integer RGB_G_Ban=0
  local integer RGB_B_Ban=0
  local integer RGB_R_Pick=0
  local integer RGB_G_Pick=0
  local integer RGB_B_Pick=255
  local integer r
  local integer g
  local integer b
  if Phase==1 then
    set r=RGB_R_Ban
    set g=RGB_G_Ban
    set b=RGB_B_Ban
    set CM_Image1=CM_CreateImageEx("Fonts\\B.blp",90,90,x-40,y,0,true,r,g,b)
    set CM_Image2=CM_CreateImageEx("Fonts\\A.blp",90,90,x,y,0,true,r,g,b)
    set CM_Image3=CM_CreateImageEx("Fonts\\N.blp",90,90,x+50,y,0,true,r,g,b)
  elseif Phase==2 then
    set r=RGB_R_Pick
    set g=RGB_G_Pick
    set b=RGB_B_Pick
    call ModeCM_KillImage(CM_Image1)
    call ModeCM_KillImage(CM_Image2)
    call ModeCM_KillImage(CM_Image3)
    set CM_Image1=CM_CreateImageEx("Fonts\\P.blp",90,90,x-60,y,0,true,r,g,b)
    set CM_Image2=CM_CreateImageEx("Fonts\\I.blp",90,90,x-20,y,0,true,r,g,b)
    set CM_Image3=CM_CreateImageEx("Fonts\\C.blp",90,90,x,y,0,true,r,g,b)
    set CM_Image4=CM_CreateImageEx("Fonts\\K.blp",90,90,x+45,y,0,true,r,g,b)
  elseif Phase==3 then
    set r=RGB_R_Ban
    set g=RGB_G_Ban
    set b=RGB_B_Ban
    call ModeCM_KillImage(CM_Image1)
    call ModeCM_KillImage(CM_Image2)
    call ModeCM_KillImage(CM_Image3)
    call ModeCM_KillImage(CM_Image4)
    set CM_Image1=CM_CreateImageEx("Fonts\\B.blp",90,90,x-40,y,0,true,r,g,b)
    set CM_Image2=CM_CreateImageEx("Fonts\\A.blp",90,90,x,y,0,true,r,g,b)
    set CM_Image3=CM_CreateImageEx("Fonts\\N.blp",90,90,x+50,y,0,true,r,g,b)
  elseif Phase==4 then
    set r=RGB_R_Pick
    set g=RGB_G_Pick
    set b=RGB_B_Pick
    call ModeCM_KillImage(CM_Image1)
    call ModeCM_KillImage(CM_Image2)
    call ModeCM_KillImage(CM_Image3)
    set CM_Image1=CM_CreateImageEx("Fonts\\P.blp",90,90,x-60,y,0,true,r,g,b)
    set CM_Image2=CM_CreateImageEx("Fonts\\I.blp",90,90,x-20,y,0,true,r,g,b)
    set CM_Image3=CM_CreateImageEx("Fonts\\C.blp",90,90,x,y,0,true,r,g,b)
    set CM_Image4=CM_CreateImageEx("Fonts\\K.blp",90,90,x+45,y,0,true,r,g,b)
  elseif Phase==5 then
    call ModeCM_KillImage(CM_Image1)
    call ModeCM_KillImage(CM_Image2)
    call ModeCM_KillImage(CM_Image3)
    call ModeCM_KillImage(CM_Image4)
  endif
endfunction

function ModeCM_ColorTime takes integer i,integer turn returns string
  if i<0 then
    set i=0
  endif
  if TimerGetElapsed(GlobalTimer)<15 then
    return"|c00555555"+I2S(i)
  endif
  if ModeCM_Current==3 then
    return"|c00555555"+I2S(i)
  endif
  if ModeCM_Current==1 and turn!=1 then
    return"|c00555555"+I2S(i)
  elseif ModeCM_Current==2 and turn!=2 then
    return"|c00555555"+I2S(i)
  elseif i==0 then
    return"|c00555555"+I2S(i)
  elseif i<6 then
    return"|c00ff0303"+I2S(i)
  else
    return I2S(i)
  endif
endfunction

function ModeCM_UpdateBoard takes nothing returns boolean
  local multiboarditem mbitem
  local integer i
  local integer curRow
  local integer curCol
  local integer offset=7
  local integer initial=0
  set curRow=1
  set curCol=initial
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemWidth(mbitem,.5)
  call MultiboardSetItemValue(mbitem,udg_Colors[GetPlayerId(Sentinels[1])]+(IL7[GetPlayerId((Sentinels[1]))])+"|r")
  call MultiboardReleaseItem(mbitem)
  set curRow=curRow+2
  set curCol=initial
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,"|c006699CC"+GetObjectName('n0EV'))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set i=0
  set curRow=curRow
  set curCol=initial+i+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Bans1[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Bans1[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=1
  set curCol=initial+i+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Bans1[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Bans1[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=2
  set curCol=initial+i+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Bans1[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Bans1[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=3
  set curCol=initial+i+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Bans1[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Bans1[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=4
  set curCol=initial+i+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Bans1[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Bans1[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set curRow=curRow+2
  set curCol=initial
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,"|c006699CC"+GetObjectName('n0EX'))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set i=0
  set curRow=curRow
  set curCol=initial+i+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Picks1[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Picks1[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=1
  set curCol=initial+i+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Picks1[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Picks1[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=2
  set curCol=initial+i+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Picks1[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Picks1[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=3
  set curCol=initial+i+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Picks1[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Picks1[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=4
  set curCol=initial+i+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Picks1[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Picks1[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set curRow=curRow+2
  set curCol=initial
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,"|c006699CC"+GetObjectName('n0EU'))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set curCol=initial+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,ModeCM_ColorTime(ModeCM_Time[1],1))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set curRow=curRow+1
  set curCol=initial
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,"|c006699CC"+GetObjectName('n0ET'))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set curCol=initial+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,ModeCM_ColorTime(ModeCM_Bank[1],1))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set curRow=curRow+2
  set curCol=initial
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,"|c006699CC"+GetObjectName('n0EY'))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set curCol=initial+1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  if TimerGetElapsed(GlobalTimer)<15 then
    call MultiboardSetItemValue(mbitem,"|c00555555"+GetObjectName('n0F1'))
  elseif ModeCM_Current==1 then
    call MultiboardSetItemValue(mbitem,GetObjectName('n0F4'))
  elseif ModeCM_Current==2 then
    call MultiboardSetItemValue(mbitem,"|c00555555"+GetObjectName('n0F1'))
  else
    call MultiboardSetItemValue(mbitem,"|c00555555"+GetObjectName('n0F2'))
  endif
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set curRow=1
  set curCol=offset
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemWidth(mbitem,1.5)
  call MultiboardSetItemValue(mbitem,"   "+udg_Colors[GetPlayerId(Scourges[1])]+(IL7[GetPlayerId((Scourges[1]))])+"|r")
  call MultiboardReleaseItem(mbitem)
  set curRow=curRow+2
  set curCol=offset-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,"|c006699CC"+" "+GetObjectName('n0EV'))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set i=0
  set curCol=offset+i+1-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Bans2[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Bans2[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=1
  set curCol=offset+i+1-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Bans2[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Bans2[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=2
  set curCol=offset+i+1-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Bans2[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Bans2[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=3
  set curCol=offset+i+1-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Bans2[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Bans2[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=4
  set curCol=offset+i+1-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Bans2[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Bans2[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set curRow=curRow+2
  set curCol=offset-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,"|c006699CC"+" "+GetObjectName('n0EX'))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set i=0
  set curCol=offset+i+1-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Picks2[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Picks2[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=1
  set curCol=offset+i+1-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Picks2[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Picks2[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=2
  set curCol=offset+i+1-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Picks2[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Picks2[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=3
  set curCol=offset+i+1-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Picks2[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Picks2[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set i=4
  set curCol=offset+i+1-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemWidth(mbitem,.015)
  if ModeCM_Picks2[i]>0 then
    call MultiboardSetItemStyle(mbitem,false,true)
    call MultiboardSetItemIcon(mbitem,HeroIcon[ModeCM_Picks2[i]])
  endif
  call MultiboardReleaseItem(mbitem)
  set curRow=curRow+2
  set curCol=offset-2
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,"|c006699CC"+GetObjectName('n0EU'))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set curCol=offset-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,ModeCM_ColorTime(ModeCM_Time[2],2))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set curRow=curRow+1
  set curCol=offset-2
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,"|c006699CC"+GetObjectName('n0ET'))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set curCol=offset-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,ModeCM_ColorTime(ModeCM_Bank[2],2))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set curRow=curRow+2
  set curCol=offset-2
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  call MultiboardSetItemValue(mbitem,"|c006699CC"+GetObjectName('n0EY'))
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set curCol=offset-1
  set mbitem=MultiboardGetItem(CMBoard,curRow,curCol)
  call MultiboardSetItemStyle(mbitem,true,false)
  if TimerGetElapsed(GlobalTimer)<15 then
    call MultiboardSetItemValue(mbitem,"|c00555555"+GetObjectName('n0F1'))
  elseif ModeCM_Current==2 then
    call MultiboardSetItemValue(mbitem,GetObjectName('n0F4'))
  elseif ModeCM_Current==1 then
    call MultiboardSetItemValue(mbitem,"|c00555555"+GetObjectName('n0F1'))
  else
    call MultiboardSetItemValue(mbitem,"|c00555555"+GetObjectName('n0F2'))
  endif
  call MultiboardSetItemWidth(mbitem,.035)
  call MultiboardReleaseItem(mbitem)
  set mbitem=null
  return false
endfunction

function ModeCM_CreateBoard takes nothing returns nothing
  local integer numRows=12
  local integer numCols=14
  local trigger t=CreateTrigger()
  local integer i
  local multiboarditem mbitem
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function ModeCM_UpdateBoard))
  set CMBoard=CreateMultiboard()
  call MultiboardSetItemsWidth(CMBoard,.015)
  call MultiboardSetRowCount(CMBoard,numRows)
  call MultiboardSetColumnCount(CMBoard,numCols)
  call MultiboardSetTitleText(CMBoard,GetObjectName('n0K6'))
  call MultiboardSetItemsStyle(CMBoard,false,false)
  call MultiboardMinimize(CMBoard,false)
  call MultiboardDisplay(CMBoard,true)
  set i=0
  loop
    exitwhen i>numCols
    set mbitem=MultiboardGetItem(CMBoard,0,i)
    call MultiboardSetItemWidth(mbitem,.015)
    call MultiboardReleaseItem(mbitem)
    set i=i+1
  endloop
  set t=null
  set mbitem=null
endfunction

function ModeCM_SelectedHero takes nothing returns boolean
  local unit Sold=GetSoldUnit()
  local player p=GetOwningPlayer(Sold)
  local integer i
  local real x
  local real y
  local real a
  if GetUnitTypeId(Sold)=='h06N' and IsPlayerAlly(GetOwningPlayer(Sold),GetOwningPlayer(GetSellingUnit()))then
    if udg_Hero[GetPlayerId(p)]!=null then
      call Error(p,GetObjectName('n0F3'))
      call KillUnit(Sold)
      set Sold=null
      set p=null
      return false
    endif
    set x=GetUnitX(GetSellingUnit())
    set y=GetUnitY(GetSellingUnit())
    set i=DummyToHero(GetUnitTypeId(GetSellingUnit()))
    set a=GetUnitFacing(GetSellingUnit())
    call RemoveUnit(GetSellingUnit())
    call CreateUnit(p,i,x,y,a)
  endif
  if GetUnitTypeId(Sold)=='h06N' then
    call KillUnit(Sold)
  endif
  if udg_Hero[GetPlayerId(Sentinels[1])]!=null and udg_Hero[GetPlayerId(Sentinels[2])]!=null and udg_Hero[GetPlayerId(Sentinels[3])]!=null and udg_Hero[GetPlayerId(Sentinels[4])]!=null and udg_Hero[GetPlayerId(Sentinels[5])]!=null and udg_Hero[GetPlayerId(Scourges[1])]!=null and udg_Hero[GetPlayerId(Scourges[2])]!=null and udg_Hero[GetPlayerId(Scourges[3])]!=null and udg_Hero[GetPlayerId(Scourges[4])]!=null and udg_Hero[GetPlayerId(Scourges[5])]!=null then
    call CleanTrigger(GetTriggeringTrigger())
  endif
  set Sold=null
  set p=null
  return false
endfunction

function ModeCM_UpdateBoards takes nothing returns boolean
  set udg_CMSpawn=true
  call CleanTrigger(GetTriggeringTrigger())
  call DestroyMultiboard(CMBoard)
  call Trig_display_leaderboard_Actions()
  call CreateObsBoard()
  return false
endfunction

function ModeCM_SpawnSound takes nothing returns boolean
  call CleanTrigger(GetTriggeringTrigger())
  call PlaySoundBJ(QD)
  return false
endfunction

function ModeCM_CreateDummies takes nothing returns boolean
  local trigger t=CreateTrigger()
  local integer Seconds
  local integer Minutes
  local string Time
  local unit u
  local real x
  local real y
  local integer i
  local real d
  local real SentX=GetRectCenterX(gg_rct_Hero_Creation_NE)
  local real SentY=GetRectCenterY(gg_rct_Hero_Creation_NE)
  local real ScourgeX=GetRectCenterX(gg_rct_Hero_Creation_UD)
  local real ScourgeY=GetRectCenterY(gg_rct_Hero_Creation_UD)
  set ModeCM_Current=3
  set HeroDamageTracking_Enabled=true
  call CleanTrigger(GetTriggeringTrigger())
  set i=0
  loop
    exitwhen i==5
    set x=SentX-300+i*150
    set y=SentY
    set u=CreateUnit(Sentinels[0],DummyID[ModeCM_Picks1[i]],x,y,270)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_SELL)
    call PanCameraToTimedForPlayer(Sentinels[i+1],SentX,SentY,0)
    call CreateUnit(Sentinels[i+1],'n00C',SentX,SentY,bj_UNIT_FACING)
    call SetPlayerState(Sentinels[i+1],PLAYER_STATE_RESOURCE_GOLD,CMGold[GetPlayerId(Sentinels[i+1])]-250)
    set i=i+1
  endloop
  set i=0
  loop
    exitwhen i==5
    set x=ScourgeX-300+i*150
    set y=ScourgeY
    set u=CreateUnit(Scourges[0],DummyID[ModeCM_Picks2[i]],x,y,270)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_SELL)
    call PanCameraToTimedForPlayer(Scourges[i+1],ScourgeX,ScourgeY,0)
    call CreateUnit(Scourges[i+1],'n00C',ScourgeX,ScourgeY,bj_UNIT_FACING)
    call SetPlayerState(Scourges[i+1],PLAYER_STATE_RESOURCE_GOLD,CMGold[GetPlayerId(Scourges[i+1])]-250)
    set i=i+1
  endloop
  call TriggerAddCondition(t,Condition(function ModeCM_SelectedHero))
  call SuspendTimeOfDay(false)
  call EnableTrigger(OneHero)
  call EnableTrigger(HeroEnters)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,10,false)
  call TriggerAddCondition(t,Condition(function ModeCM_UpdateBoards))
  set CreepSpawnTime=90
  call ModePicked()
  call TechAll()
  set t=null
  set u=null
  return false
endfunction

function ModeCM_PickHero takes integer i returns nothing
  call TechHeroForAll(HeroID[i])
  if ModeCM_Current==1 then
    set ModeCM_Picks1[ModeCM_PickCount1]=i
    set ModeCM_PickCount1=ModeCM_PickCount1+1
  else
    set ModeCM_Picks2[ModeCM_PickCount2]=i
    set ModeCM_PickCount2=ModeCM_PickCount2+1
  endif
endfunction

function ModeCM_PickRandomHero takes nothing returns nothing
  local integer i=GetSetElement()
  loop
    if b_isHeroPicked[i]==false then
      set b_isHeroPicked[i]=true
      call ModeCM_PickHero(i)
      return
    endif
  endloop
endfunction

function ModeCM_BanHero takes integer i returns nothing
  call Traffic_RegisterData("Ban"+I2S(GetPlayerId(GetOwningPlayer(GetSoldUnit()))),HeroID[i])
  call TechHeroForAll(HeroID[i])
  if ModeCM_Current==1 then
    set ModeCM_Bans1[ModeCM_BanCount1]=i
    set ModeCM_BanCount1=ModeCM_BanCount1+1
  else
    set ModeCM_Bans2[ModeCM_BanCount2]=i
    set ModeCM_BanCount2=ModeCM_BanCount2+1
  endif
endfunction

function ModeCM_BanRandomHero takes nothing returns nothing
  call ModeCM_BanHero(-1)
endfunction

function ModeCM_Pick2Phase takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local player p
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SELL and IsUnitType(GetSoldUnit(),UNIT_TYPE_HERO)==false then
    set t=null
    return false
  endif
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SELL then
    call ModeCM_PickHero(GetUnitPointValue(GetSoldUnit()))
    call RemoveUnit(GetSoldUnit())
    if ModeCM_PickPhase==0 then
      set ModeCM_PickPhase=ModeCM_PickPhase+1
      call CleanTrigger(t)
      set t=CreateTrigger()
      call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
      call TriggerRegisterTimerEvent(t,1,true)
      call TriggerAddCondition(t,Condition(function ModeCM_Pick2Phase))
      if ModeCM_Current==1 then
        set ModeCM_Current=2
        set ModeCM_Time[ModeCM_Current]=50
        set p=Scourges[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      else
        set ModeCM_Current=1
        set ModeCM_Time[ModeCM_Current]=50
        set p=Sentinels[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      endif
    elseif ModeCM_PickPhase==1 then
      if ModeCM_Current==1 and ModeCM_PickCount1==4 then
        set ModeCM_PickPhase=ModeCM_PickPhase+1
        call CleanTrigger(t)
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
        call TriggerRegisterTimerEvent(t,1,true)
        call TriggerAddCondition(t,Condition(function ModeCM_Pick2Phase))
        set ModeCM_Current=2
        set ModeCM_Time[ModeCM_Current]=50
        set p=Scourges[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      elseif ModeCM_Current==2 and ModeCM_PickCount2==4 then
        set ModeCM_PickPhase=ModeCM_PickPhase+1
        call CleanTrigger(t)
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
        call TriggerRegisterTimerEvent(t,1,true)
        call TriggerAddCondition(t,Condition(function ModeCM_Pick2Phase))
        set ModeCM_Current=1
        set ModeCM_Time[ModeCM_Current]=50
        set p=Sentinels[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      endif
    elseif ModeCM_PickPhase==2 then
      if ModeCM_Current==1 and ModeCM_PickCount1==5 then
        set ModeCM_PickPhase=ModeCM_PickPhase+1
        call CleanTrigger(t)
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
        call TriggerRegisterTimerEvent(t,1,true)
        call TriggerAddCondition(t,Condition(function ModeCM_Pick2Phase))
        set ModeCM_Current=2
        set ModeCM_Time[ModeCM_Current]=50
        set p=Scourges[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      elseif ModeCM_Current==2 and ModeCM_PickCount2==5 then
        set ModeCM_PickPhase=ModeCM_PickPhase+1
        call CleanTrigger(t)
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
        call TriggerRegisterTimerEvent(t,1,true)
        call TriggerAddCondition(t,Condition(function ModeCM_Pick2Phase))
        set ModeCM_Current=1
        set ModeCM_Time[ModeCM_Current]=50
        set p=Sentinels[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      endif
    elseif ModeCM_PickPhase==3 then
      set ModeCM_PickPhase=ModeCM_PickPhase+1
      call CleanTrigger(t)
      set t=CreateTrigger()
      call TriggerRegisterTimerEvent(t,1,false)
      call TriggerAddCondition(t,Condition(function ModeCM_CreateDummies))
      call ModeCM_DisplayPhase(5)
      call MultiboardSetTitleText(CMBoard,GetObjectName('n0K6'))
    endif
  else
    if GetTriggerEvalCount(t)>50 then
      if ModeCM_Bank[ModeCM_Current]>0 then
        set ModeCM_Bank[ModeCM_Current]=ModeCM_Bank[ModeCM_Current]-1
      else
        if ModeCM_Current==1 then
          call ModeCM_PickRandomHero()
        else
          call ModeCM_PickRandomHero()
        endif
        if ModeCM_PickPhase==0 then
          set ModeCM_PickPhase=ModeCM_PickPhase+1
          call CleanTrigger(t)
          set t=CreateTrigger()
          call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
          call TriggerRegisterTimerEvent(t,1,true)
          call TriggerAddCondition(t,Condition(function ModeCM_Pick2Phase))
          if ModeCM_Current==1 then
            set ModeCM_Current=2
            set ModeCM_Time[ModeCM_Current]=50
            set p=Scourges[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
            call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          else
            set ModeCM_Current=1
            set ModeCM_Time[ModeCM_Current]=50
            set p=Sentinels[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
            call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          endif
        elseif ModeCM_PickPhase==1 then
          if ModeCM_Current==1 and ModeCM_PickCount1==4 then
            set ModeCM_PickPhase=ModeCM_PickPhase+1
            call CleanTrigger(t)
            set t=CreateTrigger()
            call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
            call TriggerRegisterTimerEvent(t,1,true)
            call TriggerAddCondition(t,Condition(function ModeCM_Pick2Phase))
            set ModeCM_Current=2
            set ModeCM_Time[ModeCM_Current]=50
            set p=Scourges[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
            call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          elseif ModeCM_Current==2 and ModeCM_PickCount2==4 then
            set ModeCM_PickPhase=ModeCM_PickPhase+1
            call CleanTrigger(t)
            set t=CreateTrigger()
            call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
            call TriggerRegisterTimerEvent(t,1,true)
            call TriggerAddCondition(t,Condition(function ModeCM_Pick2Phase))
            set ModeCM_Current=1
            set ModeCM_Time[ModeCM_Current]=50
            set p=Sentinels[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
            call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          endif
        elseif ModeCM_PickPhase==2 then
          if ModeCM_Current==1 and ModeCM_PickCount1==5 then
            set ModeCM_PickPhase=ModeCM_PickPhase+1
            call CleanTrigger(t)
            set t=CreateTrigger()
            call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
            call TriggerRegisterTimerEvent(t,1,true)
            call TriggerAddCondition(t,Condition(function ModeCM_Pick2Phase))
            set ModeCM_Current=2
            set ModeCM_Time[ModeCM_Current]=50
            set p=Scourges[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
            call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          elseif ModeCM_Current==2 and ModeCM_PickCount2==5 then
            set ModeCM_PickPhase=ModeCM_PickPhase+1
            call CleanTrigger(t)
            set t=CreateTrigger()
            call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
            call TriggerRegisterTimerEvent(t,1,true)
            call TriggerAddCondition(t,Condition(function ModeCM_Pick2Phase))
            set ModeCM_Current=1
            set ModeCM_Time[ModeCM_Current]=50
            set p=Sentinels[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
            call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          endif
        elseif ModeCM_PickPhase==3 then
          set ModeCM_PickPhase=ModeCM_PickPhase+1
          call CleanTrigger(t)
          set t=CreateTrigger()
          call TriggerRegisterTimerEvent(t,1,false)
          call TriggerAddCondition(t,Condition(function ModeCM_CreateDummies))
          call ModeCM_DisplayPhase(5)
          call MultiboardSetTitleText(CMBoard,GetObjectName('n0K6'))
          call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
          call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
        endif
      endif
    else
      if ModeCM_Current==1 then
        set ModeCM_Time[1]=ModeCM_Time[1]-1
      else
        set ModeCM_Time[2]=ModeCM_Time[2]-1
      endif
    endif
  endif
  set t=null
  set p=null
  return false
endfunction

function ModeCM_BanPhase2 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local player p
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SELL and IsUnitType(GetSoldUnit(),UNIT_TYPE_HERO)==false then
    set t=null
    return false
  endif
  if ModeCM_BanCount1==(3+2)and ModeCM_BanCount2==(3+2)then
    if GetTriggerEventId()==EVENT_PLAYER_UNIT_SELL then
      call RemoveUnit(GetSoldUnit())
    endif
    call CleanTrigger(t)
    set ModeCM_PickPhase=0
    set t=CreateTrigger()
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function ModeCM_Pick2Phase))
    call ModeCM_DisplayPhase(4)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,"|c006699CC"+GetObjectName('n0L3')+"|r")
    call MultiboardSetTitleText(CMBoard,GetObjectName('n0K6')+" - |c00ffffff"+GetObjectName('n0L8'))
    if ModeCM_Current==1 then
      set ModeCM_Time[ModeCM_Current]=50
      set p=Sentinels[1]
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
      call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
    else
      set ModeCM_Time[ModeCM_Current]=50
      set p=Scourges[1]
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
      call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
    endif
    set t=null
    set p=null
    return false
  endif
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SELL then
    call ModeCM_BanHero(GetUnitPointValue(GetSoldUnit()))
    call RemoveUnit(GetSoldUnit())
    call CleanTrigger(t)
    set t=CreateTrigger()
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function ModeCM_BanPhase2))
    if ModeCM_Current==1 then
      set ModeCM_Current=2
      set ModeCM_Time[ModeCM_Current]=50
      set p=Scourges[1]
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
      call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
    else
      set ModeCM_Current=1
      set ModeCM_Time[ModeCM_Current]=50
      set p=Sentinels[1]
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
      call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
    endif
  else
    if GetTriggerEvalCount(t)>50 then
      if ModeCM_Bank[ModeCM_Current]>0 then
        set ModeCM_Bank[ModeCM_Current]=ModeCM_Bank[ModeCM_Current]-1
      else
        call ModeCM_BanHero(-1)
        call CleanTrigger(t)
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
        call TriggerRegisterTimerEvent(t,1,true)
        call TriggerAddCondition(t,Condition(function ModeCM_BanPhase2))
        if ModeCM_Current==1 then
          set ModeCM_Current=2
          set ModeCM_Time[ModeCM_Current]=50
          set p=Scourges[1]
          call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
          call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
          call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
        else
          set ModeCM_Current=1
          set ModeCM_Time[ModeCM_Current]=50
          set p=Sentinels[1]
          call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
          call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
          call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
        endif
      endif
    else
      if ModeCM_Current==1 then
        set ModeCM_Time[1]=ModeCM_Time[1]-1
      else
        set ModeCM_Time[2]=ModeCM_Time[2]-1
      endif
    endif
  endif
  set t=null
  set p=null
  return false
endfunction

function ModeCM_Pick1Phase takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local player p
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SELL and IsUnitType(GetSoldUnit(),UNIT_TYPE_HERO)==false then
    set t=null
    return false
  endif
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SELL then
    call ModeCM_PickHero(GetUnitPointValue(GetSoldUnit()))
    call RemoveUnit(GetSoldUnit())
    if ModeCM_PickPhase==0 then
      set ModeCM_PickPhase=ModeCM_PickPhase+1
      call CleanTrigger(t)
      set t=CreateTrigger()
      call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
      call TriggerRegisterTimerEvent(t,1,true)
      call TriggerAddCondition(t,Condition(function ModeCM_Pick1Phase))
      if ModeCM_Current==1 then
        set ModeCM_Current=2
        set ModeCM_Time[ModeCM_Current]=50
        set p=Scourges[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,500)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      else
        set ModeCM_Current=1
        set ModeCM_Time[ModeCM_Current]=50
        set p=Sentinels[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,500)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      endif
    elseif ModeCM_PickPhase==1 then
      if ModeCM_Current==1 and ModeCM_PickCount1==2 then
        set ModeCM_PickPhase=ModeCM_PickPhase+1
        call CleanTrigger(t)
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
        call TriggerRegisterTimerEvent(t,1,true)
        call TriggerAddCondition(t,Condition(function ModeCM_Pick1Phase))
        set ModeCM_Current=2
        set ModeCM_Time[ModeCM_Current]=50
        set p=Scourges[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,500)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      elseif ModeCM_Current==2 and ModeCM_PickCount2==2 then
        set ModeCM_PickPhase=ModeCM_PickPhase+1
        call CleanTrigger(t)
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
        call TriggerRegisterTimerEvent(t,1,true)
        call TriggerAddCondition(t,Condition(function ModeCM_Pick1Phase))
        set ModeCM_Current=1
        set ModeCM_Time[ModeCM_Current]=50
        set p=Sentinels[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,500)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      endif
    elseif ModeCM_PickPhase==2 then
      if ModeCM_Current==1 and ModeCM_PickCount1==3 then
        set ModeCM_PickPhase=ModeCM_PickPhase+1
        call CleanTrigger(t)
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
        call TriggerRegisterTimerEvent(t,1,true)
        call TriggerAddCondition(t,Condition(function ModeCM_Pick1Phase))
        set ModeCM_Current=2
        set ModeCM_Time[ModeCM_Current]=50
        set p=Scourges[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      elseif ModeCM_Current==2 and ModeCM_PickCount2==3 then
        set ModeCM_PickPhase=ModeCM_PickPhase+1
        call CleanTrigger(t)
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
        call TriggerRegisterTimerEvent(t,1,true)
        call TriggerAddCondition(t,Condition(function ModeCM_Pick1Phase))
        set ModeCM_Current=1
        set ModeCM_Time[ModeCM_Current]=50
        set p=Sentinels[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      endif
    elseif ModeCM_PickPhase==3 then
      set ModeCM_PickPhase=ModeCM_PickPhase+1
      call CleanTrigger(t)
      if ModeCM_Order==1 then
        set ModeCM_Current=1
        set ModeCM_Time[ModeCM_Current]=50
        set p=Sentinels[1]
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      else
        set ModeCM_Current=2
        set p=Scourges[1]
        set ModeCM_Time[ModeCM_Current]=50
        call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
        call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
      endif
      set t=CreateTrigger()
      call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
      call TriggerRegisterTimerEvent(t,1,true)
      call TriggerAddCondition(t,Condition(function ModeCM_BanPhase2))
      call ModeCM_DisplayPhase(3)
      call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,"|c006699CC"+GetObjectName('n0L4')+"|r")
      call MultiboardSetTitleText(CMBoard,GetObjectName('n0K6')+" - |c00ffffff"+GetObjectName('n0L7'))
    endif
  else
    if GetTriggerEvalCount(t)>50 then
      if ModeCM_Bank[ModeCM_Current]>0 then
        set ModeCM_Bank[ModeCM_Current]=ModeCM_Bank[ModeCM_Current]-1
      else
        if ModeCM_Current==1 then
          call ModeCM_PickRandomHero()
        else
          call ModeCM_PickRandomHero()
        endif
        if ModeCM_PickPhase==0 then
          set ModeCM_PickPhase=ModeCM_PickPhase+1
          call CleanTrigger(t)
          set t=CreateTrigger()
          call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
          call TriggerRegisterTimerEvent(t,1,true)
          call TriggerAddCondition(t,Condition(function ModeCM_Pick1Phase))
          if ModeCM_Current==1 then
            set ModeCM_Current=2
            set ModeCM_Time[ModeCM_Current]=50
            set p=Scourges[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,500)
            call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          else
            set ModeCM_Current=1
            set ModeCM_Time[ModeCM_Current]=50
            set p=Sentinels[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,500)
            call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          endif
        elseif ModeCM_PickPhase==1 then
          if ModeCM_Current==1 and ModeCM_PickCount1==2 then
            set ModeCM_PickPhase=ModeCM_PickPhase+1
            call CleanTrigger(t)
            set t=CreateTrigger()
            call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
            call TriggerRegisterTimerEvent(t,1,true)
            call TriggerAddCondition(t,Condition(function ModeCM_Pick1Phase))
            set ModeCM_Current=2
            set ModeCM_Time[ModeCM_Current]=50
            set p=Scourges[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,500)
            call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          elseif ModeCM_Current==2 and ModeCM_PickCount2==2 then
            set ModeCM_PickPhase=ModeCM_PickPhase+1
            call CleanTrigger(t)
            set t=CreateTrigger()
            call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
            call TriggerRegisterTimerEvent(t,1,true)
            call TriggerAddCondition(t,Condition(function ModeCM_Pick1Phase))
            set ModeCM_Current=1
            set ModeCM_Time[ModeCM_Current]=50
            set p=Sentinels[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,500)
            call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          endif
        elseif ModeCM_PickPhase==2 then
          if ModeCM_Current==1 and ModeCM_PickCount1==3 then
            set ModeCM_PickPhase=ModeCM_PickPhase+1
            call CleanTrigger(t)
            set t=CreateTrigger()
            call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
            call TriggerRegisterTimerEvent(t,1,true)
            call TriggerAddCondition(t,Condition(function ModeCM_Pick1Phase))
            set ModeCM_Current=2
            set ModeCM_Time[ModeCM_Current]=50
            set p=Scourges[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
            call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          elseif ModeCM_Current==2 and ModeCM_PickCount2==3 then
            set ModeCM_PickPhase=ModeCM_PickPhase+1
            call CleanTrigger(t)
            set t=CreateTrigger()
            call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
            call TriggerRegisterTimerEvent(t,1,true)
            call TriggerAddCondition(t,Condition(function ModeCM_Pick1Phase))
            set ModeCM_Current=1
            set ModeCM_Time[ModeCM_Current]=50
            set p=Sentinels[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
            call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          endif
        elseif ModeCM_PickPhase==3 then
          set ModeCM_PickPhase=ModeCM_PickPhase+1
          call CleanTrigger(t)
          if ModeCM_Order==1 then
            set ModeCM_Current=1
            set ModeCM_Time[ModeCM_Current]=50
            set p=Sentinels[1]
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          else
            set ModeCM_Current=2
            set p=Scourges[1]
            set ModeCM_Time[ModeCM_Current]=50
            call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
            call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
          endif
          set t=CreateTrigger()
          call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
          call TriggerRegisterTimerEvent(t,1,true)
          call TriggerAddCondition(t,Condition(function ModeCM_BanPhase2))
          call ModeCM_DisplayPhase(3)
          call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,"|c006699CC"+GetObjectName('n0L4')+"|r")
          call MultiboardSetTitleText(CMBoard,GetObjectName('n0K6')+" - |c00ffffff"+GetObjectName('n0L7'))
        endif
      endif
    else
      if ModeCM_Current==1 then
        set ModeCM_Time[1]=ModeCM_Time[1]-1
      else
        set ModeCM_Time[2]=ModeCM_Time[2]-1
      endif
    endif
  endif
  set t=null
  set p=null
  return false
endfunction

function ModeCM_BanPhase1 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local player p
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SELL and IsUnitType(GetSoldUnit(),UNIT_TYPE_HERO)==false then
    set t=null
    return false
  endif
  if ModeCM_BanCount1==3 and ModeCM_BanCount2==3 then
    if GetTriggerEventId()==EVENT_PLAYER_UNIT_SELL then
      call RemoveUnit(GetSoldUnit())
    endif
    call CleanTrigger(t)
    set t=CreateTrigger()
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function ModeCM_Pick1Phase))
    call ModeCM_DisplayPhase(2)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,"|c006699CC"+GetObjectName('n0L5')+"|r")
    call MultiboardSetTitleText(CMBoard,GetObjectName('n0K6')+" - |c00ffffff"+GetObjectName('n0L9'))
    if ModeCM_Current==1 then
      set ModeCM_Time[ModeCM_Current]=50
      set p=Sentinels[1]
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
      call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
    else
      set ModeCM_Time[ModeCM_Current]=50
      set p=Scourges[1]
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
      call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
    endif
    set t=null
    set p=null
    return false
  endif
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SELL then
    call ModeCM_BanHero(GetUnitPointValue(GetSoldUnit()))
    call RemoveUnit(GetSoldUnit())
    call CleanTrigger(t)
    set t=CreateTrigger()
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function ModeCM_BanPhase1))
    if ModeCM_Current==1 then
      set ModeCM_Current=2
      set ModeCM_Time[ModeCM_Current]=40
      set p=Scourges[1]
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
      call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
    else
      set ModeCM_Current=1
      set ModeCM_Time[ModeCM_Current]=40
      set p=Sentinels[1]
      call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
      call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
    endif
  else
    if GetTriggerEvalCount(t)>40 then
      if ModeCM_Bank[ModeCM_Current]>0 then
        set ModeCM_Bank[ModeCM_Current]=ModeCM_Bank[ModeCM_Current]-1
      else
        call ModeCM_BanHero(-1)
        call CleanTrigger(t)
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
        call TriggerRegisterTimerEvent(t,1,true)
        call TriggerAddCondition(t,Condition(function ModeCM_BanPhase1))
        if ModeCM_Current==1 then
          set ModeCM_Current=2
          set ModeCM_Time[ModeCM_Current]=40
          set p=Scourges[1]
          call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
          call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
          call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
        else
          set ModeCM_Current=1
          set ModeCM_Time[ModeCM_Current]=40
          set p=Sentinels[1]
          call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
          call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
          call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
        endif
      endif
    else
      if ModeCM_Current==1 then
        set ModeCM_Time[1]=ModeCM_Time[1]-1
      else
        set ModeCM_Time[2]=ModeCM_Time[2]-1
      endif
    endif
  endif
  set t=null
  set p=null
  return false
endfunction

function ModeCM_Start takes nothing returns boolean
  local trigger t=CreateTrigger()
  local player p
  set ModeCM_Started=true
  call CleanTrigger(GetTriggeringTrigger())
  if ModeCM_Manual==false then
    if ModeCM_Order==1 then
      call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(Sentinels[1])]+(IL7[GetPlayerId((Sentinels[1]))])+"|r "+GetObjectName('n0EA'))
    else
      call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(Scourges[1])]+(IL7[GetPlayerId((Scourges[1]))])+"|r "+GetObjectName('n0EA'))
    endif
  endif
  if ModeCM_Order==1 then
    set ModeCM_Current=1
    set ModeCM_Time[ModeCM_Current]=40
    set p=Sentinels[1]
    call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
    call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
  else
    set ModeCM_Current=2
    set p=Scourges[1]
    set ModeCM_Time[ModeCM_Current]=40
    call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,250)
    call SoundForPlayer(p,"Sound\\Interface\\Rescue.wav")
  endif
  call ModeCM_DisplayPhase(1)
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,"|c006699CC"+GetObjectName('n0L6')+"|r")
  call MultiboardSetTitleText(CMBoard,GetObjectName('n0K6')+" - |c00ffffff"+GetObjectName('n0LA'))
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function ModeCM_BanPhase1))
  set t=null
  set p=null
  return false
endfunction

function ModeCM takes nothing returns nothing
  local trigger t
  local location SpawnSent=GetRectCenter(gg_rct_Allpick_Sent)
  local location SpawnScourge=GetRectCenter(gg_rct_Allpick_Scourge)
  local integer x=1
  local player p
  loop
    exitwhen x>5
    if IsPlayer(Sentinels[x])then
      call CreateUnitAtLoc(Sentinels[x],'n00C',SpawnScourge,bj_UNIT_FACING)
    endif
    if IsPlayer(Scourges[x])then
      call CreateUnitAtLoc(Scourges[x],'n00C',SpawnSent,bj_UNIT_FACING)
    endif
    set x=x+1
  endloop
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  set Mode_CM=true
  set udg_Allow_Repick=false
  set udg_Allow_Random=false
  set HeroDamageTracking_Enabled=false
  set AFK_Check=false
  call SuspendTimeOfDay(true)
  call DisableTrigger(OneHero)
  call DisableTrigger(HeroEnters)
  if udg_ModeUB==false then
    call RestrictHeroes()
  endif
  set CMGold[GetPlayerId(Sentinels[1])]=GetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD)
  set CMGold[GetPlayerId(Sentinels[2])]=GetPlayerState(Sentinels[2],PLAYER_STATE_RESOURCE_GOLD)
  set CMGold[GetPlayerId(Sentinels[3])]=GetPlayerState(Sentinels[3],PLAYER_STATE_RESOURCE_GOLD)
  set CMGold[GetPlayerId(Sentinels[4])]=GetPlayerState(Sentinels[4],PLAYER_STATE_RESOURCE_GOLD)
  set CMGold[GetPlayerId(Sentinels[5])]=GetPlayerState(Sentinels[5],PLAYER_STATE_RESOURCE_GOLD)
  set CMGold[GetPlayerId(Scourges[1])]=GetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD)
  set CMGold[GetPlayerId(Scourges[2])]=GetPlayerState(Scourges[2],PLAYER_STATE_RESOURCE_GOLD)
  set CMGold[GetPlayerId(Scourges[3])]=GetPlayerState(Scourges[3],PLAYER_STATE_RESOURCE_GOLD)
  set CMGold[GetPlayerId(Scourges[4])]=GetPlayerState(Scourges[4],PLAYER_STATE_RESOURCE_GOLD)
  set CMGold[GetPlayerId(Scourges[5])]=GetPlayerState(Scourges[5],PLAYER_STATE_RESOURCE_GOLD)
  call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[2],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[3],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[4],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[5],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[2],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[3],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[4],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[5],PLAYER_STATE_RESOURCE_GOLD,0)
  set ModeCM_Bank[1]=90
  set ModeCM_Bank[2]=90
  set ModeCM_Order=GetRandomInt(1,2)
  set ModeCM_Manual=false
  set ModeCM_Current=ModeCM_Order
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,15-TimerGetElapsed(GlobalTimer),false)
  call TriggerAddCondition(t,Condition(function ModeCM_Start))
  call ModeCM_CreateBoard()
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,4.,GetObjectName('n0ES'))
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,4.,GetObjectName('n0ER'))
  set t=null
  set SpawnSent=null
  set SpawnScourge=null
  set p=null
endfunction

function D5E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  set boolean193=true
  call CleanTrigger(t)
  call DestroyFogModifier(CreateFogModifierRadius(Sentinels[0],FOG_OF_WAR_MASKED,B67,BL7,700,false,false))
  call DestroyFogModifier(CreateFogModifierRadius(Scourges[0],FOG_OF_WAR_MASKED,B67,BL7,700,false,false))
  set t=null
  return false
endfunction

function D2E takes nothing returns nothing
  local integer i=0
  loop
    exitwhen i>B27
    call RemoveUnit(B57[i])
    set i=i+1
  endloop
endfunction

function E4E takes real x,real y returns nothing
  set B57[B27]=CreateUnit(Player(0),'h06I',x,y,0)
  set B27=B27+1
endfunction



//[lich] E8E was here 

function EDE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer DP9=(LoadInteger(hashtable019,(Cache),(57)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local integer Count=GetTriggerEvalCount(t)
  local integer boolean124=DP9-Count
  local image EFE=(LoadImageHandle(hashtable019,(Cache),(158)))
  local image integer487=(LoadImageHandle(hashtable019,(Cache),(159)))
  local integer r
  local integer g
  local integer b
  local integer a
  if Count>0 then
    call ShowImage(EFE,false)
    call DestroyImage(EFE)
    call ShowImage(integer487,false)
    call DestroyImage(integer487)
  endif
  if Count==DP9 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if boolean124<6 then
      set r=255
      set g=0
      set b=0
    elseif GetLocalPlayer()==BY7 or GetLocalPlayer()==BZ7 then
      set r=PlayerColors_R[GetPlayerId(GetLocalPlayer())]
      set g=PlayerColors_G[GetPlayerId(GetLocalPlayer())]
      set b=PlayerColors_B[GetPlayerId(GetLocalPlayer())]
    else
      set r=255
      set g=255
      set b=255
    endif
    if IsPlayerAlly(BY7,GetLocalPlayer())then
      set a=255
    else
      set a=125
    endif
    call E8E(boolean124,r,g,b,a,x,y,Cache)
  endif
  set t=null
  set EFE=null
  set integer487=null
  return false
endfunction

function boolean123 takes integer DP9,real x,real y returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function EDE))
  call SaveInteger(hashtable019,(Cache),(57),(DP9))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call TriggerEvaluate(t)
  set t=null
endfunction

function boolean121 takes integer a,real x,real y,integer Cache returns nothing
  call E7E("Fonts\\Y.blp",90,90,x-150,y,0,true)
  call SetImageColor(tt_image1,255,0,0,a)
  call SaveImageHandle(hashtable019,(Cache),(158),(tt_image1))
  call E7E("Fonts\\O.blp",90,90,x-110,y,0,true)
  call SetImageColor(tt_image1,255,0,0,a)
  call SaveImageHandle(hashtable019,(Cache),(159),(tt_image1))
  call E7E("Fonts\\U.blp",90,90,x-70,y,0,true)
  call SetImageColor(tt_image1,255,0,0,a)
  call SaveImageHandle(hashtable019,(Cache),(160),(tt_image1))
  call E7E("Fonts\\R.blp",90,90,x-30,y,0,true)
  call SetImageColor(tt_image1,255,0,0,a)
  call SaveImageHandle(hashtable019,(Cache),(161),(tt_image1))
  call E7E("Fonts\\T.blp",90,90,x+30,y,0,true)
  call SetImageColor(tt_image1,255,0,0,a)
  call SaveImageHandle(hashtable019,(Cache),(162),(tt_image1))
  call E7E("Fonts\\U.blp",90,90,x+70,y,0,true)
  call SetImageColor(tt_image1,255,0,0,a)
  call SaveImageHandle(hashtable019,(Cache),(163),(tt_image1))
  call E7E("Fonts\\R.blp",90,90,x+110,y,0,true)
  call SetImageColor(tt_image1,255,0,0,a)
  call SaveImageHandle(hashtable019,(Cache),(164),(tt_image1))
  call E7E("Fonts\\N.blp",90,90,x+150,y,0,true)
  call SetImageColor(tt_image1,255,0,0,a)
  call SaveImageHandle(hashtable019,(Cache),(165),(tt_image1))
endfunction

function EJE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local real x
  local real y
  local integer Count=GetTriggerEvalCount(t)
  local image EFE=(LoadImageHandle(hashtable019,(Cache),(158)))
  local image integer487=(LoadImageHandle(hashtable019,(Cache),(159)))
  local image boolean130=(LoadImageHandle(hashtable019,(Cache),(160)))
  local image boolean126=(LoadImageHandle(hashtable019,(Cache),(161)))
  local image ENE=(LoadImageHandle(hashtable019,(Cache),(162)))
  local image integer488=(LoadImageHandle(hashtable019,(Cache),(163)))
  local image boolean128=(LoadImageHandle(hashtable019,(Cache),(164)))
  local image boolean129=(LoadImageHandle(hashtable019,(Cache),(165)))
  local integer r
  local integer g
  local integer b
  local integer a
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  if IsSentinel(p)then
    set x=B67
    set y=BL7+250
  else
    set x=B17
    set y=B07+250
  endif
  if Count>0 then
    call ShowImage(EFE,false)
    call DestroyImage(EFE)
    call ShowImage(integer487,false)
    call DestroyImage(integer487)
    call ShowImage(boolean130,false)
    call DestroyImage(boolean130)
    call ShowImage(boolean126,false)
    call DestroyImage(boolean126)
    call ShowImage(ENE,false)
    call DestroyImage(ENE)
    call ShowImage(integer488,false)
    call DestroyImage(integer488)
    call ShowImage(boolean128,false)
    call DestroyImage(boolean128)
    call ShowImage(boolean129,false)
    call DestroyImage(boolean129)
  endif
  if Count==20 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if GetLocalPlayer()==BY7 or GetLocalPlayer()==BZ7 then
      set a=255
    else
      set a=0
    endif
    call boolean121(a,x,y,Cache)
  endif
  set t=null
  set EFE=null
  set integer487=null
  set boolean130=null
  set boolean126=null
  set ENE=null
  set integer488=null
  set boolean128=null
  set boolean129=null
  set p=null
  return false
endfunction

function boolean125 takes player p returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function EJE))
  call SavePlayerHandle(hashtable019,(Cache),(54),(p))
  call TriggerEvaluate(t)
  set t=null
endfunction

function ESE takes player p,integer ZG8,boolean randomed returns nothing
  local integer i=V88(p)
  local real d
  if IsPlayer(p)==false then
    return
  endif
  if IsSentinel(p)then
    call SetUnitPosition(BH7[ZG8],BI7[i],BJ7[i])
    set d=RMaxIF(U18(BH7[ZG8])-.3,.5)
    call SetUnitScale(BH7[ZG8],d,d,d)
    call SetUnitFacing(BH7[ZG8],270)
    call UnitRemoveAbility(BH7[ZG8],'Amov')
  else
    call SetUnitPosition(BH7[ZG8],BK7[i],BM7[i])
    set d=RMaxIF(U18(BH7[ZG8])-.3,.5)
    call SetUnitScale(BH7[ZG8],d,d,d)
    call SetUnitFacing(BH7[ZG8],90)
    call UnitRemoveAbility(BH7[ZG8],'Amov')
  endif
  call SetUnitColor(BH7[ZG8],GetPlayerColor(p))
  call PauseUnit(BH7[ZG8],true)
  call SetUnitOwner(BH7[ZG8],p,true)
  set B37[GetPlayerId(p)]=true
  set BG7[ZG8]=true
  if IsSentinel(p)then
    set udg_Hero[GetPlayerId(p)]=CreateUnit(p,HeroID[BF7[ZG8]],GetRectCenterX(gg_rct_Hero_Creation_NE),GetRectCenterY(gg_rct_Hero_Creation_NE),0)
    set HeroTypeId[GetPlayerId(p)]=HeroID[BF7[ZG8]]
  else
    set udg_Hero[GetPlayerId(p)]=CreateUnit(p,HeroID[BF7[ZG8]],GetRectCenterX(gg_rct_Hero_Creation_UD),GetRectCenterY(gg_rct_Hero_Creation_UD),0)
    set HeroTypeId[GetPlayerId(p)]=HeroID[BF7[ZG8]]
  endif
endfunction

function ETE takes nothing returns integer
  local integer i=1
  loop
    exitwhen i>20
    if BG7[i]==false then
      return i
    endif
    set i=i+1
  endloop
  return 0
endfunction

function boolean122 takes player p returns nothing
  local integer i=1
  local boolean EVE=IsSentinel(p)
  loop
    exitwhen i==20
    if GetOwningPlayer(BH7[i])==Sentinels[0]or GetOwningPlayer(BH7[i])==Scourges[0]then
      if EVE then
        call SetUnitOwner(BH7[i],Sentinels[0],false)
      else
        call SetUnitOwner(BH7[i],Scourges[0],false)
      endif
    endif
    set i=i+1
  endloop
endfunction

function EWE takes player p,unit u returns nothing
  local integer a=80
  if GetLocalPlayer()==p then
    set a=255
  endif
  call SetUnitVertexColor(u,255,255,255,a)
endfunction

function unit035 takes player p1,player p2 returns nothing
  local unit Caster
  local real x
  local real y
  call boolean125(p1)
  call SoundForPlayer(p1,"Sound\\Interface\\Rescue.wav")
  if IsSentinel(p1)then
    if GetLocalPlayer()==p1 then
      call PingMinimapEx(RD_CenterX_Sent,RD_CenterY_Sent,5,255,255,255,false)
    endif
    set Caster=CreateUnit(p1,'n02A',RD_CenterX_Sent-250,RD_CenterY_Sent,0)
    call UnitApplyTimedLife(Caster,'BTLF',20)
    call UnitAddAbility(Caster,'Aloc')
    set C77[GetPlayerId(p1)]=Caster
    call EWE(p1,Caster)
    if GetLocalPlayer()==p1 then
      call ClearTextMessages()
    endif
    call DisplayTimedTextToPlayer(p1,0,0,10," ")
    call DisplayTimedTextToPlayer(p1,0,0,10," ")
    call DisplayTimedTextToPlayer(p1,0,0,20,GetObjectName('n068'))
    call DisplayTimedTextToPlayer(p1,0,0,10," ")
  else
    call boolean125(p1)
    if GetLocalPlayer()==p1 then
      call PingMinimapEx(BT7,BU7,5,255,255,255,false)
    endif
    set Caster=CreateUnit(p1,'n02A',RD_CenterX_Sent-250,RD_CenterY_Sent,0)
    call SetUnitVertexColor(Caster,255,255,255,175)
    call UnitApplyTimedLife(Caster,'BTLF',20)
    call UnitAddAbility(Caster,'Aloc')
    set C87[GetPlayerId(p1)]=Caster
    call EWE(p1,Caster)
    if GetLocalPlayer()==p1 then
      call ClearTextMessages()
    endif
    call DisplayTimedTextToPlayer(p1,0,0,10," ")
    call DisplayTimedTextToPlayer(p1,0,0,10," ")
    call DisplayTimedTextToPlayer(p1,0,0,20,GetObjectName('n068'))
    call DisplayTimedTextToPlayer(p1,0,0,10," ")
  endif
  if p2!=null then
    call boolean125(p2)
    call SoundForPlayer(p2,"Sound\\Interface\\Rescue.wav")
    if IsSentinel(p2)then
      if GetLocalPlayer()==p2 then
        call PingMinimapEx(RD_CenterX_Sent,RD_CenterY_Sent,5,255,255,255,false)
      endif
      set Caster=CreateUnit(p2,'n02A',RD_CenterX_Sent+250,RD_CenterY_Sent,0)
      call UnitApplyTimedLife(Caster,'BTLF',20)
      call UnitAddAbility(Caster,'Aloc')
      set C77[GetPlayerId(p2)]=Caster
      call EWE(p2,Caster)
      if GetLocalPlayer()==p2 then
        call ClearTextMessages()
      endif
      call DisplayTimedTextToPlayer(p2,0,0,10," ")
      call DisplayTimedTextToPlayer(p2,0,0,10," ")
      call DisplayTimedTextToPlayer(p2,0,0,20,GetObjectName('n068'))
      call DisplayTimedTextToPlayer(p2,0,0,10," ")
    else
      if GetLocalPlayer()==p2 then
        call PingMinimapEx(BT7,BU7,5,255,255,255,false)
      endif
      set Caster=CreateUnit(p2,'n02A',RD_CenterX_Sent+250,RD_CenterY_Sent,0)
      call UnitApplyTimedLife(Caster,'BTLF',20)
      call UnitAddAbility(Caster,'Aloc')
      set C87[GetPlayerId(p2)]=Caster
      call EWE(p2,Caster)
      if GetLocalPlayer()==p2 then
        call ClearTextMessages()
      endif
      call DisplayTimedTextToPlayer(p2,0,0,10," ")
      call DisplayTimedTextToPlayer(p2,0,0,10," ")
      call DisplayTimedTextToPlayer(p2,0,0,20,GetObjectName('n068'))
      call DisplayTimedTextToPlayer(p2,0,0,10," ")
    endif
  endif
  set Caster=null
endfunction

function EYE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer EZE=(LoadInteger(hashtable019,(Cache),(25)))
  local player boolean127=BY7
  local player EBE=BZ7
  local integer i
  set BY7=null
  set BZ7=null
  if EZE==0 then
    if BA7==1 then
      set BY7=Sentinels[1]
    else
      set BY7=Scourges[1]
    endif
    call boolean122(BY7)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(BY7)]+(IL7[GetPlayerId((BY7))])+"|r"+" "+GetObjectName('n064'))
    call unit035(BY7,BZ7)
    call boolean123(20,B67,BL7)
  elseif EZE==1 then
    if BA7==1 then
      if C97==false then
        set BY7=Scourges[1]
        set BZ7=Scourges[2]
      else
        set BY7=Scourges[1]
        set BZ7=Scourges[1]
      endif
    else
      if C97==false then
        set BY7=Sentinels[1]
        set BZ7=Sentinels[2]
      else
        set BY7=Sentinels[1]
        set BZ7=Sentinels[1]
      endif
    endif
    if B37[GetPlayerId(boolean127)]==false then
      call ESE(boolean127,ETE(),true)
    endif
    call boolean122(BY7)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(BY7)]+(IL7[GetPlayerId((BY7))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(BZ7)]+(IL7[GetPlayerId((BZ7))])+"|r"+" "+GetObjectName('n064'))
    call unit035(BY7,BZ7)
    call boolean123(20,B67,BL7)
  elseif EZE==2 then
    if BA7==1 then
      if C97==false then
        set BY7=Sentinels[2]
        set BZ7=Sentinels[3]
      else
        set BY7=Sentinels[1]
        set BZ7=Sentinels[1]
      endif
    else
      if C97==false then
        set BY7=Scourges[2]
        set BZ7=Scourges[3]
      else
        set BY7=Scourges[1]
        set BZ7=Scourges[1]
      endif
    endif
    if B37[GetPlayerId(boolean127)]==false then
      call ESE(boolean127,ETE(),true)
    endif
    if B37[GetPlayerId(EBE)]==false then
      call ESE(EBE,ETE(),true)
    endif
    call boolean122(BY7)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(BY7)]+(IL7[GetPlayerId((BY7))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(BZ7)]+(IL7[GetPlayerId((BZ7))])+"|r"+" "+GetObjectName('n064'))
    call unit035(BY7,BZ7)
    call boolean123(20,B67,BL7)
  elseif EZE==3 then
    if BA7==1 then
      if C97==false then
        set BY7=Scourges[3]
        set BZ7=Scourges[4]
      else
        set BY7=Scourges[1]
        set BZ7=Scourges[1]
      endif
    else
      if C97==false then
        set BY7=Sentinels[3]
        set BZ7=Sentinels[4]
      else
        set BY7=Sentinels[1]
        set BZ7=Sentinels[1]
      endif
    endif
    if B37[GetPlayerId(boolean127)]==false then
      call ESE(boolean127,ETE(),true)
    endif
    if B37[GetPlayerId(EBE)]==false then
      call ESE(EBE,ETE(),true)
    endif
    call boolean122(BY7)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(BY7)]+(IL7[GetPlayerId((BY7))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(BZ7)]+(IL7[GetPlayerId((BZ7))])+"|r"+" "+GetObjectName('n064'))
    call unit035(BY7,BZ7)
    call boolean123(20,B67,BL7)
  elseif EZE==4 then
    if BA7==1 then
      if C97==false then
        set BY7=Sentinels[4]
        set BZ7=Sentinels[5]
      else
        set BY7=Sentinels[1]
        set BZ7=Sentinels[1]
      endif
    else
      if C97==false then
        set BY7=Scourges[4]
        set BZ7=Scourges[5]
      else
        set BY7=Scourges[1]
        set BZ7=Scourges[1]
      endif
    endif
    if B37[GetPlayerId(boolean127)]==false then
      call ESE(boolean127,ETE(),true)
    endif
    if B37[GetPlayerId(EBE)]==false then
      call ESE(EBE,ETE(),true)
    endif
    call boolean122(BY7)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(BY7)]+(IL7[GetPlayerId((BY7))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(BZ7)]+(IL7[GetPlayerId((BZ7))])+"|r"+" "+GetObjectName('n064'))
    call unit035(BY7,BZ7)
    call boolean123(20,B67,BL7)
  elseif EZE==5 then
    if BA7==1 then
      if C97==false then
        set BY7=Scourges[5]
      else
        set BY7=Scourges[1]
      endif
    else
      if C97==false then
        set BY7=Sentinels[5]
      else
        set BZ7=Sentinels[1]
      endif
    endif
    if B37[GetPlayerId(boolean127)]==false then
      call ESE(boolean127,ETE(),true)
    endif
    if B37[GetPlayerId(EBE)]==false then
      call ESE(EBE,ETE(),true)
    endif
    call boolean122(BY7)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(BY7)]+(IL7[GetPlayerId((BY7))])+"|r"+" "+GetObjectName('n064'))
    call unit035(BY7,BZ7)
    call boolean123(20,B67,BL7)
  elseif EZE==6 then
    if B37[GetPlayerId(boolean127)]==false then
      call ESE(boolean127,ETE(),true)
    endif
    call SuspendTimeOfDay(false)
  endif
  if EZE==7 then
    set BC7=true
  endif
  if EZE==8 then
    call D2E()
    set i=1
    loop
      exitwhen i>20
      call RemoveUnit(BH7[i])
      set i=i+1
    endloop
    call VI9()
    call ZOD(60)
    call UnitApplyTimedLife(BE7[1],'BTLF',2)
    call UnitApplyTimedLife(BE7[2],'BTLF',2)
    call UnitApplyTimedLife(BE7[3],'BTLF',2)
    call UnitApplyTimedLife(BE7[4],'BTLF',2)
    call UnitApplyTimedLife(BE7[5],'BTLF',2)
    call UnitApplyTimedLife(BE7[6],'BTLF',2)
    call UnitApplyTimedLife(BE7[7],'BTLF',2)
    call UnitApplyTimedLife(BE7[8],'BTLF',2)
    call UnitApplyTimedLife(BE7[9],'BTLF',2)
    call UnitApplyTimedLife(BE7[10],'BTLF',2)
    call UnitApplyTimedLife(BE7[11],'BTLF',2)
    call UnitApplyTimedLife(BE7[12],'BTLF',2)
    call CleanTrigger(C47)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,7,false)
    call TriggerAddCondition(t,Condition(function D5E))
  else
    call SaveInteger(hashtable019,(Cache),(25),(EZE+1))
  endif
  set t=null
  set boolean127=null
  set EBE=null
  return false
endfunction

function unit036 takes unit Hero returns integer
  local integer i=1
  loop
    exitwhen i>20
    if BH7[i]==Hero then
      return i
    endif
    set i=i+1
  endloop
  return 0
endfunction

function boolean132 takes nothing returns boolean
  local unit Sold=GetSoldUnit()
  local player p=GetOwningPlayer(Sold)
  call KillUnit(Sold)
  if B37[GetPlayerId(p)] then
    call Error(p,GetObjectName('n0D7'))
    set Sold=null
    set p=null
    return false
  endif
  if p!=BY7 and p!=BZ7 then
    call Error(p,GetObjectName('n0CR'))
    set Sold=null
    set p=null
    return false
  endif
  if GetUnitTypeId(Sold)=='h06N' then
    call ESE(p,unit036(GetSellingUnit()),false)
    call KillUnit(C77[GetPlayerId(p)])
    call KillUnit(C87[GetPlayerId(p)])
  endif
  set Sold=null
  set p=null
  return false
endfunction

function ModeRD_Selected takes nothing returns boolean
  local unit E6E=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local player p=GetOwningPlayer(E6E)
  if GetSpellAbilityId()=='A0ZB' and unit036(Target)!=0 then
    if(p==BY7 or p==BZ7)and B37[GetPlayerId(p)]==false and BG7[unit036(Target)]==false then
      call ESE(p,unit036(Target),false)
      call RemoveUnit(E6E)
    endif
  endif
  set Target=null
  set p=null
  set E6E=null
  return false
endfunction

function ELE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache
  local integer i=1
  call CleanTrigger(t)
  call SuspendTimeOfDay(true)
  set BA7=GetRandomInt(1,2)
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.," ")
  if BA7==1 then
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,GetObjectName('n05K')+" "+udg_Colors[GetPlayerId(Sentinels[0])]+GetObjectName('n065')+"|r"+" "+GetObjectName('n066'))
  else
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,GetObjectName('n05K')+" "+udg_Colors[GetPlayerId(Scourges[0])]+GetObjectName('n06C')+"|r"+" "+GetObjectName('n066'))
  endif
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.," ")
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,20,true)
  call TriggerAddCondition(t,Condition(function EYE))
  call SaveInteger(hashtable019,(Cache),(25),(0))
  call TriggerEvaluate(t)
  set t=null
  return false
endfunction

function ModeRD_SetCap takes nothing returns boolean
  if C97==false then
    set C97=true
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,GetObjectName('n0GD'))
  endif
  return false
endfunction

function LID takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer i=1
  local real x
  local real y
  local real a
  local integer r
  local integer VA8
  local boolean boolean134=false
  local boolean E0E=false
  local boolean boolean133=false
  local boolean timer005=false
  local boolean F4E=false
  local boolean F7E=false
  local boolean F8E=false
  local boolean F9E=false
  local boolean FDE=false
  local boolean array FEE
  local player p
  local real offset
  local boolean FFE=false
  local real z
  set AFK_Check=false
  set C47=CreateTrigger()
  call TriggerAddCondition(C47,Condition(function boolean132))
  call SoundForPlayer(GetLocalPlayer(),"Sound\\Interface\\Rescue.wav")
  set p=Sentinels[1]
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Sentinels[2]
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Sentinels[3]
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Sentinels[4]
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Sentinels[5]
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Scourges[1]
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Scourges[2]
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Scourges[3]
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Scourges[4]
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Scourges[5]
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  call TriggerRegisterTimerEvent(t,15-TimerGetElapsed(GlobalTimer),false)
  call TriggerAddCondition(t,Condition(function ELE))
  set BB7=true
  set CreepSpawnTime=180
  set udg_Allow_Repick=false
  set udg_Allow_Random=false
  call UnitAddAbility(TavernIntSent1,'Agho')
  call UnitAddAbility(TavernIntSent2,'Agho')
  call UnitAddAbility(TavernIntScourge1,'Agho')
  call UnitAddAbility(TavernIntScourge2,'Agho')
  call UnitAddAbility(TavernStrSent1,'Agho')
  call UnitAddAbility(TavernStrSent2,'Agho')
  call UnitAddAbility(TavernStrScrouge1,'Agho')
  call UnitAddAbility(TavernStrScrouge2,'Agho')
  call UnitAddAbility(TavernAgiSent1,'Agho')
  call UnitAddAbility(TavernAgiSent2,'Agho')
  call UnitAddAbility(TavernAgiScourge1,'Agho')
  call UnitAddAbility(TavernAgiScourge2,'Agho')
  call ShowUnit(TavernIntSent1,false)
  call ShowUnit(TavernIntSent2,false)
  call ShowUnit(TavernIntScourge1,false)
  call ShowUnit(TavernIntScourge2,false)
  call ShowUnit(TavernStrSent1,false)
  call ShowUnit(TavernStrSent2,false)
  call ShowUnit(TavernStrScrouge1,false)
  call ShowUnit(TavernStrScrouge2,false)
  call ShowUnit(TavernAgiSent1,false)
  call ShowUnit(TavernAgiSent2,false)
  call ShowUnit(TavernAgiScourge1,false)
  call ShowUnit(TavernAgiScourge2,false)
  set i=1
  loop
    exitwhen i>20
    set VA8=WU8(true,true)
    if boolean134 then
      set boolean134=false
      set VA8=50
    elseif E0E then
      set E0E=false
      set VA8=51
    elseif boolean133 then
      set boolean133=false
      set VA8=104
    elseif timer005 then
      set timer005=false
      set VA8=65
    elseif F4E then
      set F4E=false
      set VA8=49
    elseif F7E then
      set F7E=false
      if GetRandomInt(1,2)==1 then
        set VA8=16
      else
        set VA8=86
      endif
    elseif F8E then
      set F8E=false
      if GetRandomInt(1,2)==1 then
        set VA8=73
      else
        set VA8=83
      endif
    elseif F9E then
      set F9E=false
    elseif FDE then
      set FDE=false
    endif
    if FEE[VA8]==false and((VA8)!=23)then
      set FEE[VA8]=true
      set BF7[i]=VA8
      set i=i+1
    endif
  endloop
  set BE7[1]=CreateUnit(Sentinels[0],'n0DC',RD_CenterX_Sent,RD_CenterY_Sent,0)
  set BE7[2]=CreateUnit(Sentinels[1],'n0DC',RD_CenterX_Sent,RD_CenterY_Sent,0)
  set BE7[3]=CreateUnit(Sentinels[2],'n0DC',RD_CenterX_Sent,RD_CenterY_Sent,0)
  set BE7[4]=CreateUnit(Sentinels[3],'n0DC',RD_CenterX_Sent,RD_CenterY_Sent,0)
  set BE7[5]=CreateUnit(Sentinels[4],'n0DC',RD_CenterX_Sent,RD_CenterY_Sent,0)
  set BE7[6]=CreateUnit(Sentinels[5],'n0DC',RD_CenterX_Sent,RD_CenterY_Sent,0)
  set BE7[7]=CreateUnit(Scourges[0],'n0DC',BT7,BU7,0)
  set BE7[8]=CreateUnit(Scourges[1],'n0DC',BT7,BU7,0)
  set BE7[9]=CreateUnit(Scourges[2],'n0DC',BT7,BU7,0)
  set BE7[10]=CreateUnit(Scourges[3],'n0DC',BT7,BU7,0)
  set BE7[11]=CreateUnit(Scourges[4],'n0DC',BT7,BU7,0)
  set BE7[12]=CreateUnit(Scourges[5],'n0DC',BT7,BU7,0)
  call PanCameraToTimedForPlayer(Sentinels[1],RD_CenterX_Sent,RD_CenterY_Sent,0)
  call PanCameraToTimedForPlayer(Sentinels[2],RD_CenterX_Sent,RD_CenterY_Sent,0)
  call PanCameraToTimedForPlayer(Sentinels[3],RD_CenterX_Sent,RD_CenterY_Sent,0)
  call PanCameraToTimedForPlayer(Sentinels[4],RD_CenterX_Sent,RD_CenterY_Sent,0)
  call PanCameraToTimedForPlayer(Sentinels[5],RD_CenterX_Sent,RD_CenterY_Sent,0)
  call PanCameraToTimedForPlayer(Scourges[1],RD_CenterX_Sent,RD_CenterY_Sent,0)
  call PanCameraToTimedForPlayer(Scourges[2],RD_CenterX_Sent,RD_CenterY_Sent,0)
  call PanCameraToTimedForPlayer(Scourges[3],RD_CenterX_Sent,RD_CenterY_Sent,0)
  call PanCameraToTimedForPlayer(Scourges[4],RD_CenterX_Sent,RD_CenterY_Sent,0)
  call PanCameraToTimedForPlayer(Scourges[5],RD_CenterX_Sent,RD_CenterY_Sent,0)
  set B67=RD_CenterX_Sent
  set BL7=RD_CenterY_Sent
  set B17=BT7
  set B07=BU7
  set BI7[1]=RD_CenterX_Sent+BW7*(-2)
  set BJ7[1]=RD_CenterY_Sent+BX7
  set BI7[2]=RD_CenterX_Sent+BW7*(-1)
  set BJ7[2]=RD_CenterY_Sent+BX7
  set BI7[3]=RD_CenterX_Sent+BW7*(0)
  set BJ7[3]=RD_CenterY_Sent+BX7
  set BI7[4]=RD_CenterX_Sent+BW7*(1)
  set BJ7[4]=RD_CenterY_Sent+BX7
  set BI7[5]=RD_CenterX_Sent+BW7*(2)
  set BJ7[5]=RD_CenterY_Sent+BX7
  set BK7[1]=RD_CenterX_Sent+BW7*(-2)
  set BM7[1]=RD_CenterY_Sent-BX7
  set BK7[2]=RD_CenterX_Sent+BW7*(-1)
  set BM7[2]=RD_CenterY_Sent-BX7
  set BK7[3]=RD_CenterX_Sent+BW7*(0)
  set BM7[3]=RD_CenterY_Sent-BX7
  set BK7[4]=RD_CenterX_Sent+BW7*(1)
  set BM7[4]=RD_CenterY_Sent-BX7
  set BK7[5]=RD_CenterX_Sent+BW7*(2)
  set BM7[5]=RD_CenterY_Sent-BX7
  set BN7[1]=BT7+BW7*(-2)
  set BO7[1]=BU7+BX7
  set BN7[2]=BT7+BW7*(-1)
  set BO7[2]=BU7+BX7
  set BN7[3]=BT7+BW7*(0)
  set BO7[3]=BU7+BX7
  set BN7[4]=BT7+BW7*(1)
  set BO7[4]=BU7+BX7
  set BN7[5]=BT7+BW7*(2)
  set BO7[5]=BU7+BX7
  set BP7[1]=BT7+BW7*(-2)
  set BQ7[1]=BU7-BX7
  set BP7[2]=BT7+BW7*(-1)
  set BQ7[2]=BU7-BX7
  set BP7[3]=BT7+BW7*(0)
  set BQ7[3]=BU7-BX7
  set BP7[4]=BT7+BW7*(1)
  set BQ7[4]=BU7-BX7
  set BP7[5]=BT7+BW7*(2)
  set BQ7[5]=BU7-BX7
  set offset=400
  set i=1
  loop
    exitwhen i>20
    if FFE==false then
      set FFE=true
    else
      set FFE=false
    endif
    set a=i/ I2R(20)*360.
    set x=RD_CenterX_Sent+offset*Cos(a*bj_DEGTORAD)
    set y=RD_CenterY_Sent+offset*Sin(a*bj_DEGTORAD)
    set BH7[i]=CreateUnit(Sentinels[0],DummyID[BF7[i]],x,y,AngleBetweenXY(x,y,RD_CenterX_Sent,RD_CenterY_Sent))
    call E4E(x,y)
    if FFE then
      call SetUnitColor(BH7[i],GetPlayerColor(Scourges[5]))
    else
      call SetUnitColor(BH7[i],GetPlayerColor(Scourges[4]))
    endif
    call TriggerRegisterUnitEvent(C47,BH7[i],EVENT_UNIT_SELL)
    set i=i+1
  endloop
  call TechAll()
  set t=null
  set p=null
endfunction

function FGE takes nothing returns boolean
  local unit Sold=GetSoldUnit()
  local player p=GetOwningPlayer(Sold)
  local integer i
  local real x
  local real y
  local real a
  if GetUnitTypeId(Sold)=='h06N' and IsPlayerAlly(GetOwningPlayer(Sold),GetOwningPlayer(GetSellingUnit()))then
    if udg_Hero[GetPlayerId(p)]!=null then
      call Error(p,GetObjectName('n0F3'))
      call KillUnit(Sold)
      set Sold=null
      set p=null
      return false
    endif
    set x=GetUnitX(GetSellingUnit())
    set y=GetUnitY(GetSellingUnit())
    set i=DummyToHero(GetUnitTypeId(GetSellingUnit()))
    set a=GetUnitFacing(GetSellingUnit())
    call RemoveUnit(GetSellingUnit())
    call CreateUnit(p,i,x,y,a)
  endif
  if GetUnitTypeId(Sold)=='h06N' then
    call KillUnit(Sold)
  endif
  if udg_Hero[GetPlayerId(Sentinels[1])]!=null and udg_Hero[GetPlayerId(Sentinels[2])]!=null and udg_Hero[GetPlayerId(Sentinels[3])]!=null and udg_Hero[GetPlayerId(Sentinels[4])]!=null and udg_Hero[GetPlayerId(Sentinels[5])]!=null and udg_Hero[GetPlayerId(Scourges[1])]!=null and udg_Hero[GetPlayerId(Scourges[2])]!=null and udg_Hero[GetPlayerId(Scourges[3])]!=null and udg_Hero[GetPlayerId(Scourges[4])]!=null and udg_Hero[GetPlayerId(Scourges[5])]!=null then
    call CleanTrigger(GetTriggeringTrigger())
  endif
  set Sold=null
  set p=null
  return false
endfunction

function FHE takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Seconds
  local integer Minutes
  local string Time
  local unit u
  local real x
  local real y
  local integer i
  local real d
  local real SentX=GetRectCenterX(gg_rct_Hero_Creation_NE)+125
  local real SentY=GetRectCenterY(gg_rct_Hero_Creation_NE)+75
  local real ScourgeX=GetRectCenterX(gg_rct_Hero_Creation_UD)+100
  local real ScourgeY=GetRectCenterY(gg_rct_Hero_Creation_UD)
  set HeroDamageTracking_Enabled=true
  set i=1
  loop
    exitwhen i>5
    set x=SentX-290+(i-1)*100
    set y=SentY
    call CreateUnit(Sentinels[i+1],'n00C',SentX,SentY,bj_UNIT_FACING)
    set u=CreateUnit(Sentinels[0],DummyID[CP7[i+2]],x,y,270)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_SELL)
    call PanCameraToTimedForPlayer(Sentinels[i],SentX,SentY,0)
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>5
    set x=ScourgeX-290+(i-1)*100
    set y=ScourgeY
    call CreateUnit(Scourges[i+1],'n00C',ScourgeX,ScourgeY,bj_UNIT_FACING)
    set u=CreateUnit(Scourges[0],DummyID[CQ7[i+2]],x,y,270)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_SELL)
    call PanCameraToTimedForPlayer(Scourges[i],ScourgeX,ScourgeY,0)
    set i=i+1
  endloop
  call TriggerAddCondition(t,Condition(function FGE))
  call SuspendTimeOfDay(false)
  call EnableTrigger(OneHero)
  call EnableTrigger(HeroEnters)
  set CreepSpawnTime=90
  call ModePicked()
  set t=null
  set u=null
endfunction

function FIE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  set boolean193=true
  call CleanTrigger(t)
  call DestroyFogModifier(CreateFogModifierRadius(Sentinels[0],FOG_OF_WAR_MASKED,AO7,AP7,700,false,false))
  call DestroyFogModifier(CreateFogModifierRadius(Scourges[0],FOG_OF_WAR_MASKED,AO7,AP7,700,false,false))
  set t=null
  return false
endfunction

function FJE takes string S,real SizeX,real SizeY,real PosX,real PosY,real PosZ,boolean Show returns nothing
  set tt_image1=CreateImage(S,SizeX,SizeY,0,PosX-(SizeX/ 2),PosY-(SizeY/ 2),PosZ,0,0,0,2)
  call SetImageRenderAlways(tt_image1,true)
  call ShowImage(tt_image1,Show)
endfunction

function FKE takes string FME,integer r,integer g,integer b,integer a,real x,real y returns image
  call FJE("Fonts\\"+FME+".blp",60,60,x-20,y,0,true)
  call SetImageColor(tt_image1,r,g,b,a)
  return tt_image1
endfunction

function FNE takes boolean FOE,boolean FPE returns nothing
  local integer FQE
  local integer FRE
  local integer FSE
  local integer FTE
  local integer FUE
  local integer FVE
  local integer FWE
  local integer FXE
  local integer c1
  local integer c2
  local integer a=0
  set FQE=CM7[1]
  set FRE=FQE/ 60
  set FSE=(FQE-FRE*60)/ 10
  set FTE=FQE-FRE*60-FSE*10
  set FUE=CM7[2]
  set FVE=FUE/ 60
  set FWE=(FUE-FVE*60)/ 10
  set FXE=FUE-FVE*60-FWE*10
  if FOE==false then
    call ShowImage(CZ7,false)
    call DestroyImage(CZ7)
    call ShowImage(CA7,false)
    call DestroyImage(CA7)
    call ShowImage(CB7,false)
    call DestroyImage(CB7)
    call ShowImage(CC7,false)
    call DestroyImage(CC7)
    call ShowImage(C37,false)
    call DestroyImage(C37)
    call ShowImage(C67,false)
    call DestroyImage(C67)
    call ShowImage(CL7,false)
    call DestroyImage(CL7)
    call ShowImage(C17,false)
    call DestroyImage(C17)
    call ShowImage(C07,false)
    call DestroyImage(C07)
    call ShowImage(C57,false)
    call DestroyImage(C57)
    call ShowImage(C27,false)
    call DestroyImage(C27)
    call ShowImage(L47,false)
    call DestroyImage(L47)
    call ShowImage(L77,false)
    call DestroyImage(L77)
    call ShowImage(L87,false)
    call DestroyImage(L87)
    call ShowImage(L97,false)
    call DestroyImage(L97)
    call ShowImage(LD7,false)
    call DestroyImage(LD7)
  endif
  if FPE==false then
    set c1=255
    set c2=255
    if CK7==1 then
      if IsPlayerAlly(Sentinels[1],GetLocalPlayer())then
        set a=255
        set c1=0
      endif
    else
      if IsPlayerAlly(Scourges[1],GetLocalPlayer())then
        set a=255
        set c2=0
      endif
    endif
    set CZ7=FKE(I2S(FRE),255,c1,c1,255,AO7-40,AP7+300)
    set CA7=FKE("58",255,c1,c1,255,AO7-0,AP7+300)
    set CB7=FKE(I2S(FSE),255,c1,c1,255,AO7+20,AP7+300)
    set CC7=FKE(I2S(FTE),255,c1,c1,255,AO7+60,AP7+300)
    set C37=FKE(I2S(FVE),255,c2,c2,255,AO7-40,AP7-300)
    set C67=FKE("58",255,c2,c2,255,AO7-0,AP7-300)
    set CL7=FKE(I2S(FWE),255,c2,c2,255,AO7+20,AP7-300)
    set C17=FKE(I2S(FXE),255,c2,c2,255,AO7+60,AP7-300)
    if CN7==1 or CN7==2 or CN7==3 or CN7==4 then
      set C07=FKE("Y",255,0,0,a,AO7-130,AP7)
      set C57=FKE("O",255,0,0,a,AO7-90,AP7)
      set C27=FKE("U",255,0,0,a,AO7-50,AP7)
      set L47=FKE("R",255,0,0,a,AO7-10,AP7)
      set L77=FKE("B",255,0,0,a,AO7+70,AP7)
      set L87=FKE("A",255,0,0,a,AO7+110,AP7)
      set L97=FKE("N",255,0,0,a,AO7+150,AP7)
      set LD7=FKE("K",255,0,0,0,AO7+170,AP7)
    else
      set C07=FKE("Y",255,0,0,a,AO7-150,AP7)
      set C57=FKE("O",255,0,0,a,AO7-110,AP7)
      set C27=FKE("U",255,0,0,a,AO7-70,AP7)
      set L47=FKE("R",255,0,0,a,AO7-30,AP7)
      set L77=FKE("P",255,0,0,a,AO7+50,AP7)
      set L87=FKE("I",255,0,0,a,AO7+90,AP7)
      set L97=FKE("C",255,0,0,a,AO7+130,AP7)
      set LD7=FKE("K",255,0,0,a,AO7+170,AP7)
    endif
  endif
endfunction

function FYE takes nothing returns nothing
  local integer i=0
  loop
    exitwhen i>CH7
    call RemoveUnit(CI7[i])
    set i=i+1
  endloop
endfunction

function FZE takes real x,real y returns nothing
  set CI7[CH7]=CreateUnit(Player(0),'h06I',x,y,0)
  set CH7=CH7+1
endfunction

function FAE takes integer FBE,boolean FCE returns nothing
  local player p
  local real d
  set CO7[FBE]=true
  set CX7[CK7]=CX7[CK7]-1
  if CK7==1 then
    set p=Sentinels[1]
    set CR7=CR7+1
    set CP7[CR7]=CE7[FBE]
    if CR7<3 then
      call UnitAddAbility(CG7[FBE],'Aetl')
      call UnitAddAbility(CG7[FBE],'Aloc')
    endif
    call SetUnitPosition(CG7[FBE],CT7[CR7],CU7[CR7])
    set d=RMaxBJ(U18(CG7[FBE])-.3,.5)
    call FZE(CT7[CR7],CU7[CR7])
    call SetUnitScale(CG7[FBE],d,d,d)
    call SetUnitFacing(CG7[FBE],270)
    if FCE==false then
      if CN7==1 or CN7==2 or CN7==3 or CN7==4 then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r "+GetObjectName('n0H5')+" "+GetUnitName(CG7[FBE]))
        call Traffic_RegisterData("Ban"+I2S(GetPlayerId(p)),HeroID[CE7[FBE]])
      else
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r "+GetObjectName('n0H6')+" "+GetUnitName(CG7[FBE]))
        call Traffic_RegisterData("Pick"+I2S(GetPlayerId(p)),HeroID[CE7[FBE]])
      endif
    else
      if CN7==1 or CN7==2 or CN7==3 or CN7==4 then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r "+GetObjectName('n0H7')+" "+GetUnitName(CG7[FBE]))
        call Traffic_RegisterData("Ban"+I2S(GetPlayerId(p)),HeroID[CE7[FBE]])
      else
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r "+GetObjectName('n0H8')+" "+GetUnitName(CG7[FBE]))
        call Traffic_RegisterData("Pick"+I2S(GetPlayerId(p)),HeroID[CE7[FBE]])
      endif
    endif
  else
    set p=Scourges[1]
    set CS7=CS7+1
    set CQ7[CS7]=CE7[FBE]
    if CS7<3 then
      call UnitAddAbility(CG7[FBE],'Aetl')
      call UnitAddAbility(CG7[FBE],'Aloc')
    endif
    call SetUnitPosition(CG7[FBE],CV7[CS7],CW7[CS7])
    set d=RMaxBJ(U18(CG7[FBE])-.3,.5)
    call FZE(CV7[CS7],CW7[CS7])
    call SetUnitScale(CG7[FBE],d,d,d)
    call SetUnitFacing(CG7[FBE],90)
    if FCE==false then
      if CN7==1 or CN7==2 or CN7==3 or CN7==4 then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r "+GetObjectName('n0H5')+" "+GetUnitName(CG7[FBE]))
        call Traffic_RegisterData("Ban"+I2S(GetPlayerId(p)),HeroID[CE7[FBE]])
      else
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r "+GetObjectName('n0H6')+" "+GetUnitName(CG7[FBE]))
        call Traffic_RegisterData("Pick"+I2S(GetPlayerId(p)),HeroID[CE7[FBE]])
      endif
    else
      if CN7==1 or CN7==2 or CN7==3 or CN7==4 then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r "+GetObjectName('n0H7')+" "+GetUnitName(CG7[FBE]))
        call Traffic_RegisterData("Ban"+I2S(GetPlayerId(p)),HeroID[CE7[FBE]])
      else
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,udg_Colors[GetPlayerId(p)]+(IL7[GetPlayerId((p))])+"|r "+GetObjectName('n0H8')+" "+GetUnitName(CG7[FBE]))
        call Traffic_RegisterData("Pick"+I2S(GetPlayerId(p)),HeroID[CE7[FBE]])
      endif
    endif
  endif
  call PauseUnit(CG7[FBE],true)
  call SetUnitOwner(CG7[FBE],p,true)
  set p=null
endfunction

function F3E takes unit Hero returns integer
  local integer i=1
  loop
    exitwhen i>28
    if CG7[i]==Hero then
      return i
    endif
    set i=i+1
  endloop
  return 0
endfunction

function F6E takes nothing returns nothing
  local integer i
  loop
    set i=GetRandomInt(1,28)
    exitwhen CO7[i]==false
  endloop
  call FAE(i,true)
endfunction

function FLE takes nothing returns boolean
  local unit Sold=GetSoldUnit()
  local player p=GetOwningPlayer(Sold)
  local integer id=GetPlayerId(p)
  local player F1E
  if CK7==1 then
    set F1E=Sentinels[1]
  else
    set F1E=Scourges[1]
  endif
  call KillUnit(Sold)
  if CY7 or CX7[CK7]<1 or p!=F1E then
    call Error(p,GetObjectName('n0CR'))
  elseif GetUnitTypeId(Sold)=='h06N' then
    call FAE(F3E(GetSellingUnit()),false)
  endif
  set p=null
  set Sold=null
  set F1E=null
  return false
endfunction

function F0E takes nothing returns boolean
  local integer i=1
  local trigger t
  call CleanTrigger(GetTriggeringTrigger())
  loop
    exitwhen i>28
    call RemoveUnit(CG7[i])
    set i=i+1
  endloop
  call SuspendTimeOfDay(false)
  call FYE()
  call VI9()
  call ZOD(90)
  call UnitApplyTimedLife(CF7[1],'BTLF',2)
  call UnitApplyTimedLife(CF7[2],'BTLF',2)
  call UnitApplyTimedLife(CF7[3],'BTLF',2)
  call UnitApplyTimedLife(CF7[4],'BTLF',2)
  call UnitApplyTimedLife(CF7[5],'BTLF',2)
  call UnitApplyTimedLife(CF7[6],'BTLF',2)
  call UnitApplyTimedLife(CF7[7],'BTLF',2)
  call UnitApplyTimedLife(CF7[8],'BTLF',2)
  call UnitApplyTimedLife(CF7[9],'BTLF',2)
  call UnitApplyTimedLife(CF7[10],'BTLF',2)
  call UnitApplyTimedLife(CF7[11],'BTLF',2)
  call UnitApplyTimedLife(CF7[12],'BTLF',2)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,7,false)
  call TriggerAddCondition(t,Condition(function FIE))
  set t=null
  call FHE()
  return false
endfunction

function F5E takes nothing returns boolean
  local integer i
  local trigger t
  local force f
  local string c="|c006699CC"
  set CM7[CK7]=IMaxBJ(CM7[CK7]-1,0)
  call FNE(false,false)
  if CX7[CK7]<1 then
    if CK7==1 then
      call SoundForPlayer(Sentinels[1],"Sound\\Interface\\Rescue.wav")
      call SoundForPlayer(Sentinels[2],"Sound\\Interface\\Rescue.wav")
      call SoundForPlayer(Sentinels[3],"Sound\\Interface\\Rescue.wav")
      call SoundForPlayer(Sentinels[4],"Sound\\Interface\\Rescue.wav")
      call SoundForPlayer(Sentinels[5],"Sound\\Interface\\Rescue.wav")
    else
      call SoundForPlayer(Scourges[1],"Sound\\Interface\\Rescue.wav")
      call SoundForPlayer(Scourges[2],"Sound\\Interface\\Rescue.wav")
      call SoundForPlayer(Scourges[3],"Sound\\Interface\\Rescue.wav")
      call SoundForPlayer(Scourges[4],"Sound\\Interface\\Rescue.wav")
      call SoundForPlayer(Scourges[5],"Sound\\Interface\\Rescue.wav")
    endif
    set CN7=CN7+1
    if CK7==1 then
      set CK7=2
      set f=Force_ScourgePlayers
    else
      set CK7=1
      set f=Force_SentPlayers
    endif
    set CM7[CK7]=IMaxBJ(CM7[CK7],6)
    if CN7==1 or CN7==2 or CN7==3 or CN7==4 then
      set CX7[CK7]=1
      call DisplayTimedTextToForceEx(f,15,c+GetObjectName('n0H2')+"|r")
    elseif CN7==5 then
      set CX7[CK7]=1
      call DisplayTimedTextToForceEx(f,15,c+GetObjectName('n0H3')+"|r")
    elseif CN7==6 or CN7==7 or CN7==8 or CN7==9 then
      set CX7[CK7]=2
      call DisplayTimedTextToForceEx(f,15,c+GetObjectName('n0H4')+"|r")
    elseif CN7==10 then
      set CX7[CK7]=1
      call DisplayTimedTextToForceEx(f,15,c+GetObjectName('n0H3')+"|r")
    else
      call FNE(false,true)
      call CleanTrigger(GetTriggeringTrigger())
      call CleanTrigger(CD7)
      set t=CreateTrigger()
      call TriggerRegisterTimerEvent(t,6,false)
      call TriggerAddCondition(t,Condition(function F0E))
      set t=null
      call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,GetObjectName('n0H9'))
    endif
  elseif CM7[CK7]==0 then
    call F6E()
  endif
  set f=null
  return false
endfunction

function F2E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local force f
  local string c="|c006699CC"
  call CleanTrigger(t)
  set CJ7=GetRandomInt(1,2)
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.," ")
  if CJ7==1 then
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,GetObjectName('n05K')+" "+udg_Colors[GetPlayerId(Sentinels[0])]+GetObjectName('n065')+"|r"+" "+GetObjectName('n066'))
  else
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,GetObjectName('n05K')+" "+udg_Colors[GetPlayerId(Scourges[0])]+GetObjectName('n06C')+"|r"+" "+GetObjectName('n066'))
  endif
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.," ")
  set CK7=CJ7
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function F5E))
  set CM7[1]=150
  set CM7[2]=150
  set CN7=1
  set CX7[CK7]=1
  call FNE(true,false)
  if CK7==1 then
    set f=Force_SentPlayers
  else
    set f=Force_ScourgePlayers
  endif
  call DisplayTimedTextToForceEx(f,15,c+GetObjectName('n0H2')+"|r")
  set CY7=false
  set t=null
  set f=null
  return false
endfunction

function LCD takes nothing returns nothing
  local integer i
  local player p
  local boolean FFE=false
  local real a
  local real x
  local real y
  local trigger t
  local integer VA8
  local boolean boolean134=false
  local boolean E0E=false
  local boolean boolean133=false
  local boolean timer005=false
  local boolean F4E=false
  local boolean F7E=false
  local boolean F8E=false
  local boolean F9E=false
  local boolean FDE=false
  local integer z
  local string c="|c006699CC"
  local boolean array FEE
  call RestrictHeroes()
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,15,false)
  call TriggerAddCondition(t,Condition(function F2E))
  set t=null
  set CK7=-1
  set AFK_Check=false
  set Mode_CD=true
  set udg_Allow_Repick=false
  set udg_Allow_Random=false
  set HeroDamageTracking_Enabled=false
  call SoundForPlayer(GetLocalPlayer(),"Sound\\Interface\\Rescue.wav")
  call SuspendTimeOfDay(true)
  set CD7=CreateTrigger()
  call UnitAddAbility(TavernIntSent1,'Agho')
  call UnitAddAbility(TavernIntSent2,'Agho')
  call UnitAddAbility(TavernIntScourge1,'Agho')
  call UnitAddAbility(TavernIntScourge2,'Agho')
  call UnitAddAbility(TavernStrSent1,'Agho')
  call UnitAddAbility(TavernStrSent2,'Agho')
  call UnitAddAbility(TavernStrScrouge1,'Agho')
  call UnitAddAbility(TavernStrScrouge2,'Agho')
  call UnitAddAbility(TavernAgiSent1,'Agho')
  call UnitAddAbility(TavernAgiSent2,'Agho')
  call UnitAddAbility(TavernAgiScourge1,'Agho')
  call UnitAddAbility(TavernAgiScourge2,'Agho')
  set p=Sentinels[1]
  set CF7[1]=CreateUnit(p,'n0DC',AO7,AP7,0)
  call PanCameraToTimedForPlayer(p,AO7,AP7,0)
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Sentinels[2]
  set CF7[2]=CreateUnit(p,'n0DC',AO7,AP7,0)
  call PanCameraToTimedForPlayer(p,AO7,AP7,0)
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Sentinels[3]
  set CF7[3]=CreateUnit(p,'n0DC',AO7,AP7,0)
  call PanCameraToTimedForPlayer(p,AO7,AP7,0)
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Sentinels[4]
  set CF7[4]=CreateUnit(p,'n0DC',AO7,AP7,0)
  call PanCameraToTimedForPlayer(p,AO7,AP7,0)
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Sentinels[5]
  set CF7[5]=CreateUnit(p,'n0DC',AO7,AP7,0)
  call PanCameraToTimedForPlayer(p,AO7,AP7,0)
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Scourges[1]
  set CF7[6]=CreateUnit(p,'n0DC',AO7,AP7,0)
  call PanCameraToTimedForPlayer(p,AO7,AP7,0)
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Scourges[2]
  set CF7[7]=CreateUnit(p,'n0DC',AO7,AP7,0)
  call PanCameraToTimedForPlayer(p,AO7,AP7,0)
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Scourges[3]
  set CF7[8]=CreateUnit(p,'n0DC',AO7,AP7,0)
  call PanCameraToTimedForPlayer(p,AO7,AP7,0)
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Scourges[4]
  set CF7[9]=CreateUnit(p,'n0DC',AO7,AP7,0)
  call PanCameraToTimedForPlayer(p,AO7,AP7,0)
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set p=Scourges[5]
  set CF7[10]=CreateUnit(p,'n0DC',AO7,AP7,0)
  call PanCameraToTimedForPlayer(p,AO7,AP7,0)
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
  set CT7[1]=AO7+LF7*(-3.5)
  set CU7[1]=AP7+LG7
  set CT7[2]=AO7+LF7*(3.5)
  set CU7[2]=AP7+LG7
  set CT7[3]=AO7+LF7*(-2)
  set CU7[3]=AP7+LG7
  set CT7[4]=AO7+LF7*(-1)
  set CU7[4]=AP7+LG7
  set CT7[5]=AO7+LF7*(0)
  set CU7[5]=AP7+LG7
  set CT7[6]=AO7+LF7*(1)
  set CU7[6]=AP7+LG7
  set CT7[7]=AO7+LF7*(2)
  set CU7[7]=AP7+LG7
  set CV7[1]=AO7+LF7*(-3.5)
  set CW7[1]=AP7-LG7
  set CV7[2]=AO7+LF7*(3.5)
  set CW7[2]=AP7-LG7
  set CV7[3]=AO7+LF7*(-2)
  set CW7[3]=AP7-LG7
  set CV7[4]=AO7+LF7*(-1)
  set CW7[4]=AP7-LG7
  set CV7[5]=AO7+LF7*(0)
  set CW7[5]=AP7-LG7
  set CV7[6]=AO7+LF7*(1)
  set CW7[6]=AP7-LG7
  set CV7[7]=AO7+LF7*(2)
  set CW7[7]=AP7-LG7
  call KillTrees(AO7,AP7,600)
  set i=1
  loop
    exitwhen i>28
    set VA8=WU8(true,true)
    if boolean134 then
      set boolean134=false
      set VA8=50
    elseif E0E then
      set E0E=false
      set VA8=51
    elseif boolean133 then
      set boolean133=false
      set VA8=104
    elseif timer005 then
      set timer005=false
      set VA8=65
    elseif F4E then
      set F4E=false
      set VA8=49
    elseif F7E then
      set F7E=false
      if GetRandomInt(1,2)==1 then
        set VA8=16
      else
        set VA8=86
      endif
    elseif F8E then
      set F8E=false
      if GetRandomInt(1,2)==1 then
        set VA8=73
      else
        set VA8=83
      endif
    elseif F9E then
      set F9E=false
    elseif FDE then
      set FDE=false
    endif
    if FEE[VA8]==false then
      set FEE[VA8]=true
      set CE7[i]=VA8
      call Traffic_RegisterData("Pool"+I2S(i),HeroID[CE7[i]])
      if FFE==false then
        set FFE=true
      else
        set FFE=false
      endif
      set a=(i/ I2R(28))*360.
      set x=AO7+450*Cos(a*bj_DEGTORAD)
      set y=AP7+450*Sin(a*bj_DEGTORAD)
      set CG7[i]=CreateUnit(Sentinels[0],DummyID[CE7[i]],x,y,AngleBetweenXY(x,y,AO7,AP7))
      call SetUnitPathing(CG7[i],false)
      call SetUnitX(CG7[i],x)
      call SetUnitY(CG7[i],y)
      call FZE(x,y)
      if FFE then
        call SetUnitColor(CG7[i],GetPlayerColor(Scourges[5]))
      else
        call SetUnitColor(CG7[i],GetPlayerColor(Scourges[4]))
      endif
      set CO7[i]=false
      call TriggerRegisterUnitEvent(CD7,CG7[i],EVENT_UNIT_SELL)
      set i=i+1
    endif
  endloop
  call TriggerAddCondition(CD7,Condition(function FLE))
  call TechAll()
  set p=null
  set t=null
endfunction

function G4E takes player p,integer U38 returns nothing
  local integer i=1
  loop
    exitwhen i>5
    if p!=Sentinels[i]then
      call SetPlayerTechMaxAllowed(Sentinels[i],U38,0)
    endif
    if p!=Scourges[i]then
      call SetPlayerTechMaxAllowed(Scourges[i],U38,0)
    endif
    set i=i+1
  endloop
endfunction

function ModeSD_Chosen takes nothing returns boolean
  local string VHD=GetEventPlayerChatString()
  local integer a=S2I(SubString(VHD,6,StringLength(VHD)))
  local integer U38
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local location SpawnSent=GetRectCenter(G4)
  local location SpawnScourge=GetRectCenter(F4)
  local player p=GetTriggerPlayer()
  if a==1 then
    set U38=(LoadInteger(hashtable019,(Cache),(166)))
  elseif a==2 then
    set U38=(LoadInteger(hashtable019,(Cache),(167)))
  elseif a==3 then
    set U38=(LoadInteger(hashtable019,(Cache),(168)))
  else
    call RemoveLocation(SpawnSent)
    call RemoveLocation(SpawnScourge)
    set SpawnSent=null
    set SpawnScourge=null
    return false
  endif
  if GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)>=250 then
    if IsSentinel(p)then
      set udg_Hero[GetPlayerId(p)]=CreateUnitAtLoc(p,HeroID[U38],SpawnSent,0)
      set HeroTypeId[GetPlayerId(p)]=HeroID[U38]
    else
      set udg_Hero[GetPlayerId(p)]=CreateUnitAtLoc(p,HeroID[U38],SpawnScourge,0)
      set HeroTypeId[GetPlayerId(p)]=HeroID[U38]
    endif
    call BL8(p)
    call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-250)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call Error(p,GetObjectName('n033'))
  endif
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  set SpawnSent=null
  set SpawnScourge=null
  set t=null
  set p=null
  return false
endfunction

function G7E takes integer G8E returns integer
  local integer VID
  if G8E==1 then
    set VID=GetUnitPointValueByType(AgiHeroesArray[GetRandomInt(1,AgilityHeroesAmount)])
  elseif G8E==2 then
    set VID=GetUnitPointValueByType(StrHeroesArray[GetRandomInt(1,StrHeroesAmount)])
  elseif G8E==3 then
    set VID=GetUnitPointValueByType(IntHeroesArray[GetRandomInt(1,IntHeroesAmount)])
  endif
  return VID
endfunction

function boolean145 takes integer GDE,integer region011,integer G8E returns integer
  local integer WO8
  local integer WP8
  local integer VID
  set VID=G7E(G8E)
  if Mode_DU and GDE!=VID and region011!=VID then
    return VID
  endif
  loop
    exitwhen IsHeroIngame[VID]==false and GDE!=VID and region011!=VID
    set VID=G7E(G8E)
  endloop
  set b_isHeroPicked[VID]=true
  set IsHeroIngame[VID]=true
  return VID
endfunction

function LJD takes nothing returns nothing
  local player p
  local integer i=1
  local integer GFE
  local integer group024
  local integer integers062
  local trigger t
  local integer Cache
  if b_isPickTime then
    return
  endif
  set Mode_SD=true
  set CreepSpawnTime=120
  set udg_Allow_Random=false
  set udg_Allow_Repick=false
  call PauseUnit(TavernIntSent1,true)
  call PauseUnit(TavernIntSent2,true)
  call PauseUnit(TavernIntScourge1,true)
  call PauseUnit(TavernIntScourge2,true)
  call PauseUnit(TavernAgiSent1,true)
  call PauseUnit(TavernAgiSent2,true)
  call PauseUnit(TavernAgiScourge1,true)
  call PauseUnit(TavernAgiScourge2,true)
  call PauseUnit(TavernStrSent1,true)
  call PauseUnit(TavernStrSent2,true)
  call PauseUnit(TavernStrScrouge1,true)
  call PauseUnit(TavernStrScrouge2,true)
  loop
    exitwhen i>5
    set p=Sentinels[i]
    set GFE=0
    set group024=0
    set integers062=0
    if IsPlayer(p)then
      call UnitAddAbility(CirclesOfPower[GetPlayerId(p)],'A14F')
      call UnitAddAbility(CirclesOfPower[GetPlayerId(p)],'A14E')
      call UnitAddAbility(CirclesOfPower[GetPlayerId(p)],'A14H')
      set GFE=boolean145(GFE,group024,1)
      set group024=boolean145(GFE,group024,2)
      set integers062=boolean145(GFE,group024,3)
      call AddUnitToStock(CirclesOfPower[GetPlayerId(p)],HeroID[GFE],1,1)
      call G4E(p,HeroID[GFE])
      call AddUnitToStock(CirclesOfPower[GetPlayerId(p)],HeroID[group024],1,1)
      call G4E(p,HeroID[group024])
      call AddUnitToStock(CirclesOfPower[GetPlayerId(p)],HeroID[integers062],1,1)
      call G4E(p,HeroID[integers062])
      call ClearSelectionForPlayer(p)
      call SelectUnitAddForPlayer(CirclesOfPower[GetPlayerId(p)],p)
      call PanCameraToTimedForPlayer(p,GetRectCenterX(gg_rct_Hero_Creation_NE),GetRectCenterY(gg_rct_Hero_Creation_NE),0)
      call DisplayTimedTextToPlayer(p,0,group008,15," ")
      call DisplayTimedTextToPlayer(p,0,group008,15," ")
      call DisplayTimedTextToPlayer(p,0,group008,15," ")
      call DisplayTimedTextToPlayer(p,0,group008,15,"|cff99ccff"+GetObjectName('n0E6')+"|r")
      call DisplayTimedTextToPlayer(p,0,group008,15," ")
    endif
    set p=Scourges[i]
    set GFE=0
    set group024=0
    set integers062=0
    if IsPlayer(p)then
      call UnitAddAbility(CirclesOfPower[GetPlayerId(p)],'A14F')
      call UnitAddAbility(CirclesOfPower[GetPlayerId(p)],'A14E')
      call UnitAddAbility(CirclesOfPower[GetPlayerId(p)],'A14H')
      set GFE=boolean145(GFE,group024,1)
      set group024=boolean145(GFE,group024,2)
      set integers062=boolean145(GFE,group024,3)
      call AddUnitToStock(CirclesOfPower[GetPlayerId(p)],HeroID[GFE],1,1)
      call G4E(p,HeroID[GFE])
      call AddUnitToStock(CirclesOfPower[GetPlayerId(p)],HeroID[group024],1,1)
      call G4E(p,HeroID[group024])
      call AddUnitToStock(CirclesOfPower[GetPlayerId(p)],HeroID[integers062],1,1)
      call G4E(p,HeroID[integers062])
      call ClearSelectionForPlayer(p)
      call SelectUnitAddForPlayer(CirclesOfPower[GetPlayerId(p)],p)
      call PanCameraToTimedForPlayer(p,GetRectCenterX(gg_rct_Hero_Creation_UD),GetRectCenterY(gg_rct_Hero_Creation_UD),0)
      call DisplayTimedTextToPlayer(p,0,group008,15," ")
      call DisplayTimedTextToPlayer(p,0,group008,15," ")
      call DisplayTimedTextToPlayer(p,0,group008,15," ")
      call DisplayTimedTextToPlayer(p,0,group008,15,"|cff99ccff"+GetObjectName('n0E6')+"|r")
      call DisplayTimedTextToPlayer(p,0,group008,15," ")
    endif
    set i=i+1
  endloop
  set p=null
  set t=null
endfunction

function integer491 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer B78=(LoadInteger(hashtable019,(Cache),(55)))
  local player p
  local integer VA8
  local location SpawnSent=GetRectCenter(gg_rct_Hero_Creation_NE)
  local location SpawnScourge=GetRectCenter(gg_rct_Hero_Creation_UD)
  if B78<6 then
    set p=Sentinels[B78]
  elseif B78<11 then
    set p=Scourges[B78-5]
  endif
  if B78>10 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if Mode_DM==false then
      set udg_Allow_Repick=true
    endif
  elseif B78<6 then
    call SaveInteger(hashtable019,(Cache),(55),(B78+1))
    set udg_Hero[GetPlayerId(p)]=null
    set HeroTypeId[GetPlayerId(p)]=0
    if IsPlayer(p)then
      loop
        exitwhen udg_Hero[GetPlayerId(p)]!=null
        set VA8=GetSetElement()
        if IsHeroIngame[VA8]==false then
          if not Mode_DU then
            set b_isHeroPicked[VA8]=true
            set IsHeroIngame[VA8]=true
          endif
          set udg_Hero[GetPlayerId(p)]=CreateUnitAtLoc(p,HeroID[VA8],SpawnSent,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(p)]=HeroID[VA8]
        endif
      endloop
    endif
  elseif B78<11 then
    call SaveInteger(hashtable019,(Cache),(55),(B78+1))
    set udg_Hero[GetPlayerId(p)]=null
    set HeroTypeId[GetPlayerId(p)]=0
    if IsPlayer(p)then
      loop
        exitwhen udg_Hero[GetPlayerId(p)]!=null
        set VA8=GetSetElement()
        if IsHeroIngame[VA8]==false then
          if not Mode_DU then
            set b_isHeroPicked[VA8]=true
            set IsHeroIngame[VA8]=true
          endif
          set udg_Hero[GetPlayerId(p)]=CreateUnitAtLoc(p,HeroID[VA8],SpawnScourge,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(p)]=HeroID[VA8]
        endif
      endloop
    endif
  endif
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  set SpawnSent=null
  set SpawnScourge=null
  set p=null
  set t=null
  return false
endfunction

function L7D takes nothing returns nothing
  local location SpawnSent=GetRectCenter(gg_rct_Hero_Creation_NE)
  local location SpawnScourge=GetRectCenter(gg_rct_Hero_Creation_UD)
  local location GJE=GetRectCenter(gg_rct_Hero_Creation_NE)
  local location GKE=GetRectCenter(gg_rct_Hero_Creation_UD)
  local integer VT8=1
  local integer VU8=5
  local integer VA8
  local trigger t
  set Mode_AR=true
  set udg_Allow_Random=false
  if not Mode_DU then
    call TechAll()
  endif
  set MinGoldForRepick=250
  call PanCameraToTimedLocForPlayer(Sentinels[1],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[2],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[3],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[4],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[5],GJE,0)
  call PanCameraToTimedLocForPlayer(Scourges[1],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[2],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[3],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[4],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[5],GKE,0)
  if Mode_SH then
    loop
      set VA8=GetSetElement()
      exitwhen IsHeroIngame[VA8]==false
    endloop
    if IsSentinel(PlayerModeTyper)then
      set udg_Hero[GetPlayerId(PlayerModeTyper)]=CreateUnit(PlayerModeTyper,HeroID[VA8],GetLocationX(SpawnSent),GetLocationY(SpawnSent),270)
      set HeroTypeId[GetPlayerId(PlayerModeTyper)]=HeroID[VA8]
    else
      set udg_Hero[GetPlayerId(PlayerModeTyper)]=CreateUnit(PlayerModeTyper,HeroID[VA8],GetLocationX(SpawnScourge),GetLocationY(SpawnScourge),270)
      set HeroTypeId[GetPlayerId(PlayerModeTyper)]=HeroID[VA8]
    endif
    call RemoveLocation(SpawnSent)
    call RemoveLocation(SpawnScourge)
    call RemoveLocation(GJE)
    call RemoveLocation(GKE)
    set SpawnSent=null
    set SpawnScourge=null
    set GJE=null
    set GKE=null
    set t=null
    return
  endif
  set udg_Allow_Repick=false
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function integer491))
  call SaveInteger(hashtable019,(GetHandleId(t)),(55),(1))
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  call RemoveLocation(GJE)
  call RemoveLocation(GKE)
  set SpawnSent=null
  set SpawnScourge=null
  set GJE=null
  set GKE=null
  set t=null
endfunction

function boolean138 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  call CleanTrigger(t)
  set region003=true
  set t=null
  return false
endfunction

function GNE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local trigger boolean142=(LoadTriggerHandle(hashtable019,(Cache),(35)))
  local integer i
  local integer x
  local integer VA8
  local integer boolean143=CountPlayersInForce(Force_SentPlayers)
  local integer boolean144=CountPlayersInForce(Force_ScourgePlayers)
  local location SpawnSent=GetRectCenter(G4)
  local location SpawnScourge=GetRectCenter(F4)
  local location GJE=GetRectCenter(gg_rct_Hero_Creation_NE)
  local location GKE=GetRectCenter(gg_rct_Hero_Creation_UD)
  call CleanTrigger(boolean142)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set LR7=(LoadInteger(hashtable019,(2001),(126)))
  set LS7=(LoadInteger(hashtable019,(2001),(127)))
  set LT7=(LoadInteger(hashtable019,(2001),(128)))
  set i=1
  loop
    exitwhen i>boolean143
    set LQ7[i]=LJ7[i]
    set i=i+1
  endloop
  set x=GetRandomInt(1,3)
  if x==1 then
    if boolean143==1 then
      set LQ7[1]=LJ7[1]
    elseif boolean143==2 then
      set LQ7[1]=LJ7[2]
      set LQ7[2]=LJ7[1]
    elseif boolean143==3 then
      set LQ7[1]=LJ7[3]
      set LQ7[2]=LJ7[1]
      set LQ7[3]=LJ7[2]
    elseif boolean143==4 then
      set LQ7[1]=LJ7[4]
      set LQ7[2]=LJ7[3]
      set LQ7[3]=LJ7[2]
      set LQ7[4]=LJ7[1]
    elseif boolean143==5 then
      set LQ7[1]=LJ7[5]
      set LQ7[2]=LJ7[4]
      set LQ7[3]=LJ7[1]
      set LQ7[4]=LJ7[2]
      set LQ7[5]=LJ7[3]
    endif
  elseif x==2 then
    if boolean143==1 then
      set LQ7[1]=LJ7[1]
    elseif boolean143==2 then
      set LQ7[1]=LJ7[2]
      set LQ7[2]=LJ7[1]
    elseif boolean143==3 then
      set LQ7[1]=LJ7[2]
      set LQ7[2]=LJ7[3]
      set LQ7[3]=LJ7[1]
    elseif boolean143==4 then
      set LQ7[1]=LJ7[3]
      set LQ7[2]=LJ7[1]
      set LQ7[3]=LJ7[4]
      set LQ7[4]=LJ7[2]
    elseif boolean143==5 then
      set LQ7[1]=LJ7[4]
      set LQ7[2]=LJ7[3]
      set LQ7[3]=LJ7[2]
      set LQ7[4]=LJ7[5]
      set LQ7[5]=LJ7[1]
    endif
  else
    if boolean143==1 then
      set LQ7[1]=LJ7[1]
    elseif boolean143==2 then
      set LQ7[1]=LJ7[1]
      set LQ7[2]=LJ7[2]
    elseif boolean143==3 then
      set LQ7[1]=LJ7[3]
      set LQ7[2]=LJ7[2]
      set LQ7[3]=LJ7[1]
    elseif boolean143==4 then
      set LQ7[1]=LJ7[2]
      set LQ7[2]=LJ7[4]
      set LQ7[3]=LJ7[3]
      set LQ7[4]=LJ7[1]
    elseif boolean143==5 then
      set LQ7[1]=LJ7[5]
      set LQ7[2]=LJ7[1]
      set LQ7[3]=LJ7[3]
      set LQ7[4]=LJ7[4]
      set LQ7[5]=LJ7[2]
    endif
  endif
  set i=1
  loop
    exitwhen i>boolean143
    set LJ7[i]=LQ7[i]
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>boolean143
    set LQ7[i]=LK7[i]
    set i=i+1
  endloop
  set x=GetRandomInt(1,3)
  if x==1 then
    if boolean143==1 then
      set LQ7[1]=LK7[1]
    elseif boolean143==2 then
      set LQ7[1]=LK7[2]
      set LQ7[2]=LK7[1]
    elseif boolean143==3 then
      set LQ7[1]=LK7[3]
      set LQ7[2]=LK7[1]
      set LQ7[3]=LK7[2]
    elseif boolean143==4 then
      set LQ7[1]=LK7[4]
      set LQ7[2]=LK7[3]
      set LQ7[3]=LK7[2]
      set LQ7[4]=LK7[1]
    elseif boolean143==5 then
      set LQ7[1]=LK7[5]
      set LQ7[2]=LK7[4]
      set LQ7[3]=LK7[1]
      set LQ7[4]=LK7[2]
      set LQ7[5]=LK7[3]
    endif
  elseif x==2 then
    if boolean143==1 then
      set LQ7[1]=LK7[1]
    elseif boolean143==2 then
      set LQ7[1]=LK7[2]
      set LQ7[2]=LK7[1]
    elseif boolean143==3 then
      set LQ7[1]=LK7[2]
      set LQ7[2]=LK7[3]
      set LQ7[3]=LK7[1]
    elseif boolean143==4 then
      set LQ7[1]=LK7[3]
      set LQ7[2]=LK7[1]
      set LQ7[3]=LK7[4]
      set LQ7[4]=LK7[2]
    elseif boolean143==5 then
      set LQ7[1]=LK7[4]
      set LQ7[2]=LK7[3]
      set LQ7[3]=LK7[2]
      set LQ7[4]=LK7[5]
      set LQ7[5]=LK7[1]
    endif
  else
    if boolean143==1 then
      set LQ7[1]=LK7[1]
    elseif boolean143==2 then
      set LQ7[1]=LK7[1]
      set LQ7[2]=LK7[2]
    elseif boolean143==3 then
      set LQ7[1]=LK7[3]
      set LQ7[2]=LK7[2]
      set LQ7[3]=LK7[1]
    elseif boolean143==4 then
      set LQ7[1]=LK7[2]
      set LQ7[2]=LK7[4]
      set LQ7[3]=LK7[3]
      set LQ7[4]=LK7[1]
    elseif boolean143==5 then
      set LQ7[1]=LK7[5]
      set LQ7[2]=LK7[1]
      set LQ7[3]=LK7[3]
      set LQ7[4]=LK7[4]
      set LQ7[5]=LK7[2]
    endif
  endif
  set i=1
  loop
    exitwhen i>boolean143
    set LK7[i]=LQ7[i]
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>boolean143
    set LQ7[i]=LM7[i]
    set i=i+1
  endloop
  set x=GetRandomInt(1,3)
  if x==1 then
    if boolean143==1 then
      set LQ7[1]=LM7[1]
    elseif boolean143==2 then
      set LQ7[1]=LM7[2]
      set LQ7[2]=LM7[1]
    elseif boolean143==3 then
      set LQ7[1]=LM7[3]
      set LQ7[2]=LM7[1]
      set LQ7[3]=LM7[2]
    elseif boolean143==4 then
      set LQ7[1]=LM7[4]
      set LQ7[2]=LM7[3]
      set LQ7[3]=LM7[2]
      set LQ7[4]=LM7[1]
    elseif boolean143==5 then
      set LQ7[1]=LM7[5]
      set LQ7[2]=LM7[4]
      set LQ7[3]=LM7[1]
      set LQ7[4]=LM7[2]
      set LQ7[5]=LM7[3]
    endif
  elseif x==2 then
    if boolean143==1 then
      set LQ7[1]=LM7[1]
    elseif boolean143==2 then
      set LQ7[1]=LM7[2]
      set LQ7[2]=LM7[1]
    elseif boolean143==3 then
      set LQ7[1]=LM7[2]
      set LQ7[2]=LM7[3]
      set LQ7[3]=LM7[1]
    elseif boolean143==4 then
      set LQ7[1]=LM7[3]
      set LQ7[2]=LM7[1]
      set LQ7[3]=LM7[4]
      set LQ7[4]=LM7[2]
    elseif boolean143==5 then
      set LQ7[1]=LM7[4]
      set LQ7[2]=LM7[3]
      set LQ7[3]=LM7[2]
      set LQ7[4]=LM7[5]
      set LQ7[5]=LM7[1]
    endif
  else
    if boolean143==1 then
      set LQ7[1]=LM7[1]
    elseif boolean143==2 then
      set LQ7[1]=LM7[1]
      set LQ7[2]=LM7[2]
    elseif boolean143==3 then
      set LQ7[1]=LM7[3]
      set LQ7[2]=LM7[2]
      set LQ7[3]=LM7[1]
    elseif boolean143==4 then
      set LQ7[1]=LM7[2]
      set LQ7[2]=LM7[4]
      set LQ7[3]=LM7[3]
      set LQ7[4]=LM7[1]
    elseif boolean143==5 then
      set LQ7[1]=LM7[5]
      set LQ7[2]=LM7[1]
      set LQ7[3]=LM7[3]
      set LQ7[4]=LM7[4]
      set LQ7[5]=LM7[2]
    endif
  endif
  set i=1
  loop
    exitwhen i>boolean143
    set LM7[i]=LQ7[i]
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>boolean143
    set LQ7[i]=LN7[i]
    set i=i+1
  endloop
  set x=GetRandomInt(1,3)
  if x==1 then
    if boolean143==1 then
      set LQ7[1]=LN7[1]
    elseif boolean143==2 then
      set LQ7[1]=LN7[2]
      set LQ7[2]=LN7[1]
    elseif boolean143==3 then
      set LQ7[1]=LN7[3]
      set LQ7[2]=LN7[1]
      set LQ7[3]=LN7[2]
    elseif boolean143==4 then
      set LQ7[1]=LN7[4]
      set LQ7[2]=LN7[3]
      set LQ7[3]=LN7[2]
      set LQ7[4]=LN7[1]
    elseif boolean143==5 then
      set LQ7[1]=LN7[5]
      set LQ7[2]=LN7[4]
      set LQ7[3]=LN7[1]
      set LQ7[4]=LN7[2]
      set LQ7[5]=LN7[3]
    endif
  elseif x==2 then
    if boolean143==1 then
      set LQ7[1]=LN7[1]
    elseif boolean143==2 then
      set LQ7[1]=LN7[2]
      set LQ7[2]=LN7[1]
    elseif boolean143==3 then
      set LQ7[1]=LN7[2]
      set LQ7[2]=LN7[3]
      set LQ7[3]=LN7[1]
    elseif boolean143==4 then
      set LQ7[1]=LN7[3]
      set LQ7[2]=LN7[1]
      set LQ7[3]=LN7[4]
      set LQ7[4]=LN7[2]
    elseif boolean143==5 then
      set LQ7[1]=LN7[4]
      set LQ7[2]=LN7[3]
      set LQ7[3]=LN7[2]
      set LQ7[4]=LN7[5]
      set LQ7[5]=LN7[1]
    endif
  else
    if boolean143==1 then
      set LQ7[1]=LN7[1]
    elseif boolean143==2 then
      set LQ7[1]=LN7[1]
      set LQ7[2]=LN7[2]
    elseif boolean143==3 then
      set LQ7[1]=LN7[3]
      set LQ7[2]=LN7[2]
      set LQ7[3]=LN7[1]
    elseif boolean143==4 then
      set LQ7[1]=LN7[2]
      set LQ7[2]=LN7[4]
      set LQ7[3]=LN7[3]
      set LQ7[4]=LN7[1]
    elseif boolean143==5 then
      set LQ7[1]=LN7[5]
      set LQ7[2]=LN7[1]
      set LQ7[3]=LN7[3]
      set LQ7[4]=LN7[4]
      set LQ7[5]=LN7[2]
    endif
  endif
  set i=1
  loop
    exitwhen i>boolean143
    set LN7[i]=LQ7[i]
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>boolean143
    set LQ7[i]=LO7[i]
    set i=i+1
  endloop
  set x=GetRandomInt(1,3)
  if x==1 then
    if boolean143==1 then
      set LQ7[1]=LO7[1]
    elseif boolean143==2 then
      set LQ7[1]=LO7[2]
      set LQ7[2]=LO7[1]
    elseif boolean143==3 then
      set LQ7[1]=LO7[3]
      set LQ7[2]=LO7[1]
      set LQ7[3]=LO7[2]
    elseif boolean143==4 then
      set LQ7[1]=LO7[4]
      set LQ7[2]=LO7[3]
      set LQ7[3]=LO7[2]
      set LQ7[4]=LO7[1]
    elseif boolean143==5 then
      set LQ7[1]=LO7[5]
      set LQ7[2]=LO7[4]
      set LQ7[3]=LO7[1]
      set LQ7[4]=LO7[2]
      set LQ7[5]=LO7[3]
    endif
  elseif x==2 then
    if boolean143==1 then
      set LQ7[1]=LO7[1]
    elseif boolean143==2 then
      set LQ7[1]=LO7[2]
      set LQ7[2]=LO7[1]
    elseif boolean143==3 then
      set LQ7[1]=LO7[2]
      set LQ7[2]=LO7[3]
      set LQ7[3]=LO7[1]
    elseif boolean143==4 then
      set LQ7[1]=LO7[3]
      set LQ7[2]=LO7[1]
      set LQ7[3]=LO7[4]
      set LQ7[4]=LO7[2]
    elseif boolean143==5 then
      set LQ7[1]=LO7[4]
      set LQ7[2]=LO7[3]
      set LQ7[3]=LO7[2]
      set LQ7[4]=LO7[5]
      set LQ7[5]=LO7[1]
    endif
  else
    if boolean143==1 then
      set LQ7[1]=LO7[1]
    elseif boolean143==2 then
      set LQ7[1]=LO7[1]
      set LQ7[2]=LO7[2]
    elseif boolean143==3 then
      set LQ7[1]=LO7[3]
      set LQ7[2]=LO7[2]
      set LQ7[3]=LO7[1]
    elseif boolean143==4 then
      set LQ7[1]=LO7[2]
      set LQ7[2]=LO7[4]
      set LQ7[3]=LO7[3]
      set LQ7[4]=LO7[1]
    elseif boolean143==5 then
      set LQ7[1]=LO7[5]
      set LQ7[2]=LO7[1]
      set LQ7[3]=LO7[3]
      set LQ7[4]=LO7[4]
      set LQ7[5]=LO7[2]
    endif
  endif
  set i=1
  loop
    exitwhen i>boolean143
    set LO7[i]=LQ7[i]
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>boolean143
    set LQ7[i]=LP7[i]
    set i=i+1
  endloop
  set x=GetRandomInt(1,3)
  if x==1 then
    if boolean143==1 then
      set LQ7[1]=LP7[1]
    elseif boolean143==2 then
      set LQ7[1]=LP7[2]
      set LQ7[2]=LP7[1]
    elseif boolean143==3 then
      set LQ7[1]=LP7[3]
      set LQ7[2]=LP7[1]
      set LQ7[3]=LP7[2]
    elseif boolean143==4 then
      set LQ7[1]=LP7[4]
      set LQ7[2]=LP7[3]
      set LQ7[3]=LP7[2]
      set LQ7[4]=LP7[1]
    elseif boolean143==5 then
      set LQ7[1]=LP7[5]
      set LQ7[2]=LP7[4]
      set LQ7[3]=LP7[1]
      set LQ7[4]=LP7[2]
      set LQ7[5]=LP7[3]
    endif
  elseif x==2 then
    if boolean143==1 then
      set LQ7[1]=LP7[1]
    elseif boolean143==2 then
      set LQ7[1]=LP7[2]
      set LQ7[2]=LP7[1]
    elseif boolean143==3 then
      set LQ7[1]=LP7[2]
      set LQ7[2]=LP7[3]
      set LQ7[3]=LP7[1]
    elseif boolean143==4 then
      set LQ7[1]=LP7[3]
      set LQ7[2]=LP7[1]
      set LQ7[3]=LP7[4]
      set LQ7[4]=LP7[2]
    elseif boolean143==5 then
      set LQ7[1]=LP7[4]
      set LQ7[2]=LP7[3]
      set LQ7[3]=LP7[2]
      set LQ7[4]=LP7[5]
      set LQ7[5]=LP7[1]
    endif
  else
    if boolean143==1 then
      set LQ7[1]=LP7[1]
    elseif boolean143==2 then
      set LQ7[1]=LP7[1]
      set LQ7[2]=LP7[2]
    elseif boolean143==3 then
      set LQ7[1]=LP7[3]
      set LQ7[2]=LP7[2]
      set LQ7[3]=LP7[1]
    elseif boolean143==4 then
      set LQ7[1]=LP7[2]
      set LQ7[2]=LP7[4]
      set LQ7[3]=LP7[3]
      set LQ7[4]=LP7[1]
    elseif boolean143==5 then
      set LQ7[1]=LP7[5]
      set LQ7[2]=LP7[1]
      set LQ7[3]=LP7[3]
      set LQ7[4]=LP7[4]
      set LQ7[5]=LP7[2]
    endif
  endif
  set i=1
  loop
    exitwhen i>boolean143
    set LP7[i]=LQ7[i]
    set i=i+1
  endloop
  set VA8=GetRandomInt(1,2)
  if LR7>=LS7 and LR7>=LT7 then
    call ClearTextMessages()
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,45,GetObjectName('n05Z')+" "+LU7)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,45," ")
    set i=1
    set x=1
    loop
      exitwhen i>5
      if IsPlayer(Sentinels[i])then
        if VA8==1 then
          set udg_Hero[GetPlayerId(Sentinels[i])]=CreateUnitAtLoc(Sentinels[i],LJ7[x],SpawnSent,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Sentinels[i])]=LJ7[x]
        else
          set udg_Hero[GetPlayerId(Sentinels[i])]=CreateUnitAtLoc(Sentinels[i],LK7[x],SpawnSent,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Sentinels[i])]=LK7[x]
        endif
        set x=x+1
      endif
      set i=i+1
    endloop
    set i=1
    set x=1
    loop
      exitwhen i>5
      if IsPlayer(Scourges[i])then
        if VA8==1 then
          set udg_Hero[GetPlayerId(Scourges[i])]=CreateUnitAtLoc(Scourges[i],LK7[x],SpawnScourge,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Scourges[i])]=LK7[x]
        else
          set udg_Hero[GetPlayerId(Scourges[i])]=CreateUnitAtLoc(Scourges[i],LJ7[x],SpawnScourge,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Scourges[i])]=LJ7[x]
        endif
        set x=x+1
      endif
      set i=i+1
    endloop
  elseif LS7>=LR7 and LS7>=LT7 then
    call ClearTextMessages()
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,45,GetObjectName('n05Z')+" "+LV7)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,45," ")
    set i=1
    set x=1
    loop
      exitwhen i>5
      if IsPlayer(Sentinels[i])then
        if VA8==1 then
          set udg_Hero[GetPlayerId(Sentinels[i])]=CreateUnitAtLoc(Sentinels[i],LM7[x],SpawnSent,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Sentinels[i])]=LM7[x]
        else
          set udg_Hero[GetPlayerId(Sentinels[i])]=CreateUnitAtLoc(Sentinels[i],LN7[x],SpawnSent,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Sentinels[i])]=LN7[x]
        endif
        set x=x+1
      endif
      set i=i+1
    endloop
    set i=1
    set x=1
    loop
      exitwhen i>5
      if IsPlayer(Scourges[i])then
        if VA8==1 then
          set udg_Hero[GetPlayerId(Scourges[i])]=CreateUnitAtLoc(Scourges[i],LN7[x],SpawnScourge,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Scourges[i])]=LN7[x]
        else
          set udg_Hero[GetPlayerId(Scourges[i])]=CreateUnitAtLoc(Scourges[i],LM7[x],SpawnScourge,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Scourges[i])]=LM7[x]
        endif
        set x=x+1
      endif
      set i=i+1
    endloop
  elseif LT7>=LR7 and LT7>=LS7 then
    call ClearTextMessages()
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,45,GetObjectName('n05Z')+" "+LW7)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,45," ")
    set i=1
    set x=1
    loop
      exitwhen i>5
      if IsPlayer(Sentinels[i])then
        if VA8==1 then
          set udg_Hero[GetPlayerId(Sentinels[i])]=CreateUnitAtLoc(Sentinels[i],LO7[x],SpawnSent,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Sentinels[i])]=LO7[x]
        else
          set udg_Hero[GetPlayerId(Sentinels[i])]=CreateUnitAtLoc(Sentinels[i],LP7[x],SpawnSent,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Sentinels[i])]=LP7[x]
        endif
        set x=x+1
      endif
      set i=i+1
    endloop
    set i=1
    set x=1
    loop
      exitwhen i>5
      if IsPlayer(Scourges[i])then
        if VA8==1 then
          set udg_Hero[GetPlayerId(Scourges[i])]=CreateUnitAtLoc(Scourges[i],LP7[x],SpawnScourge,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Scourges[i])]=LP7[x]
        else
          set udg_Hero[GetPlayerId(Scourges[i])]=CreateUnitAtLoc(Scourges[i],LO7[x],SpawnScourge,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Scourges[i])]=LO7[x]
        endif
        set x=x+1
      endif
      set i=i+1
    endloop
  endif
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,70,false)
  call TriggerAddCondition(t,Condition(function boolean138))
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  call RemoveLocation(GJE)
  call RemoveLocation(GKE)
  set SpawnSent=null
  set SpawnScourge=null
  set GJE=null
  set GKE=null
  set t=null
  set boolean142=null
  return false
endfunction

function region012 takes integer i returns integer
  if i==1 then
    return W28(IntHeroesArray[GetRandomInt(1,IntHeroesAmount)])
  elseif i==2 then
    return W28(AgiHeroesArray[GetRandomInt(1,AgilityHeroesAmount)])
  elseif i==3 then
    return W28(StrHeroesArray[GetRandomInt(1,StrHeroesAmount)])
  elseif i==4 then
    return W28(MeleeHeroesArray[GetRandomInt(1,MeleeHeroesAmount)])
  elseif i==5 then
    return W28(RangeHeroesArray[GetRandomInt(1,RangeHeroesAmount)])
  endif
  return 0
endfunction

function GSE takes integer i returns integer
  local integer WO8
  local integer WP8
  local integer VID
  set VID=region012(i)
  if Mode_DU then
    return VID
  endif
  loop
    exitwhen Mode_VR_b[VID]==false
    set VID=region012(i)
  endloop
  set Mode_VR_b[VID]=true
  return VID
endfunction

function GTE takes nothing returns nothing
  local integer i=FirstSentinelHeroIndexid
  loop
    exitwhen i>LastScourgeHeroIndexid
    set Mode_VR_b[i]=false
    set i=i+1
  endloop
endfunction

function integer492 takes nothing returns boolean
  local integer GVE=GetPlayerId(GetTriggerPlayer())
  local string GWE=SubString(GetEventPlayerChatString(),8,9)
  local integer boolean139=0
  if GWE=="1"then
    set boolean139=1
  elseif GWE=="2"then
    set boolean139=2
  elseif GWE=="3"then
    set boolean139=3
  endif
  if boolean139==0 then
    call ErrorDefault5s(GetTriggerPlayer(),GetObjectName('n03D'))
    return false
  endif
  if(LoadBoolean(hashtable019,(2001),(950+GVE)))then
    call ErrorDefault5s(GetTriggerPlayer(),GetObjectName('n03A'))
    return false
  endif
  call SaveBoolean(hashtable019,(2001),(950+GVE),(true))
  if boolean139==1 then
    call SaveInteger(hashtable019,(2001),(126),(1+(LoadInteger(hashtable019,(2001),(126)))))
  elseif boolean139==2 then
    call SaveInteger(hashtable019,(2001),(127),(1+(LoadInteger(hashtable019,(2001),(127)))))
  else
    call SaveInteger(hashtable019,(2001),(128),(1+(LoadInteger(hashtable019,(2001),(128)))))
  endif
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,20,GetObjectName('n09M')+" Option "+I2S(boolean139)+".")
  return false
endfunction

function L8D takes nothing returns nothing
  local integer boolean143=CountPlayersInForce(Force_SentPlayers)
  local integer boolean144=CountPlayersInForce(Force_ScourgePlayers)
  local integer i
  local integer x
  local trigger t=CreateTrigger()
  local location SpawnSent=GetRectCenter(G4)
  local location SpawnScourge=GetRectCenter(F4)
  local location GJE=GetRectCenter(gg_rct_Hero_Creation_NE)
  local location GKE=GetRectCenter(gg_rct_Hero_Creation_UD)
  local integer VA8
  local trigger t2
  set Mode_VR=true
  set udg_Allow_Random=false
  set udg_Allow_Repick=false
  call TechAll()
  call PanCameraToTimedLocForPlayer(Sentinels[1],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[2],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[3],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[4],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[5],GJE,0)
  call PanCameraToTimedLocForPlayer(Scourges[1],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[2],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[3],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[4],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[5],GKE,0)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-Option",false)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-Option",false)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-Option",false)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-Option",false)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-Option",false)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-Option",false)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-Option",false)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-Option",false)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-Option",false)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-Option",false)
  call TriggerAddCondition(t,Condition(function integer492))
  call GTE()
  set i=1
  loop
    exitwhen i>boolean143
    set LJ7[i]=HeroID[GSE(i)]
    set LU7=LU7+GetObjectName(LJ7[i])
    set i=i+1
    if i<=boolean143 then
      set LU7=LU7+"|c005BFEEA-|r"
    endif
  endloop
  set LU7=LU7+" |c00FF0000vs |r"
  set i=1
  loop
    exitwhen i>boolean144
    set LK7[i]=HeroID[GSE(i)]
    set LU7=LU7+GetObjectName(LK7[i])
    set i=i+1
    if i<=boolean144 then
      set LU7=LU7+"|c005BFEEA-|r"
    endif
  endloop
  call GTE()
  set i=1
  loop
    exitwhen i>boolean143
    set LM7[i]=HeroID[GSE(i)]
    set LV7=LV7+GetObjectName(LM7[i])+" "
    set i=i+1
    if i<=boolean143 then
      set LV7=LV7+"|c005BFEEA-|r"
    endif
  endloop
  set LV7=LV7+" |c00FF0000vs |r"
  set i=1
  loop
    exitwhen i>boolean144
    set LN7[i]=HeroID[GSE(i)]
    set LV7=LV7+GetObjectName(LN7[i])+" "
    set i=i+1
    if i<=boolean144 then
      set LV7=LV7+"|c005BFEEA-|r"
    endif
  endloop
  call GTE()
  set i=1
  loop
    exitwhen i>boolean143
    set LO7[i]=HeroID[GSE(i)]
    set LW7=LW7+GetObjectName(LO7[i])+" "
    set i=i+1
    if i<=boolean143 then
      set LW7=LW7+"|c005BFEEA-|r"
    endif
  endloop
  set LW7=LW7+" |c00FF0000vs |r"
  set i=1
  loop
    exitwhen i>boolean144
    set LP7[i]=HeroID[GSE(i)]
    set LW7=LW7+GetObjectName(LP7[i])+" "
    set i=i+1
    if i<=boolean144 then
      set LW7=LW7+"|c005BFEEA-|r"
    endif
  endloop
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,75," ")
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,75,GetObjectName('n06T'))
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,75,GetObjectName('n06I')+" "+GetObjectName('n06D'))
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,75," ")
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,75,LU7)
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,75," ")
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,75,LV7)
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,75," ")
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,75,LW7)
  set t2=CreateTrigger()
  call TriggerRegisterTimerEvent(t2,30,false)
  call TriggerAddCondition(t2,Condition(function GNE))
  call SaveTriggerHandle(hashtable019,(GetHandleId(t2)),(35),(t))
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  call RemoveLocation(GJE)
  call RemoveLocation(GKE)
  set SpawnSent=null
  set SpawnScourge=null
  set GJE=null
  set GKE=null
  set t=null
  set t2=null
endfunction

function GYE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Count=GetTriggerEvalCount(t)
  local integer Time=20-(Count-(Count/ 20)*20)
  call LeaderboardSetLabel(LB7,"		   "+GetObjectName('n0EZ')+" "+I2S(Time))
  if Count>125 then
    call DestroyLeaderboard(LB7)
    call ZHD()
    call CleanTrigger(t)
  endif
  set t=null
  return false
endfunction

function GZE takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function GYE))
  set LB7=CreateLeaderboard()
  call LeaderboardSetStyle(LB7,true,false,false,false)
  call LeaderboardDisplay(LB7,false)
  call PlayerSetLeaderboard(Sentinels[1],LB7)
  call PlayerSetLeaderboard(Sentinels[2],LB7)
  call PlayerSetLeaderboard(Sentinels[3],LB7)
  call PlayerSetLeaderboard(Sentinels[4],LB7)
  call PlayerSetLeaderboard(Sentinels[5],LB7)
  call PlayerSetLeaderboard(Scourges[1],LB7)
  call PlayerSetLeaderboard(Scourges[2],LB7)
  call PlayerSetLeaderboard(Scourges[3],LB7)
  call PlayerSetLeaderboard(Scourges[4],LB7)
  call PlayerSetLeaderboard(Scourges[5],LB7)
  set t=null
endfunction

function boolean141 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer EZE=(LoadInteger(hashtable019,(Cache),(25)))
  local player p1
  local player p2
  local player boolean127
  local player EBE
  if EZE==0 then
    if LX7==1 then
      set p1=Sentinels[1]
    else
      set p1=Scourges[1]
    endif
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,LY7[GetPlayerId(p1)])
    call LeaderboardDisplay(LB7,GetLocalPlayer()==p1)
  elseif EZE==1 then
    if LX7==1 then
      set p1=Scourges[1]
      set p2=Scourges[2]
      set boolean127=Sentinels[1]
    else
      set p1=Sentinels[1]
      set p2=Sentinels[2]
      set boolean127=Scourges[1]
    endif
    call VS8(boolean127)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p2)]+(IL7[GetPlayerId((p2))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,LY7[GetPlayerId(p1)])
    call SetPlayerState(p2,PLAYER_STATE_RESOURCE_GOLD,LY7[GetPlayerId(p2)])
    call LeaderboardDisplay(LB7,GetLocalPlayer()==p1 or GetLocalPlayer()==p2)
  elseif EZE==2 then
    if LX7==1 then
      set p1=Sentinels[2]
      set p2=Sentinels[3]
      set boolean127=Scourges[1]
      set EBE=Scourges[2]
    else
      set p1=Scourges[2]
      set p2=Scourges[3]
      set boolean127=Sentinels[1]
      set EBE=Sentinels[2]
    endif
    call VS8(boolean127)
    call VS8(EBE)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p2)]+(IL7[GetPlayerId((p2))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,LY7[GetPlayerId(p1)])
    call SetPlayerState(p2,PLAYER_STATE_RESOURCE_GOLD,LY7[GetPlayerId(p2)])
    call LeaderboardDisplay(LB7,GetLocalPlayer()==p1 or GetLocalPlayer()==p2)
  elseif EZE==3 then
    if LX7==1 then
      set p1=Scourges[3]
      set p2=Scourges[4]
      set boolean127=Sentinels[2]
      set EBE=Sentinels[3]
    else
      set p1=Sentinels[3]
      set p2=Sentinels[4]
      set boolean127=Scourges[2]
      set EBE=Scourges[3]
    endif
    call VS8(boolean127)
    call VS8(EBE)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p2)]+(IL7[GetPlayerId((p2))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,LY7[GetPlayerId(p1)])
    call SetPlayerState(p2,PLAYER_STATE_RESOURCE_GOLD,LY7[GetPlayerId(p2)])
    call LeaderboardDisplay(LB7,GetLocalPlayer()==p1 or GetLocalPlayer()==p2)
  elseif EZE==4 then
    if LX7==1 then
      set p1=Sentinels[4]
      set p2=Sentinels[5]
      set boolean127=Scourges[3]
      set EBE=Scourges[4]
    else
      set p1=Scourges[4]
      set p2=Scourges[5]
      set boolean127=Sentinels[3]
      set EBE=Sentinels[4]
    endif
    call VS8(boolean127)
    call VS8(EBE)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p2)]+(IL7[GetPlayerId((p2))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,LY7[GetPlayerId(p1)])
    call SetPlayerState(p2,PLAYER_STATE_RESOURCE_GOLD,LY7[GetPlayerId(p2)])
    call LeaderboardDisplay(LB7,GetLocalPlayer()==p1 or GetLocalPlayer()==p2)
  elseif EZE==5 then
    if LX7==1 then
      set p1=Scourges[5]
      set boolean127=Sentinels[4]
      set EBE=Sentinels[5]
    else
      set p1=Sentinels[5]
      set boolean127=Scourges[4]
      set EBE=Scourges[5]
    endif
    call VS8(boolean127)
    call VS8(EBE)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,LY7[GetPlayerId(p1)])
    call LeaderboardDisplay(LB7,GetLocalPlayer()==p1)
  elseif EZE==6 then
    if LX7==1 then
      set boolean127=Scourges[5]
    else
      set boolean127=Sentinels[5]
    endif
    call VS8(boolean127)
    call LeaderboardDisplay(LB7,false)
    call SuspendTimeOfDay(false)
  endif
  if EZE>6 then
    set LA7=true
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SaveInteger(hashtable019,(Cache),(25),(EZE+1))
  endif
  set t=null
  set p1=null
  set p2=null
  set boolean127=null
  set EBE=null
  return false
endfunction

function GBE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache
  call CleanTrigger(t)
  call SuspendTimeOfDay(true)
  set LX7=GetRandomInt(1,2)
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.," ")
  if LX7==1 then
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,GetObjectName('n05K')+" "+udg_Colors[GetPlayerId(Sentinels[0])]+GetObjectName('n065')+"|r"+" "+GetObjectName('n066'))
  else
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,GetObjectName('n05K')+" "+udg_Colors[GetPlayerId(Scourges[0])]+GetObjectName('n06C')+"|r"+" "+GetObjectName('n066'))
  endif
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.," ")
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,20,true)
  call TriggerAddCondition(t,Condition(function boolean141))
  call SaveInteger(hashtable019,(Cache),(25),(0))
  call GZE()
  call TriggerEvaluate(t)
  set t=null
  return false
endfunction

function LFD takes nothing returns nothing
  local trigger t
  local integer x=1
  set LZ7=true
  set CreepSpawnTime=180
  set udg_Allow_Repick=false
  set udg_Allow_Random=false
  call RestrictHeroes()
  set LY7[GetPlayerId(Sentinels[1])]=GetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD)
  set LY7[GetPlayerId(Sentinels[2])]=GetPlayerState(Sentinels[2],PLAYER_STATE_RESOURCE_GOLD)
  set LY7[GetPlayerId(Sentinels[3])]=GetPlayerState(Sentinels[3],PLAYER_STATE_RESOURCE_GOLD)
  set LY7[GetPlayerId(Sentinels[4])]=GetPlayerState(Sentinels[4],PLAYER_STATE_RESOURCE_GOLD)
  set LY7[GetPlayerId(Sentinels[5])]=GetPlayerState(Sentinels[5],PLAYER_STATE_RESOURCE_GOLD)
  set LY7[GetPlayerId(Scourges[1])]=GetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD)
  set LY7[GetPlayerId(Scourges[2])]=GetPlayerState(Scourges[2],PLAYER_STATE_RESOURCE_GOLD)
  set LY7[GetPlayerId(Scourges[3])]=GetPlayerState(Scourges[3],PLAYER_STATE_RESOURCE_GOLD)
  set LY7[GetPlayerId(Scourges[4])]=GetPlayerState(Scourges[4],PLAYER_STATE_RESOURCE_GOLD)
  set LY7[GetPlayerId(Scourges[5])]=GetPlayerState(Scourges[5],PLAYER_STATE_RESOURCE_GOLD)
  call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[2],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[3],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[4],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[5],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[2],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[3],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[4],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[5],PLAYER_STATE_RESOURCE_GOLD,0)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,15-TimerGetElapsed(GlobalTimer),false)
  call TriggerAddCondition(t,Condition(function GBE))
  set t=null
endfunction

function boolean140 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Count=GetTriggerEvalCount(t)
  local integer Time=20-(Count-(Count/ 20)*20)
  call LeaderboardSetLabel(L17,"		   "+GetObjectName('n0EZ')+" "+I2S(Time))
  if Count>125 then
    call DestroyLeaderboard(L17)
    call ZHD()
    call CleanTrigger(t)
  endif
  set t=null
  return false
endfunction

function unit037 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function boolean140))
  set L17=CreateLeaderboard()
  call LeaderboardSetStyle(L17,true,false,false,false)
  call LeaderboardDisplay(L17,false)
  call PlayerSetLeaderboard(Sentinels[1],L17)
  call PlayerSetLeaderboard(Sentinels[2],L17)
  call PlayerSetLeaderboard(Sentinels[3],L17)
  call PlayerSetLeaderboard(Sentinels[4],L17)
  call PlayerSetLeaderboard(Sentinels[5],L17)
  call PlayerSetLeaderboard(Scourges[1],L17)
  call PlayerSetLeaderboard(Scourges[2],L17)
  call PlayerSetLeaderboard(Scourges[3],L17)
  call PlayerSetLeaderboard(Scourges[4],L17)
  call PlayerSetLeaderboard(Scourges[5],L17)
  set t=null
endfunction

function G6E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer EZE=(LoadInteger(hashtable019,(Cache),(25)))
  local player p1
  local player p2
  local player boolean127
  local player EBE
  if EZE==0 then
    if LC7==1 then
      set p1=Sentinels[1]
    else
      set p1=Scourges[1]
    endif
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,L37[GetPlayerId(p1)])
    call LeaderboardDisplay(L17,GetLocalPlayer()==p1)
  elseif EZE==1 then
    if LC7==1 then
      set p1=Scourges[1]
      set p2=Scourges[2]
      set boolean127=Sentinels[1]
    else
      set p1=Sentinels[1]
      set p2=Sentinels[2]
      set boolean127=Scourges[1]
    endif
    call VS8(boolean127)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p2)]+(IL7[GetPlayerId((p2))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,L37[GetPlayerId(p1)])
    call SetPlayerState(p2,PLAYER_STATE_RESOURCE_GOLD,L37[GetPlayerId(p2)])
    call LeaderboardDisplay(L17,GetLocalPlayer()==p1 or GetLocalPlayer()==p2)
  elseif EZE==2 then
    if LC7==1 then
      set p1=Sentinels[2]
      set p2=Sentinels[3]
      set boolean127=Scourges[1]
      set EBE=Scourges[2]
    else
      set p1=Scourges[2]
      set p2=Scourges[3]
      set boolean127=Sentinels[1]
      set EBE=Sentinels[2]
    endif
    call VS8(boolean127)
    call VS8(EBE)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p2)]+(IL7[GetPlayerId((p2))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,L37[GetPlayerId(p1)])
    call SetPlayerState(p2,PLAYER_STATE_RESOURCE_GOLD,L37[GetPlayerId(p2)])
    call LeaderboardDisplay(L17,GetLocalPlayer()==p1 or GetLocalPlayer()==p2)
  elseif EZE==3 then
    if LC7==1 then
      set p1=Scourges[3]
      set p2=Scourges[4]
      set boolean127=Sentinels[2]
      set EBE=Sentinels[3]
    else
      set p1=Sentinels[3]
      set p2=Sentinels[4]
      set boolean127=Scourges[2]
      set EBE=Scourges[3]
    endif
    call VS8(boolean127)
    call VS8(EBE)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p2)]+(IL7[GetPlayerId((p2))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,L37[GetPlayerId(p1)])
    call SetPlayerState(p2,PLAYER_STATE_RESOURCE_GOLD,L37[GetPlayerId(p2)])
    call LeaderboardDisplay(L17,GetLocalPlayer()==p1 or GetLocalPlayer()==p2)
  elseif EZE==4 then
    if LC7==1 then
      set p1=Sentinels[4]
      set p2=Sentinels[5]
      set boolean127=Scourges[3]
      set EBE=Scourges[4]
    else
      set p1=Scourges[4]
      set p2=Scourges[5]
      set boolean127=Sentinels[3]
      set EBE=Sentinels[4]
    endif
    call VS8(boolean127)
    call VS8(EBE)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p2)]+(IL7[GetPlayerId((p2))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,L37[GetPlayerId(p1)])
    call SetPlayerState(p2,PLAYER_STATE_RESOURCE_GOLD,L37[GetPlayerId(p2)])
    call LeaderboardDisplay(L17,GetLocalPlayer()==p1 or GetLocalPlayer()==p2)
  elseif EZE==5 then
    if LC7==1 then
      set p1=Scourges[5]
      set boolean127=Sentinels[4]
      set EBE=Sentinels[5]
    else
      set p1=Sentinels[5]
      set boolean127=Scourges[4]
      set EBE=Scourges[5]
    endif
    call VS8(boolean127)
    call VS8(EBE)
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,udg_Colors[GetPlayerId(p1)]+(IL7[GetPlayerId((p1))])+"|r"+" "+GetObjectName('n064'))
    call SetPlayerState(p1,PLAYER_STATE_RESOURCE_GOLD,L37[GetPlayerId(p1)])
    call LeaderboardDisplay(L17,GetLocalPlayer()==p1)
  elseif EZE==6 then
    if LC7==1 then
      set boolean127=Scourges[5]
    else
      set boolean127=Sentinels[5]
    endif
    call VS8(boolean127)
    call LeaderboardDisplay(L17,false)
    call SuspendTimeOfDay(false)
  endif
  if EZE>6 then
    set LL7=true
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SaveInteger(hashtable019,(Cache),(25),(EZE+1))
  endif
  set t=null
  set p1=null
  set p2=null
  set boolean127=null
  set EBE=null
  return false
endfunction

function GLE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local trigger integer493=(LoadTriggerHandle(hashtable019,(Cache),(169)))
  set HeroDamageTracking_Enabled=true
  call CleanTrigger(integer493)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,20,true)
  call TriggerAddCondition(t,Condition(function G6E))
  call SaveInteger(hashtable019,(Cache),(25),(0))
  call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
  call EnableTrigger(OneHero)
  call EnableTrigger(HeroEnters)
  set LC7=GetRandomInt(1,2)
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.," ")
  if LC7==1 then
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,GetObjectName('n09O')+" "+GetObjectName('n05K')+" "+udg_Colors[GetPlayerId(Sentinels[0])]+GetObjectName('n065')+"|r"+" "+GetObjectName('n066'))
  else
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,GetObjectName('n09O')+" "+GetObjectName('n05K')+" "+udg_Colors[GetPlayerId(Scourges[0])]+GetObjectName('n06C')+"|r"+" "+GetObjectName('n066'))
  endif
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.," ")
  call unit037()
  call TriggerEvaluate(t)
  set t=null
  set integer493=null
  return false
endfunction

function G0E takes nothing returns boolean
  local unit Hero=GetSoldUnit()
  local string unit038=udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(IL7[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r"
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20,unit038+" "+GetObjectName('n09I')+" "+GetUnitName(Hero)+" "+GetObjectName('n09N'))
  call TechHeroForAll(GetUnitTypeId(GetSoldUnit()))
  call Traffic_RegisterData("Ban"+I2S(GetPlayerId(GetOwningPlayer(GetSoldUnit()))),GetUnitTypeId(GetSoldUnit()))
  call RemoveUnit(GetSoldUnit())
  set Hero=null
  return false
endfunction

function real060 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local trigger integer493=CreateTrigger()
  local integer Cache
  local string H4E=udg_Colors[GetPlayerId(Sentinels[1])]+(IL7[GetPlayerId((Sentinels[1]))])+"|r"
  local string H7E=udg_Colors[GetPlayerId(Scourges[1])]+(IL7[GetPlayerId((Scourges[1]))])+"|r"
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.," ")
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,H4E+" "+GetObjectName('n09K'))
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,H7E+" "+GetObjectName('n09K'))
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.," ")
  call CleanTrigger(t)
  call TriggerRegisterAnyUnitEvent(integer493,EVENT_PLAYER_UNIT_SELL)
  call TriggerAddCondition(integer493,Condition(function G0E))
  call SuspendTimeOfDay(true)
  call DisableTrigger(OneHero)
  call DisableTrigger(HeroEnters)
  call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,1000)
  call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,1000)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call SaveTriggerHandle(hashtable019,(Cache),(169),(integer493))
  call TriggerRegisterTimerEvent(t,20,false)
  call TriggerAddCondition(t,Condition(function GLE))
  set integer493=null
  set t=null
  return false
endfunction

function LGD takes nothing returns nothing
  local trigger t
  local location SpawnSent=GetRectCenter(gg_rct_Allpick_Sent)
  local location SpawnScourge=GetRectCenter(gg_rct_Allpick_Scourge)
  local integer x=1
  loop
    exitwhen x>5
    if IsPlayer(Sentinels[x])then
      call CreateUnitAtLoc(Sentinels[x],'n00C',SpawnScourge,bj_UNIT_FACING)
    endif
    if IsPlayer(Scourges[x])then
      call CreateUnitAtLoc(Scourges[x],'n00C',SpawnSent,bj_UNIT_FACING)
    endif
    set x=x+1
  endloop
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  set L67=true
  set CreepSpawnTime=180
  set udg_Allow_Repick=false
  set udg_Allow_Random=false
  set HeroDamageTracking_Enabled=false
  call RestrictHeroes()
  set L37[GetPlayerId(Sentinels[1])]=GetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD)
  set L37[GetPlayerId(Sentinels[2])]=GetPlayerState(Sentinels[2],PLAYER_STATE_RESOURCE_GOLD)
  set L37[GetPlayerId(Sentinels[3])]=GetPlayerState(Sentinels[3],PLAYER_STATE_RESOURCE_GOLD)
  set L37[GetPlayerId(Sentinels[4])]=GetPlayerState(Sentinels[4],PLAYER_STATE_RESOURCE_GOLD)
  set L37[GetPlayerId(Sentinels[5])]=GetPlayerState(Sentinels[5],PLAYER_STATE_RESOURCE_GOLD)
  set L37[GetPlayerId(Scourges[1])]=GetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD)
  set L37[GetPlayerId(Scourges[2])]=GetPlayerState(Scourges[2],PLAYER_STATE_RESOURCE_GOLD)
  set L37[GetPlayerId(Scourges[3])]=GetPlayerState(Scourges[3],PLAYER_STATE_RESOURCE_GOLD)
  set L37[GetPlayerId(Scourges[4])]=GetPlayerState(Scourges[4],PLAYER_STATE_RESOURCE_GOLD)
  set L37[GetPlayerId(Scourges[5])]=GetPlayerState(Scourges[5],PLAYER_STATE_RESOURCE_GOLD)
  call SetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[2],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[3],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[4],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Sentinels[5],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[2],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[3],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[4],PLAYER_STATE_RESOURCE_GOLD,0)
  call SetPlayerState(Scourges[5],PLAYER_STATE_RESOURCE_GOLD,0)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,15-TimerGetElapsed(GlobalTimer),false)
  call TriggerAddCondition(t,Condition(function real060))
  set t=null
  set SpawnSent=null
  set SpawnScourge=null
endfunction

function H8E takes nothing returns boolean
  local player p
  set rect001=true
  set p=Sentinels[1]
  if(GetPlayerSlotState((p))==PLAYER_SLOT_STATE_EMPTY)==false and HasAlreadyPickedHero[GetPlayerId(p)]==false then
    call WT8(p)
  endif
  set p=Sentinels[2]
  if(GetPlayerSlotState((p))==PLAYER_SLOT_STATE_EMPTY)==false and HasAlreadyPickedHero[GetPlayerId(p)]==false then
    call WT8(p)
  endif
  set p=Sentinels[3]
  if(GetPlayerSlotState((p))==PLAYER_SLOT_STATE_EMPTY)==false and HasAlreadyPickedHero[GetPlayerId(p)]==false then
    call WT8(p)
  endif
  set p=Sentinels[4]
  if(GetPlayerSlotState((p))==PLAYER_SLOT_STATE_EMPTY)==false and HasAlreadyPickedHero[GetPlayerId(p)]==false then
    call WT8(p)
  endif
  set p=Sentinels[5]
  if(GetPlayerSlotState((p))==PLAYER_SLOT_STATE_EMPTY)==false and HasAlreadyPickedHero[GetPlayerId(p)]==false then
    call WT8(p)
  endif
  set p=Scourges[1]
  if(GetPlayerSlotState((p))==PLAYER_SLOT_STATE_EMPTY)==false and HasAlreadyPickedHero[GetPlayerId(p)]==false then
    call WT8(p)
  endif
  set p=Scourges[2]
  if(GetPlayerSlotState((p))==PLAYER_SLOT_STATE_EMPTY)==false and HasAlreadyPickedHero[GetPlayerId(p)]==false then
    call WT8(p)
  endif
  set p=Scourges[3]
  if(GetPlayerSlotState((p))==PLAYER_SLOT_STATE_EMPTY)==false and HasAlreadyPickedHero[GetPlayerId(p)]==false then
    call WT8(p)
  endif
  set p=Scourges[4]
  if(GetPlayerSlotState((p))==PLAYER_SLOT_STATE_EMPTY)==false and HasAlreadyPickedHero[GetPlayerId(p)]==false then
    call WT8(p)
  endif
  set p=Scourges[5]
  if(GetPlayerSlotState((p))==PLAYER_SLOT_STATE_EMPTY)==false and HasAlreadyPickedHero[GetPlayerId(p)]==false then
    call WT8(p)
  endif
  set p=null
  return false
endfunction

function group020 takes nothing returns boolean
  set udg_Allow_Random=false
  set udg_Allow_Repick=false
  call TechAll()
  return false
endfunction

function LED takes nothing returns nothing
  local integer Cache=2000
  local player array boolean143
  local player array boolean144
  local integer x=0
  local integer y=0
  local integer i=0
  local trigger t=CreateTrigger()
  set Mode_RV=true
  call TriggerAddCondition(t,Condition(function H8E))
  call TriggerRegisterTimerEvent(t,60-TimerGetElapsed(GlobalTimer),false)
  set t=CreateTrigger()
  call TriggerAddCondition(t,Condition(function group020))
  call TriggerRegisterTimerEvent(t,57-TimerGetElapsed(GlobalTimer),false)
  set t=null
  if IsPlayer(Sentinels[1])then
    set x=x+1
    set boolean143[x]=Sentinels[1]
  endif
  if IsPlayer(Sentinels[2])then
    set x=x+1
    set boolean143[x]=Sentinels[2]
  endif
  if IsPlayer(Sentinels[3])then
    set x=x+1
    set boolean143[x]=Sentinels[3]
  endif
  if IsPlayer(Sentinels[4])then
    set x=x+1
    set boolean143[x]=Sentinels[4]
  endif
  if IsPlayer(Sentinels[5])then
    set x=x+1
    set boolean143[x]=Sentinels[5]
  endif
  if IsPlayer(Scourges[1])then
    set y=y+1
    set boolean144[y]=Scourges[1]
  endif
  if IsPlayer(Scourges[2])then
    set y=y+1
    set boolean144[y]=Scourges[2]
  endif
  if IsPlayer(Scourges[3])then
    set y=y+1
    set boolean144[y]=Scourges[3]
  endif
  if IsPlayer(Scourges[4])then
    set y=y+1
    set boolean144[y]=Scourges[4]
  endif
  if IsPlayer(Scourges[5])then
    set y=y+1
    set boolean144[y]=Scourges[5]
  endif
  set i=1
  loop
    exitwhen i>x
    call SavePlayerHandle(hashtable019,(2000),(550+GetPlayerId(boolean143[i])),(boolean144[i]))
    call SavePlayerHandle(hashtable019,(2000),(550+GetPlayerId(boolean144[i])),(boolean143[i]))
    set i=i+1
  endloop
endfunction

function HDE takes nothing returns nothing
  call RemoveHero(GetEnumUnit())
endfunction

function boolean116 takes unit Hero returns nothing
  local integer HFE=GetPlayerId(GetOwningPlayer(Hero))
  set Mode_MM_Item0[HFE]=UnitItemInSlot(Hero,0)
  set Mode_MM_Item1[HFE]=UnitItemInSlot(Hero,1)
  set Mode_MM_Item2[HFE]=UnitItemInSlot(Hero,2)
  set Mode_MM_Item3[HFE]=UnitItemInSlot(Hero,3)
  set Mode_MM_Item4[HFE]=UnitItemInSlot(Hero,4)
  set Mode_MM_Item5[HFE]=UnitItemInSlot(Hero,5)
endfunction

function boolean117 takes player WV8,player WW8 returns integer
  local unit boolean115=udg_Hero[GetPlayerId(WV8)]
  local unit timers004=udg_Hero[GetPlayerId(WW8)]
  call UnitRemoveBuffs(boolean115,true,true)
  call UnitRemoveBuffs(timers004,true,true)
  if boolean115==null and timers004==null then
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15,udg_Colors[GetPlayerId(Sentinels[0])]+(IL7[GetPlayerId((WV8))])+" "+GetObjectName('n067')+" "+(IL7[GetPlayerId((WW8))])+" "+GetObjectName('n0A0')+"|r")
  elseif GetRandomInt(1,2)==1 then
    if(boolean115!=null)then
      return GetUnitTypeId(boolean115)
    else
      return GetUnitTypeId(timers004)
    endif
  else
    if(timers004!=null)then
      return GetUnitTypeId(timers004)
    else
      return GetUnitTypeId(boolean115)
    endif
  endif
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15,udg_Colors[GetPlayerId(Sentinels[0])]+(IL7[GetPlayerId((WV8))])+" "+GetObjectName('n067')+" "+(IL7[GetPlayerId((WW8))])+" "+GetObjectName('n09B'))
  set boolean115=null
  set timers004=null
  return GetSetElement()
endfunction

function HJE takes nothing returns nothing
  if(GetUnitTypeId(GetEnumUnit())=='n004')then
    call RemoveUnit(GetEnumUnit())
  endif
  if(GetUnitTypeId(GetEnumUnit())=='o003')then
    call RemoveUnit(GetEnumUnit())
  endif
endfunction

function group019 takes nothing returns boolean
  local integer VT8
  local group boolean118=GetAvailableGroup()
  local unit HNE
  local location GJE=GetRectCenter(gg_rct_Hero_Creation_NE)
  local location GKE=GetRectCenter(gg_rct_Hero_Creation_UD)
  local integer boolean119=CountPlayersInForce(Force_SentPlayers)
  local player array boolean120
  local player array integers059
  local integer x
  local integer y
  local real integer486
  local real HSE
  local real HTE
  local integer boolean114
  local group HQ9=GetAvailableGroup()
  call GroupEnumUnitsInRect(HQ9,GetWorldBounds(),Condition(function ReturnTrue2))
  call ForGroup(HQ9,function HJE)
  call KillGroup(HQ9)
  set VT8=1
  set x=1
  set y=1
  loop
    exitwhen VT8>5
    if(IsPlayer(Sentinels[VT8]))then
      call boolean116(udg_Hero[GetPlayerId(Sentinels[VT8])])
      call GroupAddUnit(boolean118,udg_Hero[GetPlayerId(Sentinels[VT8])])
      set boolean120[x]=Sentinels[VT8]
      set x=x+1
    endif
    if(IsPlayer(Scourges[VT8]))then
      call boolean116(udg_Hero[GetPlayerId(Scourges[VT8])])
      call GroupAddUnit(boolean118,udg_Hero[GetPlayerId(Scourges[VT8])])
      set integers059[y]=Scourges[VT8]
      set y=y+1
    endif
    set VT8=VT8+1
  endloop
  set x=1
  loop
    exitwhen x>boolean119
    set boolean114=boolean117(boolean120[x],integers059[x])
    if(udg_Hero[GetPlayerId(boolean120[x])]==null)then
      set integer486=GetLocationX(GJE)+GetRandomReal(1,40)
      set HSE=GetLocationY(GJE)+GetRandomReal(1,40)
      set HTE=270
    else
      set integer486=GetUnitX(udg_Hero[GetPlayerId(boolean120[x])])
      set HSE=GetUnitY(udg_Hero[GetPlayerId(boolean120[x])])
      set HTE=GetUnitFacing(udg_Hero[GetPlayerId(boolean120[x])])
      call SetUnitPathing(udg_Hero[GetPlayerId(boolean120[x])],false)
    endif
    set udg_Hero[GetPlayerId(boolean120[x])]=CreateUnit(boolean120[x],boolean114,integer486,HSE,HTE)
    set HeroTypeId[GetPlayerId(boolean120[x])]=boolean114
    call SetUnitPathing(udg_Hero[GetPlayerId(boolean120[x])],false)
    call SetUnitPosition(udg_Hero[GetPlayerId(boolean120[x])],integer486,HSE)
    call UnitAddItem(udg_Hero[GetPlayerId(boolean120[x])],Mode_MM_Item0[GetPlayerId(boolean120[x])])
    call UnitAddItem(udg_Hero[GetPlayerId(boolean120[x])],Mode_MM_Item1[GetPlayerId(boolean120[x])])
    call UnitAddItem(udg_Hero[GetPlayerId(boolean120[x])],Mode_MM_Item2[GetPlayerId(boolean120[x])])
    call UnitAddItem(udg_Hero[GetPlayerId(boolean120[x])],Mode_MM_Item3[GetPlayerId(boolean120[x])])
    call UnitAddItem(udg_Hero[GetPlayerId(boolean120[x])],Mode_MM_Item4[GetPlayerId(boolean120[x])])
    call UnitAddItem(udg_Hero[GetPlayerId(boolean120[x])],Mode_MM_Item5[GetPlayerId(boolean120[x])])
    call ClearSelectionForPlayer(boolean120[x])
    call SelectUnitAddForPlayer(udg_Hero[GetPlayerId(boolean120[x])],boolean120[x])
    call PanCameraToTimedForPlayer(boolean120[x],integer486,HSE,0)
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Awaken\\Awaken.mdl",integer486,HSE))
    if(udg_Hero[GetPlayerId(integers059[x])]==null)then
      set integer486=GetLocationX(GKE)
      set HSE=GetLocationY(GKE)
      set HTE=270
    else
      set integer486=GetUnitX(udg_Hero[GetPlayerId(integers059[x])])
      set HSE=GetUnitY(udg_Hero[GetPlayerId(integers059[x])])
      set HTE=GetUnitFacing(udg_Hero[GetPlayerId(integers059[x])])
      call SetUnitPathing(udg_Hero[GetPlayerId(integers059[x])],false)
    endif
    set udg_Hero[GetPlayerId(integers059[x])]=CreateUnit(integers059[x],boolean114,integer486,HSE,HTE)
    set HeroTypeId[GetPlayerId(integers059[x])]=boolean114
    call SetUnitPathing(udg_Hero[GetPlayerId(integers059[x])],false)
    call SetUnitPosition(udg_Hero[GetPlayerId(integers059[x])],integer486,HSE)
    call UnitAddItem(udg_Hero[GetPlayerId(integers059[x])],Mode_MM_Item0[GetPlayerId(integers059[x])])
    call UnitAddItem(udg_Hero[GetPlayerId(integers059[x])],Mode_MM_Item1[GetPlayerId(integers059[x])])
    call UnitAddItem(udg_Hero[GetPlayerId(integers059[x])],Mode_MM_Item2[GetPlayerId(integers059[x])])
    call UnitAddItem(udg_Hero[GetPlayerId(integers059[x])],Mode_MM_Item3[GetPlayerId(integers059[x])])
    call UnitAddItem(udg_Hero[GetPlayerId(integers059[x])],Mode_MM_Item4[GetPlayerId(integers059[x])])
    call UnitAddItem(udg_Hero[GetPlayerId(integers059[x])],Mode_MM_Item5[GetPlayerId(integers059[x])])
    call ClearSelectionForPlayer(integers059[x])
    call SelectUnitAddForPlayer(udg_Hero[GetPlayerId(integers059[x])],integers059[x])
    call PanCameraToTimedForPlayer(integers059[x],integer486,HSE,0)
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Awaken\\Awaken.mdl",integer486,HSE))
    set x=x+1
  endloop
  call ForGroup(boolean118,function HDE)
  call KillGroup(boolean118)
  set x=1
  loop
    exitwhen x>boolean119
    call SetUnitPathing(udg_Hero[GetPlayerId(boolean120[x])],true)
    call SetUnitPathing(udg_Hero[GetPlayerId(integers059[x])],true)
    set x=x+1
  endloop
  call RemoveLocation(GJE)
  call RemoveLocation(GKE)
  set boolean118=null
  set HNE=null
  set GJE=null
  set GKE=null
  set HQ9=null
  return false
endfunction

function HVE takes nothing returns boolean
  set E2=true
  return false
endfunction

function HWE takes nothing returns boolean
  set udg_Allow_Repick=false
  set udg_Allow_Random=false
  call TechAll()
  return false
endfunction

function C3D takes nothing returns nothing
  local trigger t=CreateTrigger()
  call DisplayTimedTextToForceEx(AllPlayers,10,GetObjectName('n09H'))
  call DisplayTimedTextToForceEx(AllPlayers,10,GetObjectName('n09E'))
  set Mode_MM_Activated=true
  call TechHeroForAll('H00I')
  call TriggerRegisterTimerEvent(t,60-TimerGetElapsed(GlobalTimer),false)
  call TriggerAddCondition(t,Condition(function group019))
  set t=CreateTrigger()
  call TriggerAddCondition(t,Condition(function HWE))
  call TriggerRegisterTimerEvent(t,57-TimerGetElapsed(GlobalTimer),false)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,55+60-TimerGetElapsed(GlobalTimer),false)
  call TriggerAddCondition(t,Condition(function HVE))
  set t=null
endfunction

function LDD takes nothing returns nothing
  local location SpawnSent=GetRectCenter(G4)
  local location SpawnScourge=GetRectCenter(F4)
  local location GJE=GetRectCenter(gg_rct_Hero_Creation_NE)
  local location GKE=GetRectCenter(gg_rct_Hero_Creation_UD)
  local integer VT8
  local integer VU8
  local integer VA8
  if not Mode_DU then
    call TechAll()
  endif
  set Mode_TR=true
  set MinGoldForRepick=400
  set udg_Allow_Random=false
  call PanCameraToTimedLocForPlayer(Sentinels[1],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[2],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[3],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[4],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[5],GJE,0)
  call PanCameraToTimedLocForPlayer(Scourges[1],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[2],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[3],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[4],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[5],GKE,0)
  if Mode_SH then
    if IsSentinel(PlayerModeTyper)then
      loop
        set VA8=GetRandomInt(FirstSentinelHeroIndexid,LastSentinelHeroIndexid)
        exitwhen IsHeroIngame[VA8]==false
      endloop
      set udg_Hero[GetPlayerId(PlayerModeTyper)]=CreateUnit(PlayerModeTyper,HeroID[VA8],GetLocationX(SpawnSent),GetLocationY(SpawnSent),270)
      set HeroTypeId[GetPlayerId(PlayerModeTyper)]=HeroID[VA8]
    else
      loop
        set VA8=GetRandomInt(FirstScourgeHeroIndexid,LastScourgeHeroIndexid)
        exitwhen IsHeroIngame[VA8]==false
      endloop
      set udg_Hero[GetPlayerId(PlayerModeTyper)]=CreateUnit(PlayerModeTyper,HeroID[VA8],GetLocationX(SpawnScourge),GetLocationY(SpawnScourge),270)
      set HeroTypeId[GetPlayerId(PlayerModeTyper)]=HeroID[VA8]
    endif
    call RemoveLocation(SpawnSent)
    call RemoveLocation(SpawnScourge)
    call RemoveLocation(GJE)
    call RemoveLocation(GKE)
    return
  endif
  set udg_Allow_Repick=false
  set VT8=1
  set VU8=5
  loop
    exitwhen VT8>VU8
    set udg_Hero[GetPlayerId(Sentinels[VT8])]=null
    set HeroTypeId[GetPlayerId(Sentinels[VT8])]=0
    if(IsPlayer(Sentinels[VT8]))then
      loop
        set VA8=GetRandomInt(FirstSentinelHeroIndexid,LastSentinelHeroIndexid)
        if(IsHeroIngame[VA8]==false)then
          if not Mode_DU then
            set b_isHeroPicked[VA8]=true
            set IsHeroIngame[VA8]=true
          endif
          set udg_Hero[GetPlayerId(Sentinels[VT8])]=CreateUnitAtLoc(Sentinels[VT8],HeroID[VA8],SpawnSent,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Sentinels[VT8])]=HeroID[VA8]
        endif
        exitwhen(udg_Hero[GetPlayerId(Sentinels[VT8])]!=null)
      endloop
    endif
    set VT8=VT8+1
  endloop
  set VT8=1
  set VU8=5
  loop
    exitwhen VT8>VU8
    set udg_Hero[GetPlayerId(Scourges[VT8])]=null
    set HeroTypeId[GetPlayerId(Scourges[VT8])]=0
    if(IsPlayer(Scourges[VT8]))then
      loop
        set VA8=GetRandomInt(FirstScourgeHeroIndexid,LastScourgeHeroIndexid)
        if(IsHeroIngame[VA8]==false)then
          if not Mode_DU then
            set b_isHeroPicked[VA8]=true
            set IsHeroIngame[VA8]=true
          endif
          set udg_Hero[GetPlayerId(Scourges[VT8])]=CreateUnitAtLoc(Scourges[VT8],HeroID[VA8],SpawnScourge,bj_UNIT_FACING)
          set HeroTypeId[GetPlayerId(Scourges[VT8])]=HeroID[VA8]
        endif
        exitwhen(udg_Hero[GetPlayerId(Scourges[VT8])]!=null)
      endloop
    endif
    set VT8=VT8+1
  endloop
  set udg_Allow_Repick=true
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  call RemoveLocation(GJE)
  call RemoveLocation(GKE)
  set SpawnSent=null
  set SpawnScourge=null
  set GJE=null
  set GKE=null
endfunction

function HXE takes nothing returns nothing
  set CL=true
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10,GetObjectName('n06K')+" "+GetObjectName('n06L'))
  call DisableTrigger(GetTriggeringTrigger())
endfunction

function HYE takes nothing returns nothing
  local integer HZE=S2I(SubString(GetEventPlayerChatString(),6,StringLength(GetEventPlayerChatString())))
  if HZE>666 then
    call Error(PlayerModeTyper,GetObjectName('n03C'))
  elseif HZE<10 then
    call Error(PlayerModeTyper,GetObjectName('n02I'))
  else
    set DL=HZE
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10,GetObjectName('n06X')+" "+I2S(DL)+" "+GetObjectName('n06N'))
    call DisableTrigger(GetTriggeringTrigger())
  endif
endfunction

function HAE takes nothing returns nothing
  call DisableTrigger((LoadTriggerHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(170))))
  call DisableTrigger((LoadTriggerHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(171))))
  call DisableTrigger(GetTriggeringTrigger())
endfunction

function HBE takes nothing returns nothing
  local trigger HCE=CreateTrigger()
  local trigger H3E=CreateTrigger()
  local trigger nd=CreateTrigger()
  set DL=66
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.," ")
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n06O')+" -nd "+GetObjectName('n067')+" -lives xx "+GetObjectName('n06Q'))
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,GetObjectName('n060')+" "+I2S(DL))
  call TriggerRegisterTimerEvent(HCE,15,false)
  call TriggerAddAction(HCE,function HAE)
  call SaveTriggerHandle(hashtable019,(GetHandleId(HCE)),(170),(nd))
  call SaveTriggerHandle(hashtable019,(GetHandleId(HCE)),(171),(H3E))
  call TriggerRegisterPlayerChatEvent(nd,PlayerModeTyper,"-nd",true)
  call TriggerAddAction(nd,function HXE)
  call TriggerRegisterPlayerChatEvent(H3E,PlayerModeTyper,"-lives",false)
  call TriggerAddAction(H3E,function HYE)
  set HCE=null
  set H3E=null
  set nd=null
endfunction

function H6E takes nothing returns nothing
  local integer HLE=(LoadInteger(hashtable019,(GetHandleId(GetTriggeringTrigger())),(173)))
  local integer VT8
  local integer VU8
  local integer VA8
  local integer B78
  local location SpawnSent=GetRectCenter(gg_rct_Allpick_Sent)
  local location SpawnScourge=GetRectCenter(gg_rct_Allpick_Scourge)
  if GameEnded then
    return
  endif
  if IsSentinel(Player(HLE))then
    set VT8=FirstSentinelHeroIndexid
    set VU8=LastSentinelHeroIndexid
    set B78=0
  else
    set VT8=FirstScourgeHeroIndexid
    set VU8=LastScourgeHeroIndexid
    set B78=1
  endif
  if Mode_AP then
    set VT8=FirstSentinelHeroIndexid
    set VU8=LastScourgeHeroIndexid
    if IsSentinel(Player(HLE))then
      call CreateUnitAtLoc(Player(HLE),'n00C',SpawnSent,bj_UNIT_FACING)
      call CreateUnitAtLoc(Player(HLE),'n00C',SpawnScourge,bj_UNIT_FACING)
    else
      call CreateUnitAtLoc(Player(HLE),'n00C',SpawnSent,bj_UNIT_FACING)
      call CreateUnitAtLoc(Player(HLE),'n00C',SpawnScourge,bj_UNIT_FACING)
    endif
  else
    set VT8=FirstSentinelHeroIndexid
    set VU8=LastScourgeHeroIndexid
    if IsSentinel(Player(HLE))then
      call CreateUnitAtLoc(Player(HLE),'n00C',SpawnSent,bj_UNIT_FACING)
    else
      call CreateUnitAtLoc(Player(HLE),'n00C',SpawnScourge,bj_UNIT_FACING)
    endif
  endif
  set tt_int1=HLE
  call ExeFunc("FixPassiveSkills_DisableAbilitiesForPlayerFromGlobal")
  if not Mode_AR then
    loop
      exitwhen VT8>VU8
      if IsHeroIngame[VT8]==false then
        call SetPlayerTechMaxAllowed(Player(HLE),HeroID[VT8],999)
      endif
      set VT8=VT8+1
    endloop
    if(GetPlayerState(Player(HLE),PLAYER_STATE_RESOURCE_GOLD)<250)then
      call SetPlayerState(Player(HLE),PLAYER_STATE_RESOURCE_GOLD,250)
    endif
  elseif(Deathmatch_LivesUsed[B78]<DL)then
    set udg_Hero[HLE]=null
    set HeroTypeId[HLE]=0
    if IsPlayer(Player(HLE))then
      loop
        if IsSentinel(Player(HLE))then
          set udg_Hero[HLE]=CreateUnitAtLoc(Player(HLE),QC8(),SpawnSent,bj_UNIT_FACING)
          set HeroTypeId[HLE]=GetUnitTypeId(udg_Hero[HLE])
        else
          set udg_Hero[HLE]=CreateUnitAtLoc(Player(HLE),QC8(),SpawnScourge,bj_UNIT_FACING)
          set HeroTypeId[HLE]=GetUnitTypeId(udg_Hero[HLE])
        endif
        exitwhen udg_Hero[HLE]!=null
      endloop
    endif
  endif
  call TimerStart(PrimaryUltiCooldownTimer[HLE],0,false,null)
  call TimerStart(SecondaryUltiCooldownTimer[HLE],0,false,null)
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  if not Mode_AR then
  endif
  set SpawnSent=null
  set SpawnScourge=null
endfunction

function CCD takes nothing returns nothing
  local location YT9
  local real H1E
  local trigger t
  local integer H0E
  local integer x
  set Mode_DM=true
  //call TechHeroForAll('H00I')
  set x=1
  loop
    exitwhen x>5
    set H0E=GetPlayerId(Sentinels[x])
    set t=CreateTrigger()
    call TriggerRegisterTimerExpireEvent(t,HeroRespawnTimer[H0E])
    call TriggerAddAction(t,function H6E)
    call SaveInteger(hashtable019,(GetHandleId(t)),(173),(H0E))
    set H0E=GetPlayerId(Scourges[x])
    set t=CreateTrigger()
    call TriggerRegisterTimerExpireEvent(t,HeroRespawnTimer[H0E])
    call TriggerAddAction(t,function H6E)
    call SaveInteger(hashtable019,(GetHandleId(t)),(173),(H0E))
    set x=x+1
  endloop
  call UnitRemoveAbility(CirclesOfPower_1,'Aawa')
  call UnitRemoveAbility(CirclesOfPower_2,'Aawa')
  call UnitRemoveAbility(CirclesOfPower_3,'Aawa')
  call UnitRemoveAbility(CirclesOfPower_4,'Aawa')
  call UnitRemoveAbility(CirclesOfPower_5,'Aawa')
  call UnitRemoveAbility(CirclesOfPower_7,'Aawa')
  call UnitRemoveAbility(CirclesOfPower_8,'Aawa')
  call UnitRemoveAbility(CirclesOfPower_9,'Aawa')
  call UnitRemoveAbility(CirclesOfPower_10,'Aawa')
  call UnitRemoveAbility(CirclesOfPower_11,'Aawa')
  call ExeFunc("HBE")
  call RemoveLocation(YT9)
  set YT9=null
  set t=null
endfunction

function LKD takes nothing returns nothing
  local integer FCE=GetRandomInt(1,4)
  set Mode_MR=true
  if(FCE==1)then
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,GetObjectName('n0FD'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.," ")
    call ExeFunc("LID")
  endif
  if(FCE==2)then
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,GetObjectName('n0FE'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.," ")
    call ExeFunc("LJD")
  endif
  if(FCE==3)then
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,GetObjectName('n0FK'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.," ")
    call ExeFunc("L8D")
  endif
  if(FCE==4)then
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,GetObjectName('n0FM'))
    call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.," ")
    call ExeFunc("C1D")
    call ExeFunc("L7D")
  endif
endfunction

function L4D takes nothing returns nothing
  set Mode_DU=true
  call TechHeroForAll('H00I')
endfunction

function CZD takes nothing returns nothing
  local integer HW9=CountPlayersInForce(Force_SentPlayers)
  local integer HV9=CountPlayersInForce(Force_ScourgePlayers)
  local integer YO8=HW9+HV9
  local integer VT8
  local integer group021
  local integer x
  local integer y
  local integer z
  local player array group022
  local player array I4E
  local integer w
  local integer I7E
  local integer I8E
  local location GJE=GetRectCenter(gg_rct_Hero_Creation_NE)
  local location GKE=GetRectCenter(gg_rct_Hero_Creation_UD)
  local location SpawnSent=GetRectCenter(gg_rct_Allpick_Sent)
  local location SpawnScourge=GetRectCenter(gg_rct_Allpick_Scourge)
  local integer i
  
  
  set Mode_SP=true
  call VG9(Sentinels[1])
  call VG9(Sentinels[2])
  call VG9(Sentinels[3])
  call VG9(Sentinels[4])
  call VG9(Sentinels[5])
  call VG9(Scourges[1])
  call VG9(Scourges[2])
  call VG9(Scourges[3])
  call VG9(Scourges[4])
  call VG9(Scourges[5])
  set x=1
  loop
    exitwhen x>5
    if IsPlayer(Sentinels[x])then
      call CreateUnitAtLoc(Sentinels[x],'n00C',SpawnSent,bj_UNIT_FACING)
      call CreateUnitAtLoc(Sentinels[x],'n00C',SpawnScourge,bj_UNIT_FACING)
    endif
    if IsPlayer(Scourges[x])then
      call CreateUnitAtLoc(Scourges[x],'n00C',SpawnSent,bj_UNIT_FACING)
      call CreateUnitAtLoc(Scourges[x],'n00C',SpawnScourge,bj_UNIT_FACING)
    endif
    set x=x+1
  endloop
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  set I7E=GetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Sentinels[2],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Sentinels[3],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Sentinels[4],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Sentinels[5],PLAYER_STATE_RESOURCE_GOLD)
  set I8E=GetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Scourges[2],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Scourges[3],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Scourges[4],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Scourges[5],PLAYER_STATE_RESOURCE_GOLD)
  set group022[1]=null
  set group022[2]=null
  set group022[3]=null
  set group022[4]=null
  set group022[5]=null
  set group022[6]=null
  set group022[7]=null
  set group022[8]=null
  set group022[9]=null
  set group022[10]=null
  set z=1
  set w=1
  set VT8=1
  loop
    exitwhen VT8>5
    if(IsPlayer(Sentinels[VT8]))then
      set group022[w]=Sentinels[VT8]
      set w=w+1
    else
      set I4E[z]=Sentinels[VT8]
      set z=z+1
    endif
    set VT8=VT8+1
  endloop
  set VT8=1
  loop
    exitwhen VT8>5
    if(IsPlayer(Scourges[VT8]))then
      set group022[w]=Scourges[VT8]
      set w=w+1
    else
      set I4E[z]=Scourges[VT8]
      set z=z+1
    endif
    set VT8=VT8+1
  endloop
  set Sentinels[1]=null
  set Sentinels[2]=null
  set Sentinels[3]=null
  set Sentinels[4]=null
  set Sentinels[5]=null
  set Scourges[1]=null
  set Scourges[2]=null
  set Scourges[3]=null
  set Scourges[4]=null
  set Scourges[5]=null
  set VT8=1
  loop
    exitwhen VT8>(YO8/ 2)
    set group021=GetRandomInt(1,YO8)
    if(group022[group021]!=null)then
      set Sentinels[VT8]=group022[group021]
      set group022[group021]=null
      set VT8=VT8+1
    endif
  endloop
  set x=VT8
  set VT8=1
  loop
    exitwhen VT8>YO8-x+1
    set group021=GetRandomInt(1,YO8)
    if(group022[group021]!=null)then
      set Scourges[VT8]=group022[group021]
      set group022[group021]=null
      set VT8=VT8+1
    endif
  endloop
  set z=VT8
  set VT8=x
  set y=1
  loop
    exitwhen VT8>5
    set Sentinels[VT8]=I4E[y]
    set y=y+1
    set VT8=VT8+1
  endloop
  set VT8=z
  loop
    exitwhen VT8>5
    set Scourges[VT8]=I4E[y]
    set y=y+1
    set VT8=VT8+1
  endloop
  set VT8=0
  loop
    exitwhen VT8>5
    set VT8=VT8+1
  endloop
  call SetPlayerTeam(Sentinels[0],0)
  call SetPlayerTeam(Sentinels[1],0)
  call SetPlayerTeam(Sentinels[2],0)
  call SetPlayerTeam(Sentinels[3],0)
  call SetPlayerTeam(Sentinels[4],0)
  call SetPlayerTeam(Sentinels[5],0)
  call SetPlayerTeam(Scourges[0],1)
  call SetPlayerTeam(Scourges[1],1)
  call SetPlayerTeam(Scourges[2],1)
  call SetPlayerTeam(Scourges[3],1)
  call SetPlayerTeam(Scourges[4],1)
  call SetPlayerTeam(Scourges[5],1)
  set i=1
  loop
    set PlayersId[i]=GetPlayerId(Sentinels[i])
    set i=i+1
    exitwhen i>5
  endloop
  set i=7
  loop
    set PlayersId[i]=GetPlayerId(Scourges[i-6])
    set i=i+1
    exitwhen i>11
  endloop
  call HK9()
  set x=0
  set y=0
  loop
    exitwhen x>5
    loop
      exitwhen y>5
      call SetPlayerAllianceStateBJ(Sentinels[x],Sentinels[y],3)
      call SetPlayerAllianceStateBJ(Scourges[x],Scourges[y],3)
      call SetPlayerAllianceStateBJ(Sentinels[x],Scourges[y],0)
      call SetPlayerAllianceStateBJ(Scourges[x],Sentinels[y],0)
      set y=y+1
    endloop
    set y=0
    set x=x+1
  endloop
  call ForceClear(Force_SentPlayers)
  call ForceClear(Force_ScourgePlayers)
  call ForceAddPlayer(Force_SentPlayers,Sentinels[0])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[1])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[2])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[3])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[4])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[5])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[0])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[1])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[2])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[3])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[4])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[5])
  call ExeFunc("HM9")
  call Trig_display_leaderboard_Actions()
  set HW9=CountPlayersInForce(Force_SentPlayers)
  set HV9=CountPlayersInForce(Force_ScourgePlayers)
  set VT8=1
  loop
    exitwhen VT8>5
    if(IsPlayer(Sentinels[VT8]))then
      call SetPlayerStateBJ(Sentinels[VT8],PLAYER_STATE_RESOURCE_GOLD,(4375/ HW9))
      call SetPlayerStateBJ(Sentinels[VT8],PLAYER_STATE_RESOURCE_LUMBER,0)
    endif
    if(IsPlayer(Scourges[VT8]))then
      call SetPlayerStateBJ(Scourges[VT8],PLAYER_STATE_RESOURCE_GOLD,(4375/ HV9))
      call SetPlayerStateBJ(Scourges[VT8],PLAYER_STATE_RESOURCE_LUMBER,0)
    endif
    set VT8=VT8+1
  endloop
  if udg_ObserverMode then
    set x=0
    loop
      exitwhen x>5
      call SetPlayerAlliance(Player(0),Sentinels[x],ConvertAllianceType(0),true)
      call SetPlayerAlliance(Player(0),Sentinels[x],ConvertAllianceType(4),true)
      call SetPlayerAlliance(Player(0),Scourges[x],ConvertAllianceType(0),false)
      call SetPlayerAlliance(Player(0),Scourges[x],ConvertAllianceType(4),false)
      set x=x+1
    endloop
  endif
  call StorePlayersColorValues()
  call RemoveLocation(GJE)
  call RemoveLocation(GKE)
  set GJE=null
  set GKE=null
  set SpawnSent=null
  set SpawnScourge=null
endfunction

function CAD takes nothing returns nothing
  local integer HW9=CountPlayersInForce(Force_SentPlayers)
  local integer HV9=CountPlayersInForce(Force_ScourgePlayers)
  local integer YO8=HW9+HV9
  local integer VT8
  local integer group021
  local integer x
  local integer y
  local integer z
  local player array group022
  local player array I4E
  local integer w
  local integer I7E
  local integer I8E
  local location GJE
  local location GKE
  local location SpawnSent
  local location SpawnScourge
  local integer integer468
  set integer468=GetRandomInt(1,2)
  call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,GetObjectName('n0GY'))
  if integer468==1 then
    return
  endif
  set L07=true
  set GJE=GetRectCenter(gg_rct_Hero_Creation_NE)
  set GKE=GetRectCenter(gg_rct_Hero_Creation_UD)
  set SpawnSent=GetRectCenter(gg_rct_Allpick_Sent)
  set SpawnScourge=GetRectCenter(gg_rct_Allpick_Scourge)
  call VG9(Sentinels[1])
  call VG9(Sentinels[2])
  call VG9(Sentinels[3])
  call VG9(Sentinels[4])
  call VG9(Sentinels[5])
  call VG9(Scourges[1])
  call VG9(Scourges[2])
  call VG9(Scourges[3])
  call VG9(Scourges[4])
  call VG9(Scourges[5])
  set x=1
  loop
    exitwhen x>5
    if IsPlayer(Sentinels[x])then
      call CreateUnitAtLoc(Sentinels[x],'n00C',SpawnSent,bj_UNIT_FACING)
      call CreateUnitAtLoc(Sentinels[x],'n00C',SpawnScourge,bj_UNIT_FACING)
    endif
    if IsPlayer(Scourges[x])then
      call CreateUnitAtLoc(Scourges[x],'n00C',SpawnSent,bj_UNIT_FACING)
      call CreateUnitAtLoc(Scourges[x],'n00C',SpawnScourge,bj_UNIT_FACING)
    endif
    set x=x+1
  endloop
  call RemoveLocation(SpawnSent)
  call RemoveLocation(SpawnScourge)
  set I7E=GetPlayerState(Sentinels[1],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Sentinels[2],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Sentinels[3],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Sentinels[4],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Sentinels[5],PLAYER_STATE_RESOURCE_GOLD)
  set I8E=GetPlayerState(Scourges[1],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Scourges[2],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Scourges[3],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Scourges[4],PLAYER_STATE_RESOURCE_GOLD)+GetPlayerState(Scourges[5],PLAYER_STATE_RESOURCE_GOLD)
  set group022[1]=Sentinels[1]
  set group022[2]=Sentinels[2]
  set group022[3]=Sentinels[3]
  set group022[4]=Sentinels[4]
  set group022[5]=Sentinels[5]
  set group022[6]=Scourges[1]
  set group022[7]=Scourges[2]
  set group022[8]=Scourges[3]
  set group022[9]=Scourges[4]
  set group022[10]=Scourges[5]
  set Sentinels[1]=group022[6]
  set Sentinels[2]=group022[7]
  set Sentinels[3]=group022[8]
  set Sentinels[4]=group022[9]
  set Sentinels[5]=group022[10]
  set Scourges[1]=group022[1]
  set Scourges[2]=group022[2]
  set Scourges[3]=group022[3]
  set Scourges[4]=group022[4]
  set Scourges[5]=group022[5]
  call SetPlayerTeam(Sentinels[0],0)
  call SetPlayerTeam(Sentinels[1],0)
  call SetPlayerTeam(Sentinels[2],0)
  call SetPlayerTeam(Sentinels[3],0)
  call SetPlayerTeam(Sentinels[4],0)
  call SetPlayerTeam(Sentinels[5],0)
  call SetPlayerTeam(Scourges[0],1)
  call SetPlayerTeam(Scourges[1],1)
  call SetPlayerTeam(Scourges[2],1)
  call SetPlayerTeam(Scourges[3],1)
  call SetPlayerTeam(Scourges[4],1)
  call SetPlayerTeam(Scourges[5],1)
  call HK9()
  set x=0
  set y=0
  loop
    exitwhen x>5
    loop
      exitwhen y>5
      call SetPlayerAllianceStateBJ(Sentinels[x],Sentinels[y],3)
      call SetPlayerAllianceStateBJ(Scourges[x],Scourges[y],3)
      call SetPlayerAllianceStateBJ(Sentinels[x],Scourges[y],0)
      call SetPlayerAllianceStateBJ(Scourges[x],Sentinels[y],0)
      set y=y+1
    endloop
    set y=0
    set x=x+1
  endloop
  call ForceClear(Force_SentPlayers)
  call ForceClear(Force_ScourgePlayers)
  call ForceAddPlayer(Force_SentPlayers,Sentinels[0])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[1])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[2])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[3])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[4])
  call ForceAddPlayer(Force_SentPlayers,Sentinels[5])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[0])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[1])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[2])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[3])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[4])
  call ForceAddPlayer(Force_ScourgePlayers,Scourges[5])
  call ExeFunc("HM9")
  set HW9=CountPlayersInForce(Force_SentPlayers)
  set HV9=CountPlayersInForce(Force_ScourgePlayers)
  set VT8=1
  loop
    exitwhen VT8>5
    if(IsPlayer(Sentinels[VT8]))then
      call SetPlayerStateBJ(Sentinels[VT8],PLAYER_STATE_RESOURCE_GOLD,(4375/ HW9))
      call SetPlayerStateBJ(Sentinels[VT8],PLAYER_STATE_RESOURCE_LUMBER,0)
    endif
    if(IsPlayer(Scourges[VT8]))then
      call SetPlayerStateBJ(Scourges[VT8],PLAYER_STATE_RESOURCE_GOLD,(4375/ HV9))
      call SetPlayerStateBJ(Scourges[VT8],PLAYER_STATE_RESOURCE_LUMBER,0)
    endif
    set VT8=VT8+1
  endloop
  call PanCameraToTimedLocForPlayer(Sentinels[1],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[2],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[3],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[4],GJE,0)
  call PanCameraToTimedLocForPlayer(Sentinels[5],GJE,0)
  call PanCameraToTimedLocForPlayer(Scourges[1],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[2],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[3],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[4],GKE,0)
  call PanCameraToTimedLocForPlayer(Scourges[5],GKE,0)
  if udg_ObserverMode then
    set x=0
    loop
      exitwhen x>5
      call SetPlayerAlliance(Player(0),Sentinels[x],ConvertAllianceType(0),true)
      call SetPlayerAlliance(Player(0),Sentinels[x],ConvertAllianceType(4),true)
      call SetPlayerAlliance(Player(0),Scourges[x],ConvertAllianceType(0),false)
      call SetPlayerAlliance(Player(0),Scourges[x],ConvertAllianceType(4),false)
      set x=x+1
    endloop
  endif
  call StorePlayersColorValues()
  call Trig_display_leaderboard_Actions()
  call RemoveLocation(GJE)
  call RemoveLocation(GKE)
  set GJE=null
  set GKE=null
  set SpawnSent=null
  set SpawnScourge=null
endfunction

function CLD takes nothing returns nothing
  local integer VT8
  local integer VU8
  set Mode_AA=true
  set VT8=1
  set VU8=IntHeroesAmount
  loop
    exitwhen VT8>VU8
    call TechHeroForAll(IntHeroesArray[VT8])
    set b_isHeroPicked[GetHeroIndexFromId(IntHeroesArray[VT8])]=true
    set VT8=VT8+1
  endloop
  set VT8=1
  set VU8=StrHeroesAmount
  loop
    exitwhen VT8>VU8
    call TechHeroForAll(StrHeroesArray[VT8])
    set b_isHeroPicked[GetHeroIndexFromId(StrHeroesArray[VT8])]=true
    set VT8=VT8+1
  endloop
endfunction

function IDE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer UZ8=(LoadInteger(hashtable019,(Cache),(172)))
  local player p
  local integer x=1
  loop
    exitwhen x>5
    set p=Sentinels[x]
    if IsPlayer(p)and p!=PlayerModeTyper then
      set udg_Hero[GetPlayerId(p)]=CreateUnit(p,UZ8,GetRectCenterX(gg_rct_Hero_Creation_NE),GetRectCenterY(gg_rct_Hero_Creation_NE),270)
      set HeroTypeId[GetPlayerId(p)]=UZ8
    endif
    set p=Scourges[x]
    if IsPlayer(p)and p!=PlayerModeTyper then
      set udg_Hero[GetPlayerId(p)]=CreateUnit(p,UZ8,GetRectCenterX(gg_rct_Hero_Creation_UD),GetRectCenterY(gg_rct_Hero_Creation_UD),270)
      set HeroTypeId[GetPlayerId(p)]=UZ8
    endif
    set x=x+1
  endloop
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set p=null
  return false
endfunction

function IEE takes nothing returns nothing
  local integer x=1
  local player p
  local unit Hero=GetTriggerUnit()
  local integer UZ8=GetUnitTypeId(Hero)
  local trigger t
  local integer Cache
  if(GetOwningPlayer(Hero)==PlayerModeTyper and IsUnitType(Hero,UNIT_TYPE_HERO))then
    call DisableTrigger(GetTriggeringTrigger())
    if PlayerUseRandomStatus[GetPlayerId(PlayerModeTyper)]==false and Mode_AR==false and Mode_TR==false then
      call SetPlayerState(PlayerModeTyper,PLAYER_STATE_RESOURCE_GOLD,250+GetPlayerState(PlayerModeTyper,PLAYER_STATE_RESOURCE_GOLD))
    endif
    set PlayerHaveRealHero[GetPlayerId(PlayerModeTyper)]=true
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,.01,false)
    call TriggerAddCondition(t,Condition(function IDE))
    call SaveInteger(hashtable019,(Cache),(172),(UZ8))
  endif
  set p=null
  set Hero=null
  set t=null
endfunction

function C6D takes nothing returns nothing
  local integer x=1
  local trigger t=CreateTrigger()
  local region r=CreateRegion()
  set Mode_SH=true
  call TechHeroForAll('H00I')
  loop
    exitwhen x>5
    if(Sentinels[x]!=PlayerModeTyper)then
      call VS8(Sentinels[x])
      set PlayerUseRandomStatus[GetPlayerId(Sentinels[x])]=true
      set PlayerHaveRealHero[GetPlayerId(Sentinels[x])]=true
    endif
    if(Scourges[x]!=PlayerModeTyper)then
      call VS8(Scourges[x])
      set PlayerUseRandomStatus[GetPlayerId(Scourges[x])]=true
      set PlayerHaveRealHero[GetPlayerId(Scourges[x])]=true
    endif
    set x=x+1
  endloop
  call RegionAddRect(r,bj_mapInitialPlayableArea)
  call TriggerRegisterEnterRegion(t,r,Condition(function ReturnTrue2))
  call TriggerAddAction(t,function IEE)
  set r=null
  set t=null
endfunction

function C0D takes nothing returns nothing
  local integer VT8
  local integer VU8
  set Mode_AS=true
  set VT8=1
  set VU8=IntHeroesAmount
  loop
    exitwhen VT8>VU8
    call TechHeroForAll(IntHeroesArray[VT8])
    set b_isHeroPicked[GetHeroIndexFromId(IntHeroesArray[VT8])]=true
    set IsHeroIngame[GetHeroIndexFromId(IntHeroesArray[VT8])]=true
    set VT8=VT8+1
  endloop
  set VT8=1
  set VU8=AgilityHeroesAmount
  loop
    exitwhen VT8>VU8
    call TechHeroForAll(AgiHeroesArray[VT8])
    set VT8=VT8+1
  endloop
endfunction

function C1D takes nothing returns nothing
  local integer VT8
  local integer VU8
  set Mode_AI=true
  set VT8=1
  set VU8=AgilityHeroesAmount
  loop
    exitwhen VT8>VU8
    call TechHeroForAll(AgiHeroesArray[VT8])
    set b_isHeroPicked[GetHeroIndexFromId(AgiHeroesArray[VT8])]=true
    set IsHeroIngame[GetHeroIndexFromId(AgiHeroesArray[VT8])]=true
    set VT8=VT8+1
  endloop
  set VT8=1
  set VU8=StrHeroesAmount
  loop
    exitwhen VT8>VU8
    call TechHeroForAll(StrHeroesArray[VT8])
    set b_isHeroPicked[GetHeroIndexFromId(StrHeroesArray[VT8])]=true
    set IsHeroIngame[GetHeroIndexFromId(StrHeroesArray[VT8])]=true
    set VT8=VT8+1
  endloop
endfunction

function C2D takes nothing returns nothing
  local integer VT8
  local integer VU8
  set Mode_MO=true
  set VT8=1
  set VU8=RangeHeroesAmount
  loop
    exitwhen VT8>VU8
    call TechHeroForAll(RangeHeroesArray[VT8])
    set b_isHeroPicked[GetHeroIndexFromId(RangeHeroesArray[VT8])]=true
    set IsHeroIngame[GetHeroIndexFromId(RangeHeroesArray[VT8])]=true
    set VT8=VT8+1
  endloop
endfunction

function C5D takes nothing returns nothing
  local integer VT8
  local integer VU8
  set Mode_RO=true
  set VT8=1
  set VU8=MeleeHeroesAmount
  loop
    exitwhen VT8>VU8
    call TechHeroForAll(MeleeHeroesArray[VT8])
    set b_isHeroPicked[GetHeroIndexFromId(MeleeHeroesArray[VT8])]=true
    set IsHeroIngame[GetHeroIndexFromId(MeleeHeroesArray[VT8])]=true
    set VT8=VT8+1
  endloop
endfunction

function LMD takes nothing returns nothing
  set Mode_ID=true
endfunction

function LPD takes nothing returns nothing
  set Mode_EM=true
  call SetPlayerTechResearched(Sentinels[0],'R004',1)
  call SetPlayerTechResearched(Scourges[0],'R004',1)
  call SetPlayerHandicapXP(Sentinels[1],1.5)
  call SetPlayerHandicapXP(Sentinels[2],1.5)
  call SetPlayerHandicapXP(Sentinels[3],1.5)
  call SetPlayerHandicapXP(Sentinels[4],1.5)
  call SetPlayerHandicapXP(Sentinels[5],1.5)
  call SetPlayerHandicapXP(Scourges[1],1.5)
  call SetPlayerHandicapXP(Scourges[2],1.5)
  call SetPlayerHandicapXP(Scourges[3],1.5)
  call SetPlayerHandicapXP(Scourges[4],1.5)
  call SetPlayerHandicapXP(Scourges[5],1.5)
endfunction

function LND takes nothing returns nothing
  set Mode_NP=true
  call DisableTrigger(T47)
endfunction

function InitSuperCreepsMode takes nothing returns nothing
  set Mode_SC=true
endfunction

function IFE takes nothing returns nothing
  set D78=false
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10,GetObjectName('n0HA'))
  call DisableTrigger(GetTriggeringTrigger())
endfunction

function IGE takes nothing returns nothing
  call DisableTrigger((LoadTriggerHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(174))))
  call DisableTrigger(GetTriggeringTrigger())
endfunction

function IHE takes nothing returns nothing
  local trigger HCE=CreateTrigger()
  local trigger t=CreateTrigger()
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.," ")
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,10.,"Extra commands: -noneutrals can be entered in the following 15 seconds. ")
  call TriggerRegisterTimerEvent(HCE,15,false)
  call TriggerAddAction(HCE,function IGE)
  call SaveTriggerHandle(hashtable019,(GetHandleId(HCE)),(174),(t))
  call TriggerRegisterPlayerChatEvent(t,PlayerModeTyper,"-noneutrals",true)
  call TriggerAddAction(t,function IFE)
  set HCE=null
  set t=null
endfunction

function LQD takes nothing returns nothing
  set Mode_OM=true
  call ExeFunc("IHE")
endfunction

function LRD takes nothing returns nothing
  set Mode_NB=true
endfunction

function CBD takes nothing returns nothing
  set udg_ModeUB=true
endfunction

function LTD takes nothing returns nothing
  set Mode_NM=true
endfunction

function LSD takes nothing returns nothing
  set Mode_NT=true
endfunction

function LVD takes nothing returns nothing
  set Mode_NR=true
  set Mode_NS=true
endfunction

function LWD takes nothing returns nothing
  set DF8=true
endfunction

function LUD takes nothing returns nothing
  set BL=true
  set EL=true
endfunction

function LXD takes nothing returns nothing
  set Mode_PM=true
endfunction

function IIE takes nothing returns nothing
  local integer i=0
  loop
    exitwhen i>5
    call SetPlayerName(Sentinels[i],(IL7[GetPlayerId((Sentinels[i]))])+" ("+I2S(GlobalKillsCounter[GetPlayerId(Sentinels[i])])+"/"+I2S(GlobalDeathCounter[GetPlayerId(Sentinels[i])])+" | "+I2S(PlayerCS[GetPlayerId(Sentinels[i])])+"-"+I2S(PlayerDenyCounter[GetPlayerId(Sentinels[i])])+")")
    call SetPlayerName(Scourges[i],(IL7[GetPlayerId((Scourges[i]))])+" ("+I2S(GlobalKillsCounter[GetPlayerId(Scourges[i])])+"/"+I2S(GlobalDeathCounter[GetPlayerId(Scourges[i])])+" | "+I2S(PlayerCS[GetPlayerId(Scourges[i])])+"-"+I2S(PlayerDenyCounter[GetPlayerId(Scourges[i])])+")")
    set i=i+1
  endloop
endfunction

function IJE takes nothing returns boolean
  if Mode_OI==false then
    if GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2 then
      call IIE()
    endif
  endif
  return false
endfunction

function LYD takes nothing returns nothing
  set Mode_OI=true
endfunction

function IKE takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  call SetUnitScale(Hero,U18(Hero)*DH8,U18(Hero)*DH8,U18(Hero)*DH8)
  set Hero=null
endfunction

function IME takes nothing returns boolean
  if b_isPickTime==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) then
    call IKE()
  endif
  return false
endfunction

function LZD takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterEnterRectSimple(t,bj_mapInitialPlayableArea)
  call TriggerAddCondition(t,Condition(function IME))
  set t=null
  set Mode_MI=true
  set DH8=.5
endfunction

function LAD takes nothing returns nothing
  set Mode_FR=true
endfunction

function LBD takes nothing returns nothing
  set Mode_ER=true
endfunction

function INE takes nothing returns boolean
  if GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2 then
    if GetTriggerEvalCount(GetTriggeringTrigger())==1 then
      call CameraSetupSetDestPosition(DM8,0,0,.0)
    else
      call CameraSetupSetDestPosition(DM8,GetCameraTargetPositionX(),GetCameraTargetPositionY(),.0)
    endif
    call CameraSetupApplyForPlayer(true,DM8,GetLocalPlayer(),0)
    call SetTerrainFogEx(0,.0,100000.,.5,.353,.314,.235)
  endif
  return false
endfunction

function L3D takes nothing returns nothing
  local trigger t=CreateTrigger()
  set Mode_ZM=true
  set DM8=CreateCameraSetup()
  call CameraSetupSetField(DM8,CAMERA_FIELD_ZOFFSET,.0,.0)
  call CameraSetupSetField(DM8,CAMERA_FIELD_ROTATION,90.,.0)
  call CameraSetupSetField(DM8,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)
  call CameraSetupSetField(DM8,CAMERA_FIELD_TARGET_DISTANCE,2500.,.0)
  call CameraSetupSetField(DM8,CAMERA_FIELD_ROLL,.0,.0)
  call CameraSetupSetField(DM8,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
  call CameraSetupSetField(DM8,CAMERA_FIELD_FARZ,16000.,.0)
  call CameraSetupSetDestPosition(DM8,.0,.0,.0)
  call TriggerRegisterTimerEvent(t,180,true)
  call TriggerRegisterTimerEvent(t,.1,false)
  call TriggerAddCondition(t,Condition(function INE))
  set t=null
endfunction

function integer465 takes nothing returns boolean
  return IsSentinel(GetOwningPlayer(GetFilterUnit()))and IsRealHero(GetFilterUnit()) and GetUnitTypeId(GetFilterUnit())!='H00J'
endfunction

function integer466 takes nothing returns boolean
  return IsScourge(GetOwningPlayer(GetFilterUnit()))and IsRealHero(GetFilterUnit()) and GetUnitTypeId(GetFilterUnit())!='H00J'
endfunction

function integer467 takes nothing returns nothing
  local unit u=GetEnumUnit()
  call SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_LIFE)+200)
  call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MANA)+200)
  call SetPlayerState(GetOwningPlayer(u),PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(GetOwningPlayer(u),PLAYER_STATE_RESOURCE_GOLD)+150)
  call AddHeroXP(u,248,true)
  set u=null
endfunction

function integer462 takes integer i,integer boolean131,integer r,integer g,integer b,integer a,real x,real y,boolean show returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local image ITE=(LoadImageHandle(hashtable019,(Cache),(476+i)))
  local image integer461=(LoadImageHandle(hashtable019,(Cache),(484+i)))
  if ITE!=null then
    call DestroyImage(ITE)
    call SaveImageHandle(hashtable019,(Cache),(476+i),(null))
    set ITE=null
  endif
  if integer461!=null then
    call DestroyImage(integer461)
    call SaveImageHandle(hashtable019,(Cache),(484+i),(null))
    set integer461=null
  endif
  if show==false or boolean131<1 then
    return
  endif
  if StringLength(I2S(boolean131))>1 then
    call E7E("Fonts\\"+SubString(I2S(boolean131),0,1)+".blp",120,120,x-30,y,0,true)
    call SetImageColor(tt_image1,r,g,b,a)
    set ITE=tt_image1
    call E7E("Fonts\\"+SubString(I2S(boolean131),1,2)+".blp",120,120,x+30,y,0,true)
    call SetImageColor(tt_image1,r,g,b,a)
    set integer461=tt_image1
  else
    call E7E("Fonts\\0.blp",120,120,x-30,y,0,true)
    call SetImageColor(tt_image1,r,g,b,a)
    set ITE=tt_image1
    call E7E("Fonts\\"+SubString(I2S(boolean131),0,1)+".blp",120,120,x+30,y,0,true)
    call SetImageColor(tt_image1,r,g,b,a)
    set integer461=tt_image1
  endif
  call SaveImageHandle(hashtable019,(Cache),(476+i),(ITE))
  call SaveImageHandle(hashtable019,(Cache),(484+i),(integer461))
  set ITE=null
  set integer461=null
endfunction

function IVE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local group IWE=GetAvailableGroup()
  local group integer463=GetAvailableGroup()
  local integer IYE
  local integer IZE
  local real x
  local real y
  local rect r
  local player integer464
  local player IBE
  local integer i=0
  local integer time
  local unit CP
  local real DRD
  local real UK8=(TimerGetElapsed(GlobalTimer))
  loop
    exitwhen i>5
    set r=(LoadRectHandle(hashtable019,(Cache),(460+i)))
    set time=(LoadInteger(hashtable019,(Cache),(492+i)))
    set CP=(LoadUnitHandle(hashtable019,(Cache),(452+i)))
    set integer464=GetOwningPlayer(CP)
    set IBE=(LoadPlayerHandle(hashtable019,(Cache),(468+i)))
    set x=GetRectCenterX(r)
    set y=GetRectCenterY(r)
    call GroupEnumUnitsInRect(IWE,r,Condition(function integer465))
    call GroupEnumUnitsInRect(integer463,r,Condition(function integer466))
    set IYE=CountUnitsInGroup(IWE)
    set IZE=CountUnitsInGroup(integer463)
    if(IYE>0 and IZE>0)or(IYE==0 and IZE==0)then
      if integer464==Player15 then
        set IBE=Player15
        call SavePlayerHandle(hashtable019,(Cache),(468+i),(IBE))
      endif
      set time=61
      call SaveInteger(hashtable019,(Cache),(492+i),(time))
    elseif IYE>0 and IZE==0 then
      set IBE=Sentinels[1]
      call SavePlayerHandle(hashtable019,(Cache),(468+i),(IBE))
      set time=time-IYE
      call SaveInteger(hashtable019,(Cache),(492+i),(time))
    elseif IZE>0 and IYE==0 then
      set IBE=Scourges[1]
      call SavePlayerHandle(hashtable019,(Cache),(468+i),(IBE))
      set time=time-IZE
      call SaveInteger(hashtable019,(Cache),(492+i),(time))
    endif
    if IBE==Player15 and integer464!=Player15 then
      call SetUnitColor(CP,GetPlayerColor(IBE))
      call SetUnitOwner(CP,IBE,false)
      call integer462(i,time,255,0,0,255,x,y,false)
    elseif IBE==integer464 then
      call integer462(i,time,255,0,0,255,x,y,false)
      set time=61
      call SaveInteger(hashtable019,(Cache),(492+i),(time))
    elseif IBE!=Player15 then
      if time<61 then
        call integer462(i,time,255,0,0,255,x,y,true)
      else
        call integer462(i,time,255,0,0,255,x,y,false)
      endif
      if time<1 then
        call PingMinimapEx(x,y,2,255,255,255,false)
        call SoundForAllPlayers(IBE,"Sound\\Interface\\Rescue.wav")
        call SetUnitOwner(CP,IBE,false)
        set time=61
        call SaveInteger(hashtable019,(Cache),(492+i),(time))
        call SaveReal(hashtable019,(Cache),(500+i),((UK8)*1.))
        if IsSentinel(IBE)then
          call SetUnitColor(CP,GetPlayerColor(Sentinels[0]))
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,"|c00ff0303The Sentinel now controls a Capture Point.|r")
          call ForGroup(IWE,function integer467)
        else
          call SetUnitColor(CP,GetPlayerColor(Scourges[0]))
          call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,"|c00ff0303The Scourge now controls a Capture Point.|r")
          call ForGroup(integer463,function integer467)
        endif
      endif
    endif
    set i=i+1
  endloop
  call KillGroup(IWE)
  call KillGroup(integer463)
  set IWE=null
  set integer463=null
  set t=null
  set CP=null
  return false
endfunction

function boolean113 takes nothing returns boolean
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local fogmodifier Z58
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function IVE))
  call PingMinimapEx(GetRectCenterX(LB),GetRectCenterY(LB),4,255,255,255,false)
  call PingMinimapEx(GetRectCenterX(SB),GetRectCenterY(SB),4,255,255,255,false)
  call PingMinimapEx(GetRectCenterX(RB),GetRectCenterY(RB),4,255,255,255,false)
  call PingMinimapEx(GetRectCenterX(MB),GetRectCenterY(MB),4,255,255,255,false)
  call PingMinimapEx(GetRectCenterX(TB),GetRectCenterY(TB),4,255,255,255,false)
  call PingMinimapEx(GetRectCenterX(PB),GetRectCenterY(PB),4,255,255,255,false)
  set DO8=CreateUnit(Player15,'ncp2',GetRectCenterX(LB),GetRectCenterY(LB),0)
  set DP8=CreateUnit(Player15,'ncp2',GetRectCenterX(SB),GetRectCenterY(SB),0)
  set DQ8=CreateUnit(Player15,'ncp2',GetRectCenterX(RB),GetRectCenterY(RB),0)
  set DR8=CreateUnit(Player15,'ncp2',GetRectCenterX(MB),GetRectCenterY(MB),0)
  set DS8=CreateUnit(Player15,'ncp2',GetRectCenterX(TB),GetRectCenterY(TB),0)
  set DT8=CreateUnit(Player15,'ncp2',GetRectCenterX(PB),GetRectCenterY(PB),0)
  set Z58=CreateFogModifierRadius(Sentinels[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(LB),GetRectCenterY(LB),600,true,true)
  call FogModifierStart(Z58)
  set Z58=CreateFogModifierRadius(Scourges[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(LB),GetRectCenterY(LB),600,true,true)
  call FogModifierStart(Z58)
  set Z58=CreateFogModifierRadius(Sentinels[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(SB),GetRectCenterY(SB),600,true,true)
  call FogModifierStart(Z58)
  set Z58=CreateFogModifierRadius(Scourges[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(SB),GetRectCenterY(SB),600,true,true)
  call FogModifierStart(Z58)
  set Z58=CreateFogModifierRadius(Sentinels[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(RB),GetRectCenterY(RB),600,true,true)
  call FogModifierStart(Z58)
  set Z58=CreateFogModifierRadius(Scourges[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(RB),GetRectCenterY(RB),600,true,true)
  call FogModifierStart(Z58)
  set Z58=CreateFogModifierRadius(Sentinels[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(MB),GetRectCenterY(MB),600,true,true)
  call FogModifierStart(Z58)
  set Z58=CreateFogModifierRadius(Scourges[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(MB),GetRectCenterY(MB),600,true,true)
  call FogModifierStart(Z58)
  set Z58=CreateFogModifierRadius(Sentinels[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(TB),GetRectCenterY(TB),600,true,true)
  call FogModifierStart(Z58)
  set Z58=CreateFogModifierRadius(Scourges[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(TB),GetRectCenterY(TB),600,true,true)
  call FogModifierStart(Z58)
  set Z58=CreateFogModifierRadius(Sentinels[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(PB),GetRectCenterY(PB),600,true,true)
  call FogModifierStart(Z58)
  set Z58=CreateFogModifierRadius(Scourges[1],FOG_OF_WAR_VISIBLE,GetRectCenterX(PB),GetRectCenterY(PB),600,true,true)
  call FogModifierStart(Z58)
  call ZR8("Speed",DO8,255,233,12)
  call ZR8("Speed",DR8,255,233,12)
  call ZR8("Combat",DP8,255,233,12)
  call ZR8("Combat",DS8,255,233,12)
  call ZR8("Regen",DQ8,255,233,12)
  call ZR8("Regen",DT8,255,233,12)
  call UnitAddAbility(DO8,'S00O')
  call UnitAddAbility(DR8,'S00R')
  call UnitAddAbility(DP8,'A1PO')
  call UnitAddAbility(DP8,'A1PL')
  call UnitAddAbility(DS8,'A1PN')
  call UnitAddAbility(DS8,'A1PJ')
  call UnitAddAbility(DQ8,'A1PV')
  call UnitAddAbility(DQ8,'A1PF')
  call UnitAddAbility(DT8,'A1PD')
  call UnitAddAbility(DT8,'A1PE')
  call SaveUnitHandle(hashtable019,(Cache),(452),(DO8))
  call SaveUnitHandle(hashtable019,(Cache),(453),(DP8))
  call SaveUnitHandle(hashtable019,(Cache),(454),(DQ8))
  call SaveUnitHandle(hashtable019,(Cache),(455),(DR8))
  call SaveUnitHandle(hashtable019,(Cache),(456),(DS8))
  call SaveUnitHandle(hashtable019,(Cache),(457),(DT8))
  call SaveReal(hashtable019,(Cache),(500),((-1)*1.))
  call SaveReal(hashtable019,(Cache),(501),((-1)*1.))
  call SaveReal(hashtable019,(Cache),(502),((-1)*1.))
  call SaveReal(hashtable019,(Cache),(503),((-1)*1.))
  call SaveReal(hashtable019,(Cache),(504),((-1)*1.))
  call SaveReal(hashtable019,(Cache),(505),((-1)*1.))
  call SaveRectHandle(hashtable019,(Cache),(460),(LB))
  call SaveRectHandle(hashtable019,(Cache),(461),(SB))
  call SaveRectHandle(hashtable019,(Cache),(462),(RB))
  call SaveRectHandle(hashtable019,(Cache),(463),(MB))
  call SaveRectHandle(hashtable019,(Cache),(464),(TB))
  call SaveRectHandle(hashtable019,(Cache),(465),(PB))
  call SavePlayerHandle(hashtable019,(Cache),(468),(Player15))
  call SavePlayerHandle(hashtable019,(Cache),(469),(Player15))
  call SavePlayerHandle(hashtable019,(Cache),(470),(Player15))
  call SavePlayerHandle(hashtable019,(Cache),(471),(Player15))
  call SavePlayerHandle(hashtable019,(Cache),(472),(Player15))
  call SavePlayerHandle(hashtable019,(Cache),(473),(Player15))
  call SaveInteger(hashtable019,(Cache),(492),(61))
  call SaveInteger(hashtable019,(Cache),(493),(61))
  call SaveInteger(hashtable019,(Cache),(494),(61))
  call SaveInteger(hashtable019,(Cache),(495),(61))
  call SaveInteger(hashtable019,(Cache),(496),(61))
  call SaveInteger(hashtable019,(Cache),(497),(61))
  call SaveImageHandle(hashtable019,(Cache),(476),(null))
  call SaveImageHandle(hashtable019,(Cache),(484),(null))
  call SaveImageHandle(hashtable019,(Cache),(477),(null))
  call SaveImageHandle(hashtable019,(Cache),(485),(null))
  call SaveImageHandle(hashtable019,(Cache),(478),(null))
  call SaveImageHandle(hashtable019,(Cache),(486),(null))
  call SaveImageHandle(hashtable019,(Cache),(479),(null))
  call SaveImageHandle(hashtable019,(Cache),(487),(null))
  call SaveImageHandle(hashtable019,(Cache),(480),(null))
  call SaveImageHandle(hashtable019,(Cache),(488),(null))
  call SaveImageHandle(hashtable019,(Cache),(481),(null))
  call SaveImageHandle(hashtable019,(Cache),(489),(null))
  call CleanTrigger(GetTriggeringTrigger())
  set t=null
  set Z58=null
  return false
endfunction

function RVD takes nothing returns nothing
  local trigger t
  if Mode_CP then
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,600,false)
    call TriggerAddCondition(t,Condition(function boolean113))
    set t=null
  endif
endfunction

function L6D takes nothing returns nothing
  set Mode_CP=true
endfunction

function integer469 takes nothing returns nothing
  set MultikillCounter[1]=0
endfunction

function I6E takes nothing returns nothing
  set MultikillCounter[2]=0
endfunction

function ILE takes nothing returns nothing
  set MultikillCounter[3]=0
endfunction

function integer471 takes nothing returns nothing
  set MultikillCounter[4]=0
endfunction

function I0E takes nothing returns nothing
  set MultikillCounter[5]=0
endfunction

function integer470 takes nothing returns nothing
  set MultikillCounter[7]=0
endfunction

function integer472 takes nothing returns nothing
  set MultikillCounter[8]=0
endfunction

function J4E takes nothing returns nothing
  set MultikillCounter[9]=0
endfunction

function J7E takes nothing returns nothing
  set MultikillCounter[10]=0
endfunction

function J8E takes nothing returns nothing
  set MultikillCounter[11]=0
endfunction

function J9E takes nothing returns nothing
  local integer i=1
  local string id
  local player p
  loop
    exitwhen i>5
    set p=Sentinels[i]
    set id=I2S(GetPlayerId(p))
    call StoreInteger(MN,id,"id",i)
    set p=Scourges[i]
    set id=I2S(GetPlayerId(p))
    call StoreInteger(MN,id,"id",i+5)
    if GetLocalPlayer()==PlayerModeTyper then
      call SyncStoredInteger(MN,I2S(GetPlayerId(Sentinels[i])),"id")
      call SyncStoredInteger(MN,I2S(GetPlayerId(Scourges[i])),"id")
    endif
    set i=i+1
  endloop
  set p=null
endfunction

function JDE takes nothing returns boolean
  if Mode_Normal then
    call CED("-"+"sdzm3lseb",2)
    // call VW8()
    // call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.,udg_Colors[GetPlayerId(PlayerModeTyper)]+(IL7[GetPlayerId((PlayerModeTyper))])+"|r"+" "+GetObjectName('n0CM'))
    // call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,20.," ")
    // set SK=true
    // call ModePicked()
    // call ZHD()
    // call Trig_display_leaderboard_Actions()
    // call CreateObsBoard()
  endif
  call J9E()
  call CleanTrigger(GetTriggeringTrigger())
  return false
endfunction

function JEE takes nothing returns boolean
  set IsHeroesAvailable=true
  call CleanTrigger(GetTriggeringTrigger())
  return false
endfunction

function JFE takes nothing returns nothing
endfunction

function JHE takes nothing returns nothing
  set boolean179=true
endfunction


function Ensnare_Hold takes nothing returns nothing
  local timer tt=GetExpiredTimer()
  local unit target=LoadUnitHandle(hashtable019,GetHandleId(tt),0)
  call FlushChildHashtable(hashtable019,GetHandleId(tt))
  call IssueImmediateOrder(target,"holdposition")
  call DestroyTimer(tt)
  set tt=null
  set target=null
endfunction

function EnsnareUnitDur takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local real time=TimerGetElapsed(GlobalTimer)
  local real end=LoadReal(hashtable019,h,0)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer id=LoadInteger(hashtable019,h,0)
  local timer tt
  local unit dummy=LoadUnitHandle(hashtable019,h,5)
  
  if GetTriggerEventId()==EVENT_UNIT_DEATH or time>end then
    call SetUnitTurnSpeed(u,GetUnitDefaultTurnSpeed(u))
    call RemoveSavedHandle(MHT,GetHandleId(u),'ENSN')
    call RemoveUnit(dummy)
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_TARGET_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_POINT_ORDER then
    
    if (GetIssuedOrderId()!=851983 and GetIssuedOrderId()!=851984 and GetIssuedOrderId()!=852255 and GetIssuedOrderId()!=851993) then
      //call BJDebugMsg("move")
      set tt=CreateTimer()
      call TimerStart(tt,0,false,function Ensnare_Hold)
      call SaveUnitHandle(hashtable019,GetHandleId(tt),0,u)
      set tt=null
    endif
  else
    
    if GetUnitAbilityLevel(u,id)==0 then
      call SetUnitTurnSpeed(u,GetUnitDefaultTurnSpeed(u))
      call RemoveSavedHandle(MHT,GetHandleId(u),'ENSN')
      call RemoveUnit(dummy)
      call FlushChildHashtable(hashtable019,h)
      call CleanTrigger(t)
    else
      call SetUnitPosition(dummy,GetUnitX(u),GetUnitY(u))
      if GetUnitAbilityLevel(u,'A1HX')>0 then
        if GetUnitAbilityLevel(dummy,'A30X')>0 then
          call UnitRemoveAbility(dummy,'A30X')
        endif
      else
        if GetUnitAbilityLevel(dummy,'A30X')==0 then
          call UnitAddAbility2(dummy,'A30X')
        endif
      endif
      
    endif
  endif
  set t=null
  set u=null
  set dummy=null
endfunction

function EnsnareUnit takes unit u, integer id, real dur returns nothing
  local integer h
  local integer hu=GetHandleId(u)
  local trigger t=LoadTriggerHandle(MHT,hu,'ENSN')
  local real time=TimerGetElapsed(GlobalTimer)
  local unit dummy
  local player p=Sentinels[0]
  
  //call BJDebugMsg("New time: "+R2S(time+dur)+"; old time: "+R2S(LoadReal(HY,GetHandleId(t),0)))
  if t!=null then
    set h=GetHandleId(t)
    if LoadReal(hashtable019,h,0)<time+dur then
      call SaveReal(hashtable019,h,0,time+dur)
      call SaveInteger(hashtable019,h,0,id)
    endif
  else
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call SaveUnitHandle(hashtable019,h,0,u)
    call SaveReal(hashtable019,h,0,time+dur)
    call SaveInteger(hashtable019,h,0,id)
    if IsSentinel(GetOwningPlayer(u)) then
      set p=Scourges[0]
    endif
    set dummy=CreateUnit(p,'hFFD',GetUnitX(u),GetUnitY(u),0)
    call SaveUnitHandle(hashtable019,h,5,dummy)
    
    call TriggerRegisterTimerEvent(t,0.1,true)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_ISSUED_ORDER)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_ISSUED_TARGET_ORDER)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_ISSUED_POINT_ORDER)
    call TriggerAddCondition(t,Condition(function EnsnareUnitDur))
    call SaveTriggerHandle(MHT,hu,'ENSN',t)
  endif
  call IssueImmediateOrder(u,"holdposition")
  call SetUnitTurnSpeed(u,0)
  set dummy=null
  set t=null
endfunction

function ChainlightningFadeout takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local lightning l=LoadLightningHandle(hashtable019,h,0)
  local unit u=LoadUnitHandle(hashtable019,h,1)
  local unit ta=LoadUnitHandle(hashtable019,h,2)
  local integer counter=LoadInteger(hashtable019,h,0)
  if counter==1.5/0.05 then
    call DestroyLightning(LoadLightningHandle(hashtable019,h,0))
    call FlushChildHashtable(hashtable019,h)
    call DestroyTimer(t)
  else
    call MoveLightning(l,true,GetUnitX(u),GetUnitY(u),GetUnitX(ta),GetUnitY(ta))
    call SetLightningColor(l,255,255,255,1-.03*counter)
    call SaveInteger(hashtable019,h,0,counter+1)
  endif
  set ta=null
  set l=null
  set u=null
  set t=null
endfunction

function ChainlightningFading takes lightning l, real fade,unit u, unit t returns nothing
  local timer tt=CreateTimer()
  local integer th=GetHandleId(tt)
  call TimerStart(tt,0.05,true,function ChainlightningFadeout)
  call SaveLightningHandle(hashtable019,th,0,l)
  call SaveUnitHandle(hashtable019,th,1,u)
  call SaveUnitHandle(hashtable019,th,2,t)
  call SaveInteger(hashtable019,th,0,0)
  set tt=null
endfunction

function ChainlightningTargets takes nothing returns boolean
  local unit u=GetFilterUnit()
  local player p=Sentinels[0]
  if IsSentinel(GetOwningPlayer(TEMPUNIT)) then
    set p=Scourges[0]
  endif
  if IsUnitInGroup(u,TempGroup)==false and (IsUnitAlly(TEMPUNIT,GetOwningPlayer(u)) or GetOwningPlayer(u)==NeutralsPlayer) and IsUnitVisibleLoD(u,p) and IsDead(u)==false and IsUnitType(u,UNIT_TYPE_STRUCTURE)==false and IsUnitType(u,UNIT_TYPE_MECHANICAL)==false and IsMagicImmune(u)==false then
    if DistanceBetweenXY(GetUnitX(TEMPUNIT),GetUnitY(TEMPUNIT),GetUnitX(u),GetUnitY(u))<TempReal then
      set tt_unit1=u
      set TempReal=DistanceBetweenXY(GetUnitX(TEMPUNIT),GetUnitY(TEMPUNIT),GetUnitX(u),GetUnitY(u))
    endif
  endif
  return false
endfunction

function ChainlightningBounces takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit target=LoadUnitHandle(hashtable019,h,0)
  local string which=LoadStr(hashtable019,h,0)
  local real aoe=LoadReal(hashtable019,h,1)
  local real damage=LoadReal(hashtable019,h,0)
  local real factor=LoadReal(hashtable019,h,2)
  local integer bounces=LoadInteger(hashtable019,h,0)
  local group g=GetAvailableGroup()
  local unit caster=LoadUnitHandle(hashtable019,h,10)
  local lightning l
  set TEMPUNIT=target
  set TempReal=9999.
  set tt_unit1=null
  set TempGroup=LoadGroupHandle(hashtable019,h,1)
  call GroupEnumUnitsInRange(g,GetUnitX(target),GetUnitY(target),aoe+25,Condition(function ChainlightningTargets))
  if IsDead(tt_unit1)==false then
    set l=AddLightning(which,true,GetUnitX(target),GetUnitY(target),GetUnitX(tt_unit1),GetUnitY(tt_unit1))
    call ChainlightningFading(l,.5,target,tt_unit1)
    set l=null
    call DamageTarget(caster,tt_unit1,1,damage)
    set bounces=bounces-1
    call GroupAddUnit(LoadGroupHandle(hashtable019,h,1),tt_unit1)
  else
    set bounces=0
  endif
  call KillGroup(g)
  if bounces>0 then
    call SaveUnitHandle(hashtable019,h,0,tt_unit1)
    call SaveReal(hashtable019,h,0,damage*(1-factor))
    call SaveInteger(hashtable019,h,0,bounces)
    
  else
    call KillGroup(LoadGroupHandle(hashtable019,h,1))
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
    
  endif
  
  set g=null
  set t=null
  set target=null
  set caster=null
  set l=null
endfunction

function ChainlightningStart takes unit caster, unit target, string which, real damage, real factor, real delay, integer bounces, real aoe returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local real cx=GetUnitX(caster)
  local real cy=GetUnitY(caster)
  local real tx=GetUnitX(target)
  local real ty=GetUnitY(target)
  local lightning l=AddLightning(which,true,cx,cy,tx,ty)
  if bounces>0 then
    call TriggerRegisterTimerEvent(t,delay,true)
    call TriggerAddCondition(t,Condition(function ChainlightningBounces))
    call SaveGroupHandle(hashtable019,h,1,GetAvailableGroup())
    call GroupAddUnit(LoadGroupHandle(hashtable019,h,1),target)
    call SaveUnitHandle(hashtable019,h,0,target)
    call SaveUnitHandle(hashtable019,h,10,caster)
    call SaveStr(hashtable019,h,0,which)
    call SaveInteger(hashtable019,h,0,bounces)
    call SaveReal(hashtable019,h,0,damage*(1-factor))
    call SaveReal(hashtable019,h,1,aoe)
    call SaveReal(hashtable019,h,2,factor)
    call SaveReal(hashtable019,h,3,delay)
  endif
  call ChainlightningFading(l,0.5,target,tt_unit1)
  call DamageTarget(caster,target,1,damage)
  set l=null
  set t=null
endfunction

function testchain takes nothing returns nothing
  call ChainlightningStart(GetTriggerUnit(),GetSpellTargetUnit(),"CLPB",25,0.1,.25,2,500)
  
endfunction



function Kodo_SpiteTimeout takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer k=LoadInteger(hashtable019,h,0)
  local integer stats=LoadInteger(hashtable019,h,1)
  if stats==1 then
    call SetHeroInt(u,GetHeroInt(u,false)+k,true)
  elseif stats==2 then
    call SetHeroAgi(u,GetHeroAgi(u,false)+k,true)
  elseif stats==3 then
    call SetHeroStr(u,GetHeroStr(u,false)+k,true)
  endif
  call DestroyEffect(LoadEffectHandle(hashtable019,h,2))
  call FlushChildHashtable(hashtable019,h)
  call DestroyTrigger(t)
  set u=null
  set t=null
endfunction

function Kodo_SpiteForGroup takes nothing returns nothing
  local real duration=0
  local unit u=GetEnumUnit()
  local trigger t
  local real dur=12.
  local integer stolen=0
  local integer curstat=0
  local integer lvl=GetUnitAbilityLevel(SpitTempUnit,'A32A')
  local integer stats=0
  if IsUnitType(u,UNIT_TYPE_HERO) then
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,dur,false)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
    //set curstat=GetHeroMainStatValue(u)-1
    //set stolen=IMinIF(curstat,lvl*3)
    set stats=3//GetUnitPrimaryAttribute(u)
    //		if stats==3 then
    set stolen=IMinIF(GetHeroStr(u,false)-1,lvl*3)
    call SetHeroStr(u,GetHeroStr(u,false)-stolen,true)
    //		elseif stats==2 then
    //			set stolen=IMinIF(GetHeroAgi(u,false)-1,lvl*3)
    //			call SetHeroAgi(u,GetHeroAgi(u,false)-stolen,true)
    //		elseif stats==1 then
    //			set stolen=IMinIF(GetHeroInt(u,false)-1,lvl*3)
    //			call SetHeroInt(u,GetHeroInt(u,false)-stolen,true)
    //		endif
    call SaveEffectHandle(hashtable019,GetHandleId(t),2,AddSpecialEffectTarget("effects\\DeathFumesBreathDamage.mdx",u,"origin"))
    call TriggerAddCondition(t,Condition(function Kodo_SpiteTimeout))
    call SaveUnitHandle(hashtable019,GetHandleId(t),0,u)
    call SaveInteger(hashtable019,GetHandleId(t),0,stolen)
    call SaveInteger(hashtable019,GetHandleId(t),1,stats)
    set t=null
    //call echo(I2S(stolen))
  endif
  //call echo("wtf?2")
  call DamageTarget(SpitTempUnit,u,1,25+50*lvl)
  
  set u=null
endfunction

function Kodo_SpiteFilter takes nothing returns boolean
  return IsDead(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(SpitTempUnit)) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsMagicImmune(GetFilterUnit())==false
endfunction


function Kodo_Spit takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local group g=GetAvailableGroup()
  local group gg=GetAvailableGroup()
  local integer lvl=GetUnitAbilityLevel(caster,GetSpellAbilityId())
  local real angle=AngleBetweenXY(GetUnitX(caster),GetUnitY(caster),GetSpellTargetX(),GetSpellTargetY())*bj_DEGTORAD
  local real x=GetUnitX(caster)
  local real y=GetUnitY(caster)
  local unit dummy=CreateUnit(GetOwningPlayer(caster),'e00E',GetUnitX(caster),GetUnitY(caster),angle*bj_RADTODEG)
  call UnitAddAbility(dummy,'A32X')
  if IssuePointOrderById(dummy,852580,x+125*Cos(angle),y+125*Sin(angle)) then//breath of fire
  endif
  
  set dummy=null
  set SpitTempUnit=caster
  call GroupEnumUnitsInRange(g,x+125*Cos(angle),y+125*Sin(angle),175,Condition(function Kodo_SpiteFilter))
  call GroupAddGroup(g,gg)
  call GroupEnumUnitsInRange(g,x+300*Cos(angle),y+300*Sin(angle),200,Condition(function Kodo_SpiteFilter))
  call GroupAddGroup(g,gg)
  call GroupEnumUnitsInRange(g,x+500*Cos(angle),y+500*Sin(angle),200,Condition(function Kodo_SpiteFilter))
  call GroupAddGroup(g,gg)
  call GroupEnumUnitsInRange(g,x+700*Cos(angle),y+700*Sin(angle),250,Condition(function Kodo_SpiteFilter))
  call GroupAddGroup(g,gg)
  //call echo (I2S(CountUnitsInGroup(g))+" "+I2S(CountUnitsInGroup(gg)))
  set SpitTempUnit=caster
  call ForGroup(gg,function Kodo_SpiteForGroup)
  call KillGroup(g)
  call KillGroup(gg)
  set caster=null
  set g=null
  set gg=null
endfunction

function kodo_TrampleTArgets takes nothing returns boolean
  return IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(SpitTempUnit)) and IsDead(GetFilterUnit())==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_MECHANICAL)==false and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')==0 and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitInGroup(GetFilterUnit(),TempGroup)==false
endfunction

function Kodo_TrampleForGroup takes nothing returns nothing
  local unit dummy=CreateUnit(GetOwningPlayer(GetEnumUnit()),'e00E',GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
  call DamageTarget(SpitTempUnit,GetEnumUnit(),1,TempReal)
  call UnitAddAbility(dummy,'A32B')
  call SetUnitAbilityLevel(dummy,'A32B',TempInteger)
  call IssueTargetOrder(dummy,"thunderbolt",GetEnumUnit())
  set dummy=null
endfunction

function Kodo_trampleDuration takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local real angle=LoadReal(hashtable019,h,0)
  local integer lvl=LoadInteger(hashtable019,h,0)
  local real x=LoadReal(hashtable019,h,1)
  local real y=LoadReal(hashtable019,h,2)
  local real cx
  local real cy
  local real speed=LoadReal(hashtable019,h,3)
  local group g
  local group affected=LoadGroupHandle(hashtable019,h,2)
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call SetUnitPathing(u,true)
    call DestroyEffect(LoadEffectHandle(hashtable019,h,4))
    call DestroyEffect(LoadEffectHandle(hashtable019,h,5))
    call KillGroup(affected)
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  else
    call SetUnitPosition(u,SafeX50(GetUnitX(u)+speed*Cos(angle)),SafeY50(GetUnitY(u)+speed*Sin(angle)))
    if ModuloInteger(GetTriggerEvalCount(t),10)==0 then
      call KillTrees(GetUnitX(u),GetUnitY(u),150)
    endif
    call SetUnitFacing(u,angle*bj_RADTODEG)
    if DistanceBetweenXY(x,y,GetUnitX(u),GetUnitY(u))<50 or DistanceBetweenXY(x,y,GetUnitX(u),GetUnitY(u))>850 or GetTriggerEvalCount(t)>550./speed then
      call DestroyEffect(LoadEffectHandle(hashtable019,h,4))
      call DestroyEffect(LoadEffectHandle(hashtable019,h,5))
      call SetUnitPathing(u,true)
      call KillGroup(affected)
      call FlushChildHashtable(hashtable019,h)
      call CleanTrigger(t)
    else
      call SetUnitAnimationByIndex(u,LoadInteger(MHT,GetUnitTypeId(u),'A1P8'))
      set cx=GetUnitX(u)
      set cy=GetUnitY(u)
      set g=GetAvailableGroup()
      set SpitTempUnit=u
      call GroupEnumUnitsInRange(g,cx,cy,275,Condition(function kodo_TrampleTArgets))
      
      set TempReal=lvl*50.0
      set TempInteger=lvl
      set SpitTempUnit=u
      set TempGroup=affected
      call ForGroup(g,function Kodo_TrampleForGroup)
      call GroupAddGroup(g,affected)
      call KillGroup(g)
    endif
  endif
  set g=null
  set affected=null
  set u=null
  set t=null
endfunction

function Kodo_Trample takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer lvl=GetUnitAbilityLevel(u,GetSpellAbilityId())
  local real cx=GetUnitX(u)
  local real cy=GetUnitY(u)
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real angle=AngleBetweenXY(cx,cy,x,y)*bj_DEGTORAD
  local trigger t
  local integer h
  local group g=GetAvailableGroup()
  local string s=GetProperAttachPoint_Foot(u)
  local string s2=""
  if s=="foot" then
    set s="foot,right"
    set s2="foot,left"
  endif
  if DistanceBetweenXY(cx,cy,x,y)>800 then
    set x=cx+800*Cos(angle)
    set y=cy+800*Sin(angle)
  endif
  
  call SetUnitFacingTimed(u,angle*bj_RADTODEG,.3)
  set t=CreateTrigger()
  set h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.02,true)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Kodo_trampleDuration))
  call SaveUnitHandle(hashtable019,h,0,u)
  call SaveEffectHandle(hashtable019,h,4,AddSpecialEffectTarget("effects\\SandWaveMissile.mdx",u,s))
  call SaveEffectHandle(hashtable019,h,5,AddSpecialEffectTarget("effects\\SandWaveMissile.mdx",u,s2))
  call SaveReal(hashtable019,h,0,angle)
  call SaveReal(hashtable019,h,1,x)
  call SaveReal(hashtable019,h,2,y)
  call SaveReal(hashtable019,h,3,650.0*0.02)//speed
  call SaveInteger(hashtable019,h,0,lvl)
  call SaveGroupHandle(hashtable019,h,2,g)
  call SetUnitPathing(u,false)
  set t=null
  set u=null
  set g=null
endfunction

function Kodo_DigestSpitHit takes nothing returns nothing
  local unit caster=tt_unit1
  local unit target=tt_unit2
  local integer lvl=GetUnitAbilityLevel(caster,'A32E')
  local real damage=lvl*40+40
  call DamageTarget(caster,target,1,damage)
  call CN8(target,'A32F',1,4,'B32F')
  set caster=null
  set target=null
endfunction

function Kodo_DigestAlignLog takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local unit u=LoadUnitHandle(hashtable019,GetHandleId(t),0)
  if IsDead(u) then
    call RemoveUnit(u)
    call FlushChildHashtable(hashtable019,GetHandleId(t))
    call DestroyTrigger(t)
  else
    call SetUnitFacing(u,90)
  endif
  set t=null
  set u= null
endfunction

function Kodo_DigestSpitEffect takes nothing returns nothing
  local trigger t=AddProjectile(GetTriggerUnit(),GetSpellTargetUnit(),'hKOD',"Kodo_DigestSpitHit",1000,true)
  //	local trigger tt=CreateTrigger()
  //	call TriggerRegisterTimerEvent(tt,0.02,true)
  //	call TriggerAddCondition(tt,Condition(function Kodo_DigestAlignLog))
  //	call SaveUnitHandle(HY,GetHandleId(tt),0,LoadUnitHandle(HY,GetHandleId(t),45))
  //	set tt=null
  set t=null
endfunction

function Kodo_DigestSpitEffectSup takes nothing returns nothing
  local integer i=LoadInteger(MHT,GetHandleId(GetTriggerUnit()),'A32D')-1
  if IsBlocked(GetSpellTargetUnit())==false then
    call Kodo_DigestSpitEffect()
  endif
  call SaveInteger(MHT,GetHandleId(GetTriggerUnit()),'A32D',i)
  if i<1 then
    call SaveBoolean(MHT,GetHandleId(GetTriggerUnit()),'A32D',false)
    call SetPlayerAbilityAvailable(GetOwningPlayer(GetTriggerUnit()),'A32D',false)
    call SetPlayerAbilityAvailable(GetOwningPlayer(GetTriggerUnit()),'A32E',true)
  endif
endfunction

function Kodo_DigestSpitCast takes nothing returns nothing
  local unit u=GetTriggerUnit()
  if LoadBoolean(MHT,GetHandleId(u),'A32D')==false or LoadInteger(MHT,GetHandleId(u),'A32D')<1 then
    call InterruptUnit(u)
    call Error(GetOwningPlayer(u),"No tree consumed")
  endif
  set u=null
endfunction

function ProgressBar takes real L9F returns string
  local string c1="|c00ff0303"
  local string c="||"
  local string p=" "
  local string s=c1+c+"|r"
  local string result
  if L9F>85 then
    set result=s+p+s+p+s+p+s+p+s+p+s+p+s
  elseif L9F>70 then
    set result=s+p+s+p+s+p+s+p+s+p+s+p+c
  elseif L9F>55 then
    set result=s+p+s+p+s+p+s+p+s+p+c+p+c
  elseif L9F>40 then
    set result=s+p+s+p+s+p+s+p+c+p+c+p+c
  elseif L9F>25 then
    set result=s+p+s+p+s+p+c+p+c+p+c+p+c
  elseif L9F>10 then
    set result=s+p+s+p+c+p+c+p+c+p+c+p+c
  elseif L9F>0 then
    set result=s+p+c+p+c+p+c+p+c+p+c+p+c
  else
    set result=c+p+c+p+c+p+c+p+c+p+c+p+c
  endif
  return result
endfunction

function Kodo_DigestAddSpit takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local real limit=LoadReal(hashtable019,h,0)
  local integer counter=LoadInteger(hashtable019,h,0)+1
  local texttag tt=LoadTextTagHandle(hashtable019,h,2)
  if counter>=R2I(limit) then
    if IsDead(u)==false then
      call UnitAddAbility2(u,'A32D')
      call SaveBoolean(MHT,GetHandleId(u),'A32D',true)//spit is available
      call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A32D',true)
      call SaveInteger(MHT,GetHandleId(u),'A32D',3)
    endif
    //call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A32E',true)
    call DestroyTextTag(tt)
    call FlushChildHashtable(hashtable019,h)
    call DestroyTimer(t)
  elseif IsDead(u) then
    call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A32E',true)
    call DestroyTextTag(tt)
    call FlushChildHashtable(hashtable019,h)
    call DestroyTimer(t)
  else
    call SetTextTagText(tt,ProgressBar(100*(limit-counter)/limit),.018)
    call SetTextTagPosUnit(tt,u,0)
    call SaveInteger(hashtable019,h,0,counter)
  endif
  set u=null
  set tt=null
  set t=null
endfunction

function Kodo_Digest_RemoveOwl2 takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local destructable d=LoadDestructableHandle(hashtable019,GetHandleId(t),0)
  local unit u=CreateUnit(Player(15),'e00E',GetDestructableX(d),GetDestructableY(d),0)
  call UnitAddAbility(u,'A1FD')
  if IssueTargetOrderById(u,852146,d) then
  endif
  call FlushChildHashtable(hashtable019,GetHandleId(t))
  call PauseTimer(t)
  call DestroyTimer(t)
  set t=null
endfunction

function Kodo_Digest_RemoveOwl takes destructable d returns nothing
  local timer t=CreateTimer()
  call TimerStart(t,0.3,false,function Kodo_Digest_RemoveOwl2)
  call SaveDestructableHandle(hashtable019,GetHandleId(t),0,d)
  set t=null
endfunction

function Kodo_Digest takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local integer lvl=GetUnitAbilityLevel(caster,GetSpellAbilityId())
  local real delay=12-lvl*2
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  local texttag tt=CreateTextTag()
  call SetTextTagText(tt,ProgressBar(100),.018)
  call SetTextTagPosUnit(tt,caster,0)
  call SetTextTagVisibility(tt,IsPlayerAlly(GetOwningPlayer(caster),GetLocalPlayer()))
  call SetTextTagPermanent(tt,false)
  call SetTextTagLifespan(tt,delay)
  call SaveTextTagHandle(hashtable019,h,2,tt)
  call TimerStart(t,0.05,true,function Kodo_DigestAddSpit)
  call SaveUnitHandle(hashtable019,h,0,caster)
  call SaveReal(hashtable019,h,0,delay/0.05)
  call SetPlayerAbilityAvailable(GetOwningPlayer(caster),'A32E',false)
  call Kodo_Digest_RemoveOwl(GetSpellTargetDestructable())
  set tt=null
  set caster=null
  set t=null
endfunction

function Kodo_DigestLeveling takes nothing returns nothing
  call UnitAddAbility2(GetTriggerUnit(),'A32E')
  call SetUnitAbilityLevel(GetTriggerUnit(),'A32E',GetUnitAbilityLevel(GetTriggerUnit(),'A32Y'))
endfunction

function Kodo_DigestAllItems takes nothing returns nothing
  local integer i=0
  set DigestItems[i]=Item_Real[indexid_UltimateOrb]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AssaultCuirass]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_DisabledHeartOfTarrasque]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_HeartOfTarrasque]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_BlackKingBar10]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_BlackKingBar09]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_BlackKingBar08]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_BlackKingBar07]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_BlackKingBar06]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_BlackKingBar05]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_BlackKingBar04]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_ShivasGuard]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_bloodstone]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_LinkensSphere]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_LinkenDummy]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_VanguardRanged]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Vanguard]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_BladeMail]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_SoulBooster]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_HoodOfDefiance]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_MantaStyleRanged]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_MantaStyle]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_GuinsooHex]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Orchid]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Eul]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_ForceStaff]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Dagon1]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Dagon2]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Dagon3]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Dagon4]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Dagon5]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Necronomicon1]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Necronomicon2]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Necronomicon3]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_RefresherOrb]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_VeilOfDiscord]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_RodOfAtos]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Mekansm]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_VladmirsOffering]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Pipe]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_DivineRapier]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_DivineRapierFree]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_MKBOn]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_MKBOff]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_RadianceOn]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_RadianceOff]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Butterfly]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Buriza]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_CraniumBasher]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_CraniumBasherRanged]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_BattleFury]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AbyssalBlade]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Crystalys]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_ArmletOn]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_ArmletOff]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_LotharsEdge]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_EtherealBlade]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_SangeAndYasha]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Satanic]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Mjollnir]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_EyeOfSkadiRanged]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_EyeOfSkadi]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Sange]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Yasha]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Maelstrom]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_DiffusalBlade_upg_empty]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_DiffusalBlade_upg]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_DiffusalBlade_empty]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_DiffusalBlade]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Desolator]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_HeavensHalberd]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_bootsOfTravel]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_HandOfMidas]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_DisabledKelensDagger]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_KelensDagger]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_DemonEdge]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Eaglehorn]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_Hyperstone]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_MesserschmidtReaver]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_MysticStaff]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_SacredRelic]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimBasic]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimFurion]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimKotL]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimLeshrak]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimLich]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimLina]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimLion]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimLucifer]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimLuna]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimNecro]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimOgre]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimZombie]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimPugna]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimQoP]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimRhasta]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimCM]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimVeno]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimWD]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimZeus]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimSniper]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimClockwerk]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimVS]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimJuggernaut]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimChaosKnight]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimChen]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimNightstalker]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimJakiro]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimSandKing]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimHuskar]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimInvoker]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimPanda]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_aghanimPudge]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimWR]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimVoid]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimSpiritbreaker]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimBane]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimAbaddon]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimDazzle]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimTechies]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimAxe]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimES]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimPuck]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimWL]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimRazor]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimViper]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimTiny]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimOD]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimEnchantress]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimDS]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimGyro]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimMeepo]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimBeastmaster]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_AghanimVisage]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_aghanimSilencer]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_aghanimAA]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_aghanimOmni]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_aghanimSkywrath]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_aghanimRubick]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_aghanimEnigma]
  set i=i+1
  set DigestItems[i]=Item_Real[indexid_aghanimDisruptor]
  set DigestItemsCount=i
endfunction

function Kodo_DigestBonusesPeriodic takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer count=0
  local integer lvl=GetUnitAbilityLevel(u,'A32G')
  local integer bonus=5+5*lvl
  local integer curbonus=LoadInteger(MHT,GetHandleId(u),'A32G')
  local integer i=0
  local integer id=0
  local integer k=0
  local integer totalbonus=0
  if lvl==0 then
    if curbonus>0 then
      call LoDStat_Sub(u,curbonus,"damage")
      call LoDStat_Sub(u,curbonus,"attack")
    endif
    call PauseTimer(t)
    call DestroyTimer(t)
    call FlushChildHashtable(hashtable019,h)
  else
    loop
      set k=0
      set id=GetItemTypeId(UnitItemInSlot(u,i))
      if id>0 then
        loop
          if DigestItems[k]==id then
            set count=count+1
            set k=DigestItemsCount
          endif
          set k=k+1
          exitwhen k>DigestItemsCount
        endloop
      endif
      set i=i+1
      exitwhen i>5
    endloop
    set totalbonus=count*bonus
    if totalbonus!=curbonus then
      call LoDStat_Sub(u,curbonus,"damage")
      call LoDStat_Sub(u,curbonus,"attack")
      call LoDStat_Add(u,totalbonus,"damage")
      call LoDStat_Add(u,totalbonus,"attack")
      call SaveInteger(MHT,GetHandleId(u),'A32G',totalbonus)
    endif
  endif
  set t=null
  set u=null
endfunction

function Kodo_DigestBonuses takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local timer t=CreateTimer()
  call TimerStart(t,1,true,function Kodo_DigestBonusesPeriodic)
  call SaveUnitHandle(hashtable019,GetHandleId(t),0,u)
  set t=null
  set u=null
endfunction


function Kodo_DrumsProvideBonusesStr takes unit u, integer str returns nothing
  local integer array b
  local integer a=str
  local integer c=1
  local integer i=0
  local integer z=5
  local real hp
  local integer array bonuses
  set bonuses[0]='A32N'
  set bonuses[1]='A32O'
  set bonuses[2]='A32P'
  set bonuses[3]='A32Q'
  set bonuses[4]='A32R'
  set bonuses[5]='A32S'
  if str<1 then
    set hp=GetUnitState(u,UNIT_STATE_LIFE)
    call UnitRemoveAbility(u,bonuses[0])
    call UnitRemoveAbility(u,bonuses[1])
    call UnitRemoveAbility(u,bonuses[2])
    call UnitRemoveAbility(u,bonuses[3])
    call UnitRemoveAbility(u,bonuses[4])
    call UnitRemoveAbility(u,bonuses[5])
    call SetUnitState(u,UNIT_STATE_LIFE,hp)
    return
  endif
  loop
    set c=a/2
    set b[i]=a-c*2
    set a=c
    set i=i+1
    exitwhen c==0
  endloop
  set i=0
  loop
    exitwhen i>z
    if b[i]==1 then
      call UnitAddAbility2(u,bonuses[i])
    else
      call UnitRemoveAbility(u,bonuses[i])
    endif
    set i=i+1
  endloop
endfunction

function Kodo_DrumsProvideBonuses takes unit u, integer str, integer others returns nothing
  local integer array b
  local integer a=others
  local integer c=1
  local integer i=0
  local integer z
  local real hp
  local integer array bonuses
  set bonuses[0]='A32H'
  set bonuses[1]='A32I'
  set bonuses[2]='A32J'
  set bonuses[3]='A32K'
  set bonuses[4]='A32L'
  set bonuses[5]='A32M'
  if others<1 then
    call UnitRemoveAbility(u,bonuses[0])
    call UnitRemoveAbility(u,bonuses[1])
    call UnitRemoveAbility(u,bonuses[2])
    call UnitRemoveAbility(u,bonuses[3])
    call UnitRemoveAbility(u,bonuses[4])
    call UnitRemoveAbility(u,bonuses[5])
    call Kodo_DrumsProvideBonusesStr(u,0)
    return
  endif
  loop
    set c=a/ 2
    set b[i]=a-c*2
    set a=c
    set i=i+1
    exitwhen c==0
  endloop
  set z=5
  set i=0
  loop
    exitwhen i>z
    if b[i]==1 then
      call UnitAddAbility2(u,bonuses[i])
    else
      call UnitRemoveAbility(u,bonuses[i])
    endif
    set i=i+1
  endloop
  call Kodo_DrumsProvideBonusesStr(u,str)
endfunction

function Kodo_DrumsDuration takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local integer hu=0
  local integer lvl=LoadInteger(hashtable019,h,0)
  local unit caster=LoadUnitHandle(hashtable019,h,0)
  local integer i=1
  local unit u=null
  local boolean isSc=LoadBoolean(hashtable019,h,0)
  local player p
  local integer pid=0
  local integer counter=LoadInteger(hashtable019,h,1)+1
  local integer herocount=0
  local integer curbonuses=0
  local integer totalbonuses=0
  local integer limit=LoadInteger(hashtable019,h,-1)
  local unit array targets
  loop
    if isSc then
      set pid=GetPlayerId(Scourges[i])
    else
      set pid=GetPlayerId(Sentinels[i])
    endif
    set u=udg_Hero[pid]
    if u!=null then
      set hu=GetHandleId(u)
      if IsDead(u)==false and (DistanceBetweenXY(GetUnitX(caster),GetUnitY(caster),GetUnitX(u),GetUnitY(u))<925 or LoadBoolean(MHT,hu,'A32G'+1)) then//if hero is alive and in range or was in aoe when casted (key)
        if counter==1 then//on cast
          call SaveBoolean(MHT,hu,'A32G'+1,true)//save flag that unit was there on cast
        endif
        set herocount=herocount+1
        set targets[herocount]=u
      elseif IsDead(u)==false and DistanceBetweenXY(GetUnitX(caster),GetUnitY(caster),GetUnitX(u),GetUnitY(u))<925==false then
        call Kodo_DrumsProvideBonuses(u,0,0)
        call SaveInteger(MHT,GetHandleId(u),'A32G'+1,0)
        call SaveBoolean(MHT,hu,'A32G'+1,false)
      endif
    endif
    set i=i+1
    exitwhen i>5
  endloop
  set totalbonuses=(4+2*lvl)*herocount
  set i=1
  loop
    set u=targets[i]
    set hu=GetHandleId(u)
    if counter<limit and (DistanceBetweenXY(GetUnitX(caster),GetUnitY(caster),GetUnitX(u),GetUnitY(u))<925 or LoadBoolean(MHT,hu,'A32G'+1)) then//if hero is alive and in range or was in aoe when casted (key)
      set curbonuses=LoadInteger(MHT,GetHandleId(u),'A32G'+1)
      if curbonuses!=totalbonuses then
        call Kodo_DrumsProvideBonuses(u,0,0)
        if u!=caster then
          call Kodo_DrumsProvideBonuses(u,R2I(totalbonuses/2),totalbonuses)
          //call echo(I2S(R2I(totalbonuses/2)))
        else
          call Kodo_DrumsProvideBonuses(u,totalbonuses,totalbonuses)
        endif
        call SaveInteger(MHT,GetHandleId(u),'A32G'+1,totalbonuses)
      endif
    else
      call Kodo_DrumsProvideBonuses(u,0,0)
      call SaveInteger(MHT,GetHandleId(u),'A32G'+1,0)
      call SaveBoolean(MHT,hu,'A32G'+1,false)
    endif
    set i=i+1
    exitwhen i>herocount
  endloop
  
  
  call SaveInteger(hashtable019,h,1,counter)
  if counter==limit then
    call FlushChildHashtable(hashtable019,h)
    call PauseTimer(t)
    call DestroyTimer(t)
    
    
  endif
  set caster=null
  set t=null
  set u=null
  set targets[1]=null
  set targets[2]=null
  set targets[3]=null
  set targets[4]=null
  set targets[5]=null
endfunction

function Kodo_DrumWars takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer lvl=GetUnitAbilityLevel(u,GetSpellAbilityId())
  local timer t=CreateTimer()
  call TimerStart(t,0.25,true,function Kodo_DrumsDuration)
  call SaveInteger(hashtable019,GetHandleId(t),-1,R2I(8/0.25)+1)
  call SaveUnitHandle(hashtable019,GetHandleId(t),0,u)
  call SaveInteger(hashtable019,GetHandleId(t),0,lvl)
  call SaveBoolean(hashtable019,GetHandleId(t),0,IsScourge(GetOwningPlayer(u)))
  set t=null
  set u=null
endfunction

function Queen_VitalStrikeActs takes nothing returns nothing
  local unit caster=tt_unit1
  local unit target=tt_unit2
  local real damage=100+60*GetUnitAbilityLevel(caster,'A32Y')
  if GetUnitState(target,UNIT_STATE_LIFE) < GetUnitState(target,UNIT_STATE_MAX_LIFE)/2 then
    set damage=damage/2
  endif
  call DamageTarget(caster,target,1,damage)
  set caster=null
  set target=null
endfunction

function Queen_VitalStrike takes nothing returns nothing
  local trigger t
  if IsBlocked(GetSpellTargetUnit())==false then
    set t=AddProjectile(GetTriggerUnit(),GetSpellTargetUnit(),'hQVS',"Queen_VitalStrikeActs",1000,true)
    set t=null
  endif
endfunction

function Queen_ArrowShowerFilter takes nothing returns boolean
  if IsDead(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(Queen_TempUnit)) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsMagicImmune(GetFilterUnit())==false then
    if IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) then
      set Queen_TempInt2=Queen_TempInt2+1
    endif
    call DamageTarget(Queen_TempUnit,GetFilterUnit(),1,Queen_TempInt)
  endif
  return false
endfunction

function Queen_ArrowShowerForGroup takes nothing returns nothing
  local unit dummy=CreateUnit(GetOwningPlayer(GetEnumUnit()),'e00E',GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
  call UnitAddAbility(dummy,'A331')
  call DamageTarget(Queen_TempUnit,GetEnumUnit(),1,Queen_TempInt*40+40)
  if Queen_TempInt2>1 then
    call SetUnitAbilityLevel(dummy,'A331',2)
  endif
  call IssueTargetOrder(dummy,"thunderbolt",GetEnumUnit())
  set dummy=null
endfunction

function Queen_ArrowShowerImpact takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit caster=LoadUnitHandle(hashtable019,h,0)
  local integer lvl=LoadInteger(hashtable019,h,0)
  local group g=GetAvailableGroup()
  local integer i=0
  set Queen_TempInt=lvl
  set Queen_TempUnit=caster
  set Queen_TempInt2=0
  call GroupEnumUnitsInRange(g,LoadReal(hashtable019,h,1),LoadReal(hashtable019,h,2),300+50*lvl,Condition(function Queen_ArrowShowerFilter))
  call ForGroup(g,function Queen_ArrowShowerForGroup)
  call KillGroup(g)
  set g=null
  call PauseTimer(t)
  call DestroyTimer(t)
  call FlushChildHashtable(hashtable019,h)
  set caster=null
  set t=null
endfunction

function Queen_ArrowShower takes nothing returns nothing
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call SaveInteger(hashtable019,h,0,GetUnitAbilityLevel(GetTriggerUnit(),'A32Z'))
  call SaveUnitHandle(hashtable019,h,0,GetTriggerUnit())
  call SaveReal(hashtable019,h,1,GetSpellTargetX())
  call SaveReal(hashtable019,h,2,GetSpellTargetY())
  call TimerStart(t,0.4,false,function Queen_ArrowShowerImpact)
  set t=null
endfunction

function Queen_MortalWoundsDOT takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit queen=LoadUnitHandle(hashtable019,h,0)
  local unit victim=LoadUnitHandle(hashtable019,h,1)
  local real dmg=LoadReal(hashtable019,h,0)
  local trigger tt=LoadTriggerHandle(hashtable019,h,2)
  local boolean b=IsTriggerEnabled(tt)
  local integer c=LoadInteger(hashtable019,h,0)+1
  if queen==null or victim==null or dmg==0. or b==false or c>3 then
    call PauseTimer(t)
    call DestroyTimer(t)
    call FlushChildHashtable(hashtable019,h)
  else
    if b then
      call DisableTrigger(tt)
    endif
    call DamageTarget(queen,victim,1,dmg)
    call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodRifleman.mdl",victim,"origin"))
    if b then
      call EnableTrigger(tt)
    endif
    call SaveInteger(hashtable019,h,0,c)
  endif
  set t=null
  set queen=null
  set victim=null
  set tt=null
endfunction

function Queen_MortalWoundsTargetDamaged takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit victim=GetTriggerUnit()
  local unit queen=LoadUnitHandle(hashtable019,h,0)
  local unit eds
  local real chance
  local integer lvl
  local real dmg
  local real mltp
  local timer tt
  local integer ht
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    if IsUnitType(victim,UNIT_TYPE_HERO)==false then
      call FlushChildHashtable(hashtable019,h)
      call CleanTrigger(t)
    endif
    
  else
    set eds=GetEventDamageSource()
    if eds==queen or (GetOwningPlayer(eds)==GetOwningPlayer(queen) and GetUnitAbilityLevel(eds,'Aloc')+GetUnitAbilityLevel(eds,'A04R')>0) then
      set lvl=GetUnitAbilityLevel(udg_Hero[GetPlayerId(GetOwningPlayer(eds))],'A332')
      if lvl==0 then
        call FlushChildHashtable(hashtable019,h)
        call CleanTrigger(t)
      elseif IsRealDamage and IsDamageReal(GetEventDamage()) then
        set chance=12
        if PRD_Get(queen,'A332',chance) then
          set dmg=GetEventDamage()
          set mltp=.05*lvl
          set tt=CreateTimer()
          set ht=GetHandleId(tt)
          call TimerStart(tt,1,true,function Queen_MortalWoundsDOT)
          call SaveUnitHandle(hashtable019,ht,0,queen)
          call SaveUnitHandle(hashtable019,ht,1,victim)
          call SaveReal(hashtable019,ht,0,dmg*mltp)
          call SaveTriggerHandle(hashtable019,ht,2,t)
          
          set tt=null
        endif
        
      endif
    endif
  endif
  set t=null
  set victim=null
  set queen=null
  set eds=null
endfunction

function Queen_MortalWoundsStart takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit target=GetTriggerUnit()
  local unit queen=LoadUnitHandle(hashtable019,h,0)
  local unit eds
  local trigger tt
  local integer ht
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,h)
    call RemoveSavedHandle(MHT,GetHandleId(target),'A332')
    call CleanTrigger(t)
  else
    set eds=GetEventDamageSource()
    if eds==queen or (GetOwningPlayer(eds)==GetOwningPlayer(queen) and GetUnitAbilityLevel(eds,'Aloc')+GetUnitAbilityLevel(eds,'A04R')>0) then
      set tt=CreateTrigger()
      set ht=GetHandleId(tt)
      call TriggerRegisterUnitEvent(tt,target,EVENT_UNIT_DAMAGED)
      call TriggerRegisterUnitEvent(tt,target,EVENT_UNIT_DEATH)
      call TriggerAddCondition(tt,Condition(function Queen_MortalWoundsTargetDamaged))
      call SaveUnitHandle(hashtable019,ht,0,queen)
      set tt=null
      call FlushChildHashtable(hashtable019,h)
      call RemoveSavedHandle(MHT,GetHandleId(target),'A332')
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set target=null
  set queen=null
endfunction

function Queen_MortalWoundsDetect takes nothing returns nothing
  local unit attacked=GetTriggerUnit()
  local unit attacker=GetAttacker()
  local trigger t
  local integer h
  if GetUnitAbilityLevel(attacker,'A332')>0 and IsUnitType(attacked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(attacked,UNIT_TYPE_MECHANICAL)==false and GetUnitAbilityLevel(attacked,'A04R')==0 and IsUnitEnemy(attacked,GetOwningPlayer(attacker)) and LoadTriggerHandle(MHT,GetHandleId(attacked),'A332')==null then
    set t=CreateTrigger()
    call TriggerRegisterUnitEvent(t,attacked,EVENT_UNIT_DAMAGED)
    call TriggerRegisterUnitEvent(t,attacked,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function Queen_MortalWoundsStart))
    set h=GetHandleId(t)
    call SaveUnitHandle(hashtable019,h,0,attacker)
    set t=null
  endif
  set attacker=null
  set attacked=null
endfunction

function Queen_MortalWoundsInit takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function Queen_MortalWoundsDetect))
  set t=null
endfunction

function Queen_SnatchFilter takes nothing returns boolean
  local unit u=GetFilterUnit()
  if IsUnitType(u,UNIT_TYPE_HERO)==true and IsDead(u)==false and IsUnitEnemy(u,GetOwningPlayer(Queen_TempUnit)) and GetUnitAbilityLevel(u,'Avul')==0 and GetUnitAbilityLevel(u,'A04R')==0 then
    call DamageTarget(Queen_TempUnit,u,1,Queen_TempInt*50+50)
    if GetWidgetLife(u)<Queen_SnatchedHP then
      set Queen_SnatchedHP=GetWidgetLife(u)
      set Queen_SnatchedUnit=u
    endif
  endif
  set u=null
  return false
endfunction
//
//function Queen_SnatchDuration takes nothing returns boolean
//	local trigger t=GetTriggeringTrigger()
//	local integer h=GetHandleId(t)
//	local integer Count=(LoadInteger(HY,(h),(34)))
//	local unit Source=(LoadUnitHandle(HY,(h),(2)))
//	local real SourceX=(LoadReal(HY,(h),(189)))
//	local real SourceY=(LoadReal(HY,(h),(190)))
//	local real TargetX=(LoadReal(HY,(h),(47)))
//	local real TargetY=(LoadReal(HY,(h),(48)))
//	local real a=(LoadReal(HY,(h),(13)))
//	local real dist=LoadReal(HY,h,0)
//	local real angle=(1-I2R(Count)*0.02)*bj_PI
//	local real dx=dist/2*Cos(angle)
//	local real dy=LoadReal(HY,h,3)/2*Sin(angle)
//	local real x=SafeX50(TargetX+dx*Cos(a)-dy*Sin(a))
//	local real y=SafeY50(TargetY+dx*Sin(a)+dy*Cos(a))
//	local group g
//	local boolean b=LoadBoolean(HY,h,0)
//	local integer Level=GetUnitAbilityLevel(Source,'A1RJ')
//	if GetTriggerEventId()==EVENT_UNIT_DEATH or Count>100 or L88(Source)then
//		call KillTrees(x,y,300)
//		call SetUnitPathing(Source,true)
//		call FlushChildHashtable(HY,(h))
//		call CleanTrigger(t)
//	else
//		if ModuloInteger(Count,10)==0 then
//			call KillTrees(x,y,200)
//		endif
//		call SaveInteger(HY,(h),(34),(Count+1))
//		if IsUnitType(Source,UNIT_TYPE_HERO)then
//			call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
//		endif
//		call SetUnitX(Source,x)
//		call SetUnitY(Source,y)
//		call SetUnitFacing(Source,(a+angle-bj_PI/ 2)*bj_RADTODEG)
//		if DistanceBetweenXY(x,y,TargetX,TargetY)<150 and b==false then
//			call SaveBoolean(HY,h,0,true)
//			set g=GetAvailableGroup()
//			set Queen_TempUnit=Source
//			set Queen_TempInt=GetUnitAbilityLevel(Source,'A1RJ')
//			set Queen_SnatchedUnit=null
//			set Queen_SnatchedHP=999999
//			call GroupEnumUnitsInRange(g,x,y,350,Condition(function Queen_SnatchFilter))
//			if Queen_SnatchedUnit!=null then
//				call SaveBoolean(HY,h,1,true)
//				call SaveUnitHandle(HY,h,1,Queen_SnatchedUnit)
//			endif
//			call KillGroup(g)
//		endif
//		if LoadBoolean(HY,h,1) then
//			call SetUnitX(LoadUnitHandle(HY,h,1),x)
//			call SetUnitY(LoadUnitHandle(HY,h,1),y)
//		endif
//	endif
//	set t=null
//	set Source=null
//	set g=null
//	return false
//endfunction
//
//function Queen_Snatch takes nothing returns nothing
//	local trigger t=CreateTrigger()
//	local integer h=GetHandleId(t)
//	local unit Source=GetTriggerUnit()
//	local real SourceX=GetUnitX(Source)
//	local real SourceY=GetUnitY(Source)
//	local real a=AngleBetweenXY(SourceX,SourceY,GetSpellTargetX(),GetSpellTargetY())*bj_DEGTORAD
//	local real dist=DistanceBetweenXY(SourceX,SourceY,GetSpellTargetX(),GetSpellTargetY())
//	local real TargetX=SafeX50(SourceX+dist/ 2*Cos(a))
//	local real TargetY=SafeY50(SourceY+dist/ 2*Sin(a))
//	
//	call TriggerRegisterTimerEvent(t,.02,true)
//	call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
//	call TriggerAddCondition(t,Condition(function Queen_SnatchDuration))
//	call SaveUnitHandle(HY,(h),(2),(Source))
//	call SaveReal(HY,(h),(189),((SourceX)*1.))
//	call SaveReal(HY,(h),(190),((SourceY)*1.))
//	call SaveReal(HY,(h),(47),((TargetX)*1.))
//	call SaveReal(HY,(h),(48),((TargetY)*1.))
//	call SaveReal(HY,(h),(13),((a)*1.))
//	call SaveReal(HY,h,3,dist/2)
//	call SaveReal(HY,h,4,dist/1200)
//
//	call SaveReal(HY,h,0,dist)
//	call SaveBoolean(HY,h,0,false)
//	call SetUnitPathing(Source,false)
//	set t=null
//	set Source=null
//endfunction


function Queen_SnatchDuration takes nothing returns nothing
  local integer h=GetHandleId(GetExpiredTimer())
  local unit caster=(LoadUnitHandle(hashtable019,(h),(290)))
  local unit Hero=(LoadUnitHandle(hashtable019,(h),(14)))
  local real Ax=(LoadReal(hashtable019,(h),(284)))
  local real Ay=(LoadReal(hashtable019,(h),(285)))
  local real Cx=(LoadReal(hashtable019,(h),(286)))
  local real Cy=(LoadReal(hashtable019,(h),(287)))
  local real Bx=(LoadReal(hashtable019,(h),(288)))
  local real By=(LoadReal(hashtable019,(h),(289)))
  local real a=(LoadReal(hashtable019,(h),(137)))
  local real b=1-a
  local boolean integer494=(LoadBoolean(hashtable019,(h),(291)))
  local real MVE=RMaxBJ(DistanceBetweenXY(Ax,Ay,Cx,Cy)/ 1300,.4)
  local boolean bb=LoadBoolean(hashtable019,h,0)
  local group g
  local real x=SafeX50(Ax*a*a+Bx*2*a*b+Cx*b*b)
  local real y=SafeY50(Ay*a*a+By*2*a*b+Cy*b*b)
  call SetUnitX(caster,x)
  call SetUnitY(caster,y)
  if DistanceBetweenXY(x,y,Cx,Cy)<150 and bb==false then
    call SaveBoolean(hashtable019,h,0,true)
    set g=GetAvailableGroup()
    set Queen_TempUnit=caster
    set Queen_TempInt=GetUnitAbilityLevel(caster,'A1RJ')
    set Queen_SnatchedUnit=null
    set Queen_SnatchedHP=999999
    call GroupEnumUnitsInRange(g,x,y,350,Condition(function Queen_SnatchFilter))
    if Queen_SnatchedUnit!=null then
      call SaveBoolean(hashtable019,h,1,true)
      call SaveUnitHandle(hashtable019,h,1,Queen_SnatchedUnit)
    endif
    call KillGroup(g)
    set g=null
  endif
  if LoadBoolean(hashtable019,h,1)then
    call SetUnitPosition(LoadUnitHandle(hashtable019,h,1),x,y)
  endif
  if(integer494)then
    call SaveReal(hashtable019,(h),(137),((a-.02/ MVE)*1.))
  else
    call SaveReal(hashtable019,(h),(137),((a+.02/ MVE)*1.))
  endif
  if(a<0 and integer494)then
    call SaveBoolean(hashtable019,(h),(291),(false))
    call SaveReal(hashtable019,(h),(288),((Ax+300*Cos(Atan2(Cy-Ay,Cx-Ax)+(LoadReal(hashtable019,(h),(292)))))*1.))
    call SaveReal(hashtable019,(h),(289),((Ay+300*Sin(Atan2(Cy-Ay,Cx-Ax)+(LoadReal(hashtable019,(h),(292)))))*1.))
  endif
  if(a>1 and integer494==false)then
    call PauseTimer(GetExpiredTimer())
    call FlushChildHashtable(hashtable019,(h))
    call DestroyTimer(GetExpiredTimer())
  endif
  set caster=null
  set Hero=null
endfunction

function Queen_Snatch takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local real Ax=GetUnitX(caster)
  local real Ay=GetUnitY(caster)
  local real Cx=GetSpellTargetX()
  local real Cy=GetSpellTargetY()
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call SaveUnitHandle(hashtable019,h,(14),(caster))
  call SaveUnitHandle(hashtable019,h,(290),(caster))
  call SaveReal(hashtable019,h,(284),((Ax)*1.))
  call SaveReal(hashtable019,h,(285),((Ay)*1.))
  call SaveReal(hashtable019,h,(286),((Cx)*1.))
  call SaveReal(hashtable019,h,(287),((Cy)*1.))
  call SaveReal(hashtable019,h,(288),((Ax+300*Cos(Atan2(Cy-Ay,Cx-Ax)-45))*1.))
  call SaveReal(hashtable019,h,(289),((Ay+300*Sin(Atan2(Cy-Ay,Cx-Ax)-45))*1.))
  call SaveReal(hashtable019,h,(137),((1)*1.))
  call SaveReal(hashtable019,h,(292),((45)*1.))
  call SaveBoolean(hashtable019,h,(291),(true))
  call TimerStart(t,.025,true,function Queen_SnatchDuration)
  set caster=null
  set t=null
endfunction



function Torrent_Damage takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function JIE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=GetTriggerEvalCount(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real JJE
  local unit Caster
  set JJE=.6*(Count-25)*(Count-25)
  if Count<51 and GetTriggerEventId()!=EVENT_UNIT_DEATH then
    if ModuloInteger(Count,5)==0 then
      call DamageTarget(Source,Target,1,3+3*Level)
    endif
    if IsBuggyFlying(Target)==false then
      call SetUnitFlyHeight(Target,500-JJE,0)
    endif
  else
    set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
    call UnitAddAbility2(Caster,'A11L')
    call SetUnitAbilityLevel(Caster,'A11L',Level)
    call IssueTargetOrderById(Caster,852075,Target)
    if IsBuggyFlying(Target)==false then
      call SetUnitFlyHeight(Target,GetUnitDefaultFlyHeight(Target),0)
    endif
    if GameEnded==false then
      call PauseUnit(Target,false)
    endif
    call SetUnitPathing(Target,true)
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  set Caster=null
  return false
endfunction

function JKE takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=tt_unit1
  local unit Target=GetEnumUnit()
  local integer Level=tt_int1
  call PauseUnit(Target,true)
  call SetUnitPathing(Target,false)
  if IsBuggyFlying(Target)==false then
    call UnitAddAbility2(Target,'Amrf')
    call UnitRemoveAbility(Target,'Amrf')
  endif
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function JIE))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call DamageTarget(Source,Target,1,30+30*Level)
  set t=null
  set Source=null
  set Target=null
endfunction

function JME takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local group g=GetAvailableGroup()
  local ubersplat Splat=CreateUbersplat(x,y,"THNN",255,255,255,255,false,false)
  call SetUbersplatRenderAlways(Splat,true)
  call TimedReveal(GetOwningPlayer(Hero),4,x,y,400)
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(177))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(178))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(179))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(180))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",x,y))
  call DestroyEffect(AddSpecialEffect("effects\\TidalErruption.mdx",x,y))
  set tt_unit1=Hero
  set tt_int1=Level
  call GroupEnumUnitsInRange(g,x,y,240,Condition(function NonImmuneEnemyFilter))
  call ForGroup(g,function JKE)
  call KillGroup(g)
  set t=null
  set Hero=null
  set g=null
  set Splat=null
  return false
endfunction

function Admiral_Torrent takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Hero,'A136')
  local string s=""
  local real a
  if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Hero)) or IsObserver(GetLocalPlayer())then
    set s="Objects\\Spawnmodels\\Other\\IllidanFootprint\\IllidanWaterSpawnFootPrint.mdl"
  endif
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  set a=0
  call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffect(s,x+40*Cos(a/ 6*360*bj_DEGTORAD),y+40*Sin(a/ 6*360*bj_DEGTORAD))))
  set a=1
  call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffect(s,x+40*Cos(a/ 6*360*bj_DEGTORAD),y+40*Sin(a/ 6*360*bj_DEGTORAD))))
  set a=2
  call SaveEffectHandle(hashtable019,(Cache),(177),(AddSpecialEffect(s,x+40*Cos(a/ 6*360*bj_DEGTORAD),y+40*Sin(a/ 6*360*bj_DEGTORAD))))
  set a=3
  call SaveEffectHandle(hashtable019,(Cache),(178),(AddSpecialEffect(s,x+40*Cos(a/ 6*360*bj_DEGTORAD),y+40*Sin(a/ 6*360*bj_DEGTORAD))))
  set a=4
  call SaveEffectHandle(hashtable019,(Cache),(179),(AddSpecialEffect(s,x+40*Cos(a/ 6*360*bj_DEGTORAD),y+40*Sin(a/ 6*360*bj_DEGTORAD))))
  set a=5
  call SaveEffectHandle(hashtable019,(Cache),(180),(AddSpecialEffect(s,x+40*Cos(a/ 6*360*bj_DEGTORAD),y+40*Sin(a/ 6*360*bj_DEGTORAD))))
  call TriggerRegisterTimerEvent(t,1.6,false)
  call TriggerAddCondition(t,Condition(function JME))
  set Hero=null
  set t=null
endfunction


function Kunka_Tidebringer_Quelling takes unit u, integer id returns nothing
  local player p
  local integer d
  local integer loopA = 0
  local item i = UnitItemInSlot(u,loopA)
  
  loop
    exitwhen GetItemTypeId(i)==id
    set loopA = loopA + 1
    set i = UnitItemInSlot(u,loopA)
  endloop
  
  set d = GetItemUserData(i)
  set p = GetItemPlayer(i)
  
  call DisableTrigger(t_manipulateitem)
  
  call RemoveItem(i)
  
  call UnitAddItemToSlotById(u,id,loopA)
  set i = UnitItemInSlot(u,loopA)
  call SetItemPlayer(i,p,true)
  call SetItemUserData(i,d)
  
  call EnableTrigger(t_manipulateitem)
  
  set i = null
  set p=null
endfunction

function Kunka_Tidebringer_Restart_IfDead takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(MHT,h,0)
  local integer level=LoadInteger(MHT,h,1)
  if IsDead(u)==false then
    call LoDStat_Add(u,15*level,"damage")
    call UnitAddAbility2(u,'A147')
    
    call SetUnitAbilityLevel(u,'A146',level)
    call UnitMakeAbilityPermanent(u,true,'A146')
    set level = GetHandleId(u)
    call SaveBoolean(MHT,level,'A13T',true)
    call SaveEffectHandle(MHT,level,StringHash("tidebringer_effect"),AddSpecialEffectTarget("effects\\WaterHands.mdx",u,GetProperAttachPoint_Weapon(u)))
    call CleanTrigger(t)
    call FlushChildHashtable(MHT,h)
  endif
  set t=null
  set u=null
  return false
endfunction

function Kunka_Tidebringer_Restart takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local trigger tt
  local unit u = LoadUnitHandle(MHT,GetHandleId(t),0)
  local integer level = GetUnitAbilityLevel(u,'A522') //A13T
  
  //call BJDebugMsg("readding bonuses: "+I2S(level)+"  "+I2S(15*level))
  
  call SaveBoolean(MHT,GetHandleId(u),'A13T',true) // reset cooldown
  
  if UA8(u) then//[lich] if unit dead.
    set tt=CreateTrigger()
    call TriggerRegisterTimerEvent(tt,1,true)
    call TriggerAddCondition(tt,Condition(function Kunka_Tidebringer_Restart_IfDead))
    call SaveUnitHandle(MHT,GetHandleId(tt),0,u)
    call SaveInteger(MHT,GetHandleId(tt),1,level)
    set tt=null
  else
    call LoDStat_Add(u,15*level,"damage")
    call UnitAddAbility2(u,'A147')
    call SetUnitAbilityLevel(u,'A146',level)
    call UnitMakeAbilityPermanent(u,true,'A146')
    set level = GetHandleId(u)
    call SaveBoolean(MHT,level,'A13T',true)
    call SaveEffectHandle(MHT,level,StringHash("tidebringer_effect"),AddSpecialEffectTarget("effects\\WaterHands.mdx",u,GetProperAttachPoint_Weapon(u)))
  endif
  
  call Timer_End(t)
  set t = null
  set u = null
  
endfunction

function Kunka_Tidebringer_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if IsUnitEnemy(t,group_temp_player) and GetUnitAbilityLevel(t,'A04R')==0 and  IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and t!=group_temp_unit[1]then
    call UnitDamageTarget(group_temp_unit[0],t,group_temp_real[0],false,false,ATTACK_TYPE_HERO,DAMAGE_TYPE_ENHANCED,WEAPON_TYPE_WHOKNOWS)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WaterElementalMissile\\WaterElementalMissile.mdl",t,"chest"))
  endif
  
  set t = null
  return false
endfunction

function Kunka_Tidebringer_Range_End takes unit u, unit d, real damage, integer info returns nothing
  local timer t = Timer_Get()
  local integer level = GetUnitAbilityLevel(u,'A522') //A13T
  local real x1 = GetWidgetX(d)
  local real y1 = GetWidgetY(d)
  //local real x2 = x1 - GetWidgetX(u)
  //local real y2 = y1 - GetWidgetY(u)
  //local real angle = Atan2(y1 - GetWidgetY(u),x1 - GetWidgetX(u))
  local real range = 525 + 100*(level/4)
  set group_temp_unit[0] = u
  set group_temp_unit[1] = d
  if Mode_BO then
    set group_temp_real[0] = damage
  else
    set group_temp_real[0] = damage*0.6
  endif
  set group_temp_player = GetOwningPlayer(u)
  //call GroupEnumUnitsInRange(temp_group,x1 + range*Cos(angle),y1 + range*Sin(angle),range,Condition(function Kunka_Tidebringer_Targets)) //cleave aoe
  call GroupEnumUnitsInRange(temp_group,x1,y1,range,Condition(function Kunka_Tidebringer_Targets)) //splash aoe
  if LoadBoolean(MHT,GetHandleId(group_temp_player),4)then //check to see if passive cooldowns are enabled for the player
    call Passive_Cooldown(u,'A13T',level)
  endif
  call LoDStat_Sub(u,level*15,"damage")
  call UnitRemoveAbility(u,'A147') //remove cleave (incase the attack transforms into a melee unit)
  call SaveUnitHandle(MHT,GetHandleId(t),0,u)
  call TimerStart(t,16 - 3*level,false,function Kunka_Tidebringer_Restart)
  set level = StringHash("tidebringer_effect")
  call DestroyEffect(LoadEffectHandle(MHT,info,level))
  call RemoveSavedHandle(MHT,info,level)
  set t = null
endfunction

function Kunka_Tidebringer_Melee_End takes unit u, integer info returns nothing
  local timer t = Timer_Get()
  local integer level = GetUnitAbilityLevel(u,'A522') //A13T
  call SaveUnitHandle(MHT,GetHandleId(t),0,u)
  call TimerStart(t,16 - 3*level,false,function Kunka_Tidebringer_Restart)
  if LoadBoolean(MHT,GetHandleId(GetOwningPlayer(u)),4)then //check to see if passive cooldowns are enabled for the player
    call Passive_Cooldown(u,'A13T',level)
  endif
  call LoDStat_Sub(u,level*15,"damage")
  call UnitRemoveAbility(u,'A147') //remove cleave
  set level = StringHash("tidebringer_effect")
  call DestroyEffect(LoadEffectHandle(MHT,info,level))
  call RemoveSavedHandle(MHT,info,level)
  set t = null
endfunction

function Kunka_Tidebringer_Effect takes unit u, unit t, real d returns nothing
  local integer info = GetHandleId(u)
  local integer load = StringHash("tidebringer_delay")
  if LoadBoolean(MHT,info,load)then
    //call BJDebugMsg("u: "+GetUnitName(u)+"   t: "+GetUnitName(t))
    call SaveBoolean(MHT,info,load,false)   // should the next damage proc
    call SaveBoolean(MHT,info,'A13T',false) // is tidebringer ready
    set load = StringHash("tidebringer_timer")
    call Timer_End(LoadTimerHandle(MHT,info,load))
    call RemoveSavedHandle(MHT,info,load)
    if IsUnitType(u,UNIT_TYPE_RANGED_ATTACKER)==true then
      call Kunka_Tidebringer_Range_End(u,t,d,info)
    else
      call Kunka_Tidebringer_Melee_End(u,info)
    endif
    if EM9(u,'I0HR')then
      call Kunka_Tidebringer_Quelling(u,'I0HR')
    elseif EM9(u,'I0HP') then
      call Kunka_Tidebringer_Quelling(u,'I0HP')
    endif
  endif
endfunction

function Kunka_Tidebringer_Reset takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer load = LoadInteger(MHT,GetHandleId(t),0)
  call RemoveSavedHandle(MHT,load,StringHash("tidebringer_timer"))
  call SaveBoolean(MHT,load,StringHash("tidebringer_delay"),false)
  call Timer_End(GetExpiredTimer())
  set t = null
endfunction

function Kunka_Tidebringer_Start takes unit u, unit d, integer load, integer level returns nothing
  local timer t = LoadTimerHandle(MHT,load,StringHash("tidebringer_timer"))
  local integer info = GetHandleId(d)
  call SaveBoolean(MHT,load,StringHash("tidebringer_delay"),true)
  if LoadBoolean(MHT,info,1)==false then
    call SaveBoolean(MHT,info,1,true)
    call TriggerRegisterUnitEvent(GAME_TRIGGER,d,EVENT_UNIT_DAMAGED)
  endif
  if t==null then
    set t = Timer_Get()
    //set info = GetHandleId(t)
    call SaveTimerHandle(MHT,load,StringHash("tidebringer_timer"),t)
  endif
  call SaveInteger(MHT,GetHandleId(t),0,load)
  if EM9(u,'I0HR') or EM9(u,'I0HP') then // check for quelling blade
    call UnitRemoveAbility(u,'A1AB')   // melee
    call UnitRemoveAbility(u,'A1AD')   // range
  endif
  set t = null
endfunction

function Kunka_Tidebringer_Condition takes unit u, unit t returns nothing
  local boolean b
  local integer info = GetHandleId(u)
  //local integer level = GetUnitAbilityLevel(u,'A13T')
  if LoadBoolean(MHT,info,'A13T')and IsUnitEnemy(u,GetOwningPlayer(t)) and (IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==true or IsUnitIllusion(t)==false) then
    call Kunka_Tidebringer_Start(u,t,info,GetUnitAbilityLevel(u,'A13T'))
  endif
endfunction

function Kunka_Tidebringer_Learn takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local integer info = GetHandleId(u)
  if LoadBoolean(MHT,info,'A13T')then //not on cooldown
    call LoDStat_Add(u,15,"damage")
  elseif GetUnitAbilityLevel(u,'A522')==1then //first time learning
    call LoDStat_Add(u,15,"damage")
    call SaveBoolean(MHT,info,'A13T',true)
    //call BJDebugMsg("first time learned")
    call SaveEffectHandle(MHT,info,StringHash("tidebringer_effect"),AddSpecialEffectTarget("effects\\WaterHands.mdx",u,GetProperAttachPoint_Weapon(u)))
    if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==true then //adds the cleave ability to melee units
      call UnitAddAbility2(u,'A147')
      call UnitMakeAbilityPermanent(u,true,'A146')
      call SetUnitAbilityLevel(u,'A146',GetUnitAbilityLevel(u,'A13T'))
    endif
  endif
  set u = null
endfunction

function Backstab_Fixed takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=LoadUnitHandle(hashtable019,h,0)
  local unit target=LoadUnitHandle(hashtable019,h,1)
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,h)
    call DestroyTrigger(t)
    call RemoveSavedHandle(MHT,GetHandleId(caster),'BACK')
  elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==caster and IsFakeDamage==false then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",target,"chest"))
      //call LoDStat_Sub(caster,LoadInteger(MHT,GetHandleId(caster),'BACK'),"damage")
      call DamageTarget(CreateUnit(GetOwningPlayer(caster),'e00E',GetUnitX(caster),GetUnitY(caster),0),target,2,LoadInteger(MHT,GetHandleId(caster),'BACK'))
      call SaveInteger(MHT,GetHandleId(caster),'BACK',0)
      call RemoveSavedHandle(MHT,GetHandleId(caster),'BACK')
      call FlushChildHashtable(hashtable019,h)
      call DestroyTrigger(t)
    endif
  else
    call FlushChildHashtable(hashtable019,h)
    call DestroyTrigger(t)
    call RemoveSavedHandle(MHT,GetHandleId(caster),'BACK')
  endif
  
  
  set t=null
  set caster=null
  set target=null
endfunction

function Rikki_BackStab_Condition takes unit u, unit t returns nothing
  local integer level = (GetUnitAbilityLevel(u,'A0DZ')+GetUnitAbilityLevel(u,'QP07'))
  local real d
  local unit dummy
  local real multiplier
  local integer prevdmg
  local integer curdmg
  local trigger tt
  local integer h
  local integer i
  local integer ms
  if level>0 then
    
    set d=RAbsBJ(GetUnitFacing(u)-GetUnitFacing(t))
    if d>180 then
      set d=360-d
    endif
    if LoadInteger(MHT,GetHandleId(u),'BACK')>0 then
      call LoDStat_Sub(u,LoadInteger(MHT,GetHandleId(u),'BACK'),"damage")
      call SaveInteger(MHT,GetHandleId(u),'BACK',0)
    endif
    if LoadTriggerHandle(MHT,GetHandleId(u),'BACK')!=null then
      call FlushChildHashtable(hashtable019,GetHandleId(LoadTriggerHandle(MHT,GetHandleId(u),'BACK')))
      call DestroyTrigger(LoadTriggerHandle(MHT,GetHandleId(u),'BACK'))
    endif
    if level>0 and IsUnitEnemy(u,GetOwningPlayer(t)) and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and IsUnitIllusion(u)==false and d<=105 then
      set multiplier=0.25*level
      if(Mode_EB and GetUnitAbilityLevel(u,'ANic')>0) then
        set multiplier=0.4+0.1*level
      endif
      set ms=GetUnitPrimaryAttribute(u)
      if ms==1 then
        set i=GetHeroInt(u,true)
      elseif ms==2 then
        set i=GetHeroAgi(u,true)
      elseif ms==3 then
        set i=GetHeroStr(u,true)
      endif
      set curdmg=R2I(i*(multiplier))
      //call LoDStat_Add(u,curdmg,"damage")
      call SaveInteger(MHT,GetHandleId(u),'BACK',curdmg)
      set tt=CreateTrigger()
      set h=GetHandleId(tt)
      call SaveUnitHandle(hashtable019,h,0,u)
      call SaveUnitHandle(hashtable019,h,1,t)
      call TriggerRegisterTimerEvent(tt,5,false)
      call TriggerRegisterUnitEvent(tt,u,EVENT_UNIT_DEATH)
      call TriggerRegisterUnitEvent(tt,t,EVENT_UNIT_DAMAGED)
      call TriggerAddCondition(tt,Condition(function Backstab_Fixed))
      call SaveTriggerHandle(MHT,GetHandleId(u),'BACK',tt)
      set tt=null
      
      
      
      
      
      
      //set dummy=CreateUnit(GetOwningPlayer(u),'e00E',GetUnitX(u),GetUnitY(u),0)
      //call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",t,"chest"))
      //call DamageTarget(dummy,t,2,curdmg)//damage by dummy to prevent fury swipes counter increase
      //set dummy=null
    endif
  endif
endfunction


function Tree_Invi_Condition_Self takes unit u, unit t returns nothing
  call SaveBoolean(MHT,GetHandleId(u),StringHash("TreeInvisibility"),false)
endfunction


function Admiral_XMark_Return takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8=LoadInteger(hashtable019,Cache,30)
  local unit Target=UnitAsInteger_Load(XK8)
  local image i=LoadImageHandle(hashtable019,Cache,185)
  local real x=LoadReal(hashtable019,Cache,6)
  local real y=LoadReal(hashtable019,Cache,7)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  if GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A13D')then
    if GetTriggerEventId()!=EVENT_UNIT_DEATH and IsMagicImmune(Target)==false then
      if IsUnitHidden(Target)then
        call SetUnitX(Target,x)
        call SetUnitY(Target,y)
      else
        call SetUnitPosition(Target,x,y)
      endif
    endif
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A13D',false)
    if(LoadInteger(hashtable019,GetHandleId(Source),704))==0 or(LoadInteger(hashtable019,GetHandleId(Source),704))=='A11N' then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A11N',true)
    endif
    call DestroyEffect(LoadEffectHandle(hashtable019,Cache,32))
    call ShowImage(i,false)
    call DestroyImage(i)
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,Cache)
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  set i=null
  set Source=null
  return false
endfunction

function Admiral_XMark_Effect takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real x=GetUnitX(Target)
  local real y=GetUnitY(Target)
  local real size=90
  local image i=CreateImage("Fonts\\X.blp",size,size,0,x-size/2,y-size/2,0,0,0,0,2)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local string fx=""
  local integer Level=GetUnitAbilityLevel(Source,'A11N')
  call AddTimedKeyToUnit(Target,4401,5)
  call UnitAddAbility2(Source,'A13D')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A13D',true)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A11N',false)
  call SetImageRenderAlways(i,true)
  if IsUnitAlly(Source,GetOwningPlayer(Target))==false or IsUnitAlly(Target,GetLocalPlayer()) or IsObserver(GetLocalPlayer())then
    set fx="effects\\BlackTide.mdx"
    call ShowImage(i,true)
  else
    call ShowImage(i,false)
  endif
  call SetImageColor(i,255,0,0,255)
  call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(Source),'o00G',x,y,0),'BTLF',5)
  call TriggerRegisterTimerEvent(t,Level,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function Admiral_XMark_Return))
  call SaveImageHandle(hashtable019,Cache,185,i)
  call SaveInteger(hashtable019,Cache,30,UnitAsInteger_Save(Target))
  call SaveReal(hashtable019,Cache,6,x*1.)
  call SaveReal(hashtable019,Cache,7,y*1.)
  call SaveEffectHandle(hashtable019,Cache,32,AddSpecialEffectTarget(fx,Target,"overhead"))
  call SaveUnitHandle(hashtable019,Cache,2,Source)
  set Source=null
  set Target=null
  set i=null
  set t=null
endfunction

function Admiral_XMark_Learn_Triggered takes nothing returns nothing
  call SetPlayerAbilityAvailable2(GetOwningPlayer(GetTriggerUnit()),'A13D',false)
  call UnitAddAbility2(GetTriggerUnit(),'A13D')
endfunction

function Admiral_XMark_EffectOrLearn takes nothing returns boolean
  if GetLearnedSkill()=='A11N' then
    call SetPlayerAbilityAvailable2(GetOwningPlayer(GetTriggerUnit()),'A13D',false)
    call UnitAddAbility2(GetTriggerUnit(),'A13D')
  endif
  return false
endfunction

function Admiral_XMark_Effectsup takes nothing returns nothing
  if IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))or IsBlocked(GetSpellTargetUnit())==false then
    call Admiral_XMark_Effect()
  endif
endfunction

function Admiral_XMark_OnCastsup takes nothing returns nothing
  if(LoadBoolean(hashtable019,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))and IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit())) then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n038'))
  endif
endfunction

function Admiral_XMark_Init takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Admiral_XMark_EffectOrLearn))
  set t=null
endfunction

function JAE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer B78=1
  local player p
  local real d
  local unit Target=LoadUnitHandle(hashtable019,Cache,17)
  local integer JBE=LoadInteger(hashtable019,Cache,136)
  local integer DP9=LoadInteger(hashtable019,Cache,188)
  if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>DP9 then
    call FlushChildHashtable(hashtable019,Cache)
    call CleanTrigger(t)
  else
    loop
      exitwhen B78>JBE
      set p=LoadPlayerHandle(hashtable019,Cache,1300+B78)
      set d=LoadReal(hashtable019,Cache,1200+B78)
      if p==null then
        set B78=JBE
      else
        call SetUnitState(Target,UNIT_STATE_LIFE,RMaxIF(1,GetUnitState(Target,UNIT_STATE_LIFE)-d/DP9))
      endif
      set B78=B78+1
    endloop
  endif
  set t=null
  set p=null
  set Target=null
  return false
endfunction

function JCE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=LoadUnitHandle(hashtable019,Cache,17)
  local player p=LoadPlayerHandle(hashtable019,Cache,54)
  local trigger J3E=LoadTriggerHandle(hashtable019,Cache,135)
  local integer B78=GetTriggerEvalCount(t)
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call FlushChildHashtable(hashtable019,Cache)
    call CleanTrigger(t)
    call TriggerRegisterTimerEvent(J3E,1,true)
    call TriggerAddCondition(J3E,Condition(function JAE))
    call UnitRemoveAbility(Target,'B09U')
  elseif IsRealDamage then
    set Cache=GetHandleId(J3E)
    call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+.5*GetEventDamage())
    call SavePlayerHandle(hashtable019,Cache,1300+B78,GetOwningPlayer(GetEventDamageSource()))
    call SaveReal(hashtable019,Cache,1200+B78,.5*GetEventDamage()*1.)
    call SaveInteger(hashtable019,Cache,136,B78)
  endif
  set t=null
  set Target=null
  set p=null
  set J3E=null
  return false
endfunction

function J6E takes nothing returns nothing
  local unit Source=DB8
  local unit Target=GetEnumUnit()
  local integer Level=DC8
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer DP9=8
  local trigger J3E=CreateTrigger()
  call AddTimedAbility(Target,'A126',1,DP9)
  call UnitMakeAbilityPermanent(Target,true,'A126')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A126',false)
  call TriggerRegisterTimerEvent(t,DP9+.01,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function JCE))
  call SavePlayerHandle(hashtable019,(Cache),(54),(GetOwningPlayer(Source)))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveTriggerHandle(hashtable019,(Cache),(135),(J3E))
  call SaveUnitHandle(hashtable019,(GetHandleId(J3E)),(17),(Target))
  call SaveInteger(hashtable019,(GetHandleId(J3E)),(188),(DP9))
  set Source=null
  set Target=null
  set t=null
  set J3E=null
endfunction

function JLE takes nothing returns boolean
  if(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitInGroup(GetFilterUnit(),DA8)==false then
    call GroupAddUnit(DA8,GetFilterUnit())
    return true
  endif
  return false
endfunction

function J1E takes nothing returns nothing
  local unit Source=DB8
  local unit Target=GetEnumUnit()
  local integer Level=DC8
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,'A13X')
  call IssueTargetOrderById(Caster,852095,Target)
  call DamageTarget(Source,Target,1,300+100*Level)
  set Source=null
  set Target=null
  set Caster=null
endfunction

function J0E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local unit J5E
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real SourceX=GetUnitX(Projectile)
  local real SourceY=GetUnitY(Projectile)
  local real TargetX=(LoadReal(hashtable019,(Cache),(66)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(67)))
  local integer Count=GetTriggerEvalCount(t)
  local real AO8=SafeX50(TargetX+13.33*Count*Cos(J2E))
  local real AP8=SafeY50(TargetY+13.33*Count*Sin(J2E))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local group AlreadyHit=(LoadGroupHandle(hashtable019,(Cache),(187)))
  local group g
  if Count<19 then
    call SetUnitVertexColor(Projectile,255,255,255,5+Count*10)
    set J5E=(LoadUnitHandle(hashtable019,(Cache),(186)))
    call SetUnitVertexColor(J5E,255,255,255,5+Count*10)
  elseif Count<125 then
    call SetUnitVertexColor(Projectile,255,255,255,190)
  elseif Count<150 then
  endif
  set g=GetAvailableGroup()
  set DA8=AlreadyHit
  set tt_unit1=Projectile
  set DB8=Projectile
  set DC8=Level
  call GroupEnumUnitsInRange(g,GetUnitX(Projectile),GetUnitY(Projectile),425,Condition(function JLE))
  call ForGroup(g,function J6E)
  call KillGroup(g)
  call SetUnitX(Projectile,AO8)
  call SetUnitY(Projectile,AP8)
  if Count==140 then
    set J5E=(LoadUnitHandle(hashtable019,(Cache),(186)))
    call KillUnit(J5E)
  elseif Count<140 then
    set J5E=(LoadUnitHandle(hashtable019,(Cache),(186)))
    call SetUnitX(J5E,AO8)
    call SetUnitY(J5E,AP8)
  endif
  if Count==150 then
    set g=GetAvailableGroup()
    set tt_unit1=Projectile
    call GroupEnumUnitsInRange(g,AO8,AP8,450,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function J1E)
    call KillGroup(g)
    call KillUnit(Projectile)
    call KillGroup(AlreadyHit)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Projectile=null
  set J5E=null
  set AlreadyHit=null
  set g=null
  return false
endfunction

function Admiral_GhostShip takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local real SourceX=GetUnitX(Hero)
  local real SourceY=GetUnitY(Hero)
  local real x0=GetSpellTargetX()
  local real y0=GetSpellTargetY()
  local real J2E
  local real x1
  local real y1
  local real x2
  local real y2
  local trigger t
  local integer Cache
  local integer Level
  local unit Projectile
  local unit J5E
  local string s=""
  local integer K8E='h06U'
  if GetRandomInt(0,5)==0 then
    set K8E='h0DJ'
  endif
  if IsPlayerAlly(GetOwningPlayer(Hero),GetLocalPlayer())or IsObserver(GetLocalPlayer())then
    set s="war3mapImported\\Whirlpool.mdx"
  endif
  if x0==GetUnitX(Hero)and y0==GetUnitY(Hero)then
    set x0=x0+50*Cos(GetUnitFacing(Hero)*bj_DEGTORAD)
    set y0=y0+50*Sin(GetUnitFacing(Hero)*bj_DEGTORAD)
  endif
  set J2E=Atan2(y0-SourceY,x0-SourceX)
  set x1=SourceX-1000*Cos(J2E)
  set y1=SourceY-1000*Sin(J2E)
  set x2=SourceX+1000*Cos(J2E)
  set y2=SourceY+1000*Sin(J2E)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  set Level=GetUnitAbilityLevel(Hero,'A11K')
  set Projectile=CreateUnit(GetOwningPlayer(Hero),K8E,x1,y1,Atan2(y0-SourceY,x0-SourceX)*bj_RADTODEG)
  set J5E=CreateUnit(GetOwningPlayer(Hero),'h06V',x1,y1,Atan2(y0-SourceY,x0-SourceX)*bj_RADTODEG)
  call SetUnitVertexColor(Projectile,255,255,255,0)
  call SetUnitPathing(Projectile,false)
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveUnitHandle(hashtable019,(Cache),(186),(J5E))
  call SaveReal(hashtable019,(Cache),(66),((x1)*1.))
  call SaveReal(hashtable019,(Cache),(67),((y1)*1.))
  call SaveGroupHandle(hashtable019,(Cache),(187),(GetAvailableGroup()))
  call DestroyEffect(AddSpecialEffect(s,SafeX50(x2),SafeY50(y2)))
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function J0E))
  set Hero=null
  set t=null
  set Projectile=null
  set J5E=null
endfunction

function S09 takes nothing returns nothing
  call PreloadAbility('A11L')
endfunction


function Alchemist_Unstable_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if IsDead(t)==false and IsUnitEnemy(group_temp_unit[0],GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R')==0 and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) then
    call UnitShareVision(t,Player(15),true)
    call DamageTarget(group_temp_unit[0],t,2,group_temp_real[0])
    call IssueTargetOrderById(group_temp_unit[1],852095,t)
    call UnitShareVision(t,Player(15),false)
  endif
  
  set t = null
  return false
endfunction

function group033 takes unit u, real duration, real x, real y, boolean b returns nothing
  local integer level = GetUnitAbilityLevel(u,'A1NI')
  
  set duration = duration/5.
  set group_temp_unit[0] = u
  set group_temp_unit[1] = CreateUnit(Player(15),'e00E',x,y,0)
  set group_temp_real[0] = (60 + 70*level) * duration
  
  call UnitAddAbility2(group_temp_unit[1],'A0X6')
  call SetUnitAbilityLevel(group_temp_unit[1],'A0X6',DO9((1 + 0.75*level)*duration) )
  
  call GroupEnumUnitsInRange(temp_group,x,y,200,Condition(function Alchemist_Unstable_Targets))
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl",x,y))
  
  if b then
    call UnitShareVision(u,Player(15),true)
    call DamageTarget(u,u,2,group_temp_real[0])
    call IssueTargetOrderById(group_temp_unit[1],852095,u)
    call UnitShareVision(u,Player(15),false)
  endif
endfunction

function KFE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real V19=(LoadReal(hashtable019,(Cache),(444)))
  local real KGE=(LoadReal(hashtable019,(Cache),(445)))
  local real J2E=AngleBetweenXY(GetUnitX(Projectile),GetUnitY(Projectile),GetUnitX(Target),GetUnitY(Target))
  local real x=GetUnitX(Projectile)+18*Cos(J2E*bj_DEGTORAD)
  local real y=GetUnitY(Projectile)+18*Sin(J2E*bj_DEGTORAD)
  call SetUnitX(Projectile,x)
  call SetUnitY(Projectile,y)
  if DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))<=18 then
    call KillUnit(Projectile)
    call group033(Source,V19,x,y,false)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif(TimerGetElapsed(GlobalTimer))-KGE>(5.+2.)then
    call KillUnit(Projectile)
    call group033(Source,V19,x,y,false)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  set Projectile=null
  return false
endfunction

function real077 takes unit Source,unit Target,real V19,real KGE returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=CreateUnit(GetOwningPlayer(Source),'h0BD',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveReal(hashtable019,(Cache),(444),((V19)*1.))
  call SaveReal(hashtable019,(Cache),(445),((KGE)*1.))
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function KFE))
  set Projectile=null
  set t=null
endfunction

function KIE takes string s,unit Target,unit Hero returns nothing
  local texttag tt=CreateTextTag()
  
  call SetTextTagPosUnit(tt,Target,64)
  call SetTextTagColor(tt,255,0,0,255)
  call SetTextTagVelocity(tt,0,.0355)
  call SetTextTagFadepoint(tt,.15)
  call SetTextTagPermanent(tt,false)
  call SetTextTagLifespan(tt,.65)
  
  if (IsUnitAlly(Hero,GetLocalPlayer()) or IsObserver(GetLocalPlayer()))==false  then
    set s = ""
  endif
  
  call SetTextTagText(tt,s,.033)
  call SetTextTagVisibility(tt,true)
  
  set tt=null
endfunction

function KKE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real KGE=(LoadReal(hashtable019,(Cache),(442)))
  local real Time=(TimerGetElapsed(GlobalTimer))
  local real Y59=5.-(Time-KGE)
  local real YO8=RMinIF(Time-KGE,5.)
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))+1
  local integer i
  local string s
  
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A1NI' then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1NI',true)
    endif
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1NH',false)
    call SetUnitVertexColor(Source,255,255,255,255)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if GetSpellAbilityId()=='A1NH' then
      if IsBlocked(GetSpellTargetUnit())==false then
        call real077(Source,GetSpellTargetUnit(),YO8,KGE)
      endif
      if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A1NI' then
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1NI',true)
      endif
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1NH',false)
      call SetUnitVertexColor(Source,255,255,255,255)
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    if Y59>=0 then
      set i = R2I(Y59)
      set s = I2S(i)
      
      if Y59 - i >= .5 then
        set s = s + ".5"
      endif
      
      set i = ModuloInteger(Count,2)*75
      call KIE(s,Source,Source)
      call SetUnitVertexColor(Source,255,100 + i,100 + i,255)
    else
      call SetUnitVertexColor(Source,255,0,0,255)
    endif
    if Time-KGE>(5.+.5)then
      call group033(Source,5.,GetWidgetX(Source),GetWidgetY(Source),true)
      if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A1NI' then
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1NI',true)
      endif
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1NH',false)
      call SetUnitVertexColor(Source,255,255,255,255)
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set Source=null
  return false
endfunction

function Alchemist_UnstableConcoction takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local string s="war3mapImported\\UnstableConcoctionRangeDisplay3.mdx"
  if GetLocalPlayer()!=GetOwningPlayer(Source)then
    set s=""
  endif
  //call echo(s)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(442),(((TimerGetElapsed(GlobalTimer)))*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget(s,Source,"origin")))
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function KKE))
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1NI',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1NH',true)
  call UnitAddAbility2(Source,'A1NH')
  call UnitMakeAbilityPermanent(Source,true,'A1NH')
  call TriggerEvaluate(t)
  set Source=null
  set t=null
endfunction


function Alchemist_Greed_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer load = LoadInteger(MHT,info,0)
  
  call SaveInteger(MHT,load,'A0O3',LoadInteger(MHT,load,'A0O3') - LoadInteger(MHT,info,1))
  
  call Timer_End(t)
  set t = null
endfunction

function Alchemist_Greed_Start takes unit u, unit d, player p, integer level returns nothing
  local timer t = Timer_Get()
  local texttag text
  local integer info = GetHandleId(t)
  local integer load = GetHandleId(u)
  local integer count = 2 + 2*level + LoadInteger(MHT,load,'A0O3')
  local boolean b=IsUnitType(d,UNIT_TYPE_HERO)
  if count>30 then
    set count = 30
  endif
  if b then
    set text = CreateTextTag()
    call SetTextTagText(text,"+"+I2S(count),.025)
    call SetTextTagPosUnit(text,d,0.3)
    call SetTextTagColor(text,255,220,0,255)
    call SetTextTagVelocity(text,0,.05)
    call SetTextTagVisibility(text,GetLocalPlayer()==p)
    call SetTextTagFadepoint(text,2)
    call SetTextTagLifespan(text,3)
    call SetTextTagPermanent(text,false)
    set text=null
    call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,count + GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD))
  endif
  call SaveInteger(MHT,load,'A0O3',level + LoadInteger(MHT,load,'A0O3'))//last bonus gold amount
  //call echo(I2S(level + LoadInteger(MHT,load,'A0O3')))
  call SaveInteger(MHT,info,0,load)
  call SaveInteger(MHT,info,1,level)
  call TimerStart(t,25,false,function Alchemist_Greed_End)
  set load = GetHandleId(p)
  call SaveInteger(MHT,load,'A0O3',LoadInteger(MHT,load,'A0O3') + count)//stats counter
  set t = null
endfunction

function Alchemist_Greed_Stats takes nothing returns boolean
  local player p = GetTriggerPlayer()
  call DisplayTimedTextToPlayer(p,0,0,10.,GetObjectName('n0GQ')+" "+I2S(LoadInteger(MHT,GetHandleId(p),'A0O3')))
  return false
endfunction

function Alchemist_Greed_Learn takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local player p = GetOwningPlayer(u)
  local trigger trig = CreateTrigger()
  local integer level = GetUnitAbilityLevel(u,'P155') //A0O3
  call TriggerRegisterPlayerChatEvent(trig,p,"-stats",true)
  call TriggerRegisterPlayerChatEvent(trig,p,"-st",true)
  call TriggerAddCondition(trig,Condition(function Alchemist_Greed_Stats))
  set trig = null
  set u = null
  set p=null
endfunction

function Alchemist_Greed_Check takes integer i returns boolean
  return i=='ebal' or i=='e026' or i=='umtw' or i=='u00R'
endfunction

function Alchemist_Greed_Condition takes unit u, unit t returns nothing
  local player p = GetOwningPlayer(u)
  local integer level = GetUnitAbilityLevel(u,'P155') //A0O3
  
  if level > 0 and IsUnitEnemy(t,p) and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and IsUnitIllusion(t)==false and (GetUnitAbilityLevel(t,'A04R')==0 or Alchemist_Greed_Check(GetUnitTypeId(t))) then
    if LoadReal(HeroStats,GetHandleId(p),25)< TimerGetElapsed(GlobalTimer) then
      call Alchemist_Greed_Start(u,t,p,level)
    endif
    
  endif
  set p=null
endfunction

function Alchemist_Acidspray_Targets takes nothing returns nothing
  local integer key
  local integer info
  local unit t = GetFilterUnit()
  
  if IsDead(t)==false and IsUnitEnemy(t,group_temp_player) and GetUnitAbilityLevel(t,'A04R')==0 and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(t)!='n0F5' then
    //call LoDStat_Add(t,group_temp_integer[1],"armourneg")
    //call DamageTarget(group_temp_unit[0],t,2,group_temp_integer[0])
    //call Buff_Add(t,LoDBuff_AbilID[14],LoDBuff_BuffID[14],1)
    //call GroupAddUnit(LoadGroupHandle(MHT,group_temp_integer[2],1),t)
    
    
    
    
    
    call GroupAddUnit(temp_group2,t)   //adds the unit to group of currently affected units
    call DamageTarget(group_temp_unit[0],t,2,group_temp_integer[0])
    
    if IsUnitInGroup(t,group_temp_group)==false then  //hasn't been affected by acidspray
      set info = GetHandleId(t)
      set key = StringHash("acidspray_count")
      
      call LoDStat_Add(t,group_temp_integer[1],"armourneg")
      call SaveInteger(MHT,GetHandleId(t),StringHash("acidspray"),LoadInteger(MHT,GetHandleId(t),StringHash("acidspray")+group_temp_integer[1]))
      call Buff_Add(t,LoDBuff_AbilID[14],LoDBuff_BuffID[14],-1) //adds the buff
      
      call SaveInteger(MHT,info,key,LoadInteger(MHT,info,key) + 1) //keeps track of the number of times the unit has been affected for stacking
      
      set t = null
      return
    endif
    
    call GroupRemoveUnit(group_temp_group,t) //removes the unit from the group of previously affected units
  endif
  
  set t = null
endfunction

function RemoveAcidSprayDebuff_Helper takes nothing returns boolean//[lich] Acid spray debug
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(MHT,h,2)
  if UA8(u)==false then
    call Buff_Remove(u,LoDBuff_BuffID[14])
    call LoDStat_Sub(u,LoadInteger(MHT,h,0),"armourneg")
    call DisableTrigger(t)
    call DestroyTrigger(t)
    call FlushChildHashtable(MHT,h)
  endif
  set u=null
  set t=null
  return false
endfunction

function Alchemist_Acidspray_Duration takes nothing returns nothing
  local unit u = null
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer key = StringHash("acidspray_count")
  local integer count = LoadInteger(MHT,info,0)
  local trigger tt
  local integer h
  
  set group_temp_integer[1] = LoadInteger(MHT,info,2) //armour reduction
  set group_temp_group = LoadGroupHandle(MHT,info,1)
  
  if count==17 then
    set count = LoadInteger(MHT,info,2)
    call DestroyEffect(LoadEffectHandle(MHT,info,2))
    
    loop
      set u = FirstOfGroup(group_temp_group)
      exitwhen u==null
      set info = GetHandleId(u)
      set count = LoadInteger(MHT,info,key)
      if UA8(u)==false then
        if count==1then
          call Buff_Remove(u,LoDBuff_BuffID[14])
        endif
        call SaveInteger(MHT,GetHandleId(u),StringHash("acidspray"),IMinBJ(LoadInteger(MHT,GetHandleId(u),StringHash("acidspray")-group_temp_integer[1]),0))
        call LoDStat_Sub(u,group_temp_integer[1],"armourneg")
      else
        set tt=CreateTrigger()
        call TriggerRegisterTimerEvent(tt,1,true)
        call TriggerAddCondition(tt,Condition(function RemoveAcidSprayDebuff_Helper))
        set h=GetHandleId(tt)
        call SaveInteger(MHT,h,0,group_temp_integer[1])
        call SaveUnitHandle(MHT,h,2,u)
        set tt=null
      endif
      call SaveInteger(MHT,info,key,count - 1)
      call GroupRemoveUnit(group_temp_group,u)
    endloop
    
    call KillGroup(group_temp_group)
    call Timer_End(t)
    set t = null
    return
  endif
  
  call SaveInteger(MHT,info,0,count + 1)
  
  
  set group_temp_player = LoadPlayerHandle(MHT,info,3)
  set group_temp_unit[0] = LoadUnitHandle(MHT,info,0)
  set group_temp_integer[0] = LoadInteger(MHT,info,1) //damage
  
  call GroupEnumUnitsInRange(temp_group,LoadReal(MHT,info,0),LoadReal(MHT,info,1),650,Condition(function Alchemist_Acidspray_Targets))
  
  
  
  
  
  //removes the bonuses from any unit out of range
  loop
    set u = FirstOfGroup(group_temp_group)
    exitwhen u==null
    set info = GetHandleId(u)
    
    set count = LoadInteger(MHT,info,key)
    
    if count==1then
      call Buff_Remove(u,LoDBuff_BuffID[14])
    endif
    
    call SaveInteger(MHT,info,key,count - 1)
    call SaveInteger(MHT,info,StringHash("acidspray"),LoadInteger(MHT,info,StringHash("acidspray")-group_temp_integer[1]))
    call LoDStat_Sub(u,group_temp_integer[1],"armourneg")
    
    call GroupRemoveUnit(group_temp_group,u)
  endloop
  
  //updates the current group with the newly affected units
  loop
    set u = FirstOfGroup(temp_group2)
    exitwhen u==null
    call GroupRemoveUnit(temp_group2,u)
    call GroupAddUnit(group_temp_group,u)
  endloop
  
  set u=null
  set tt=null
  set t = null
endfunction

function Alchemist_Acidspray_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local integer level = GetUnitAbilityLevel(u,'A0IL')
  local integer info = GetHandleId(t)
  local real x = GetSpellTargetX()
  local real y = GetSpellTargetY()
  
  call SaveUnitHandle(MHT,info,0,u)
  call SaveGroupHandle(MHT,info,1,GetAvailableGroup())
  call SaveEffectHandle(MHT,info,2,AddSpecialEffect("effects\\Radioactivecloud_2c.mdl",x,y))
  call SavePlayerHandle(MHT,info,3,GetOwningPlayer(u))
  call SaveInteger(MHT,info,0,0)
  call SaveInteger(MHT,info,1,level*6 + 8)
  call SaveInteger(MHT,info,2,level + 2)
  call SaveReal(MHT,info,0,x)
  call SaveReal(MHT,info,1,y)
  
  call TimerStart(t,1,true,function Alchemist_Acidspray_Duration)
  
  set t = null
  set u = null
endfunction






function KLE takes nothing returns nothing
  call DamageTarget(D28,GetEnumUnit(),1,D58)
endfunction

function K1E takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'A0E3')
  local real Damage=(.35+.25*Level)*(GetUnitState(Target,UNIT_STATE_MAX_MANA)-GetUnitState(Target,UNIT_STATE_MANA))
  local group g=GetAvailableGroup()
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl",Target,"chest"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SpiritOfVengeanceMissile\\SpiritOfVengeanceMissile.mdl",Target,"chest"))
  call DestroyEffect(AddSpecialEffect("war3mapImported\\Enchantment.mdx",GetUnitX(Target),GetUnitY(Target)))
  call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),450+25,Condition(function LR8))
  set D58=Damage
  set D28=Hero
  call ForGroup(g,function KLE)
  call PlaySoundOnUnitBJ(sound016,100,Target)
  call KillGroup(g)
  set Hero=null
  set Target=null
  set g=null
endfunction

function AM_ManaVoid takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call K1E()
  endif
endfunction


function integer528 takes unit Source,unit Target returns nothing
  local integer Level=GetUnitAbilityLevel(Source,'A1V6')
  local real real078=16+12*Level
  local real M4E=GetUnitState(Target,UNIT_STATE_MANA)
  local real M7E=RMinBJ(real078,M4E)
  if M7E>0 then
    call SetUnitState(Target,UNIT_STATE_MANA,M4E-M7E)
    call DamageTarget(Source,Target,2,M7E*.6)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\SpellBreakerAttack.mdl",Target,"origin"))
  endif
endfunction

function M8E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source then
      call DisableTrigger(t)
      call integer528(Source,Target)
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function integer495 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local unit Target=GetTriggerUnit()
  local unit Source=GetAttacker()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(t,.4,false)
  call TriggerAddCondition(t,Condition(function M8E))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set Target=null
  set Source=null
  set t=null
endfunction

function MDE takes nothing returns nothing
  local unit Source=GetAttacker()
  if((LoadInteger(hashtable019,(GetHandleId((Source))),((4274))))==1)==false then
    call AddTimedKeyToUnit(Source,4274,.4)
    call integer495()
  endif
  set Source=null
endfunction

function real061 takes nothing returns boolean
  if GetUnitAbilityLevel(GetAttacker(),'A1V6')>0 and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetAttacker()==(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(14)))and GetUnitTypeId(GetTriggerUnit())!='n00L' and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))and IsMagicImmune(GetTriggerUnit())==false then
    call MDE()
  endif
  return false
endfunction

function Magina_ManaBreak_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function real061))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(GetTriggerUnit()))
  set t=null
endfunction

function MGE takes nothing returns boolean
  if GetLearnedSkill()=='A1V6' and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Magina_ManaBreak_Learn()
  endif
  return false
endfunction

function JY9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function MGE))
  set t=null
endfunction

function player001 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local integer Count=GetTriggerEvalCount(t)
  local integer MIE=R2I(((.9-.3)/ .5)/ .03)
  local integer MJE=R2I((175/ MIE))
  local integer booleans027=R2I((255/ MIE)*1.75)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  if Count>MIE then
    call SetUnitVertexColor(Caster,255,255,255,0)
    call SetUnitVertexColor(Hero,255,255,255,255)
    call ShowUnit(Caster,false)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SetUnitVertexColor(Caster,255,255,255,175-MJE*Count)
    call SetUnitX(Caster,x)
    call SetUnitY(Caster,y)
    call SetUnitVertexColor(Hero,255,255,255,booleans027*Count)
  endif
  set t=null
  set Caster=null
  set Hero=null
  return false
endfunction

function AM_Blink takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Caster=(LoadUnitHandle(hashtable019,(GetHandleId(Hero)),(293)))
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real x=GetUnitX(Hero)
  local real y=GetUnitY(Hero)
  call SetUnitX(Caster,x)
  call SetUnitY(Caster,y)
  call SetUnitX(Hero,x)
  call SetUnitY(Hero,y)
  call SetUnitVertexColor(Hero,255,255,255,0)
  call SetUnitVertexColor(Caster,255,255,255,175)
  call SetUnitTimeScale(Caster,.5)
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function player001))
  set Hero=null
  set Caster=null
  set t=null
endfunction

function AM_Blink_OnCast takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Caster
  local integer Cache=GetHandleId(Hero)
  local real a=AngleBetweenXY(GetUnitX(Hero),GetUnitY(Hero),GetSpellTargetX(),GetSpellTargetY())
  local real x=GetUnitX(Hero)
  local real y=GetUnitY(Hero)
  call SetUnitPathing(Hero,false)
  call UnitAddAbility2(Hero,'Aeth')
  set Caster=CreateUnit(GetOwningPlayer(Hero),'h06K',GetUnitX(Hero),GetUnitY(Hero),a)
  call BT8(Caster,5)
  call SetUnitPathing(Caster,false)
  call UnitAddAbility2(Caster,'Aeth')
  call UnitAddAbility2(Caster,'Aloc')
  call UnitAddAbility2(Caster,'A04R')
  call SetUnitVertexColor(Caster,255,255,255,0)
  call SetUnitX(Caster,x)
  call SetUnitY(Caster,y)
  call SetUnitX(Hero,x)
  call SetUnitY(Hero,y)
  call SetUnitAnimation(Caster,"Spell Throw")
  call SetUnitPathing(Hero,true)
  call UnitRemoveAbility(Hero,'Aeth')
  call SaveUnitHandle(hashtable019,(Cache),(293),(Caster))
  set Hero=null
  set Caster=null
endfunction

function JX9 takes nothing returns nothing
  call B08('h06K')
endfunction

function TreeKiller takes nothing returns nothing
  call KillDestructable(GetEnumDestructable())
endfunction

function trigger010 takes unit XX8,real x,real y,group HND returns nothing
  local group HQ9=GetAvailableGroup()
  local unit unit039
  call KillTrees(x,y,150)
  call GroupEnumUnitsInRange(HQ9,x,y,150,Condition(function ReturnTrue2))
  loop
    set unit039=FirstOfGroup(HQ9)
    exitwhen unit039==null
    if(IsUnitInGroup(unit039,HND)==false and IsUnitEnemy(unit039,GetOwningPlayer(XX8)))then
      if(GetUnitAbilityLevel(unit039,'A04R')!=1 and GetUnitState(unit039,UNIT_STATE_LIFE)>0 and IsUnitType(unit039,UNIT_TYPE_STRUCTURE)==false)then
        call GroupAddUnit(HND,unit039)
        call DamageTarget(XX8,unit039,5,60+GetUnitAbilityLevel(XX8,'A0O1')*30)
        call AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",unit039,"overhead")
      endif
    endif
    call GroupRemoveUnit(HQ9,unit039)
  endloop
  call KillGroup(HQ9)
  set HQ9=null
  set unit039=null
endfunction

function MSE takes nothing returns nothing
  local integer Cache=GetHandleId(GetExpiredTimer())
  local unit MTE=(LoadUnitHandle(hashtable019,(Cache),(290)))
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real Ax=(LoadReal(hashtable019,(Cache),(284)))
  local real Ay=(LoadReal(hashtable019,(Cache),(285)))
  local real Cx=(LoadReal(hashtable019,(Cache),(286)))
  local real Cy=(LoadReal(hashtable019,(Cache),(287)))
  local real Bx=(LoadReal(hashtable019,(Cache),(288)))
  local real By=(LoadReal(hashtable019,(Cache),(289)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local real b=1-a
  local boolean integer494=(LoadBoolean(hashtable019,(Cache),(291)))
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local real MVE=RMaxBJ(DistanceBetweenXY(Ax,Ay,Cx,Cy)/ 1300,.4)
  call SetUnitX(MTE,SafeX50(Ax*a*a+Bx*2*a*b+Cx*b*b))
  call SetUnitY(MTE,SafeY50(Ay*a*a+By*2*a*b+Cy*b*b))
  call trigger010(Hero,GetUnitX(MTE),GetUnitY(MTE),HND)
  if(integer494)then
    call SaveReal(hashtable019,(Cache),(137),((a-.02/ MVE)*1.))
  else
    call SaveReal(hashtable019,(Cache),(137),((a+.02/ MVE)*1.))
    call SaveReal(hashtable019,(Cache),(284),((GetUnitX(Hero))*1.))
    call SaveReal(hashtable019,(Cache),(285),((GetUnitY(Hero))*1.))
  endif
  if(a<0 and integer494)then
    call SaveBoolean(hashtable019,(Cache),(291),(false))
    call SaveReal(hashtable019,(Cache),(288),((Ax+300*Cos(Atan2(Cy-Ay,Cx-Ax)+(LoadReal(hashtable019,(Cache),(292)))))*1.))
    call SaveReal(hashtable019,(Cache),(289),((Ay+300*Sin(Atan2(Cy-Ay,Cx-Ax)+(LoadReal(hashtable019,(Cache),(292)))))*1.))
  endif
  if(a>1 and integer494==false)then
    call PauseTimer(GetExpiredTimer())
    call KillGroup(HND)
    call FlushChildHashtable(hashtable019,(Cache))
    call RemoveUnit(MTE)
    call DestroyTimer(GetExpiredTimer())
  endif
  set MTE=null
  set Hero=null
  set HND=null
endfunction

function Beastmaster_WildAxes takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local real Ax=GetUnitX(XX8)
  local real Ay=GetUnitY(XX8)
  local real Cx=GetSpellTargetX()
  local real Cy=GetSpellTargetY()
  local unit reals021=CreateUnit(GetOwningPlayer(XX8),'e01T',Ax,Ay,270.)
  local unit MYE=CreateUnit(GetOwningPlayer(XX8),'e01T',Ax,Ay,270.)
  local integer MZE
  local integer booleans026
  local timer MBE=CreateTimer()
  local timer integers064=CreateTimer()
  if GetSpellTargetUnit()!=null then
    set Cx=GetUnitX(GetSpellTargetUnit())
    set Cy=GetUnitY(GetSpellTargetUnit())
  endif
  call UnitAddAbility2(reals021,'Amrf')
  call UnitRemoveAbility(reals021,'Amrf')
  call SetUnitFlyHeight(reals021,150,0)
  call UnitAddAbility2(MYE,'Amrf')
  call UnitRemoveAbility(MYE,'Amrf')
  call SetUnitFlyHeight(MYE,150,0)
  set MZE=GetHandleId(MBE)
  call SaveUnitHandle(hashtable019,(MZE),(14),(XX8))
  call SaveUnitHandle(hashtable019,(MZE),(290),(reals021))
  call SaveGroupHandle(hashtable019,(MZE),(133),(GetAvailableGroup()))
  call SaveReal(hashtable019,(MZE),(284),((Ax)*1.))
  call SaveReal(hashtable019,(MZE),(285),((Ay)*1.))
  call SaveReal(hashtable019,(MZE),(286),((Cx)*1.))
  call SaveReal(hashtable019,(MZE),(287),((Cy)*1.))
  call SaveReal(hashtable019,(MZE),(288),((Ax+300*Cos(Atan2(Cy-Ay,Cx-Ax)+45))*1.))
  call SaveReal(hashtable019,(MZE),(289),((Ay+300*Sin(Atan2(Cy-Ay,Cx-Ax)+45))*1.))
  call SaveReal(hashtable019,(MZE),(137),((1)*1.))
  call SaveReal(hashtable019,(MZE),(292),((-45)*1.))
  call SaveBoolean(hashtable019,(MZE),(291),(true))
  set booleans026=GetHandleId(integers064)
  call SaveUnitHandle(hashtable019,(booleans026),(14),(XX8))
  call SaveUnitHandle(hashtable019,(booleans026),(290),(MYE))
  call SaveGroupHandle(hashtable019,(booleans026),(133),(GetAvailableGroup()))
  call SaveReal(hashtable019,(booleans026),(284),((Ax)*1.))
  call SaveReal(hashtable019,(booleans026),(285),((Ay)*1.))
  call SaveReal(hashtable019,(booleans026),(286),((Cx)*1.))
  call SaveReal(hashtable019,(booleans026),(287),((Cy)*1.))
  call SaveReal(hashtable019,(booleans026),(288),((Ax+300*Cos(Atan2(Cy-Ay,Cx-Ax)-45))*1.))
  call SaveReal(hashtable019,(booleans026),(289),((Ay+300*Sin(Atan2(Cy-Ay,Cx-Ax)-45))*1.))
  call SaveReal(hashtable019,(booleans026),(137),((1)*1.))
  call SaveReal(hashtable019,(booleans026),(292),((45)*1.))
  call SaveBoolean(hashtable019,(booleans026),(291),(true))
  call TimerStart(MBE,.025,true,function MSE)
  call TimerStart(integers064,.025,true,function MSE)
  set XX8=null
  set reals021=null
  set MYE=null
  set MBE=null
  set integers064=null
endfunction


function integer496 takes nothing returns nothing
  local real x=GetUnitX(GetEnumUnit())
  local real y=GetUnitY(GetEnumUnit())
  local real a=bj_RADTODEG*Atan2(y-real084,x-tt_real1)
  local real M6E
  local real MLE
  if Sin((a-real085)*bj_DEGTORAD)<0 then
    set M6E=GetUnitX(GetEnumUnit())+15*Cos((real085-90)*bj_DEGTORAD)
    set MLE=GetUnitY(GetEnumUnit())+15*Sin((real085-90)*bj_DEGTORAD)
    if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO) then
      call SaveBoolean(HeroStats,GetHandleId(GetEnumUnit()),99,true)
    endif
    call SetUnitPosition(GetEnumUnit(),M6E,MLE)
    call SetUnitFacingTimed(GetEnumUnit(),real085+90,.3)
  else
    set M6E=GetUnitX(GetEnumUnit())+15*Cos((real085+90)*bj_DEGTORAD)
    set MLE=GetUnitY(GetEnumUnit())+15*Sin((real085+90)*bj_DEGTORAD)
    if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO) then
      call SaveBoolean(HeroStats,GetHandleId(GetEnumUnit()),99,true)
    endif
    call SetUnitPosition(GetEnumUnit(),M6E,MLE)
    call SetUnitFacingTimed(GetEnumUnit(),real085-90,.3)
  endif
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",GetEnumUnit(),"origin"))
endfunction

function boolean147 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  if GetTriggerEvalCount(t)>16 then
    call KillGroup(g)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set tt_real1=x
    set real084=y
    set real085=J2E
    call ForGroup(g,function integer496)
  endif
  set t=null
  set g=null
  return false
endfunction

function M0E takes nothing returns nothing
  call DamageTarget(tt_unit1,GetEnumUnit(),1,tt_real1)
endfunction

function integer497 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'A0O2')
  local unit Caster
  local real J2E=bj_RADTODEG*Atan2(GetUnitY(Target)-GetUnitY(Hero),GetUnitX(Target)-GetUnitX(Hero))
  local real x
  local real y
  local group g=GetAvailableGroup()
  local group g2=GetAvailableGroup()
  if Level==0 then
    set Level=GetUnitAbilityLevel(Hero,'A289')
  endif
  call SaveGroupHandle(hashtable019,(Cache),(22),(g))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Hero))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Hero))*1.))
  call TriggerRegisterTimerEvent(t,.025,true)
  call TriggerAddCondition(t,Condition(function boolean147))
  set x=GetUnitX(Hero)+50*Cos(J2E*bj_DEGTORAD)
  set y=GetUnitY(Hero)+50*Sin(J2E*bj_DEGTORAD)
  call GroupEnumUnitsInRange(g2,x,y,250,Condition(function LR8))
  call GroupAddGroup(g2,g)
  call GroupClear(g2)
  set Caster=CreateUnit(GetOwningPlayer(Hero),'o00Y',x,y,J2E)
  call UnitApplyTimedLife(Caster,'BTLF',1)
  call UnitAddAbility2(Caster,'A0NY')
  call SetUnitAbilityLevel(Caster,'A0NY',Level)
  call IssueImmediateOrderById(Caster,852096)
  set x=GetUnitX(Hero)+250*Cos(J2E*bj_DEGTORAD)
  set y=GetUnitY(Hero)+250*Sin(J2E*bj_DEGTORAD)
  call GroupEnumUnitsInRange(g2,x,y,250,Condition(function LR8))
  call GroupAddGroup(g2,g)
  call GroupClear(g2)
  set Caster=CreateUnit(GetOwningPlayer(Hero),'o00Y',x,y,J2E)
  call UnitApplyTimedLife(Caster,'BTLF',1)
  call UnitAddAbility2(Caster,'A0NY')
  call SetUnitAbilityLevel(Caster,'A0NY',Level)
  call IssueImmediateOrderById(Caster,852096)
  set x=GetUnitX(Hero)+450*Cos(J2E*bj_DEGTORAD)
  set y=GetUnitY(Hero)+450*Sin(J2E*bj_DEGTORAD)
  call GroupEnumUnitsInRange(g2,x,y,250,Condition(function LR8))
  call GroupAddGroup(g2,g)
  call GroupClear(g2)
  set Caster=CreateUnit(GetOwningPlayer(Hero),'o00Y',x,y,J2E)
  call UnitApplyTimedLife(Caster,'BTLF',1)
  call UnitAddAbility2(Caster,'A0NY')
  call SetUnitAbilityLevel(Caster,'A0NY',Level)
  call IssueImmediateOrderById(Caster,852096)
  if GetUnitAbilityLevel(Hero,'A0O2')==0 then
    set x=GetUnitX(Hero)+650*Cos(J2E*bj_DEGTORAD)
    set y=GetUnitY(Hero)+650*Sin(J2E*bj_DEGTORAD)
    call GroupEnumUnitsInRange(g2,x,y,250,Condition(function LR8))
    call GroupAddGroup(g2,g)
    call GroupClear(g2)
    set Caster=CreateUnit(GetOwningPlayer(Hero),'o00Y',x,y,J2E)
    call UnitApplyTimedLife(Caster,'BTLF',1)
    call UnitAddAbility2(Caster,'A0NY')
    call SetUnitAbilityLevel(Caster,'A0NY',Level)
    call IssueImmediateOrderById(Caster,852096)
  endif
  call KillGroup(g2)
  call GroupRemoveUnit(g,Target)
  set tt_real1=100*Level
  set tt_unit1=Hero
  call ForGroup(g,function M0E)
  call KillGroup(g)
  set t=null
  set Hero=null
  set Target=null
  set Caster=null
  set g=null
  set g2=null
endfunction

function Beastmaster_PrimalRoar takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call integer497()
  endif
endfunction


function N4E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call UnitRemoveAbility(Source,'A140')
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function Beastmaster_HawkInvis takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call UnitAddAbility2(Source,'A140')
  call TriggerRegisterTimerEvent(t,6,false)
  call TriggerAddCondition(t,Condition(function N4E))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=null
  set Source=null
endfunction

function NDE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit NEE=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real LastX=(LoadReal(hashtable019,(Cache),(6)))
  local real LastY=(LoadReal(hashtable019,(Cache),(7)))
  local real NHE=GetUnitX(NEE)
  local real NIE=GetUnitY(NEE)
  call SaveReal(hashtable019,(Cache),(6),((NHE)*1.))
  call SaveReal(hashtable019,(Cache),(7),((NIE)*1.))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if LastX==NHE and LastY==NIE then
      if GetUnitAbilityLevel(NEE,'A1WG')==0 then
        call UnitAddAbility2(NEE,'A1WG')
      endif
    else
      if GetUnitAbilityLevel(NEE,'A1WG')>0 then
        call UnitRemoveAbility(NEE,'A1WG')
      endif
    endif
  endif
  set t=null
  set NEE=null
  return false
endfunction

function Beastmaster_CallOfTheWild_Learned takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local integer level = GetUnitAbilityLevel(u,'A0OO')
  if(level==1)then
    call UnitAddAbility2(u,'A300')
  elseif level==2 then
    call UnitAddAbility2(u,'A301')
  endif
  call SetUnitAbilityLevel(u,'A300',level)
  call SetUnitAbilityLevel(u,'A301',level)
  set u=null
endfunction

function Beastmaster_CallOfTheWild takes nothing returns nothing
  if GetLearnedSkill()=='A0OO' then
    call Beastmaster_CallOfTheWild_Learned()
  endif
endfunction

function JB9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Beastmaster_CallOfTheWild))
  set t = null
endfunction

function Beastmaster_KillBeasts takes nothing returns nothing
  call KillUnit(GetEnumUnit())
endfunction

function Beastmaster_beast_filter takes nothing returns boolean
  return (GetUnitTypeId(GetFilterUnit())=='n01M' or GetUnitTypeId(GetFilterUnit())=='n01S') and LoadBoolean(MHT,GetHandleId(GetFilterUnit()),'0MCB')==false
endfunction

function Beastmaster_CallBeast takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer i=GetUnitAbilityLevel(u,'A301')
  local group g=GetAvailableGroup()
  local boolean b=false
  local unit boar=null
  if GetUnitTypeId(u)=='e00E' then
    set b=true
    set u=udg_Hero[GetPlayerId(GetOwningPlayer(u))]
  endif
  call KillGroup(g)
  if i==4 then
    set boar=CreateUnit(GetOwningPlayer(u),'n01S',GetUnitX(u),GetUnitY(u),GetUnitFacing(u))
  else
    set boar=CreateUnit(GetOwningPlayer(u),'n01M',GetUnitX(u),GetUnitY(u),GetUnitFacing(u))
  endif
  call UnitApplyTimedLife(boar,'BTLF',60)
  if b then
    call SaveBoolean(MHT,GetHandleId(boar),'0MCB',true)
  else
    call RemoveSavedBoolean(MHT,GetHandleId(boar),'0MCB')
  endif
  set boar=null
  set u=null
  set g=null
endfunction

function Beastmaster_Hawk_filter takes nothing returns boolean
  return (GetUnitTypeId(GetFilterUnit())=='n01Q' or GetUnitTypeId(GetFilterUnit())=='n01R') and LoadBoolean(MHT,GetHandleId(GetFilterUnit()),'0MCB')==false
endfunction

function Beastmaster_CallHawk takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer i=GetUnitAbilityLevel(u,'A300')
  local group g=GetAvailableGroup()
  local trigger t
  local integer Cache
  local unit hawk
  local boolean b=false
  call KillGroup(g)
  if GetUnitTypeId(u)=='e00E' then
    set b=true
    set u=udg_Hero[GetPlayerId(GetOwningPlayer(u))]
  endif
  if i>2 then
    set hawk=CreateUnit(GetOwningPlayer(u),'n01R',GetUnitX(u),GetUnitY(u),GetUnitFacing(u))
  else
    set hawk=CreateUnit(GetOwningPlayer(u),'n01Q',GetUnitX(u),GetUnitY(u),GetUnitFacing(u))
  endif
  if b then
    call SaveBoolean(MHT,GetHandleId(hawk),'0MCB',true)
  else
    call RemoveSavedBoolean(MHT,GetHandleId(hawk),'0MCB')
  endif
  call UnitApplyTimedLife(hawk,'BTLF',60)
  if i>2 then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,.05,true)
    call TriggerRegisterUnitEvent(t,hawk,EVENT_UNIT_DEATH)
    call SaveReal(hashtable019,(Cache),(6),((GetUnitX(hawk))*1.))
    call SaveReal(hashtable019,(Cache),(7),((GetUnitY(hawk))*1.))
    call SaveUnitHandle(hashtable019,(Cache),(2),(hawk))
    call TriggerAddCondition(t,Condition(function NDE))
    set t=null
  endif
  set u=null
  set hawk=null
  set g=null
endfunction

function NME takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local integer Cache=GetHandleId(Source)
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local texttag tt=CreateTextTag()
  local integer W98
  local integer i=1
  local unit u
  local player p2
  if Level==1 then
    set W98=150
  elseif Level==2 then
    set W98=200
  else
    set W98=250
  endif
  call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+W98)
  call SetTextTagText(tt,"+"+I2S(W98),.025)
  call SetTextTagPosUnit(tt,udg_Hero[GetPlayerId(p)],100)
  call SetTextTagColor(tt,255,220,0,255)
  call SetTextTagVelocity(tt,0,.03)
  call SetTextTagVisibility(tt,GetLocalPlayer()==p)
  call SetTextTagFadepoint(tt,2)
  call SetTextTagLifespan(tt,3)
  call SetTextTagPermanent(tt,false)
  set ReliableGold[GetPlayerId(p)]=ReliableGold[GetPlayerId(p)]+W98
  //set E48=E48+W98
  set TrackBonusBounty[GetPlayerId(p)]=TrackBonusBounty[GetPlayerId(p)]+W98
  if Level==1 then
    set W98=50
  elseif Level==2 then
    set W98=100
  else
    set W98=150
  endif
  loop
    exitwhen i>5
    if IsSentinel(p)then
      set p2=Sentinels[i]
    else
      set p2=Scourges[i]
    endif
    if p2!=p then
      set u=udg_Hero[GetPlayerId(p2)]
      if DistanceBetweenUnits(u,Source)<950 then
        set tt=CreateTextTag()
        call SetPlayerState(p2,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p2,PLAYER_STATE_RESOURCE_GOLD)+W98)
        call SetTextTagText(tt,"+"+I2S(W98),.025)
        call SetTextTagPosUnit(tt,u,100)
        call SetTextTagColor(tt,255,220,0,255)
        call SetTextTagVelocity(tt,0,.03)
        call SetTextTagVisibility(tt,GetLocalPlayer()==p2)
        call SetTextTagFadepoint(tt,2)
        call SetTextTagLifespan(tt,3)
        call SetTextTagPermanent(tt,false)
        set ReliableGold[GetPlayerId(p2)]=ReliableGold[GetPlayerId(p2)]+W98
        //set E48=E48+W98
        set TrackBonusBounty[GetPlayerId(p2)]=TrackBonusBounty[GetPlayerId(p2)]+W98
      endif
    endif
    set i=i+1
  endloop
  set Source=null
  set p=null
  set p2=null
  set u=null
  set tt=null
endfunction

function NNE takes nothing returns boolean
  if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) and(LoadReal(hashtable019,GetHandleId(GetTriggerUnit()),314))>(TimerGetElapsed(GlobalTimer)) then
    call NME()
  endif
  return false
endfunction

function NOE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  call SetUnitX(Caster,GetUnitX(Target))
  call SetUnitY(Caster,GetUnitY(Target))
  if GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEvalCount(t)>10 and GetUnitAbilityLevel(Target,'B00L')==0) or GetTriggerEvalCount(t)>LoadInteger(hashtable019,Cache,0) then
    call UnitRemoveAbility(Target,'A312')
    call SaveReal(hashtable019,GetHandleId(Target),314,0)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call KillUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  set Caster=null
  return false
endfunction

function Bounty_Track takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=GetSpellTargetUnit()
  local unit Source=GetTriggerUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'e01V',GetUnitX(Target),GetUnitY(Target),0)
  local string FX="war3mapImported\\TrackBuff.mdx"
  if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Target))and IsObserver(GetLocalPlayer())==false then
    set FX=""
  endif
  call UnitAddAbility2(Caster,'A115')
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerRegisterUnitEvent(t,GetSpellTargetUnit(),EVENT_UNIT_DEATH)
  
  call TriggerAddCondition(t,Condition(function NOE))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget(FX,Target,"overhead")))
  if GetSpellAbilityId()=='A0B4' then
    call SaveReal(hashtable019,GetHandleId(GetSpellTargetUnit()),314,(TimerGetElapsed(GlobalTimer)+30)*1.)
    call SaveInteger(hashtable019,Cache,0,30*10)
  else
    call SaveReal(hashtable019,GetHandleId(GetSpellTargetUnit()),314,(TimerGetElapsed(GlobalTimer)+15)*1.)
    call SaveInteger(hashtable019,Cache,0,15*10)
  endif
  call SavePlayerHandle(hashtable019,(GetHandleId(GetSpellTargetUnit())),(54),(GetOwningPlayer(GetTriggerUnit())))
  call SaveInteger(hashtable019,(GetHandleId(GetSpellTargetUnit())),(5),(GetUnitAbilityLevel(GetTriggerUnit(),GetSpellAbilityId())))
  call UnitAddAbility2(Target,'A312')
  call UnitMakeAbilityPermanent(Target,true,'A311')
  call SetPlayerAbilityAvailable(GetOwningPlayer(Target),'A312',false)
  call ShareVision(Target,Source,'A312')
  call DetectMagicDispell(Target,'A312','B00L')
  
  set t=null
  set Target=null
  set Source=null
  set Caster=null
endfunction

function Bounty_ShowBonusBounty takes nothing returns nothing
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,"Track bonus gold: "+I2S(TrackBonusBounty[GetPlayerId(GetTriggerPlayer())]))
endfunction

function J09 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function NNE))
  set t=CreateTrigger()
  call TriggerRegisterPlayersChat(t,"-st",true)
  call TriggerRegisterPlayersChat(t,"-stats",true)
  call TriggerAddCondition(t,Condition(function Bounty_ShowBonusBounty))
  set t=null
endfunction

function NRE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call UnitRemoveAbility(Target,'A1IW')
  call UnitRemoveAbility(Target,'B0CA')
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Target=null
  return false
endfunction

function NSE takes unit Source,unit Target returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,3,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function NRE))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call UnitAddAbility2(Target,'A1IW')
  call UnitMakeAbilityPermanent(Target,true,'A1IW')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A1IW',false)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl",Target,"chest"))
  
  
  if LoadBoolean(MHT,GetHandleId(GetOwningPlayer(Source)),4)then
    //call Passive_Cooldown(Source,'A1IQ',GetUnitAbilityLevel(Source,'A1IQ'))
  endif
  set t=null
endfunction

function NTE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source and(GetEventDamage()>40 or IsUnitType(Target,UNIT_TYPE_STRUCTURE) or GetUnitTypeId(Target)=='umtw' or GetUnitTypeId(Target)=='ebal')and(LoadBoolean(hashtable019,(GetHandleId(Source)),('A1IQ'+183))) then
      call NSE(Source,Target)
      call SaveBoolean(hashtable019,(GetHandleId(Source)),('A1IQ'+183),(false))
      call SaveReal(hashtable019,(GetHandleId(Source)),('A1IQ'+184),(((TimerGetElapsed(GlobalTimer)))*1.))
      call UnitRemoveAbility(Source,'A1IS')
      call UnitRemoveAbility(Source,'A1J4')
      call UnitRemoveAbility(Source,'A1J3')
      call UnitRemoveAbility(Source,'A1J5')
      call UnitRemoveAbility(Source,'A1IU')
      call FlushChildHashtable(hashtable019,(GetHandleId((LoadTriggerHandle(hashtable019,(Cache),(35))))))
      call CleanTrigger((LoadTriggerHandle(hashtable019,(Cache),(35))))
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function NUE takes nothing returns boolean
  local trigger t
  local integer Cache
  local unit Target
  local unit Source
  local integer Level
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call SaveBoolean(hashtable019,(GetHandleId(GetTriggerUnit())),('A1IQ'+183),(false))
    call SaveReal(hashtable019,(GetHandleId(GetTriggerUnit())),('A1IQ'+184),(((TimerGetElapsed(GlobalTimer)))*1.))
    call UnitRemoveAbility(GetTriggerUnit(),'A1IS')
    call UnitRemoveAbility(GetTriggerUnit(),'A1J4')
    call UnitRemoveAbility(GetTriggerUnit(),'A1J3')
    call UnitRemoveAbility(GetTriggerUnit(),'A1J5')
    call UnitRemoveAbility(GetTriggerUnit(),'A1IU')
    call FlushChildHashtable(hashtable019,(GetHandleId(GetTriggeringTrigger())))
    call CleanTrigger(GetTriggeringTrigger())
  elseif GetAttacker()==(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(182)))then
    if IsUnitAlly(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false then
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      set Target=GetTriggerUnit()
      set Source=GetAttacker()
      call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
      call TriggerRegisterTimerEvent(t,2.5,false)
      call TriggerAddCondition(t,Condition(function NTE))
      call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
      call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
      call SaveTriggerHandle(hashtable019,(Cache),(35),(GetTriggeringTrigger()))
      //set Level=GetUnitAbilityLevel(GetAttacker(),'A1IQ')
      set Level=GetUnitAbilityLevel(GetAttacker(),'A524')
      if Level==0 then
        call UnitRemoveAbility(GetAttacker(),'A1J4')
        call UnitRemoveAbility(GetAttacker(),'A1J3')
        call UnitRemoveAbility(GetAttacker(),'A1J5')
        call UnitRemoveAbility(GetAttacker(),'A1IU')
      elseif Level==1 then
        call UnitRemoveAbility(GetAttacker(),'A1J3')
        call UnitRemoveAbility(GetAttacker(),'A1J5')
        call UnitRemoveAbility(GetAttacker(),'A1IU')
      elseif Level==2 then
        call UnitRemoveAbility(GetAttacker(),'A1J4')
        call UnitRemoveAbility(GetAttacker(),'A1J5')
        call UnitRemoveAbility(GetAttacker(),'A1IU')
      elseif Level==3 then
        call UnitRemoveAbility(GetAttacker(),'A1J4')
        call UnitRemoveAbility(GetAttacker(),'A1J3')
        call UnitRemoveAbility(GetAttacker(),'A1IU')
      elseif Level==4 then
        call UnitRemoveAbility(GetAttacker(),'A1J4')
        call UnitRemoveAbility(GetAttacker(),'A1J3')
        call UnitRemoveAbility(GetAttacker(),'A1J5')
      endif
      
      set Target=null
      set Source=null
      set t=null
    endif
  endif
  return false
endfunction

function NVE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real YP8=(TimerGetElapsed(GlobalTimer))
  //local integer Level=GetUnitAbilityLevel(Hero,'A1IQ')
  local integer Level=GetUnitAbilityLevel(Hero,'A524')
  local real JSE=(LoadReal(hashtable019,(GetHandleId(Hero)),('A1IQ'+184)))
  local boolean NWE=(LoadBoolean(hashtable019,(GetHandleId(Hero)),('A1IQ'+183)))
  if GetUnitAbilityLevel(Hero,'A1IQ')>0 and GetUnitAbilityLevel(Hero,'A1IQ')!=Level then
    call SetUnitAbilityLevel(Hero,'A1IQ',Level)
  endif
  if YP8-JSE>14-Level*2 and NWE==false and isPlayerPickedAbility(GetOwningPlayer(Hero),(31*4+2)) and IsDead(Hero)==false then
    call SaveBoolean(hashtable019,(GetHandleId(Hero)),('A1IQ'+183),(true))
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
    call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function NUE))
    call SaveUnitHandle(hashtable019,(Cache),(182),(Hero))
    call UnitAddAbility2(Hero,'A1IS')
    if GetUnitAbilityLevel(Hero,'B068')==0 then
      if Level==1 then
        call UnitAddAbility2(Hero,'A1J4')
        call UnitMakeAbilityPermanent(Hero,true,'A1J2')
        if Mode_EB and (GetUnitAbilityLevel(Hero,'A0CY')>0 or GetUnitAbilityLevel(Hero,'QP1K')>0 or (GetUnitAbilityLevel(Hero,'Y315')>0 and IsUnitType(Hero,UNIT_TYPE_MELEE_ATTACKER))) then
          call SetUnitAbilityLevel(Hero,'A1J2',2)
        endif
      elseif Level==2 then
        call UnitAddAbility2(Hero,'A1J3')
        call UnitMakeAbilityPermanent(Hero,true,'A1IT')
        if Mode_EB and (GetUnitAbilityLevel(Hero,'A0CY')>0 or GetUnitAbilityLevel(Hero,'QP1K')>0 or (GetUnitAbilityLevel(Hero,'Y315')>0 and IsUnitType(Hero,UNIT_TYPE_MELEE_ATTACKER))) then
          call SetUnitAbilityLevel(Hero,'A1IT',2)
        endif
      elseif Level==3 then
        call UnitAddAbility2(Hero,'A1J5')
        call UnitMakeAbilityPermanent(Hero,true,'A1J1')
        if Mode_EB and (GetUnitAbilityLevel(Hero,'A0CY')>0 or GetUnitAbilityLevel(Hero,'QP1K')>0 or (GetUnitAbilityLevel(Hero,'Y315')>0 and IsUnitType(Hero,UNIT_TYPE_MELEE_ATTACKER))) then
          call SetUnitAbilityLevel(Hero,'A1J1',2)
        endif
      elseif Level==4 then
        call UnitAddAbility2(Hero,'A1IU')
        call UnitMakeAbilityPermanent(Hero,true,'A1J0')
        if Mode_EB and (GetUnitAbilityLevel(Hero,'A0CY')>0 or GetUnitAbilityLevel(Hero,'QP1K')>0 or (GetUnitAbilityLevel(Hero,'Y315')>0 and IsUnitType(Hero,UNIT_TYPE_MELEE_ATTACKER)))  then
          call SetUnitAbilityLevel(Hero,'A1J0',2)
        endif
      endif
    endif
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A1J4',false)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A1J3',false)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A1J5',false)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A1IU',false)
  elseif NWE==false and GetUnitAbilityLevel(Hero,'B068')==0 then
    call UnitRemoveAbility(Hero,'A1IS')
    call UnitRemoveAbility(Hero,'A1J4')
    call UnitRemoveAbility(Hero,'A1J3')
    call UnitRemoveAbility(Hero,'A1J5')
    call UnitRemoveAbility(Hero,'A1IU')
  endif
  set t=null
  set Hero=null
  return false
endfunction

function Bounty_Jinada_Learn takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call UnitAddAbility2(Hero,'A1IQ')
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function NVE))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveInteger(hashtable019,(Cache),(181),(0))
  set Hero=null
  set t=null
endfunction

function NYE takes nothing returns boolean
  if GetLearnedSkill()=='A524' and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call Bounty_Jinada_Learn()
  endif
  return false
endfunction

function J59 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function NYE))
  set t=null
endfunction

function NZE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=GetUnitAbilityLevel(Source,'A07A')
  if Level<1 then
    set Level=GetUnitAbilityLevel(Source,'QB09')
  endif
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      if((LoadInteger(hashtable019,(GetHandleId((Source))),((2487))))==1)==false then
        call AddTimedKeyToUnit(Source,2487,.5)
        if IsUnitType(Target,UNIT_TYPE_STRUCTURE)==false and IsUnitEnemy(Target,GetOwningPlayer(Source))then
          call DamageTarget(Source,Target,2,30*Level)
          call TextTagOnUnit(I2S(R2I(30*Level)),1,Source,.027,216,0,0,216)
        endif
      endif
    endif
  else
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function NAE takes nothing returns nothing
  local trigger t=CreateTrigger()
  local unit Target=GetTriggerUnit()
  local unit Source=GetAttacker()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(t,2,false)
  call TriggerAddCondition(t,Condition(function NZE))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set Target=null
  set Source=null
  set t=null
endfunction

function NBE takes nothing returns boolean
  local integer Level
  local unit Hero
  if GetTriggerEventId()==EVENT_UNIT_SPELL_CAST or GetTriggerEventId()==EVENT_UNIT_DEATH then
    set Hero=(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(14)))
    //set Level=GetUnitAbilityLevel(Hero,'A1IQ')
    set Level=GetUnitAbilityLevel(GetAttacker(),'A524')
    if(LoadBoolean(hashtable019,(GetHandleId(Hero)),('A1IQ'+183)))then
      set Level=GetUnitAbilityLevel(Hero,'A1IQ')
      if Level==0 then
        call UnitRemoveAbility(Hero,'A1J4')
        call UnitRemoveAbility(Hero,'A1J3')
        call UnitRemoveAbility(Hero,'A1J5')
        call UnitRemoveAbility(Hero,'A1IU')
      elseif Level==1 then
        call UnitRemoveAbility(Hero,'A1J3')
        call UnitRemoveAbility(Hero,'A1J5')
        call UnitRemoveAbility(Hero,'A1IU')
      elseif Level==2 then
        call UnitRemoveAbility(Hero,'A1J4')
        call UnitRemoveAbility(Hero,'A1J5')
        call UnitRemoveAbility(Hero,'A1IU')
      elseif Level==3 then
        call UnitRemoveAbility(Hero,'A1J4')
        call UnitRemoveAbility(Hero,'A1J3')
        call UnitRemoveAbility(Hero,'A1IU')
      elseif Level==4 then
        call UnitRemoveAbility(Hero,'A1J4')
        call UnitRemoveAbility(Hero,'A1J3')
        call UnitRemoveAbility(Hero,'A1J5')
      endif
    else
      call UnitRemoveAbility(Hero,'A1J4')
      call UnitRemoveAbility(Hero,'A1J3')
      call UnitRemoveAbility(Hero,'A1J5')
      call UnitRemoveAbility(Hero,'A1IU')
    endif
    call FlushChildHashtable(hashtable019,(GetHandleId(GetTriggeringTrigger())))
    call CleanTrigger(GetTriggeringTrigger())
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetAttacker()==(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(14)))then
      if((LoadInteger(hashtable019,(GetHandleId((GetAttacker()))),((2488))))==1)==false then
        call FlushChildHashtable(hashtable019,(GetHandleId(GetTriggeringTrigger())))
        call CleanTrigger(GetTriggeringTrigger())
        call NAE()
      endif
      if(LoadBoolean(hashtable019,(GetHandleId(GetAttacker())),('A1IQ'+183)))then
        //set Level=GetUnitAbilityLevel(GetAttacker(),'A1IQ')
        set Level=GetUnitAbilityLevel(GetAttacker(),'A524')
        if Level==0 then
          call UnitRemoveAbility(GetAttacker(),'A1J4')
          call UnitRemoveAbility(GetAttacker(),'A1J3')
          call UnitRemoveAbility(GetAttacker(),'A1J5')
          call UnitRemoveAbility(GetAttacker(),'A1IU')
        elseif Level==1 then
          call UnitRemoveAbility(GetAttacker(),'A1J3')
          call UnitRemoveAbility(GetAttacker(),'A1J5')
          call UnitRemoveAbility(GetAttacker(),'A1IU')
        elseif Level==2 then
          call UnitRemoveAbility(GetAttacker(),'A1J4')
          call UnitRemoveAbility(GetAttacker(),'A1J5')
          call UnitRemoveAbility(GetAttacker(),'A1IU')
        elseif Level==3 then
          call UnitRemoveAbility(GetAttacker(),'A1J4')
          call UnitRemoveAbility(GetAttacker(),'A1J3')
          call UnitRemoveAbility(GetAttacker(),'A1IU')
        elseif Level==4 then
          call UnitRemoveAbility(GetAttacker(),'A1J4')
          call UnitRemoveAbility(GetAttacker(),'A1J3')
          call UnitRemoveAbility(GetAttacker(),'A1J5')
        endif
      else
        call UnitRemoveAbility(GetAttacker(),'A1J4')
        call UnitRemoveAbility(GetAttacker(),'A1J3')
        call UnitRemoveAbility(GetAttacker(),'A1J5')
        call UnitRemoveAbility(GetAttacker(),'A1IU')
      endif
    endif
  else
    set Hero=(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(14)))
    if(LoadBoolean(hashtable019,(GetHandleId(Hero)),('A1IQ'+183)))==false then
      call UnitRemoveAbility(Hero,'A1J4')
      call UnitRemoveAbility(Hero,'A1J3')
      call UnitRemoveAbility(Hero,'A1J5')
      call UnitRemoveAbility(Hero,'A1IU')
    endif
    call FlushChildHashtable(hashtable019,(GetHandleId(GetTriggeringTrigger())))
    call CleanTrigger(GetTriggeringTrigger())
  endif
  set Hero=null
  return false
endfunction

function Bounty_Windwalk takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=GetSpellTargetUnit()
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,GetSpellAbilityId())
  call AddTimedKeyToUnit(Source,2488,1.25-.25*Level-.01)
  call TriggerRegisterTimerEvent(t,10+5*Level,false)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_CAST)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function NBE))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call UnitAddAbility2(Source,'A1J4')
  call UnitAddAbility2(Source,'A1J3')
  call UnitAddAbility2(Source,'A1J5')
  call UnitAddAbility2(Source,'A1IU')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1J4',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1J3',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1J5',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1IU',false)
  set t=null
  set Target=null
  set Source=null
endfunction

function Bounty_ShurikenToss_Hit takes nothing returns nothing
  local unit caster=tt_unit1
  local unit target=tt_unit2
  local unit d
  local group g
  local group tg
  local unit u
  local integer jumpsleft
  local real dmg=0.
  local integer lvl
  local boolean bounce=false
  if LoadUnitHandle(MHT,GetHandleId(tt_unit1),'A004'+1)!=null then
    set caster=LoadUnitHandle(MHT,GetHandleId(tt_unit1),'A004'+1)
    set bounce=true
    call RemoveSavedHandle(MHT,GetHandleId(tt_unit1),'A004'+1)
  endif
  set g=LoadGroupHandle(MHT,GetHandleId(caster),'A004')
  set jumpsleft=LoadInteger(MHT,GetHandleId(caster),'A004')
  set lvl=GetUnitAbilityLevel(caster,'A004')
  set d=CreateUnit(GetOwningPlayer(target),'e00E',GetUnitX(target),GetUnitY(target),0)
  call UnitAddAbility(d,'A33J')
  call IssueTargetOrder(d,"thunderbolt",target)
  call GroupAddUnit(g,target)
  if bounce then
    set dmg=25+50*lvl
  else
    if lvl==1 then
      set dmg=125.
    elseif lvl==2 then
      set dmg=175.
    elseif lvl==3 then
      set dmg=250.
    else
      set dmg=325.
    endif
  endif
  call DamageTarget(caster,target,1,dmg)
  
  if jumpsleft>0 then
    set tg=GetAvailableGroup()
    set tt_unit1=caster
    call GroupEnumUnitsInRange(tg,GetUnitX(target),GetUnitY(target),425,Condition(function NonImmuneVisibleEnemyFilter))
    call GroupRemoveGroup(g,tg)//remove already hit units
    set u=FirstOfGroup(tg)
    if u!=null then
      call AddProjectile(target,u,'h02K',"Bounty_ShurikenToss_Hit",1000,true)
      call SaveUnitHandle(MHT,GetHandleId(target),'A004'+1,caster)
      call SaveInteger(MHT,GetHandleId(caster),'A004',jumpsleft-1)
    else
      call KillGroup(g)
      call RemoveSavedInteger(MHT,GetHandleId(caster),'A004')
      call RemoveSavedHandle(MHT,GetHandleId(caster),'A004')
      
    endif
    call KillGroup(tg)
    set tg=null
  else
    call KillGroup(g)
    call RemoveSavedInteger(MHT,GetHandleId(caster),'A004')
    call RemoveSavedHandle(MHT,GetHandleId(caster),'A004')
    
  endif
  
  set caster=null
  set target=null
  set d=null
  set u=null
  set g=null
  set tg=null
endfunction

function Bounty_ShurikenToss takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call AddProjectile(GetTriggerUnit(),GetSpellTargetUnit(),'h02K',"Bounty_ShurikenToss_Hit",1000,true)
    call SaveInteger(MHT,GetHandleId(GetTriggerUnit()),'A004',GetUnitAbilityLevel(GetTriggerUnit(),'A004')-1)
    call SaveGroupHandle(MHT,GetHandleId(GetTriggerUnit()),'A004',GetAvailableGroup())
  endif
endfunction


function Bristleback_Warpath_Remove takes unit u returns nothing
  local integer loopA = 0
  
  
  call UnitRemoveAbility(u,'E000')
  call UnitRemoveAbility(u,'E001')
  call UnitRemoveAbility(u,'E002')
  call UnitRemoveAbility(u,'E003')
  call UnitRemoveAbility(u,'E004')
endfunction

function Bristleback_Warpath_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer load = LoadInteger(MHT,info,0)
  local integer count = LoadInteger(MHT,load,'A0FV')-1
  local unit u = LoadUnitHandle(MHT,info,0)
  local integer oldspeed=LoadInteger(MHT,GetHandleId(u),'WARP')
  local integer speed
  local integer level=LoadInteger(MHT,GetHandleId(u),'WARL')
  local integer i=R2I(0.5*level*level+0.5*level+4)
  //call Bristleback_Warpath_Remove(u)
  if oldspeed>0 then
    call SubBonusMSPercent(u,oldspeed)
  endif
  set speed=i+(count)*level
  if(count>0)then
    call AddBonusMSPercent(u,speed)
    call SaveInteger(MHT,GetHandleId(u),'WARP',speed)
  else
    call SaveInteger(MHT,GetHandleId(u),'WARP',0)
    call UnitRemoveAbility(u,'A30P')
  endif
  
  call SaveInteger(MHT,load,'A0FV',count)
  call LoDStat_Sub(u,LoadInteger(MHT,info,1),"damage")
  
  call Timer_End(t)
  
  set t = null
  set u = null
endfunction

function Bristleback_Warpath_Start takes unit u, integer level returns nothing
  local timer t = null
  local integer save
  local integer speed
  local integer damage
  local integer info = GetHandleId(u)
  local integer count = LoadInteger(MHT,info,'A0FV')+1
  local integer i
  local integer oldspeed
  set damage = 15 + 5*level
  set i=R2I(0.5*level*level+0.5*level+4)
  if count==5+level then
    return
  endif
  set t = Timer_Get()
  set save = GetHandleId(t)
  set speed=i+(count-1)*level
  //set speed = count + (level-1)*5 - 1
  if LoadInteger(MHT,info,'WARP')>0 then
    call SubBonusMSPercent(u,LoadInteger(MHT,info,'WARP'))
  endif
  //call Bristleback_Warpath_Remove(u)
  call LoDStat_Add(u,damage,"damage")
  //call UnitAddAbility2(u,'A50A'+speed)
  call SaveInteger(MHT,info,'A0FV',count)
  call SaveInteger(MHT,info,'WARP',speed)
  call SaveInteger(MHT,info,'WARL',level)
  call AddBonusMSPercent(u,speed)
  call SaveUnitHandle(MHT,save,0,u)
  call SaveInteger(MHT,save,0,info)
  call SaveInteger(MHT,save,1,damage)
  call TimerStart(t,14.,false,function Bristleback_Warpath_End)
  call UnitAddAbility2(u,'A30P')
  call UnitMakeAbilityPermanent(u,true,'A0EF')
  
  set t = null
endfunction

function Bristleback_Warpath_Condition takes unit u, integer spell returns nothing
  local integer level = GetUnitAbilityLevel(u,'A0FV')+GetUnitAbilityLevel(u,'QP1N')
  
  if level>0 and (spell=='A0FW' or spell=='A0GP' or Valid_Spell(spell)) then
    call Bristleback_Warpath_Start(u,level)
  endif
endfunction


function integer514 takes nothing returns boolean
  return GetSpellAbilityId()=='A0GP'
endfunction

function integers070 takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and GetUnitAbilityLevel(GetFilterUnit(),'A04R')!=1)!=null
endfunction

function boolean151 takes nothing returns nothing
  local integer OJE=GetHandleId(GetEnumUnit())
  local integer integers071=(LoadInteger(hashtable019,(E78),(OJE)))
  local real Damage=RMinIF(TmpReal378+integers071*30,400)
  
  call DamageTarget(TmpUnit376,GetEnumUnit(),2,Damage)
  call SaveInteger(hashtable019,(E78),(OJE),(integers071+1))
endfunction

function integer515 takes nothing returns nothing
  local integer OJE=GetHandleId(GetEnumUnit())
  local integer integers071=(LoadInteger(hashtable019,(E78),(OJE)))
  call SaveInteger(hashtable019,(E78),(OJE),(integers071-1))
endfunction

function ONE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit XX8=(LoadUnitHandle(hashtable019,(Cache),(221)))
  local group HQ9=(LoadGroupHandle(hashtable019,(Cache),(317)))
  set E78=GetHandleId(XX8)
  call ForGroup(HQ9,function integer515)
  call KillGroup(HQ9)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set XX8=null
  set HQ9=null
  return false
endfunction

function timer007 takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local group HQ9=GetAvailableGroup()
  local trigger t=CreateTrigger()
  if IsUnitType(XX8,UNIT_TYPE_HERO)==false and GetUnitUserData(XX8)!=1 then
    set XX8=udg_Hero[GetPlayerId(GetOwningPlayer(XX8))]
  endif
  call GroupEnumUnitsInRange(HQ9,GetUnitX(XX8),GetUnitY(XX8),650,Condition(function integers070))
  set TmpUnit376=CreateUnit(GetOwningPlayer(XX8),'e00E',GetUnitX(XX8),GetUnitY(XX8),0)
  set TmpReal378=GetUnitAbilityLevel(XX8,'A0GP')*20
  set E78=GetHandleId(XX8)
  call ForGroup(HQ9,function boolean151)
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(221),(XX8))
  call SaveGroupHandle(hashtable019,(GetHandleId(t)),(317),(HQ9))
  call TriggerRegisterTimerEvent(t,14,false)
  call TriggerAddCondition(t,Condition(function ONE))
  set XX8=null
  set HQ9=null
  set t=null
endfunction

function K99 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function integer514))
  call TriggerAddAction(t,function timer007)
  set t=null
endfunction

function Trig_Goo_Func001Func001001002 takes nothing returns boolean
  return(GetUnitTypeId(GetFilterUnit())=='e02E')
endfunction

function integer518 takes nothing returns nothing
  call KillUnit(GetEnumUnit())
endfunction

function integer513 takes nothing returns boolean
  return(GetUnitTypeId(GetFilterUnit())=='e02E')
endfunction

function OSE takes nothing returns boolean
  return(GetUnitUserData(GetEnumUnit())==4)
endfunction

function OTE takes nothing returns nothing
  local location YT9=GetUnitLoc(GetTriggerUnit())
  call SetUnitPositionLoc(GetEnumUnit(),YT9)
  if(OSE())then
    call IssueTargetOrderById(GetEnumUnit(),852662,GetSpellTargetUnit())
  else
    call IncUnitAbilityLevel(GetEnumUnit(),'A0FZ')
    call IssueTargetOrderById(GetEnumUnit(),852662,GetSpellTargetUnit())
    call SetUnitUserData(GetEnumUnit(),(GetUnitUserData(GetEnumUnit())+1))
  endif
  call RemoveLocation(YT9)
  set YT9=null
endfunction

function integers069 takes nothing returns nothing
  local location YT9=GetUnitLoc(GetTriggerUnit())
  local location OVE=GetUnitLoc(GetSpellTargetUnit())
  local group OWE=GetAvailableGroup()
  if(UnitHasBuffBJ(GetSpellTargetUnit(),'B02U'))then
    call GroupEnumUnitsOfPlayer(OWE,GetOwningPlayer(GetSpellTargetUnit()),Condition(function integer513))
    call ForGroupBJ(OWE,function OTE)
  else
    call GroupEnumUnitsOfPlayer(OWE,GetOwningPlayer(GetSpellTargetUnit()),Condition(function integer513))
    call ForGroupBJ(OWE,function integer518)
    call DisableTrigger(unit002)
    call CreateNUnitsAtLocFacingLocBJ(1,'e02E',GetOwningPlayer(GetSpellTargetUnit()),YT9,OVE)
    call EnableTrigger(unit002)
    call UnitAddAbility(bj_lastCreatedUnit,'A0FZ')
    call SetUnitAbilityLevelSwapped('A0FZ',bj_lastCreatedUnit,((GetUnitAbilityLevelSwapped('A0FW',GetTriggerUnit())*4)-3))
    call IssueTargetOrderById(bj_lastCreatedUnit,852662,GetSpellTargetUnit())
    call SetUnitUserData(bj_lastCreatedUnit,1)
  endif
  call KillGroup(OWE)
  call RemoveLocation(YT9)
  call RemoveLocation(OVE)
  set OWE=null
  set YT9=null
  set OVE=null
endfunction

function BB_Goo takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call integers069()
  endif
endfunction


function BB_Bristleback_Check takes nothing returns boolean
  return (GetLearnedSkill()=='A0M3' or GetLearnedSkill()=='QP1M') and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1
endfunction

function OZE takes unit Hero returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',GetUnitX(Hero),GetUnitY(Hero),0)
  call SetUnitUserData(Caster,1)
  call UnitAddAbility2(Caster,'A0GP')
  if GetUnitAbilityLevel(Hero,'A0GP')>0 then
    call SetUnitAbilityLevel(Caster,'A0GP',GetUnitAbilityLevel(Hero,'A0GP'))
  else
    call SetUnitAbilityLevel(Caster,'A0GP',4)
  endif
  //call SetUnitAbilityLevel(Caster,'A0GP',GetUnitAbilityLevel(Hero,'A0M3'))
  call IssueImmediateOrderById(Caster,852526)
  set Caster=null
endfunction

function integer517 takes unit Hero,real damage returns nothing
  local integer Cache=GetHandleId(Hero)
  local real E89 = LoadReal(hashtable019,Cache,278) + damage
  if E89 > 250 then
    call SaveReal(hashtable019,Cache,278,E89 - 250)
    call OZE(Hero)
  else
    call SaveReal(hashtable019,Cache,278,E89)
  endif
endfunction

function BB_Bristleback_Act takes nothing returns boolean
  local unit Hero=GetTriggerUnit()
  local unit Attacker=GetEventDamageSource()
  local real integers073=GetAngleBetweenUnits(Attacker,Hero)
  local real HFace=GetUnitFacing(Hero)
  local real OLE
  local real Damage=GetEventDamage()
  local real hp
  local real finalAngle
  local real life = GetWidgetLife(Hero)
  if(Damage>5)and life>0.405 and IsRealDamage and GetUnitAbilityLevel(Hero,'BNdo')==0 then
    if((HFace-integers073)<(-180.))then
      set OLE=(HFace-integers073+360)
    else
      if((HFace-integers073)>180.)then
        set OLE=(HFace-integers073-360)
      else
        set OLE=(HFace-integers073)
      endif
    endif
    set finalAngle=RAbsBJ(OLE)
    
    if finalAngle<=70 then
      set hp=(IMaxIF(GetUnitAbilityLevel(Hero,'A0M3'),GetUnitAbilityLevel(Hero,'QP1M'))*.08+.08)*Damage
      call integer517(Hero,Damage-hp)
      call HealUnitFor(Hero,hp)
    elseif finalAngle<=110 then
      set hp=(IMaxIF(GetUnitAbilityLevel(Hero,'A0M3'),GetUnitAbilityLevel(Hero,'QP1M'))*.04+.04)*Damage
      call HealUnitFor(Hero,hp)
    endif
  endif
  set Hero=null
  set Attacker=null
  return false
endfunction

function Bristleback_Bristleback_Learn takes nothing returns nothing
  local trigger t = CreateTrigger()
  
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function BB_Bristleback_Act))
  
  set t = null
endfunction

function BB_Bristleback_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function BB_Bristleback_Check))
  call TriggerAddAction(t,function Bristleback_Bristleback_Learn)
  set t = null
endfunction




function integers074 takes nothing returns boolean
  return GetUnitAbilityLevel(GetTriggerUnit(),'P123')>0 and GetUnitAbilityLevel(GetAttacker(),'A04R')!=1 and IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))==false and GetUnitTypeId(GetAttacker())!='n0F5' //A00V
endfunction

function integers076 takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetAttacker()
  local integer Level=GetUnitAbilityLevel(Source,'P123') //A00V
  local integer P4E=GetHeroStr(Source,true)
  local real Damage=(14+2*Level)+(.18+.08*Level)*P4E
  if GetUnitAbilityLevel(Source,'A1HX')==0 then
    call DamageTarget(Source,Target,2,Damage)
  endif
  set Source=null
  set Target=null
endfunction

function Centaur_Return_Learning takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function integers074))
  call TriggerAddAction(t,function integers076)
  set t=null
endfunction


function Stampede_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local unit u = group_temp_unit[0]
  local group g = LoadGroupHandle(hashtable019,group_temp_integer[0],1)
  
  if IsUnitInGroup(t,g)==false and IsUnitEnemy(u,GetOwningPlayer(t)) and IsDead(t)==false and IsMagicImmune(t)==false and GetUnitAbilityLevel(t,'A04R')==0 and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(t)!='n00L' then
    call GroupAddUnit(g,t)
    call Buff_Add(t,LoDBuff_AbilID[17],LoDBuff_BuffID[17],1.0+0.5*GetUnitAbilityLevel(u,'A2O4'))
    call DamageTarget(u,t,1,group_temp_integer[1])
  endif
  
  set g = null //dat gut :3
  set u = null
  set t = null
  return false
endfunction

function Stampede_Duration takes nothing returns boolean
  local trigger trig = GetTriggeringTrigger()
  local integer info = GetHandleId(trig)
  local integer count = LoadInteger(hashtable019,info,0)
  local unit u = LoadUnitHandle(hashtable019,info,0)
  local group g = LoadGroupHandle(hashtable019,info,1)
  
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or count==76 then
    call SetUnitPathing(u,true)
    call UnitRemoveAbility(u,'A2O4')
    call UnitRemoveAbility(u,'B0GB')
    
    call DestroyEffect(LoadEffectHandle(hashtable019,info,3))
    call DestroyEffect(LoadEffectHandle(hashtable019,info,2))
    call KillGroup(g)
    
    call FlushChildHashtable(hashtable019,info)
    call CleanTrigger(trig)
    
    set trig = null
    set u = null
    set g = null
    return false
  endif
  
  //set tt_unit1=u // I don't know if this is needed :S :Z /( .__.)/ \(.-.)/ \(.__. )\
  //its not, but da comment is too awesome to remove :D
  
  set group_temp_unit[0] = u
  set group_temp_integer[0] = info
  set group_temp_integer[1] = LoadInteger(hashtable019,info,1)*GetHeroMainStatValue(u)
  call SaveInteger(hashtable019,info,0,count+1)
  call GroupEnumUnitsInRange(temp_group,GetWidgetX(u),GetWidgetY(u),175,Condition(function Stampede_Targets))
  
  set trig = null
  set u = null
  set g = null
  return false
endfunction

function Stampede_Start takes unit u, integer lvl returns nothing
  local trigger trig = CreateTrigger()
  local integer info = GetHandleId(trig)
  
  call SetUnitPathing(u,false)
  call UnitAddAbility2(u,'A2O4')
  call SetUnitAbilityLevel(u,'A2O4',lvl)
  
  call TriggerRegisterTimerEvent(trig,0.05,true)
  call TriggerRegisterDeathEvent(trig,u)
  call TriggerAddCondition(trig,Condition(function Stampede_Duration))
  
  call SaveUnitHandle(hashtable019,info,0,u)
  call SaveGroupHandle(hashtable019,info,1,GetAvailableGroup())
  call SaveEffectHandle(hashtable019,info,2,AddSpecialEffectTarget("war3mapImported\\SandBreathDamageSmall.mdx",u,GetProperAttachPoint_Foot(u)))
  call SaveEffectHandle(hashtable019,info,3,AddSpecialEffectTarget("war3mapImported\\SandBreathDamageSmall.mdx",u,GetProperAttachPoint_Foot(u)))
  
  call SaveInteger(hashtable019,info,0,0)
  call SaveInteger(hashtable019,info,1,3)
  
  set trig = null
endfunction

function Stampede_Allies takes nothing returns boolean
  local unit t = GetFilterUnit()
  local unit u = group_temp_unit[0]
  
  if (IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO))!=null and IsUnitAlly(u,GetOwningPlayer(t)) and IsDead(t)==false then
    call Stampede_Start(t,GetUnitAbilityLevel(u,'A2O6'))
  endif
  
  set t = null
  set u = null
  return false
endfunction

function Stampede_Cast takes nothing returns nothing
  local sound s = CreateSound("abilities\\Spells\\Other\\Stampede\\StampedeCaster1.wav",false,false,false,10,10,"DefaultEAXON")
  
  call StartSound(s)
  call KillSoundWhenDone(s)
  
  set group_temp_unit[0] = GetTriggerUnit()
  set group_temp_integer[0] = GetUnitAbilityLevel(group_temp_unit[0],'A2O6')
  call GroupEnumUnitsInRange(temp_group,0,0,99999,Condition(function Stampede_Allies))
  
  set s = null
endfunction

function Stampede_Condition takes nothing returns boolean
  if GetSpellAbilityId()=='A2O6' then
    call Stampede_Cast()
  endif
  return false
endfunction

function Stampede_Init takes nothing returns nothing
  //local trigger t = CreateTrigger()
  local sound s = CreateSound("abilities\\Spells\\Other\\Stampede\\StampedeCaster1.wav",false,false,false,10,10,"DefaultEAXON")
  
  call StartSound(s)
  call KillSoundWhenDone(s)
  
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Stampede_Condition))
  
  set s = null
  //set t = null
endfunction


function Double_Edge_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local unit u = DoubleEdgeCaster
  
  if IsUnitEnemy(u,GetOwningPlayer(t)) and IsDead(t)==false and IsMagicImmune(t)==false and GetUnitAbilityLevel(t,'A04R')==0 and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false then
    call DamageTarget(u,t,1,DoubleEdgeDamage)
  endif
  
  set u = null
  set t = null
  return false
endfunction

function Double_Edge_Start takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local unit t = GetSpellTargetUnit()
  local real x = GetWidgetX(t)
  local real y = GetWidgetY(t)
  local group g=GetAvailableGroup()
  set DoubleEdgeCaster = u
  //set group_temp_integer[0] = 100 + GetUnitAbilityLevel(u,'A00L')*75
  set DoubleEdgeDamage=100 + GetUnitAbilityLevel(u,'A00L')*75
  call GroupEnumUnitsInRange(g,x,y,215,Condition(function Double_Edge_Targets))
  call DestroyEffect(AddSpecialEffect("war3mapImported\\DoubleEdgeTarget.mdx",x,y))
  if GetWidgetLife(u)<DoubleEdgeDamage*.75 then
    set DoubleEdgeDamage = R2I(GetWidgetLife(u)/.75) - 10
  endif
  call DamageTarget(u,u,1,DoubleEdgeDamage)
  call KillGroup(g)
  set g=null
  set u = null
  set t = null
endfunction

function Double_Edge_Condtionsup takes nothing returns nothing
  call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\DoubleEdgeCaster.mdx",GetTriggerUnit(),"hand, right"))
endfunction

function Chen_Teleport_End takes nothing returns nothing
  local trigger t = GetTriggeringTrigger()
  local integer h = GetHandleId(t)
  local unit u = LoadUnitHandle(MHT,h,0)
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT then
    if IsPurge(GetSpellAbilityId()) and GetSpellTargetUnit()==u then
      call DestroyEffect(LoadEffectHandle(MHT,h,1))
      call FlushChildHashtable(MHT,h)
      call CleanTrigger(t)
    endif
  else
    call SetUnitX(u,LoadReal(MHT,h,0))
    call SetUnitY(u,LoadReal(MHT,h,1))
    call DestroyEffect(LoadEffectHandle(MHT,h,1))
    call FlushChildHashtable(MHT,h)
    call CleanTrigger(t)
  endif
  set t = null
  set u = null
endfunction

function Chen_Teleport_Start takes unit u, real x, real y, integer lvl returns nothing
  local trigger t = CreateTrigger()
  local integer h = GetHandleId(t)
  local integer delay=7-lvl
  
  call SaveUnitHandle(MHT,h,0,u)
  call SaveEffectHandle(MHT,h,1,AddSpecialEffectTarget("effects\\Test_of_Faith_FX.mdx",u,"overhead"))
  call SaveReal(MHT,h,0,x)
  call SaveReal(MHT,h,1,y)
  call TriggerRegisterTimerEvent(t,delay,false)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function Chen_Teleport_End))
  
  
  set t = null
endfunction

function Chen_Teleport_Condition takes nothing returns nothing
  local unit u = GetSpellTargetUnit()
  local player p = GetOwningPlayer(u)
  local integer cha= GetUnitAbilityLevel(GetTriggerUnit(),'A2MC')
  local real x
  local real y
  
  if IsSentinel(p)then
    set x = GetRectCenterX(gg_rct_Hero_Creation_NE)
    set y = GetRectCenterX(gg_rct_Hero_Creation_NE)
  else
    set x = GetRectCenterX(gg_rct_Hero_Creation_UD)
    set y = GetRectCenterX(gg_rct_Hero_Creation_UD)
  endif
  
  if IsUnitType(u,UNIT_TYPE_HERO)and p!=GetOwningPlayer(GetTriggerUnit())then
    if LoadBoolean(hashtable019,GetHandleId(u),80) then
      call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n036'))
    elseif LoadBoolean(hashtable019,GetHandleId(p),139)==false then
      call Chen_Teleport_Start(u,x,y,cha)
    endif
    
    set u = null
    return
  endif
  
  call SetUnitX(u,x)
  call SetUnitY(u,y)
  
  set p=null
  set u = null
endfunction
function Chen_Teleport_Check takes nothing returns nothing
  local player p = GetOwningPlayer(GetTriggerUnit())
  
  if IsPlayerEnemy(p,GetOwningPlayer(GetSpellTargetUnit())) then
    call Error(p,"Unable to target enemy units")
    call InterruptUnit(GetTriggerUnit())
    return
  endif
  set p=null
endfunction


function Chen_Test_Start takes unit t returns nothing
  local unit u = GetTriggerUnit()
  local integer level = GetUnitAbilityLevel(u,'A0LV')
  local integer damage =0
  if level==4 then
    set damage=GetRandomInt(275,400)
  elseif level==3 then
    set damage=GetRandomInt(225,300)
  elseif level==2 then
    set damage=GetRandomInt(125,200)
  elseif level==1 then
    set damage=GetRandomInt(75,150)
  endif
  call DamageTarget(u,t,3,damage)
  call TextTagOnUnit(I2S(damage),1,t,0.023,255,255,0,216)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl",t,"chest"))
  
  set u = null
endfunction

function Chen_Test_Condition takes nothing returns nothing
  local unit t = GetSpellTargetUnit()
  
  if IsBlocked(t)==false then
    call Chen_Test_Start(t)
  endif
  
  set t = null
endfunction

function Chen_Test_Learn takes nothing returns nothing
  local unit u = GetTriggerUnit()
  
  if GetUnitAbilityLevel(u,'A2MC')==0 then
    call UnitAddAbility2(u,'A2MC')
  endif
  call SetUnitAbilityLevel(u,'A2MC',GetUnitAbilityLevel(u,'A0LV'))
  
  set u = null
endfunction

function Chen_Pursuasion_Check takes nothing returns nothing
  local player p = GetOwningPlayer(GetTriggerUnit())
  
  if p==GetOwningPlayer(GetSpellTargetUnit()) then
    call Error(p,"Already Persuaded!")
    call InterruptUnit(GetTriggerUnit())
    return
  endif
  
  set p=null
endfunction


function integer520 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamage()>10 then
      if IsRealDamage then
        call DisableTrigger(t)
        call DamageTarget(GetEventDamageSource(),GetTriggerUnit(),2,GetEventDamage()*.08*Level)
        call EnableTrigger(t)
      endif
    endif
  else
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  return false
endfunction

function Chen_Penitence takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=GetSpellTargetUnit()
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A0KM')
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl",Source,"chest"))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call TriggerRegisterTimerEvent(t,7,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function integer520))
  set t=null
  set Target=null
  set Source=null
endfunction

function boolean152 takes nothing returns boolean
  return(GetSpellAbilityId()=='A069')
endfunction

function PRE takes nothing returns boolean
  if(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==false)then
    if(IsDead(GetFilterUnit())==false)then
      if IsCourier(GetFilterUnit())==false then
        if(GetUnitTypeId(GetFilterUnit())!='ncop')then
          if(GetUnitAbilityLevel(GetFilterUnit(),'Aeth')==1)then
            if((GetUnitAbilityLevel(GetFilterUnit(),'A0KO')==1)or(GetUnitAbilityLevel(GetFilterUnit(),'A0KQ')==1)or(GetUnitAbilityLevel(GetFilterUnit(),'A0KR')==1)or(GetUnitAbilityLevel(GetFilterUnit(),'A0KP')==1))then
              return true
            endif
          endif
        endif
      endif
    endif
  endif
  return false
endfunction

function PSE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit PFE=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer PTE=(LoadInteger(hashtable019,(Cache),(157)))
  local group HQ9=GetAvailableGroup()
  local unit YGD
  call GroupEnumUnitsOfPlayer(HQ9,GetOwningPlayer(PFE),Condition(function PRE))
  loop
    exitwhen(CountUnitsInGroup(HQ9)<=PTE)
    
    set YGD=GroupPickRandomUnit(HQ9)
    call GroupRemoveUnit(HQ9,YGD)
    call KillUnit(YGD)
  endloop
  call KillGroup(HQ9)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set PFE=null
  set t=null
  set HQ9=null
  set YGD=null
  return false
endfunction

function integers077 takes nothing returns nothing
  local unit PVE=GetSpellTargetUnit()
  local unit PFE=GetTriggerUnit()
  local integer integer519=GetUnitAbilityLevel(PFE,'A069')
  local integer PTE=1
  local integer playerid=GetPlayerId(GetOwningPlayer(PFE))
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer p=GetPlayerId(GetOwningPlayer(PVE))
  if p>-1 and p<7 then
    call UnitShareVision(PVE,Scourges[0],false)
    call UnitShareVision(PVE,Scourges[1],false)
    call UnitShareVision(PVE,Scourges[2],false)
    call UnitShareVision(PVE,Scourges[3],false)
    call UnitShareVision(PVE,Scourges[4],false)
    call UnitShareVision(PVE,Scourges[5],false)
  else
    call UnitShareVision(PVE,Sentinels[0],false)
    call UnitShareVision(PVE,Sentinels[1],false)
    call UnitShareVision(PVE,Sentinels[2],false)
    call UnitShareVision(PVE,Sentinels[3],false)
    call UnitShareVision(PVE,Sentinels[4],false)
    call UnitShareVision(PVE,Sentinels[5],false)
  endif
  call YZ8(PVE)
  if(integer519==1)then
    call UnitAddAbility2(PVE,'A0KO')
  endif
  if(integer519==2)then
    call UnitAddAbility2(PVE,'A0KQ')
  endif
  if(integer519==3)then
    set PTE=2
    call UnitAddAbility2(PVE,'A0KR')
  endif
  if(integer519==4)then
    set PTE=3
    call UnitAddAbility2(PVE,'A0KP')
  endif
  call UnitAddAbility2(PVE,'Aeth')
  call UnitAddAbility2(PVE,'A12G')
  call SaveUnitHandle(hashtable019,(Cache),(2),(PFE))
  call SaveInteger(hashtable019,(Cache),(157),(PTE))
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function PSE))
  set t=null
  set PVE=null
  set PFE=null
endfunction

function PWE takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster
  if IsUnitEnemy(Target,GetOwningPlayer(Source))then
    set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
    call UnitAddAbility(Caster,'A069')
    call SetUnitAbilityLevel(Caster,'A069',GetUnitAbilityLevel(Source,'A28T'))
    call IssueTargetOrderById(Caster,852581,Target)
  endif
  set Source=null
  set Target=null
  set Caster=null
endfunction

function real074 takes nothing returns boolean
  if GetSpellAbilityId()=='A28T' and IsBlocked(GetSpellTargetUnit())==false then
    call PWE()
  endif
  return false
endfunction

function Chen_HolyPersuation takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call PWE()
  endif
endfunction

function PYE takes nothing returns boolean
  if GetSpellAbilityId()=='A28T' then
    if IsUnitEnemy(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit())) then
      if IsUnitType(GetSpellTargetUnit(),UNIT_TYPE_HERO) or IsUnitIllusion(GetSpellTargetUnit())then
        call InterruptUnit(GetTriggerUnit())
        call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n0K9'))
      endif
    endif
  endif
  return false
endfunction

function Chen_HolyPersuation_OnCast takes nothing returns nothing
  if IsUnitEnemy(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit())) then
    if IsUnitType(GetSpellTargetUnit(),UNIT_TYPE_HERO) or IsUnitIllusion(GetSpellTargetUnit())then
      call InterruptUnit(GetTriggerUnit())
      call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n0K9'))
    endif
  endif
endfunction

function Func1143 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function boolean152))
  call TriggerAddAction(t,function integers077)
  set t=null
endfunction

function unit048 takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>1)!=null
endfunction

function Chen_HandOfGod takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local integer integer519=GetUnitAbilityLevel(XX8,'A0LT')
  local group HQ9=GetAvailableGroup()
  local unit YGD
  if integer519==0 then
    set integer519=GetUnitAbilityLevel(XX8,'A1CS')
  endif
  call GroupEnumUnitsInRect(HQ9,bj_mapInitialPlayableArea,Condition(function unit048))
  loop
    set YGD=FirstOfGroup(HQ9)
    exitwhen YGD==null
    if(IsUnitAlly(YGD,GetOwningPlayer(XX8)))then
      call SetWidgetLife(YGD,(GetUnitStateSwap(UNIT_STATE_LIFE,YGD)+100+(100*integer519)))
      call DestroyEffect(AddSpecialEffectTargetUnitBJ("chest",YGD,"Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl"))
    endif
    call GroupRemoveUnit(HQ9,YGD)
  endloop
  call KillGroup(HQ9)
  set HQ9=GetAvailableGroup()
  set bj_groupEnumOwningPlayer=GetOwningPlayer(XX8)
  call GroupEnumUnitsInRect(HQ9,GetWorldBounds(),filterGetUnitsInRectOfPlayer)
  loop
    set YGD=FirstOfGroup(HQ9)
    exitwhen YGD==null
    if(IsUnitType(YGD,UNIT_TYPE_HERO)==false and GetUnitTypeId(YGD)!='n00C')then
      call SetUnitLifePercentBJ(YGD,100)
      call DestroyEffect(AddSpecialEffectTargetUnitBJ("chest",YGD,"Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl"))
    endif
    call GroupRemoveUnit(HQ9,YGD)
  endloop
  call KillGroup(HQ9)
  set HQ9=null
  set XX8=null
  set YGD=null
endfunction

function PCE takes nothing returns nothing
  if IsCourier(GetEnumUnit())==false then
    call DamageTarget(E98,GetEnumUnit(),1,E88)
  endif
endfunction

function P3E takes unit Source,real x,real y returns nothing
  local real x1
  local real y1
  local group g=GetAvailableGroup()
  local integer Level=GetUnitAbilityLevel(Source,'A0Z6')
  local real Damage=40+40*Level
  set tt_unit1=Source
  set E98=Source
  set E88=Damage
  call GroupEnumUnitsInRange(g,x,y,600,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function PCE)
  call KillGroup(g)
  set x1=x
  set y1=y
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x1,y1))
  set x1=x+200
  set y1=y+200
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x1,y1))
  set x1=x+200
  set y1=y-200
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x1,y1))
  set x1=x-200
  set y1=y+200
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x1,y1))
  set x1=x-200
  set y1=y-200
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x1,y1))
  call TimedReveal(GetOwningPlayer(Source),10,x,y,600)
  set g=null
endfunction

function P6E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(189)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(190)))
  local real AO8=SafeX50(SourceX+30*Cos(J2E))
  local real AP8=SafeY50(SourceY+30*Sin(J2E))
  local real PLE
  local real P1E
  call SetUnitX(Projectile,AO8)
  call SetUnitY(Projectile,AP8)
  call SaveReal(hashtable019,(Cache),(189),((AO8)*1.))
  call SaveReal(hashtable019,(Cache),(190),((AP8)*1.))
  if DistanceBetweenXY(TargetX,TargetY,AO8,AP8)<=35 then
    call KillUnit(Projectile)
    set Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
    call P3E(Hero,AO8,AP8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Hero=null
  set Projectile=null
  return false
endfunction

function Clockwerk_RocketFlare takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local real SourceX=SafeX50(GetUnitX(Hero))
  local real SourceY=SafeY50(GetUnitY(Hero))
  local real TargetX=SafeX50(GetSpellTargetX())
  local real TargetY=SafeY50(GetSpellTargetY())
  local real J2E=Atan2(TargetY-SourceY,TargetX-SourceX)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=CreateUnit(GetOwningPlayer(Hero),'h03Y',SourceX,SourceY,J2E*bj_RADTODEG)
  call SetUnitFacing(Projectile,J2E*bj_RADTODEG)
  call SetUnitPathing(Projectile,false)
  call UnitAddAbility2(Projectile,'Aloc')
  call ShowUnit(Projectile,false)
  call UnitRemoveAbility(Projectile,'Aloc')
  call ShowUnit(Projectile,true)
  call SaveReal(hashtable019,(Cache),(191),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(192),((SourceY)*1.))
  call SaveReal(hashtable019,(Cache),(189),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(190),((SourceY)*1.))
  call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
  call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call TriggerRegisterTimerEvent(t,.025,true)
  call TriggerAddCondition(t,Condition(function P6E))
  set Hero=null
  set t=null
  set Projectile=null
endfunction

function boolean153 takes real s,real d1,real d2,real d3 returns boolean
  return s<=d1 and s<=d2 and s<=d3
endfunction

function Q4E takes unit u,real x,real y,real d returns real
  local real x2=GetUnitX(u)
  local real y2=GetUnitY(u)
  local real Q7E=DistanceBetweenXY(x-d,y,x2,y2)
  local real Q8E=DistanceBetweenXY(x+d,y,x2,y2)
  local real group032=DistanceBetweenXY(x,y+d,x2,y2)
  local real QDE=DistanceBetweenXY(x,y-d,x2,y2)
  if boolean153(Q7E,Q8E,QDE,group032)then
    return 180.
  elseif boolean153(Q8E,Q7E,QDE,group032)then
    return .0
  elseif boolean153(QDE,Q8E,Q7E,group032)then
    return 270.
  endif
  return 90.
endfunction

function reals025 takes real s,real d1,real d2,real d3,real d4,real d5,real d6,real d7 returns boolean
  return s<=d1 and s<=d2 and s<=d3 and s<=d4 and s<=d5 and s<=d6 and s<=d7
endfunction

function QFE takes unit u,integer Cache returns unit
  local real x1=GetUnitX(u)
  local real y1=GetUnitY(u)
  local unit unit051=(LoadUnitHandle(hashtable019,(Cache),(1100+1)))
  local unit reals024=(LoadUnitHandle(hashtable019,(Cache),(1100+2)))
  local unit unit050=(LoadUnitHandle(hashtable019,(Cache),(1100+3)))
  local unit QJE=(LoadUnitHandle(hashtable019,(Cache),(1100+4)))
  local unit unit055=(LoadUnitHandle(hashtable019,(Cache),(1100+5)))
  local unit unit052=(LoadUnitHandle(hashtable019,(Cache),(1100+6)))
  local unit QNE=(LoadUnitHandle(hashtable019,(Cache),(1100+7)))
  local unit integer523=(LoadUnitHandle(hashtable019,(Cache),(1100+8)))
  local real d1=DistanceBetweenXY(x1,y1,GetUnitX(unit051),GetUnitY(unit051))
  local real d2=DistanceBetweenXY(x1,y1,GetUnitX(reals024),GetUnitY(reals024))
  local real d3=DistanceBetweenXY(x1,y1,GetUnitX(unit050),GetUnitY(unit050))
  local real d4=DistanceBetweenXY(x1,y1,GetUnitX(QJE),GetUnitY(QJE))
  local real d5=DistanceBetweenXY(x1,y1,GetUnitX(unit055),GetUnitY(unit055))
  local real d6=DistanceBetweenXY(x1,y1,GetUnitX(unit052),GetUnitY(unit052))
  local real d7=DistanceBetweenXY(x1,y1,GetUnitX(QNE),GetUnitY(QNE))
  local real d8=DistanceBetweenXY(x1,y1,GetUnitX(integer523),GetUnitY(integer523))
  
  if reals025(d1,d2,d3,d4,d5,d6,d7,d8)then
    set reals024=null
    set unit050=null
    set QJE=null
    set unit055=null
    set unit052=null
    set QNE=null
    set integer523=null
    return unit051
  elseif reals025(d2,d1,d3,d4,d5,d6,d7,d8)then
    set unit051=null
    set unit050=null
    set QJE=null
    set unit055=null
    set unit052=null
    set QNE=null
    set integer523=null
    return reals024
  elseif reals025(d3,d2,d1,d4,d5,d6,d7,d8)then
    set unit051=null
    set reals024=null
    set QJE=null
    set unit055=null
    set unit052=null
    set QNE=null
    set integer523=null
    return unit050
  elseif reals025(d4,d2,d3,d1,d5,d6,d7,d8)then
    set unit051=null
    set reals024=null
    set unit050=null
    set unit055=null
    set unit052=null
    set QNE=null
    set integer523=null
    return QJE
  elseif reals025(d5,d2,d3,d4,d1,d6,d7,d8)then
    set unit051=null
    set reals024=null
    set unit050=null
    set QJE=null
    set unit052=null
    set QNE=null
    set integer523=null
    return unit055
  elseif reals025(d6,d2,d3,d4,d5,d1,d7,d8)then
    set unit051=null
    set reals024=null
    set unit050=null
    set QJE=null
    set unit055=null
    set QNE=null
    set integer523=null
    return unit052
  elseif reals025(d7,d2,d3,d4,d5,d6,d1,d8)then
    set unit051=null
    set reals024=null
    set unit050=null
    set QJE=null
    set unit055=null
    set unit052=null
    set integer523=null
    return QNE
  elseif reals025(d8,d2,d3,d4,d5,d6,d7,d1)then
    set unit051=null
    set reals024=null
    set unit050=null
    set QJE=null
    set unit055=null
    set unit052=null
    set QNE=null
    return integer523
  endif
  return null
endfunction

function integer524 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real x=GetUnitX(Target)
  local real y=GetUnitY(Target)
  local real QQE=7.5
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer reals026=40+40*Level
  if GetTriggerEvalCount(t)>34 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call SaveInteger(hashtable019,(GetHandleId((Target))),((4260)),(2))
    call DamageTarget(Source,Target,1,reals026)
    call SetUnitState(Target,UNIT_STATE_MANA,RMaxIF(GetUnitState(Target,UNIT_STATE_MANA)-reals026,0))
  else
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",x,y))
    call KillTrees(x,y,150)
    if((LoadInteger(hashtable019,(GetHandleId((Target))),((4261))))==1)==false then
      call SetUnitPosition(Target,x+QQE*Cos(J2E*bj_DEGTORAD),y+QQE*Sin(J2E*bj_DEGTORAD))
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function QSE takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=GetEnumUnit()
  local real x=tt_real1
  local real y=real084
  local real d=real085
  local real J2E=Q4E(Target,x,y,d)
  local real x2 = GetWidgetX(Target)
  local real y2 = GetWidgetY(Target)
  local real d2 = d - SquareRoot((x-x2)*(x-x2)+(y-y2)*(y-y2)) + 100
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",Target,"chest"))
  call SaveInteger(hashtable019,(GetHandleId((Target))),((4260)),(1))
  if d2 > 0 then
    call SetUnitX(Target,x2 + d2*Cos(J2E*bj_DEGTORAD))
    call SetUnitY(Target,y2 + d2*Sin(J2E*bj_DEGTORAD))
  endif
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveInteger(hashtable019,(Cache),(5),(tt_int1))
  call SaveUnitHandle(hashtable019,(Cache),(2),(tt_unit1))
  call TriggerRegisterTimerEvent(t,.025,true)
  call TriggerAddCondition(t,Condition(function integer524))
  set t=null
  set Target=null
endfunction

function QTE takes unit u,integer Cache returns boolean
  local unit integer522=QFE(u,Cache)
  local boolean result=true
  if IsDead(integer522)or(LoadInteger(hashtable019,(GetHandleId(integer522)),(156)))==1 then
    set result=false
  endif
  call SaveInteger(hashtable019,(GetHandleId(integer522)),(156),(1))
  call SetUnitVertexColor(integer522,25,25,25,175)
  set integer522=null
  return result
endfunction

function QVE takes nothing returns nothing
  if GetUnitState(GetEnumUnit(),UNIT_STATE_MANA)>0 and IsUnitInGroup(GetEnumUnit(),DK)==false and((LoadInteger(hashtable019,GetHandleId(GetEnumUnit()),4260))==1)==false and QTE(GetEnumUnit(),ED8) then
    call SaveInteger(hashtable019,GetHandleId(GetEnumUnit()),4260,1)
    call GroupAddUnit(unit005,GetEnumUnit())
  endif
endfunction

function QWE takes trigger t,unit Hero,real x,real y,real d,integer Level returns nothing
  local integer Cache=GetHandleId(t)
  local real unit053=200
  local rect r1=Rect(x-d,y-d,x+d,y+d)
  local rect r2=Rect(x-d-unit053,y-d-unit053,x+d+unit053,y+d+unit053)
  local group g1=GetAvailableGroup()
  local group g2=GetAvailableGroup()
  local group g3=GetAvailableGroup()
  set tt_unit1=Hero
  call GroupEnumUnitsInRect(g1,r1,Condition(function NonImmuneEnemyFilter))
  call GroupEnumUnitsInRect(g2,r2,Condition(function NonImmuneEnemyFilter))
  set DK=g1
  set unit005=g3
  set tt_real1=x
  set real084=y
  set real085=d
  set ED8=Cache
  call ForGroup(g2,function QVE)
  set tt_int1=Level
  call ForGroup(g3,function QSE)
  call KillGroup(g1)
  call KillGroup(g2)
  call KillGroup(g3)
  call RemoveRect(r1)
  call RemoveRect(r2)
  set g1=null
  set g2=null
  set g3=null
  set r1=null
  set r2=null
endfunction

function QYE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local boolean QZE=(LoadBoolean(hashtable019,(Cache),(155)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  if QZE then
    call TimedReveal(p,.2,x,y,500)
  endif
  set t=null
  set p=null
  return false
endfunction

function trigger011 takes unit QBE returns nothing
  local real x=GetUnitX(QBE)
  local real y=GetUnitY(QBE)
  local player p=GetOwningPlayer(QBE)
  local unit Caster=CreateUnit(p,'u00W',x,y,0)
  call KillUnit(Caster)
  set p=null
  set Caster=null
endfunction

function unit054 takes integer Cache,real x,real y,boolean QZE,player p returns nothing
  local unit unit051=(LoadUnitHandle(hashtable019,(Cache),(1100+1)))
  local unit reals024=(LoadUnitHandle(hashtable019,(Cache),(1100+2)))
  local unit unit050=(LoadUnitHandle(hashtable019,(Cache),(1100+3)))
  local unit QJE=(LoadUnitHandle(hashtable019,(Cache),(1100+4)))
  local unit unit055=(LoadUnitHandle(hashtable019,(Cache),(1100+5)))
  local unit unit052=(LoadUnitHandle(hashtable019,(Cache),(1100+6)))
  local unit QNE=(LoadUnitHandle(hashtable019,(Cache),(1100+7)))
  local unit integer523=(LoadUnitHandle(hashtable019,(Cache),(1100+8)))
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.1,false)
  call TriggerAddCondition(t,Condition(function QYE))
  call SaveReal(hashtable019,(GetHandleId(t)),(6),((x)*1.))
  call SaveReal(hashtable019,(GetHandleId(t)),(7),((y)*1.))
  call SavePlayerHandle(hashtable019,(GetHandleId(t)),(54),(p))
  call SaveBoolean(hashtable019,(GetHandleId(t)),(155),(QZE))
  call trigger011(unit051)
  call RemoveUnit(unit051)
  call trigger011(reals024)
  call RemoveUnit(reals024)
  call trigger011(unit050)
  call RemoveUnit(unit050)
  call trigger011(QJE)
  call RemoveUnit(QJE)
  call trigger011(unit055)
  call RemoveUnit(unit055)
  call trigger011(unit052)
  call RemoveUnit(unit052)
  call trigger011(QNE)
  call RemoveUnit(QNE)
  call trigger011(integer523)
  call RemoveUnit(integer523)
  set t=null
  set unit051=null
  set reals024=null
  set unit050=null
  set QJE=null
  set unit055=null
  set unit052=null
  set QNE=null
  set integer523=null
endfunction

function real075 takes unit QBE,integer Cache,integer ZG8,player p returns nothing
  if IsUnitVisibleLoD(QBE,p)then
    call SaveBoolean(hashtable019,(Cache),(155),(true))
  endif
  call SaveUnitHandle(hashtable019,(Cache),(1100+ZG8),(QBE))
endfunction

function Q6E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local real DP9=(LoadReal(hashtable019,(Cache),(57)))
  local integer Count=GetTriggerEvalCount(t)
  if Count>R2I(DP9*10)then
    call unit054(Cache,(LoadReal(hashtable019,(Cache),(6))),(LoadReal(hashtable019,(Cache),(7))),(LoadBoolean(hashtable019,(Cache),(155))),(LoadPlayerHandle(hashtable019,(Cache),(154))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call QWE(t,(LoadUnitHandle(hashtable019,(Cache),(14))),(LoadReal(hashtable019,(Cache),(6))),(LoadReal(hashtable019,(Cache),(7))),(LoadReal(hashtable019,(Cache),(138))),(LoadInteger(hashtable019,(Cache),(5))))
  endif
  set t=null
  return false
endfunction

function QLE takes nothing returns nothing
  call SetUnitX(GetEnumUnit(),GetUnitX(tt_unit1))
  call SetUnitY(GetEnumUnit(),GetUnitY(tt_unit1))
endfunction

function Clockwerk_PowerCogs_Action takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Level=GetUnitAbilityLevel(Hero,'A0Z5')
  local integer ID='u00S'
  local real x1=GetUnitX(Hero)
  local real y1=GetUnitY(Hero)
  local real x2
  local real y2
  local real d=125
  local unit QBE
  local real DP9=4+Level
  local real BufferDuration=5
  local group g
  local rect Q0E
  local player AXD
  local real life=3
  if Level<4 then
    set life=2
  endif
  if IsSentinel(GetOwningPlayer(Hero))then
    set AXD=Scourges[0]
  else
    set AXD=Sentinels[0]
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call SaveBoolean(hashtable019,(Cache),(155),(false))
  set g=GetAvailableGroup()
  set d=d+110
  set Q0E=Rect(x1-d,y1-d,x1+d,y1+d)
  set d=d-110
  set tt_unit1=Hero
  call GroupEnumUnitsInRect(g,Q0E,Condition(function DE9))
  set x2=x1+d
  set y2=y1
  set QBE=CreateUnit(GetOwningPlayer(Hero),ID,x2,y2,0)
  call SetUnitState(QBE,UNIT_STATE_LIFE,life)
  call SetUnitPosition(QBE,x2,y2)
  call real075(QBE,Cache,1,AXD)
  set x2=x1+d
  set y2=y1+d
  set QBE=CreateUnit(GetOwningPlayer(Hero),ID,x2,y2,0)
  call SetUnitPosition(QBE,x2,y2)
  call SetUnitState(QBE,UNIT_STATE_LIFE,life)
  call real075(QBE,Cache,2,AXD)
  set x2=x1
  set y2=y1+d
  set QBE=CreateUnit(GetOwningPlayer(Hero),ID,x2,y2,0)
  call SetUnitPosition(QBE,x2,y2)
  call SetUnitState(QBE,UNIT_STATE_LIFE,life)
  call real075(QBE,Cache,3,AXD)
  set x2=x1-d
  set y2=y1+d
  set QBE=CreateUnit(GetOwningPlayer(Hero),ID,x2,y2,0)
  call SetUnitPosition(QBE,x2,y2)
  call SetUnitState(QBE,UNIT_STATE_LIFE,life)
  call real075(QBE,Cache,4,AXD)
  set x2=x1-d
  set y2=y1
  set QBE=CreateUnit(GetOwningPlayer(Hero),ID,x2,y2,0)
  call SetUnitPosition(QBE,x2,y2)
  call SetUnitState(QBE,UNIT_STATE_LIFE,life)
  call real075(QBE,Cache,5,AXD)
  set x2=x1-d
  set y2=y1-d
  set QBE=CreateUnit(GetOwningPlayer(Hero),ID,x2,y2,0)
  call SetUnitPosition(QBE,x2,y2)
  call SetUnitState(QBE,UNIT_STATE_LIFE,life)
  call real075(QBE,Cache,6,AXD)
  set x2=x1
  set y2=y1-d
  set QBE=CreateUnit(GetOwningPlayer(Hero),ID,x2,y2,0)
  call SetUnitPosition(QBE,x2,y2)
  call SetUnitState(QBE,UNIT_STATE_LIFE,life)
  call real075(QBE,Cache,7,AXD)
  set x2=x1+d
  set y2=y1-d
  set QBE=CreateUnit(GetOwningPlayer(Hero),ID,x2,y2,0)
  call SetUnitPosition(QBE,x2,y2)
  call SetUnitState(QBE,UNIT_STATE_LIFE,life)
  call real075(QBE,Cache,8,AXD)
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function Q6E))
  call SaveReal(hashtable019,(Cache),(57),((DP9)*1.))
  call SaveReal(hashtable019,(Cache),(6),((x1)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y1)*1.))
  call SaveReal(hashtable019,(Cache),(138),((d)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SavePlayerHandle(hashtable019,(Cache),(154),(AXD))
  
  call ForGroup(g,function QLE)
  call KillGroup(g)
  set t=null
  set g=null
  set Hero=null
  set QBE=null
  set Q0E=null
  set AXD=null
  return false
endfunction

function Clockwerk_PowerCogs_Start takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  call TriggerRegisterTimerEvent(t,.1,false)
  call TriggerAddCondition(t,Condition(function Clockwerk_PowerCogs_Action))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  set t=null
  set Hero=null
endfunction

function R4E takes unit Source,unit Target returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local integer Level=GetUnitAbilityLevel(Source,'A0Z8')
  if Level==0 then
    set Level=GetUnitAbilityLevel(Source,'A1CV')
  endif
  call UnitAddAbility2(Caster,'A0Z9')
  call SetUnitAbilityLevel(Caster,'A0Z9',Level)
  call IssueTargetOrderById(Caster,852095,Target)
  set Caster=null
endfunction

function R7E takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),DK)==false then
    call GroupAddUnit(DK,GetEnumUnit())
    call R4E(tt_unit1,GetEnumUnit())
  endif
endfunction

function R8E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer region009=(LoadInteger(hashtable019,(Cache),(18)))
  local integer Count=GetTriggerEvalCount(t)
  local unit RDE
  local group trigger008=(LoadGroupHandle(hashtable019,(Cache),(16)))
  local group g
  local real RFE=200
  if Target==null then
    set RDE=(LoadUnitHandle(hashtable019,(Cache),(700+region009+1-Count)))
    call RemoveUnit(RDE)
  else
    set RDE=(LoadUnitHandle(hashtable019,(Cache),(700+Count)))
    if IsUnitType(Hero,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(Hero),99,true)
    endif
    call SetUnitX(Hero,GetUnitX(RDE))
    call SetUnitY(Hero,GetUnitY(RDE))
    call RemoveUnit(RDE)
    if Count==region009 then
      set RFE=225
    endif
    set g=GetAvailableGroup()
    set tt_unit1=Hero
    set DK=trigger008
    call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),RFE,Condition(function LW8))
    call ForGroup(g,function R7E)
    call KillGroup(g)
  endif
  if Count==(region009)then
    if Target!=null then
      call PauseUnit(Target,false)
    endif
    call KillTrees(GetUnitX(Hero),GetUnitY(Hero),100)
    call KillGroup(trigger008)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Hero=null
  set Target=null
  set RDE=null
  set trigger008=null
  set g=null
  return false
endfunction

function sound001 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local integer RHE=(LoadInteger(hashtable019,(Cache),(12)))
  local integer Count=GetTriggerEvalCount(t)
  local real x=GetUnitX(Hero)+Count*50*Cos(J2E*bj_DEGTORAD)
  local real y=GetUnitY(Hero)+Count*50*Sin(J2E*bj_DEGTORAD)
  local boolean RIE=(LoadBoolean(hashtable019,(Cache),(15)))
  local unit RJE
  local trigger trigger009=(LoadTriggerHandle(hashtable019,(Cache),(11)))
  local integer sound002=GetHandleId(trigger009)
  local group g=GetAvailableGroup()
  local unit Target=null
  local integer ID='u00V'
  local real RFE=125
  if Count==1 then
    set RFE=100
  endif
  set tt_unit1=Hero
  call GroupEnumUnitsInRange(g,x,y,RFE,Condition(function LO8))
  call GroupRemoveUnit(g,Hero)
  set Target=GroupPickRandomUnit(g)
  call KillGroup(g)
  if Target!=null or Count==RHE or Count==(RHE-1)or Count==(RHE-2)then
    set ID='u00U'
  endif
  set RJE=CreateUnit(GetOwningPlayer(Hero),ID,x,y,J2E)
  call SaveUnitHandle(hashtable019,(sound002),(700+Count),(RJE))
  if Target!=null then
    if GetOwningPlayer(Target)==NeutralsPlayer or((LoadInteger(hashtable019,(GetHandleId((Target))),((4259))))==1) then
      set Target=null
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if Target!=null and IsUnitAlly(Target,GetOwningPlayer(Hero))==false then
      call PauseUnit(Target,true)
    endif
    call TriggerRegisterTimerEvent(trigger009,.5/ RHE,true)
    call TriggerAddCondition(trigger009,Condition(function R8E))
    call SaveInteger(hashtable019,(sound002),(18),(Count))
    call SaveUnitHandle(hashtable019,(sound002),(17),(Target))
    call SaveUnitHandle(hashtable019,(sound002),(14),(Hero))
    call SaveGroupHandle(hashtable019,(sound002),(16),(GetAvailableGroup()))
  elseif Count>RHE then
    set Target=null
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call TriggerRegisterTimerEvent(trigger009,.5/ RHE,true)
    call TriggerAddCondition(trigger009,Condition(function R8E))
    call SaveInteger(hashtable019,(sound002),(18),(Count))
    call SaveUnitHandle(hashtable019,(sound002),(17),(Target))
    call SaveUnitHandle(hashtable019,(sound002),(14),(Hero))
    call SaveGroupHandle(hashtable019,(sound002),(16),(GetAvailableGroup()))
  endif
  set t=null
  set Hero=null
  set RJE=null
  set trigger009=null
  set g=null
  set Target=null
  return false
endfunction

function Clockwerk_Hookshot takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local real J2E=AngleBetweenXY(GetUnitX(Hero),GetUnitY(Hero),GetSpellTargetX(),GetSpellTargetY())
  local integer Level=GetUnitAbilityLevel(Hero,'A0Z8')
  local integer integers061
  local integer RHE
  local boolean RIE=false
  local trigger boolean136=CreateTrigger()
  if Level==0 then
    set Level=GetUnitAbilityLevel(Hero,'A1CV')
    set RIE=true
  endif
  set integers061=1500+500*Level
  set RHE=integers061/ 50
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveInteger(hashtable019,(Cache),(12),(RHE))
  call SaveTriggerHandle(hashtable019,(Cache),(11),(boolean136))
  call SaveBoolean(hashtable019,(Cache),(15),(RIE))
  call TriggerRegisterTimerEvent(t,.5/ RHE,true)
  call TriggerAddCondition(t,Condition(function sound001))
  set t=null
  set Hero=null
  set boolean136=null
endfunction

function RRE takes unit Source returns nothing
  local group g=GetAvailableGroup()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local unit Target
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  local integer Level=GetUnitAbilityLevel(Source,'A0Z4')
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x,y,300,Condition(function NonImmuneVisibleEnemyFilter))
  set Target=GroupPickRandomUnit(g)
  call KillGroup(g)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl",Source,"origin"))
  if Target!=null then
    call UnitAddAbility2(Caster,'A0Z7')
    call SetUnitAbilityLevel(Caster,'A0Z7',Level)
    call IssueTargetOrderById(Caster,852095,Target)
  endif
  set g=null
  set Target=null
  set Caster=null
endfunction

function RSE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=GetTriggerEvalCount(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  if Count>14 or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call RRE(Hero)
  endif
  set t=null
  set Hero=null
  return false
endfunction

function Clockwerk_BatteryAssault takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  call TriggerRegisterTimerEvent(t,.7,true)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function RSE))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call TriggerEvaluate(t)
  set t=null
  set Hero=null
endfunction

function RVE takes nothing returns nothing
  call DamageTarget(EE8,GetEnumUnit(),1,EF8)
endfunction

function RWE takes unit Source,real x,real y,integer Level returns nothing
  local group g=GetAvailableGroup()
  if Level==1 then
    set EF8=90
  elseif Level==2 then
    set EF8=150
  elseif Level==3 then
    set EF8=220
  elseif Level==4 then
    set EF8=280
  endif
  set EE8=Source
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x,y,255,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function RVE)
  call KillGroup(g)
  set g=null
endfunction

function sound003 takes nothing returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(tt_unit1),'e00E',GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
  call UnitAddAbility2(Caster,'A10T')
  if GetUnitAbilityLevel(tt_unit1,'A03R')>0 then
    call SetUnitAbilityLevel(Caster,'A10T',2)
  endif
  call IssueTargetOrderById(Caster,852075,GetEnumUnit())
  set Caster=null
endfunction

function RYE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer RZE=ModuloInteger(GetTriggerEvalCount(t),4)+1
  local real a
  local real d
  local real x
  local real y
  local group g=GetAvailableGroup()
  set tt_unit1=Hero
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),710,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function sound003)
  call KillGroup(g)
  if RZE==1 then
    set a=GetRandomReal(0,90)
  elseif RZE==2 then
    set a=GetRandomReal(90,180)
  elseif RZE==3 then
    set a=GetRandomReal(180,270)
  else
    set a=GetRandomReal(270,360)
  endif
  set d=GetRandomReal(140,710)
  if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST and(GetSpellAbilityId()=='A03R' or GetSpellAbilityId()=='A0AV')then
    if GetSpellAbilityId()=='A0AV' then
      call UnitRemoveAbility(Hero,'A0ST')
      call DestroyEffect(LoadEffectHandle(hashtable019,Cache,0))
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call StopSound(sound006,false,true)
  else
    set x=GetUnitX(Hero)+d*Cos(a*bj_DEGTORAD)
    set y=GetUnitY(Hero)+d*Sin(a*bj_DEGTORAD)
    call DestroyEffect(AddSpecialEffect("effects\\SnowyBlizzardTarget.mdx",x,y))
    call RWE(Hero,x,y,Level)
  endif
  set t=null
  set Hero=null
  set g=null
  return false
endfunction

function CM_FreezingField takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level
  call PlaySoundAtPos(sound006,GetUnitX(Hero),GetUnitY(Hero))
  if GetSpellAbilityId()=='A03R' then
    set Level=GetUnitAbilityLevel(Hero,'A03R')
  else
    set Level=GetUnitAbilityLevel(Hero,'A0AV')+1
    call UnitAddAbility2(Hero,'A0ST')//mag immune cont
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl",Hero,"origin"))
    call SaveEffectHandle(hashtable019,Cache,0,AddSpecialEffectTarget("Abilities\\Spells\\Human\\DivineShield\\DivineShieldTarget.mdl",Hero,"origin"))
    call SetPlayerAbilityAvailable(GetOwningPlayer(Hero),'A0ST',false)
  endif
  call TriggerRegisterTimerEvent(t,.07,true)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerAddCondition(t,Condition(function RYE))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  set t=null
  set Hero=null
endfunction

function Func1155 takes nothing returns nothing
  //call PreloadAbility('A03X')
endfunction

function Maiden_Brilliance_Learn takes nothing returns nothing
  local unit u = GetTriggerUnit()
  
  //call Buff_Add(u,LoDBuff_AbilID[19],LoDBuff_BuffID[19],-1)
  call UnitRemoveAbility(u,'QBA1')
  call UnitRemoveAbility(u,'QBA2')
  call UnitRemoveAbility(u,'QBA3')
  call UnitRemoveAbility(u,'QBA4')
  call UnitAddAbility(u,GetUnitAbilityLevel(u,'AHab')+'QBA0')
  
  set u = null
endfunction

function CM_Nova takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00C',x,y,0)
  local integer Level=GetUnitAbilityLevel(Source,'A1E9')
  call UnitAddAbility2(Caster,'A01D')
  call SetUnitAbilityLevel(Caster,'A01D',Level)
  call IssueTargetOrderById(Caster,852226,Caster)
  call UnitAddAbility2(Caster,'Aloc')
  call UnitApplyTimedLife(Caster,'BTLF',2)
  set Source=null
  set Caster=null
endfunction

function CM_Frostbide_duration takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit target=LoadUnitHandle(hashtable019,h,0)
  if(GetTriggerEventId()==EVENT_UNIT_DEATH or IsMagicImmune(target) or GetUnitAbilityLevel(target,'B017')<1 or (GetTriggerEvalCount(t)>4+LoadInteger(hashtable019,h,0) and GetUnitTypeId(target)=='n00L'))then
    if (GetUnitTypeId(target)=='n00L')then
      call UnitRemoveAbility(target,'B017')
    endif
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  endif
  set t=null
  set target=null
endfunction

function CM_Frostbite_Disarm takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local integer lvl=GetUnitAbilityLevel(caster,GetSpellAbilityId())
  local unit dummy=CreateUnit(GetOwningPlayer(caster),'e00E',GetUnitX(target),GetUnitY(target),0)
  local integer id='A30S'
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerRegisterTimerEvent(t,0.5,true)
  call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function CM_Frostbide_duration))
  call SaveUnitHandle(hashtable019,h,0,target)
  call SaveInteger(hashtable019,h,0,lvl)
  //	call SaveUnitHandle(HY,h,1,caster)
  //	call SaveEffectHandle(HY,h,2,AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathTargetArt.mdl",target,"origin"))
  //	if(IsUnitType(target,UNIT_TYPE_HERO) or IsUnitIllusion(target) or LoadInteger(UnitStats,GetUnitTypeId(target),EXP)>119)then
  //		call SaveInteger(HY,h,4,2+lvl)
  ////		call EnsnareUnit(target,'A318',1+0.5*lvl)
  //		set id='A30R'
  //	else
  //		call SaveInteger(HY,h,4,20)
  ////		call EnsnareUnit(target,'A318',10)
  //	endif
  //	call UnitAddAbility2(target,'A319')
  //	call UnitMakeAbilityPermanent(target,true,'A318')
  //	call SetPlayerAbilityAvailable(GetOwningPlayer(target),'A319',false)
  //	call DetectMagicDispell(target,'A319','B017')
  //	call UnitAddAbility(dummy,id)
  //	call SetUnitAbilityLevel(dummy,id,lvl)
  //	call IssueTargetOrder(dummy,"ensnare",target)
  set t=null
  set dummy=null
  set caster=null
  set target=null
endfunction

function R6E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call SetUnitAnimationByIndex(Source,8)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function RLE takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SetUnitAnimationByIndex(Source,7)
  call TriggerRegisterTimerEvent(t,2.5,false)
  call TriggerAddCondition(t,Condition(function R6E))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=null
  set Source=null
endfunction

function integer490 takes nothing returns boolean
  if GetUnitTypeId(GetTriggerUnit())=='N0M0' then
    call RLE()
  endif
  return false
endfunction

function UY9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function integer490))
  set t=null
endfunction

function R0E takes nothing returns nothing
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\ChimaeraLightningMissile\\ChimaeraLightningMissile.mdl",GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit())))
  call DamageTarget(EG8,GetEnumUnit(),1,EH8)
endfunction

function integer489 takes nothing returns boolean
  local trigger t2=GetTriggeringTrigger()
  local integer Cache2=GetHandleId(t2)
  local trigger t1=(LoadTriggerHandle(hashtable019,(Cache2),(9)))
  local integer R2E=GetHandleId(t1)
  local unit S4E=(LoadUnitHandle(hashtable019,(Cache2),(8)))
  local group g
  local integer Level=(LoadInteger(hashtable019,(Cache2),(5)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call ShowUnit(S4E,false)
    call KillUnit(S4E)
    call FlushChildHashtable(hashtable019,(R2E))
    call CleanTrigger(t1)
    call FlushChildHashtable(hashtable019,(Cache2))
    call CleanTrigger(t2)
  elseif IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(S4E)) and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetTriggerUnit(),'A04R')==0 then
    set g=GetAvailableGroup()
    set tt_unit1=S4E
    set EG8=S4E
    set EH8=100+40*Level
    call GroupEnumUnitsInRange(g,GetUnitX(S4E),GetUnitY(S4E),285,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function R0E)
    call KillGroup(g)
    call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",GetUnitX(S4E),GetUnitY(S4E)))
    call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",GetUnitX(S4E),GetUnitY(S4E)))
    call ShowUnit(S4E,false)
    call KillUnit(S4E)
    call FlushChildHashtable(hashtable019,(R2E))
    call CleanTrigger(t1)
    call FlushChildHashtable(hashtable019,(Cache2))
    call CleanTrigger(t2)
  endif
  set t1=null
  set t2=null
  set S4E=null
  set g=null
  return false
endfunction

function S7E takes nothing returns boolean
  local trigger t1=GetTriggeringTrigger()
  local integer R2E=GetHandleId(t1)
  local trigger t2
  local integer Cache2
  local unit S4E
  local integer Level
  local real x=(LoadReal(hashtable019,(R2E),(6)))
  local real y=(LoadReal(hashtable019,(R2E),(7)))
  local real H1E
  local integer Count=GetTriggerEvalCount(t1)
  if Count==1 then
    call DestroyEffect((LoadEffectHandle(hashtable019,(R2E),(3))))
  elseif Count==2 then
    call DestroyEffect((LoadEffectHandle(hashtable019,(R2E),(4))))
    set t2=CreateTrigger()
    set Cache2=GetHandleId(t2)
    set Level=(LoadInteger(hashtable019,(R2E),(5)))
    set H1E=(LoadReal(hashtable019,(R2E),(1)))
    set S4E=CreateUnit(GetOwningPlayer((LoadUnitHandle(hashtable019,(R2E),(2)))),'h07F',x,y,H1E)
    call SetUnitVertexColor(S4E,255,255,255,100)
    call UnitApplyTimedLife(S4E,'BTLF',12)
    call SaveUnitHandle(hashtable019,(R2E),(8),(S4E))
    call SaveUnitHandle(hashtable019,(Cache2),(8),(S4E))
    call SaveTriggerHandle(hashtable019,(Cache2),(9),(t1))
    call SaveInteger(hashtable019,(Cache2),(5),(Level))
    call TriggerRegisterUnitInRange(t2,S4E,235,Condition(function ReturnTrue))
    call TriggerRegisterUnitEvent(t2,S4E,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t2,Condition(function integer489))
    call DestroyEffect(AddSpecialEffectTarget("effects\\ManaFlareBoltImpact_NoSound.mdx",S4E,"origin"))
  elseif Count>2 then
    set S4E=(LoadUnitHandle(hashtable019,(R2E),(8)))
    call DestroyEffect(AddSpecialEffectTarget("effects\\ManaFlareBoltImpact_NoSound.mdx",S4E,"origin"))
  endif
  set t1=null
  set t2=null
  set S4E=null
  return false
endfunction

function Storm_StaticRemnant takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t1=CreateTrigger()
  local integer R2E=GetHandleId(t1)
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  call TriggerRegisterTimerEvent(t1,.5,true)
  call TriggerAddCondition(t1,Condition(function S7E))
  call SaveReal(hashtable019,(R2E),(6),((x)*1.))
  call SaveReal(hashtable019,(R2E),(7),((y)*1.))
  call SaveInteger(hashtable019,(R2E),(5),(GetUnitAbilityLevel(Source,'A14P')))
  call SaveUnitHandle(hashtable019,(R2E),(2),(Source))
  call SaveReal(hashtable019,(R2E),(1),((GetUnitFacing(Source))*1.))
  call SaveEffectHandle(hashtable019,(R2E),(3),(AddSpecialEffect("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldTarget.mdl",x,y)))
  call SaveEffectHandle(hashtable019,(R2E),(4),(AddSpecialEffect("effects\\Static_Remnant_FX.mdx",x,y)))
  set Source=null
  set t1=null
endfunction

function StormSpirit_Overload_RemoveSlow takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  call UnitRemoveAbility(u,'A335')
  call UnitRemoveAbility(u,'B08B')
  call FlushChildHashtable(hashtable019,h)
  call PauseTimer(t)
  call DestroyTimer(t)
  set u=null
  set t=null
endfunction

function SDE takes nothing returns nothing
  //local unit Caster=CreateUnit(GetOwningPlayer(GetEnumUnit()),'e00E',GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call TimerStart(t,0.6,false,function StormSpirit_Overload_RemoveSlow)
  call SaveUnitHandle(hashtable019,h,0,GetEnumUnit())
  call UnitAddAbility2(GetEnumUnit(),'A335')
  //call UnitAddAbility2(Caster,'A0S5')
  //call IssueTargetOrderById(Caster,852075,GetEnumUnit())
  call DamageTarget(EI8,GetEnumUnit(),1,EJ8)
  //set Caster=null
  set t=null
endfunction

function SEE takes unit Source,unit Target returns nothing
  local integer Cache=GetHandleId(Source)
  local group g=GetAvailableGroup()
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(200))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(201))))
  call SaveInteger(hashtable019,(GetHandleId((Source))),((4264)),(2))
  set tt_unit1=Source
  set EI8=Source
  set EJ8=IMaxIF(GetUnitAbilityLevel(Source,'A0QW'),GetUnitAbilityLevel(Source,'QP1V'))*20+10
  call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),300,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function SDE)
  call KillGroup(g)
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl",GetUnitX(Target),GetUnitY(Target)))
  set g=null
endfunction

function SFE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local trigger SGE=(LoadTriggerHandle(hashtable019,(Cache),(202)))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source and((LoadInteger(hashtable019,(GetHandleId((Source))),((4264))))==1) then
      call DisableTrigger(t)
      call SEE(Source,Target)
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call FlushChildHashtable(hashtable019,(GetHandleId(SGE)))
      call CleanTrigger(SGE)
    endif
  else
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  set Source=null
  set SGE=null
  return false
endfunction

function SHE takes nothing returns nothing
  local trigger t=CreateTrigger()
  local unit Target=GetTriggerUnit()
  local unit Source=GetAttacker()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(t,2.5,false)
  call TriggerAddCondition(t,Condition(function SFE))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveTriggerHandle(hashtable019,(Cache),(202),(GetTriggeringTrigger()))
  set t=null
  set Target=null
  set Source=null
endfunction

function SIE takes nothing returns boolean
  if GetAttacker()==(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(2)))and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitAlly(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))==false then
    call SHE()
  endif
  return false
endfunction

function SJE takes nothing returns nothing
  local trigger t=CreateTrigger()
  local unit Source=GetTriggerUnit()
  local integer Cache=GetHandleId(Source)
  local string fx=""
  if IsUnitAlly(Source,GetLocalPlayer())or IsObserver(GetLocalPlayer())then
    set fx="Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl"
  endif
  call SaveEffectHandle(hashtable019,(Cache),(200),(AddSpecialEffectTarget(fx,Source,"right hand")))
  call SaveEffectHandle(hashtable019,(Cache),(201),(AddSpecialEffectTarget(fx,Source,"left hand")))
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function SIE))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Source))
  set t=null
  set Source=null
endfunction

function SKE takes nothing returns boolean
  local integer spell = GetSpellAbilityId()
  
  if (spell=='A14O' or spell=='A0SB' or Valid_Spell(spell))and((LoadInteger(hashtable019,(GetHandleId((GetTriggerUnit()))),((4264))))==1)==false then
    call SaveInteger(hashtable019,(GetHandleId((GetTriggerUnit()))),((4264)),(1))
    call SJE()
  endif
  return false
endfunction

function StormSpirit_Overload_Learn takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function SKE))
  set Source=null
  set t=null
endfunction

function SNE takes nothing returns boolean
  if (GetLearnedSkill()=='A0QW' or GetLearnedSkill()=='QP1V') and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call StormSpirit_Overload_Learn()
  endif
  return false
endfunction

function R09 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function SNE))
  set t=null
endfunction

function SOE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real x=GetUnitX(Target)-5*Cos(J2E)
  local real y=GetUnitY(Target)-5*Sin(J2E)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real x0=(LoadReal(hashtable019,(Cache),(6)))
  local real y0=(LoadReal(hashtable019,(Cache),(7)))
  if((x0-x)*(x0-x))+((y0-y)*(y0-y))<100 then
    set x=x0
    set y=y0
  endif
  call SetUnitX(Target,x)
  call SetUnitY(Target,y)
  if GetTriggerEvalCount(t)==(10+10*Level)or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  return false
endfunction

function SPE takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'u00X',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
  local integer Level=GetUnitAbilityLevel(Source,'A14R')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function SOE))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(13),((Atan2(GetUnitY(Target)-GetUnitY(Source),GetUnitX(Target)-GetUnitX(Source)))*1.))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Source))*1.))
  call UnitAddAbility2(Caster,'A14Q')
  call SetUnitAbilityLevel(Caster,'A14Q',Level)
  call IssueTargetOrderById(Caster,852480,Target)
  call UnitApplyTimedLife(Caster,'BTLF',1+.5*Level)
  //set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
  //call UnitAddAbility2(Caster,'A14S')
  //call IssueTargetOrderById(Caster,852075,Source)
  set Source=null
  set Target=null
  set Caster=null
  set t=null
endfunction

function Storm_ElectricVortex takes nothing returns nothing
  if GetUnitTypeId(GetSpellTargetUnit())!='n00L' and IsBlocked(GetSpellTargetUnit())==false then
    call SPE()
  endif
endfunction

function SRE takes nothing returns nothing
  if(LoadBoolean(hashtable019,(EK8),(GetHandleId(GetEnumUnit()))))==false then
    call SaveBoolean(hashtable019,(EK8),(GetHandleId(GetEnumUnit())),(true))
    call DamageTarget(EN8,GetEnumUnit(),1,EO8*(EM8*4+4)/ 100)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",GetEnumUnit(),"origin"))
  endif
endfunction

function SSE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit STE=(LoadUnitHandle(hashtable019,(Cache),(195)))
  local integer Y59=(LoadInteger(hashtable019,(Cache),(194)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(6)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(7)))
  local real NHE=GetUnitX(Source)
  local real NIE=GetUnitY(Source)
  local real J2E=Atan2(TargetY-NIE,TargetX-NHE)
  local real AO8=NHE+(25+25*Level)*Cos(J2E)
  local real AP8=NIE+(25+25*Level)*Sin(J2E)
  local lightning ZQ8=(LoadLightningHandle(hashtable019,(Cache),(196)))
  local real lx=(LoadReal(hashtable019,(Cache),(197)))
  local real ly=(LoadReal(hashtable019,(Cache),(198)))
  local real IVD=GetUnitState(Source,UNIT_STATE_MANA)
  local real SUE=(25+25*Level)*(10+.01*GetUnitState(Source,UNIT_STATE_MAX_MANA))/ 100
  local group g=GetAvailableGroup()
  local real SVE=(LoadReal(hashtable019,(Cache),(199)))
  set SVE=SVE+25+25*Level
  call SaveReal(hashtable019,(Cache),(199),((SVE)*1.))
  if GetTriggerEvalCount(t)>25 then
    set lx=lx+(25+25*Level)*Cos(J2E)
    set ly=ly+(25+25*Level)*Sin(J2E)
    call SaveReal(hashtable019,(Cache),(197),((lx)*1.))
    call SaveReal(hashtable019,(Cache),(198),((ly)*1.))
  endif
  call SetUnitState(Source,UNIT_STATE_MANA,RMaxBJ(IVD-SUE,0))
  call MoveLightning(ZQ8,true,lx,ly,AO8,AP8)
  if IsUnitType(Source,UNIT_TYPE_HERO)then
    call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
  endif
  call SetUnitX(Source,AO8)
  call SetUnitY(Source,AP8)
  call SetUnitPosition(Caster,AO8,AP8)
  call SetUnitPosition(STE,AO8,AP8)
  set tt_unit1=Source
  set EN8=Source
  set EK8=Cache
  set EM8=Level
  set EO8=SVE
  call GroupEnumUnitsInRange(g,AO8,AP8,75+75*Level,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function SRE)
  call KillGroup(g)
  set Y59=Y59-1
  call SaveInteger(hashtable019,(Cache),(194),(Y59))
  call SetUnitVertexColor(Source,255,255,255,0)
  if Y59==0 or GetUnitState(Source,UNIT_STATE_MANA)<1 then
    call DestroyLightning(ZQ8)
    call KillTrees(AO8,AP8,75)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call RemoveUnit(Caster)
    call RemoveUnit(STE)
    call SetUnitVertexColor(Source,255,255,255,255)
    call SetUnitPathing(Source,true)
    call SetUnitInvulnerable(Source,false)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call KillTrees(AO8,AP8,75)
  endif
  set t=null
  set Caster=null
  set Source=null
  set ZQ8=null
  set g=null
  set STE=null
  return false
endfunction

function Storm_BallLightning takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local unit Caster
  local unit STE
  local real x
  local real y
  local trigger t
  local integer Cache
  local lightning ZQ8
  local integer Level=GetUnitAbilityLevel(Source,'A14O')
  local real IVD=GetUnitState(Source,UNIT_STATE_MANA)
  local real SUE=15+.07*GetUnitState(Source,UNIT_STATE_MAX_MANA)
  call SetUnitState(Source,UNIT_STATE_MANA,RMaxBJ(IVD-SUE,0))
  if GetUnitState(Source,UNIT_STATE_MANA)>10 then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    set Caster=CreateUnit(GetOwningPlayer(Source),'o010',SourceX,SourceY,0)
    set STE=CreateUnit(GetOwningPlayer(Source),'H07G',SourceX,SourceY,0)
    set ZQ8=AddLightning("FORK",true,SourceX,SourceY,SourceX,SourceY)
    if GetSpellTargetUnit()==null then
      set x=GetSpellTargetX()
      set y=GetSpellTargetY()
    else
      set x=GetUnitX(GetSpellTargetUnit())
      set y=GetUnitY(GetSpellTargetUnit())
    endif
    call SetUnitVertexColor(Source,255,255,255,0)
    call SetUnitVertexColor(STE,255,255,255,0)
    call SetUnitPathing(Source,false)
    call SetUnitPathing(Caster,false)
    call SetUnitInvulnerable(Source,true)
    call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(195),(STE))
    call SaveLightningHandle(hashtable019,(Cache),(196),(ZQ8))
    call SaveInteger(hashtable019,(Cache),(5),(Level))
    call SaveReal(hashtable019,(Cache),(6),((x)*1.))
    call SaveReal(hashtable019,(Cache),(7),((y)*1.))
    call SaveReal(hashtable019,(Cache),(197),((SourceX)*1.))
    call SaveReal(hashtable019,(Cache),(198),((SourceY)*1.))
    call SaveReal(hashtable019,(Cache),(199),((0)*1.))
    call SaveInteger(hashtable019,(Cache),(194),(IMaxIF(R2I(SquareRoot((x-SourceX)*(x-SourceX)+(y-SourceY)*(y-SourceY))/(25+25*Level)),1)))
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("effects\\Lightning_Ball_Tail_FX.mdx",STE,"origin")))
    call TriggerRegisterTimerEvent(t,.04,true)
    call TriggerAddCondition(t,Condition(function SSE))
    call ShowUnit(Source,false)
    call ShowUnit(Source,true)
    call SelectUnitAddForPlayer(Source,GetOwningPlayer(Source))
  endif
  set Source=null
  set Caster=null
  set STE=null
  set t=null
  set ZQ8=null
endfunction

function Storm_BallLightning_OnCast takes nothing returns nothing
  if GetUnitState(GetTriggerUnit(),UNIT_STATE_MANA)<(15+.07*GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_MANA))then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n0G8'))
  endif
endfunction


function StormOld_LightningGrapple_ForGroup2 takes nothing returns nothing
  call SetUnitPathing(GetEnumUnit(),true)
  if IsUnitEnemy(GetEnumUnit(),GetOwningPlayer(LightningGrappleUnit)) then
    call DamageTarget(LightningGrappleUnit,GetEnumUnit(),1,LightningGrappleDmg)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",GetEnumUnit(),"origin"))
  endif
endfunction

function StormOld_LightningGrapple_ForGroup takes nothing returns nothing
  call SetUnitPosition(GetEnumUnit(),GetUnitX(GetEnumUnit())+40*Cos(LightningGrappleAngle),GetUnitY(GetEnumUnit())+40*Sin(LightningGrappleAngle))
  call KillTrees(GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),200)
  call SetUnitPathing(GetEnumUnit(),false)
endfunction

function StormOld_LightningGrapple_Periodic takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local real a=LoadReal(hashtable019,h,0)
  local integer c=LoadInteger(hashtable019,h,0)-1
  local unit caster=LoadUnitHandle(hashtable019,h,0)
  local real x=GetUnitX(caster)
  local real y=GetUnitY(caster)
  
  if c<1 or DistanceBetweenXY(x,y,LoadReal(hashtable019,h,1),LoadReal(hashtable019,h,2))<50 then//its time to land
    set LightningGrappleUnit=caster
    set LightningGrappleDmg=GetUnitAbilityLevel(caster,'A33U')*50+50
    call ForGroup(LoadGroupHandle(hashtable019,h,10),function StormOld_LightningGrapple_ForGroup2)
    call KillTrees(x,y,200)
    call DestroyLightning(LoadLightningHandle(hashtable019,h,11))
    call KillGroup(LoadGroupHandle(hashtable019,h,10))
    call CleanTimer(t)
  else
    set LightningGrappleAngle=a
    call ForGroup(LoadGroupHandle(hashtable019,h,10),function StormOld_LightningGrapple_ForGroup)
    call MoveLightning(LoadLightningHandle(hashtable019,h,11),true,x,y,LoadReal(hashtable019,h,1),LoadReal(hashtable019,h,2))
    call SaveInteger(hashtable019,h,0,c)
  endif
  
  set caster=null
  set t=null
endfunction

function StormOld_LightningGrapple_Filter takes nothing returns boolean
  return IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsDead(GetFilterUnit())==false
endfunction

function StormOld_LightningGrapple takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local real x=GetUnitX(caster)
  local real y=GetUnitY(caster)
  local real dx=GetSpellTargetX()
  local real dy=GetSpellTargetY()
  local real angle=AngleBetweenXY(x,y,dx,dy)*bj_DEGTORAD
  local group g=GetAvailableGroup()
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  local lightning l
  if DistanceBetweenXY(x,y,dx,dy)>600+200*GetUnitAbilityLevel(caster,GetSpellAbilityId()) then
    set dx=x+(600+200*GetUnitAbilityLevel(caster,GetSpellAbilityId()))*Cos(angle)
    set dy=y+(600+200*GetUnitAbilityLevel(caster,GetSpellAbilityId()))*Sin(angle)
  endif
  set l=AddLightning("CLPB",true,x,y,dx,dy)
  call SetLightningColor(l,.75,.75,1,.75)
  call GroupEnumUnitsInRange(g,x,y,350,Condition(function StormOld_LightningGrapple_Filter))
  call TimerStart(t,0.03,true,function StormOld_LightningGrapple_Periodic)
  call SaveInteger(hashtable019,h,0,R2I(DistanceBetweenXY(x,y,dx,dy)/40)+1)
  call SaveReal(hashtable019,h,0,angle)
  call SaveGroupHandle(hashtable019,h,10,g)
  call SaveLightningHandle(hashtable019,h,11,l)
  call SaveUnitHandle(hashtable019,h,0,caster)
  call SaveReal(hashtable019,h,1,dx)
  call SaveReal(hashtable019,h,2,dy)
  set l=null
  set t=null
  set caster=null
  set g=null
endfunction

function TailAndReincarnation takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local boolean b=LoadBoolean(hashtable019,h,0)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  if b==false then
    if GetUnitState(u,UNIT_STATE_LIFE)<=0.5 then
      call SaveBoolean(hashtable019,h,0,true)
    endif
  elseif b==true and GetUnitState(u,UNIT_STATE_LIFE)>0.5 then
    call UnitRemoveAbility(u,'QF0O')
    call SetUnitAbilityLevel(u,'QB0G',GetUnitAbilityLevel(u,'A2AI'))
    call FlushChildHashtable(hashtable019,h)
    call DestroyTrigger(t)
  endif
  set t=null 
  set u=null
endfunction

function fixtailffs takes nothing returns nothing
  local unit u
  local integer id=GetSpellAbilityId()
  local trigger t
  if GetUnitAbilityLevel(GetTriggerUnit(),'A2AI')>0 and (id=='QM00' or id=='QM01' or id=='QM02' or id=='QM03' or id=='QM04' or id=='A1C0' or id=='A1RI' or id=='A332') then
    set u=GetTriggerUnit()
    if Mode_BO then
      if isMorphedUnit(u)==false then
        call SetUnitAbilityLevel(u,'A0AR',GetUnitAbilityLevel(u,'A2AI')+4)
      else
        call SetUnitAbilityLevel(u,'A0AR',GetUnitAbilityLevel(u,'A2AI'))
      endif
    else
      if isMorphedUnit(u)==false then
        call UnitAddAbility2(u,'QF0O')
        call SetPlayerAbilityAvailable(GetOwningPlayer(u),'QF0O',false)
        call SetUnitAbilityLevel(u,'QB0N',GetUnitAbilityLevel(u,'A2AI'))
        set t=CreateTrigger()
        call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
        call TriggerRegisterTimerEvent(t,1,true)
        call SaveUnitHandle(hashtable019,GetHandleId(t),0,u)
        call SaveBoolean(hashtable019,GetHandleId(t),0,false)
        call TriggerAddCondition(t,Condition(function TailAndReincarnation))
        set t=null
      else
        call UnitRemoveAbility(u,'QF0O')
        call SetUnitAbilityLevel(u,'QB0G',GetUnitAbilityLevel(u,'A2AI'))
      endif
    endif
  endif
  set u=null
endfunction

function FixDragonTailRange takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function fixtailffs))
  set t=null 
endfunction

function DK_DragonForm_TailFix takes unit Source returns nothing
  local integer Level=GetUnitAbilityLevel(Source,'A2AI')
  if isMorphedUnit(Source)==true and GetUnitAbilityLevel(Source,'QF0O')>0 then
    if Mode_EB==false then
      call SetUnitAbilityLevel(Source,'A0AR',Level+4)
    else
      call SetUnitAbilityLevel(Source,'QB0G',Level)
    endif
  else
    if Mode_EB==false then
      call SetUnitAbilityLevel(Source,'A0AR',Level)
    else
      call SetUnitAbilityLevel(Source,'QB0G',Level)
    endif
  endif
endfunction

function DragonKnight_DragonTail_Leveling takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A2AI')
  if Level==1 then
    if Mode_EB==false then
      call UnitAddAbility2(Source,'A0AR')
    else
      call UnitAddAbility2(Source,'QB0G')
    endif
  endif
  call DK_DragonForm_TailFix(Source)
  set Source=null
endfunction

function SBE takes nothing returns boolean
  if GetLearnedSkill()=='A2AI' and IsUnitIllusion(GetTriggerUnit())==false then
    call DragonKnight_DragonTail_Leveling()
  endif
  return false
endfunction

function DK_DragonTail takes nothing returns nothing
  local unit u=GetTriggerUnit()
  if GetUnitTypeId(u)=='H00G' or GetUnitTypeId(u)=='H00F' or GetUnitTypeId(u)=='H00E' then
    call SetUnitAnimation(u,"stand")
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Defend\\DefendCaster.mdl",u,"head"))
  elseif GetUnitTypeId(u)=='Hlgr' then
    call SetUnitAnimation(u,"stand defend")
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Defend\\DefendCaster.mdl",u,"origin"))
  endif
  set u=null
endfunction

function QA9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function SBE))
  call PreloadAbility('A0AR')
  call PreloadAbility('QB0G')
  set t=null
endfunction

function DK_DragonBlood_Act takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local player p = GetOwningPlayer(u)
  local integer lvl=IMaxIF(GetUnitAbilityLevel(u,'A0CL'),GetUnitAbilityLevel(u,'QP0J'))
  
  call SetPlayerTechResearched(p,'R006',lvl)
  set u=null
endfunction

function DK_DragonForm_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call DK_DragonForm_TailFix(Source)
  call CleanTrigger(t)
  call FlushChildHashtable(hashtable019,(Cache))
  set t=null
  set Source=null
  return false
endfunction

function DK_DragonForm_OnDeath takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call DK_DragonForm_TailFix(Source)
  call CleanTrigger(t)
  call FlushChildHashtable(hashtable019,(Cache))
  set t=null
  set Source=null
  return false
endfunction

function DK_DragonForm_ChangeTail takes nothing returns nothing
  if GetUnitAbilityLevel(tt_unit1,'A0AR')>0 or GetUnitAbilityLevel(tt_unit1,'QB0G')>0 then
    call DK_DragonForm_TailFix(tt_unit1)
  endif
endfunction

function DK_DragonForm_Act takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.01,false)
  call TriggerAddCondition(t,Condition(function DK_DragonForm_Duration))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerAddCondition(t,Condition(function DK_DragonForm_OnDeath))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set Source=null
  set t=null
endfunction

function DK_Attack_Check takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit d=null
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==LoadUnitHandle(hashtable019,h,0) and GetEventDamage()>4 then
      call DisableTrigger(t)
      call CleanTrigger(t)
      set d=CreateUnit(GetOwningPlayer(GetEventDamageSource()),'u01H',GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),0)//use some random unit with enabled attack
      call UnitAddAbility(d,'A0O4')
      call UnitAddAbility(d,'Aloc')
      call UnitAddAbility(d,'A1DZ')
      call ShowUnit(d,false)
      call IssueTargetOrder(d,"attack",GetTriggerUnit())
      call UnitApplyTimedLife(d,'BTLF',0.9)
      set d=null
      call FlushChildHashtable(hashtable019,h)
    endif
  else
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  endif
  
  set t=null
endfunction

function DK_Attack_Init takes nothing returns nothing
  local trigger t
  local integer h
  if GetUnitTypeId(GetAttacker())=='H00E' or GetUnitTypeId(GetAttacker())=='H00F' then
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
    call TriggerRegisterTimerEvent(t,3,false)
    call TriggerAddCondition(t,Condition(function DK_Attack_Check))
    call SaveUnitHandle(hashtable019,h,0,GetAttacker())
    set t=null
  endif
endfunction

function DK_Attack_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function DK_Attack_Init))
  set t=null
endfunction


function Kaolin_GG_RestorePathing takes nothing returns nothing
  local unit u=GetEnumUnit()
  if GetUnitTypeId(u)!='o01X' then
    call SetUnitPathing(u,true)
  endif
  call SaveInteger(hashtable019,(GetHandleId((u))),((4336)),(2))
  set u=null
endfunction

function Kaolin_GG_STFU takes unit target returns nothing
  local unit d=CreateUnit(GetOwningPlayer(target),'e00E',GetUnitX(target),GetUnitY(target),0)
  call UnitAddAbility(d,'A2TG')
  call SetUnitAbilityLevel(d,'A2TG',KaolinGGTempLvl)
  call IssueTargetOrder(d,"soulburn",target)
  set d=null
endfunction

function Kaolin_GG_StunEnemy takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),KaolinGGTempGroup)==false then
    call GroupAddUnit(KaolinGGTempGroup,GetEnumUnit())
    call Kaolin_GG_STFU(GetEnumUnit())
    if KaolinGGBuffedByStone==1 then
      call DamageTarget(KaolinGGTempUnit,GetEnumUnit(),1,50+50*KaolinGGTempLvl)
    endif
  endif
endfunction

function Kaolin_GeomagneticGrip_AddEffect takes nothing returns nothing
  local unit u=GetEnumUnit()
  local real angle=(LoadReal(hashtable019,(GetHandleId(u)),(801)))
  local real speed=(LoadReal(hashtable019,(GetHandleId(u)),(802)))
  local real newX=KaolinGeoGripTempX+speed*Cos(angle)
  local real newY=KaolinGeoGripTempY+speed*Sin(angle)
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl",newX,newY))
  if GetUnitTypeId(u)=='o01X' or GetUnitTypeId(u)=='o020' then
    set KaolinGGBuffedByStone=1
    call SetUnitPosition(u,newX,newY)
    call SetUnitX(u,newX)
    call SetUnitY(u,newY)
  else
    call SetUnitX(u,newX)
    call SetUnitY(u,newY)
    call KillTrees(newX,newY,100)
  endif
  set u=null
endfunction

function Kaolin_GG_RemoveSomeTarget takes nothing returns nothing
  local unit u=GetEnumUnit()
  if IsDead(u)==true or((LoadInteger(hashtable019,(GetHandleId((u))),((4306))))==1)==true or GetUnitAbilityLevel(u,'B08V')>0 or((LoadInteger(hashtable019,(GetHandleId((u))),((4335))))==1)==true then
    call GroupRemoveUnit(KaolinGGTempGroup,u)
    call SaveInteger(hashtable019,(GetHandleId((u))),((4336)),(2))
    if GetUnitTypeId(u)!='o01X' then
      call SetUnitPathing(u,true)
    endif
  endif
  set u=null
endfunction

function Kaolin_GeomagneticGrip_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local group g=(LoadGroupHandle(hashtable019,(h),(803)))
  local real casterX=(LoadReal(hashtable019,(h),(6)))
  local real casterY=(LoadReal(hashtable019,(h),(7)))
  local real targetX=(LoadReal(hashtable019,(h),(23)))
  local real targetY=(LoadReal(hashtable019,(h),(24)))
  local real angle=bj_DEGTORAD*AngleBetweenXY(targetX,targetY,casterX,casterY)
  local real newTX
  local real newTY
  local boolean b=false
  local group gg=(LoadGroupHandle(hashtable019,(h),(187)))
  local group lol3rdgroup
  set KaolinGGBuffedByStone=0
  set KaolinGGTempGroup=g
  call ForGroup(g,function Kaolin_GG_RemoveSomeTarget)
  if GetTriggerEvalCount(t)>200 or FirstOfGroup(g)==null then
    set b=true
  else
    set newTX=targetX+1000*0.03*Cos(angle)
    set newTY=targetY+1000*0.03*Sin(angle)
    if DistanceBetweenXY(newTX,newTY,casterX,casterY)<30 then
      set newTX=casterX
      set newTY=casterY
      set b=true
    endif
    set newTX=SafeX50(newTX)
    set newTY=SafeY50(newTY)
    set KaolinGGTempGroup=g
    set KaolinGeoGripTempX=newTX
    set KaolinGeoGripTempY=newTY
    call ForGroup(g,function Kaolin_GeomagneticGrip_AddEffect)
    call SaveReal(hashtable019,(h),(23),((newTX)*1.0))
    call SaveReal(hashtable019,(h),(24),((newTY)*1.0))
    set lol3rdgroup=GetAvailableGroup()
    set tt_unit1=caster
    set KaolinGGTempGroup=gg
    set KaolinGGTempUnit=caster
    set KaolinGGTempLvl=GetUnitAbilityLevel(caster,'A2QI')
    call GroupEnumUnitsInRange(lol3rdgroup,newTX,newTY,205,Condition(function DefaultEnemyFilter))
    call ForGroup(lol3rdgroup,function Kaolin_GG_StunEnemy)
    call KillGroup(lol3rdgroup)
    set lol3rdgroup=null
  endif
  if b then
    call ForGroup(g,function Kaolin_GG_RestorePathing)
    call DestroyEffect((LoadEffectHandle(hashtable019,(h),(32))))
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
    call KillGroup(gg)
    call KillGroup(g)
  endif
  set caster=null
  set t=null
  set gg=null
  set g=null
  return false
endfunction

function IsStone2 takes nothing returns boolean
  return GetUnitTypeId(GetFilterUnit())=='o01X'
endfunction

function Kaolin_GeomagneticGrip_ForGroup takes nothing returns nothing
  local unit u=GetEnumUnit()
  call SetUnitPathing(u,false)
  call SaveInteger(hashtable019,(GetHandleId((u))),((4336)),(1))
  call SaveReal(hashtable019,(GetHandleId(u)),(801),((bj_DEGTORAD*AngleBetweenXY(KaolinGeoGripTempX,KaolinGeoGripTempY,GetUnitX(u),GetUnitY(u)))*1.0))
  call SaveReal(hashtable019,(GetHandleId(u)),(802),((DistanceBetweenXY(KaolinGeoGripTempX,KaolinGeoGripTempY,GetUnitX(u),GetUnitY(u)))*1.0))
  set u=null
endfunction

function Kaolin_GeomagneticGrip_Effect takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local trigger t
  local integer h
  local real targetX=GetUnitX(GetSpellTargetUnit())
  local real targetY=GetUnitY(GetSpellTargetUnit())
  local real casterX=GetUnitX(caster)
  local real casterY=GetUnitY(caster)
  local real angle=AngleBetweenXY(casterX,casterY,targetX,targetY)
  local unit target=GetSpellTargetUnit()
  local group g
  if target==null then
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetSpellTargetX(),GetSpellTargetY(),265,Condition(function IsStone2))
    if FirstOfGroup(g)==null then
      call KillGroup(g)
      set caster=null
      set g=null
      return
    endif
    set target=FirstOfGroup(g)
    call KillGroup(g)
  endif
  set g=GetAvailableGroup()
  call GroupAddUnit(g,target)
  set targetX=GetUnitX(target)
  set targetY=GetUnitY(target)
  set angle=AngleBetweenXY(casterX,casterY,targetX,targetY)
  set t=CreateTrigger()
  set h=GetHandleId(t)
  set KaolinGeoGripTempX=targetX
  set KaolinGeoGripTempY=targetY
  call ForGroup(g,function Kaolin_GeomagneticGrip_ForGroup)
  set casterX=casterX+100*Cos(angle*bj_DEGTORAD)
  set casterY=casterY+100*Sin(angle*bj_DEGTORAD)
  call TriggerRegisterTimerEvent(t,0.03,true)
  call TriggerAddCondition(t,Condition(function Kaolin_GeomagneticGrip_Duration))
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  call SaveReal(hashtable019,(h),(6),((casterX)*1.0))
  call SaveReal(hashtable019,(h),(7),((casterY)*1.0))
  call SaveReal(hashtable019,(h),(23),((targetX)*1.0))
  call SaveReal(hashtable019,(h),(24),((targetY)*1.0))
  call SaveGroupHandle(hashtable019,(h),(187),(GetAvailableGroup()))
  call SaveGroupHandle(hashtable019,(h),(803),(g))
  call SaveEffectHandle(hashtable019,(h),(32),(AddSpecialEffectTarget("war3mapImported\\MagneticGripTarget.mdx",target,"chest")))
  set caster=null
  set t=null
  set g=null
  set target=null
endfunction

function Kaolin_GeomagneticGrip_Cast takes nothing returns nothing
  local unit target=GetSpellTargetUnit()
  local group g
  if target==null then
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetSpellTargetX(),GetSpellTargetY(),265,Condition(function IsStone2))
    if FirstOfGroup(g)==null then
      call InterruptUnit(GetTriggerUnit())
      if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) then
        call Error(GetOwningPlayer(GetTriggerUnit()),"No nearby Rock found")
      endif
    endif
    call KillGroup(g)
  endif
  set g=null
  set target=null
endfunction

function Kaolin_GeomagneticGrip_Init takes nothing returns boolean
  if GetSpellAbilityId()=='A2QI' then
    //if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_CAST then
    call Kaolin_GeomagneticGrip_Cast()
    //else
    //	call Kaolin_GeomagneticGrip_Effect()
    //endif
  endif
  return false
endfunction

function Kaolin_GeomagneticGrip_Reg takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  //call TriggerAddCondition(t,Condition(function Kaolin_GeomagneticGrip_Init))
  //set t=null
endfunction

function Kaolin_RollingBoulder_SlowFilter takes nothing returns boolean
  return IsDead(GetFilterUnit())==false and IsUnitEnemy(KaolinTempRollingCaster,GetOwningPlayer(GetFilterUnit()))and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and((LoadInteger(hashtable019,(GetHandleId((GetFilterUnit()))),((809))))==1)
endfunction

function Kaolin_RollingBoulder_SlowApply takes nothing returns nothing
  call CN8((GetEnumUnit()),'A2QN',1,2,'B0GK')
endfunction

function Kaolin_RollingBoulder_Slow takes unit target returns nothing
  local group g=GetAvailableGroup()
  if((LoadInteger(hashtable019,(GetHandleId((target))),((809))))==1)==true then
    call GroupEnumUnitsInRange(g,0,0,99999,Condition(function Kaolin_RollingBoulder_SlowFilter))
  endif
  call GroupAddUnit(g,target)
  call ForGroup(g,function Kaolin_RollingBoulder_SlowApply)
  call KillGroup(g)
  set g=null
endfunction

function Kaolin_RollingBoulder_Damage takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),KaolinTempRollingGroup)==false then
    call GroupAddUnit(KaolinTempRollingGroup,GetEnumUnit())
    if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO)==true then
      set KaolinRollingBoulderTempBool=true
      set KaolinClosestTarget=GetEnumUnit()
      if((LoadInteger(hashtable019,(GetHandleId((GetEnumUnit()))),((809))))==1)then
        set KaolinRollingTempUnit=GetEnumUnit()
      endif
      if KaolinTempRollingBuffed==1 then
        call DamageTarget(KaolinTempRollingCaster,GetEnumUnit(),1,KaolinTempRollingDamage*1.5)
        call Kaolin_RollingBoulder_Slow(GetEnumUnit())
      else
        call DamageTarget(KaolinTempRollingCaster,GetEnumUnit(),1,KaolinTempRollingDamage)
      endif
    else
      if KaolinTempRollingBuffed==1 then
        call DamageTarget(KaolinTempRollingCaster,GetEnumUnit(),1,KaolinTempRollingDamage*1.5)
      else
        call DamageTarget(KaolinTempRollingCaster,GetEnumUnit(),1,KaolinTempRollingDamage)
      endif
    endif
  endif
endfunction

function IsStone takes nothing returns boolean
  return GetUnitTypeId(GetFilterUnit())=='o01X'
endfunction

function Kaolin_RollingBoulder_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local group g=(LoadGroupHandle(hashtable019,(h),(187)))
  local group gg
  local unit dummy=(LoadUnitHandle(hashtable019,(h),(19)))//vision only
  local real x=(LoadReal(hashtable019,(h),(6)))
  local real y=(LoadReal(hashtable019,(h),(7)))
  local real curX=GetUnitX(caster)
  local real curY=GetUnitY(caster)
  local real distTraveled=DistanceBetweenXY(x,y,curX,curY)
  local real newX
  local real newY
  local real savedAngle=(LoadReal(hashtable019,(h),(137)))
  local real speed=800
  local integer RollingWithStone=(LoadInteger(hashtable019,(h),(34)))
  local real totalTraveled=(LoadReal(hashtable019,(h),(138)))
  local boolean b=false
  local unit target=(LoadUnitHandle(hashtable019,(h),(810)))
  set KaolinRollingBoulderTempBool=false
  call SetUnitTimeScale(caster,3)
  call SetUnitFacing(caster,savedAngle)
  call SetUnitAnimationByIndex(caster,0)
  if GetTriggerEvalCount(t)>30 then
    if RollingWithStone==0 then
      set gg=GetAvailableGroup()
      call GroupEnumUnitsInRange(gg,curX,curY,175,Condition(function IsStone))
      if FirstOfGroup(gg)!=null then
        call KillUnit(FirstOfGroup(gg))
        set RollingWithStone=1
        call SaveInteger(hashtable019,(h),(34),(RollingWithStone))
      endif
      call KillGroup(gg)
    endif
    if RollingWithStone==1 then
      set speed=speed*2
    endif
    if target!=null then
      set savedAngle=GetAngleBetweenUnits(caster,target)
      call SaveReal(hashtable019,(h),(137),((savedAngle)*1.0))
    endif
    set newX=x+0.02*speed*Cos(savedAngle*bj_DEGTORAD)
    set newY=y+0.02*speed*Sin(savedAngle*bj_DEGTORAD)
    if IsUnitType(caster,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(caster),99,true)
    endif
    call SetUnitX(caster,SafeX50(newX))
    call SetUnitY(caster,SafeY50(newY))
    call SaveReal(hashtable019,(h),(6),((GetUnitX(caster))*1.0))
    call SaveReal(hashtable019,(h),(7),((GetUnitY(caster))*1.0))
    call SetUnitX(dummy,GetUnitX(caster))
    call SetUnitY(dummy,GetUnitY(caster))
    call KillTrees(GetUnitX(caster),GetUnitY(caster),100)
    set distTraveled=DistanceBetweenXY(x,y,GetUnitX(caster),GetUnitY(caster))
    set totalTraveled=totalTraveled+distTraveled
    call SaveReal(hashtable019,(h),(138),((totalTraveled)*1.0))
    set gg=GetAvailableGroup()
    set tt_unit1=caster
    set KaolinTempRollingCaster=caster
    set KaolinTempRollingGroup=g
    set KaolinTempRollingLvl=GetUnitAbilityLevel(caster,'A2TJ')
    set KaolinClosestTarget=null
    set KaolinTempRollingDamage=60+30*KaolinTempRollingLvl
    set KaolinTempRollingBuffed=RollingWithStone
    set KaolinRollingTempUnit=null
    call GroupEnumUnitsInRange(gg,GetUnitX(caster),GetUnitY(caster),175,Condition(function DefaultEnemyFilter))
    call ForGroup(gg,function Kaolin_RollingBoulder_Damage)
    call KillGroup(gg)
    if KaolinRollingTempUnit!=null then
      set gg=GetAvailableGroup()
      set KaolinClosestTarget=null
      set KaolinDistanceTemp=9999
      call GroupEnumUnitsInRange(gg,GetUnitX(KaolinRollingTempUnit),GetUnitY(KaolinRollingTempUnit),625,Condition(function Kaolin_RollingBoulder_SlowFilter))
      call KillGroup(gg)
      if KaolinClosestTarget==null then
        set b=true
        set KaolinClosestTarget=KaolinRollingTempUnit
      else
        set target=KaolinClosestTarget
        call SaveUnitHandle(hashtable019,(h),(810),(target))
      endif
    endif
  else
    if IsUnitType(caster,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(caster),99,true)
    endif
    call SetUnitX(caster,x)
    call SetUnitY(caster,y)
  endif
  if IsUnitDisabled(caster)or GetTriggerEventId()==EVENT_WIDGET_DEATH or b or(target==null and(GetTriggerEvalCount(t)>130 or KaolinRollingBoulderTempBool or(RollingWithStone==0 and totalTraveled>800)or(RollingWithStone==1 and totalTraveled>1600)))then
    call KillUnit(dummy)
    call KillGroup(g)
    call DestroyEffect(LoadEffectHandle(hashtable019,h,5))
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
    
    //call UnitAddAbility(caster,'A2QR')
    //call UnitRemoveAbility(caster,'A2QR')
    call SetUnitTimeScale(caster,1)
    if KaolinRollingBoulderTempBool==true then
      set newX=GetUnitX(KaolinClosestTarget)+50*Cos(savedAngle*bj_DEGTORAD)
      set newY=GetUnitY(KaolinClosestTarget)+50*Sin(savedAngle*bj_DEGTORAD)
      if IsUnitType(caster,UNIT_TYPE_HERO)then
        call SaveBoolean(HeroStats,GetHandleId(caster),99,true)
      endif
      call SetUnitX(caster,SafeX50(newX))
      call SetUnitY(caster,SafeY50(newY))
      call IssueTargetOrder(caster,"attack",KaolinClosestTarget)
    endif
  endif
  set caster=null
  set t=null
  set gg=null
  set g=null
  set dummy=null
  set target=null
  return false
endfunction

function Kaolin_RollingBoulder_Anim takes nothing returns nothing
  local timer t=GetExpiredTimer()
  call SetUnitAnimationByIndex(LoadUnitHandle(hashtable019,GetHandleId(t),0),LoadInteger(MHT,GetUnitTypeId(LoadUnitHandle(hashtable019,GetHandleId(t),0)),'A1P8'))
  call FlushChildHashtable(hashtable019,GetHandleId(t))
  call PauseTimer(t)
  call DestroyTimer(t)
  set t=null
endfunction

function Kaolin_RollingBoulder_Start takes unit caster,unit target returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local unit d=CreateUnit(GetOwningPlayer(caster),'o01P',GetUnitX(caster),GetUnitY(caster),0)
  local real angle=AngleBetweenXY(GetUnitX(caster),GetUnitY(caster),GetSpellTargetX(),GetSpellTargetY())
  //call UnitAddAbility(caster,'A2QQ')
  //call UnitRemoveAbility(caster,'A2QQ')
  call SaveEffectHandle(hashtable019,h,5,AddSpecialEffectTarget("war3mapImported\\RollingBoulder.mdx",caster,"origin"))
  call SetUnitTimeScale(caster,3)
  call TriggerRegisterDeathEvent(t,caster)
  call TriggerRegisterTimerEvent(t,0.02,true)
  call TriggerAddCondition(t,Condition(function Kaolin_RollingBoulder_Duration))
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  call SaveGroupHandle(hashtable019,(h),(187),(GetAvailableGroup()))
  call SaveUnitHandle(hashtable019,(h),(19),(d))
  call SaveReal(hashtable019,(h),(6),((GetUnitX(caster))*1.0))
  call SaveReal(hashtable019,(h),(7),((GetUnitY(caster))*1.0))
  call SaveReal(hashtable019,(h),(137),((angle)*1.0))
  call SaveInteger(hashtable019,(h),(34),(0))
  call SaveReal(hashtable019,(h),(138),((0)*1.0))
  call SaveUnitHandle(hashtable019,(h),(810),(null))
  if target!=null and GetUnitTypeId(target)=='o01X' then
    call KillUnit(target)
  endif
  set t=null
  set d=null
endfunction

function Kaolin_RollingBoulder_Filter takes nothing returns boolean
  return(GetUnitTypeId(GetFilterUnit())=='o01X' and GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(KaolinTempRollingCaster)) and IsDead(GetFilterUnit())==false
endfunction

function Kaolin_RollingBoulder_Check takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local real cooldown=(LoadReal(hashtable019,(h),(442)))
  local integer stonesLeft=(LoadInteger(hashtable019,(GetHandleId(caster)),(800)))
  if GetTriggerEventId()==EVENT_UNIT_SPELL_CAST then
    if(GetSpellAbilityId()=='A2TH')and stonesLeft<=0 then
      call Error(GetOwningPlayer(caster),"No stones left")
      call InterruptUnit(caster)
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if GetSpellAbilityId()=='A2TH' or GetSpellAbilityId()=='A2TJ' then
      if GetSpellAbilityId()=='A2TJ' then
        call Kaolin_RollingBoulder_Start(caster,null)
      endif
    endif
  elseif stonesLeft<6 then
    set cooldown=cooldown-0.2
    call SaveReal(hashtable019,(h),(442),((cooldown)*1.0))
    if cooldown<=0.then
      //call UnitRemoveAbility(caster,Kaolin_StoneChargesIndicator[stonesLeft])
      set stonesLeft=stonesLeft+1
      //call UnitAddAbility2(caster,Kaolin_StoneChargesIndicator[stonesLeft])
      call SaveInteger(hashtable019,(GetHandleId(caster)),(800),(stonesLeft))
      call SaveReal(hashtable019,(h),(442),((25)*1.0))
    endif
  endif
  set caster=null
  set t=null
  return false
endfunction

function Kaolin_RollingBoulder_Init takes unit u returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.2,true)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_SPELL_CAST)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_SPELL_EFFECT)
  
  call TriggerAddCondition(t,Condition(function Kaolin_RollingBoulder_Check))
  call SaveUnitHandle(hashtable019,(h),(2),(u))
  call SaveReal(hashtable019,(h),442,35.0)//25 - recharging time
  call SaveInteger(hashtable019,(GetHandleId(u)),(800),(6))
  //call UnitAddAbility2(u,Kaolin_StoneChargesIndicator[6])
  set t=null
endfunction

function Kaolin_RollingBoulder_FuckingInit takes nothing returns nothing
  call Kaolin_RollingBoulder_Init(tt_unit1)
endfunction

function Kaolin_Stones_DeathAct takes unit deadStone returns nothing
  local unit kaolin=udg_Hero[GetPlayerId(GetOwningPlayer(deadStone))]
  local integer h=GetHandleId(kaolin)
  local integer lvl=GetUnitAbilityLevel(kaolin,'A2TH')
  local integer alreadyPlaced=(LoadInteger(hashtable019,(h),(279)))
  local integer i=1
  local integer k=1
  local unit tempStone
  loop
    exitwhen i>alreadyPlaced
    set tempStone=(LoadUnitHandle(hashtable019,(h),(1400+i)))
    if IsDead(tempStone)==false then
      call SaveUnitHandle(hashtable019,(h),(1400+k),(tempStone))
      set k=k+1
    endif
    set i=i+1
  endloop
  set alreadyPlaced=alreadyPlaced-1
  call SaveInteger(hashtable019,(h),(279),(alreadyPlaced))
  set tempStone=null
  set kaolin=null
endfunction

function Kaolin_Stones_Death takes nothing returns boolean
  if GetUnitTypeId(GetTriggerUnit())=='o01X' then
    call Kaolin_Stones_DeathAct(GetTriggerUnit())
  endif
  return false
endfunction

function Kaolin_Stones_SummonStart takes nothing returns nothing
  local unit newStone
  local unit caster=GetTriggerUnit()
  local integer h=GetHandleId(caster)
  local integer lvl=GetUnitAbilityLevel(caster,'A2TH')
  local integer alreadyPlaced=(LoadInteger(hashtable019,(h),(279)))
  local unit firstStone=(LoadUnitHandle(hashtable019,(h),(1401)))
  local real x
  local real y
  local integer stonesLeft=(LoadInteger(hashtable019,(GetHandleId(caster)),(800)))
  if stonesLeft>0 then
    //call UnitRemoveAbility(caster,Kaolin_StoneChargesIndicator[stonesLeft])
    set stonesLeft=IMaxBJ(0,stonesLeft-1)
    if stonesLeft<2 then
      call DisplayTimedTextToPlayer(GetOwningPlayer(caster),0,0,10,I2S(stonesLeft)+" stones left")
    endif
    
    //call UnitAddAbility2(caster,Kaolin_StoneChargesIndicator[stonesLeft])
    call SaveInteger(hashtable019,(GetHandleId(caster)),(800),(stonesLeft))
    if GetSpellTargetUnit()==null then
      set x=GetSpellTargetX()
      set y=GetSpellTargetY()
    else
      set x=GetUnitX(GetSpellTargetUnit())
      set y=GetUnitY(GetSpellTargetUnit())
    endif
    set newStone=CreateUnit(GetOwningPlayer(caster),'o01X',x,y,0)
    call SaveInteger(hashtable019,GetHandleId(newStone),4335,0)
    call SaveInteger(hashtable019,GetHandleId(newStone),4340,0)
    call UnitApplyTimedLife(newStone,'BTLF',120)
    call SetUnitPathing(newStone,false)
    set alreadyPlaced=alreadyPlaced+1
    call SaveUnitHandle(hashtable019,(h),(1400+alreadyPlaced),(newStone))
    call SaveInteger(hashtable019,(h),(279),(alreadyPlaced))
    if(alreadyPlaced>6)then
      call KillUnit(firstStone)
    endif
  else
    call Error(GetOwningPlayer(caster),"No stones available")
  endif
  set newStone=null
  set caster=null
  set firstStone=null
endfunction

function Kaolin_Stones_Summon takes nothing returns boolean
  if GetSpellAbilityId()=='A2TH' then
    call Kaolin_Stones_SummonStart()
  endif
  return false
endfunction

function Kaolin_Stones_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Kaolin_Stones_Death))
  set t=null
endfunction

function Kaolin_BoulderSmash_Filter takes nothing returns boolean
  return IsDead(GetFilterUnit())==false and IsUnitEnemy(KaolinTempCaster,GetOwningPlayer(GetFilterUnit()))and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and((LoadInteger(hashtable019,(GetHandleId((GetFilterUnit()))),((809))))==1)
endfunction

function Kaolin_BoulderSmash_Helper takes nothing returns nothing
  call StunTarget(null,GetEnumUnit(),0.25+0.5*KaolinsPushLevelStorage)
endfunction

function Kaolin_BoulderSmash_StunApp takes unit u returns nothing
  local group g=GetAvailableGroup()
  if((LoadInteger(hashtable019,(GetHandleId((u))),((809))))==1)==true then
    call GroupEnumUnitsInRange(g,0,0,99999,Condition(function Kaolin_BoulderSmash_Filter))
  endif
  call GroupAddUnit(g,u)
  call ForGroup(g,function Kaolin_BoulderSmash_Helper)
  call KillGroup(g)
  set g=null
endfunction

function Kaolin_BoulderSmash_PassThrough takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),Kaolin_PushSmashedGroup)==false then
    call GroupAddUnit(Kaolin_PushSmashedGroup,GetEnumUnit())
    call DamageTarget(KaolinTempCaster,GetEnumUnit(),1,KaolinPushDamage)
    if KaolinTempInteger==1 then
      call Kaolin_BoulderSmash_StunApp(GetEnumUnit())
    endif
    if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO)==true and((LoadInteger(hashtable019,(GetHandleId((GetEnumUnit()))),((809))))==1)then
      set KaolinSmashTempUnit=GetEnumUnit()
    endif
  endif
endfunction

function Kaolin_BoulderSmash_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local unit target=(LoadUnitHandle(hashtable019,(h),(17)))
  local real dx=(LoadReal(hashtable019,(h),(6)))
  local real dy=(LoadReal(hashtable019,(h),(7)))
  local real rads
  local real targetX=(LoadReal(hashtable019,(h),(23)))
  local real targetY=(LoadReal(hashtable019,(h),(24)))
  local real newX
  local real newY
  local boolean b=false
  local group g=(LoadGroupHandle(hashtable019,(h),(187)))
  local group gg
  local unit pushed=(LoadUnitHandle(hashtable019,(h),(810)))
  if pushed!=null then
    set dx=GetUnitX(pushed)
    set dy=GetUnitY(pushed)
  endif
  set rads=bj_DEGTORAD*AngleBetweenXY(GetUnitX(target),GetUnitY(target),dx,dy)
  set newX=targetX+(1200)*0.03*Cos(rads)
  set newY=targetY+(1200)*0.03*Sin(rads)
  if DistanceBetweenXY(newX,newY,dx,dy)<(5+(1200)*0.03)then
    set newX=dx
    set newY=dy
    set b=true
  endif
  set newX=SafeX50(newX)
  set newY=SafeY50(newY)
  set Kaolin_PushSmashedGroup=g
  set KaolinTempCaster=caster
  set KaolinsPushLevelStorage=GetUnitAbilityLevel(caster,'A2QM')
  set KaolinPushDamage=125
  set KaolinSmashTempUnit=null
  if((LoadInteger(hashtable019,(GetHandleId(target)),4306))==1)==true or GetTriggerEventId()==EVENT_UNIT_DEATH or GetUnitAbilityLevel(target,'B08V')>0 or((LoadInteger(hashtable019,(GetHandleId(target)),4336))==1)==true or(pushed==null and GetTriggerEvalCount(t)>200)then
    set b=true
  else
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl",newX,newY))
    if GetUnitTypeId(target)=='o01X' or GetUnitTypeId(target)=='o020' then
      set KaolinTempInteger=1
      call SetUnitPosition(target,newX,newY)
      call SetUnitX(target,SafeX50(newX))
      call SetUnitY(target,SafeY50(newY))
    else
      set KaolinTempInteger=0
      call SetUnitX(target,SafeX50(newX))
      call SetUnitY(target,SafeY50(newY))
    endif
    call KillTrees(newX,newY,150)
    call SaveReal(hashtable019,(h),(23),((newX)*1.0))
    call SaveReal(hashtable019,(h),(24),((newY)*1.0))
    set gg=GetAvailableGroup()
    set tt_unit1=caster
    call GroupEnumUnitsInRange(gg,newX,newY,225,Condition(function DefaultEnemyFilter))
    call GroupRemoveUnit(gg,target)
    call ForGroup(gg,function Kaolin_BoulderSmash_PassThrough)
    call KillGroup(gg)
    if KaolinSmashTempUnit!=null and KaolinTempInteger==1 then
      set gg=GetAvailableGroup()
      set KaolinPushedUnit=null
      set KaolinDistanceTemp=9999
      call GroupEnumUnitsInRange(gg,GetUnitX(KaolinSmashTempUnit),GetUnitY(KaolinSmashTempUnit),625,Condition(function Kaolin_BoulderSmash_Filter))
      call KillGroup(gg)
      if KaolinPushedUnit!=null then
        set pushed=KaolinPushedUnit
        call SaveUnitHandle(hashtable019,(h),(810),(pushed))
        set b=false
      endif
    endif
    set gg=null
  endif
  if b then
    if GetUnitTypeId(target)!='o01X' then
      call SetUnitPathing(target,true)
    endif
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
    call KillGroup(g)
    call SaveInteger(hashtable019,(GetHandleId((target))),((4335)),(2))
    if GetTriggerEventId()!=EVENT_UNIT_DEATH then
      if IsPlayerAlly(GetOwningPlayer(caster),GetOwningPlayer(target))==false then
        call DamageTarget(KaolinTempCaster,target,1,KaolinPushDamage)
      endif
    endif
  endif
  set target=null
  set t=null
  set g=null
  set caster=null
  set pushed=null
  return false
endfunction

function Kaolin_BoulderSmash_Start takes nothing returns nothing
  local unit target=GetSpellTargetUnit()
  local unit caster=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local real angle
  local real dx
  local real dy
  local integer i=-1
  local boolean b=false
  local real pushDistance=400+100*GetUnitAbilityLevel(caster,GetSpellAbilityId())
  local group g
  if target==null then
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetSpellTargetX(),GetSpellTargetY(),205,Condition(function IsStone))
    set target=FirstOfGroup(g)
    call KillGroup(g)
    set g=null
  endif
  set angle=GetAngleBetweenUnits(caster,target)
  if target==null then
    return
  endif
  if GetUnitTypeId(target)=='o01X' then
    set pushDistance=2000
  endif
  loop
    exitwhen b or i==R2I(pushDistance/25)
    set i=i+1
    set dx=SafeX50(GetUnitX(target)+(pushDistance-i*25)*Cos(angle*bj_DEGTORAD))
    set dy=SafeY50(GetUnitY(target)+(pushDistance-i*25)*Sin(angle*bj_DEGTORAD))
    if(IsPointInRegion(RestrictedRegion,((dx)*1.0),((dy)*1.0)))==false then
      set b=true
    endif
  endloop
  call SetUnitPathing(target,false)
  call TriggerRegisterTimerEvent(t,0.03,true)
  call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Kaolin_BoulderSmash_Duration))
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  call SaveUnitHandle(hashtable019,(h),(17),(target))
  call SaveReal(hashtable019,(h),(6),((dx)*1.0))
  call SaveReal(hashtable019,(h),(7),((dy)*1.0))
  call SaveReal(hashtable019,(h),(23),((GetUnitX(target))*1.0))
  call SaveReal(hashtable019,(h),(24),((GetUnitY(target))*1.0))
  call SaveInteger(hashtable019,(h),(34),(0))
  call SaveGroupHandle(hashtable019,(h),(187),(GetAvailableGroup()))
  call SaveUnitHandle(hashtable019,(h),(810),(null))
  call SaveInteger(hashtable019,(GetHandleId((target))),((4335)),(1))
  set target=null
  set caster=null
  set t=null
endfunction

function Kaolin_BoulderSmash_OnGround takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local group g
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetSpellTargetX(),GetSpellTargetY(),205,Condition(function IsStone))
  if FirstOfGroup(g)==null then
    call InterruptUnit(caster)
    if IsUnitType(caster,UNIT_TYPE_HERO) then
      call Error(GetOwningPlayer(caster),"Invalid Target")
    endif
  endif
  call KillGroup(g)
  set g=null
  set caster=null
endfunction


function Kaolin_BoulderSmash_InitSup takes nothing returns nothing
  if IsUnitEnemy(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))==false or IsBlocked(GetSpellTargetUnit())==false then
    call Kaolin_BoulderSmash_Start()
  endif
endfunction

function Kaolin_BoulderSmash_OnCast takes nothing returns nothing
  if GetSpellAbilityId()=='A2QM' and GetSpellTargetUnit()==null then
    call Kaolin_BoulderSmash_OnGround()
  elseif GetSpellAbilityId()=='A2QM' and GetUnitTypeId(GetSpellTargetUnit())=='n00L' then
    call InterruptUnit(GetTriggerUnit())
    if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) then
      call Error(GetOwningPlayer(GetTriggerUnit()),"Invalid Target")
    endif
  endif
  
endfunction

function Kaolin_BoulderSmash_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function Kaolin_BoulderSmash_OnCast))
  set t=null
endfunction

function Kaolin_Magnetize_ForNewGroup takes nothing returns nothing
  set KaolinMagnetizeTempVictim=GetEnumUnit()
  call ExeFunc("Kaolin_Magnetize_PreStart")
endfunction

function Kaolin_Magnetize_Filter takes nothing returns boolean
  return IsDead(GetFilterUnit())==false and GetUnitTypeId(GetFilterUnit())=='o01X' and((LoadInteger(hashtable019,(GetHandleId((GetFilterUnit()))),((4335))))==1)==false and((LoadInteger(hashtable019,(GetHandleId((GetFilterUnit()))),((4340))))==1)==false
endfunction

function Kaolin_Magnetize_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=LoadUnitHandle(hashtable019,h,2)
  local unit victim=LoadUnitHandle(hashtable019,h,17)
  local real x=GetUnitX(victim)
  local real y=GetUnitY(victim)
  local group g=GetAvailableGroup()
  local integer counter=GetTriggerEvalCount(t)
  local integer lvl=GetUnitAbilityLevel(caster,'A2TI')
  local real TimeLeft=(LoadReal(hashtable019,(GetHandleId(victim)),(807)))
  if ModuloInteger(counter,5)==0 then
    call DamageTarget(caster,victim,1,(25+25*lvl)/2)
  endif
  set KaolinMagnetizeTempCaster=caster
  set tt_unit1=caster
  call GroupEnumUnitsInRange(g,x,y,325,Condition(function Kaolin_Magnetize_Filter))
  call ForGroup(g,function Kaolin_Magnetize_ForNewGroup)
  call KillGroup(g)
  if(TimerGetElapsed(GlobalTimer))>TimeLeft or IsDead(victim)then
    call SaveInteger(hashtable019,GetHandleId(victim),809,2)
    call DestroyEffect(LoadEffectHandle(hashtable019,h,32))
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  endif
  set t=null
  set caster=null
  set victim=null
  set g=null
  return false
endfunction

function Kaolin_Magnetize_DurationReset takes unit u,unit victim returns nothing
  local trigger t
  local integer h
  local real CurTime=LoadReal(hashtable019,GetHandleId(victim),807)
  call SaveReal(hashtable019,(GetHandleId(victim)),807,(((TimerGetElapsed(GlobalTimer))+6)*1.0))
  if CurTime<(TimerGetElapsed(GlobalTimer))then
    call SaveInteger(hashtable019,(GetHandleId((victim))),809,(1))
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(h),(2),(u))
    call SaveUnitHandle(hashtable019,(h),(17),(victim))
    call SaveEffectHandle(hashtable019,(h),(32),(AddSpecialEffectTarget("war3mapImported\\MagnetizeTargetOverhead.mdx",victim,"origin")))
    call TriggerRegisterTimerEvent(t,0.1,true)
    call TriggerAddCondition(t,Condition(function Kaolin_Magnetize_Duration))
  endif
  set t=null
endfunction

function Kaolin_Magnetize_ForGroup takes nothing returns nothing
  call Kaolin_Magnetize_DurationReset(KaolinMagnetizeTempCaster,GetEnumUnit())
endfunction

function Kaolin_Magnetize_Start takes unit u,unit target returns nothing
  local group g=GetAvailableGroup()
  local real x=GetUnitX(target)
  local real y=GetUnitY(target)
  local real aoe=300
  if GetUnitTypeId(target)=='o01X' then
    call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherMissile\\DemolisherMissile.mdx",GetUnitX(target),GetUnitY(target)))
    call UnitApplyTimedLife(target,'BTLF',5)
    call SaveInteger(hashtable019,(GetHandleId((target))),((4340)),(1))
    call SetUnitVertexColor(target,0,0,0,100)
    set aoe=600
  else
    call DestroyEffect(AddSpecialEffect("war3mapImported\\MagnetizeCastAoE.mdx",GetUnitX(target),GetUnitY(target)))
  endif
  set tt_unit1=u
  set KaolinMagnetizeTempCaster=u
  set KaolinMagnetizeTempVictim=target
  call GroupEnumUnitsInRange(g,x,y,aoe+25,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function Kaolin_Magnetize_ForGroup)
  call KillGroup(g)
  set u=null
  set g=null
endfunction

function Kaolin_Magnetize_PreStart takes nothing returns nothing
  call Kaolin_Magnetize_Start(KaolinMagnetizeTempCaster,KaolinMagnetizeTempVictim)
endfunction

function Kaolin_Magnetize_Init takes nothing returns boolean
  if GetSpellAbilityId()=='A2TI' then
    call Kaolin_Magnetize_Start(GetTriggerUnit(),GetTriggerUnit())
  endif
  return false
endfunction

function Kaolin_Magnetize_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function Kaolin_Magnetize_Init))
  set t=null
endfunction

function Kaolin_Death_End takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=(LoadUnitHandle(hashtable019,(h),(2)))
  call SetUnitAnimationByIndex(u,8)
  call FlushChildHashtable(hashtable019,(h))
  call CleanTrigger(t)
  set t=null
  set u=null
  return false
endfunction

function IsStoneDM takes nothing returns boolean
  local unit u=GetFilterUnit()
  if GetUnitTypeId(u)=='o01X' and GetOwningPlayer(u)==tt_player1 then
    call RemoveUnit(u)
  endif
  set u=null
  return false
endfunction

function Kaolin_Death_Start takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local group g
  call SetUnitAnimationByIndex(caster,7)
  call TriggerRegisterTimerEvent(t,2.5,false)
  call TriggerAddCondition(t,Condition(function Kaolin_Death_End))
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  if Mode_DM then
    set g=GetAvailableGroup()
    set tt_player1=GetOwningPlayer(caster)
    call GroupEnumUnitsInRange(g,0,0,12400,Condition(function IsStoneDM))
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set caster=null
endfunction

function Kaolin_Death_Init takes nothing returns boolean
  if GetUnitTypeId(GetTriggerUnit())=='N0MU' then
    call Kaolin_Death_Start()
  endif
  return false
endfunction

function Kaolin_Death_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Kaolin_Death_Init))
  set t=null
endfunction


function Oracle_FortunesEnd_Damage takes nothing returns nothing
  call Z48("war3mapImported\\FortunesEndTarget.mdx",GetEnumUnit(),"origin",3)
  call IssueTargetOrder(Oracle_TempDummy,"purge",GetEnumUnit())
  if Oracle_PurgeTrigger!=null and GetUnitAbilityLevel(GetEnumUnit(),'A2T4')>0 then
    call TriggerEvaluate(Oracle_PurgeTrigger)
  endif
  call DamageTarget(Oracle_TempCaster,GetEnumUnit(),1,75*Oracle_TempLvl)
endfunction

function Oracle_FortunesEnd_EndCast takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local unit target=(LoadUnitHandle(hashtable019,(GetHandleId(caster)),(796)))
  local real time=RMinIF((TimerGetElapsed(GlobalTimer))-(LoadReal(hashtable019,(GetHandleId(caster)),358)),3)
  local integer lvl=GetUnitAbilityLevel(caster,'A2QT')
  local integer dummyLevel=R2I(2.0*time)
  local unit dummy=CreateUnit(GetOwningPlayer(caster),'e00E',GetUnitX(caster),GetUnitY(caster),GetUnitFacing(caster))
  local unit visionDummy
  local group g
  if target!=null then
    set visionDummy=CreateUnit(GetOwningPlayer(caster),'o00Z',GetUnitX(target),GetUnitY(target),0)
    call UnitApplyTimedLife(visionDummy,'BTLF',0.5)
    call UnitAddAbility(dummy,'A2T2')
    call SetUnitAbilityLevel(dummy,'A2T2',dummyLevel)
    set tt_unit1=caster
    set Oracle_TempCaster=caster
    set Oracle_TempDummy=dummy
    set Oracle_TempLvl=lvl
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(target),GetUnitY(target),240,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function Oracle_FortunesEnd_Damage)
    call KillGroup(g)
  endif
  set caster=null
  set target=null
  set dummy=null
  set visionDummy=null
  set g=null
endfunction

function Oracle_FortunesEnd_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(14)))
  local unit target=(LoadUnitHandle(hashtable019,(h),(17)))
  if GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call SaveReal(hashtable019,(GetHandleId(caster)),(356),((GetUnitX(target))*1.0))
    call SaveReal(hashtable019,(GetHandleId(caster)),(357),((GetUnitY(target))*1.0))
  endif
  call FlushChildHashtable(hashtable019,(h))
  call CleanTrigger(t)
  set t=null
  set caster=null
  set target=null
  return false
endfunction

function Oracle_FortunesEnd_OnCast takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local unit caster=GetTriggerUnit()
  call SaveReal(hashtable019,(GetHandleId(caster)),(358),(((TimerGetElapsed(GlobalTimer)))*1.0))
  call SaveUnitHandle(hashtable019,(GetHandleId(caster)),(796),(GetSpellTargetUnit()))
  call DestroyEffect(AddSpecialEffect("war3mapImported\\CleanseTargetArea.mdx",GetUnitX(GetSpellTargetUnit()),GetUnitY(GetSpellTargetUnit())))
  call SaveUnitHandle(hashtable019,(h),(14),(caster))
  call SaveUnitHandle(hashtable019,(h),(17),(GetSpellTargetUnit()))
  call TriggerRegisterTimerEvent(t,10,false)
  call TriggerRegisterDeathEvent(t,GetSpellTargetUnit())
  call TriggerAddCondition(t,Condition(function Oracle_FortunesEnd_Duration))
  set t=null
  set caster=null
endfunction

function Oracle_FortunesEnd_Sup takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call SaveBoolean(hashtable019,(GetHandleId(GetTriggerUnit())),(360),(true))
  endif
endfunction

function Oracle_FortunesEnd_Init takes nothing returns boolean
  if GetSpellAbilityId()=='A2QT' then
    //if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_CAST then
    //call SaveBoolean(HY,(GetHandleId(GetTriggerUnit())),(360),(false))
    //call Oracle_FortunesEnd_OnCast()
    //elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT then
    //	if IsBlocked(GetSpellTargetUnit())==false then
    //		call SaveBoolean(HY,(GetHandleId(GetTriggerUnit())),(360),(true))
    //	endif
    if(LoadBoolean(hashtable019,(GetHandleId(GetTriggerUnit())),(360)))==true then
      call Oracle_FortunesEnd_EndCast()
    endif
  endif
  return false
endfunction

function Oracle_FortunesEnd_OnCastSup takes nothing returns nothing
  call SaveBoolean(hashtable019,(GetHandleId(GetTriggerUnit())),(360),(false))
  call Oracle_FortunesEnd_OnCast()
endfunction


function Oracle_FortunesEnd_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_ENDCAST)
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function Oracle_FortunesEnd_Init))
  set t=null
endfunction

function Oracle_FatesEdict_Amplify takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit target=(LoadUnitHandle(hashtable019,(h),(17)))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    call DisableTrigger(t)
    call DamageTarget(GetEventDamageSource(),target,3,0.5*GetEventDamage())
    call EnableTrigger(t)
  endif
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED or IsDead(target)then
    call DestroyEffect((LoadEffectHandle(hashtable019,(h),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(h),(176))))
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
    call UnitRemoveAbility(target,'A2T4')
    set Oracle_PurgeTrigger=null
  endif
  set t=null
  set target=null
  return false
endfunction

function Oracle_FatesEdict_Start takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  local integer lvl=GetUnitAbilityLevel(caster,'A2T5')
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  set Oracle_PurgeTrigger=t
  call Attack_Disable(target,2+lvl,0,0)
  call UnitAddAbility2(target,'A2T4')
  call SetPlayerAbilityAvailable(GetOwningPlayer(target),'A2T4',false)
  call TriggerRegisterTimerEvent(t,2+lvl,false)
  call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DAMAGED)
  call TriggerRegisterDeathEvent(t,target)
  call TriggerAddCondition(t,Condition(function Oracle_FatesEdict_Amplify))
  call SaveUnitHandle(hashtable019,(h),(17),(target))
  call SaveEffectHandle(hashtable019,(h),(175),(AddSpecialEffectTarget("war3mapImported\\FatesEdict.mdx",target,"origin")))
  call SaveEffectHandle(hashtable019,(h),(176),(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl",target,"overhead")))
  set caster=null
  set target=null
  set t=null
endfunction

function Oracle_FatesEdict_Sup takes nothing returns nothing
  if IsUnitEnemy(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))==false or IsBlocked(GetSpellTargetUnit())==false then
    call Oracle_FatesEdict_Start()
  endif
endfunction

function Oracle_FatesEdict_Init takes nothing returns boolean
  if GetSpellAbilityId()=='A2T5' then
    if IsUnitEnemy(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))==false or IsBlocked(GetSpellTargetUnit())==false then
      call Oracle_FatesEdict_Start()
    endif
  endif
  return false
endfunction

function Oracle_FatesEdict_Reg takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Oracle_FatesEdict_Init))
  //set t=null
endfunction

function Oracle_PurifingFlames_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local unit target=(LoadUnitHandle(hashtable019,(h),(17)))
  local integer lvl=IMaxIF(GetUnitAbilityLevel(caster,'A2SG'),GetUnitAbilityLevel(caster,'QB0O'))
  local integer counter=(LoadInteger(hashtable019,(h),(34)))
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or counter>9 then
    call DestroyEffect((LoadEffectHandle(hashtable019,(h),(32))))
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT then
    if GetSpellAbilityId()=='A2T2' and GetSpellTargetUnit()==target then
      call DestroyEffect((LoadEffectHandle(hashtable019,(h),(32))))
      call FlushChildHashtable(hashtable019,(h))
      call CleanTrigger(t)
    endif
  else
    set counter=counter+1
    call SaveInteger(hashtable019,(h),(34),(counter))
    call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+11*lvl)
  endif
  set t=null
  set caster=null
  set target=null
  return false
endfunction

function Oracle_PurifingFlames_Start takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local unit caster=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  local integer lvl=IMaxIF(GetUnitAbilityLevel(caster,'A2SG'),GetUnitAbilityLevel(caster,'QB0O'))
  local real dmg=lvl*90
  local real resist=0.75
  call TriggerRegisterDeathEvent(t,target)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function Oracle_PurifingFlames_Duration))
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  call SaveUnitHandle(hashtable019,(h),(17),(target))
  call SaveInteger(hashtable019,(h),(5),(lvl))
  call SaveEffectHandle(hashtable019,(h),(32),(AddSpecialEffectTarget("war3mapImported\\DarkMending.mdx",target,"origin")))
  if IsUnitType(target,UNIT_TYPE_HERO)==false then
    set resist=1.0
  endif
  if GetUnitState(target,UNIT_STATE_LIFE)<=dmg*resist and IsUnitAlly(target,GetOwningPlayer(caster))==true then
    set dmg=GetUnitState(target,UNIT_STATE_LIFE)/0.75-10
  endif
  call DamageTarget(caster,target,1,dmg)
  set t=null
  set caster=null
  set target=null
endfunction

function Oracle_PurifingFlames_InitSup takes nothing returns nothing
  if IsUnitEnemy(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))==false or IsBlocked(GetSpellTargetUnit())==false then
    call Oracle_PurifingFlames_Start()
  endif
  
endfunction

function Oracle_PurifingFlames_Init takes nothing returns boolean
  if GetSpellAbilityId()=='A2SG' or GetSpellAbilityId()=='QB0O' then
    if IsUnitEnemy(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))==false or IsBlocked(GetSpellTargetUnit())==false then
      call Oracle_PurifingFlames_Start()
    endif
  endif
  return false
endfunction

function Oracle_PurifingFlames_Reg takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Oracle_PurifingFlames_Init))
  //set t=null
endfunction

function Oracle_FalsePromise_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local unit target=(LoadUnitHandle(hashtable019,(h),(17)))
  local integer instances=(LoadInteger(hashtable019,(h),(34)))
  local integer counter=(LoadInteger(hashtable019,(h),(25)))
  local integer lvl=(LoadInteger(hashtable019,(h),(5)))
  local integer i=0
  local real storedHP=(LoadReal(hashtable019,(h),(697)))
  local real storedMP=(LoadReal(hashtable019,(h),(811)))
  local real curLife=GetUnitState(target,UNIT_STATE_LIFE)
  local real curMana=GetUnitState(target,UNIT_STATE_MAX_LIFE)
  local real TotalHeal=(LoadReal(hashtable019,(h),(808)))
  local real HPHeal
  local real dmg
  local boolean isBalanced=LoadBoolean(hashtable019,h,5)
  local integer limit=lvl+6
  if isBalanced then
    set limit=limit-2
  endif
  if counter>(limit)*50 or GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call DisableTrigger(t)
    call DestroyEffect((LoadEffectHandle(hashtable019,(h),(32))))
    call UnitRemoveAbility(target,'A2T0')
    call UnitRemoveAbility(target,'A2SZ')
    if GetTriggerEventId()!=EVENT_WIDGET_DEATH then
      set TotalHeal=TotalHeal*2
      loop
        exitwhen i>instances
        set i=i+1
        set curLife=GetUnitState(target,UNIT_STATE_LIFE)
        set HPHeal=RMinBJ(curMana-curLife,TotalHeal)
        call SetUnitState(target,UNIT_STATE_LIFE,curLife+HPHeal)
        set TotalHeal=TotalHeal-HPHeal
        set dmg=(LoadReal(hashtable019,(h),(20000+i)))
        if(LoadUnitHandle(hashtable019,(h),(22000+i)))==caster or((LoadInteger(hashtable019,(GetHandleId((target))),((2485))))==1)then
          if GetUnitState(target,UNIT_STATE_LIFE)<=dmg+2 then
            set dmg=GetUnitState(target,UNIT_STATE_LIFE)-2
          endif
        endif
        call DamageTarget((LoadUnitHandle(hashtable019,(h),(22000+i))),target,6,dmg)
      endloop
      set curLife=GetUnitState(target,UNIT_STATE_LIFE)
      set HPHeal=RMinBJ(curMana-curLife,TotalHeal)
      call SetUnitState(target,UNIT_STATE_LIFE,curLife+HPHeal)
      set TotalHeal=TotalHeal-HPHeal
    endif
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED and IsDamageReal(GetEventDamage())then
    set instances=instances+1
    call SaveInteger(hashtable019,(h),(34),(instances))
    call SaveUnitHandle(hashtable019,(h),(22000+instances),(GetEventDamageSource()))
    call SaveReal(hashtable019,(h),(20000+instances),((GetEventDamage())*1.0))
    call HealUnitFor(target,GetEventDamage())
  elseif GetTriggerEventId()!=EVENT_UNIT_DAMAGED and GetTriggerEventId()!=EVENT_WIDGET_DEATH then
    set counter=counter+1
    call SaveInteger(hashtable019,(h),(25),(counter))
    if curMana!=storedMP then
      set storedMP=curMana
      set storedHP=curLife
      call SaveReal(hashtable019,(h),(697),((storedHP)*1.0))
      call SaveReal(hashtable019,(h),(811),((storedMP)*1.0))
    endif
    if curLife>storedHP then
      if((LoadInteger(hashtable019,(GetHandleId((target))),((4298))))==1)==false then
        set TotalHeal=TotalHeal+curLife-storedHP
        call SaveReal(hashtable019,(h),(808),((TotalHeal)*1.0))
      else
        call SetUnitState(target,UNIT_STATE_LIFE,curLife)
      endif
    endif
    call SetUnitState(target,UNIT_STATE_LIFE,storedHP)
  endif
  set t=null
  set target=null
  set caster=null
  return false
endfunction

function Oracle_FalsePromise_Start takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local integer lvl=GetUnitAbilityLevel(caster,'A2TF')+GetUnitAbilityLevel(caster,'QB11')
  local boolean isBalanced=GetUnitAbilityLevel(caster,'QB11')>0
  call UnitRemoveAbility(target,'B09Y')//phase
  call UnitAddAbility2(target,'A2T0')
  call UnitAddAbility2(target,'A2SZ')
  call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DAMAGED)
  call TriggerRegisterDeathEvent(t,target)
  call TriggerRegisterTimerEvent(t,0.02,true)
  call TriggerAddCondition(t,Condition(function Oracle_FalsePromise_Duration))
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  call SaveUnitHandle(hashtable019,(h),(17),(target))
  call SaveInteger(hashtable019,(h),(34),(0))
  call SaveInteger(hashtable019,(h),(25),(0))
  call SaveInteger(hashtable019,(h),(5),(lvl))
  call SaveBoolean(hashtable019,h,5,isBalanced)
  call SaveReal(hashtable019,(h),(808),((0)*1.0))
  call SaveReal(hashtable019,(h),(697),((GetUnitState(target,UNIT_STATE_LIFE))*1.0))
  call SaveReal(hashtable019,(h),(811),((GetUnitState(target,UNIT_STATE_MAX_LIFE))*1.0))
  call SaveEffectHandle(hashtable019,(h),(32),(AddSpecialEffectTarget("war3mapImported\\FalsePromise.mdx",target,"chest")))
  call RemoveDispellableBuffs(target)
  call E79(target,0,0)
  set caster=null
  set target=null
  set t=null
endfunction

function Oracle_FalsePromise_Init takes nothing returns boolean
  if GetSpellAbilityId()=='A2TF' then
    call Oracle_FalsePromise_Start()
  endif
  return false
endfunction

function Oracle_FalsePromise_Reg takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Oracle_FalsePromise_Init))
  //set t=null
endfunction



function Earthshaker_Aftershock_Effect takes unit u, integer level,real x, real y returns nothing
  local unit d = CreateUnit(GetOwningPlayer(u),'e00E',x,y,0)
  local integer id='QD85'
  if Mode_BO then
    set id='A0DI'
  endif
  call UnitAddAbility(d,id)
  call SetUnitAbilityLevel(d,id,level)
  call IssueImmediateOrderById(d,852127)
  set d = null
endfunction

function AfterShock_cd takes nothing returns nothing
  local timer t=GetExpiredTimer()
  call SaveBoolean(hashtable019,LoadInteger(hashtable019,GetHandleId(t),0),StringHash("aftershock_cd"),false)
  call DestroyTimer(t)
  set t=null
endfunction

function Earthshaker_Aftershock_Condition takes unit u, integer spell returns nothing
  local integer level = GetUnitAbilityLevel(u,'A0DJ')
  local timer t
  if GetUnitAbilityLevel(u,'QF85')>0 then//balanced
    set level=GetUnitAbilityLevel(u,'QF85')
  elseif GetUnitAbilityLevel(u,'QP1G')>0 then//hidden normal
    set level=GetUnitAbilityLevel(u,'QP1G')
  elseif GetUnitAbilityLevel(u,'QP1H')>0 then//hidden balanced
    set level=GetUnitAbilityLevel(u,'QP1H')
  endif
  if level>0 then
    if (Mode_EB and (Valid_Spell(spell) or Reduced_Spell(spell)==true) and LoadBoolean(hashtable019,GetHandleId(u),StringHash("aftershock_cd"))==false)or(Mode_EB==false and Valid_Spell(spell)) or (Mode_BO and BalanceOffSpellChecker(spell)) then
      call Earthshaker_Aftershock_Effect(u,level,GetUnitX(u),GetUnitY(u))
      if Mode_EB then
        call SaveBoolean(hashtable019,GetHandleId(u),StringHash("aftershock_cd"),true)
        set t=CreateTimer()
        call TimerStart(t,1.6,false,function AfterShock_cd)
        call SaveInteger(hashtable019,GetHandleId(t),0,GetHandleId(u))
        set t=null
      endif
    endif
  endif
  
endfunction



function T8E takes nothing returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(GetEnumUnit()),'e00E',GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
  call UnitAddAbility2(Caster,'A0SJ')
  call SetUnitAbilityLevel(Caster,'A0SJ',tt_int1)
  call IssueTargetOrderById(Caster,852095,GetEnumUnit())
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),1,tt_real1)
  set Caster=null
endfunction

function ES_Fissure takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local location l=GetSpellTargetLoc()
  local integer i=1
  local real SourceX=GetUnitX(Hero)
  local real SourceY=GetUnitY(Hero)
  local real TargetX
  local real TargetY
  local real x
  local real y
  local real a
  local group g=GetAvailableGroup()
  local group g2=GetAvailableGroup()
  if Target==null then
    set TargetX=GetLocationX(l)
    set TargetY=GetLocationY(l)
  else
    set TargetX=GetUnitX(Target)
    set TargetY=GetUnitY(Target)
  endif
  set a=bj_DEGTORAD*AngleBetweenXY(SourceX,SourceY,TargetX,TargetY)
  call RemoveLocation(l)
  loop
    exitwhen i>22
    set x=SafeX50(SourceX+i*60*Cos(a))
    set y=SafeY50(SourceY+i*60*Sin(a))
    call GroupEnumUnitsInRange(g2,x,y,250,Condition(function LR8))
    call GroupAddGroup(g2,g)
    call GroupClear(g2)
    call B88(CreateDestructable('B000',x,y,GetRandomReal(0,360),.5,GetRandomInt(0,2)),8)
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Volcano\\VolcanoDeath.mdl",x,y))
    set i=i+1
  endloop
  set tt_int1=GetUnitAbilityLevel(Hero,'A0SK')
  set tt_real1=tt_int1*50+75
  call ForGroup(g,function T8E)
  call KillGroup(g)
  call KillGroup(g2)
  set g=null
  set g2=null
  set Target=null
  set Hero=null
  set l=null
endfunction

function KN9 takes nothing returns nothing
  call PreloadAbility('A0SJ')
endfunction

function EnchantTotemOnDamage takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  else
    if GetEventDamageSource()==LoadUnitHandle(hashtable019,h,0) and IsFakeDamage==false and IsRealDamage then
      call UnitRemoveAbility(LoadUnitHandle(hashtable019,h,0),'Broa')
      call FlushChildHashtable(hashtable019,h)
      call CleanTrigger(t)
    endif
  endif
  set t=null
endfunction

function EnchantTotemOnAttack takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local trigger tt
  if GetAttacker()==LoadUnitHandle(hashtable019,GetHandleId(t),0) and GetUnitAbilityLevel(LoadUnitHandle(hashtable019,GetHandleId(t),0),'Broa')>0 then
    set tt=CreateTrigger()
    call TriggerRegisterTimerEvent(tt,3,false)
    call TriggerRegisterUnitEvent(tt,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
    call TriggerAddCondition(tt,Condition(function EnchantTotemOnDamage))
    call SaveUnitHandle(hashtable019,GetHandleId(tt),0,GetAttacker())
    set tt=null
  elseif GetTriggerEventId()!=EVENT_PLAYER_UNIT_ATTACKED or GetUnitAbilityLevel(LoadUnitHandle(hashtable019,GetHandleId(t),0),'Broa')==0 then
    call FlushChildHashtable(hashtable019,GetHandleId(t))
    call CleanTrigger(t)
  endif
  set t=null
endfunction

function EnchantTotemOnCast takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call SaveUnitHandle(hashtable019,h,0,GetTriggerUnit())
  call TriggerRegisterTimerEvent(t,15,false)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function EnchantTotemOnAttack))
  set t=null
endfunction

function AfterShock_Orbs_RemoveBuff takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call UnitRemoveAbility(Source,'Broa')
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function AfterShock_Orbs_Condition takes nothing returns boolean
  local trigger t
  local integer Cache
  if GetUnitAbilityLevel(GetTriggerUnit(),'Broa')>0 then
    if isPoisonArrowSkill(GetSpellAbilityId())==true then
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call TriggerRegisterTimerEvent(t,0.1,false)
      call TriggerAddCondition(t,Condition(function AfterShock_Orbs_RemoveBuff))
      call SaveUnitHandle(hashtable019,(Cache),(2),(GetTriggerUnit()))
    endif
  endif
  set t=null
  return false
endfunction

function AfterShock_Orbs takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function AfterShock_Orbs_Condition))
  set t=null
endfunction

function ES_EchoSlam_ForGroup takes nothing returns nothing
  local real x=GetUnitX(GetEnumUnit())
  local real y=GetUnitY(GetEnumUnit())
  local integer id=GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
  call SetUnitX(EP8[id],x)
  call SetUnitY(EP8[id],y)
  call IssueImmediateOrderById(EP8[id],852526)
endfunction

function ES_EchoSlam_AghanimPart takes nothing returns nothing
  local real x=GetUnitX(GetEnumUnit())
  local real y=GetUnitY(GetEnumUnit())
  local integer id=GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
  if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO) or IsUnitIllusion(GetEnumUnit())==true then
    call SetUnitX(EP8[id],x)
    call SetUnitY(EP8[id],y)
    call IssueImmediateOrderById(EP8[id],852526)
  endif
endfunction

function ES_EchoSlam_Filter takes nothing returns boolean
  return(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit())) and IsDead(GetFilterUnit())==false)!=null
endfunction

function ES_EchoSlam_Act takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local group g=GetAvailableGroup()
  local integer id=GetPlayerId(GetOwningPlayer(Source))
  local integer Level=GetUnitAbilityLevel(Source,'A0DH')
  local unit d = CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  call UnitAddAbility(d,'A0DI')
  call SetUnitAbilityLevel(d,'A0DI',4)
  call IssueImmediateOrderById(d,852127)
  set d = null
  if Level==0 then
    set Level=GetUnitAbilityLevel(Source,'A1OB')
  endif
  set EP8[id]=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  set EQ8[id]=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  call SetUnitScale(EP8[id],.25,.25,.25)
  call UnitAddAbility2(EP8[id],'A0DM')
  call UnitAddAbility2(EQ8[id],'A1H0')
  call SetUnitAbilityLevel(EP8[id],'A0DM',Level)
  call SetUnitAbilityLevel(EQ8[id],'A1H0',Level)
  call GroupEnumUnitsInRange(g,x,y,575,Condition(function ES_EchoSlam_Filter))
  call ForGroup(g,function ES_EchoSlam_ForGroup)
  if GetUnitAbilityLevel(Source,'A1OB')>0 then
    call ForGroup(g,function ES_EchoSlam_AghanimPart)
  endif
  call KillGroup(g)
  set Source=null
  set g=null
endfunction

function ES_EchoSlam_Reg takes nothing returns nothing
  call PreloadAbility('A0DM')
endfunction

function TQE takes nothing returns boolean
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT then
    return GetUnitAbilityLevel(GetSpellTargetUnit(),('P009'))>0 //A0DW
  else
    return GetUnitAbilityLevel(GetTriggerUnit(),('P009'))>0 //A0DW
  endif
endfunction

function TRE takes nothing returns nothing
  local unit Source
  local unit Target
  local unit Caster
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT then
    set Source=GetSpellTargetUnit()
    set Target=GetTriggerUnit()
  else
    set Source=GetTriggerUnit()
    set Target=GetAttacker()
  endif
  set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,('A0B0'))
  call SetUnitAbilityLevel(Caster,('A0B0'),GetUnitAbilityLevel(Source,('P009'))) //A0DW
  call IssueTargetOrderById(Caster,852662,Target)
  set Source=null
  set Caster=null
  set Target=null
endfunction

function Func1142 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function TQE))
  call TriggerAddAction(t,function TRE)
  set t=null
endfunction

function TSE takes nothing returns boolean
  return((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)!=GetUnitState(GetFilterUnit(),UNIT_STATE_MAX_LIFE))!=null
endfunction

function TTE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer unit060=(LoadInteger(hashtable019,(Cache),(28)))
  local group g
  local unit unit039
  if unit060>10 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SaveInteger(hashtable019,(Cache),(28),(unit060+1))
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),300,Condition(function TSE))
    set unit039=GroupPickRandomUnit(g)
    call KillGroup(g)
    call SetUnitState(unit039,UNIT_STATE_LIFE,GetUnitState(unit039,UNIT_STATE_LIFE)+10)
  endif
  set t=null
  set Source=null
  set g=null
  set unit039=null
  return false
endfunction

function TUE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call AddUnitAnimationProperties(Source,"alternate",false)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function Enchantress_NaturesAttendants takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local integer i=1
  local trigger t
  local integer Cache
  loop
    exitwhen i>(1+2*GetUnitAbilityLevel(Source,'A01B'))
    set t=CreateTrigger()
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Source))
    call SaveInteger(hashtable019,(GetHandleId(t)),(28),(0))
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function TTE))
    set i=i+1
  endloop
  if GetUnitTypeId(Source)=='E02X' then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,0,false)
    call TriggerAddCondition(t,Condition(function TUE))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    set t=null
  endif
  set t=null
  set Source=null
endfunction

function TXE takes real x1,real y1,real x2,real y2 returns real
  return SquareRoot(((x1-x2)*(x1-x2))+((y1-y2)*(y1-y2)))
endfunction

function TYE takes unit u returns integer
  local integer Level=GetUnitAbilityLevel(u,'A0DY')
  if Level>0 then
    return Level
  endif
  set Level=GetUnitAbilityLevel(u,'A1WB')
  return Level
endfunction

function TZE takes nothing returns boolean
  local real d
  local real TAE
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetUnitAbilityLevel(GetTriggerUnit(),'B03U')>0 and TYE(GetEventDamageSource())>0 and(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(2)))==GetEventDamageSource()then
      call UnitRemoveAbility(GetTriggerUnit(),'B03U')
      set TAE=RMinBJ(TXE(GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),GetUnitX(GetEventDamageSource()),GetUnitY(GetEventDamageSource())),2500)
      set d=(.1+.05*I2R(TYE(GetEventDamageSource())))*TAE
      call TextTagOnUnit("+"+I2S(R2I(d)),1,GetTriggerUnit(),.023,3,216,216,216)
      call DisableTrigger(GetTriggeringTrigger())
      call DamageTarget(GetEventDamageSource(),GetTriggerUnit(),3,d)
      call FlushChildHashtable(hashtable019,(GetHandleId(GetTriggeringTrigger())))
      call CleanTrigger(GetTriggeringTrigger())
    endif
  else
    call FlushChildHashtable(hashtable019,(GetHandleId(GetTriggeringTrigger())))
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function TBE takes nothing returns nothing
  local trigger t
  local unit Target
  local unit Source
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    set Target=GetSpellTargetUnit()
    set Source=GetTriggerUnit()
  else
    set Target=GetTriggerUnit()
    set Source=GetAttacker()
  endif
  if IsUnitIllusion(Source)==false then
    set t=CreateTrigger()
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Source))
    call TriggerRegisterTimerEvent(t,6,false)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerAddCondition(t,Condition(function TZE))
  endif
  set t=null
  set Target=null
  set Source=null
endfunction

function TCE takes nothing returns boolean
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if TYE(GetAttacker())>0 and(LoadBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263)))and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetAttacker()==(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(14)))then
      call TBE()
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER then
    if(GetIssuedOrderId()==852255)then
      call SaveBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263),(true))
    elseif(GetIssuedOrderId()==852256)then
      call SaveBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263),(false))
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and(GetSpellAbilityId()=='A0DY' or GetSpellAbilityId()=='A1WB')then
    call TBE()
  endif
  return false
endfunction

function Enchantress_Impetus_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function TCE))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(GetTriggerUnit()))
  set t=null
endfunction

function T6E takes nothing returns boolean
  if(GetLearnedSkill()=='A0DY' or GetLearnedSkill()=='A1WB')and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Enchantress_Impetus_Learn()
  endif
  return false
endfunction

function KT9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function T6E))
  set t=null
endfunction

function TLE takes unit u returns boolean
  return IsUnitType(u,UNIT_TYPE_HERO)==false and IsUnitType(u,UNIT_TYPE_ANCIENT)==false and GetUnitTypeId(u)!='n01E' and GetUnitTypeId(u)!='n019'
endfunction

function T1E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call UnitRemoveAbility(Target,'Bslo')
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Target=null
  return false
endfunction

function T0E takes nothing returns nothing
  local unit Target=GetSpellTargetUnit()
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer p=GetPlayerId(GetOwningPlayer(Target))
  if p>-1 and p<7 then
    call UnitShareVision(Target,Scourges[0],false)
    call UnitShareVision(Target,Scourges[1],false)
    call UnitShareVision(Target,Scourges[2],false)
    call UnitShareVision(Target,Scourges[3],false)
    call UnitShareVision(Target,Scourges[4],false)
    call UnitShareVision(Target,Scourges[5],false)
  else
    call UnitShareVision(Target,Sentinels[0],false)
    call UnitShareVision(Target,Sentinels[1],false)
    call UnitShareVision(Target,Sentinels[2],false)
    call UnitShareVision(Target,Sentinels[3],false)
    call UnitShareVision(Target,Sentinels[4],false)
    call UnitShareVision(Target,Sentinels[5],false)
  endif
  call TriggerRegisterTimerEvent(t,.01,false)
  call TriggerAddCondition(t,Condition(function T1E))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SetUnitOwner(Target,GetOwningPlayer(Source),true)
  call UnitApplyTimedLife(Target,'BTLF',80)
  call UnitAddAbility2(Target,'Aeth')
  call UnitAddAbility2(Target,'A12G')
  
  call YZ8(Target)
  set Target=null
  set Source=null
  set t=null
endfunction

function Enchantress_Enchant takes nothing returns nothing
  if TLE(GetSpellTargetUnit())then
    call T0E()
  endif
endfunction

function Enigma_MidnightPulse takes nothing returns nothing
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local unit Source=GetTriggerUnit()
  local real x0=GetUnitX(Source)
  local real y0=GetUnitY(Source)
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x0,y0,0)
  //call ShowUnit(Caster,false)
  call UnitApplyTimedLife(Caster,'BTLF',8)
  call UnitAddAbility(Caster,'A0B2')
  call SetUnitAbilityLevel(Caster,'A0B2',GetUnitAbilityLevel(Source,'A0B1'))
  if IssuePointOrderById(Caster,852221,x,y) then
    
  else
    //call BJDebugMsg("FAILS")
  endif
  set Source=null
  set Caster=null
endfunction

function Enigma_Malefice_Damage takes unit Source,unit Target,integer Level returns nothing
  local real Damage =10+15*Level
  local real stundur=0.25*Level
  call StunTarget(Target,Target,stundur)
  call DamageTarget(Source,Target,1,Damage)
endfunction

function Enigma_Malefice_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  call Enigma_Malefice_Damage(Source,Target,Level)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Enigma_Malefice_Act takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t
  local integer Cache
  local integer Level=GetUnitAbilityLevel(Source,'A0I7')
  call Enigma_Malefice_Damage(Source,Target,Level)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call TriggerRegisterTimerEvent(t,2,false)
  call TriggerAddCondition(t,Condition(function Enigma_Malefice_Duration))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call TriggerRegisterTimerEvent(t,4,false)
  call TriggerAddCondition(t,Condition(function Enigma_Malefice_Duration))
  set t=null
  set Source=null
  set Target=null
endfunction

function Enigma_Malefice_InitSup takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call Enigma_Malefice_Act()
  endif
endfunction

function DemonicConversion_Delayed takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  call UnitAddAbility2(Caster,'A17Z')
  call SetUnitAbilityLevel(Caster,'A17Z',Level)
  call IssueImmediateOrder(Caster,"slimemonster")
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Caster=null
  return false
endfunction

function Enigma_DemonicConversion takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real x=GetUnitX(Target)
  local real y=GetUnitY(Target)
  local integer Level=GetUnitAbilityLevel(Source,'A180')
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  call SetUnitState(Target,UNIT_STATE_LIFE,1)
  call DamageTarget(Source,Target,2,20)
  call DamageTarget(Source,Target,1,20)
  call DamageTarget(Source,Target,3,20)
  call UnitAddAbility2(Caster,'A17Z')
  call SetUnitAbilityLevel(Caster,'A17Z',Level)
  call IssueImmediateOrderById(Caster,852667)
  set Source=null
  set Target=null
  set Caster=null
endfunction

function Enigma_DemonicConversion_OnCast takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer integer475=GetUnitLevel(Target)
  if GetOwningPlayer(Target)!=Sentinels[0]and GetOwningPlayer(Target)!=Scourges[0]and LoadInteger(UnitStats,GetUnitTypeId(Target),EXP)>88 then
    call InterruptUnit(Hero)
    call Error(GetOwningPlayer(Hero),GetObjectName('n0CX'))
  endif
  set Hero=null
  set Target=null
endfunction

function DemonicConversion_Recolor takes nothing returns boolean
  local integer id=GetUnitTypeId(GetTriggerUnit())
  if id=='hwat' or id=='hwt2' or id=='hwt3' or id=='h006' then
    call SetUnitVertexColor(GetSummonedUnit(),0,0,50,255)
  endif
  return false
endfunction

function integer484 takes real x returns real
  local real X38=GetRectMinX(bj_mapInitialPlayableArea)+150
  if(x<X38)then
    return X38
  endif
  set X38=GetRectMaxX(bj_mapInitialPlayableArea)-150
  if(x>X38)then
    return X38
  endif
  return x
endfunction

function integer479 takes real y returns real
  local real X38=GetRectMinY(bj_mapInitialPlayableArea)+150
  if(y<X38)then
    return X38
  endif
  set X38=GetRectMaxY(bj_mapInitialPlayableArea)-150
  if(y>X38)then
    return X38
  endif
  return y
endfunction

function UNE takes nothing returns boolean//AKG
  return(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or integers138(GetUnitTypeId(GetFilterUnit()))or IsUnitSpiritBear(GetFilterUnit())or GetUnitTypeId(GetFilterUnit())=='n00U' or GetUnitTypeId(GetFilterUnit())=='n00Y' or GetUnitTypeId(GetFilterUnit())=='n00Z' or GetUnitTypeId(GetFilterUnit())=='n0KU' or GetUnitTypeId(GetFilterUnit())=='n0KV' or GetUnitTypeId(GetFilterUnit())=='n0KW' or IsUnitFamiliar(GetUnitTypeId(GetFilterUnit())))and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer((LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(318))))))!=null
endfunction

function integer481 takes nothing returns nothing
  local location integer482=GetUnitLoc(GetEnumUnit())
  local location integer483=GetUnitLoc((LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(318))))
  local location integer477=S38(integer483,DistanceBetweenPoints(integer483,integer482)-2,AngleBetweenPoints(integer483,integer482))
  local integer dadl=GetUnitAbilityLevel(BlackholeCaster,'A0B1')
  local real dmg=0
  if dadl==0 then
    set dadl=4
  endif
  if GetUnitAbilityLevel(BlackholeCaster,'A30L')>0 and AghBlackHoleDamage then
    set AghBlackHoleDamage=false
    set dmg=(GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)/100*(dadl+3))//*0.05
    //call echo(R2S(dmg))
    call DamageTarget(BlackholeCaster,GetEnumUnit(),7,dmg)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl",GetEnumUnit(),"origin"))
  endif
  call SetUnitFacing(GetEnumUnit(),AngleBetweenPoints(integer483,integer482))
  call SetUnitPositionLoc(GetEnumUnit(),integer477)
  call RemoveLocation(integer482)
  call RemoveLocation(integer483)
  call RemoveLocation(integer477)
  set integer482=null
  set integer483=null
  set integer477=null
endfunction

function USE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local group HQ9
  local integer Cache=GetHandleId(t)
  local unit UTE=(LoadUnitHandle(hashtable019,(Cache),(318)))
  local unit Caster
  local real x
  local real y
  if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST and (GetSpellAbilityId()=='A1BX' or GetSpellAbilityId()=='A30L') then
    call KillUnit(UTE)
    set Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
    call UnitApplyTimedLife((LoadUnitHandle(hashtable019,(Cache),(250))),'BTLF',1)
    call UnitApplyTimedLife((LoadUnitHandle(hashtable019,(Cache),(251))),'BTLF',1)
    call UnitApplyTimedLife((LoadUnitHandle(hashtable019,(Cache),(252))),'BTLF',1)
    call UnitApplyTimedLife((LoadUnitHandle(hashtable019,(Cache),(253))),'BTLF',1)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call KillUnit(Caster)
  elseif GetTriggerEvalCount(t)>90 then
    set Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
    call UnitApplyTimedLife((LoadUnitHandle(hashtable019,(Cache),(250))),'BTLF',1)
    call UnitApplyTimedLife((LoadUnitHandle(hashtable019,(Cache),(251))),'BTLF',1)
    call UnitApplyTimedLife((LoadUnitHandle(hashtable019,(Cache),(252))),'BTLF',1)
    call UnitApplyTimedLife((LoadUnitHandle(hashtable019,(Cache),(253))),'BTLF',1)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call KillUnit(UTE)
    call KillUnit(Caster)
    call InterruptUnit((LoadUnitHandle(hashtable019,(Cache),(2))))
  else
    set x=GetUnitX(UTE)
    set y=GetUnitY(UTE)
    set BlackholeCaster=(LoadUnitHandle(hashtable019,(Cache),(2)))
    set AghBlackHoleDamage=GetTriggerEvalCount(t)==20 or GetTriggerEvalCount(t)==40 or GetTriggerEvalCount(t)==60 or GetTriggerEvalCount(t)==80
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,x,y,425,Condition(function UNE))
    call ForGroup(HQ9,function integer481)
    call KillGroup(HQ9)
  endif
  set Caster=null
  set UTE=null
  set t=null
  set HQ9=null
  return false
endfunction

function Enigma_BlackHole takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  local unit UTE=CreateUnit(GetOwningPlayer(Source),'u004',x,y,0)
  //call RemoveLocation(l)
  call SetUnitAbilityLevel(UTE,'A0C0',IMaxIF(GetUnitAbilityLevel(Source,'A1BX'),GetUnitAbilityLevel(Source,'A30L')))
  if IsScourge(GetOwningPlayer(Source))then
    call UnitAddAbility2(Caster,'A0X4')
  else
    call UnitAddAbility2(Caster,'A0X3')
  endif
  call IssuePointOrderById(Caster,852473,x,y)
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveUnitHandle(hashtable019,(Cache),(250),(CreateUnit(GetOwningPlayer(Source),'h06R',x,y,0)))
  call SaveUnitHandle(hashtable019,(Cache),(251),(CreateUnit(GetOwningPlayer(Source),'h06R',x,y,0)))
  call SaveUnitHandle(hashtable019,(Cache),(252),(CreateUnit(GetOwningPlayer(Source),'h06R',x,y,0)))
  call SaveUnitHandle(hashtable019,(Cache),(253),(CreateUnit(GetOwningPlayer(Source),'h06R',x,y,0)))
  call SaveUnitHandle(hashtable019,(Cache),(318),(UTE))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerRegisterTimerEvent(t,.05,true)
  
  call TriggerAddCondition(t,Condition(function USE))
  set Source=null
  set UTE=null
  set t=null
  //set l=null
  set Caster=null
endfunction

function UWE takes nothing returns boolean
  //local location l
  local real x
  local real y
  if GetSpellAbilityId()=='A1BX' or GetSpellAbilityId()=='A30L' then
    //set l=GetSpellTargetLoc()
    set x=GetSpellTargetX()
    set y=GetSpellTargetY()
    //call RemoveLocation(l)
    //set l=null
    if(x!=integer484(x)and y!=integer479(y))or RectContainsCoords(boolean025,x,y)or RectContainsCoords(real007,x,y)or RectContainsCoords(BA,x,y)or RectContainsCoords(real006,x,y)or RectContainsCoords(DA,x,y)or RectContainsCoords(integer016,x,y)then
      call InterruptUnit(GetTriggerUnit())
      call Error(GetOwningPlayer(GetTriggerUnit()),"Cannot cast Blackhole here")
    endif
  endif
  return false
endfunction

function Enigma_BlackHole_OnCast takes nothing returns nothing
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  //call RemoveLocation(l)
  //set l=null
  if(x!=integer484(x)and y!=integer479(y))or RectContainsCoords(boolean025,x,y)or RectContainsCoords(real007,x,y)or RectContainsCoords(BA,x,y)or RectContainsCoords(real006,x,y)or RectContainsCoords(DA,x,y)or RectContainsCoords(integer016,x,y)then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),"Cannot cast Blackhole here")
  endif
endfunction

function KV9 takes nothing returns nothing
  call PreloadAbility('A0C0')
endfunction

function integer480 takes nothing returns nothing
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),1,tt_real1)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\StaffOfPurification\\PurificationTarget.mdx",GetEnumUnit(),"chest"))
endfunction

function Puck_WaningRift takes nothing returns nothing
  local group g=GetAvailableGroup()
  local unit Hero=GetTriggerUnit()
  local real x=GetUnitX(Hero)
  local real y=GetUnitY(Hero)
  local integer Level=GetUnitAbilityLevel(Hero,'A0SC')
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',x,y,0)
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\StaffOfPurification\\PurificationCaster.mdx",x,y))
  call UnitAddAbility2(Caster,'A0SD')
  call SetUnitAbilityLevel(Caster,'A0SD',Level)
  call IssuePointOrderById(Caster,852592,x,y)
  set tt_real1=Level*70
  call GroupEnumUnitsInRange(g,x,y,425,Condition(function LS8))
  call ForGroup(g,function integer480)
  call KillGroup(g)
  set Caster=null
  set g=null
  set Hero=null
endfunction

function UAE takes unit Source,unit Target,integer Level,integer A5D returns nothing
  call StunTarget(Source,Target,.75+.75*Level)
  if A5D==1 then
    call DamageTarget(Source,Target,1,Level*50+50)
  else
    call DamageTarget(Source,Target,1,Level*50+50+100)
  endif
endfunction

function UBE takes unit Source,unit Target returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,'A0SF')
  call IssueTargetOrderById(Caster,852095,Target)
  set Caster=null
endfunction

function UCE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer A5D=(LoadInteger(hashtable019,(Cache),(152)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local lightning ZQ8=(LoadLightningHandle(hashtable019,(Cache),(196)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call DestroyLightning(ZQ8)
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call MoveLightning(ZQ8,true,GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))
    if DistanceBetweenXY(GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))>600 then
      call DestroyLightning(ZQ8)
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call UAE(Source,Target,Level,A5D)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set ZQ8=null
  return false
endfunction

function U3E takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local lightning ZQ8=AddLightning("HWPB",true,GetUnitX(EV8),GetUnitY(EV8),GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()))
  call SetLightningColor(ZQ8,0,.7,1,1)
  call SaveLightningHandle(hashtable019,(Cache),(196),(ZQ8))
  call SaveUnitHandle(hashtable019,(Cache),(2),(EV8))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(GetEnumUnit())))
  call SaveInteger(hashtable019,(Cache),(5),(ER8))
  call SaveInteger(hashtable019,(Cache),(152),(ES8))
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerRegisterUnitEvent(t,GetEnumUnit(),EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,EV8,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function UCE))
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),1,ET8)
  call UBE(GetTriggerUnit(),GetEnumUnit())
  set t=null
  set ZQ8=null
endfunction

function Puck_DreamCoil takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00U',x,y,0)
  local group g=GetAvailableGroup()
  local integer Level=GetUnitAbilityLevel(Hero,'A0S8')
  local real DP9=6
  local integer A5D=1
  if Level==0 then
    set Level=GetUnitAbilityLevel(Hero,'A1QP')
    set DP9=8
    set A5D=2
  endif
  //call RemoveLocation(l)
  call SetUnitAnimation(Caster,"channel")
  call BW8(Caster,DP9)
  set EV8=Caster
  set EU8=DP9
  set ET8=Level*50+50
  set ER8=Level
  set ES8=A5D
  set tt_unit1=Hero
  call GroupEnumUnitsInRange(g,x,y,400,Condition(function Func0287))
  call ForGroup(g,function U3E)
  call KillGroup(g)
  set g=null
  set Caster=null
  set Hero=null
  //set l=null
endfunction

function timer004 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Level
  local integer unit060
  local integer d
  if(GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER and GetIssuedOrderId()!=852514)or GetTriggerEventId()==EVENT_UNIT_ISSUED_POINT_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_TARGET_ORDER or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call SetUnitInvulnerable(Hero,false)
    call UnitRemoveAbility(Hero,'A04R')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set Level=(LoadInteger(hashtable019,(Cache),(5)))
    set d=3*Level
    if Level==4 then
      set d=d+1
    endif
    set unit060=(LoadInteger(hashtable019,(Cache),(28)))+1
    call SaveInteger(hashtable019,(Cache),(28),(unit060))
    if unit060>d or DistanceBetweenXY(GetUnitX(Hero),GetUnitY(Hero),(LoadReal(hashtable019,(Cache),(6))),(LoadReal(hashtable019,(Cache),(7))))>125 then
      call SetUnitInvulnerable(Hero,false)
      call UnitRemoveAbility(Hero,'A04R')
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set Hero=null
  return false
endfunction

function Puck_Phaseshift_Delay takes nothing returns nothing
  local timer t = GetExpiredTimer()
  
  call UnitAddAbility(LoadUnitHandle(MHT,GetHandleId(t),0),'A04R')
  
  call Timer_End(t)
  set t = null
endfunction

function U0E takes nothing returns nothing
  local timer time = Timer_Get()
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  
  //delay the adding of the marker ability so other spells can detect phase shift
  call SaveUnitHandle(MHT,GetHandleId(time),0,Hero)
  call TimerStart(time,0,false,function Puck_Phaseshift_Delay)
  
  call SetUnitInvulnerable(Hero,true)
  
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveInteger(hashtable019,(Cache),(5),(GetUnitAbilityLevel(Hero,'A0SB')))
  call SaveInteger(hashtable019,(Cache),(28),(0))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Hero))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Hero))*1.))
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_ISSUED_ORDER)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_ISSUED_POINT_ORDER)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_ISSUED_TARGET_ORDER)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function timer004))
  call AddTimedKeyToUnit(Hero,4266,5.9)
  set t=null
  set Hero=null
  set time=null
endfunction

function LE2 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  call IssueImmediateOrderById(Hero,852516)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  return false
endfunction

function LF2 takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function LE2))
  set t=null
  set Hero=null
endfunction

function U5E takes nothing returns boolean
  if GetIssuedOrderId()==852514and IsUnitIllusion(GetTriggerUnit())==false and((LoadInteger(hashtable019,(GetHandleId((GetTriggerUnit()))),((4266))))==1)==false then
    call U0E()
  elseif GetIssuedOrderId()==852515 then
    call LF2()
  endif
  return false
endfunction

function SF9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function U5E))
  set t=null
endfunction

function booleans025 takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),DK)==false then
    call GroupAddUnit(DK,GetEnumUnit())
    call DamageTarget(tt_unit1,GetEnumUnit(),1,tt_real1)
  endif
endfunction

function V4E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local group V7E
  local real x
  local real y
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    if GetUnitTypeId(Source)=='e00E' then
      set Source=udg_Hero[GetPlayerId(GetOwningPlayer(Source))]
    endif
    set tt_unit1=CreateUnit(GetOwningPlayer(Caster),'h06O',GetUnitX(Source),GetUnitY(Source),0)
    call SetUnitScale(tt_unit1,2.5,2.5,2.5)
    call KillUnit(tt_unit1)
    call SetUnitPosition(Source,GetUnitX(Caster),GetUnitY(Caster))
    call ShowUnit(Source,false)
    call ShowUnit(Source,true)
    call SelectUnitAddForPlayer(Source,GetOwningPlayer(Source))
    set EW8[GetPlayerId(GetOwningPlayer(Caster))]=null
    call KillGroup(g)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEvalCount(t)>120 then
    set EW8[GetPlayerId(GetOwningPlayer(Caster))]=null
    call KillGroup(g)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call SetUnitScale(Caster,2.5,2.5,2.5)
    call KillUnit(Caster)
  else
    set x=GetUnitX(Caster)
    set y=GetUnitY(Caster)
    set V7E=GetAvailableGroup()
    set DK=g
    set tt_unit1=Caster
    set tt_real1=Level*70
    call GroupEnumUnitsInRange(V7E,x,y,250,Condition(function LA8))
    call ForGroup(V7E,function booleans025)
    call KillGroup(V7E)
    call SetUnitX(Caster,SafeX50(x+15*Cos(J2E*bj_DEGTORAD)))
    call SetUnitY(Caster,SafeY50(y+15*Sin(J2E*bj_DEGTORAD)))
  endif
  set t=null
  set g=null
  set V7E=null
  set Caster=null
  set Source=null
  return false
endfunction

function Puck_IllusoryOrb takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local group g=GetAvailableGroup()
  local unit Hero=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x1=GetUnitX(Hero)
  local real y1=GetUnitY(Hero)
  local real x2=GetSpellTargetX()
  local real y2=GetSpellTargetY()
  local real J2E=AngleBetweenXY(x1,y1,x2,y2)
  local integer Level=GetUnitAbilityLevel(Hero,'A0S9')
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'h06O',x1,y1,J2E)
  call PlaySoundAtPos(sound014,x1,y1)
  call UnitAddAbility2(GetTriggerUnit(),'A0SA')
  set EW8[GetPlayerId(GetOwningPlayer(Hero))]=Caster
  call SetUnitScale(Caster,3.5,3.5,3.5)
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveGroupHandle(hashtable019,(Cache),(22),(g))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call TriggerRegisterTimerEvent(t,.025,true)
  call TriggerRegisterUnitEvent(t,Caster,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function V4E))
  //call RemoveLocation(l)
  set t=null
  set Caster=null
  set g=null
  set Hero=null
  //set l=null
endfunction

function Puck_EtherealJaunt takes nothing returns nothing
  local integer i=GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
  if EW8[i]==null then
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n037'))
  else
    call SetUnitScale(EW8[i],2.5,2.5,2.5)
    call KillUnit(EW8[i])
  endif
endfunction

function IllusoryOrb_Learn takes nothing returns boolean
  if GetLearnedSkill()=='A0S9' and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call UnitAddAbility2(GetTriggerUnit(),'A0SA')
  endif
  return false
endfunction

function VFE takes nothing returns nothing
  call SetUnitX(GetEnumUnit(),EX8)
  call SetUnitY(GetEnumUnit(),EY8)
endfunction

function Prophet_Sprout takes nothing returns nothing
  local destructable array dx
  local integer VT8
  local integer VU8
  local fogmodifier VHE
  local unit Caster=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local location unit049
  local real x
  local real y
  local group g=GetAvailableGroup()
  if Target==null then
    set unit049=GetSpellTargetLoc()
  else
    set unit049=GetUnitLoc(Target)
  endif
  set x=GetLocationX(unit049)
  set y=GetLocationY(unit049)
  set EX8=x
  set EY8=y
  if IsUnitAlly(Caster,GetOwningPlayer(Target)) or IsBlocked(GetSpellTargetUnit())==false then
    set tt_unit1=Caster
    call GroupEnumUnitsInRange(g,x,y,150,Condition(function DefaultEnemyFilter))
    call A28(CreateFogModifierRadiusLocBJ(true,GetOwningPlayer(Caster),FOG_OF_WAR_VISIBLE,unit049,1000.),2.25+.75*GetUnitAbilityLevel(Caster,'A21E'))
    set VT8=1
    set VU8=8
    loop
      exitwhen VT8>VU8
      call B88(CreateDestructableLoc('B005',S38(unit049,150.,(I2R(VT8)*45.)),GetRandomReal(0,360),1,0),2.25+.75*GetUnitAbilityLevel(Caster,'A21E'))
      set VT8=VT8+1
    endloop
  endif
  call RemoveLocation(unit049)
  call ForGroup(g,function VFE)
  call KillGroup(g)
  set VHE=null
  set Caster=null
  set Target=null
  set unit049=null
  set g=null
endfunction

function Prophet_NaturesWrath_OnCast takes nothing returns nothing
  if IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))and(LoadBoolean(hashtable019,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n038'))
  endif
endfunction

function VJE takes nothing returns boolean
  return GetSpellAbilityId()==('A01O')
endfunction

function VKE takes nothing returns nothing
  //local location YT9=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(GetTriggerUnit()))then
    call PingMinimapEx(x,y,3,255,255,255,false)
  endif
  call DestroyEffect(AddSpecialEffect("war3mapImported\\FurionTeleportTarget.mdx",x,y))
  call DestroyEffect(AddSpecialEffect("war3mapImported\\FurionTeleportTarget.mdx",GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit())))
  //call RemoveLocation(YT9)
  //set YT9=null
endfunction

function Func1151 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CHANNEL)
  call TriggerAddCondition(t,Condition(function VJE))
  call TriggerAddAction(t,function VKE)
  set t=null
endfunction

function VME takes unit Source,real x,real y returns nothing
  local unit u=CreateUnit(GetOwningPlayer(Source),'efon',x,y,0)
  call UnitApplyTimedLife(u,'BEfn',60)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\EntBirthTarget\\EntBirthTarget.mdl",u,"origin"))
  //call SetUnitVertexColor(u,175,255,175,175)
  call SetUnitFlyHeight(u,0,0)
  set u=null
endfunction

function TreeHasBecomeAlive_RemoveFlag takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local destructable d=LoadDestructableHandle(hashtable019,GetHandleId(t),0)
  call RemoveSavedBoolean(MHT,GetHandleId(d),'0FON')
  call PauseTimer(t)
  call DestroyTimer(t)
  set d=null
  set t=null
endfunction

function ThisTreeHasBecomeAlive takes destructable d returns nothing
  local timer t=CreateTimer()
  call SaveBoolean(MHT,GetHandleId(d),'0FON',true)
  call SaveDestructableHandle(hashtable019,GetHandleId(t),0,d)
  call TimerStart(t,5,false,function TreeHasBecomeAlive_RemoveFlag)
  set t=null
endfunction

function VOE takes nothing returns nothing
  if(WA8(GetEnumDestructable())or GetDestructableTypeId(GetEnumDestructable())=='B005')and EZ8<=EA8 and (GetDestructableLife(GetEnumDestructable())>0 or (ForceOfNatureMC and LoadBoolean(MHT,GetHandleId(GetEnumDestructable()),'0FON'))) then
    set EZ8=EZ8+1
    call VME(GetTriggerUnit(),ForceOfNatureX,ForceOfNatureY)
    if not ForceOfNatureMC then
      call ThisTreeHasBecomeAlive(GetEnumDestructable())
      call KillDestructable(GetEnumDestructable())
    endif
  elseif EZ8>EA8 then
    call KillDestructable(GetEnumDestructable())
  endif
endfunction

function Furion_ForceOfNature takes nothing returns nothing
  local integer Level=GetUnitAbilityLevel(GetTriggerUnit(),'A333')
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real d=75+75*Level+25
  local rect r=Rect(x-d,y-d,x+d,y+d)
  set ForceOfNatureX=x
  set ForceOfNatureY=y
  set ForceOfNatureMC=GetUnitTypeId(GetTriggerUnit())=='e00E'
  set EZ8=0
  set EA8=Level
  call EnumDestructablesInRect(r,Condition(function ReturnTrue2),function VOE)
  call RemoveRect(r)
  set ForceOfNatureMC=false
  //call RemoveLocation(l)
  //set l=null
  set r=null
endfunction

function ForceOfNature_Main takes nothing returns boolean
  if GetSpellAbilityId()=='AEfn' then
    call Furion_ForceOfNature()
  endif
  return false
endfunction

function VQE takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local real d=DistanceBetweenXY(GetUnitX(Target),GetUnitY(Target),E38,E68)
  if d<EC8 and IsUnitVisibleLoD(Target,GetOwningPlayer(EL8)) then
    set EB8=GetEnumUnit()
    set EC8=d
  endif
  set Target=null
endfunction

function Prophet_WrathOfNature takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(GetTriggerUnit(),'A1W8')
  local integer A38='A07X'
  local group g
  local unit Caster
  if Level==0 then
    set Level=GetUnitAbilityLevel(GetTriggerUnit(),'A1W9')
    set A38='A0AL'
  endif
  if Target==null then
    set EB8=null
    set EL8=Source
    set EC8=999999
    set E38=GetSpellTargetX()
    set E68=GetSpellTargetY()
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,0,0,9999,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function VQE)
    call KillGroup(g)
    set Target=EB8
    set g=null
  endif
  if Target!=null then
    set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
    call UnitAddAbility2(Caster,A38)
    call SetUnitAbilityLevel(Caster,A38,Level)
    call IssueTargetOrderById(Caster,852119,Target)
    set Caster=null
  endif
  set Source=null
  set Target=null
endfunction

function Huskar_Lifebreak_RemoveSlow takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  call UnitRemoveAbility(u,'A334')
  call UnitRemoveAbility(u,'B083')
  call FlushChildHashtable(hashtable019,h)
  call PauseTimer(t)
  call DestroyTimer(t)
  set u=null
  set t=null
endfunction

function VTE takes unit Source,unit Target returns nothing
  //	local unit Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local integer Level=GetUnitAbilityLevel(Source,'A0QR')
  local real selfcost
  local real targetcost=.5
  local timer t=CreateTimer()
  call TimerStart(t,5,false,function Huskar_Lifebreak_RemoveSlow)
  call SaveUnitHandle(hashtable019,GetHandleId(t),0,Target)
  set t=null
  call UnitAddAbility2(Target,'A334')
  if Level==0 then
    set Level=GetUnitAbilityLevel(Source,'A1B3')
    set targetcost=.65
  endif
  //	call UnitAddAbility2(Caster,'A0QU')
  //	call SetUnitAbilityLevel(Caster,'A0QU',1)
  //	if IssueTargetOrderById(Caster,852075,Target) then
  //		//call echo(GetUnitName(Target)+" "+GetUnitName(Caster))
  //		call UnitRemoveAbility(Caster,'A0QU')
  //	endif
  
  set selfcost=.45-.05*Level
  call DamageTarget(Source,Source,1,GetUnitState(Source,UNIT_STATE_LIFE)*selfcost)
  call DamageTarget(Source,Target,1,GetUnitState(Target,UNIT_STATE_LIFE)*targetcost)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Source,"chest"))
  call DestroyEffect(AddSpecialEffectTarget("effects\\LifeBreak.mdx",Target,"chest"))
  //	set Caster=null
endfunction

function VWE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  local unit Target=LoadUnitHandle(hashtable019,Cache,17)
  local real LastX=LoadReal(hashtable019,Cache,23)
  local real LastY=LoadReal(hashtable019,Cache,24)
  local real x
  local real y
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real TargetX=GetUnitX(Target)
  local real TargetY=GetUnitY(Target)
  local real J2E=Atan2(TargetY-SourceY,TargetX-SourceX)
  if GetUnitTypeId(Source)=='E02X' then
    call SetUnitAnimationByIndex(Source,1)
  else
    call SetUnitAnimationByIndex(Source,17)
  endif
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or DistanceBetweenXY(LastX,LastY,TargetX,TargetY)>1400 or IsUnitDisabled(Source)then
    call SetUnitPathing(Source,true)
    call DestroyEffect(LoadEffectHandle(hashtable019,Cache,175))
    call DestroyEffect(LoadEffectHandle(hashtable019,Cache,176))
    call UnitRemoveAbility(Source,'A0ST')
    call SetUnitTimeScale(Source,1.)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif DistanceBetweenXY(SourceX,SourceY,TargetX,TargetY)<125 then
    call SetUnitPathing(Source,true)
    call DestroyEffect(LoadEffectHandle(hashtable019,Cache,175))
    call DestroyEffect(LoadEffectHandle(hashtable019,Cache,176))
    call UnitRemoveAbility(Source,'A0ST')
    call FlushChildHashtable(hashtable019,Cache)
    call CleanTrigger(t)
    call SetUnitTimeScale(Source,1.)
    if Target!=null and IsDead(Target)==false then
      call IssueTargetOrderById(Source,851983,Target)
      call VTE(Source,Target)
    endif
  else
    call SetUnitPathing(Source,false)
    set LastX=TargetX
    set LastY=TargetY
    call SaveReal(hashtable019,Cache,23,LastX*1.)
    call SaveReal(hashtable019,Cache,24,LastY*1.)
    set x=SourceX+15*Cos(J2E)
    set y=SourceY+15*Sin(J2E)
    if IsUnitType(Source,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
    endif
    call SetUnitPosition(Source,x,y)
    call SetUnitFacing(Source,J2E*bj_RADTODEG)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function VXE takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.015,true)
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerAddCondition(t,Condition(function VWE))
  call SaveUnitHandle(hashtable019,Cache,2,Source)
  call SaveUnitHandle(hashtable019,Cache,17,Target)
  call SaveReal(hashtable019,Cache,23,GetUnitX(Target)*1.)
  call SaveReal(hashtable019,Cache,24,GetUnitY(Target)*1.)
  call SaveEffectHandle(hashtable019,Cache,175,AddSpecialEffectTarget("war3mapImported\\LifeBreakCharge.mdx",Source,"hand right alternate"))
  call SaveEffectHandle(hashtable019,Cache,176,AddSpecialEffectTarget("war3mapImported\\LifeBreakCharge.mdx",Source,"hand left alternate"))
  call SetUnitPathing(Source,false)
  call UnitAddAbility2(Source,'A0ST')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A0ST',false)
  call SetUnitAnimationByIndex(Source,17)
  call SetUnitTimeScale(Source,3.)
  set Source=null
  set Target=null
  set t=null
endfunction

function Huskar_LifeBreak takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call VXE()
  endif
endfunction

function Func1075 takes nothing returns nothing
  call PreloadAbility('A0QU')
endfunction

function VZE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer VAE=GetHeroMainStatValue(Target)
  local real YP8=GetUnitState(Target,UNIT_STATE_LIFE)
  local real MIE=GetUnitState(Target,UNIT_STATE_MAX_LIFE)
  local real VBE
  if YP8/ MIE>.4 then
    set VBE=(Level*1.0)/ 4*.2*VAE+2*Level
  else
    set VBE=(Level*1.0/4 +0.25)*.6*VAE+2*Level
  endif
  set VBE=VBE/ 8.
  if GetTriggerEvalCount(t)>16*8. then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(31))))
    call UnitRemoveAbility(Target,'A0QO')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SetUnitState(Target,UNIT_STATE_LIFE,YP8+VBE)
  endif
  set Target=null
  set t=null
  return false
endfunction

function Huskar_InnerVitality takes nothing returns nothing
  local unit Target=GetSpellTargetUnit()
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A0QP')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,1/ 8.,true)
  call TriggerAddCondition(t,Condition(function VZE))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveEffectHandle(hashtable019,(Cache),(31),(AddSpecialEffectTarget("InnerVitality.mdx",Target,"chest")))
  call UnitAddAbility2(Target,'A0QO')
  call SetUnitAbilityLevel(Target,'A0QO',Level)
  set Target=null
  set Source=null
  set t=null
endfunction

function V6E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Cache2
  local integer VLE
  local integer V1E
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if GetTriggerEvalCount(t)>8 or IsDead(Target)then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(31))))
    call FlushChildHashtable(hashtable019,(Cache))
    set Cache2=GetHandleId(Source)
    set VLE=6000+GetHandleId(Target)
    set V1E=(LoadInteger(hashtable019,(Cache2),(VLE)))
    set V1E=V1E-1
    if V1E==0 then
      call SaveInteger(hashtable019,(Cache2),(VLE),(0))
    else
      call SaveInteger(hashtable019,(Cache2),(VLE),(V1E))
    endif
    call UnitAsInteger_Clear(XK8)
    call CleanTrigger(t)
  else
    call DamageTarget(Source,Target,1,5*GetUnitAbilityLevel(Source,'A0QN'))
  endif
  set t=null
  set Target=null
  set Source=null
  return false
endfunction

function Huskar_BurningSpears_Damage takes unit Source,unit Target returns nothing
  local integer Cache=GetHandleId(Source)
  local integer Cache2
  local trigger t
  local integer V5E=(LoadInteger(hashtable019,(Cache),(6000+GetHandleId(Target))))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function V6E))
  set Cache2=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache2),(2),(Source))
  call SaveInteger(hashtable019,(Cache2),(30),(UnitAsInteger_Save(Target)))
  call SaveInteger(hashtable019,(Cache),(6000+GetHandleId(Target)),(V5E+1))
  call SaveEffectHandle(hashtable019,(Cache2),(31),(AddSpecialEffectTarget("Abilities\\Spells\\Other\\BreathOfFire\\BreathOfFireDamage.mdl",Target,"chest")))
  set t=null
endfunction

function Huskar_BurningSpears_BurnStart takes nothing returns boolean
  local real d
  if GetUnitAbilityLevel(GetTriggerUnit(),'B081')>0 and GetUnitAbilityLevel(GetEventDamageSource(),'A0QN')>0 and(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(2)))==GetEventDamageSource()then
    call SetUnitState(GetEventDamageSource(),UNIT_STATE_LIFE,RMaxIF(GetUnitState(GetEventDamageSource(),UNIT_STATE_LIFE)-15,1))
    call UnitRemoveAbility(GetTriggerUnit(),'B081')
    call Huskar_BurningSpears_Damage(GetEventDamageSource(),GetTriggerUnit())
    call DisableTrigger(GetTriggeringTrigger())
    call FlushChildHashtable(hashtable019,(GetHandleId(GetTriggeringTrigger())))
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function Huskar_BurningSpears_Start takes nothing returns nothing
  local trigger t
  local unit Target
  local unit Source
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    set Target=GetSpellTargetUnit()
    set Source=GetTriggerUnit()
  else
    set Target=GetTriggerUnit()
    set Source=GetAttacker()
  endif
  if IsUnitIllusion(Source)==false then
    set t=CreateTrigger()
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Source))
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerAddCondition(t,Condition(function Huskar_BurningSpears_BurnStart))
  endif
  set t=null
  set Target=null
  set Source=null
endfunction

function Huskar_BurningSpears_HookCast takes nothing returns boolean
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetUnitAbilityLevel(GetAttacker(),'A0QN')>0 and(LoadBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263)))and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetAttacker()==(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(14)))then
      call Huskar_BurningSpears_Start()
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER then
    if(GetIssuedOrderId()==852255)then
      call SaveBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263),(true))
    elseif(GetIssuedOrderId()==852256)then
      call SaveBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263),(false))
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A0QN' then
    call Huskar_BurningSpears_Start()
  endif
  return false
endfunction

function Huskar_BurningSpear_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function Huskar_BurningSpears_HookCast))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(GetTriggerUnit()))
  set t=null
endfunction

function Huskar_BurningSpears_Init takes nothing returns boolean
  if GetLearnedSkill()=='A0QN' and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Huskar_BurningSpear_Learn()
  endif
  return false
endfunction

function Huskar_BurningSpears_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Huskar_BurningSpears_Init))
  set t=null
endfunction

function SacredWarrior_BerserkerBlood_Resist takes unit Hero,integer amount returns nothing
  local integer i=0
  if GetUnitAbilityLevel(Hero,'BNdo')>0 then
    loop
      exitwhen i>24
      call UnitRemoveAbility(Hero,BerserkerBloodResistCont[i])
      set i=i+1
    endloop
    return
  endif
  loop
    exitwhen i>24
    if i!=amount/4 and GetUnitAbilityLevel(Hero,BerserkerBloodResistCont[i])>0 then
      call UnitRemoveAbility(Hero,BerserkerBloodResistCont[i])
    endif
    set i=i+1
  endloop
  if GetUnitAbilityLevel(Hero,BerserkerBloodResistCont[amount/4])==0 then
    call UnitAddAbility2(Hero,BerserkerBloodResistCont[amount/4])
    call SetPlayerAbilityAvailable(GetOwningPlayer(Hero),BerserkerBloodResistCont[amount/4],false)
  endif
endfunction

function SacredWarrior_BerserkerBlood_Act takes nothing returns boolean
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real curHP=GetUnitState(Hero,UNIT_STATE_LIFE)
  local real MaxHealth=GetUnitState(Hero,UNIT_STATE_MAX_LIFE)
  local integer curPercent
  local integer i
  local integer Level=IMaxIF(GetUnitAbilityLevel(Hero,'A0QQ'),GetUnitAbilityLevel(Hero,'QP1L'))
  local boolean effectHere=(LoadBoolean(hashtable019,(Cache),(319)))
  if IsUnitType(Hero,UNIT_TYPE_HERO) and Level>0 then
    set curPercent=R2I(100*curHP/MaxHealth)
    set i=IMaxIF(IMinIF(R2I(100-curPercent)/7,14),1)
    if IsDead(Hero)==false then
      call SacredWarrior_BerserkerBlood_Resist(Hero,(3+Level)*i)
      call SaveInteger(hashtable019,GetHandleId(Hero),'s167',Level*i*3)
      if GetUnitAbilityLevel(Hero,'BNdo')>0 then
        call AddBonusAS(Hero,0)
      else
        call AddBonusAS(Hero,Level*i*3)
      endif
      if curPercent<40 then
        if effectHere==false then
          call SaveBoolean(hashtable019,(Cache),(319),(true))
          call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\TrollBerserk\\HeadhunterWEAPONSLeft.mdl",Hero,"left weapon")))
          call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffectTarget("effects\\HeadhunterWEAPONSRight_NoSound.mdx",Hero,"right weapon")))
        endif
      else
        if effectHere then
          call SaveBoolean(hashtable019,(Cache),(319),(false))
          call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
          call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
        endif
      endif
    endif
  endif
  set Hero=null
  return false
endfunction

function SacredWarrior_BerserkerBlood_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function SacredWarrior_BerserkerBlood_Act))
  call SaveUnitHandle(hashtable019,GetHandleId(t),14,GetTriggerUnit())
  call SaveBoolean(hashtable019,GetHandleId(t),319,false)
  set t=null
  set BerserkerBloodResistCont[1]='A2PM'
  set BerserkerBloodResistCont[2]='A2PN'
  set BerserkerBloodResistCont[3]='A2PO'
  set BerserkerBloodResistCont[4]='A2PP'
  set BerserkerBloodResistCont[5]='A2PQ'
  set BerserkerBloodResistCont[6]='A2PJ'
  set BerserkerBloodResistCont[7]='A2PR'
  set BerserkerBloodResistCont[8]='A2PI'
  set BerserkerBloodResistCont[9]='A2PL'
  set BerserkerBloodResistCont[10]='A2PT'
  set BerserkerBloodResistCont[11]='A2Q1'
  set BerserkerBloodResistCont[12]='A2PU'
  set BerserkerBloodResistCont[13]='A2PH'
  set BerserkerBloodResistCont[14]='A2PV'
  set BerserkerBloodResistCont[15]='A2PW'
  set BerserkerBloodResistCont[16]='A2PX'
  set BerserkerBloodResistCont[17]='A2PY'
  set BerserkerBloodResistCont[18]='A2PZ'
  set BerserkerBloodResistCont[19]='A2Q0'
  set BerserkerBloodResistCont[20]='A2PK'
  set BerserkerBloodResistCont[21]='A2PS'
  set BerserkerBloodResistCont[22]='A2TA'
  set BerserkerBloodResistCont[23]='A2TB'
  set BerserkerBloodResistCont[24]='A2TC'
endfunction

function SacredWarrior_BerserkerBlood_Init takes nothing returns boolean
  if (GetLearnedSkill()=='A0QQ' or GetLearnedSkill()=='QP1L') and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call SacredWarrior_BerserkerBlood_Learn()
  endif
  return false
endfunction

function SacredWarrior_BerserkerBlood_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function SacredWarrior_BerserkerBlood_Init))
  set t=null
endfunction

function WKE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local integer id=GetPlayerId(GetOwningPlayer(Source))
  local integer Count=GetTriggerEvalCount(t)
  local real AO8=x+150*Count*Cos(a)
  local real AP8=y+150*Count*Sin(a)
  local integer WME=6
  if GetUnitAbilityLevel(Source,'A0O5')==0 then
    set WME=9
  endif
  call IssuePointOrderById(E18[id],852488,AO8,AP8)
  if Count==(WME)then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call SetUnitAnimation(Source,"stand")
  endif
  set t=null
  set Source=null
  return false
endfunction

function THD_Macropyre takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local integer Level=GetUnitAbilityLevel(Source,'A0O5')
  local integer WOE='A0OE'
  if Level==0 then
    set Level=GetUnitAbilityLevel(Source,'A1B1')
    set WOE='A1B2'
  endif
  //call RemoveLocation(l)
  call SetUnitAnimation(Source,"spell")
  set E18[GetPlayerId(GetOwningPlayer(Source))]=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  call UnitAddAbility2(E18[GetPlayerId(GetOwningPlayer(Source))],WOE)
  call SetUnitAbilityLevel(E18[GetPlayerId(GetOwningPlayer(Source))],WOE,Level)
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Source))*1.))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  if WOE=='A0OE' then
    call TriggerRegisterTimerEvent(t,.1,true)
  else
    call TriggerRegisterTimerEvent(t,.05,true)
  endif
  call TriggerAddCondition(t,Condition(function WKE))
  set t=null
  set Source=null
  //set l=null
endfunction

function J19 takes nothing returns nothing
  call PreloadAbility('A0OE')
endfunction

function THD_LiquidFire_Actions takes nothing returns boolean
  local real d
  local unit dummy
  local unit u
  local trigger t=GetTriggeringTrigger()
  local unit c
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    set u=GetTriggerUnit()
    set c=GetEventDamageSource()
    if GetUnitAbilityLevel(u,'B306')>0 and GetUnitAbilityLevel(c,'A306')>0 and LoadUnitHandle(hashtable019,GetHandleId(t),2)==c then
      call UnitRemoveAbility(u,'B306')
      call FlushChildHashtable(hashtable019,GetHandleId(t))
      call CleanTrigger(t)
      set dummy=CreateUnit(GetOwningPlayer(c),'e00E',GetUnitX(u),GetUnitY(u),0)
      call UnitAddAbility(dummy,'A307')
      call SetUnitAbilityLevel(dummy,'A307',GetUnitAbilityLevel(c,'A306'))
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",GetWidgetX(u),GetWidgetY(u)))
      call IssueTargetOrder(dummy,"acidbomb",u)
    endif
  else
    call FlushChildHashtable(hashtable019,GetHandleId(t))
    call CleanTrigger(t)
  endif
  set dummy=null
  set c=null
  set t=null
  set u=null
  return false
endfunction

function THD_LiquidFire_Gogo takes nothing returns nothing
  local trigger t
  local unit Target
  local unit Source
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    set Target=GetSpellTargetUnit()
    set Source=GetTriggerUnit()
  else
    set Target=GetTriggerUnit()
    set Source=GetAttacker()
  endif
  if IsUnitIllusion(Source)==false then
    set t=CreateTrigger()
    call SaveUnitHandle(hashtable019,GetHandleId(t),2,Source)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerRegisterTimerEvent(t,3.5,false)
    call TriggerAddCondition(t,Condition(function THD_LiquidFire_Actions))
    set t=null
  endif
  set Target=null
  set Source=null
endfunction

function THD_LiquidFire_SomeAct takes nothing returns boolean
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetUnitAbilityLevel(GetAttacker(),'A306')>0 and LoadBoolean(hashtable019,GetHandleId(GetTriggeringTrigger()),263) and GetAttacker()==LoadUnitHandle(hashtable019,GetHandleId(GetTriggeringTrigger()),14)then
      call THD_LiquidFire_Gogo()
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER then
    if GetUnitAbilityLevel(GetTriggerUnit(),'A306')>0 then
      if(GetIssuedOrderId()==852255)then
        call SaveBoolean(hashtable019,GetHandleId(GetTriggeringTrigger()),263,true)
      elseif(GetIssuedOrderId()==852256)then
        call SaveBoolean(hashtable019,GetHandleId(GetTriggeringTrigger()),263,false)
      endif
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and(GetSpellAbilityId()=='A306')then
    call THD_LiquidFire_Gogo()
  endif
  return false
endfunction

function THD_LiquidFire_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  //call echo("created")
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function THD_LiquidFire_SomeAct))
  call SaveUnitHandle(hashtable019,GetHandleId(t),14,GetTriggerUnit())
  set t=null
endfunction

function THD_LiquidFire_Lvlup takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer pid=GetPlayerId(GetOwningPlayer(u))
  local integer id='A306'
  local integer lvl=GetUnitAbilityLevel(u,'A30U')
  if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==true or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+1]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+2]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+3]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+4]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+5]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+6]],"melee morph",null) then
    set id='A30T'
  endif
  if lvl==0 then
    set lvl=ExtraAbilityLevel[GetPlayerId(GetOwningPlayer(u))*2+1]
  endif
  call SetUnitAbilityLevel(u,id,lvl)
  set u=null
endfunction

function THD_LiquidFire_DetectUnitType takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer pid=GetPlayerId(GetOwningPlayer(u))
  local integer id='A306'
  if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==true or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+1]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+2]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+3]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+4]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+5]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+6]],"melee morph",null) then
    set id='A30T'
  endif
  call UnitAddAbility2(u,id)
  //call echo(Id2S(id))
  if id=='A306'then
    call THD_LiquidFire_Learn()
    //call echo("added?")
  endif
  set u=null
endfunction

function Jakiro_Icepath_End takes timer t, integer info returns nothing
  local integer i = 0
  loop
    call DestroyUbersplat(LoadUbersplatHandle(MHT,info,i + 14))
    call DestroyEffect(LoadEffectHandle(MHT,info,i + 3))
    set i = i + 1
    exitwhen i == 11
  endloop
  call RemoveUnit(LoadUnitHandle(MHT,info,1))
  call KillGroup(LoadGroupHandle(MHT,info,2))
  call Timer_End(t)
  set t = null
endfunction

function Jakiro_Icepath_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local unit u = group_temp_unit[0]
  local group g = null
  local player p = GetOwningPlayer(t)
  
  if IsDead(t)==false and IsUnitEnemy(u,p) and GetUnitAbilityLevel(t,'A04R')==0 and IsMagicImmune(t)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) then
    set g = LoadGroupHandle(MHT,group_temp_integer[0],2)
    
    if IsUnitInGroup(t,g)==false then
      call GroupAddUnit(g,t)
      call DamageTarget(u,t,1,group_temp_integer[1])
      
      call SetUnitOwner(group_temp_unit[1],p,false)
      call SetUnitX(group_temp_unit[1],GetWidgetX(t))
      call SetUnitY(group_temp_unit[1],GetWidgetY(t))
      call IssueTargetOrder(group_temp_unit[1],"thunderbolt",t)
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl",GetUnitX(t),GetUnitY(t)))
    endif
    
    set g = null
  endif
  
  //dem guts :3
  set u = null
  set t = null
  return false
endfunction

function Jakiro_Icepath_Duration takes nothing returns nothing
  local ubersplat u = null
  local timer t = GetExpiredTimer()
  local integer loopA
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0) + 1
  local integer max = LoadInteger(MHT,info,1)
  local real angle
  local real ax
  local real ay
  local real x
  local real y
  
  if count==max then
    call Jakiro_Icepath_End(t,info)
    
    set t = null
    return
  endif
  
  call SaveInteger(MHT,info,0,count)
  
  if count<10 then
    set angle = LoadReal(MHT,info,0)
    set x = LoadReal(MHT,info,1) + 100*count*Cos(angle)
    set y = LoadReal(MHT,info,2) + 100*count*Sin(angle)
    
    call SaveEffectHandle(MHT,info,2 + count,AddSpecialEffect("effects\\IcePath.mdx",x,y))
    
    set u = CreateUbersplat(x,y,"IPTH",255,255,255,255,false,false) //doesnt seem to display the effect \:3/
    call SetUbersplatRenderAlways(u,true)
    call SaveUbersplatHandle(MHT,info,13 + count,u)
    
    set t = null
    set u = null
    return
  endif
  
  set group_temp_unit[0] = LoadUnitHandle(MHT,info,0)
  set group_temp_unit[1] = LoadUnitHandle(MHT,info,1)
  set group_temp_integer[1] = LoadInteger(MHT,info,2)
  set group_temp_integer[0] = info
  set angle = LoadReal(MHT,info,0)
  set x = LoadReal(MHT,info,1)
  set y = LoadReal(MHT,info,2)
  set ax = Cos(angle)
  set ay = Sin(angle)
  
  call SetUnitAbilityLevel(group_temp_unit[1],'A0X6',DO9((max + 4 - count)*0.05))
  set loopA = 0
  loop
    call GroupEnumUnitsInRange(temp_group,x,y,175,Condition(function Jakiro_Icepath_Targets))
    set x = x + 100*ax
    set y = y + 100*ay
    set loopA = loopA + 1
    exitwhen loopA == 10
  endloop
  
  set t = null
endfunction

function Jakiro_Icepath_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local integer info = GetHandleId(t)
  local integer level = GetUnitAbilityLevel(u,'A0O6')
  local real x = GetWidgetX(u)
  local real y = GetWidgetY(u)
  
  call SaveUnitHandle(MHT,info,0,u)
  
  set u = CreateUnit(Player(15),'e00E',0,0,0)
  call UnitAddAbility(u,'A0X6')
  call SaveUnitHandle(MHT,info,1,u)
  
  call SaveGroupHandle(MHT,info,2,GetAvailableGroup())
  call SaveInteger(MHT,info,0,0)
  call SaveInteger(MHT,info,1,level*8 + 12)
  call SaveInteger(MHT,info,2,50)
  call SaveReal(MHT,info,0,Atan2(GetSpellTargetY()-y,GetSpellTargetX()-x))
  call SaveReal(MHT,info,1,x)
  call SaveReal(MHT,info,2,y)
  
  call TimerStart(t,0.05,true,function Jakiro_Icepath_Duration)
  
  set t = null
  set u = null
endfunction



function W2E takes real x1,real y1,real x2,real y2,real x3,real y3,real x,real y returns boolean
  local real X4E=(y-y1)*(x2-x1)-(x-x1)*(y2-y1)
  local real X7E=(y-y3)*(x1-x3)-(x-x3)*(y1-y3)
  local real X8E=(y-y2)*(x3-x2)-(x-x2)*(y3-y2)
  return(X4E*X7E>0)and(X8E*X7E>0)
endfunction

function booleans029 takes nothing returns boolean
  local real XDE=tt_real1
  local real region013=real084
  local real XFE=real085
  local real integer498=PJ
  local real unit040=QJ
  local real timer006=UJ
  return IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and W2E(XDE,region013,XFE,integer498,unit040,timer006,GetUnitX(GetFilterUnit()),GetUnitY(GetFilterUnit()))
endfunction

function XJE takes real real063,real booleans028,real XNE returns nothing
  local real unit041=550
  local real integer501=200
  local real real062=250
  local real group026=Asin((real062-integer501)/ unit041)
  local real x=integer501/ Sin(group026)
  local real y=(unit041+real062+x)*Tan(group026)
  local real XDE=booleans028+x*Cos((real063-180)*bj_DEGTORAD)
  local real region013=XNE+x*Sin((real063-180)*bj_DEGTORAD)
  local real XFE=(booleans028+(unit041+real062)*Cos(real063*bj_DEGTORAD))+y*Cos((real063-90)*bj_DEGTORAD)
  local real integer498=(XNE+(unit041+real062)*Sin(real063*bj_DEGTORAD))+y*Sin((real063-90)*bj_DEGTORAD)
  local real unit040=(booleans028+(unit041+real062)*Cos(real063*bj_DEGTORAD))+y*Cos((real063+90)*bj_DEGTORAD)
  local real timer006=(XNE+(unit041+real062)*Sin(real063*bj_DEGTORAD))+y*Sin((real063+90)*bj_DEGTORAD)
  set tt_real1=XDE
  set real084=region013
  set real085=XFE
  set PJ=integer498
  set QJ=unit040
  set UJ=timer006
endfunction

function XSE takes nothing returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E',GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
  call UnitAddAbility2(Caster,'A0OA')
  call IssueTargetOrderById(Caster,852226,GetEnumUnit())
  set Caster=null
endfunction

function XTE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Caster
  if GetTriggerEvalCount(t)>1 then
    call SetUnitAnimation(Hero,"stand")
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SetUnitAnimation(Hero,"spell")
    set Caster=CreateUnit(p,'e00E',x,y,0)
    call UnitAddAbility2(Caster,'A0OC')
    call SetUnitAbilityLevel(Caster,'A0OC',Level)
    call IssuePointOrderById(Caster,852560,TargetX,TargetY)
  endif
  set t=null
  set p=null
  set Hero=null
  set Caster=null
  return false
endfunction

function THD_DualBreath_MOREMATH takes real r1,real r2,real r3,real r4,real r5,real r6,real x,real y returns boolean
  local real r7=(y-r2)*(r3-r1)-(x-r1)*(r4-r2)
  local real r8=(y-r6)*(r1-r5)-(x-r5)*(r2-r6)
  local real r9=(y-r4)*(r5-r3)-(x-r3)*(r6-r4)
  return(r7*r8>0)and(r9*r8>0)
endfunction

function THD_DualBreath_Filter takes nothing returns boolean
  local real r1=THD_TempReal1
  local real r2=THD_TempReal2
  local real r3=THD_TempReal3
  local real r4=THD_TempReal4
  local real r5=THD_TempReal5
  local real r6=THD_TempReal6
  return IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and THD_DualBreath_MOREMATH(r1,r2,r3,r4,r5,r6,GetUnitX(GetFilterUnit()),GetUnitY(GetFilterUnit()))
endfunction

function THD_DualBreath_MATH takes real angle,real x,real y returns nothing
  local real dist=550
  local real startWidth=200
  local real finalWidth=250
  local real asin=Asin((finalWidth-startWidth)/dist)
  local real r1=startWidth/Sin(asin)
  local real r2=(dist+finalWidth+r1)*Tan(asin)
  local real r3=x+r1*Cos((angle-180)*bj_DEGTORAD)
  local real r4=y+r1*Sin((angle-180)*bj_DEGTORAD)
  local real r5=(x+(dist+finalWidth)*Cos(angle*bj_DEGTORAD))+r2*Cos((angle-90)*bj_DEGTORAD)
  local real r6=(y+(dist+finalWidth)*Sin(angle*bj_DEGTORAD))+r2*Sin((angle-90)*bj_DEGTORAD)
  local real r7=(x+(dist+finalWidth)*Cos(angle*bj_DEGTORAD))+r2*Cos((angle+90)*bj_DEGTORAD)
  local real r8=(y+(dist+finalWidth)*Sin(angle*bj_DEGTORAD))+r2*Sin((angle+90)*bj_DEGTORAD)
  set THD_TempReal1=r3
  set THD_TempReal2=r4
  set THD_TempReal3=r5
  set THD_TempReal4=r6
  set THD_TempReal5=r7
  set THD_TempReal6=r8
endfunction

function THD_DualBreath_ForGroup takes nothing returns nothing
  local unit u=CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E',GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
  call UnitAddAbility2(u,'A0OA')
  call IssueTargetOrder(u,"frostnova",GetEnumUnit())
  set u=null
endfunction

function THD_DualBreath_BurnBaby takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local player p=LoadPlayerHandle(MHT,h,54)
  local unit caster=LoadUnitHandle(MHT,h,14)
  local real sourceX=LoadReal(MHT,h,6)
  local real sourceY=LoadReal(MHT,h,7)
  local real targetX=LoadReal(MHT,h,47)
  local real targetY=LoadReal(MHT,h,48)
  local integer lvl=LoadInteger(MHT,h,5)
  local unit dummy
  if GetTriggerEvalCount(t)>1 then
    call SetUnitAnimation(caster,"stand")
    call FlushChildHashtable(MHT,h)
    call CleanTrigger(t)
  else
    call SetUnitAnimation(caster,"spell")
    set dummy=CreateUnit(p,'e00E',sourceX,sourceY,0)
    call UnitAddAbility2(dummy,'A0OC')
    call SetUnitAbilityLevel(dummy,'A0OC',lvl)
    call IssuePointOrder(dummy,"breathoffrost",targetX,targetY)
  endif
  set t=null
  set p=null
  set caster=null
  set dummy=null
  return false
endfunction

function THD_DualBreath_FireFrei takes unit u,player p,integer lvl,location l,real x,real y returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call SavePlayerHandle(MHT,h,54,p)
  call SaveReal(MHT,h,6,x*1.0)
  call SaveReal(MHT,h,7,y*1.0)
  call SaveReal(MHT,h,47,GetLocationX(l)*1.0)
  call SaveReal(MHT,h,48,GetLocationY(l)*1.0)
  call SaveInteger(MHT,h,5,lvl)
  call SaveUnitHandle(MHT,h,14,u)
  call TriggerRegisterTimerEvent(t,0.3,true)
  call TriggerAddCondition(t,Condition(function THD_DualBreath_BurnBaby))
  set t=null
endfunction

function THD_DualBreath takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local integer lvl=GetUnitAbilityLevel(caster,'A0O7')
  local real x=GetUnitX(caster)
  local real y=GetUnitY(caster)
  local location l
  local unit dummy
  local group g=GetAvailableGroup()
  if GetSpellTargetUnit()==null then
    set l=GetSpellTargetLoc()
  else
    set l=GetUnitLoc(GetSpellTargetUnit())
  endif
  call THD_DualBreath_MATH(bj_RADTODEG*Atan2(GetLocationY(l)-y,GetLocationX(l)-x),x,y)
  call GroupEnumUnitsInRange(g,x,y,2000,Condition(function THD_DualBreath_Filter))
  call ForGroup(g,function THD_DualBreath_ForGroup)
  call KillGroup(g)
  set dummy=CreateUnit(GetOwningPlayer(caster),'e00E',x,y,0)
  call UnitAddAbility2(dummy,'A0OB')
  call SetUnitAbilityLevel(dummy,'A0OB',lvl)
  call IssuePointOrder(dummy,"breathoffire",GetLocationX(l),GetLocationY(l))
  call THD_DualBreath_FireFrei(caster,GetOwningPlayer(caster),lvl,l,x+50*Cos(Atan2(GetLocationY(l)-y,GetLocationX(l)-x)),y+50*Sin(Atan2(GetLocationY(l)-y,GetLocationX(l)-x)))
  call RemoveLocation(l)
  set caster=null
  set l=null
  set g=null
endfunction

function J39 takes nothing returns nothing
  call PreloadAbility('A0OB')
  call PreloadAbility('A0OC')
  call PreloadAbility('A0OA')
endfunction

function integer499 takes unit Hero,unit Target returns nothing
  local real a=GetRandomReal(0,360)
  local real x=GetUnitX(Target)+50*Cos(a*bj_DEGTORAD)
  local real y=GetUnitY(Target)+50*Sin(a*bj_DEGTORAD)
  local real XYE=GetRandomReal(175,250)
  call SetUnitX(Hero,x)
  call SetUnitY(Hero,y)
  call SetUnitFacing(Hero,bj_RADTODEG*Atan2(GetUnitY(Target)-GetUnitY(Hero),GetUnitX(Target)-GetUnitX(Hero)))
  call SetUnitAnimation(Hero,"Attack")
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl",Hero,"chest"))
  if IsPlayerBelongToTeams(GetOwningPlayer(Target))==false and IsUnitType(Target,UNIT_TYPE_ANCIENT)==false then
    set XYE = 99999
  endif
  call DamageTarget(Hero,Target,2,XYE)
  //call IssueTargetOrderById(Hero,851983,Target)
endfunction

function XZE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call integer499(Hero,Target)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  set Target=null
  return false
endfunction

function integers066 takes unit Hero returns nothing
  local group g=GetAvailableGroup()
  set tt_unit1=Hero
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),450,Condition(function Func1667))
  set tt_unit1=GroupPickRandomUnit(g)
  if tt_unit1!=null then
    call integer499(Hero,tt_unit1)
  endif
  call KillGroup(g)
  set g=null
endfunction

function XBE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit VisionDummy=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local integer integer500=(LoadInteger(hashtable019,(Cache),(216)))
  local integer booleans030=(LoadInteger(hashtable019,(Cache),(325)))
  local integer unit060=(LoadInteger(hashtable019,(Cache),(28)))
  local unit X6E
  if unit060>integer500 then
    if LoadInteger(hashtable019,Cache,0)>0 then
      call LoDStat_Sub(Hero,LoadInteger(hashtable019,Cache,0),"attack")
    endif
    call KillUnit(VisionDummy)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A05G',true)
    call SetUnitPathing(Hero,true)
    call SetUnitInvulnerable(Hero,false)
    call SaveInteger(hashtable019,(GetHandleId((Hero))),((4253)),(2))
    call SetUnitVertexColor(Hero,255,255,255,255)
  else
    call SaveInteger(hashtable019,(Cache),(28),(unit060+1))
    call integers066(Hero)
    if tt_unit1==null then
      if LoadInteger(hashtable019,Cache,0)>0 then
        call LoDStat_Sub(Hero,LoadInteger(hashtable019,Cache,0),"attack")
      endif
      call KillUnit(VisionDummy)
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A05G',true)
      call SetUnitPathing(Hero,true)
      call SetUnitInvulnerable(Hero,false)
      call SaveInteger(hashtable019,(GetHandleId((Hero))),((4253)),(2))
      call SetUnitVertexColor(Hero,255,255,255,255)
    endif
  endif
  set t=null
  set Hero=null
  set X6E=null
  set VisionDummy=null
  return false
endfunction

function Juggernaut_Omnislash takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'A0M1')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer booleans030=GetUnitAbilityLevel(Hero,'A05G')
  local player p=GetOwningPlayer(Hero)
  local integer integer500=3
  local unit VisionDummy=CreateUnit(GetOwningPlayer(Hero),'o00D',GetUnitX(Hero),GetUnitY(Hero),0)
  local integer maxstat=IMaxIF(GetHeroStr(Hero,true),IMaxIF(GetHeroAgi(Hero,true),GetHeroInt(Hero,true)))
  local integer asbonus=maxstat-GetHeroAgi(Hero,true)
  
  if Level==0 then
    set Level=GetUnitAbilityLevel(Hero,'A1AX')
    if Level==1 then
      set integer500=6
    elseif Level==2 then
      set integer500=9
    elseif Level==3 then
      set integer500=12
    endif
  elseif Level==2 then
    set integer500=6
  elseif Level==3 then
    set integer500=9
  endif
  call SetPlayerAbilityAvailable2(p,'A05G',false)
  call SetUnitVertexColor(Hero,255,255,255,125)
  call SetUnitPathing(Hero,false)
  call SetUnitInvulnerable(Hero,true)
  call SaveInteger(hashtable019,(GetHandleId((Hero))),((4253)),(1))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function XZE))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(19),(VisionDummy))
  call SaveInteger(hashtable019,(Cache),(216),(integer500))
  call SaveInteger(hashtable019,(Cache),(325),(booleans030))
  call SaveInteger(hashtable019,(Cache),(28),(2))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl",Hero,GetProperAttachPoint_Weapon(Hero))))
  call TriggerRegisterTimerEvent(t,.4,true)
  call TriggerAddCondition(t,Condition(function XBE))
  if asbonus>0 then
    call LoDStat_Add(Hero,asbonus,"attack")
    call SaveInteger(hashtable019,Cache,0,asbonus)
  endif
  set Hero=null
  set Target=null
  set t=null
  set p=null
  set VisionDummy=null
endfunction

function X0E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call SetUnitAnimationByIndex(Source,4)
  set t=null
  set Source=null
  return false
endfunction

function Juggernaut_Omnislash_OnCast takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.01,false)
  call TriggerAddCondition(t,Condition(function X0E))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=null
  set Source=null
endfunction

function Y4E takes nothing returns nothing
  call DamageTarget(E28,GetEnumUnit(),1,(60.+20.*F48)*.25)
endfunction

function Y7E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Count=GetTriggerEvalCount(t)
  local group g
  if Count==20 or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call DestroyEffect(LoadEffectHandle(hashtable019,(Cache),(32)))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set tt_unit1=Source
    set E28=Source
    set F48=GetUnitAbilityLevel(Source,'A05G')
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),275,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function Y4E)
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Source=null
  return false
endfunction

function Juggernaut_Bladefury takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Y7E))
  call SaveUnitHandle(hashtable019,(Cache),(2),(GetTriggerUnit()))
  if (GetUnitTypeId(GetTriggerUnit())!='Nbbc' and GetUnitTypeId(GetTriggerUnit())!='Opgh')then
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\SpinFX2.mdx",GetTriggerUnit(),"origin")))
  endif
  call TriggerEvaluate(t)
  call AddTimedKeyToUnit(GetTriggerUnit(),4252,5)
  set t=null
endfunction

function YDE takes nothing returns boolean
  return GetUnitTypeId(GetSummonedUnit())=='o00C' or GetUnitTypeId(GetSummonedUnit())=='o01G' or GetUnitTypeId(GetSummonedUnit())=='o01H' or GetUnitTypeId(GetSummonedUnit())=='o01I'
endfunction

function YEE takes nothing returns nothing
  call SetUnitAbilityLevelSwapped('A058',GetSummonedUnit(),GetUnitAbilityLevelSwapped('A047',GetSummoningUnit()))
endfunction

function K39 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function YDE))
  call TriggerAddAction(t,function YEE)
  set t=null
endfunction

function YFE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real x1
  local real y1
  local real x2
  local real y2
  if GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_UNIT_DAMAGED and GetEventDamage()>2 and IsPlayerBelongToTeams(GetOwningPlayer(GetEventDamageSource())))then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()!=EVENT_UNIT_DAMAGED and GetTriggerEventId()!=EVENT_UNIT_DEATH then
    set x1=GetUnitX(Source)
    set y1=GetUnitY(Source)
    set x2=GetUnitX(Target)
    set y2=GetUnitY(Target)
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl",x1,y1))
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",x2,y2))
    call AddTimedKeyToUnit(Target,4410,1)
    call SetUnitPosition(Target,GetUnitX(Source),GetUnitY(Source))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function YGE takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local real d=DistanceBetweenXY(GetUnitX(Target),GetUnitY(Target),F98,FD8)
  if d<F88 then
    set F78=GetEnumUnit()
    set F88=d
  endif
  set Target=null
endfunction

function Kotl_Recall takes nothing returns nothing
  local unit Target=GetSpellTargetUnit()
  local unit Source=GetTriggerUnit()
  local trigger t
  local integer Cache
  local real DP9
  local group g
  if Target==null then
    set F78=null
    set F88=999999
    set F98=GetSpellTargetX()
    set FD8=GetSpellTargetY()
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,0,0,9999,Condition(function Func1661))
    call GroupRemoveUnit(g,Source)
    call ForGroup(g,function YGE)
    call KillGroup(g)
    set Target=F78
    set g=null
  endif
  if GetSpellAbilityId()=='A10U' then
    set DP9=5
  elseif GetSpellAbilityId()=='A11Y' then
    set DP9=4
  elseif GetSpellAbilityId()=='A11Z' then
    set DP9=3
  elseif GetSpellAbilityId()=='A1N1' then
    set DP9=3
  endif
  if Target!=null then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerRegisterTimerEvent(t,DP9,false)
    call TriggerAddCondition(t,Condition(function YFE))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl",Source,"origin")))
    call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl",Target,"origin")))
  endif
  set Target=null
  set Source=null
  set t=null
endfunction

function YJEsup takes nothing returns nothing
  if GetSpellTargetUnit()!=null and(LoadBoolean(hashtable019,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n038'))
  endif
endfunction

function YKE takes integer Level returns integer
  if Level==1 then
    return 'A10Z'
  elseif Level==2 then
    return 'A111'
  elseif Level==3 then
    return 'A10Y'
  elseif Level==4 then
    return 'A110'
  endif
  return 0
endfunction

function YME takes integer Level returns integer
  if Level==1 then
    return 'B09M'
  elseif Level==2 then
    return 'B09N'
  elseif Level==3 then
    return 'B09O'
  elseif Level==4 then
    return 'B09L'
  endif
  return 0
endfunction

function YNE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real LastX=(LoadReal(hashtable019,(Cache),(23)))
  local real LastY=(LoadReal(hashtable019,(Cache),(24)))
  local real x=GetUnitX(Target)
  local real y=GetUnitY(Target)
  local real d=SquareRoot((LastX-x)*(LastX-x)+(LastY-y)*(LastY-y))
  local real YOE=(.0003+Level*.00005)*d*GetUnitState(Target,UNIT_STATE_MAX_MANA)
  local integer EZE=GetTriggerEvalCount(t)
  local unit Caster
  if IsMagicImmune(Target) then
    set YOE=0
  endif
  if d>300 then
    set YOE=0
  endif
  if YOE>1 and ModuloInteger(GetTriggerEvalCount(t),3)==0 then
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl",Target,"chest"))
  endif
  if YOE>0 then
    call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)-YOE)
  endif
  call SaveReal(hashtable019,(Cache),(23),((x)*1.))
  call SaveReal(hashtable019,(Cache),(24),((y)*1.))
  if GetTriggerEventId()==EVENT_UNIT_DEATH or EZE==(Level+3)*10 then
    call UnitRemoveAbility(Target,YKE(Level))
    call UnitRemoveAbility(Target,YME(Level))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetUnitState(Target,UNIT_STATE_MANA)<1 then
    call StunTarget((LoadUnitHandle(hashtable019,(Cache),(2))),Target,1+.5*Level)
    set Caster=null
    call UnitRemoveAbility(Target,YKE(Level))
    call UnitRemoveAbility(Target,YME(Level))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  return false
endfunction

function YPE takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A10X')
  call UnitAddAbility2(Target,YKE(Level))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(23),((GetUnitX(Target))*1.))
  call SaveReal(hashtable019,(Cache),(24),((GetUnitY(Target))*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("effects\\BasicWaterFlash.mdx",Target,"chest")))
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function YNE))
  set Source=null
  set Target=null
  set t=null
endfunction

function Kotl_ManaLeak takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call YPE()
  endif
endfunction

function YRE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit YSE=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local integer YTE=(LoadInteger(hashtable019,(Cache),(34)))
  local real YUE=GetUnitX(YSE)-50*Cos(J2E)
  local real YVE=GetUnitY(YSE)-50*Sin(J2E)
  local unit Caster=CreateUnit(GetOwningPlayer(YSE),'e00E',YUE,YVE,0)
  local real x=GetUnitX(Caster)+50*Cos(J2E)
  local real y=GetUnitY(Caster)+50*Sin(J2E)
  local real x2=x+(300+50*YTE)*Cos(J2E)
  local real y2=y+(300+50*YTE)*Sin(J2E)
  call UnitAddAbility2(Caster,'A087')
  call SetUnitAbilityLevel(Caster,'A087',YTE)
  call IssuePointOrderById(Caster,852580,x,y)
  call KillUnit(YSE)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set Caster=null
  set t=null
  set YSE=null
  return false
endfunction

function YWE takes unit YSE,integer YTE,real J2E returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function YRE))
  call SaveUnitHandle(hashtable019,(Cache),(19),(YSE))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveInteger(hashtable019,(Cache),(34),(YTE))
  set t=null
endfunction

function YXE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local integer YTE=Count-1
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer YYE=2+Level*2
  local boolean YZE=(LoadBoolean(hashtable019,(Cache),(240)))
  local unit WCE
  if GetTriggerEventId()!=EVENT_UNIT_SPELL_ENDCAST then
    call SaveInteger(hashtable019,(Cache),(34),(Count+1))
  endif
  call SetUnitScale(Caster,I2R(100+20*YTE)/ 100,I2R(100+20*YTE)/ 100,I2R(100+20*YTE)/ 100)
  if(GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST and YZE==false)or(GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST and GetSpellAbilityId()=='A121')or YTE==YYE then
    if YZE then
      set WCE=(LoadUnitHandle(hashtable019,(Cache),(239)))
      call ShowUnit(WCE,false)
      call UnitApplyTimedLife(WCE,'BTLF',1)
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if(LoadInteger(hashtable019,(GetHandleId(Hero)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Hero)),(704)))=='A085' then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A085',true)
    endif
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A121',false)
    call UnitRemoveAbility(Hero,'A121')
    call YWE(Caster,YTE,J2E)
  endif
  set Caster=CreateUnit(GetOwningPlayer(Caster),'h06M',GetUnitX(Caster)+150*(YTE)*Cos(J2E),GetUnitY(Caster)+150*(YTE)*Sin(J2E),0)
  call UnitApplyTimedLife(Caster,'BTLF',7)
  set t=null
  set Caster=null
  set Hero=null
  set WCE=null
  return false
endfunction

function YAE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  call IssueImmediateOrderById(Hero,851972)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  return false
endfunction

function YBE takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local location l=GetSpellTargetLoc()
  local real J2E=Atan2(GetLocationY(l)-GetUnitY(Hero),GetLocationX(l)-GetUnitX(Hero))
  local real x
  local real y
  local unit Caster
  local unit WCE
  local boolean YZE=false
  if GetLocationY(l)==GetUnitY(Hero)and GetLocationX(l)==GetUnitX(Hero)then
    set J2E=GetUnitFacing(Hero)*bj_DEGTORAD
  endif
  set x=GetUnitX(Hero)+150*Cos(J2E)
  set y=GetUnitY(Hero)+150*Sin(J2E)
  set Caster=CreateUnit(GetOwningPlayer(Hero),'u00J',x,y,J2E*bj_RADTODEG)
  call RemoveLocation(l)
  if GetUnitTypeId(Hero)=='H06X' or GetUnitTypeId(Hero)=='H06Y' or GetUnitTypeId(Hero)=='H06W' then
    set YZE=true
  endif
  call SaveBoolean(hashtable019,(Cache),(240),(YZE))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveInteger(hashtable019,(Cache),(34),(1))
  call SaveInteger(hashtable019,(Cache),(5),(GetUnitAbilityLevel(Hero,'A085')))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerAddCondition(t,Condition(function YXE))
  if YZE then
    set WCE=CreateUnit(GetOwningPlayer(Hero),'h06Z',GetUnitX(Hero),GetUnitY(Hero),J2E*bj_RADTODEG)
    call SetUnitX(WCE,GetUnitX(Hero))
    call SetUnitY(WCE,GetUnitY(Hero))
    call SetUnitAnimation(WCE,"spell")
    call QueueUnitAnimation(WCE,"spell")
    call QueueUnitAnimation(WCE,"spell")
    call SetUnitVertexColor(WCE,255,255,255,75)
    call SaveUnitHandle(hashtable019,(Cache),(239),(WCE))
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,0,false)
    call TriggerAddCondition(t,Condition(function YAE))
    call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  endif
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A085',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A121',true)
  call AddTimedAbility(Hero,'A121',1,6)
  set t=null
  set Hero=null
  set Caster=null
  set WCE=null
  set l=null
endfunction

function Keeper_Illuminate_End takes nothing returns nothing
  call SaveBoolean(MHT,GetHandleId(GetTriggerUnit()),'A085',false)
endfunction
function Keeper_Illuminate_Check takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local integer id =  GetUnitTypeId(u)
  
  if id<'H06W' or id>'H06Y' then
    call SaveBoolean(MHT,GetHandleId(u),'A085',false)
  endif
  
  set u = null
endfunction

function Keeper_Illuminate_Targets takes nothing returns boolean
  local unit u = GetFilterUnit()
  local integer id = GetUnitTypeId(u)
  
  if IsDead(u)==false and IsUnitEnemy(u,group_temp_player) and IsUnitInGroup(u,ILLUMINATEGROUP)==false and (GetUnitAbilityLevel(u,'A04R')==0 or IsSiegeUnit(u))  and IsUnitType(u,UNIT_TYPE_STRUCTURE)==false then
    call GroupAddUnit(ILLUMINATEGROUP,u)
    call DamageTarget(group_temp_unit[0],u,1,group_temp_integer[0])
    
  endif
  
  set u = null
  return false
endfunction

function Keeper_Illuminate_Effect takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,0)
  local real x
  local real y
  local real s = LoadReal(MHT,info,StringHash("scale"))
  local unit cho = LoadUnitHandle(MHT,info,1)
  
  if count==1then
    call KillGroup(LoadGroupHandle(MHT,info,2))
    call Timer_End(t)
    call KillUnit(u)
    
    set t = null
    set u = null
    return
  endif
  
  call SaveInteger(MHT,info,0,count - 1)
  
  set x = GetWidgetX(u) + LoadReal(MHT,info,3)
  set y = GetWidgetY(u) + LoadReal(MHT,info,4)
  
  call SetUnitX(u,x)
  call SetUnitY(u,y)
  
  if s<0.4 then
    set s=s+0.025
  elseif s<1.5 and s>0.4 then
    set s=s+0.09
  else
    set s=1.5
  endif
  call SetUnitScale(u,s,s,s)
  call SaveReal(MHT,info,StringHash("scale"),s)
  
  call TimedReveal(GetOwningPlayer(cho),2.5,x,y,375)
  
  
  set group_temp_player = LoadPlayerHandle(MHT,info,2)
  set group_temp_unit[0] = cho
  set group_temp_integer[0] = LoadInteger(MHT,info,1)
  set ILLUMINATEGROUP = LoadGroupHandle(MHT,info,3)
  call GroupEnumUnitsInRange(temp_group,x,y,375,Condition(function Keeper_Illuminate_Targets))
  set cho=null
  set t = null
  set u = null
endfunction

function Keeper_Illuminate_Charge takes nothing returns nothing
  local real s
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0) - 1
  local unit u = LoadUnitHandle(MHT,info,0)
  local unit cho
  
  if count==0 or LoadBoolean(MHT,GetHandleId(LoadUnitHandle(MHT,info,1)),'A085')==false then
    call KillUnit(u)
    
    set cho=CreateUnit(Player(15),'h070',LoadReal(MHT,info,0),LoadReal(MHT,info,1),LoadReal(MHT,info,2))
    call SetUnitScale(cho,0.1,0.1,0.1)
    call SaveReal(MHT,info,StringHash("scale"),0.15)
    call SaveInteger(MHT,info,0,61)
    call SaveInteger(MHT,info,1,(LoadInteger(MHT,info,1) - count)*10)
    call SaveUnitHandle(MHT,info,0,cho)
    call SaveGroupHandle(MHT,info,3,GetAvailableGroup())
    
    call TimerStart(t,0.025,true,function Keeper_Illuminate_Effect)
    
    call SaveBoolean(MHT,GetHandleId(LoadUnitHandle(MHT,info,1)),'A085',false)
    call SetPlayerAbilityAvailable2(LoadPlayerHandle(MHT,info,2),'A121',false)
    call SetPlayerAbilityAvailable2(LoadPlayerHandle(MHT,info,2),'A085',true)
    
    call RemoveUnit(LoadUnitHandle(MHT,info,4))
    set cho=null
    set t = null
    set u = null
    return
  endif
  
  set s = 1 + (LoadInteger(MHT,info,1) - count) * 0.1
  call SetUnitScale(u,s,s,s)
  
  call SaveInteger(MHT,info,0,count)
  
  set t = null
  set u = null
endfunction

function Keeper_Illuminate_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local player p = GetOwningPlayer(u)
  local real x = GetWidgetX(u)
  local real y = GetWidgetY(u)
  local real a = Atan2(GetSpellTargetY()-y,GetSpellTargetX()-x)
  local real x1 = x + 150*Cos(a)
  local real y1 = y + 150*Sin(a)
  local integer info = GetHandleId(t)
  local integer i = GetUnitAbilityLevel(u,'A085')*10 + 10
  
  call SetPlayerAbilityAvailable2(p,'A085',false)
  call SetPlayerAbilityAvailable2(p,'A121',true)
  call UnitAddAbility2(u,'A121')
  
  call SaveUnitHandle(MHT,info,0,CreateUnit(Player(15),'u00J',x1,y1,a*bj_RADTODEG))
  
  
  call SavePlayerHandle(MHT,info,2,p)
  call SaveInteger(MHT,info,0,i)
  call SaveInteger(MHT,info,1,i)
  
  call SaveReal(MHT,info,0,x1)
  call SaveReal(MHT,info,1,y1)
  call SaveReal(MHT,info,2,a*bj_RADTODEG)
  call SaveReal(MHT,info,3,26.25*Cos(a))
  call SaveReal(MHT,info,4,26.25*Sin(a))
  
  
  if GetUnitTypeId(u)=='e00E' then //multicast
    call SaveUnitHandle(MHT,info,1,udg_Hero[GetPlayerId(p)])
    
    call SaveBoolean(MHT,GetHandleId(udg_Hero[GetPlayerId(p)]),'A085',true)
  else
    call SaveUnitHandle(MHT,info,1,u)
    call SaveBoolean(MHT,GetHandleId(u),'A085',true)
    
    if GetUnitTypeId(u)>='H06W' and GetUnitTypeId(u)<='H06Y' then
      set u = CreateUnit(p,'h06Z',x,y,a*bj_RADTODEG)
      call SetUnitX(u,x)
      call SetUnitY(u,y)
      call SetUnitAnimation(u,"spell")
      call QueueUnitAnimation(u,"spell")
      call SetUnitVertexColor(u,255,255,255,75)
      call SaveUnitHandle(MHT,info,4,u)
    endif
  endif
  
  
  call TimerStart(t,0.1,true,function Keeper_Illuminate_Charge)
  
  set t = null
  set u = null
endfunction


function Y3E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer DP9=(LoadInteger(hashtable019,(Cache),(188)))
  local integer Count=GetTriggerEvalCount(t)
  if Count==DP9 or GetUnitTypeId(Source)=='Hblm' then
    if(LoadReal(hashtable019,(GetHandleId(Source)),(241)))<=(TimerGetElapsed(GlobalTimer))or GetUnitTypeId(Source)=='Hblm' then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A11T',true)
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  return false
endfunction

function Y6E takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A11T')
  local integer DP9=40
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A11T',false)
  call SaveReal(hashtable019,(GetHandleId(Source)),(241),(((TimerGetElapsed(GlobalTimer))+DP9)*1.))
  call SaveInteger(hashtable019,(Cache),(188),(DP9))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function Y3E))
  set t=null
  set Source=null
endfunction

function Ignis_Main takes nothing returns boolean
  if GetSpellAbilityId()=='A11T' and GetUnitTypeId(GetTriggerUnit())=='Hblm' then
    call Y6E()
  endif
  return false
endfunction

function YLE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real RLD=(LoadReal(hashtable019,(Cache),(242)))
  call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)+RLD)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIim\\AIimTarget.mdl",Target,"origin"))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set Target=null
  set t=null
  return false
endfunction

function Kotl_ChakraMagic takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(242),((75*GetUnitAbilityLevel(Hero,'A112'))*1.))
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function YLE))
  set t=null
  set Hero=null
  set Target=null
endfunction

function Y5E takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local real x=GetUnitX(Target)
  local real y=GetUnitY(Target)
  local real a=Atan2(y-FG8,x-FF8)
  set x=SafeX50(x+25*Cos(a))
  set y=SafeY50(y+25*Sin(a))
  call KillTrees(x,y,150)
  call SetUnitX(Target,x)
  call SetUnitY(Target,y)
  set Target=null
endfunction

function Y2E takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local unit Caster=CreateUnit(tt_player1,'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,'A10W')
  call SetUnitAbilityLevel(Caster,'A10W',FE8)
  call IssueTargetOrderById(Caster,852585,Target)
  set Target=null
  set Caster=null
endfunction

function Z4E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(189)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(190)))
  local integer CG8=(LoadInteger(hashtable019,(Cache),(59)))
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  local integer Count=GetTriggerEvalCount(t)
  set FF8=SourceX
  set FG8=SourceY
  call ForGroup(g,function Y5E)
  if Count==10 then
    if CG8=='A11X' then
      set FE8=1
    elseif CG8=='A11V' then
      set FE8=2
    else
      set FE8=3
    endif
    set tt_player1=p
    call ForGroup(g,function Y2E)
    call KillGroup(g)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set p=null
  set g=null
  return false
endfunction

function Z7E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(189)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(190)))
  local integer CG8=(LoadInteger(hashtable019,(Cache),(59)))
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  call CleanTrigger(t)
  call FlushChildHashtable(hashtable019,(Cache))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.04,true)
  call TriggerAddCondition(t,Condition(function Z4E))
  call SavePlayerHandle(hashtable019,(Cache),(54),(p))
  call SaveReal(hashtable019,(Cache),(189),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(190),((SourceY)*1.))
  call SaveGroupHandle(hashtable019,(Cache),(22),(g))
  call SaveInteger(hashtable019,(Cache),(59),(CG8))
  set t=null
  set p=null
  set g=null
  return false
endfunction

function Kotl_BlindingLight takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local group g=GetAvailableGroup()
  local unit Source=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  call KillUnit(CreateUnit(GetOwningPlayer(Source),'h06P',x,y,0))
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x,y,700,Condition(function NonImmuneEnemyFilter))
  call TriggerRegisterTimerEvent(t,.4,false)
  call TriggerAddCondition(t,Condition(function Z7E))
  call SavePlayerHandle(hashtable019,(Cache),(54),(GetOwningPlayer(GetTriggerUnit())))
  call SaveReal(hashtable019,(Cache),(189),((x)*1.))
  call SaveReal(hashtable019,(Cache),(190),((y)*1.))
  call SaveGroupHandle(hashtable019,(Cache),(22),(g))
  call SaveInteger(hashtable019,(Cache),(59),(GetSpellAbilityId()))
  //call RemoveLocation(l)
  set t=null
  set g=null
  //set l=null
  set Source=null
endfunction




function Lina_Soul_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer loopA = 0
  local integer info = GetHandleId(t)
  local unit u = LoadUnitHandle(MHT,info,0)
  local integer load = GetHandleId(u)
  local integer count = LoadInteger(MHT,load,'A18X')
  
  call LoDStat_Sub(u,LoadInteger(MHT,info,0),"attack")
  //call LoDMovePercentage_Sub(u,LoadReal(MHT,info,0))
  call SubBonusMSPercent(u,R2I(LoadReal(MHT,info,0)))
  
  loop
    exitwhen loopA == count
    call DestroyEffect(LoadEffectHandle(MHT,info,1 + loopA*2))
    call DestroyEffect(LoadEffectHandle(MHT,info,2 + loopA*2))
    set loopA = loopA + 1
  endloop
  
  call RemoveSavedInteger(MHT,load,'A18X')
  
  call Timer_End(t)
  set t = null
  set u = null
endfunction

function Lina_Soul_Start takes unit u, integer load, integer count returns nothing
  local timer t = LoadTimerHandle(MHT,load,'A18X')
  local integer info = GetHandleId(t)
  local integer i = 30 + 10*GetUnitAbilityLevel(u,'A18X')
  
  if t==null then
    set t = Timer_Get()
    set info = GetHandleId(t)
    call SaveTimerHandle(MHT,load,'A18X',t)
  endif
  
  call LoDStat_Add(u,i,"attack")
  //call LoDMovePercentage_Add(u,i*0.001)
  call AddBonusMSPercent(u,R2I(i*.1+1))
  call SaveInteger(MHT,load,'A18X',count + 1)
  call SaveUnitHandle(MHT,info,0,u)
  call SaveEffectHandle(MHT,info,1 + 2*count,AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl",u,"head"))
  call SaveEffectHandle(MHT,info,2 + 2*count,AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl",u,"chest"))
  call SaveInteger(MHT,info,0,i + LoadInteger(MHT,info,0))
  call SaveReal(MHT,info,0,R2I(i*.1) + R2I(LoadReal(MHT,info,0)))
  
  call TimerStart(t,7,false,function Lina_Soul_End)
  
  set t = null
endfunction

function ZGE takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local integer load = GetHandleId(u)
  local integer count = LoadInteger(MHT,load,'A18X')
  
  call Buff_Add(u,LoDBuff_AbilID[21],LoDBuff_BuffID[21],9)
  
  if count==3 then
    call TimerStart(LoadTimerHandle(MHT,load,'A18X'),9,false,function Lina_Soul_End)
    set u = null
    return
  endif
  
  call Lina_Soul_Start(u,load,count)
  
  set u = null
endfunction

function ZIE takes nothing returns boolean
  if (Valid_Spell(GetSpellAbilityId()) and GetSpellAbilityId()!='AItb') or (Mode_BO and BalanceOffSpellChecker(GetSpellAbilityId()))then
    call ZGE()
  endif
  return false
endfunction

function Lina_FierySoul_Learn takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function ZIE))
  set t=null
  set Hero=null
endfunction

function ZKE takes nothing returns boolean
  if GetLearnedSkill()=='A18X' and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Lina_FierySoul_Learn()
  endif
  return false
endfunction

function T89 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function ZKE))
  set t=null
endfunction

function Lina_LagunaBlade_OnCast takes nothing returns nothing
  if IsMagicImmune(GetSpellTargetUnit())then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n0LR'))
  endif
endfunction

function LoDLightStrikeArray_Cast takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  call UnitAddAbility(Caster,'A027')
  call SetUnitAbilityLevel(Caster,'A027',GetUnitAbilityLevel(Source,GetSpellAbilityId()))
  if IssuePointOrder(Caster,"dreadlordinferno",x,y)==false then
    call IssuePointOrder(Caster,"inferno",x,y)
  endif
  set Source=null
  set Caster=null
endfunction

function ZNE takes nothing returns boolean
  local unit u = GetTriggerUnit()
  
  if GetLearnedSkill()=='A041' or GetLearnedSkill()=='QP0D' then
    call SetPlayerTechResearched(GetOwningPlayer(u),'Remg',GetLearnedSkillLevel())
  endif
  
  set u = null
  return false
endfunction

function Luna_Aura_Targets takes nothing returns nothing
  local integer key
  local integer info
  local unit u = GetFilterUnit()
  
  if IsUnitType(u,UNIT_TYPE_HERO)and IsUnitAlly(u,group_temp_player)and IsDead(u)==false then
    call GroupAddUnit(temp_group2,u)   //adds the unit to group of currently affected units
    
    if IsUnitInGroup(u,group_temp_group)==false then  //hasn't been affected by the aura
      set info = GetHandleId(u)
      set key = StringHash("lunar_count")
      
      call Buff_Add(u,LoDBuff_AbilID[32],LoDBuff_BuffID[32],-1) //adds the buff
      call LoDStat_Add(u,group_temp_integer[1],"damage")  //adds new damage
      
      call SaveInteger(MHT,info,key,LoadInteger(MHT,info,key) + 1) //keeps track of the number of times the unit has been affected for correct buff removal
      
      set u = null
      return
    endif
    
    call GroupRemoveUnit(group_temp_group,u) //removes the unit from the group of previously affected units
    
    if LoadBoolean(MHT,99999,99998)then     //checks to see if the amount of bonus damage has changed
      call LoDStat_Add(u,group_temp_integer[1],"damage") //updates damage amount
      call LoDStat_Sub(u,group_temp_integer[0],"damage") //removes old damage
    endif
  endif
  
  set u = null
endfunction
function Luna_Aura_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer key = StringHash("lunar_count")
  local integer info = GetHandleId(t)
  local unit u = LoadUnitHandle(MHT,info,0)
  
  set group_temp_group = LoadGroupHandle(MHT,info,1)
  set group_temp_integer[0] = LoadInteger(MHT,info,0)
  
  if IsDead(u)then
    set u = FirstOfGroup(group_temp_group)
    
    if u!=null then //checks to see if any units are still being affected by the aura and removes the bonuses if they are
      loop
        set info = GetHandleId(u)
        
        call SaveInteger(MHT,info,key,LoadInteger(MHT,info,key) - 1)
        
        if LoadInteger(MHT,info,key)==0then
          call Buff_Remove(u,LoDBuff_BuffID[32])
        endif
        
        call LoDStat_Sub(u,group_temp_integer[0],"damage")
        call GroupRemoveUnit(group_temp_group,u)
        set u = FirstOfGroup(group_temp_group)
        exitwhen u==null
      endloop
    endif
    set u=null
    set t = null
    return
  endif
  
  set group_temp_integer[1] = IMaxIF(GetUnitAbilityLevel(u,'A062'),GetUnitAbilityLevel(u,'QP0E'))*8 + 6
  set group_temp_player = GetOwningPlayer(u)
  
  if group_temp_integer[0]!=group_temp_integer[1] then
    call SaveBoolean(MHT,99999,99998,true)
    call SaveInteger(MHT,info,0,group_temp_integer[1]) //updates the current amount of damage being added
  else
    call SaveBoolean(MHT,99999,99998,false)
  endif
  
  call GroupEnumUnitsInRange(temp_group,GetWidgetX(u),GetWidgetY(u),925,Condition(function Luna_Aura_Targets))
  
  
  //removes the bonuses from any unit out of range
  loop
    set u = FirstOfGroup(group_temp_group)
    exitwhen u==null
    set info = GetHandleId(u)
    
    call SaveInteger(MHT,info,key,LoadInteger(MHT,info,key) - 1)
    
    if LoadInteger(MHT,info,key)==0then
      call Buff_Remove(u,LoDBuff_BuffID[32])
    endif
    
    call LoDStat_Sub(u,group_temp_integer[0],"damage")
    call GroupRemoveUnit(group_temp_group,u)
  endloop
  
  //updates the current group with the newly affected units
  loop
    set u = FirstOfGroup(temp_group2)
    exitwhen u==null
    call GroupRemoveUnit(temp_group2,u)
    call GroupAddUnit(group_temp_group,u)
  endloop
  
  
  set t = null
endfunction
function Luna_Aura_Learn takes nothing returns nothing
  local timer t = CreateTimer()
  local unit u = GetTriggerUnit()
  local integer info = GetHandleId(t)
  call SaveBoolean(MHT,99999,99998,true) //has the amount of bonus damage changed, set to true initially (duh)
  
  set group_temp_group = CreateGroup()
  set group_temp_player = GetOwningPlayer(u)
  set group_temp_integer[0] = 0    //previous bonus damage, set to 0 since its the first time
  set group_temp_integer[1] = IMaxIF(GetUnitAbilityLevel(u,'A062'),GetUnitAbilityLevel(u,'QP0E'))*8 + 6
  
  call SaveUnitHandle(MHT,info,0,u)
  call SaveGroupHandle(MHT,info,1,group_temp_group)  //previously affected units
  call SaveInteger(MHT,info,0,group_temp_integer[1]) //the current amount of damage being added
  
  call GroupEnumUnitsInRange(temp_group,GetWidgetX(u),GetWidgetY(u),925,Condition(function Luna_Aura_Targets))
  
  //adds all the affected unit to the currrent group
  loop
    set u = FirstOfGroup(temp_group2)
    exitwhen u==null
    call GroupRemoveUnit(temp_group2,u)
    call GroupAddUnit(group_temp_group,u)
  endloop
  
  call SetPlayerTechResearched(group_temp_player,'R00I',1)
  call TimerStart(t,0.25,true,function Luna_Aura_Duration)
  set u=null
  set t = null
endfunction


function LoDMoonGlaive_MoveProjectile takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  local unit Target=LoadUnitHandle(hashtable019,Cache,17)
  local unit Projectile=LoadUnitHandle(hashtable019,Cache,19)
  local group AlreadyHit=LoadGroupHandle(hashtable019,Cache,'MGLA')
  local real Damage=LoadReal(hashtable019,Cache,20)
  local integer Count=LoadInteger(hashtable019,Cache,34)
  local real x0=GetUnitX(Projectile)
  local real y0=GetUnitY(Projectile)
  local real x1=GetUnitX(Target)
  local real y1=GetUnitY(Target)
  local real a=Atan2(y1-y0,x1-x0)
  local integer id
  if GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call KillUnit(Projectile)
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,Cache)
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    set id=GetSpellAbilityId()
    if id=='A0ME' or id=='AEbl' or id=='QB08' or id=='A01O' or id=='A0FN' or id=='QB07' or id=='A14O' then
      call KillUnit(Projectile)
      call CleanTrigger(t)
      call FlushChildHashtable(hashtable019,Cache)
      set t=null
      set Source=null
      set Target=null
      set Projectile=null
      return false
    endif
  else
    if IsUnitHidden(Target) or (IsUnitVisibleLoD(Target,GetOwningPlayer(Source))==false and GenericCondition_IsDotAInvis(Target)) then
      call KillUnit(Projectile)
      call CleanTrigger(t)
      call FlushChildHashtable(hashtable019,Cache)
      set t=null
      set Source=null
      set Target=null
      set Projectile=null
      return false
    endif
    if DistanceBetweenXY(x0,y0,x1,y1)<LoadReal(hashtable019,Cache,0) then
      call KillUnit(Projectile)
      call CleanTrigger(t)
      call FlushChildHashtable(hashtable019,Cache)
      call DamageTarget(Source,Target,2,Damage)
      //call echo("dealing "+R2S(Damage)+" to "+GetUnitName(Target))
      if Count-1>0 then
        set LoDMoonGlaive_AlreadyHit=AlreadyHit
        set LoDMoonGlaive_Source=Source
        set LoDMoonGlaive_Origin=Target
        set LoDMoonGlaive_Damage=Damage
        set LoDMoonGlaive_Count=Count-1
        call ExeFunc("LoDMoonGlaive_BounceFromGlobal")
      endif
    else
      call SetUnitX(Projectile,x0+22*Cos(a))
      call SetUnitY(Projectile,y0+22*Sin(a))
    endif
  endif
  set t=null
  set AlreadyHit=null
  set Source=null
  set Target=null
  set Projectile=null
  return false
endfunction

function LoDMoonGlaive_FindClosest takes nothing returns boolean
  local unit Picked=GetFilterUnit()
  local real Distance=DistanceBetweenUnits(Picked,LoDMoonGlaive_Origin)
  if IsUnitEnemy(Picked,GetOwningPlayer(LoDMoonGlaive_Source)) and IsDead(Picked)==false and C58(Picked)==false and Distance<LoDMoonGlaive_MaxDistance and GetUnitAbilityLevel(Picked,'A04R')==0 and IsUnitInRangeXY(Picked,GetUnitX(LoDMoonGlaive_Origin),GetUnitY(LoDMoonGlaive_Origin),500) and GetUnitAbilityLevel(Picked,'Avul')==0 and IsUnitVisibleLoD(Picked,GetOwningPlayer(LoDMoonGlaive_Origin))==true then
    set LoDMoonGlaive_Counter=LoDMoonGlaive_Counter+1
    if IsUnitInGroup(Picked,LoDMoonGlaive_AlreadyHit)==false then
      set LoDMoonGlaive_MaxDistance=Distance
      set LoDMoonGlaive_Target=Picked
    endif
  endif
  set Picked=null
  return false
endfunction

function LoDMoonGlaive_BounceFrom takes unit Source,unit Origin,real Damage,group AlreadyHit,integer Count returns nothing
  local group g=GetAvailableGroup()
  local unit Target
  local unit Projectile
  local trigger t
  local integer Cache
  set LoDMoonGlaive_AlreadyHit=AlreadyHit
  set LoDMoonGlaive_Source=Source
  set LoDMoonGlaive_Origin=Origin
  set LoDMoonGlaive_MaxDistance=9999
  set LoDMoonGlaive_Target=null
  set LoDMoonGlaive_Counter=0
  call GroupAddUnit(AlreadyHit,Origin)
  call GroupEnumUnitsInRange(g,GetUnitX(Origin),GetUnitY(Origin),700,Condition(function LoDMoonGlaive_FindClosest))
  if LoDMoonGlaive_Target==null and LoDMoonGlaive_Counter>1 then//there are other units
    call GroupClear(AlreadyHit)
    call GroupAddUnit(AlreadyHit,Origin)
    call GroupEnumUnitsInRange(g,GetUnitX(Origin),GetUnitY(Origin),700,Condition(function LoDMoonGlaive_FindClosest))
  endif
  call KillGroup(g)
  set Target=LoDMoonGlaive_Target
  if Target!=null then
    set Projectile=CreateUnit(GetOwningPlayer(Source),'h999',GetUnitX(Origin),GetUnitY(Origin),0)
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,0.025,true)
    call TriggerRegisterDeathEvent(t,Target)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_SPELL_EFFECT)
    call TriggerAddCondition(t,Condition(function LoDMoonGlaive_MoveProjectile))
    call SaveUnitHandle(hashtable019,Cache,2,Source)
    call SaveUnitHandle(hashtable019,Cache,17,Target)
    call SaveUnitHandle(hashtable019,Cache,19,Projectile)
    if IsUnitType(Target,UNIT_TYPE_STRUCTURE) then
      call SaveReal(hashtable019,Cache,0,50)
    else
      call SaveReal(hashtable019,Cache,0,30)
    endif
    call SaveGroupHandle(hashtable019,Cache,'MGLA',AlreadyHit)
    call SaveReal(hashtable019,Cache,20,Damage*0.65)
    call SaveInteger(hashtable019,Cache,34,Count)
  endif
  set g=null
  set Target=null
  set Projectile=null
  set t=null
endfunction

function LoDMoonGlaive_BounceFromGlobal takes nothing returns nothing
  call LoDMoonGlaive_BounceFrom(LoDMoonGlaive_Source,LoDMoonGlaive_Origin,LoDMoonGlaive_Damage,LoDMoonGlaive_AlreadyHit,LoDMoonGlaive_Count)
endfunction

function LoDMoonGlaive_OnHit takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  local unit Target=LoadUnitHandle(hashtable019,Cache,17)
  local integer Level=LoadInteger(hashtable019,Cache,5)
  local group AlreadyHit=LoadGroupHandle(hashtable019,GetHandleId(Source),'MGLA')
  local real Damage=GetEventDamage()
  if Level==4 then
    set Level=5
  endif
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    //call echo("expired")
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,Cache)
  elseif GetUnitAbilityLevel(Target,'B999')>0 and Damage>0 and GetEventDamageSource()==Source and IsRealDamage then
    //call echo(GetUnitName(Target)+" hit for "+R2S(GetEventDamage())+", starting bounces")
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,Cache)
    call UnitRemoveAbility(Target,'B999')
    call GroupClear(AlreadyHit)
    call GetUnitPhysicalResistance(Target)
    if Mode_Debug then
      //call echo("Resistance="+R2S(GetUnitPhysicalResistance_Result)+", Damage="+R2S(Damage)+", Real damage="+R2S(Damage/GetUnitPhysicalResistance_Result))
    endif
    call LoDMoonGlaive_BounceFrom(Source,Target,Damage/GetUnitPhysicalResistance_Result,AlreadyHit,Level)
  else
    //call echo(GetUnitName(Target)+" hit for "+R2S(GetEventDamage()))
  endif
  set t=null
  set Source=null
  set Target=null
  set AlreadyHit=null
  return false
endfunction

function LoDMoonGlaive_PreventGroupLeak takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  local group AlreadyHit=LoadGroupHandle(hashtable019,Cache,'MGLA')
  if Source==null then
    call KillGroup(AlreadyHit)
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,Cache)
  endif
  set t=null
  set Source=null
  set AlreadyHit=null
  return false
endfunction

function LoDMoonGlaive takes nothing returns boolean
  local trigger t
  local integer Cache
  local unit Source=GetAttacker()
  local unit Target=GetTriggerUnit()
  local group AlreadyHit=LoadGroupHandle(hashtable019,GetHandleId(Source),'MGLA')
  local integer Level=IMaxIF(GetUnitAbilityLevel(Source,'P098'),GetUnitAbilityLevel(Source,'QP0D'))
  //call echo("run"+I2S(Level))
  if Level>0 then
    //call echo("moon glaive start from "+GetUnitName(Source)+" to "+GetUnitName(Target))
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,3,false)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerAddCondition(t,Condition(function LoDMoonGlaive_OnHit))
    call SaveUnitHandle(hashtable019,Cache,2,Source)
    call SaveUnitHandle(hashtable019,Cache,17,Target)
    call SaveInteger(hashtable019,Cache,5,Level)
    if AlreadyHit==null then
      //call echo("creating group")
      set AlreadyHit=GetAvailableGroup()
      call SaveGroupHandle(hashtable019,GetHandleId(Source),'MGLA',AlreadyHit)
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call TriggerRegisterTimerEvent(t,5,true)
      call TriggerAddCondition(t,Condition(function LoDMoonGlaive_PreventGroupLeak))
      call SaveUnitHandle(hashtable019,Cache,2,Source)
      call SaveGroupHandle(hashtable019,Cache,'MGLA',AlreadyHit)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set AlreadyHit=null
  return false
endfunction

function Luna_Glaive_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function ZNE))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function LoDMoonGlaive))
  set t=null
endfunction

function DarknessStop takes nothing returns nothing
  call SaveBoolean(MHT,'DARK',0,false)
  call SuspendTimeOfDay(false) 
  call SetFloatGameState(GAME_STATE_TIME_OF_DAY,LoadReal(MHT,'DARK',1))
  
endfunction

function ImitateDarkness takes real dur returns nothing
  local real curTime=TimerGetElapsed(GlobalTimer)
  local real darknessEnd=LoadReal(MHT,'DARK',0)
  if curTime+dur>darknessEnd then
    call TimerStart(DarknessTimer,dur,false,function DarknessStop)
    //call SaveReal(MHT,'DARK',0,curTime+dur)
    call SuspendTimeOfDay(true)
    if LoadBoolean(MHT,'DARK',0)==false then//if false there are no other darkness so time is real, not 00:00. when true it always 00:00
      call SaveReal(MHT,'DARK',1,GetFloatGameState(GAME_STATE_TIME_OF_DAY))
    endif
    call SetFloatGameState(GAME_STATE_TIME_OF_DAY,0)
    call SaveBoolean(MHT,'DARK',0,true)
  endif
  
endfunction

function ZOE takes nothing returns boolean
  if(GetUnitTypeId((GetFilterUnit()))=='u009')or(IsMagicImmune(GetFilterUnit())==false and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))then
    if(LoadInteger(hashtable019,(FH8),(GetHandleId(GetFilterUnit()))))<tt_int1 then
      return true
    endif
  endif
  return false
endfunction

function ZPE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer ZQE=(LoadInteger(hashtable019,(Cache),(217)))
  local integer integer500=(LoadInteger(hashtable019,(Cache),(216)))
  local integer ZRE=(LoadInteger(hashtable019,(Cache),(218)))
  local group g=GetAvailableGroup()
  local real x=GetUnitX(Hero)
  local real y=GetUnitY(Hero)
  local unit Target
  local real r1=GetRandomInt(200,350)
  local real r2=GetRandomInt(200,350)
  if GetRandomInt(1,2)==1 then
    set r1=-1*r1
    set r2=-1*r2
  endif
  set tt_unit1=Hero
  set tt_int1=ZRE
  set FH8=GetHandleId(t)
  call GroupEnumUnitsInRange(g,x,y,700,Condition(function ZOE))
  set Target=GroupPickRandomUnit(g)
  call KillGroup(g)
  if IsDead(Hero)==false and Target!=null and(GetUnitTypeId((Target))=='u009')==false then
    call SaveInteger(hashtable019,(FH8),(GetHandleId(Target)),((LoadInteger(hashtable019,(FH8),(GetHandleId(Target))))+1))
    call Z48("effects\\Eclipse.mdx",Target,"origin",3)
    call DamageTarget(Hero,Target,1,ZQE*75)
  elseif IsDead(Hero)==false then
    set x=x+GetRandomInt(-350,350)
    set y=y+GetRandomInt(-350,350)
    call ZD8("effects\\Eclipse.mdx",x,y,1.5)
  endif
  if(GetTriggerEvalCount(t)+1)==integer500 or IsDead(Hero) then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Hero=null
  set g=null
  set Target=null
  return false
endfunction

function Luna_Eclipse takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer integer500
  local integer ZQE=4
  local integer ZRE
  //call UnitAddAbility2(Caster,'A1T6')
  if GetSpellAbilityId()=='A054' then
    set integer500=1+3*GetUnitAbilityLevel(Hero,'A054')
    set ZRE=3+GetUnitAbilityLevel(Hero,'A054')
  else
    set integer500=4*GetUnitAbilityLevel(Hero,'A00U')
    set ZRE=99
  endif
  call SaveInteger(hashtable019,(Cache),(217),(ZQE))
  call SaveInteger(hashtable019,(Cache),(216),(integer500))
  call SaveInteger(hashtable019,(Cache),(218),(ZRE))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call TriggerRegisterTimerEvent(t,.6,true)
  call TriggerAddCondition(t,Condition(function ZPE))
  call TriggerEvaluate(t)
  call ImitateDarkness(10.0)
  //call IssueImmediateOrderById(Caster,852621)
  set t=null
  set Hero=null
  //set Caster=null
endfunction

function ZUE takes nothing returns nothing
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl",GetEnumUnit(),"origin"))
endfunction

function ZVE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  call DamageTarget(Hero,Target,1,GetUnitAbilityLevel(Hero,'A0KV')*56.25)
  call UnitAsInteger_Clear(XK8)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  set Target=null
  return false
endfunction

function ZWE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local group g=GetAvailableGroup()
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  if IsDead(Target) then
    set FJ8=Hero
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),200,Condition(function LT8))
    set Target=GroupPickRandomUnit(g)
    call KillGroup(g)
    set g=null
  endif
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl",Target,"origin"))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveInteger(hashtable019,(Cache),(30),(XK8))
  call TriggerRegisterTimerEvent(t,.5,false)
  call TriggerAddCondition(t,Condition(function ZVE))
  set t=null
  set Hero=null
  set Target=null
  return false
endfunction

function ZXE takes nothing returns nothing
  call DamageTarget(FJ8,GetEnumUnit(),1,FI8)
endfunction

function ZYE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  set FI8=GetUnitAbilityLevel(Hero,'A0KV')*75
  set FJ8=Hero
  call ForGroup(g,function ZXE)
  call KillGroup(g)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  set g=null
  return false
endfunction

function ZZE takes nothing returns nothing
  local real YR8=DistanceBetweenUnits(GetTriggerUnit(),GetEnumUnit())
  if YR8>650 then
  else
    call GroupAddUnit(DK,GetEnumUnit())
  endif
endfunction

function Potm_Starfall takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local group g=GetAvailableGroup()
  local unit Target
  set tt_unit1=Hero
  set FJ8=Hero
  set DK=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),900,Condition(function LT8))
  call ForGroup(g,function ZZE)
  call KillGroup(g)
  set g=DK
  call ForGroup(g,function ZUE)
  call SaveGroupHandle(hashtable019,(Cache),(22),(g))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call TriggerRegisterTimerEvent(t,.5,false)
  call TriggerAddCondition(t,Condition(function ZYE))
  set FJ8=Hero
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),200,Condition(function LT8))
  set Target=GroupPickRandomUnit(g)
  call KillGroup(g)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallCaster.mdl",Hero,"origin")))
  call TriggerRegisterTimerEvent(t,1,false)
  call TriggerAddCondition(t,Condition(function ZWE))
  set t=null
  set g=null
  set Hero=null
  set Target=null
endfunction

function Z3E takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit())))!=null
endfunction

function Z6E takes nothing returns nothing
  call UnitAddAbility2(GetEnumUnit(),('A0KT'))
  call SetUnitAbilityLevel(GetEnumUnit(),('A0KT'),TmpInt377)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Invisibility\\InvisibilityTarget.mdl",GetEnumUnit(),"chest"))
endfunction

function RemoveInvinsIfFailed takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local unit u=LoadUnitHandle(hashtable019,GetHandleId(t),0)
  call UnitRemoveAbility(u,'A0KT')
  if(GetUnitAbilityLevel(u,'A0KT')==0) then
    call FlushChildHashtable(hashtable019,GetHandleId(t))
    call DestroyTrigger(t)
  endif
  set t=null
  set u=null
endfunction

function ZLE takes nothing returns nothing
  local trigger t
  local integer h
  call UnitRemoveAbility(GetEnumUnit(),('A0KT'))
  if GetUnitAbilityLevel(GetEnumUnit(),'A0KT')>0 then
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,0.5,true)
    call TriggerAddCondition(t,Condition(function RemoveInvinsIfFailed))
    call SaveUnitHandle(hashtable019,GetHandleId(t),0,GetEnumUnit())
    set t=null
  endif
  
endfunction

function Z1E takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer Cache=GetHandleId(t)
  local group g=LoadGroupHandle(hashtable019,Cache,220)
  call ForGroup(g,function ZLE)
  call KillGroup(g)
  call CleanTimer(t)
  set t=null
  set g=null
endfunction

function Potm_MoonlightShadows takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local group g=GetAvailableGroup()
  local timer t=CreateTimer()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Hero,'A0KU')
  local real DP9=15
  set TmpInt377=Level
  call GroupEnumUnitsInRange(g,0,0,12000,Condition(function Z3E))
  call ForGroup(g,function Z6E)
  call SaveGroupHandle(hashtable019,Cache,220,g)
  call TimerStart(t,DP9,false,function Z1E)
  set Hero=null
  set g=null
  set t=null
endfunction

function Z2E takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(TmpUnit376)))!=null
endfunction

function A4E takes nothing returns nothing
  local unit Hero=GetEnumUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e01R',0,0,0)
  call UnitAddAbility2(Caster,('A0LO'))
  call SetUnitAbilityLevel(Caster,('A0LO'),GetUnitAbilityLevel(TmpUnit376,('A0LN')))
  call UnitApplyTimedLife(Caster,'BTLF',10)
  set Hero=null
  set Caster=null
endfunction

function A7E takes unit Hero returns nothing
  local group HQ9=GetAvailableGroup()
  set TmpUnit376=Hero
  call GroupEnumUnitsInRange(HQ9,GetUnitX(Hero),GetUnitY(Hero),800,Condition(function Z2E))
  call ForGroup(HQ9,function A4E)
  call KillGroup(HQ9)
  set HQ9=null
endfunction

function A8E takes unit Hero returns nothing
  local integer Cache=GetHandleId(Hero)
  local string boolean150=(LoadStr(hashtable019,(Cache),(206)))
  local string ADE=OrderId2String((LoadInteger(hashtable019,(Cache),(211))))
  local real TargetX
  local real TargetY
  local unit Target
  local trigger t=(LoadTriggerHandle(hashtable019,(Cache),(204)))
  local boolean unit045=not(LoadBoolean(hashtable019,(Cache),(207)))
  local boolean AFE=(LoadBoolean(hashtable019,(Cache),(208)))
  call DisableTrigger(t)
  call IssueImmediateOrderById(Hero,851972)
  if boolean150=="Target"and(unit045 or AFE)then
    set Target=(LoadUnitHandle(hashtable019,(Cache),(215)))
    call IssueTargetOrder(Hero,ADE,Target)
  elseif boolean150=="Point"and(unit045 or AFE)then
    set TargetX=(LoadReal(hashtable019,(Cache),(209)))
    set TargetY=(LoadReal(hashtable019,(Cache),(210)))
    call IssuePointOrder(Hero,ADE,TargetX,TargetY)
  elseif(unit045 or AFE)then
    call IssueImmediateOrder(Hero,"OrderString")
  endif
  call SaveBoolean(hashtable019,(Cache),(208),(false))
  call EnableTrigger(t)
  set Target=null
  set t=null
endfunction

function integer508 takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real unit044=(LoadReal(hashtable019,(Cache),(212)))
  local real reals023=(LoadReal(hashtable019,(Cache),(213)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real AO8=GetUnitX(Hero)+30*Cos(J2E*bj_DEGTORAD)
  local real AP8=GetUnitY(Hero)+30*Sin(J2E*bj_DEGTORAD)
  local real AJE=200
  local real boolean149=(1-unit044/ reals023)*AJE*2
  if boolean149>AJE then
    set boolean149=AJE*2-boolean149
  endif
  if IsBuggyFlying(Hero)==false then
    call SetUnitFlyHeight(Hero,GetUnitDefaultFlyHeight(Hero)+RMaxIF(boolean149,0),0)
  endif
  if IsUnitType(Hero,UNIT_TYPE_HERO)then
    call SaveBoolean(HeroStats,GetHandleId(Hero),99,true)
  endif
  call SetUnitX(Hero,SafeX50(AO8))
  call SetUnitY(Hero,SafeY50(AP8))
  call SetUnitFacing(Hero,J2E)
  call SaveReal(hashtable019,(Cache),(212),((unit044-20)*1.))
  if boolean149<1 and unit044-reals023!=0 then
    call SaveBoolean(hashtable019,(GetHandleId(Hero)),(214),(false))
    call SetUnitFacing(Hero,J2E)
    call SetUnitAnimation(Hero,"stand")
    call SetUnitPathing(Hero,true)
    call A8E(Hero)
    //call A7E(Hero)
    if IsBuggyFlying(Hero)==false then
      call SetUnitFlyHeight(Hero,GetUnitDefaultFlyHeight(Hero),0)
    endif
    call PauseTimer(t)
    call FlushChildHashtable(hashtable019,(Cache))
    call DestroyTimer(t)
  endif
  set t=null
  set Hero=null
endfunction

function Potm_Leap takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Hero,('A0LN'))
  local real YR8=350+50*Level
  local real J2E=GetUnitFacing(Hero)
  local real SourceX=GetUnitX(Hero)
  local real SourceY=GetUnitY(Hero)
  local real TargetX=SafeX50(SourceX+YR8*Cos(J2E*bj_DEGTORAD))
  local real TargetY=SafeY50(SourceY+YR8*Sin(J2E*bj_DEGTORAD))
  local timer t=CreateTimer()
  local integer Cache=GetHandleId(t)
  local trigger ANE=(LoadTriggerHandle(hashtable019,(GetHandleId(Hero)),(204)))
  set YR8=SquareRoot((SourceX-TargetX)*(SourceX-TargetX)+(SourceY-TargetY)*(SourceY-TargetY))
  call ShowUnit(Hero,false)
  call ShowUnit(Hero,true)
  if GetLocalPlayer()==GetOwningPlayer(Hero) then
    call ClearSelection()
    call SelectUnit(Hero,true)
  endif
  if YR8>100 then
    call UnitAddAbility2(Hero,'Amrf')
    call UnitRemoveAbility(Hero,'Amrf')
    call SetUnitPathing(Hero,false)
    //call SetUnitAnimationByIndex(Hero,6)
    call DisableTrigger(ANE)
    call IssueImmediateOrderById(Hero,851972)
    call EnableTrigger(ANE)
    call SaveReal(hashtable019,(Cache),(212),((YR8)*1.))
    call SaveReal(hashtable019,(Cache),(213),((YR8)*1.))
    call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
    call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
    call TimerStart(t,.025,true,function integer508)
    call SaveBoolean(hashtable019,(GetHandleId(Hero)),(214),(true))
    call SaveBoolean(hashtable019,(GetHandleId(Hero)),(208),(false))
    call A7E(Hero)
  endif
  set Hero=null
  set t=null
  set ANE=null
endfunction

function integers067 takes nothing returns boolean
  return OrderId2String(GetIssuedOrderId())!="windwalk"
endfunction

function integer509 takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local integer Cache=GetHandleId(Hero)
  local boolean integer510=(LoadBoolean(hashtable019,(Cache),(214)))
  call SaveInteger(hashtable019,(Cache),(211),(GetIssuedOrderId()))
  call SaveBoolean(hashtable019,(Cache),(207),(false))
  if GetTriggerEventId()==EVENT_UNIT_ISSUED_TARGET_ORDER then
  elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_POINT_ORDER then
    if integer510 or DistanceBetweenXY(GetUnitX(Hero),GetUnitY(Hero),GetOrderPointX(),GetOrderPointY())>800 then
      call SaveStr(hashtable019,(Cache),(206),("Point"))
      call SaveReal(hashtable019,(Cache),(209),((GetOrderPointX())*1.))
      call SaveReal(hashtable019,(Cache),(210),((GetOrderPointY())*1.))
    else
      call SaveBoolean(hashtable019,(Cache),(207),(true))
    endif
  else
    call SaveStr(hashtable019,(Cache),(206),("Instant"))
  endif
  if integer510 then
    call SaveBoolean(hashtable019,(Cache),(208),(true))
  endif
  set Hero=null
endfunction

function integer507 takes nothing returns nothing
  local unit Hero=(LoadUnitHandle(hashtable019,(GetHandleId(GetExpiredTimer())),(14)))
  local integer Cache=GetHandleId(Hero)
  local real x=GetUnitX(Hero)
  local real y=GetUnitY(Hero)
  local string boolean150=(LoadStr(hashtable019,(Cache),(206)))
  if boolean150=="Point"and DistanceBetweenXY(GetUnitX(Hero),GetUnitY(Hero),(LoadReal(hashtable019,(Cache),(209))),(LoadReal(hashtable019,(Cache),(210))))<100 then
    call SaveBoolean(hashtable019,(Cache),(207),(true))
  endif
  set Hero=null
endfunction

function ASE takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local timer t2
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_ISSUED_TARGET_ORDER)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_ISSUED_POINT_ORDER)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_ISSUED_ORDER)
  call TriggerAddAction(t,function integer509)
  call TriggerAddCondition(t,Condition(function integers067))
  call SaveTriggerHandle(hashtable019,(GetHandleId(Hero)),(204),(t))
  set t2=CreateTimer()
  call SaveUnitHandle(hashtable019,(GetHandleId(t2)),(14),(Hero))
  call TimerStart(t2,.3,true,function integer507)
  call SaveTimerHandle(hashtable019,(GetHandleId(Hero)),(205),(t2))
  set Hero=null
  set t=null
  set t2=null
endfunction

function ATE takes nothing returns nothing
  if GetUnitAbilityLevel(GetTriggerUnit(),('A0LN'))==1 then
    call ASE()
  endif
endfunction

function R89 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddAction(t,function ATE)
  set t=null
endfunction

function AVE takes nothing returns boolean
  return(GetUnitAbilityLevel(GetFilterUnit(),'A1RB')==0 and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(TmpUnit376))and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')==0)!=null
endfunction

function AWE takes real PLE,real P1E,real SourceX,real SourceY returns integer
  local real YR8=SquareRoot((SourceX-PLE)*(SourceX-PLE)+(SourceY-P1E)*(SourceY-P1E))
  return IMinIF(R2I(YR8/ 150),10)
endfunction

function DisplayArrowStunTime takes unit u,unit target, integer stun returns nothing
  local texttag tt=CreateTextTag()
  if GetHandleId(tt)<1 then
    call DestroyTextTag(tt)
  else
    call SetTextTagText(tt,R2SW(stun/2,1,1),.03)
    call SetTextTagPosUnit(tt,target,0)
    call SetTextTagColorBJ(tt,150,75,255,15)
    call SetTextTagVelocity(tt,0,.035)
    call SetTextTagFadepoint(tt,3)
    call SetTextTagLifespan(tt,RMinIF(1.5,stun/2))
    call SetTextTagPermanent(tt,false)
    call SetTextTagVisibility(tt,IsUnitAlly(u,GetLocalPlayer()) or IsObserver(GetLocalPlayer()))
  endif
  set tt=null
endfunction

function boolean148 takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real SourceX=GetUnitX(Projectile)
  local real SourceY=GetUnitY(Projectile)
  local real AO8=SafeX50(GetUnitX(Projectile)+30*Cos(J2E))
  local real AP8=SafeY50(GetUnitY(Projectile)+30*Sin(J2E))
  local boolexpr VH9=Condition(function AVE)
  local group HQ9=GetAvailableGroup()
  local unit Caster
  local unit Target
  local real PLE
  local real P1E
  local integer stunlvl
  call SetUnitX(Projectile,AO8)
  call SetUnitY(Projectile,AP8)
  set TmpUnit376=Hero
  call GroupEnumUnitsInRange(HQ9,AO8,AP8,140,VH9)
  set Target=FirstOfGroup(HQ9)
  call KillGroup(HQ9)
  if Target!=null then
    if IsUnitType(Target,UNIT_TYPE_HERO) then
      set FK8[GetPlayerId(GetOwningPlayer(Hero))]=FK8[GetPlayerId(GetOwningPlayer(Hero))]+1
      call Traffic_RegisterData("AA_Hits"+I2S(GetPlayerId(GetOwningPlayer(Hero))),FK8[GetPlayerId(GetOwningPlayer(Hero))])
    endif
    if IsBlocked(Target)==false then
      set PLE=(LoadReal(hashtable019,(Cache),(191)))
      set P1E=(LoadReal(hashtable019,(Cache),(192)))
      set Caster=CreateUnit(GetOwningPlayer(Target),'e00E',SourceX,SourceY,0)
      call UnitAddAbility2(Caster,('A0L7'))
      set stunlvl=AWE(PLE,P1E,SourceX,SourceY)
      call SetUnitAbilityLevel(Caster,('A0L7'),stunlvl)
      if IssueTargetOrderById(Caster,852095,Target)then
      endif
      call DamageTarget(Hero,Target,1,90*GetUnitAbilityLevel(Hero,'A0L8')+stunlvl*10)
      call DisplayArrowStunTime(Hero,Target,stunlvl)
    endif
    call KillUnit(Projectile)
    call CleanTimer(t)
  elseif(AO8-TargetX)*(AO8-TargetX)+(AP8-TargetY)*(AP8-TargetY)<1600 then
    call KillUnit(Projectile)
    call CleanTimer(t)
  endif
  set t=null
  set Hero=null
  set Projectile=null
  set HQ9=null
  set Caster=null
  set Target=null
  set VH9=null
endfunction

function PotM_EluneArrow_Start takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local real SourceX=SafeX50(GetUnitX(Hero))
  local real SourceY=SafeY50(GetUnitY(Hero))
  //local location PKE=GetSpellTargetLoc()
  local real TargetX=GetSpellTargetX()
  local real TargetY=GetSpellTargetY()
  local real J2E=Atan2(TargetY-SourceY,TargetX-SourceX)
  local timer t=CreateTimer()
  local integer Cache=GetHandleId(t)
  local unit Projectile=CreateUnit(GetOwningPlayer(Hero),('h005'),SourceX,SourceY,J2E*bj_RADTODEG)
  set FM8[GetPlayerId(GetOwningPlayer(Hero))]=FM8[GetPlayerId(GetOwningPlayer(Hero))]+1
  call Traffic_RegisterData("AA_Total"+I2S(GetPlayerId(GetOwningPlayer(Hero))),FM8[GetPlayerId(GetOwningPlayer(Hero))])
  //call RemoveLocation(PKE)
  call SetUnitFacing(Projectile,J2E*bj_RADTODEG)
  call SetUnitPathing(Projectile,false)
  set TargetX=SafeX50(SourceX+3000*Cos(J2E))
  set TargetY=SafeY50(SourceY+3000*Sin(J2E))
  call SaveReal(hashtable019,(Cache),(191),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(192),((SourceY)*1.))
  call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
  call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call TimerStart(t,.035,true,function boolean148)
  set Hero=null
  //set PKE=null
  set t=null
  set Projectile=null
endfunction

function AZE takes nothing returns boolean
  local integer units005=FK8[GetPlayerId(GetTriggerPlayer())]
  local integer YO8=FM8[GetPlayerId(GetTriggerPlayer())]
  if isPlayerPickedAbility(GetTriggerPlayer(),158)and YO8>0 then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetObjectName('n0GM')+" "+R2S(I2R(units005)/ I2R(YO8)*100)+"% ("+I2S(units005)+"/"+I2S(YO8)+")")
  endif
  return false
endfunction

function PotM_EluneArrow_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call PreloadAbility(('A0L7'))
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-st",true)
  call TriggerAddCondition(t,Condition(function AZE))
  set t=null
endfunction

function real072 takes nothing returns boolean
  local unit group030=GetFilterUnit()
  if IsUnitInGroup(group030,C2)then
    set group030=null
    return false
  endif
  if IsUnitEnemy(group030,GetOwningPlayer(TmpUnit376))and GetUnitAbilityLevel(group030,'A04R')!=1 and GetUnitState(group030,UNIT_STATE_LIFE)>0 and IsUnitType(group030,UNIT_TYPE_STRUCTURE)==false then
    set group030=null
    return true
  endif
  set group030=null
  return false
endfunction

function A6E takes nothing returns nothing
  call DamageTarget(TmpUnit376,GetEnumUnit(),1,TmpReal378)
endfunction

function ALE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit XX8=(LoadUnitHandle(hashtable019,(Cache),(221)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local integer Y59=(LoadInteger(hashtable019,(Cache),(194)))
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local real NHE=GetUnitX(XX8)
  local real NIE=GetUnitY(XX8)
  local real LastX=(LoadReal(hashtable019,(Cache),(23)))
  local real LastY=(LoadReal(hashtable019,(Cache),(24)))
  local real AO8=LastX+1000*.05*Cos(J2E)
  local real AP8=LastY+1000*.05*Sin(J2E)
  local group HQ9=GetAvailableGroup()
  call SaveReal(hashtable019,(Cache),(23),((AO8)*1.))
  call SaveReal(hashtable019,(Cache),(24),((AP8)*1.))
  set TmpUnit376=XX8
  if GetUnitAbilityLevel(XX8,'A0FN')<1 then
    set TmpReal378=GetUnitAbilityLevel(XX8,'QB02')*75+25
  else
    set TmpReal378=GetUnitAbilityLevel(XX8,'A0FN')*75+25
  endif
  set C2=HND
  call GroupEnumUnitsInRange(HQ9,NHE,NIE,225,Condition(function real072))
  call ForGroup(HQ9,function A6E)
  call GroupAddGroup(HQ9,HND)
  call KillGroup(HQ9)
  set Y59=Y59-1
  call SaveInteger(hashtable019,(Cache),(194),(Y59))
  if IsUnitType(XX8,UNIT_TYPE_HERO)then
    call SaveBoolean(HeroStats,GetHandleId(XX8),99,true)
  endif
  call SetUnitX(XX8,SafeX50(AO8))
  call SetUnitY(XX8,SafeY50(AP8))
  //call PauseUnit(XX8,true)
  //	if Y59>8 then											  ministun is weird :P
  //		call IssueTargetOrder(Caster,"thunderbolt",XX8)
  //	endif
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",NHE,NIE))
  if Y59==0 then
    //call PauseUnit(XX8,false)
    call SetUnitVertexColor(XX8,255,255,255,255)
    call SaveBoolean(hashtable019,(GetHandleId(XX8)),(225),(false))
    call SetUnitInvulnerable(XX8,false)
    call SetUnitPathing(XX8,true)
    call KillGroup(HND)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set XX8=null
  set Caster=null
  set HND=null
  set HQ9=null
  set t=null
  return false
endfunction

function Morphling_Waveform takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local player p = GetOwningPlayer(XX8)
  local real SourceX=GetUnitX(XX8)
  local real SourceY=GetUnitY(XX8)
  local real TargetX=GetSpellTargetX()
  local real TargetY=GetSpellTargetY()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local group HND=GetAvailableGroup()
  local unit Caster=CreateUnit(p,'e00E',0,0,0)
  local integer PlayerId=GetPlayerId(p)
  
  call UnitAddAbility(Caster,'A2N4')
  
  if GetSpellTargetUnit()!=null then
    set TargetX=GetUnitX(GetSpellTargetUnit())
    set TargetY=GetUnitY(GetSpellTargetUnit())
  endif
  call SetUnitVertexColor(XX8,255,255,255,0)
  call SaveBoolean(hashtable019,(GetHandleId(XX8)),(225),(true))
  call SetUnitInvulnerable(XX8,true)
  call SetUnitPathing(XX8,false)
  call SetUnitPathing(Caster,false)
  call SaveUnitHandle(hashtable019,(Cache),(221),(XX8))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveReal(hashtable019,(Cache),(23),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(24),((SourceY)*1.))
  call SaveGroupHandle(hashtable019,(Cache),(133),(HND))
  call SaveReal(hashtable019,(Cache),(13),((Atan2(TargetY-SourceY,TargetX-SourceX))*1.))
  call SaveInteger(hashtable019,(Cache),(194),(IMaxIF(R2I(SquareRoot((TargetX-SourceX)*(TargetX-SourceX)+(TargetY-SourceY)*(TargetY-SourceY))/ 50),1)))
  call TriggerRegisterTimerEvent(t,.04,true)
  call TriggerAddCondition(t,Condition(function ALE))
  call ShowUnit(XX8,false)
  call ShowUnit(XX8,true)
  call SelectUnitAddForPlayer(XX8,GetOwningPlayer(XX8))
  set Caster = null
  set XX8 = null
  set HND = null
  set t=null
endfunction

function A0E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))-1
  local texttag tt
  call SaveInteger(hashtable019,(Cache),(34),(Count))
  if GetTriggerEvalCount(t)==1 then
    call RemoveSavedHandle(hashtable019,Cache,'0ILU')
    //call BJDebugMsg("removing Replicate source info from caster")
  endif
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set tt=CreateTextTag()
    call SetTextTagText(tt,I2S(Count),.03)
    call SetTextTagPosUnit(tt,Source,0)
    call SetTextTagColorBJ(tt,0,29,255,15)
    call SetTextTagVelocity(tt,0,.035)
    call SetTextTagFadepoint(tt,3)
    call SetTextTagLifespan(tt,.9)
    call SetTextTagPermanent(tt,false)
    call SetTextTagVisibility(tt,GetOwningPlayer(Source)==GetLocalPlayer())
    set tt=CreateTextTag()
    call SetTextTagText(tt,I2S(Count),.03)
    call SetTextTagPosUnit(tt,Target,0)
    call SetTextTagColorBJ(tt,0,29,255,15)
    call SetTextTagVelocity(tt,0,.035)
    call SetTextTagFadepoint(tt,3)
    call SetTextTagLifespan(tt,.9)
    call SetTextTagPermanent(tt,false)
    call SetTextTagVisibility(tt,GetOwningPlayer(Source)==GetLocalPlayer())
  endif
  set t=null
  set tt=null
  set Source=null
  set Target=null
  return false
endfunction

function integers068 takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local unit Hero=(LoadUnitHandle(hashtable019,(GetHandleId(t)),(14)))
  local unit integer511=(LoadUnitHandle(hashtable019,(GetHandleId(Hero)),(229)))
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",GetUnitX(integer511),GetUnitY(integer511)))
  call RemoveUnit(integer511)
  call UnitRemoveAbility(Hero,('A0GC'))
  if(LoadInteger(hashtable019,(GetHandleId(Hero)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Hero)),(704)))==('A0G8')then
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),('A0G8'),true)
  endif
  call FlushChildHashtable(hashtable019,(GetHandleId(t)))
  call CleanTrigger((t))
  set Hero=null
  set integer511=null
  set t=null
endfunction

function Morphling_ReplicateReplace takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local integer Cache=GetHandleId(Hero)
  local unit integer511=(LoadUnitHandle(hashtable019,(Cache),(229)))
  local real x=GetUnitX(integer511)
  local real y=GetUnitY(integer511)
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",GetUnitX(Hero),GetUnitY(Hero)))
  call KillUnit(integer511)
  call SetUnitX(Hero,x)
  call SetUnitY(Hero,y)
  call PanCameraToTimedForPlayer(GetOwningPlayer(Hero),x,y,0)
  call IssueImmediateOrderById(Hero,851972)
  set Hero=null
  set integer511=null
endfunction

function B8E takes nothing returns boolean
  return GetUnitAbilityLevel(GetSummonedUnit(),('B030'))>0 and GetUnitState(GetSummonedUnit(),UNIT_STATE_LIFE)>0
endfunction

function B9E takes nothing returns nothing
  local unit Hero=GetSummoningUnit()
  local integer Cache=GetHandleId(Hero)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(228)))
  local unit integer511=GetSummonedUnit()
  local trigger t
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),('A0G8'),false)
  call UnitAddAbility2(Hero,('A0GC'))
  call SetUnitColor(integer511,GetPlayerColor(GetOwningPlayer(Target)))
  call SaveUnitHandle(hashtable019,(Cache),(229),(integer511))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,integer511,EVENT_UNIT_DEATH)
  call TriggerAddAction(t,function integers068)
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(Hero))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,integer511,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function A0E))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Hero))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(17),(integer511))
  call SaveInteger(hashtable019,(GetHandleId(t)),(34),(GetUnitAbilityLevel(Hero,('A0G8'))*15+15-1))
  set Hero=null
  set Target=null
  set integer511=null
  set t=null
endfunction

function Morphling_Replicate takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  call SaveUnitHandle(hashtable019,(GetHandleId(Hero)),(228),(Target))
  if IsUnitIllusion(Target) then
    call SaveUnitHandle(hashtable019,GetHandleId(Hero),'0ILU',LoadUnitHandle(hashtable019,GetHandleId(Target),'0ILU')) //Replicate source info (illu)
  else
    call SaveUnitHandle(hashtable019,GetHandleId(Hero),'0ILU',Target) //Replicate source info (real)
  endif
  set Hero=null
  set Target=null
endfunction

function Morphling_Replicate_OnCast takes nothing returns nothing
  if GetOwningPlayer(GetSpellTargetUnit())==GetOwningPlayer(GetTriggerUnit())then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n0LF'))
  endif
endfunction

function Func1102 takes nothing returns nothing
  local trigger t
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function B8E))
  call TriggerAddAction(t,function B9E)
  set t=null
endfunction

function BGE takes unit Hero,integer BHE,real rate returns nothing
  local integer BJE=GetHeroAgi(Hero,false)
  local integer BKE=GetHeroStr(Hero,false)
  local real IVD=GetUnitState(Hero,UNIT_STATE_MANA)
  if BHE==0 then
    if IVD>=rate and BJE>2 and IsDead(Hero)==false and GetHeroAgi(Hero,false)>MORPH_MIN_STATS then
      call SetUnitState(Hero,UNIT_STATE_MANA,IVD-rate)
      call SetHeroAgi(Hero,BJE-2,true)
      call SetHeroStr(Hero,BKE+2,true)
    endif
  elseif BHE==1 then
    if IVD>=rate and BKE>2 and IsDead(Hero)==false and GetHeroStr(Hero,false)>MORPH_MIN_STATS then
      call SetUnitState(Hero,UNIT_STATE_MANA,IVD-rate)
      call SetHeroAgi(Hero,BJE+2,true)
      call SetHeroStr(Hero,BKE-2,true)
    endif
  endif
endfunction

function BME takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Level=GetUnitAbilityLevel(Hero,'A0KX')
  call BGE(Hero,1,30./ Level)
  set t=null
  set Hero=null
  return false
endfunction

function BNE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Level=GetUnitAbilityLevel(Hero,'A0KX')
  call BGE(Hero,0,30./ Level)
  set t=null
  set Hero=null
  return false
endfunction

function BOE takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local trigger BPE=(LoadTriggerHandle(hashtable019,(Cache),(226)))
  local integer Level=GetUnitAbilityLevel(Hero,'A0KX')
  local integer somefuckingvar=(LoadInteger(hashtable019,(Cache),(227)))
  local real BQE=1./Level
  if BQE==.25 then
    set BQE=.2
  endif
  if GetIssuedOrderId()==852549 then
    if BPE!=null then
      call FlushChildHashtable(hashtable019,(GetHandleId(BPE)))
      call CleanTrigger(BPE)
    endif
    set BPE=CreateTrigger()
    call TriggerRegisterTimerEvent(BPE,BQE,true)
    call TriggerAddCondition(BPE,Condition(function BME))
    call SaveUnitHandle(hashtable019,(GetHandleId(BPE)),(14),(Hero))
    call SaveTriggerHandle(hashtable019,(Cache),(226),(BPE))
    call SaveInteger(hashtable019,(Cache),(227),(GetIssuedOrderId()))
    call UnitAddAbility(Hero,'A22L')
    call UnitRemoveAbility(Hero,'A22T')
  elseif GetIssuedOrderId()==852546 then
    if BPE!=null then
      call FlushChildHashtable(hashtable019,(GetHandleId(BPE)))
      call CleanTrigger(BPE)
    endif
    set BPE=CreateTrigger()
    call TriggerRegisterTimerEvent(BPE,BQE,true)
    call TriggerAddCondition(BPE,Condition(function BNE))
    call SaveUnitHandle(hashtable019,(GetHandleId(BPE)),(14),(Hero))
    call SaveTriggerHandle(hashtable019,(Cache),(226),(BPE))
    call SaveInteger(hashtable019,(Cache),(227),(GetIssuedOrderId()))
    call UnitAddAbility(Hero,'A22T')
    call UnitRemoveAbility(Hero,'A22L')
  elseif GetIssuedOrderId()==852550 then
    if BPE!=null then
      call FlushChildHashtable(hashtable019,(GetHandleId(BPE)))
      call CleanTrigger(BPE)
    endif
    call SaveTriggerHandle(hashtable019,(Cache),(226),(null))
    call SaveInteger(hashtable019,(Cache),(227),(GetIssuedOrderId()))
    call UnitRemoveAbility(Hero,'A22L')
    call UnitRemoveAbility(Hero,'A22T')
  elseif GetIssuedOrderId()==852547 then
    if BPE!=null then
      call FlushChildHashtable(hashtable019,(GetHandleId(BPE)))
      call CleanTrigger(BPE)
    endif
    call SaveTriggerHandle(hashtable019,(Cache),(226),(null))
    call SaveInteger(hashtable019,(Cache),(227),(GetIssuedOrderId()))
    call UnitRemoveAbility(Hero,'A22L')
    call UnitRemoveAbility(Hero,'A22T')
  elseif GetIssuedOrderId()==852548 and somefuckingvar!=852546 and somefuckingvar!=852546 then
    call BGE(Hero,1,30./ Level)
  elseif GetIssuedOrderId()==852545 and somefuckingvar!=852546 and somefuckingvar!=852546 then
    call BGE(Hero,0,30./ Level)
  endif
  set t=null
  set Hero=null
  set BPE=null
  return false
endfunction

function Morphling_Morph_Learn takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t
  local integer Cache
  local integer Level=GetUnitAbilityLevel(Hero,'A0KX')
  if Level==1 then
    call SetHeroAgi(Hero,GetHeroAgi(Hero,false)+3,true)
    call SetHeroStr(Hero,GetHeroStr(Hero,false)+3,true)
  else
    call SetHeroAgi(Hero,GetHeroAgi(Hero,false)+1,true)
    call SetHeroStr(Hero,GetHeroStr(Hero,false)+1,true)
  endif
  if Level==1 then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call UnitAddAbility2(Hero,'A0KW')
    call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_ISSUED_ORDER)
    call TriggerAddCondition(t,Condition(function BOE))
    call SaveTriggerHandle(hashtable019,(Cache),(226),(null))
    set t=null
  else
    call SetUnitAbilityLevel(Hero,'A0KW',Level)
  endif
  set Hero=null
  set t=null
endfunction

function BSE takes nothing returns boolean
  if GetLearnedSkill()=='A0KX' and IsUnitIllusion(GetTriggerUnit())==false then
    call Morphling_Morph_Learn()
  endif
  return false
endfunction

function MF9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function BSE))
  set t=null
endfunction

function BTE takes nothing returns nothing
  local unit XX8=(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(326)))
  local real r
  local real g
  local real b
  local integer BUE
  local integer BVE
  local real BWE
  local real BXE
  if GetUnitTypeId(XX8)!='O00P' then
    call DisableTrigger(GetTriggeringTrigger())
  elseif IsDead(XX8)==false and(LoadBoolean(hashtable019,(GetHandleId(XX8)),(225)))==false then
    set BUE=GetHeroAgi(XX8,true)
    set BVE=GetHeroStr(XX8,true)
    set BWE=RMaxBJ(75+2*(BUE-BVE),35)
    set r=BWE
    set g=BWE
    set b=BWE
    call SetUnitVertexColorBJ(XX8,r,g,b,GetRandomReal(.0,10.))
  endif
  set XX8=null
endfunction

function BYE takes nothing returns boolean
  return b_isPickTime==false and GetUnitTypeId(GetTriggerUnit())=='O00P' and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function BZE takes nothing returns nothing
  local trigger t
  if((LoadBoolean(hashtable019,(GetHandleId(GetTriggerUnit())),(327)))==false)then
    set t=CreateTrigger()
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(326),(GetTriggerUnit()))
    call SaveTriggerHandle(hashtable019,(GetHandleId(GetTriggerUnit())),(328),(t))
    call TriggerAddAction(t,function BTE)
    call TriggerRegisterTimerEvent(t,1.,true)
    call SaveBoolean(hashtable019,(GetHandleId(GetTriggerUnit())),(327),(true))
    set t=null
  endif
endfunction

function MD9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterEnterRectSimple(t,bj_mapInitialPlayableArea)
  call TriggerAddCondition(t,Condition(function BYE))
  call TriggerAddAction(t,function BZE)
  set t=null
endfunction

function BBE takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(u,'A0G6')
  local integer mainstat
  local integer statvalue
  local real dmg
  local unit d
  local integer stunlvl
  local real angle
  if GetUnitAbilityLevel(u,'A04R')>0 then
    set u=udg_Hero[GetPlayerId(GetOwningPlayer(u))]
  endif
  set mainstat=GetUnitPrimaryAttribute(u)
  if mainstat==1 then
    set statvalue=GetHeroInt(u,true)
  elseif mainstat==2 then
    set statvalue=GetHeroAgi(u,true)
  elseif mainstat==3 then
    set statvalue=GetHeroStr(u,true)
  endif
  set dmg=statvalue*(1+0.25*Level)+40+20*Level
  //set angle=Atan2(GetUnitY(Target)-GetUnitY(u),GetUnitX(Target)-GetUnitX(u))
  //call SetUnitPosition(Target,GetUnitX(Target)+250*Cos(angle),GetUnitY(Target)+250*Sin(angle))
  //call KillTrees(GetUnitX(Target),GetUnitY(Target),200)
  set d=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility(d,'A33K')
  call SetUnitAbilityLevel(d,'A33K',Level)
  call IssueTargetOrder(d,"thunderbolt",Target)
  set d=null
  call TextTagOnUnit("|c001ce6b9+"+I2S(R2I(dmg))+"|r",1,Target,.023,255,255,255,216)
  call DamageTarget(u,Target,1,dmg)
  set u=null
  set Target=null
  set u=null
endfunction

function Morphling_AdaptiveStrike takes nothing returns nothing
  if GetUnitTypeId(GetSpellTargetUnit())!='n00L' and IsBlocked(GetSpellTargetUnit())==false then
    call BBE()
  endif
endfunction

function Func1105 takes nothing returns nothing
  call PreloadAbility('A0X6')
endfunction

function B5E takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),FQ8)==false then
    call GroupAddUnit(FR8,GetEnumUnit())
    call UnitRemoveAbility(GetEnumUnit(),'B02J')
    call UnitRemoveAbility(GetEnumUnit(),'BUsp')
    call UnitRemoveAbility(GetEnumUnit(),'Bust')
  endif
endfunction

function B2E takes nothing returns nothing
  call UnitRemoveAbility(GetEnumUnit(),'B02J')
  call UnitRemoveAbility(GetEnumUnit(),'BUsp')
  call UnitRemoveAbility(GetEnumUnit(),'Bust')
endfunction

function C4E takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),FP8)==false then
    call GroupAddUnit(FP8,GetEnumUnit())
    call SetUnitOwner(FO8,GetOwningPlayer(GetEnumUnit()),false)
    call IssueTargetOrderById(FO8,852227,GetEnumUnit())
  endif
endfunction

function C7E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local group g
  local group AlreadyHit=(LoadGroupHandle(hashtable019,(Cache),(187)))
  if GetTriggerEvalCount(t)==10 then
    call UnitAddAbility2(Source,'A24E')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A07U',false)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A24E',true)
  endif
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)>140 or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A24E')then
    if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A07U' then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A07U',true)
    endif
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A24E',false)
    call ForGroup(AlreadyHit,function B2E)
    call KillGroup(AlreadyHit)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set g=GetAvailableGroup()
    set tt_unit1=Source
    set FN8=Source
    set FO8=Caster
    set FP8=AlreadyHit
    call GroupEnumUnitsInRange(g,x,y,1250+25,Condition(function Func1637))
    call ForGroup(g,function C4E)
    set FQ8=g
    set FR8=GetAvailableGroup()
    call ForGroup(AlreadyHit,function B5E)
    call GroupRemoveGroup(FR8,AlreadyHit)
    call KillGroup(g)
    call KillGroup(FR8)
  endif
  set t=null
  set g=null
  set Source=null
  set AlreadyHit=null
  set Caster=null
  return false
endfunction

function Naga_SongOfSiren takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  call UnitAddAbility(Caster,'A07T')
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function C7E))
  call SaveGroupHandle(hashtable019,(Cache),(187),(GetAvailableGroup()))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\SongOfTheSiren_2.mdx",Source,"origin")))
  set t=null
  set Source=null
  set Caster=null
endfunction

function CDE takes unit Source, unit Target returns nothing
  local integer Level=GetUnitAbilityLevel(Source,'A2KU')
  local integer id='A244'
  call DamageTarget(Source,Target,1,100+30*Level)
  if Level==2 then
    set id='A245'
  elseif Level==3 then
    set id='A246'
  elseif Level==4 then
    set id='A247'
  endif
  if IsUnitBADWithSpellbooks(Target)==false then
    call AddTimedAbility(Target,id,1,8)
  endif
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),id,false)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl",Target,"chest"))
endfunction

function QJ2 takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),RipTideAlreadyHit)==false then
    call GroupAddUnit(RipTideAlreadyHit,GetEnumUnit())
    call CDE(RipTideSource,GetEnumUnit())
  endif
endfunction

function real066 takes nothing returns nothing
  local unit Source=GetEnumUnit()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local group g=GetAvailableGroup()
  call DestroyEffect(AddSpecialEffect("war3mapImported\\RipTide09.mdx",x,y))
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x,y,350+25,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function QJ2)
  call KillGroup(g)
  set g=null
  set Source=null
endfunction

function QL2 takes nothing returns boolean
  return IsUnitIllusion(GetFilterUnit())and IsDead(GetFilterUnit())==false
endfunction

function Naga_RipTide takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local group g=GetAvailableGroup()
  set RipTideAlreadyHit=GetAvailableGroup()
  set RipTideSource=Source
  call GroupEnumUnitsOfPlayer(g,GetOwningPlayer(Source),Condition(function QL2))
  call GroupAddUnit(g,Source)
  call ForGroup(g,function real066)
  call KillGroup(g)
  call KillGroup(RipTideAlreadyHit)
  set Source=null
  set g=null
endfunction

function Netherblast_Filter takes nothing returns boolean
  return IsUnitEnemy(Netherblast_Source,GetOwningPlayer(GetFilterUnit())) and IsDead(GetFilterUnit())==false and (GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 or IsSiegeUnit(GetFilterUnit())) and IsUnitInRangeXY(GetFilterUnit(),Netherblast_x,Netherblast_y,400)
endfunction

function Netherblast_Damage takes nothing returns nothing
  local unit u = GetEnumUnit()
  local real Damage = 25 + 75*Netherblast_Level
  if IsUnitType(u,UNIT_TYPE_STRUCTURE)==true then
    call DamageTarget(Netherblast_Source,u,1,Damage*.5)
  else
    call DamageTarget(Netherblast_Source,u,1,Damage)
  endif
  set u = null
endfunction

function Netherblast_Effect takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer Cache = GetHandleId(t)
  local unit Source = LoadUnitHandle(hashtable019,Cache,2)
  local real x = LoadReal(hashtable019,Cache,6)
  local real y = LoadReal(hashtable019,Cache,7)
  local group g = GetAvailableGroup()
  set Netherblast_Source = Source
  set Netherblast_x = x
  set Netherblast_y = y
  set Netherblast_Level = GetUnitAbilityLevel(Source,'A0MT')
  call GroupEnumUnitsInRange(g,x,y,425,Condition(function Netherblast_Filter))
  call ForGroup(g,function Netherblast_Damage)
  call KillGroup(g)
  call PauseTimer(t)
  call DestroyTimer(t)
  call FlushChildHashtable(hashtable019,Cache)
  set g = null
  set Source = null
  set t=null
endfunction

function Netherblast_Start takes nothing returns nothing
  local unit Source = GetTriggerUnit()
  local real x = GetSpellTargetX()
  local real y = GetSpellTargetY()
  local unit Caster 
  local timer t
  local integer Cache
  if GetUnitTypeId(Source)!='e00E' then
    set t=CreateTimer()
    set Cache=GetHandleId(t)
    set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
    call UnitAddAbility(Caster,'AHbz') //dummy ability to provide the visual
    call IssuePointOrder(Caster,"blizzard",x,y)
    call SaveUnitHandle(hashtable019,Cache,2,Source)
    call SaveReal(hashtable019,Cache,6,x)
    call SaveReal(hashtable019,Cache,7,y)
    call TimerStart(t,0.9,false,function Netherblast_Effect)
  endif
  set Caster = null
  set Source = null
  set t = null
endfunction

function unit043 takes unit Source,unit Target,integer Level returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
  call UnitAddAbility(Caster,'A0BA')
  call SetUnitAbilityLevel(Caster,'A0BA',Level)
  call IssueTargetOrderById(Caster,852106,Target)
  set Caster=null
endfunction

function integer503 takes nothing returns boolean
  if IsUnitIllusion(GetFilterUnit()) and GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(GetTriggerUnit())then
    call unit043(GetFilterUnit(),FT8,GetUnitAbilityLevel(GetTriggerUnit(),'A24D'))
  endif
  return false
endfunction

function CJE takes nothing returns boolean
  if IsUnitIllusion(GetFilterUnit()) and GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(GetTriggerUnit())then
    call SetUnitFacing(GetFilterUnit(),tt_real1)
    call SetUnitAnimation(GetFilterUnit(),"spell")
  endif
  return false
endfunction

function Naga_Ensnare_OnCast takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local group g=GetAvailableGroup()
  set tt_real1=AngleBetweenXY(GetUnitX(Hero),GetUnitY(Hero),GetUnitX(FT8),GetUnitY(FT8))
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),700,Condition(function CJE))
  call KillGroup(g)
  set Hero=null
  set g=null
endfunction

function group027 takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=FT8
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),700,Condition(function integer503))
  call KillGroup(g)
  set Hero=null
  set Target=null
  set g=null
endfunction

function Naga_Ensnare takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    set FS8=0
    set FT8=GetSpellTargetUnit()
    call unit043(GetTriggerUnit(),FT8,GetUnitAbilityLevel(GetTriggerUnit(),'A24D'))
    call group027()
  endif
  
endfunction
function UnrefinedFireblast takes nothing returns nothing
  call SetUnitState(GetTriggerUnit(),UNIT_STATE_MANA,GetUnitState(GetTriggerUnit(),UNIT_STATE_MANA)*0.4)
endfunction

function AghaFireblast_Cast takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,'A2KR')
  call IssueTargetOrder(Caster,"thunderbolt",Target)
  set Source=null
  set Target=null
  set Caster=null
endfunction

function AghaFireblast_Add takes nothing returns nothing
  local unit Source=tt_unit1
  call UnitAddAbility2(Source,'A2KQ')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2KQ',true)
  set Source=null
endfunction

function AghaFireblast_Remove takes nothing returns nothing
  local unit Source=tt_unit1
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2KQ',false)
  set Source=null
endfunction

function group029 takes integer PlayerId,integer aid returns boolean
  
  //multicast addition restrictions...
  
  local integer index
  if aid!=0 then
    if isItemSpellOrNoCd(aid)or isPoisonArrowSkill(aid) or IsInvokersOrbs(aid) then
      return false
    endif
  endif
  if aid=='A1MG' or aid=='A19O' then//Cold Feet, Fire Lasso
    return false
  elseif aid=='A0DL' or aid=='A1WH' or aid=='A0WP' then//Enchant totem, God strength & old god strength
    return false
  elseif aid=='A0MQ' or aid=='A1B6' then  //primal split & upg
    return false
  elseif aid=='A1TA' or aid=='A1T8' or aid=='A28Q' or aid=='A1TB' then//all wisp's spells
    return false
  elseif aid=='QB0K' or aid=='ANcr' or aid=='A0Z4' or aid=='A0Z5' or aid=='A1NI' then//Chemical rage & balanced; clockwerk's ministun & cogs, unstable concoction
    return false
  elseif aid=='QM00' or aid=='A1YY' then//dk's dragon form, sun ray
    return false
  elseif aid=='A1RK' or aid=='A1S7' or aid=='A1YQ' then//supernova, snowball, walrus punch
    return false
  elseif aid=='A2JR' or aid=='A2JL' or aid=='A2JO' or aid=='A2JQ' or aid=='A2JP' or aid=='A2E5' or aid=='QB08' or aid=='AEbl' then//Fire remnants, Chakram, am's blink & balanced
    return false
  elseif aid=='A04P' or aid=='A05G' or aid=='A0M1' or aid=='A1AX' then//Assassinate, jugger's spin, omnislash&upg
    return false
  elseif aid=='A0A5' or aid=='A1EG' or aid=='A0AG' then//Spirit bear, Rabid, True Form
    return false
  elseif aid=='A0KX' or aid=='A0G8' or aid=='A0KW' or aid=='A063' then//Morph agi/str, Replicate, Naga's illusions
    return false
  elseif aid=='A07U' or aid=='QB0B' or aid=='A0D7' or aid=='A0LN' then//Song of the siren, Doppelwalk & balanced, leap
    return false
  elseif aid=='A0KU' or aid=='A0BE' or aid=='A1EJ' then//Moonlight shadows, Berserker rage, Troll's ulti
    return false
  elseif aid=='A229' or aid=='QB03' or aid=='A1EA' then//flak cannon, Refraction & balanced
    return false
  elseif aid=='A0RV' or aid=='QB0P' or aid=='A1N4' or aid=='A0LC' then//Meld, Overpower + balanced, Enrage
    return false
  elseif aid=='A0IN' or aid=='A1AW' or aid=='QB09' or aid=='A07A' or aid=='QB0L' or aid=='A2H0' then//Nether swap + agh, bounty's windwalk + balanced, sleight of fist + balanced
    return false
  elseif aid=='A2HS' or aid=='A01B' then//Flame guard, Natures attendants
    return false
  elseif aid=='A0SB' or aid=='A28T' then//Phase shift, Holy Persuasion
    return false
  elseif aid=='QM01' or aid=='A01O' then//Ghost form, furion's tp, Force of nature
    return false
  elseif aid=='A14O' or aid=='A085' then//Ball lightning, Illuminate
    return false
  elseif aid=='A14I' or aid=='A12P' or aid=='A1D6' or aid=='A1SW' then//Windrun, Focus fire + upg, Glimpse
    return false
  elseif aid=='A06B' or aid=='A065' or aid=='A00P' then//Suicide, Rearm, Mana drain
    return false
  elseif aid=='A27F' or aid=='A27H' or aid=='A30J' or aid=='A0I6' then//Telekinesis, Spell steal + upg, Berserker call
    return false
  elseif aid=='A0RW' or aid=='A03O' or aid=='A10R' then//Reality Rift, Phantasm, Devour
    return false
  elseif aid=='A1OP' or aid=='A0SS' or aid=='QP1W' or aid=='A194' or aid=='A0SW' then//Scotcher Earth, Rage, Open Wounds, infest
    return false
  elseif aid=='A0NS' or aid=='A1DA' or aid=='QM02' then//Borrowed time, Lycan's ulti
    return false
  elseif aid=='A0R0' or aid=='A06K' or aid=='A0FL' or aid=='A1CX' then//Dark rift, Rot, Dismember & upg
    return false
  elseif aid=='DRKN' or aid=='A05C' or aid=='QM03' then//Darkness, Sprint, Flesh Golem
    return false
  elseif aid=='A1RD' or aid=='A1P8' or aid=='A0H0' then//Skewer, Charge of darkness, Sandstorm
    return false
  elseif aid=='A030' or aid=='QB0A' or aid=='A025' or aid=='A04Q' then//Full Clinkz
    return false
  elseif aid=='Z234' or aid=='A0WQ' then//Spin web, Brood's Hunger
    return false
  elseif aid=='A09U' or aid=='A2KO' or aid=='QB01' or aid=='A0CA' or aid=='A0CT' then//Spiked Carapase, Vendetta, Schukuchi & balanced, time lapse
    return false
  elseif aid=='A0PL' then//Blink strike PA, Conjure image
    return false
  elseif aid=='A1RI' or aid=='A07Q' or aid=='A0H9' then//Metamorphosis, Sunder, Haunt
    return false
  elseif aid=='A1HR' or aid=='QP1F' or aid=='A1IN' or aid=='A0LK' then//Slark's passive??, Shadow dance, Timewalk
    return false
  elseif aid=='A1C0' or aid=='A0MP' or aid=='A04Y' then//Splitshot, Spell shield, Nightmare
    return false
  elseif aid=='A04N' or aid=='A02N' or aid=='A180' then//exorcism, Mana drain, Demonic conversion
    return false
  elseif aid=='A0CC' or aid=='A02Z' or aid=='A0OJ' then//Life steal, Astral Imprisonment
    return false
  elseif aid=='QB07' or aid=='A0ME' or aid=='A1S8' or aid=='Z605' then//Akasha blink & balanced, Disruption, Ghost walk
    return false
  endif
  
  set index=SK8(PlayerId,aid)
  
  //call BJDebugMsg("Spell id: "+I2S(index))
  
  if index!=0 then
    if RA8(StackingLimitations[index],"metamorphosis","0")then
      return false
    elseif RA8(StackingLimitations[index],"arrows","0")then
      return false
    endif
  endif
  return true
endfunction

function integer504 takes unit whichUnit returns integer
  local real r
  local integer Level=IMaxIF(GetUnitAbilityLevel(whichUnit,'A088'),GetUnitAbilityLevel(whichUnit,'QP24'))
  local boolean RIE=FindItemOfType(whichUnit,Item_Real[indexid_AghanimOgre])!=null
  local integer integer505=0
  local integer id=GetPlayerId(GetOwningPlayer(whichUnit))
  set RIE=false
  // if not(Mode_BO)then
  // set r=GetRandomReal(0,Balanced_MulticastHigherValue)
  // else
  set r=GetRandomReal(0,100)
  //set r=1//test
  // endif
  if not(group029(id,GetSpellAbilityId()))then
    return 0
  endif
  if Level==1 then
    set FY8[id]=FY8[id]+1
    if RIE then
      if PRD_Get(whichUnit,'A088'+1,30) then
        set FV8[id]=FV8[id]+1
        set integer505=3
      elseif PRD_Get(whichUnit,'A088',60) then
        set FU8[id]=FU8[id]+1
        set integer505=2
      endif
    else
      if Mode_BO then
        if PRD_Get(whichUnit,'A088',25) then
          set integer505=2
          set FU8[id]=FU8[id]+1
        endif
      else
        if PRD_Get(whichUnit,'A088',18) then
          set integer505=2
          set FU8[id]=FU8[id]+1
        endif
      endif
    endif
  elseif Level==2 then
    set FY8[id]=FY8[id]+1
    if RIE then
      if PRD_Get(whichUnit,'A088'+2,17.5) then
        set integer505=4
        set FW8[id]=FW8[id]+1
      elseif PRD_Get(whichUnit,'A088'+1,35) then
        set integer505=3
        set FV8[id]=FV8[id]+1
      elseif PRD_Get(whichUnit,'A088',70) then
        set integer505=2
        set FU8[id]=FU8[id]+1
      endif
    else
      if Mode_BO then
        if PRD_Get(whichUnit,'A088'+1,20) then
          set integer505=3
          set FV8[id]=FV8[id]+1
        elseif PRD_Get(whichUnit,'A088',40) then
          set integer505=2
          set FU8[id]=FU8[id]+1
        endif
      else
        if PRD_Get(whichUnit,'A088'+1,13) then
          set integer505=3
          set FV8[id]=FV8[id]+1
        elseif PRD_Get(whichUnit,'A088',29.5) then
          set integer505=2
          set FU8[id]=FU8[id]+1
        endif
      endif
    endif
  elseif Level==3 then
    set FY8[id]=FY8[id]+1
    if RIE then
      if PRD_Get(whichUnit,'A088'+3,10) then
        set integer505=5
        set FX8[id]=FX8[id]+1
      elseif PRD_Get(whichUnit,'A088'+2,20) then
        set integer505=4
        set FW8[id]=FW8[id]+1
      elseif PRD_Get(whichUnit,'A088'+1,40) then
        set integer505=3
        set FV8[id]=FV8[id]+1
      elseif PRD_Get(whichUnit,'A088',80) then
        set integer505=2
        set FU8[id]=FU8[id]+1
      endif
    else
      if Mode_BO then
        if PRD_Get(whichUnit,'A088'+2,12.5) then
          set integer505=4
          set FW8[id]=FW8[id]+1
        elseif PRD_Get(whichUnit,'A088'+1,25) then
          set integer505=3
          set FV8[id]=FV8[id]+1
        elseif PRD_Get(whichUnit,'A088',50) then
          set integer505=2
          set FU8[id]=FU8[id]+1
        endif
      else
        if PRD_Get(whichUnit,'A088'+2,5.5) then
          set integer505=4
          set FW8[id]=FW8[id]+1
        elseif PRD_Get(whichUnit,'A088'+1,14.5) then
          set integer505=3
          set FV8[id]=FV8[id]+1
        elseif PRD_Get(whichUnit,'A088',39.5) then
          set integer505=2
          set FU8[id]=FU8[id]+1
        endif
      endif
    endif
  endif
  return integer505
endfunction

function MulticastChannelingsStopper takes nothing returns boolean//[lich]
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  call IssueImmediateOrder(u,"stop")
  call DisableTrigger(t)
  call CleanTrigger(t)
  call FlushChildHashtable(hashtable019,h) 
  set u=null
  set t=null
  return false
endfunction

function Ignite_PossibleTarget takes nothing returns boolean
  return(IsUnitEnemy(TEMPUNIT,GetOwningPlayer(GetFilterUnit()))and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false and IsMagicImmune(GetFilterUnit())==false and GetUnitAbilityLevel(GetFilterUnit(),'B03J')==0 and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(TEMPUNIT)))!=null
endfunction

function rect022 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local player p = GetOwningPlayer(Source)
  local integer CSE=(LoadInteger(hashtable019,(Cache),(300)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer CTE=(LoadInteger(hashtable019,(Cache),(299)))
  local integer real065=(LoadInteger(hashtable019,(Cache),'0ORD'))
  local integer CVE=(LoadInteger(hashtable019,(Cache),'ORDT'))
  local unit Caster
  local unit CWE
  local real ux
  local real uy
  local real tx
  local real ty
  local real d
  local real a
  local boolean b
  local boolean disabled
  local trigger tt
  local integer h
  local real delay
  local group g
  if GetTriggerEvalCount(t)>CSE then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set Caster = CreateUnit(p,'e00E',GetWidgetX(Source),GetWidgetY(Source),0)
    
    
    call SaveUnitHandle(MHT,GetHandleId(Caster),0,LoadUnitHandle(hashtable019,Cache,2))
    call TriggerRegisterUnitEvent(GAME_TRIGGER,Caster,EVENT_UNIT_SPELL_EFFECT)
    
    
    call RemoveSavedHandle(MHT,GetHandleId(Caster),0)
    
    if HaveSavedInteger(MHT,CTE,0)then
      set CTE = LoadInteger(MHT,CTE,0)
    endif
    
    call UnitAddAbility2(Caster,CTE)
    call SetUnitAbilityLevel(Caster,CTE,Level)
    
    set disabled = LoadBoolean(MHT,GetHandleId(p),CTE)
    
    if disabled then
      call SetPlayerAbilityAvailable(p,CTE,true)
    endif
    
    if CVE==1 then
      set CWE=LoadUnitHandle(hashtable019,(Cache),(17))
      if CTE!='A011' then
        
        set ux=GetUnitX(CWE)
        set uy=GetUnitY(CWE)
        set tx=GetUnitX(Source)
        set ty=GetUnitY(Source)
        set d=LoadReal(hashtable019,(Cache),'000D')
        set a=Atan2(ty-uy,tx-ux)
        
        call UnitShareVision(CWE,p,true)
        
        loop
          exitwhen IssueTargetOrderById(Caster,real065,CWE) or d<0
          call SetUnitX(Caster,ux+(d*Cos(a)))
          call SetUnitY(Caster,uy+(d*Sin(a)))
          set d=d-10
        endloop
        if CTE=='A2QT' then//[lich]
          set delay=RMinIF((TimerGetElapsed(GlobalTimer))-(LoadReal(hashtable019,(GetHandleId(Source)),(358)))-(0.3*GetTriggerEvalCount(t)),3)
          set tt=CreateTrigger()
          call TriggerRegisterTimerEvent(tt,delay,false)
          call TriggerAddCondition(tt,Condition(function MulticastChannelingsStopper))
          call SaveUnitHandle(hashtable019,GetHandleId(tt),0,Caster)
          set tt=null
        endif
        call UnitShareVision(CWE,p,false)
      else// if Ignite
        set g=GetAvailableGroup()
        set TEMPUNIT=Source
        call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1400,Condition(function Ignite_PossibleTarget))
        call GroupRemoveUnit(g,CWE)
        if FirstOfGroup(g)!=null then
          set CWE=GroupPickRandomUnit(g)
        endif
        call IssueTargetOrderById(Caster,real065,CWE)
        call KillGroup(g)
        set g=null
      endif
    elseif CVE==2 then
      set CWE=LoadUnitHandle(hashtable019,(Cache),(17))
      set ux=LoadReal(hashtable019,(Cache),'0LOX')
      set uy=LoadReal(hashtable019,(Cache),'0LOY')
      set tx=GetUnitX(Source)
      set ty=GetUnitY(Source)
      set d=LoadReal(hashtable019,(Cache),'000D')
      set a=Atan2(ty-uy,tx-ux)
      
      loop
        exitwhen IssuePointOrderById(Caster,real065,ux,uy) or d<0
        
        call SetUnitX(Caster,ux+(d*Cos(a)))
        call SetUnitY(Caster,uy+(d*Sin(a)))
        
        set d = d-10
      endloop
      if CTE=='A12K' then//[lich]
        set delay=RMinIF((TimerGetElapsed(GlobalTimer))-(LoadReal(hashtable019,(GetHandleId(Source)),(358)))-(0.3*GetTriggerEvalCount(t)),1.05)
        set tt=CreateTrigger()
        call TriggerRegisterTimerEvent(tt,delay,false)
        call TriggerAddCondition(tt,Condition(function MulticastChannelingsStopper))
        call SaveUnitHandle(hashtable019,GetHandleId(tt),0,Caster)
        set tt=null
      endif
    elseif CVE==3 then
      call TriggerRegisterUnitEvent(GAME_TRIGGER,Caster,EVENT_UNIT_SPELL_FINISH)
      call IssueImmediateOrderById(Caster,real065)
    endif
    
    if disabled then
      call SetPlayerAbilityAvailable(p,CTE,false)
    endif
  endif
  set t=null
  set Source=null
  set Caster=null
  set CWE=null
  set p=null
  return false
endfunction

function group028 takes integer r returns nothing
  local unit Source=GetTriggerUnit()
  local integer CTE=GetSpellAbilityId()
  local integer Level=GetUnitAbilityLevel(Source,CTE)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer CVE=LoadInteger(hashtable019,GetHandleId(Source),'ORDT')
  local integer i
  local timer tt
  local integer h
  if r==2 then
    call TextTagOnUnit(GetObjectName('n0K7'),5,GetTriggerUnit(),.03,255,0,0,255)
  elseif r==3 then
    call TextTagOnUnit(GetObjectName('n0JT'),5,GetTriggerUnit(),.03,255,0,0,255)
  elseif r==4 then
    call TextTagOnUnit(GetObjectName('n0K8'),5,GetTriggerUnit(),.03,255,0,0,255)
  elseif r==5 then
    call TextTagOnUnit(GetObjectName('n0JO'),5,GetTriggerUnit(),.03,255,0,0,255)
  endif
  set r=r-1
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(300),(r))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(299),(CTE))
  if CVE==1 then
    call SaveInteger(hashtable019,(Cache),'0ORD',LoadInteger(hashtable019,GetHandleId(Source),'0ORD'))
    call SaveReal(hashtable019,(Cache),'000D',LoadReal(hashtable019,GetHandleId(Source),'000D'))
    call SaveUnitHandle(hashtable019,(Cache),(17),(GetSpellTargetUnit()))
  elseif CVE==2 then
    
    if CTE=='A0MT' then
      set i=1
      loop
        set tt=CreateTimer()
        set h=GetHandleId(tt)
        call SaveUnitHandle(hashtable019,h,2,Source)
        call UnitAddAbility(Source,'A0MT')
        call SetUnitAbilityLevel(Source,'A0MT',Level)
        call SaveReal(hashtable019,h,6,GetSpellTargetX())
        call SaveReal(hashtable019,h,7,GetSpellTargetY())
        call TimerStart(tt,0,false,function Netherblast_Effect)
        set i=i+1
        exitwhen i>r
      endloop
      set tt=null
    else
      call SaveInteger(hashtable019,(Cache),'0ORD',LoadInteger(hashtable019,GetHandleId(Source),'0ORD'))
      call SaveReal(hashtable019,(Cache),'000D',LoadReal(hashtable019,GetHandleId(Source),'000D'))
      call SaveReal(hashtable019,(Cache),'0LOX',GetSpellTargetX())
      call SaveReal(hashtable019,(Cache),'0LOY',GetSpellTargetY())
    endif
  elseif CVE==3 then
    call SaveInteger(hashtable019,(Cache),'0ORD',LoadInteger(hashtable019,GetHandleId(Source),'0ORD'))
    //call SaveReal(HY,(Cache),'0FAC',GetUnitFacing(Source))
  endif
  if CTE!='A0MT' then
    call SaveInteger(hashtable019,(Cache),'ORDT',CVE)
    call TriggerRegisterTimerEvent(t,0.3,true)
    call TriggerAddCondition(t,Condition(function rect022))
  endif
  set t=null
  set Source=null
endfunction

function CYE takes nothing returns boolean//multicast
  local integer r
  local unit u
  local real ux
  local real uy
  local real tx
  local real ty
  if IMaxIF(GetUnitAbilityLevel(GetTriggerUnit(),'A088'),GetUnitAbilityLevel(GetTriggerUnit(),'QP24'))>0 then
    set u=GetTriggerUnit()
    if GetTriggerEventId()==EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER then
      call SaveInteger(hashtable019,GetHandleId(u),'0ORD',GetIssuedOrderId())
      call SaveInteger(hashtable019,GetHandleId(u),'ORDT',1)
      return false
    elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER then
      call SaveInteger(hashtable019,GetHandleId(u),'0ORD',GetIssuedOrderId())
      call SaveInteger(hashtable019,GetHandleId(u),'ORDT',2)
      return false
    elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ISSUED_ORDER then
      call SaveInteger(hashtable019,GetHandleId(u),'0ORD',GetIssuedOrderId())
      call SaveInteger(hashtable019,GetHandleId(u),'ORDT',3)
      return false
    endif
    if MulticastSpellRestriction(GetSpellAbilityId()) and GetUnitAbilityLevel(GetTriggerUnit(),'A04R')==0then
      if GetSpellTargetUnit()!=null and LoadInteger(hashtable019,GetHandleId(u),'ORDT')==1 then
        if IsBlocked(GetSpellTargetUnit())==false and IsPlayerEnemy(GetOwningPlayer(GetSpellTargetUnit()),GetOwningPlayer(u)) then
          set r=integer504(u)
          if r>1 then
            set ux=GetUnitX(u)
            set uy=GetUnitY(u)
            set tx=GetUnitX(GetSpellTargetUnit())
            set ty=GetUnitY(GetSpellTargetUnit())
            call SaveReal(hashtable019,GetHandleId(u),'000D',SquareRoot(((tx-ux)*(tx-ux))+((ty-uy)*(ty-uy))))
            call group028(r)
          endif
        endif
      elseif GetSpellTargetLoc()!=null and LoadInteger(hashtable019,GetHandleId(u),'ORDT')==2 then
        set r=integer504(u)
        if r>1 then
          set ux=GetUnitX(u)
          set uy=GetUnitY(u)
          set tx=GetLocationX(GetSpellTargetLoc())
          set ty=GetLocationY(GetSpellTargetLoc())
          call SaveReal(hashtable019,GetHandleId(u),'000D',SquareRoot(((tx-ux)*(tx-ux))+((ty-uy)*(ty-uy))))
          call group028(r)
        endif
      elseif LoadInteger(hashtable019,GetHandleId(u),'ORDT')==3 then
        set r=integer504(u)
        if r>1 then
          call group028(r)
        endif
      endif
    endif
  endif
  if IsBlocked(GetSpellTargetUnit())==false and GetSpellAbilityId()=='A2KQ' then
    call AghaFireblast_Cast()
  endif
  set u=null
  return false
endfunction

function CZE takes nothing returns boolean
  local integer id=GetPlayerId(GetTriggerPlayer())
  local string s1
  local string s2
  local string s3
  local string s4
  local string s5
  local string s6
  if FY8[id]>0 then
    set s1=GetObjectName('n0JH')+" "+I2S(FY8[id])
    set s2=GetObjectName('n0JM')+" "+I2S(FU8[id]+FV8[id]+FW8[id]+FX8[id])+" ("+I2S((FU8[id]+FV8[id]+FW8[id]+FX8[id])*100/ FY8[id])+"%)"
    set s3=GetObjectName('n0JL')+" "+I2S(FU8[id])+" ("+I2S(100*FU8[id]/ FY8[id])+"%)"
    set s4=GetObjectName('n0JK')+" "+I2S(FV8[id])+" ("+I2S(100*FV8[id]/ FY8[id])+"%)"
    set s5=GetObjectName('n0JJ')+" "+I2S(FW8[id])+" ("+I2S(100*FW8[id]/ FY8[id])+"%)"
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,s1)
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,s2)
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,s3)
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,s4)
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,s5)
  endif
  return false
endfunction

function MM9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_ORDER)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function CYE))
  set t=CreateTrigger()
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-st",true)
  call TriggerAddCondition(t,Condition(function CZE))
  set t=null
endfunction

function real068 takes nothing returns boolean
  local unit group030=GetFilterUnit()
  local unit XX8=GetTriggerUnit()
  if IsUnitAlly(group030,GetOwningPlayer(XX8))and GetUnitState(group030,UNIT_STATE_LIFE)>0 and GetUnitAbilityLevel(group030,'Bblo')==0 then
    if(GetOwningPlayer(group030)==Sentinels[0]or GetOwningPlayer(group030)==Scourges[0])then
      if(GetUnitTypeId(group030)=='ugho' or GetUnitTypeId(group030)=='u001' or GetUnitTypeId(group030)=='unec' or GetUnitTypeId(group030)=='u002')then
        set group030=null
        set XX8=null
        return true
      endif
      if(GetUnitTypeId(group030)=='esen' or GetUnitTypeId(group030)=='e00V' or GetUnitTypeId(group030)=='edry' or GetUnitTypeId(group030)=='e00W')then
        set group030=null
        set XX8=null
        return true
      endif
      set group030=null
      set XX8=null
      return false
    elseif IsUnitType(group030,UNIT_TYPE_HERO) then
      set group030=null
      set XX8=null
      return true
    elseif GetOwningPlayer(group030)==GetOwningPlayer(XX8)then
      set group030=null
      set XX8=null
      return true
    endif
  endif
  set group030=null
  set XX8=null
  return false
endfunction



function CBE takes integer r returns nothing
  local unit XX8=GetTriggerUnit()
  local integer Level=r
  local group g = GetAvailableGroup()
  local group HQ9=GetAvailableGroup()
  local unit Caster
  local unit unit039
  local integer V58=GetSpellAbilityId()
  local integer VT8=1
  local boolean b = false
  if r==2 then
    call TextTagOnUnit(GetObjectName('n0K7'),5,XX8,.03,255,0,0,255)
  elseif r==3 then
    call TextTagOnUnit(GetObjectName('n0JT'),5,XX8,.03,255,0,0,255)
  elseif r==4 then
    call TextTagOnUnit(GetObjectName('n0K8'),5,XX8,.03,255,0,0,255)
  elseif r==5 then
    call TextTagOnUnit(GetObjectName('n0JO'),5,XX8,.03,255,0,0,255)
  endif
  set r=r-1
  call GroupEnumUnitsInRange(HQ9,GetUnitX(XX8),GetUnitY(XX8),600,Condition(function real068))
  if XX8!=GetSpellTargetUnit()then
    call GroupAddUnit(HQ9,XX8)
  endif
  
  if HaveSavedInteger(MHT,V58,0)then
    set V58 = LoadInteger(MHT,V58,0)
  endif
  
  call GroupAddGroup(HQ9,g)
  
  loop
    exitwhen b
    loop
      exitwhen VT8>Level or b
      
      if V58=='A08N' or V58=='A2QM' then
        set unit039=GetSpellTargetUnit()
      else
        set unit039=GroupPickRandomUnit(HQ9)
      endif
      set b = unit039==null
      
      if b==false then
        set Caster=CreateUnit(GetOwningPlayer(XX8),'e00C',GetUnitX(XX8),GetUnitY(XX8),270)
        
        call TriggerRegisterUnitEvent(GAME_TRIGGER,Caster,EVENT_UNIT_SPELL_EFFECT)
        
        call UnitAddAbility2(Caster,V58)
        call SetUnitAbilityLevel(Caster,V58,GetUnitAbilityLevel(XX8,V58))
        call UnitApplyTimedLife(Caster,'BTLF',1.)
        call IssueTargetOrderById(Caster,LoadInteger(hashtable019,GetHandleId(XX8),'0ORD'),unit039)
        call SetUnitPathing(Caster,false)
        call SetUnitInvulnerable(Caster,true)
        call UnitAddAbility2(Caster,'Aloc')
        
        call GroupRemoveUnit(HQ9,unit039)
        set VT8=VT8+1
      endif
    endloop
    
    if b and Level > VT8 then
      set b = false
      call GroupAddGroup(g,HQ9)
    endif
  endloop
  
  call KillGroup(HQ9)
  call KillGroup(g)
  
  set Caster = null
  set HQ9 = null
  set unit039 = null
  set XX8 = null
  set g = null
endfunction

function real067 takes nothing returns boolean
  local integer r
  if IMaxIF(GetUnitAbilityLevel(GetTriggerUnit(),'A088'),GetUnitAbilityLevel(GetTriggerUnit(),'QP24'))>0 then
    if GetTriggerEventId()==EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER then
      call SaveInteger(hashtable019,GetHandleId(GetTriggerUnit()),'0ORD'+1,GetIssuedOrderId())
    elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER then
      call SaveInteger(hashtable019,GetHandleId(GetTriggerUnit()),'0ORD'+1,0)
    elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ISSUED_ORDER then
      call SaveInteger(hashtable019,GetHandleId(GetTriggerUnit()),'0ORD'+1,0)
    endif
    if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT and(LoadInteger(hashtable019,GetHandleId(GetTriggerUnit()),'0ORD'+1)!=0)then
      if MulticastSpellRestriction(GetSpellAbilityId())and(GetSpellTargetUnit()!=null)and(GetSpellAbilityId()!=null) and GetUnitAbilityLevel(GetTriggerUnit(),'A04R')==0then
        if IsPlayerAlly(GetOwningPlayer(GetSpellTargetUnit()),GetOwningPlayer(GetTriggerUnit()))then
          set r=integer504(GetTriggerUnit())
          
          //set r = 4
          
          if r>1 then
            call CBE(r)
          endif
        endif
      endif
    endif
  endif
  return false
endfunction

function Multicast_Clear takes unit u, integer spell returns nothing
  if GetUnitTypeId(u)=='e00X' then
    call UnitRemoveAbility(u,spell)
  endif
endfunction

function Multicast_Init takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local unit d = CreateUnit(GetOwningPlayer(u),'e00X',0,0,0)
  
  call UnitAddAbility(d,'Aloc')
  call UnitAddAbility(d,'A04R')
  
  call TriggerRegisterUnitEvent(GAME_TRIGGER,d,EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(GAME_TRIGGER,d,EVENT_UNIT_SPELL_ENDCAST)
  
  call SaveUnitHandle(MHT,GetHandleId(u),'A088',d)
  
  set d = null
  set u = null
endfunction

function Multicast_Setup takes nothing returns nothing
  
  // replacement abilities to be used instead of the norma ability for things like cast time and da like :3
  
  //call SaveInteger(MHT,'A0MT',0,'A50P') //nether blast
endfunction


function MN9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  
  //call Multicast_Setup()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_ORDER)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function real067))
  set t=null
endfunction

function C6E takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')!=1 and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit())))!=null
endfunction

function CLE takes nothing returns nothing
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),3,TmpReal378)
endfunction

function Omni_Purification takes nothing returns nothing
  local boolexpr VH9=Condition(function C6E)
  local group HQ9=GetAvailableGroup()
  local real x=GetUnitX(GetSpellTargetUnit())
  local real y=GetUnitY(GetSpellTargetUnit())
  set TmpReal378=90*GetUnitAbilityLevel(GetTriggerUnit(),('A08N'))
  if GetUnitState(GetSpellTargetUnit(),UNIT_STATE_LIFE)>1 then
    call SetUnitState(GetSpellTargetUnit(),UNIT_STATE_LIFE,GetUnitState(GetSpellTargetUnit(),UNIT_STATE_LIFE)+TmpReal378)
  endif
  call GroupEnumUnitsInRange(HQ9,x,y,250,VH9)
  call ForGroup(HQ9,function CLE)
  call KillGroup(HQ9)
  set HQ9=null
  set VH9=null
endfunction


function C0E takes nothing returns boolean
  local unit W39=GetSummonedUnit()
  local unit Caster
  local unit Target
  if IsUnitIllusion(W39) then
    set Caster=GetSummoningUnit()
    set Target=(LoadUnitHandle(hashtable019,(GetHandleId(Caster)),(303)))
    if Target==null or GetUnitX(Target)==.0 or GetUnitY(Target)==.0 then
      set W39=null
      set Caster=null
      set Target=null
      return false
    endif
    call SetUnitX(W39,GetUnitX(Target))
    call SetUnitY(W39,GetUnitY(Target))
    call IssueTargetOrderById(W39,851983,Target)
  endif
  set W39=null
  set Caster=null
  set Target=null
  return false
endfunction

function real070 takes player p,unit Target,integer Level returns nothing
  local unit Caster=CreateUnit(p,'e00E',GetUnitX(Target),GetUnitX(Target),0)
  local integer AF8
  call SaveUnitHandle(hashtable019,(GetHandleId(Caster)),(303),(Target))
  if Level==1 then
    set AF8='A10H'
  elseif Level==2 then
    set AF8='A10G'
  elseif Level==3 then
    set AF8='A10I'
  else
    set AF8='A10F'
  endif
  call UnitAddAbility2(Caster,AF8)
  call IssueTargetOrderById(Caster,852274,udg_Hero[GetPlayerId(p)])
  set Caster=null
endfunction

function reals022 takes player p,unit Target,integer Level,boolean L4E,boolean L7E returns nothing
  local real Damage=50+50*Level
  local unit Caster
  local integer AF8
  if L7E then
    set Caster=CreateUnit(p,'e00E',GetUnitX(Target),GetUnitY(Target),0)
    call UnitAddAbility2(Caster,'A10C')
    call SetUnitAbilityLevel(Caster,'A10C',Level)
    call IssueTargetOrderById(Caster,852189,Target)
    call DamageTarget(Caster,Target,1,Damage)
    if L4E then
      call real070(p,Target,Level)
    endif
  endif
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\IllidanMissile\\IllidanMissile.mdl",Target,"origin"))
  set Caster=null
endfunction

function L8E takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local player p
  local integer XK8
  local unit Target
  local integer Level
  local boolean DV9
  local unit Projectile
  local real x
  local real y
  local real TargetX
  local real TargetY
  local real AM8
  local real AN8
  local real AO8
  local real AP8
  local boolean disjointed
  local real lastX
  local real lastY
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if IsDisjointSpell(GetSpellAbilityId()) then
      call SaveBoolean(hashtable019,Cache,0,true)
      call SaveReal(hashtable019,Cache,0,GetUnitX(GetTriggerUnit()))
      call SaveReal(hashtable019,Cache,1,GetUnitY(GetTriggerUnit()))
    endif
  else
    set p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
    set XK8=(LoadInteger(hashtable019,(Cache),(30)))
    set Target=UnitAsInteger_Load(XK8)
    set Level=(LoadInteger(hashtable019,(Cache),(5)))
    set DV9=(LoadBoolean(hashtable019,(Cache),(302)))
    set Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
    set x=GetUnitX(Projectile)
    set y=GetUnitY(Projectile)
    set TargetX=GetUnitX(Target)
    set TargetY=GetUnitY(Target)
    set AM8=1000*.035
    set disjointed=LoadBoolean(hashtable019,Cache,0)
    if disjointed then
      set TargetX=LoadReal(hashtable019,Cache,0)
      set TargetY=LoadReal(hashtable019,Cache,1)
    endif
    set AN8=AngleBetweenXY(x,y,TargetX,TargetY)
    set AO8=x+AM8*Cos(AN8*bj_DEGTORAD)
    set AP8=y+AM8*Sin(AN8*bj_DEGTORAD)
    
    call SetUnitX(Projectile,AO8)
    call SetUnitY(Projectile,AP8)
    call SetUnitFacing(Projectile,AN8)
    if DistanceBetweenXY(TargetX,TargetY,AO8,AP8)<=AM8 then
      if disjointed==false then
        call reals022(p,Target,Level,true,DV9)
      endif
      call KillUnit(Projectile)
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set Target=null
  set Projectile=null
  return false
endfunction

function L9E takes unit Source,integer Level,unit Target,boolean DV9 returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=CreateUnit(GetOwningPlayer(Source),'h06L',GetUnitX(Source),GetUnitY(Source),AngleBetweenXY(GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target)))
  call SavePlayerHandle(hashtable019,(Cache),(54),(GetOwningPlayer(Source)))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveBoolean(hashtable019,(Cache),(302),(DV9))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call TriggerRegisterTimerEvent(t,.035,true)
  call SaveBoolean(hashtable019,Cache,0,false)//has been disjointed
  call SaveReal(hashtable019,Cache,0,0)//X
  call SaveReal(hashtable019,Cache,1,0)//Y
  call TriggerAddCondition(t,Condition(function L8E))
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_SPELL_EFFECT)
  set t=null
  set Projectile=null
endfunction

function LDE takes nothing returns boolean
  if IsUnitIllusion(GetFilterUnit()) and isPlayerPickedAbility(GetOwningPlayer(GetFilterUnit()),83)and GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(GetTriggerUnit())then
    call L9E(GetFilterUnit(),3,GetSpellTargetUnit(),false)
  endif
  return false
endfunction

function PL_SpiritLance takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'A10D')
  local unit Target=GetSpellTargetUnit()
  local group g=GetAvailableGroup()
  
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),700,Condition(function LDE))
  call L9E(Hero,Level,Target,IsBlocked(GetSpellTargetUnit())==false)
  call KillGroup(g)
  
  set Hero=null
  set Target=null
  set g=null
endfunction

function LGE takes nothing returns boolean
  if IsUnitIllusion(GetFilterUnit()) and isPlayerPickedAbility(GetOwningPlayer(GetFilterUnit()),83)and GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(GetTriggerUnit())then
    call SetUnitFacing(GetFilterUnit(),tt_real1)
    call SetUnitAnimation(GetFilterUnit(),"spell")
  endif
  return false
endfunction

function PL_SpiritLance_OnCast takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local group g=GetAvailableGroup()
  set tt_real1=AngleBetweenXY(GetUnitX(Hero),GetUnitY(Hero),GetUnitX(GetSpellTargetUnit()),GetUnitY(GetSpellTargetUnit()))
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),700,Condition(function LGE))
  call KillGroup(g)
  set Hero=null
  set g=null
endfunction

function Func1104 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call PreloadAbility('A10C')
  call PreloadAbility('A10H')
  call PreloadAbility('A10G')
  call PreloadAbility('A10I')
  call PreloadAbility('A10F')
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function C0E))
  set t=null
endfunction

function LJE takes nothing returns boolean
  if (GetUnitAbilityLevel(GetFilterUnit(),'B03B')>0 or GetUnitAbilityLevel(GetFilterUnit(),'P084')>0) and IsDead(GetFilterUnit())==false then
    set tt_int1=tt_int1+1
  endif
  return false
endfunction

function LKE takes unit u returns nothing
  local group g=GetAvailableGroup()
  local integer jux=GetUnitAbilityLevel(u,'P083') //A0DB //juxtapose
  local integer ult=GetUnitAbilityLevel(u,'P084') //A0YK //phantom edge
  local unit Caster
  local integer maxillus=2*jux
  local integer juxchance=12
  //call echo("z1")
  if maxillus==0 and isPlayerPickedAbility(GetOwningPlayer(GetAttacker()),83)==false then //if Juxtapose isn't in the player's skill list
    set maxillus=2*ult + 1
  endif
  set tt_int1=0
  call GroupEnumUnitsOfPlayer(g,GetOwningPlayer(u),Condition(function LJE))
  call KillGroup(g)
  if tt_int1<maxillus and GetUnitAbilityLevel(u,'BNdo')==0 then
    if IsUnitIllusion(u)==false and PRD_Get(u,'P083',juxchance+2*ult)then
      set Caster=CreateUnit(GetOwningPlayer(u),'e00E',GetUnitX(u),GetUnitY(u),0)
      call UnitAddAbility2(Caster,'A0DD')
      call IssueTargetOrderById(Caster,852274,u)
    endif
    if IsUnitIllusion(u)and ult>0 and PRD_Get(u,'P083',1+2*ult) then
      set Caster=CreateUnit(GetOwningPlayer(u),'e00E',GetUnitX(u),GetUnitY(u),0)
      call UnitAddAbility2(Caster,'A0DD')
      call IssueTargetOrderById(Caster,852274,u)
    endif
  endif
  set g=null
  set Caster=null
endfunction

function LRE takes nothing returns boolean
  local unit u = GetAttacker()
  
  if ((GetUnitAbilityLevel(u,'A0YK')>0 or GetUnitAbilityLevel(u,'QP0C')>0) or GetUnitAbilityLevel(u,'B03B')>0 or GetUnitAbilityLevel(u,'B03A')>0)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(u)) then
    call LKE(u)
  endif
  
  set u = null
  return false
endfunction

function Func1108 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function LRE))
  set t=null
endfunction

function PL_Doppelwalk takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(u),'e00E',GetUnitX(u),GetUnitY(u),0)
  call UnitAddAbility2(Caster,'A0DC')
  call IssueTargetOrderById(Caster,852274,u)
  set u=null
  set Caster=null
endfunction

function LUE takes nothing returns boolean
  if GetUnitTypeId(GetFilterUnit())==HeroID[21]and GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(GetTriggerUnit())and IsUnitIllusion(GetFilterUnit())==false then
    set tt_unit1=GetFilterUnit()
  endif
  return false
endfunction

function LVE takes nothing returns nothing
  local unit W39=GetTriggerUnit()
  local unit Source
  local group g=GetAvailableGroup()
  local real x
  local real y
  set tt_unit1=null
  call GroupEnumUnitsInRange(g,GetUnitX(W39),GetUnitY(W39),1000,Condition(function LUE))
  call KillGroup(g)
  set Source=tt_unit1
  if Source!=null then
    set x=GetUnitX(Source)
    set y=GetUnitY(Source)
    call SetUnitPosition(W39,x,y)
  endif
  set x=GetUnitX(W39)+600*Cos(GetUnitFacing(W39)*bj_DEGTORAD)
  set y=GetUnitY(W39)+600*Sin(GetUnitFacing(W39)*bj_DEGTORAD)
  call IssuePointOrderById(W39,851986,x,y)
  set W39=null
  set Source=null
  set g=null
endfunction

function LWE takes nothing returns boolean
  if GetUnitAbilityLevel(GetTriggerUnit(),'B03A')>0 then
    call LVE()
  endif
  return false
endfunction

function MP9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local region r=CreateRegion()
  call RegionAddRect(r,bj_mapInitialPlayableArea)
  call TriggerRegisterEnterRegion(t,r,Condition(function ReturnTrue2))
  call TriggerAddCondition(t,Condition(function LWE))
  set t=null
  set r=null
endfunction

function OvergrowthDur takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local real limit=LoadReal(hashtable019,h,0)
  local real time=TimerGetElapsed(GlobalTimer)
  if GetTriggerEventId()==EVENT_UNIT_DEATH or limit<time or GetUnitAbilityLevel(u,'A31B')==0 then
    call RemoveSavedHandle(MHT,GetHandleId(u),'OVGR')
    call DestroyEffect(LoadEffectHandle(hashtable019,h,1))
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
    call UnitRemoveAbility(u,'A31B')
    call UnitRemoveAbility(u,'B0ER')
  endif
  set t=null
  set u=null
endfunction

function Tree_Overgrowth_Targets takes nothing returns boolean
  local unit u = GetFilterUnit()
  local trigger t
  local integer h
  local integer hu
  local integer lvl=GetUnitAbilityLevel(TEMPUNIT,'A07Z')
  local real time=TimerGetElapsed(GlobalTimer)
  local real dur=2.25+.75*lvl
  if IsUnitEnemy(u,group_temp_player)and IsUnitVisibleLoD(u,GetOwningPlayer(TEMPUNIT)) and GetUnitAbilityLevel(u,'A04R')==0 and IsDead(u)==false and IsUnitType(u,UNIT_TYPE_STRUCTURE)==false then
    //		set hu=GetHandleId(u)
    //		set t=LoadTriggerHandle(MHT,hu,'OVGR')
    //		if t!=null then
    //			set h=GetHandleId(t)
    //			if LoadReal(HY,h,0)<time+dur then
    //				call SaveReal(HY,h,0,time+dur)
    //				call EnsnareUnit(u,'A31B',dur)
    //			endif
    //		else
    //			set t=CreateTrigger()
    //			set h=GetHandleId(t)
    //			call TriggerRegisterTimerEvent(t,0.1,true)
    //			call SaveUnitHandle(HY,h,0,u)
    //			call SaveReal(HY,h,0,time+dur)
    //			call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
    //			call TriggerAddCondition(t,Condition(function OvergrowthDur))
    //			call UnitAddAbility2(u,'NOAT')
    //			call SaveTriggerHandle(MHT,hu,'OVGR',t)
    //			call SaveEffectHandle(HY,h,1,AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\EntanglingRoots\\EntanglingRootsTarget.mdl",u,"origin"))
    //			call UnitAddAbility2(u,'A31B')
    //			call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A31B',false)
    //			call UnitMakeAbilityPermanent(u,true,'A31A')
    //			call EnsnareUnit(u,'A31B',dur)
    //			call DetectMagicDispell(u,'A31B','B0ER')
    //			 
    //		endif
    
    call IssueTargetOrderById(group_temp_unit[0],852171,u)
  endif
  set t=null
  set u = null
  return false
endfunction

function Tree_Overgrowth_Start takes nothing returns nothing
  local unit u = GetTriggerUnit()
  
  set group_temp_player = GetOwningPlayer(u)
  set group_temp_unit[0] = CreateUnit(group_temp_player,'e00E',0,0,0)
  set TEMPUNIT=u
  call UnitAddAbility(group_temp_unit[0],'A06T')
  call SetUnitAbilityLevel(group_temp_unit[0],'A06T',GetUnitAbilityLevel(u,'A07Z'))
  
  call GroupEnumUnitsInRange(temp_group,GetWidgetX(u),GetWidgetY(u),700,Condition(function Tree_Overgrowth_Targets))
  
  set u = null
endfunction


function Find_Trees_Targets takes nothing returns boolean
  local destructable d = GetFilterDestructable()
  local real x
  local real y
  
  if(WA8(d)or GetDestructableTypeId(d)=='B005')and GetWidgetLife(d)>0 then
    set x = GetWidgetX(d) - group_temp_real[201]
    set y = GetWidgetY(d) - group_temp_real[202]
    
    if group_temp_real[200] > SquareRoot(x*x + y*y)then
      call SaveBoolean(MHT,99999,99995,true)
    endif
  endif
  set d=null
  return false
endfunction

function Find_Trees takes real x, real y, real range returns boolean
  local rect r = null
  
  set group_temp_real[200] = range
  set group_temp_real[201] = x
  set group_temp_real[202] = y
  set range = range + 150
  
  set r = Rect(x-range,y-range,x+range,y+range)
  
  call SaveBoolean(MHT,99999,99995,false)
  call EnumDestructablesInRect(r,Condition(function Find_Trees_Targets),null)
  
  call RemoveRect(r)
  set r = null
  
  return LoadBoolean(MHT,99999,99995)
endfunction

function Tree_Invis_Cancel takes unit u returns nothing
  call UnitRemoveAbility(u,'B021') //removes buffs, so that the timer will detect the lack of invis and end the spell
  call UnitRemoveAbility(u,'B0E9')
  call UnitRemoveAbility(u,'A1GA')
  call UnitRemoveAbility(u,'A23N')
endfunction

function Tree_Invis_Duration takes nothing returns nothing
  local unit d = null
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,0)
  local boolean b1 = GetUnitAbilityLevel(u,'B021')==0
  local boolean b2 = Find_Trees(GetWidgetX(u),GetWidgetY(u),375)
  
  if LoadBoolean(MHT,GetHandleId(u),StringHash("TreeInvisibility")) and LoadBoolean(MHT,info,0) and b1 and b2 and count>1 then
    set d = CreateUnit(GetOwningPlayer(u),'e00E',GetWidgetX(u),GetWidgetY(u),0)
    call UnitAddAbility(d,'A01Z')
    call SetUnitAbilityLevel(d,'A01Z',LoadInteger(MHT,info,2))
    
    call IssueTargetOrder(d,"invisibility",u)
    call SaveInteger(MHT,info,0,count - 1)
    
    set d = null
    set u = null
    set t = null
    return
  endif
  
  if count==0 or IsDead(u) or b1 then
    call SaveBoolean(MHT,info,0,false)
    call UnitRemoveAbility(u,'B0E9')//speed buff
    call UnitRemoveAbility(u,'B021')//invis buff
    call UnitRemoveAbility(u,'A1GA')//perma invis
    call UnitRemoveAbility(u,'A23N')//speed aura
    
    call Timer_End(t)
    set t = null
    set u = null
    return
  endif
  
  call SaveInteger(MHT,info,0,count - 1)
  
  if b2 then
    call SaveInteger(MHT,info,1,0)
  else
    set count = LoadInteger(MHT,info,1)
    
    if count==9 then
      call UnitRemoveAbility(u,'B0E9')
      call UnitRemoveAbility(u,'B021')
      call UnitRemoveAbility(u,'A23N')
      call UnitRemoveAbility(u,'A1GA')
      
      call Timer_End(t)
    else
      call SaveInteger(MHT,info,1,count + 1)
    endif
  endif
  
  set t = null
  set u = null
endfunction

function Tree_Invis_Self takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local unit u = LoadUnitHandle(MHT,info,0)
  
  if IsDead(u)==false and GetUnitAbilityLevel(u,'B021')>0 then
    call UnitAddAbility2(u,'A1GA')
    call TimerStart(t,0.1,true,function Tree_Invis_Duration)
    call SaveInteger(MHT,info,0,LoadInteger(MHT,info,0) - 20)
    call SaveBoolean(MHT,info,0,true)
    call SaveBoolean(MHT,GetHandleId(u),StringHash("TreeInvisibility"),true)
    
    set t = null
    set u = null
    return
  endif
  
  call Timer_End(t)
  set t = null
  set u = null
endfunction

function Tree_Invis_Remove takes nothing returns nothing
  local timer t = GetExpiredTimer()
  
  call UnitRemoveAbility(LoadUnitHandle(MHT,GetHandleId(t),0),'B021')
  
  call Timer_End(t)
  set t = null
endfunction

function Tree_Invis_Start takes nothing returns nothing
  local unit u = null
  local unit d = GetSpellTargetUnit()
  local timer t = Timer_Get()
  local integer info
  local integer level
  
  if Find_Trees(GetWidgetX(d),GetWidgetY(d),375)==false then //prevents the spell from starting if the target is not near any trees
    call TimerStart(t,0,false,function Tree_Invis_Remove)
    
    call SaveUnitHandle(MHT,GetHandleId(t),0,d)
    call UnitRemoveAbility(d,'B021')
    
    set d = null
    return
  endif
  
  set u = GetTriggerUnit()
  set info = GetHandleId(t)
  set level = GetUnitAbilityLevel(u,'A01Z')
  
  call SaveUnitHandle(MHT,info,0,d)
  call SaveInteger(MHT,info,0,level*150)
  call SaveInteger(MHT,info,1,0)
  call SaveInteger(MHT,info,2,level)
  call SaveBoolean(MHT,info,0,false)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Invisibility\\InvisibilityTarget.mdl",d,"chest"))
  
  call UnitAddAbility2(d,'A23N')
  
  if u==d then
    call TimerStart(t,2,false,function Tree_Invis_Self)
    
    set d = null
    set u = null
    set t = null
    return
  endif
  
  call TimerStart(t,0.1,true,function Tree_Invis_Duration)
  
  set d = null
  set u = null
  set t = null
endfunction

function Tree_Armour_Closest takes unit u returns nothing
  local real x = GetWidgetX(u) - group_temp_real[0]
  local real y = GetWidgetY(u) - group_temp_real[1]
  local real d = SquareRoot(x*x + y*y)
  
  if group_temp_real[2] > d then
    set group_temp_real[2] = d
    set group_temp_unit[1] = u
  endif
endfunction

function Tree_Armour_Structures takes integer id returns boolean
  return id=='u00M' or id=='u00N' or id=='u00D' or id=='u00T' or id=='usep' or id=='utod' or id=='unpl' or id=='e00R' or id=='e011' or id=='e00S' or id=='e019' or id=='eaom' or id=='eaoe' or id=='etol'
endfunction

function Tree_Armour_Find_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if IsUnitAlly(group_temp_unit[0],GetOwningPlayer(t)) and (IsUnitType(t,UNIT_TYPE_HERO) or (IsUnitType(t,UNIT_TYPE_STRUCTURE)and Tree_Armour_Structures(GetUnitTypeId(t)))) and IsDead(t)==false then
    call Tree_Armour_Closest(t)
  endif
  set t = null
  return false
endfunction

function Tree_Armour_Find takes unit u returns unit
  set group_temp_unit[0] = u
  set group_temp_unit[1] = null
  set group_temp_real[0] = GetSpellTargetX()
  set group_temp_real[1] = GetSpellTargetY()
  set group_temp_real[2] = 99999
  
  call GroupEnumUnitsInRange(temp_group,0,0,99999,Condition(function Tree_Armour_Find_Targets))
  
  return group_temp_unit[1]
endfunction

function Tree_Armour_End takes nothing returns boolean
  local unit u = null
  local trigger trig = GetTriggeringTrigger()
  local integer info = GetHandleId(trig)
  local integer count = LoadInteger(MHT,info,0)
  local integer limit=LoadInteger(MHT,info,15)
  if count==limit-1 or GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    set u = LoadUnitHandle(MHT,info,0)
    
    call Buff_Remove(u,LoDBuff_BuffID[26])
    
    call LoDStat_Sub(u,LoadInteger(MHT,info,1),"regen")
    call DestroyEffect(LoadEffectHandle(MHT,info,1))
    
    set count = LoadInteger(MHT,GetHandleId(u),'A509')
    
    if count==1then
      call UnitRemoveAbility(u,'A509')
    endif
    
    call SaveInteger(MHT,GetHandleId(u),'A509',count - 1)
    
    call FlushChildHashtable(MHT,info)
    call CleanTrigger(trig)
    set trig = null
    set u = null
  endif
  
  if GetEventDamage()>5 then
    if IsUnitType(GetEventDamageSource(),UNIT_TYPE_HERO)==false then
      call Damage_Block(GetTriggerUnit(),GetEventDamage(),true)
    endif
    call SaveInteger(MHT,info,0,count+1)
  endif
  
  set trig = null
  return false
endfunction

function Tree_Armour_Start takes nothing returns nothing
  local trigger t = CreateTrigger()
  local unit u = GetTriggerUnit()
  local unit u2 = GetSpellTargetUnit()
  local integer info = GetHandleId(t)
  local integer level = GetUnitAbilityLevel(u,'A2ML')
  local integer amount = 1 + 3*level
  local integer limit=3+level
  if GetUnitTypeId(u)=='e00C'then //multicast
    set u = udg_Hero[GetPlayerId(GetOwningPlayer(u))]
    set level = GetUnitAbilityLevel(u,'A2ML')
    set amount = 1 + 3*level
    set limit=3+level
  endif
  
  if u2==null then
    set u2 = Tree_Armour_Find(u)
  endif
  
  call Buff_Add(u2,LoDBuff_AbilID[26],LoDBuff_BuffID[26],15)
  call LoDStat_Add(u2,amount,"regen")
  call UnitAddAbility2(u2,'A509')
  call UnitMakeAbilityPermanent(u2,true,'A508')
  call SetUnitAbilityLevel(u2,'A508',level)
  
  call SaveUnitHandle(MHT,info,0,u2)
  call SaveEffectHandle(MHT,info,1,AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\EntanglingRoots\\EntanglingRootsTarget.mdl",u2,"chest"))
  
  call SaveInteger(MHT,info,0,0)
  call SaveInteger(MHT,info,1,amount)
  call SaveInteger(MHT,info,15,limit)
  
  call TriggerAddCondition(t,Condition(function Tree_Armour_End))
  call TriggerRegisterUnitEvent(t,u2,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(t,15,false)
  
  set info = GetHandleId(u2)
  
  call SaveInteger(MHT,info,'A509',LoadInteger(MHT,info,'A509') + 1)
  
  set u2 = null
  set u = null
  set t = null
endfunction



function DIF takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit1
  local unit Target=tt_unit2
  local real DJF=(LoadReal(hashtable019,(Cache),(21)))
  call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+DJF)
  set Source=null
  set Target=null
endfunction

function DKF takes nothing returns nothing
  local trigger t=AddProjectile(F68,GetEnumUnit(),'h0D8',"DIF",400,false)
  local integer Cache=GetHandleId(t)
  call SaveReal(hashtable019,(Cache),(21),((FL8)*1.))
  set t=null
endfunction

function DMF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local group g
  if GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call UnitRemoveAbility(Target,'A273')
    call UnitRemoveAbility(Target,'B0EL')
  else
    if GetTriggerEvalCount(t)>6 then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call UnitRemoveAbility(Target,'A273')
      call UnitRemoveAbility(Target,'B0EL')
    endif
    call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\EntBirthTarget\\EntBirthTarget.mdl",Target,"origin"))
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),525,Condition(function L08))
    set F68=Target
    set FL8=12+12*Level
    call ForGroup(g,function DKF)
    call KillGroup(g)
    call DamageTarget(Source,Target,1,FL8)
  endif
  set t=null
  set Source=null
  set Target=null
  set g=null
  return false
endfunction

function DNF takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A26N')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call UnitAddAbility2(Target,'A273')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A273',false)
  //call TriggerRegisterDeathEvent(t,Target)
  call TriggerRegisterTimerEvent(t,0.75,true)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function DMF))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(442),(((TimerGetElapsed(GlobalTimer)))*1.))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  set t=null
  set Source=null
  set Target=null
endfunction

function LeechSeed takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  call AddProjectile(Source,Target,'h0D9',"DNF",600,false)
  set Source=null
  set Target=null
endfunction

function Treant_LeechSeed takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call DNF()
  endif
endfunction




function Silencer_Last_Word_Effect takes nothing returns nothing
  local timer t = GetExpiredTimer()
  
  call DestroyEffect(LoadEffectHandle(MHT,GetHandleId(t),0))
  
  call Timer_End(t)
  set t = null
endfunction

function Silencer_Last_Word_End takes unit u, integer level, boolean disable returns nothing
  local timer t = null
  local unit d = CreateUnit(GetOwningPlayer(u),'e00E',0,0,0)
  local integer info = GetHandleId(u)
  local integer count = LoadInteger(MHT,info,'A2NT')-1
  local unit cho= LoadUnitHandle(MHT,GetHandleId(u),StringHash("lastworded"))
  
  if disable then //disables attacks
    set t = Timer_Get()
    
    call UnitAddAbility(d,'Z051')
    call SetUnitAbilityLevel(d,'Z051',level)
    
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\LastWordDamageSpell.mdx",u,"overhead"))
    
    call SaveEffectHandle(MHT,GetHandleId(t),0,AddSpecialEffectTarget("Abilities\\Spells\\Other\\Silence\\SilenceTarget.mdl",u,"overhead"))
    call TimerStart(t,3,false,function Silencer_Last_Word_Effect)
    
    set t = null
  else
    call UnitAddAbility(d,'A0LS')
    call SetUnitAbilityLevel(d,'A0LS',level)
  endif
  
  call IssueTargetOrderById(d,852585,u)
  call SaveInteger(MHT,info,'A2NT',count)
  
  if count==0 then
    call Buff_Remove(u,LoDBuff_BuffID[7])
  endif
  
  call DamageTarget(cho,u,1,(100 + (50*level)))
  set d = null
  set cho=null
endfunction

function Silencer_Last_Word_Cast takes unit u returns nothing
  if GetUnitAbilityLevel(u,LoDBuff_BuffID[7])>0 then
    call Silencer_Last_Word_End(u,GetUnitAbilityLevel(u,LoDBuff_AbilID[7]),false)
  endif
endfunction

function Silencer_Last_Word_Cast_Unit takes nothing returns boolean
  call Silencer_Last_Word_Cast(GetTriggerUnit())
  call CleanTrigger(GetTriggeringTrigger())
  return false
endfunction

function Silencer_Last_Word_Register takes unit u returns nothing
  local trigger trig = CreateTrigger()
  
  call TriggerRegisterUnitEvent(trig,u,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(trig,Condition(function Silencer_Last_Word_Cast_Unit))
  
  set trig = null
endfunction

function Silencer_Last_Word_Duration takes nothing returns nothing
  local timer time = GetExpiredTimer()
  local integer info = GetHandleId(time)
  local integer count = LoadInteger(MHT,info,0)
  local unit t = LoadUnitHandle(MHT,info,0)
  
  if count==1 then
    if GetUnitAbilityLevel(t,'B15V') + GetUnitAbilityLevel(t,'B05V') == 0 then //determines if the unit has already been
      call Silencer_Last_Word_End(t,LoadInteger(MHT,info,1),true)   //affected by Last Word
    endif
    call RemoveUnit(LoadUnitHandle(MHT,info,19))
    call DestroyEffect(LoadEffectHandle(MHT,info,2))
    call Timer_End(time)
    
    set time = null
    set t = null
    return
  endif
  
  call SaveInteger(MHT,info,0,count-1)
  call SetUnitPosition(LoadUnitHandle(MHT,info,19),GetUnitX(t),GetUnitY(t))
  if GetUnitAbilityLevel(t,LoDBuff_BuffID[7])>0then
    
  else
    call RemoveUnit(LoadUnitHandle(MHT,info,19))
    call DestroyEffect(LoadEffectHandle(MHT,info,2))
    call Timer_End(time)
  endif
  
  set time = null
  set t = null
endfunction

function Silencer_Last_word_Start takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local unit t = GetSpellTargetUnit()
  local timer time = Timer_Get()
  local integer info = GetHandleId(time)
  local integer level = GetUnitAbilityLevel(u,GetSpellAbilityId())
  local unit dummy
  if IsUnitType(u,UNIT_TYPE_HERO)==true then
    set dummy=CreateUnit(GetOwningPlayer(u),'o019',GetUnitX(t),GetUnitY(t),0)
    call SaveUnitHandle(MHT,info,19,dummy)
  endif
  //call Buff_Add(t,LoDBuff_AbilID[7],LoDBuff_BuffID[7],4.995)
  call AddTimedAbility(t,LoDBuff_AbilID[7],level,5)
  call SetUnitAbilityLevel(t,LoDBuff_AbilID[7],level) //makes the buff to the correct level
  
  call SaveUnitHandle(MHT,info,0,t)
  call SaveUnitHandle(MHT,info,1,u)
  call SaveEffectHandle(MHT,info,2,AddSpecialEffectTarget("war3mapImported\\LastWordDebuff_6.mdx",t,"overhead"))
  call SaveInteger(MHT,info,0,5)
  call SaveInteger(MHT,info,1,level)
  
  
  call SaveUnitHandle(MHT,GetHandleId(t),StringHash("lastworded"),u)
  
  if IsUnitType(t,UNIT_TYPE_HERO)==false then
    call Silencer_Last_Word_Register(t)
  endif
  
  call TimerStart(time,1.,true,function Silencer_Last_Word_Duration)
  
  set info = GetHandleId(t)
  call SaveInteger(MHT,info,'A2NT',LoadInteger(MHT,info,'A2NT')+1) // keeps track of number of current Last Words are affecting the unit, so that
  // multiple casts work correctly with each other. Cause MC is stronk spell! :O
  set time = null
  set t = null
  set dummy=null
  set u = null
endfunction

function MyLastWord_End takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=LoadUnitHandle(hashtable019,h,0)
  local unit target=LoadUnitHandle(hashtable019,h,1)
  local unit dummy=LoadUnitHandle(hashtable019,h,2)
  local unit disabler
  local eventid tid=GetTriggerEventId()
  local integer lvl=LoadInteger(hashtable019,h,3)
  local integer temp
  if tid==EVENT_UNIT_SPELL_EFFECT then
    set temp=GetSpellAbilityId()
    if isAintItemAbility(temp) and isDummyAbility(temp)==false and isPoisonArrowSkill(temp)==false and isItemSpellOrNoCd(temp)==false and IsItemAbilityById(temp)==false then
      
      
      call DamageTarget(caster,target,1,lvl*50+100)
      call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\LastWordDamageSpell.mdx",target,"overhead"))
      set disabler=CreateUnit(GetOwningPlayer(target),'e00E',GetUnitX(target),GetUnitY(target),0)
      call UnitAddAbility(disabler,'A0LS')
      call SetUnitAbilityLevel(disabler,'A0LS',lvl)
      call IssueTargetOrder(disabler,"drunkenhaze",target)
      call DestroyEffect(LoadEffectHandle(hashtable019,h,4))
      call RemoveUnit(dummy)
      call CleanTrigger(t)
      call FlushChildHashtable(hashtable019,h)
    endif
  elseif tid==EVENT_UNIT_DEATH then
    call DestroyEffect(LoadEffectHandle(hashtable019,h,4))
    call RemoveUnit(dummy)
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,h)
  elseif LoadReal(hashtable019,h,5)+5<=TimerGetElapsed(GlobalTimer) then
    call DamageTarget(caster,target,1,lvl*50+100)
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\LastWordDamageSpell.mdx",target,"overhead"))
    set disabler=CreateUnit(GetOwningPlayer(target),'e00E',GetUnitX(target),GetUnitY(target),0)
    call UnitAddAbility(disabler,'Z051')
    call SetUnitAbilityLevel(disabler,'Z051',lvl)
    call IssueTargetOrder(disabler,"drunkenhaze",target)
    call DestroyEffect(LoadEffectHandle(hashtable019,h,4))
    call RemoveUnit(dummy)
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,h)
  else
    call SetUnitX(dummy,GetUnitX(target))
    call SetUnitY(dummy,GetUnitY(target))
  endif
  set t=null
  set dummy=null
  set target=null
  set caster=null
  set disabler=null
  set tid=null
endfunction

function Silencer_LastWord takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local unit caster=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  local integer lvl=GetUnitAbilityLevel(caster,GetSpellAbilityId())
  local unit dummy=CreateUnit(GetOwningPlayer(caster),'o019',GetUnitX(target),GetUnitY(target),0)
  local real time=TimerGetElapsed(GlobalTimer)
  call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterTimerEvent(t,0.1,true)//50 triggers
  call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function MyLastWord_End))
  call SaveUnitHandle(hashtable019,h,0,caster)
  call SaveUnitHandle(hashtable019,h,1,target)
  call SaveUnitHandle(hashtable019,h,2,dummy)
  call SaveInteger(hashtable019,h,3,lvl)
  
  call SaveEffectHandle(hashtable019,h,4,AddSpecialEffectTarget("war3mapImported\\LastWordDebuff_6.mdx",target,"overhead"))
  call SaveReal(hashtable019,h,5,time)
  set t=null
  set caster=null
  set target=null
  set dummy=null
endfunction






















function DCF takes nothing returns boolean
  local real d
  if GetUnitAbilityLevel(GetTriggerUnit(),'B05X')>0 and GetUnitAbilityLevel(GetEventDamageSource(),'A0LZ')>0 and(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(2)))==GetEventDamageSource()then
    call UnitRemoveAbility(GetTriggerUnit(),'B05X')
    set d=(.15+.15*I2R(GetUnitAbilityLevel(GetEventDamageSource(),'A0LZ')))*GetHeroInt(GetEventDamageSource(),true)
    call TextTagOnUnit("+"+I2S(R2I(d)),1,GetTriggerUnit(),.023,3,216,216,216)
    call DisableTrigger(GetTriggeringTrigger())
    call DamageTarget(GetEventDamageSource(),GetTriggerUnit(),3,d)
    call FlushChildHashtable(hashtable019,(GetHandleId(GetTriggeringTrigger())))
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function D3F takes nothing returns nothing
  local trigger t
  local unit Target
  local unit Source
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    set Target=GetSpellTargetUnit()
    set Source=GetTriggerUnit()
  else
    set Target=GetTriggerUnit()
    set Source=GetAttacker()
  endif
  if IsUnitIllusion(Source)==false then
    set t=CreateTrigger()
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Source))
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerAddCondition(t,Condition(function DCF))
  endif
  set t=null
  set Target=null
  set Source=null
endfunction

function D6F takes nothing returns boolean
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetUnitAbilityLevel(GetAttacker(),'A0LZ')>0 and(LoadBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263)))and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetAttacker()==(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(14)))then
      call D3F()
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER then
    if(GetIssuedOrderId()==852255)then
      call SaveBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263),(true))
    elseif(GetIssuedOrderId()==852256)then
      call SaveBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263),(false))
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A0LZ' then
    call D3F()
  endif
  return false
endfunction


function DTF takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit2
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  call SetHeroInt(Source,GetHeroInt(Source,false)+1,true)
  call TextTagOnUnit("+1 "+GetObjectName('n0JP'),3,Source,.023,0,255,0,230)
  set Source=null
endfunction

function DUF takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit2
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  call SetHeroInt(Source,GetHeroInt(Source,false)+2,true)
  call TextTagOnUnit("+2 "+GetObjectName('n0JP'),3,Source,.023,0,255,0,230)
  set Source=null
endfunction

function DVF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit WY9=GetTriggerUnit()
  if IsUnitType(WY9,UNIT_TYPE_HERO) and GetUnitTypeId(WY9)!='H00J' and IsUnitIllusion(WY9)==false and IsDead(Source)==false and IsUnitAlly(Source,GetOwningPlayer(WY9))==false then
    if Source==GetKillingUnit()or(GetUnitTypeId(GetKillingUnit())=='e00E' and IsUnitOwnedByPlayer(GetKillingUnit(),GetOwningPlayer(Source))) or IsUnitInRange(Source,WY9,925)then
      set F18[GetPlayerId(GetOwningPlayer(Source))]=F18[GetPlayerId(GetOwningPlayer(Source))]+2
      call TextTagOnUnit("-2 "+GetObjectName('n0JP'),3,WY9,.023,255,0,0,230)
      call SetHeroInt(WY9,GetHeroInt(WY9,false)-2,true)
      call AddProjectile(WY9,Source,'h0CP',"DUF",450,false)
      //elseif IsUnitInRange(Source,WY9,900) then
      //	set F18[GetPlayerId(GetOwningPlayer(Source))]=F18[GetPlayerId(GetOwningPlayer(Source))]+1
      //	call TextTagOnUnit("-1 "+GetObjectName('n0JP'),3,WY9,.023,255,0,0,230)
      //	call SetHeroInt(WY9,GetHeroInt(WY9,false)-1,true)
      //	call AddProjectile(WY9,Source,'h0CP',"DTF",450)
    endif
  endif
  set t=null
  set Source=null
  set WY9=null
  return false
endfunction






function Silencer_Glaives_Stats_Display takes nothing returns boolean
  local player p = GetTriggerPlayer()
  local integer YO8=F18[GetPlayerId(p)]
  
  //if isPlayerPickedAbility(GetTriggerPlayer(),51)and YO8>0 then
  if YO8>0 then
    call DisplayTimedTextToPlayer(p,0,group008,10.,GetObjectName('n0HM')+" "+I2S(YO8))
  endif
  set p=null
  return false
endfunction

function Silencer_Glaives_Stats takes player p returns nothing
  local trigger trig = CreateTrigger()
  
  call TriggerRegisterPlayerChatEvent(trig,p,"-st",true)
  call TriggerRegisterPlayerChatEvent(trig,p,"-stats",true)
  call TriggerAddCondition(trig,Condition(function Silencer_Glaives_Stats_Display))
  
  set trig = null
endfunction

function Silencer_GlaivesOfWisdom_Learn takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function D6F))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(u))
  
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function DVF))
  call SaveUnitHandle(hashtable019,GetHandleId(t),(2),(u))
  
  call Silencer_Glaives_Stats(GetOwningPlayer(u))
  
  set t = null
  set u = null
endfunction

function D1F takes nothing returns boolean
  if GetLearnedSkill()=='A0LZ' and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Silencer_GlaivesOfWisdom_Learn()
  endif
  return false
endfunction

function MZ9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function D1F))
  set t=null
endfunction








function D0F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  if GetTriggerEventId()!=EVENT_UNIT_DEATH and GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT and Count<6then
    set Count=Count+1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)-8*Level)
    call DamageTarget(Source,Target,1,5+15*Level)
  endif
  if Count>=6 or GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()!='A12W' and GetSpellAbilityId()!='A0FO' and GetSpellAbilityId()!='A1MO' and GetSpellAbilityId()!='A1C0' and GetSpellAbilityId()!='A1ZI' and GetSpellAbilityId()!='A28Y' and isDummyAbility(GetSpellAbilityId())==false and(isAintItemAbility(GetSpellAbilityId())or GetSpellAbilityId()=='A06K'))then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call UnitRemoveAbility(Target,'A1PS')
    call UnitRemoveAbility(Target,'B0CQ')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function D5F takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetEnumUnit()
  local integer Level=Silencer_CurseOfSilence_Level//GetUnitAbilityLevel(Source,'A14L')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call UnitAddAbility2(Target,'A1PS')
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function D0F))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareTarget.mdl",Target,"overhead")))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  set Source=null
  set Target=null
  set t=null
endfunction

function Silencer_CurseOfSilence takes nothing returns nothing
  local group g=GetAvailableGroup()
  //local location l=GetSpellTargetLoc()
  set tt_unit1=GetTriggerUnit()
  set F08=GetTriggerUnit()
  call GroupEnumUnitsInRange(g,GetSpellTargetX(),GetSpellTargetY(),375,Condition(function D99))
  set Silencer_CurseOfSilence_Level=GetUnitAbilityLevel(tt_unit1,'A14L')
  call ForGroup(g,function D5F)
  call ZD8("war3mapImported\\CotS.mdx",GetSpellTargetX(),GetSpellTargetY(),5)
  call KillGroup(g)
  //call RemoveLocation(l)
  set g=null
  //set l=null
endfunction

function Silencer_GlobalSilence_Volume takes nothing returns boolean
  call CleanTrigger(GetTriggeringTrigger())
  call VolumeGroupReset()
  return false
endfunction

function Silencer_GlobalSilence_Filter takes nothing returns boolean
  return IsMagicImmune(GetFilterUnit())==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==true and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))
endfunction

function Silencer_GlobalSilence_AghBonus takes nothing returns nothing
  local group g
  local integer l=4
  if l>0 then
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,0,0,9999,Condition(function Silencer_GlobalSilence_Filter))
    set Silencer_CurseOfSilence_Level=4
    call ForGroup(g,function D5F)
    call KillGroup(g)
  endif
  set g=null
endfunction

function Silencer_GlobalSilence_Start takes nothing returns nothing
  local location YT9=GetUnitLoc(GetTriggerUnit())
  local trigger t=CreateTrigger()
  local integer lvl=GetUnitAbilityLevel(GetTriggerUnit(),'A0L3')
  if lvl==0 then
    set lvl=1+GetUnitAbilityLevel(GetTriggerUnit(),'A2QC')
    call Silencer_GlobalSilence_AghBonus()
  endif
  call TriggerRegisterTimerEvent(t,lvl+3,false)
  call TriggerAddCondition(t,Condition(function Silencer_GlobalSilence_Volume))
  call CreateNUnitsAtLoc(1,'e00E',GetOwningPlayer(GetTriggerUnit()),YT9,bj_UNIT_FACING)
  call ShowUnitHide(bj_lastCreatedUnit)
  call UnitApplyTimedLifeBJ(5.,'BTLF',bj_lastCreatedUnit)
  call UnitAddAbility(bj_lastCreatedUnit,'A0L2')
  call SetUnitAbilityLevelSwapped('A0L2',bj_lastCreatedUnit,GetUnitAbilityLevel(GetTriggerUnit(),'A0L3'))
  call IssuePointOrderByIdLoc(bj_lastCreatedUnit,852592,YT9)
  call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_UNITSOUNDS,.0)
  call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_COMBAT,.0)
  call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_SPELLS,.0)
  call VolumeGroupSetVolume(SOUND_VOLUMEGROUP_MUSIC,.0)
  call RemoveLocation(YT9)
  set t=null
  set YT9=null
endfunction

function E7F takes nothing returns boolean
  return GetLearnedSkill()=='A03U' or GetLearnedSkill()=='QP1Q'
endfunction

function Sniper_TakeAim_Learn takes nothing returns nothing
  local unit u = GetTriggerUnit()
  
  call SetUnitAcquireRange(u,GetUnitAcquireRange(u) + 100)
  call SetPlayerTechResearched(GetOwningPlayer(u),'R005',IMaxIF(GetUnitAbilityLevel(u,'A03U'),GetUnitAbilityLevel(u,'QP1Q')))
  
  set u = null
endfunction

function Func2090 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function E7F))
  call TriggerAddAction(t,function Sniper_TakeAim_Learn)
  set t=null
endfunction

function E9F takes nothing returns nothing
  if IsUnitType(GetEnumUnit(),UNIT_TYPE_STRUCTURE)==false then
    call DamageTarget(F58,GetEnumUnit(),1,G48)
    call IssueTargetOrderById(F28,852075,GetEnumUnit())
  else
    call DamageTarget(F58,GetEnumUnit(),1,G48/ 3)
    call IssueTargetOrderById(F28,852075,GetEnumUnit())
  endif
endfunction

function EDF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local group g=GetAvailableGroup()
  local real d
  local real a
  local real x2
  local real y2
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x,y,425,Condition(function LB8))
  set F58=Source
  set G48=Level*12
  set F28=Caster
  call ForGroup(g,function E9F)
  call KillGroup(g)
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(309))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(177))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(178))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(179))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(180))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(330))))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(331))))
  if GetTriggerEvalCount(t)==10 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set d=0
    set a=0
    set x2=x+d*Cos(a*bj_DEGTORAD)
    set y2=y+d*Sin(a*bj_DEGTORAD)
    call SaveEffectHandle(hashtable019,(Cache),(309),(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x2,y2)))
    set d=150
    set a=45
    set x2=x+d*Cos(a*bj_DEGTORAD)
    set y2=y+d*Sin(a*bj_DEGTORAD)
    call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x2,y2)))
    set d=275
    set a=90
    set x2=x+d*Cos(a*bj_DEGTORAD)
    set y2=y+d*Sin(a*bj_DEGTORAD)
    call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x2,y2)))
    set d=150
    set a=135
    set x2=x+d*Cos(a*bj_DEGTORAD)
    set y2=y+d*Sin(a*bj_DEGTORAD)
    call SaveEffectHandle(hashtable019,(Cache),(177),(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x2,y2)))
    set d=275
    set a=180
    set x2=x+d*Cos(a*bj_DEGTORAD)
    set y2=y+d*Sin(a*bj_DEGTORAD)
    call SaveEffectHandle(hashtable019,(Cache),(178),(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x2,y2)))
    set d=150
    set a=225
    set x2=x+d*Cos(a*bj_DEGTORAD)
    set y2=y+d*Sin(a*bj_DEGTORAD)
    call SaveEffectHandle(hashtable019,(Cache),(179),(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x2,y2)))
    set d=275
    set a=270
    set x2=x+d*Cos(a*bj_DEGTORAD)
    set y2=y+d*Sin(a*bj_DEGTORAD)
    call SaveEffectHandle(hashtable019,(Cache),(180),(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x2,y2)))
    set d=150
    set a=305
    set x2=x+d*Cos(a*bj_DEGTORAD)
    set y2=y+d*Sin(a*bj_DEGTORAD)
    call SaveEffectHandle(hashtable019,(Cache),(330),(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x2,y2)))
    set d=275
    set a=360
    set x2=x+d*Cos(a*bj_DEGTORAD)
    set y2=y+d*Sin(a*bj_DEGTORAD)
    call SaveEffectHandle(hashtable019,(Cache),(331),(AddSpecialEffect("Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl",x2,y2)))
  endif
  set t=null
  set Source=null
  set Caster=null
  set g=null
  return false
endfunction

function EEF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=GetUnitAbilityLevel(Source,'A064')
  local real x1=(LoadReal(hashtable019,(Cache),(6)))
  local real y1=(LoadReal(hashtable019,(Cache),(7)))
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x1,y1,0)
  local real x2
  local real y2
  local real d
  local real a
  local integer i
  call UnitAddAbility2(Caster,'A19F')
  call SetUnitAbilityLevel(Caster,'A19F',Level)
  if GetTriggerEvalCount(t)==1 then
    set i=1
    loop
      exitwhen i>10
      set d=GetRandomReal(0,450)
      set a=GetRandomReal(0,360)
      set x2=x1+d*Cos(a*bj_DEGTORAD)
      set y2=y1+d*Sin(a*bj_DEGTORAD)
      set Caster=CreateUnit(GetOwningPlayer(Source),'e00J',GetUnitX(Source),GetUnitY(Source),90)
      call IssuePointOrderById(Caster,851984,x2,y2)
      call UnitApplyTimedLife(Caster,'BTLF',.5)
      set i=i+1
    endloop
  else
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
    call SaveReal(hashtable019,(Cache),(6),((x1)*1.))
    call SaveReal(hashtable019,(Cache),(7),((y1)*1.))
    call SaveInteger(hashtable019,(Cache),(5),(Level))
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function EDF))
    call TriggerEvaluate(t)
  endif
  set Source=null
  set Caster=null
  set t=null
  return false
endfunction

function Sniper_Shrapnel takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  
  call TimedReveal(GetOwningPlayer(Source),9.4,x,y,400)
  call TriggerRegisterTimerEvent(t,.4,true)
  call TriggerAddCondition(t,Condition(function EEF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  
  set t=null
  set Source=null
endfunction

function MB9 takes nothing returns nothing
  call PreloadAbility('A19F')
endfunction


function EHF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local effect FX=(LoadEffectHandle(hashtable019,(Cache),(32)))
  local player p=GetOwningPlayer(Hero)
  //call UnitShareVision(Target,p,false)
  call DestroyEffect(FX)
  call RemoveUnit(Caster)
  call UnitRemoveAbility(Target,'B06H')
  call UnitRemoveAbility(Target,'A313')
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  set Caster=null
  set Target=null
  set FX=null
  set p=null
  return false
endfunction

function EIF takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local player p=GetOwningPlayer(Hero)
  local unit Caster
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local string s="effects\\Snipe Target.mdx"
  if IsPlayerAlly(GetLocalPlayer(),p)==false and IsObserver(GetLocalPlayer())==false then
    set s=""
  endif
  //call UnitShareVision(Target,p,true)
  call UnitAddAbility2(Target,'A313')
  call ShareVision(Target,Hero,'A313')
  set Caster=CreateUnit(GetOwningPlayer(Target),'e01R',0,0,0)
  call UnitAddAbility2(Caster,'A0NI')
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget(s,Target,"overhead")))
  call TriggerRegisterTimerEvent(t,4,false)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerAddCondition(t,Condition(function EHF))
  set t=null
  set Hero=null
  set Target=null
  set Caster=null
  set p=null
endfunction

function EJF takes nothing returns boolean
  if GetSpellAbilityId()=='A04P' or GetSpellAbilityId()=='A1AU' then
    call EIF()
  endif
  return false
endfunction

function MC9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CHANNEL)
  call TriggerAddCondition(t,Condition(function EJF))
  set t=null
endfunction

function Riki_SmokeScreen takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e003',x,y,0)
  local integer Level=GetUnitAbilityLevel(Hero,'A0RG')
  local real EMF=(83+17*Level)*.01
  call SetUnitVertexColor(Caster,255,255,255,150)
  call UnitApplyTimedLife(Caster,'BTLF',6)
  call SetUnitScale(Caster,EMF,EMF,EMF)
  if IsScourge(GetOwningPlayer(Hero))then
    call UnitAddAbility2(Caster,'A019')
    call SetUnitAbilityLevel(Caster,'A019',Level)
  else
    call UnitAddAbility2(Caster,'A0E7')
    call SetUnitAbilityLevel(Caster,'A0E7',Level)
  endif
  call IssuePointOrderById(Caster,852473,x,y)
  //call RemoveLocation(l)
  set Hero=null
  //set l=null
  set Caster=null
endfunction

function Riki_PermanentInvisibility_Check takes nothing returns boolean
  return GetLearnedSkill()=='A00J' and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function Riki_PermanentInvisibility_Leveling takes nothing returns nothing
  if(GetUnitAbilityLevel(GetTriggerUnit(),'A0MB')==0)then
    call UnitAddAbility2(GetTriggerUnit(),'A0MB')
  endif
  call SetUnitAbilityLevel(GetTriggerUnit(),'A0MB',GetUnitAbilityLevel(GetTriggerUnit(),'A00J'))
endfunction

function Riki_PermanentInvisibility_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Riki_PermanentInvisibility_Check))
  call TriggerAddAction(t,function Riki_PermanentInvisibility_Leveling)
  set t=null
endfunction

function Riki_BlinkStrike takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real Damage=30*GetUnitAbilityLevel(Source,'A0K9')
  local trigger t
  local integer Cache
  local real x=GetUnitX(Target)-75*Cos(GetUnitFacing(Target)*bj_DEGTORAD)
  local real y=GetUnitY(Target)-75*Sin(GetUnitFacing(Target)*bj_DEGTORAD)
  call SetUnitX(Source,x)
  call SetUnitY(Source,y)
  call SetUnitFacing(Source,GetUnitFacing(Target))
  call DestroyEffect(AddSpecialEffect("war3mapImported\\BlinkStrike.mdx",x,y))
  if IsUnitEnemy(Target,GetOwningPlayer(Source))then
    call DamageTarget(Source,Target,1,Damage)
    call SaveBoolean(hashtable019,(GetHandleId(Source)),(332),(true))
    call IssueTargetOrderById(Source,851983,Target)
  endif
  set Source=null
  set Target=null
  set t=null
endfunction

function Rikimaru_BlinkStrike_OnCast takes nothing returns nothing
  call DestroyEffect(AddSpecialEffect("war3mapImported\\BlinkStrike.mdx",GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit())))
endfunction

function Riki_PermanentInvis_Periodic takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u
  local integer i
  if GetTriggerEventId()==EVENT_UNIT_SPELL_CAST  then
    if GetSpellAbilityId()=='A0K9' then
      call SaveReal(HeroStats,GetHandleId(GetTriggerUnit()),23,TimerGetElapsed(GlobalTimer)+4-GetUnitAbilityLevel(GetTriggerUnit(),'A00J'))
      call SaveBoolean(HeroStats,GetHandleId(GetTriggerUnit()),23,false)
      //call BJDebugMsg("invis will be added @: "+R2S(TimerGetElapsed(GlobalTimer)+4-GetUnitAbilityLevel(GetTriggerUnit(),'A00J')))
      if GetUnitAbilityLevel(GetTriggerUnit(),'A30F')>0 then
        call UnitRemoveAbility(GetTriggerUnit(),'A30F')
        set i=GetUnitAbilityLevel(GetTriggerUnit(),'A00J')
        call UnitRemoveAbility(GetTriggerUnit(),'A00J')
        call UnitAddAbility2(GetTriggerUnit(),'A00J')
        call SetUnitAbilityLevel(GetTriggerUnit(),'A00J',i)
      endif
    endif
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetAttacker()==LoadUnitHandle(MHT,h,0) then
      call SaveReal(HeroStats,GetHandleId(GetAttacker()),23,TimerGetElapsed(GlobalTimer)+4-GetUnitAbilityLevel(GetAttacker(),'A00J'))
      //call BJDebugMsg("invis will be added @: "+R2S(TimerGetElapsed(GlobalTimer)+4-GetUnitAbilityLevel(GetAttacker(),'A00J')))
      call SaveBoolean(HeroStats,GetHandleId(GetAttacker()),23,false)
      if GetUnitAbilityLevel(GetAttacker(),'A30F')>0 then
        call UnitRemoveAbility(GetAttacker(),'A30F')
        set i=GetUnitAbilityLevel(GetAttacker(),'A00J')
        call UnitRemoveAbility(GetAttacker(),'A00J')
        call UnitAddAbility2(GetAttacker(),'A00J')
        call SetUnitAbilityLevel(GetAttacker(),'A00J',i)
      endif
    endif
  else
    set u=LoadUnitHandle(MHT,h,0)
    if GetUnitTypeId(u)==0 then//unit doesnt exist
      call FlushChildHashtable(HeroStats,GetHandleId(u))
      call FlushChildHashtable(MHT,h)
      call CleanTrigger(t)
    else
      
      if (LoadBoolean(HeroStats,GetHandleId(u),23) or LoadReal(HeroStats,GetHandleId(u),23)<TimerGetElapsed(GlobalTimer)) and GetUnitAbilityLevel(u,'A30F')==0 then
        //call BJDebugMsg("invisadded: "+R2S(TimerGetElapsed(GlobalTimer)))
        call UnitAddAbility2(u,'A30F')
      endif
      
    endif
  endif
  set t=null
  set u=null
endfunction

function Riki_PermanentInvis_Learnd takes nothing returns nothing
  local unit u
  local trigger t
  local integer h
  if not Mode_BO then
    return
  endif
  set u=GetTriggerUnit()
  set t=CreateTrigger()
  set h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.2,true)
  call SaveUnitHandle(MHT,h,0,u)
  call SaveBoolean(HeroStats,GetHandleId(u),23,true)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function Riki_PermanentInvis_Periodic))
  set u=null
  set t=null
endfunction

function Riki_PermanentInvis_Check takes nothing returns nothing
  if (GetLearnedSkill()=='QP08' or GetLearnedSkill()=='A0MB') and GetLearnedSkillLevel()==1 then
    call Riki_PermanentInvis_Learnd()
  endif
endfunction

function Riki_PermanentInvis_Init takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Riki_PermanentInvis_Check))
  set t=null
endfunction



function Sven_Warcry_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer i = LoadInteger(MHT,info,0)
  local integer loopA = LoadInteger(MHT,info,1)
  local group g = LoadGroupHandle(MHT,info,0)
  local unit u = FirstOfGroup(g)
  
  loop
    exitwhen u==null
    set loopA = loopA - 1
    call LoDStat_Sub(u,i,"armour")
    call DestroyEffect(LoadEffectHandle(MHT,info,loopA))
    call GroupRemoveUnit(g,u)
    set u = FirstOfGroup(g)
  endloop
  
  call Timer_End(t)
  set g = null
  set u=null
  set t = null
endfunction

function Sven_Warcry_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if IsDead(t)==false and GetUnitAbilityLevel(t,'A04R')==0 and IsUnitAlly(group_temp_unit[0],GetOwningPlayer(t)) and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false then
    call LoDStat_Add(t,group_temp_integer[0],"armour")
    call Buff_Add(t,LoDBuff_AbilID[25],LoDBuff_BuffID[25],7)
    
    call GroupAddUnit(LoadGroupHandle(MHT,99999,99999),t)
    call SaveEffectHandle(MHT,group_temp_integer[1],group_temp_integer[2],AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl",t,"chest"))
    set group_temp_integer[2] = group_temp_integer[2] + 1
  endif
  set t = null
  return false
endfunction

function Sven_Warcry_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit  u = GetTriggerUnit()
  local group g = GetAvailableGroup() //backwards gut! :O
  local integer info = GetHandleId(t)
  
  set group_temp_unit[0] = u
  set group_temp_integer[0] = GetUnitAbilityLevel(u,'A2IS')*4
  set group_temp_integer[1] = info
  set group_temp_integer[2] = 1
  call SaveGroupHandle(MHT,99999,99999,g)
  
  call GroupEnumUnitsInRange(temp_group,GetWidgetX(u),GetWidgetY(u),925,Condition(function Sven_Warcry_Targets))
  
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl",u,"overhead"))
  
  call SaveGroupHandle(MHT,info,0,g)
  call SaveInteger(MHT,info,0,group_temp_integer[0])
  call SaveInteger(MHT,info,1,group_temp_integer[2])
  call TimerStart(t,7,false,function Sven_Warcry_End)
  set t=null
  set u = null
  set g=null
endfunction





function EZF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  if GetTriggerEventId()!=EVENT_PLAYER_UNIT_SPELL_EFFECT then
    set Count=Count+1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
  endif
  if(GetTriggerEventId()!=EVENT_PLAYER_UNIT_SPELL_EFFECT and Count>1)or(GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT and EF9(GetSpellAbilityId())and GetSpellTargetUnit()==Hero)then
    if(GetTriggerEventId()!=EVENT_PLAYER_UNIT_SPELL_EFFECT and Count>1)then
      if IsDead(Hero)==false then
        call UnitRemoveAbility(Hero,'A0WO')
        call UnitRemoveAbility(Hero,'B009')
        call UnitRemoveAbility(Hero,'B0DP')
      endif
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  elseif GetTriggerEventId()!=EVENT_PLAYER_UNIT_SPELL_EFFECT then
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\BattleCryCaster.mdx",Hero,"overhead"))
    call UnitAddAbility2(Hero,'A0WO')
    call SetUnitAbilityLevel(Hero,'A0WO',GetUnitAbilityLevel(Hero,'A0WP'))
    call UnitMakeAbilityPermanent(Hero,true,'A0WM')
    call UnitMakeAbilityPermanent(Hero,true,'A0WN')
    call UnitMakeAbilityPermanent(Hero,true,'A0WI')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A0WO',false)
  endif
  set t=null
  set Hero=null
  return false
endfunction

function Sven_GodStrenght takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  call TriggerRegisterTimerEvent(t,25,false)
  call TriggerRegisterTimerEvent(t,.31,false)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function EZF))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  set t=null
  set Hero=null
endfunction

function ECF takes nothing returns nothing
  local unit u = GetEnumUnit()
  
  if IsUnitVisibleLoD(u,group_temp_player)==IsUnitInvisible(u,group_temp_player)==false then
    call UnitShareVision(u,group_temp_player,true)
    call IssueTargetOrderById(G88,852095,GetEnumUnit())
    call UnitShareVision(u,group_temp_player,false)
  else
    call IssueTargetOrderById(G88,852095,GetEnumUnit())
  endif
  
  set u = null
endfunction

function E3F takes player p,unit Target,integer Level returns nothing
  local unit Caster=CreateUnit(p,'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local integer AF8
  local group g=GetAvailableGroup()
  call UnitAddAbility2(Caster,'A0RZ')
  call SetUnitAbilityLevel(Caster,'A0RZ',Level)
  set tt_unit1=udg_Hero[GetPlayerId(p)]
  call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),280,Condition(function DefaultEnemyFilter))
  call GroupAddUnit(g,Target)
  set G88=Caster
  set group_temp_unit[0] = Target
  set group_temp_player = p
  call ForGroup(g,function ECF)
  //call UnitShareVision(Target,p,false)
  call KillGroup(g)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\StormBolt\\StormBoltMissile.mdl",Target,"origin"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\StormBolt\\StormBoltMissile.mdl",Target,"origin"))
  set Caster=null
  set g=null
endfunction

function E6F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local player p
  local integer XK8
  local unit Target
  local integer Level
  local unit Projectile
  local real x
  local real y
  local real TargetX
  local real TargetY
  local boolean blinked
  local real lastX
  local real lastY
  local real AM8
  local real AN8
  local real AO8
  local real AP8
  local boolean DCD
  
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if IsDisjointSpell(GetSpellAbilityId()) then
      call SaveBoolean(hashtable019,Cache,0,true)
      call SaveReal(hashtable019,Cache,0,GetUnitX(GetTriggerUnit()))
      call SaveReal(hashtable019,Cache,1,GetUnitY(GetTriggerUnit()))
    endif
  else
    set p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
    set XK8=(LoadInteger(hashtable019,(Cache),(30)))
    set Target=UnitAsInteger_Load(XK8)
    set Level=(LoadInteger(hashtable019,(Cache),(5)))
    set Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
    set x=GetUnitX(Projectile)
    set y=GetUnitY(Projectile)
    set TargetX=GetUnitX(Target)
    set TargetY=GetUnitY(Target)
    set blinked=LoadBoolean(hashtable019,Cache,0)
    set lastX=LoadReal(hashtable019,Cache,0)
    set lastY=LoadReal(hashtable019,Cache,1)
    set AM8=1000*.035
    if blinked then
      set TargetX=lastX
      set TargetY=lastY
    endif
    set AN8=AngleBetweenXY(x,y,TargetX,TargetY)
    set AO8=x+AM8*Cos(AN8*bj_DEGTORAD)
    set AP8=y+AM8*Sin(AN8*bj_DEGTORAD)
    set DCD=(LoadBoolean(hashtable019,(Cache),(249)))
    
    
    call SetUnitX(Projectile,AO8)
    call SetUnitY(Projectile,AP8)
    call SetUnitFacing(Projectile,AN8)
    if DistanceBetweenXY(TargetX,TargetY,AO8,AP8)<=AM8 then
      if blinked==false then
        if DCD then
          call E3F(p,Target,Level)
        endif
      endif
      call KillUnit(Projectile)
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set Target=null
  set Projectile=null
  set p=null
  return false
endfunction

function Sven_StormBolt takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A190')
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=CreateUnit(GetOwningPlayer(Source),'h07Q',GetUnitX(Source),GetUnitY(Source),AngleBetweenXY(GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target)))
  local boolean DCD=IsBlocked(GetSpellTargetUnit())==false
  call SaveBoolean(hashtable019,(Cache),(249),(DCD))
  call SavePlayerHandle(hashtable019,(Cache),(54),(GetOwningPlayer(Source)))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveBoolean(hashtable019,Cache,0,false)//is blinked?
  call SaveReal(hashtable019,Cache,0,0)//last time visible X
  call SaveReal(hashtable019,Cache,1,0)//last time visible Y
  call TriggerRegisterTimerEvent(t,.035,true)
  call TriggerAddCondition(t,Condition(function E6F))
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_SPELL_EFFECT)
  set t=null
  set Source=null
  set Target=null
  set Projectile=null
endfunction

function Sven_StormBolt_OnCast takes nothing returns nothing
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",GetTriggerUnit(),GetProperAttachPoint_Weapon(GetTriggerUnit())))
endfunction

function E0F takes nothing returns boolean
  return(GetUnitTypeId(GetFilterUnit())=='n01G')or(GetUnitTypeId(GetFilterUnit())=='n01C')or(GetUnitTypeId(GetFilterUnit())=='n018')or(GetUnitTypeId(GetFilterUnit())=='n004')
endfunction

function LoneDruid_Rabid takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit u
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
  local integer Level=GetUnitAbilityLevel(Source,GetSpellAbilityId())
  local group g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,GetOwningPlayer(Source),Condition(function E0F))
  set u=FirstOfGroup(g)
  call KillGroup(g)
  if GetSpellAbilityId()=='A1EF' then
    call UnitAddAbility2(Caster,'A0AA')
    call SetUnitAbilityLevel(Caster,'A0AA',Level)
  elseif GetSpellAbilityId()=='A1EE' then
    call UnitAddAbility2(Caster,'A0AB')
    call SetUnitAbilityLevel(Caster,'A0AB',Level)
  elseif GetSpellAbilityId()=='A1EH' then
    call UnitAddAbility2(Caster,'A0AC')
    call SetUnitAbilityLevel(Caster,'A0AC',Level)
  elseif GetSpellAbilityId()=='A1EI' then
    call UnitAddAbility2(Caster,'A0AD')
    call SetUnitAbilityLevel(Caster,'A0AD',Level)
  elseif GetSpellAbilityId()=='A1EG' then
    call UnitAddAbility2(Caster,'A0AE')
    call SetUnitAbilityLevel(Caster,'A0AE',Level)
  endif
  call IssueTargetOrderById(Caster,852101,Source)
  if u!=null and IsDead(u)==false then
    call IssueTargetOrderById(Caster,852101,u)
  endif
  set g=null
  set Source=null
  set u=null
  set Caster=null
endfunction

function F4F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,2)
  local real F7F
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamage()>2 and GetEventDamageSource()!=GetTriggerUnit()and IsPlayerBelongToTeams(GetOwningPlayer(GetEventDamageSource()))then
      call SaveReal(hashtable019,h,714,TimerGetElapsed(GlobalTimer)*1.)
    endif
  endif
  set F7F=LoadReal(hashtable019,h,714)
  if F7F+3 < TimerGetElapsed(GlobalTimer)then
    if(LoadInteger(hashtable019,h,34))==2 then
      call SaveInteger(hashtable019,h,34,1)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A0A7',true)
    endif
  else
    if(LoadInteger(hashtable019,h,34))==1 then
      call SaveInteger(hashtable019,h,34,2)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A0A7',false)
    endif
  endif
  set t=null
  set u=null
  return false
endfunction

function F8F takes unit DKD returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.2,true)
  call TriggerRegisterUnitEvent(t,DKD,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,DKD,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function F4F))
  call SaveUnitHandle(hashtable019,h,2,DKD)
  call SaveReal(hashtable019,h,714,0.)
  call SaveInteger(hashtable019,h,34,1)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(DKD),'A0A7',true)
  set t=null
endfunction

function F9F takes nothing returns boolean
  return((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and GetUnitAbilityLevel(GetFilterUnit(),'B0C1')>0)!=null
endfunction

function FDF takes nothing returns nothing
  call DamageTarget(G98,GetEnumUnit(),2,30)
endfunction

function FEF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit DKD=(LoadUnitHandle(hashtable019,(Cache),(53)))
  local group g=GetAvailableGroup()
  set tt_unit1=DKD
  set G98=DKD
  call GroupEnumUnitsInRange(g,GetUnitX(DKD),GetUnitY(DKD),2000,Condition(function F9F))
  call ForGroup(g,function FDF)
  call KillGroup(g)
  set t=null
  set g=null
  set DKD=null
  return false
endfunction

function FFF takes nothing returns nothing
  local unit DKD=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function FEF))
  call SaveUnitHandle(hashtable019,(Cache),(53),(DKD))
  set DKD=null
  set t=null
endfunction



function EnsnareTarget takes unit owner, unit target returns nothing
  local unit d=CreateUnit(GetOwningPlayer(owner),'e00E',GetUnitX(target),GetUnitY(target),0)
  call UnitAddAbility(d,'A1GZ')
  call IssueTargetOrder(d,"ensnare",target)
  set d=null
endfunction

function SpiritBearDamage takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u
  local unit a
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    set a=LoadUnitHandle(hashtable019,h,0)
    if(GetEventDamageSource()==a)then
      //call echo("damage pass")
      if TimerGetElapsed(GlobalTimer)>LoadReal(MHT,GetHandleId(a),'A33C') then
        //call echo("not in cd")
        if PRD_Get(a,'A33C',20) then
          //call echo("chance go!")
          call SaveReal(MHT,GetHandleId(a),'A33C',TimerGetElapsed(GlobalTimer)+5)
          call EnsnareTarget(a,GetTriggerUnit())
        endif
      endif
      call SaveBoolean(MHT,GetHandleId(a),'RTEB',false)
      call FlushChildHashtable(hashtable019,h)
      call CleanTrigger(t)
    endif
  else
    //call echo("timeout, clean")
    call SaveBoolean(MHT,GetHandleId(LoadUnitHandle(hashtable019,h,0)),'RTEB',false)
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  endif
  set t=null
  set a=null
  set u=null
endfunction

function SpiritBearAttack takes nothing returns nothing
  local unit a=GetAttacker()
  local trigger t
  local integer h
  if IsSpiritBear(a) and DistanceBetweenXY(GetUnitX(a),GetUnitY(a),GetUnitX(udg_Hero[GetPlayerId(GetOwningPlayer(a))]),GetUnitY(udg_Hero[GetPlayerId(GetOwningPlayer(a))]))<1100 and GetUnitAbilityLevel(a,'A33C')>0 and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false then
    //call echo("bear attack")
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,4,false)
    call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
    call SaveUnitHandle(hashtable019,h,0,a)
    call TriggerAddCondition(t,Condition(function SpiritBearDamage))
    if LoadBoolean(MHT,GetHandleId(a),'RTEB') then
      call FlushChildHashtable(hashtable019,GetHandleId(LoadTriggerHandle(MHT,GetHandleId(a),'RTEB')))
      call CleanTrigger(LoadTriggerHandle(MHT,GetHandleId(a),'RTEB'))
      //call echo("trigger exist, remove")
    endif
    call SaveBoolean(MHT,GetHandleId(a),'RTEB',true)
    call SaveTriggerHandle(MHT,GetHandleId(a),'RTEB',t)
    set t=null
  endif
  set a=null
endfunction

function FFFfix takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function SpiritBearAttack))
  set t=null
  //call echo("created")
endfunction

function FGF takes nothing returns boolean
  return GetLearnedSkill()=='A0A5' and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function FHF takes nothing returns boolean
  return IsDead(GetFilterUnit())==false and (GetUnitTypeId(GetFilterUnit())=='n01C' or GetUnitTypeId(GetFilterUnit())=='n018' or GetUnitTypeId(GetFilterUnit())=='n004')
endfunction

function FIF takes nothing returns nothing
  local integer h=GetHandleId(GetOwningPlayer(GetTriggerUnit()))
  local unit u=LoadUnitHandle(hashtable019,h,334)
  local unit new=LoadUnitHandle(hashtable019,h,333)
  if u!=null and Mode_DM==false then
    call UnitAddItem(new,UnitRemoveItemFromSlot(u,0))
    call UnitAddItem(new,UnitRemoveItemFromSlot(u,1))
    call UnitAddItem(new,UnitRemoveItemFromSlot(u,2))
    call UnitAddItem(new,UnitRemoveItemFromSlot(u,3))
    call UnitAddItem(new,UnitRemoveItemFromSlot(u,4))
    call UnitAddItem(new,UnitRemoveItemFromSlot(u,5))
  endif
  set u=null
  set new=null
endfunction

function LoneDruid_SpiritBear_Leveling takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local player p=GetOwningPlayer(u)
  local group g
  local integer Level=GetUnitAbilityLevel(u,'A0A5')
  local integer i
  local unit Bear
  call SetPlayerTechResearched(GetOwningPlayer(GetTriggerUnit()),'R000',Level)
  if(Level==1)then
    call FFF()
    call FFFfix()
  else
    set g=GetAvailableGroup()
    call GroupEnumUnitsOfPlayer(g,GetOwningPlayer(u),Condition(function FHF))
    set i=CountUnitsInGroup(g)
    if(i==1)then
      set Bear=FirstOfGroup(g)
      call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",Bear,"chest")
      if(Level==2)then
        call G89(Bear,400)
        call UnitAddAbility2(Bear,'A0A7')
        call F8F(Bear)
      elseif(Level==3)then
        call G89(Bear,900)
        call UnitAddAbility2(Bear,'A09Y')
      elseif(Level==4)then
        call G89(Bear,1300)
        call UnitAddAbility2(Bear,'A03A')
        call UnitAddAbility2(Bear,'A0AH')
      endif
    endif
    call KillGroup(g)
  endif
  
  set g=null
  set u=null
  set Bear=null
endfunction

function N79 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function FGF))
  call TriggerAddAction(t,function LoneDruid_SpiritBear_Leveling)
  set t=null
endfunction

function AZ3 takes nothing returns boolean
  return GetLearnedSkill()=='A0A8' and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function FOF takes nothing returns boolean
  return IsSpiritBear(GetFilterUnit()) and IsDead(GetFilterUnit())==false
endfunction

function LoneDruid_SpiritBear takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local player p=GetOwningPlayer(u)
  local real x=GetUnitX(u)
  local real y=GetUnitY(u)
  local group g=GetAvailableGroup()
  local integer Level=GetUnitAbilityLevel(u,'A0A5')
  local integer h=GetHandleId(p)
  local unit bear
  local integer id=0
  call GroupEnumUnitsOfPlayer(g,GetOwningPlayer(u),Condition(function FOF))
  if FirstOfGroup(g)==null then
    if(Level==1)then
      set id='n004'
    elseif(Level==2)then
      set id='n018'
    elseif(Level==3)then
      set id='n01C'
    else
      set id='n01G'
    endif
    set bear=CreateUnit(GetOwningPlayer(u),id,x,y,GetUnitFacing(u))
    call SaveUnitHandle(hashtable019,h,333,bear)
    call FIF()
    call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",bear,"chest")
    call F8F(bear)
    call SetUnitAbilityLevel(bear,'A09Y',Level)
  else
    set bear=FirstOfGroup(g)
    call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",bear,"chest")
    call SetUnitState(bear,UNIT_STATE_LIFE,GetUnitState(bear,UNIT_STATE_MAX_LIFE))
    call SetUnitPosition(bear,GetUnitX(u),GetUnitY(u))
  endif
  set bear=null
  call KillGroup(g)
  set u=null
  set g=null
endfunction

function Trig_Summon_Spirit_Bear_PreActions takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local player p=GetOwningPlayer(XX8)
  local location YT9=GetUnitLoc(XX8)
  local boolexpr VH9=Condition(function FOF)
  local group HQ9=GetAvailableGroup()
  local integer Level=GetUnitAbilityLevel(XX8,'A0A5')
  local integer Cache=GetHandleId(p)
  local boolean FQF
  call GroupEnumUnitsOfPlayer(HQ9,GetOwningPlayer(XX8),VH9)
  set FQF=CountUnitsInGroup(HQ9)==0
  if FQF==false then
    call InterruptUnit(XX8)
    call Error(p,GetObjectName('n03M'))
  endif
  call KillGroup(HQ9)
  call RemoveLocation(YT9)
  set YT9=null
  set XX8=null
  set p=null
  set VH9=null
  set HQ9=null
endfunction

function LoneDruid_TrueForm takes nothing returns nothing
  //if GetSpellAbilityId()=='A0AG' then
  
  call SetPlayerTechResearched(GetOwningPlayer(GetTriggerUnit()),'R001',(GetUnitAbilityLevel(GetTriggerUnit(),GetSpellAbilityId())+1))
  if GetUnitTypeId(GetTriggerUnit())!='N015' and GetUnitTypeId(GetTriggerUnit())!='N014' and GetUnitTypeId(GetTriggerUnit())!='N013' then
    call SetPlayerAbilityAvailable(GetOwningPlayer(GetTriggerUnit()),'A344',true)
  else
    call SetPlayerAbilityAvailable(GetOwningPlayer(GetTriggerUnit()),'A344',false)
  endif
  call SetUnitAbilityLevel(GetTriggerUnit(),'A344',GetUnitAbilityLevel(GetTriggerUnit(),GetSpellAbilityId()))
  //endif
endfunction

function TrueForm_BattleRoar takes nothing returns nothing
  local unit d=CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E',GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),0)
  call UnitAddAbility(d,'A1ED')
  call SetUnitAbilityLevel(d,'A1ED',GetUnitAbilityLevel(GetTriggerUnit(),'A344'))
  call IssueImmediateOrder(d,"battleroar")
  set d=null
endfunction

function FSF takes nothing returns boolean
  return GetSpellAbilityId()=='A0A7'
endfunction

function LoneDruid_Return takes nothing returns nothing
  local unit DKD=GetTriggerUnit()
  local unit DMD=udg_Hero[GetPlayerId(GetOwningPlayer(DKD))]
  call SetUnitX(DKD,GetUnitX(DMD)+GetRandomReal(25,50)*Cos(GetRandomReal(0,360)))
  call SetUnitY(DKD,GetUnitY(DMD)+GetRandomReal(25,50)*Sin(GetRandomReal(0,360)))
  set DKD=null
  set DMD=null
endfunction

function N49 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function FSF))
  call TriggerAddAction(t,function LoneDruid_Return)
  set t=null
endfunction

function FUF takes nothing returns boolean
  local integer PlayerId=GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
  return GetTriggerUnit()==udg_Hero[PlayerId] and isPlayerPickedAbility(Player(PlayerId),37)
endfunction

function FVF takes nothing returns nothing
  local unit DKD=LoadUnitHandle(hashtable019,GetHandleId(GetOwningPlayer(GetTriggerUnit())),333)
  call KillUnit(DKD)
  set DKD=null
endfunction

function ND9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function FUF))
  call TriggerAddAction(t,function FVF)
  set t=null
endfunction

function FWF takes nothing returns boolean
  return GetUnitTypeId(GetAttacker())=='n01G' or GetUnitTypeId(GetAttacker())=='n01C' or GetUnitTypeId(GetAttacker())=='n018' or GetUnitTypeId(GetAttacker())=='n004'
endfunction

function FXF takes nothing returns nothing
  local unit DKD=GetAttacker()
  local unit DMD=udg_Hero[GetPlayerId(GetOwningPlayer(DKD))]
  if((GetUnitX(DMD)-GetUnitX(DKD))*(GetUnitX(DMD)-GetUnitX(DKD))+(GetUnitY(DMD)-GetUnitY(DKD))*(GetUnitY(DMD)-GetUnitY(DKD))>=(1100*1100))then
    call IssueImmediateOrderById(DKD,851972)
  endif
  set DKD=null
  set DMD=null
endfunction

function Func4432 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function FWF))
  call TriggerAddAction(t,function FXF)
  set t=null
endfunction

function FYF takes nothing returns boolean
  return(GetUnitTypeId(GetTriggerUnit())=='n01G' or GetUnitTypeId(GetTriggerUnit())=='n01C' or GetUnitTypeId(GetTriggerUnit())=='n018' or GetUnitTypeId(GetTriggerUnit())=='n004')and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function FZF takes nothing returns nothing
  local location WQ9
  if IsSentinel(GetOwningPlayer(GetTriggerUnit()))then
    set WQ9=GetRectCenter(gg_rct_Hero_Creation_NE)
  else
    set WQ9=GetRectCenter(gg_rct_Hero_Creation_UD)
  endif
  if FF9(GetEnumItem())==false then
    call SetItemPositionLoc(GetEnumItem(),WQ9)
    //call SetItemInvulnerable(GetEnumItem(),true)
  endif
  call RemoveLocation(WQ9)
  set WQ9=null
endfunction

function FAF takes nothing returns nothing
  local integer Cache=GetHandleId(GetOwningPlayer(GetTriggerUnit()))
  local unit FJF=LoadUnitHandle(hashtable019,Cache,334)
  local unit DKD=LoadUnitHandle(hashtable019,Cache,333)
  local integer x
  local integer y
  if FJF==null then
    if IsSentinel(GetOwningPlayer(DKD))then
      set x=-6390
      set y=-5615
    else
      set x=5875
      set y=5000
    endif
    set FJF=CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e01F',x,y,0)
    call SaveUnitHandle(hashtable019,(Cache),(334),(FJF))
  endif
  if FF9(GetEnumItem())==false then
    call UnitAddItem(FJF,GetEnumItem())
  endif
  call ShowUnit(FJF,true)
  set FJF=null
  set DKD=null
endfunction

function FBF takes nothing returns nothing
  local integer indexId=GetIndex(GetEnumItem())
  if GetWidgetLife(GetEnumItem())>0 and indexId!=indexid_Aegis then
    if Mode_DM then
      call FZF()
    else
      call FAF()
    endif
  endif
endfunction

function FCF takes nothing returns nothing
  local location YT9=GetUnitLoc(GetTriggerUnit())
  local rect F3F=RectFromCenterSizeBJ(YT9,400.,400.)
  local unit DMD=udg_Hero[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]
  call SetHeroXP(DMD,(GetHeroXP(DMD)-(GetHeroXP(DMD)/(125-(25*GetUnitAbilityLevel(DMD,'A0A5'))))),false)
  call DamageTarget(GetKillingUnit(),DMD,5,100.*I2R(GetUnitAbilityLevel(DMD,'A0A5')))
  call EnumItemsInRectBJ(F3F,function FBF)
  call RemoveLocation(YT9)
  call RemoveRect(F3F)
  set YT9=null
  set F3F=null
  set DMD=null
endfunction

function N99 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function FYF))
  call TriggerAddAction(t,function FCF)
  set t=null
endfunction

function StunFor05 takes unit u returns nothing
  local unit d=CreateUnit(GetOwningPlayer(u),'e00E',GetUnitX(u), GetUnitY(u),0)
  call UnitAddAbility(d,'A325')
  call IssueTargetOrder(d,"thunderbolt",u)
  set d=null
endfunction

function F6F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local integer count=LoadInteger(hashtable019,h,100)
  local integer lvl=LoadInteger(hashtable019,h,0)
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if IsPlayerBelongToTeams(GetOwningPlayer(GetEventDamageSource()))and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource())) and GU8==false then
      if GV8==false then
        call UnitRemoveAbility(GetTriggerUnit(),'B0BM')
        call FlushChildHashtable(hashtable019,h)
        call CleanTrigger(t)
      endif
    endif
    if GV8 then
      set GV8=false
    endif
    if GU8 then
      set GU8=false
    endif
  else
    set count=count+1
    call SaveInteger(hashtable019,h,100,count)
    if count>lvl*2 then
      call FlushChildHashtable(hashtable019,h)
      call CleanTrigger(GetTriggeringTrigger())
    else
      call StunFor05(LoadUnitHandle(hashtable019,h,0))
    endif
  endif
  set t=null
  return false
endfunction

function Tauren_Stomp_Stun_Targets takes nothing returns boolean
  local trigger trig = null
  local unit u = GetFilterUnit()
  if IsUnitEnemy(u,group_temp_player) and GetUnitAbilityLevel(u,'A04R')==0 and GetUnitAbilityLevel(u,'B0BM')>0then
    set trig = CreateTrigger()
    
    call TriggerRegisterUnitEvent(trig,u,EVENT_UNIT_DAMAGED)
    call TriggerRegisterUnitEvent(trig,u,EVENT_UNIT_DEATH)
    call TriggerRegisterTimerEvent(trig,0.5,true)
    call TriggerRegisterTimerEvent(trig,0,false)
    call TriggerAddCondition(trig,Condition(function F6F))
    call SaveInteger(hashtable019,GetHandleId(trig),0,TempInteger)
    call SaveUnitHandle(hashtable019,GetHandleId(trig),0,u)
    
    
    set trig = null
  endif
  set u = null
  return false
endfunction

function Tauren_Stomp_Stun takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  
  set group_temp_player = LoadPlayerHandle(MHT,info,0)
  set TempInteger=GetUnitAbilityLevel(LoadUnitHandle(MHT,info,2),'A1AA')
  call GroupEnumUnitsInRange(temp_group,LoadReal(MHT,info,0),LoadReal(MHT,info,1),1000,Condition(function Tauren_Stomp_Stun_Targets))
  
  call Timer_End(t)
  set t = null
endfunction

function Tauren_Stomp_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if IsUnitEnemy(t,group_temp_player) and GetUnitAbilityLevel(t,'A04R')==0 and IsMagicImmune(t)==false and IsDead(t)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t))then
    call DamageTarget(group_temp_unit[0],t,group_temp_integer[0],80)
    call UnitShareVision(t,group_temp_player,true)
    call IssueTargetOrder(group_temp_unit[1],"thunderbolt",t)
    call UnitShareVision(t,group_temp_player,false)
  endif
  set t = null
  return false
endfunction

function Tauren_Stomp_Spirit_Start takes nothing returns boolean
  local integer info
  local unit d = null
  local unit t = GetFilterUnit()
  local real x
  local real y
  
  if GetUnitTypeId(t)=='h07U'then
    set info = GetHandleId(t)
    
    if LoadBoolean(MHT,'A1AA',info)then
      set x = GetWidgetX(t)
      set y = GetWidgetY(t)
      set d = CreateUnit(GetOwningPlayer(t),'h07Z',x,y,0)
      
      call SetUnitTimeScale(d,2.5)
      call UnitApplyTimedLife(d,'BTLF',2)
      
      call GroupEnumUnitsInRange(temp_group2,x,y,500,Condition(function Tauren_Stomp_Targets))
      
      call SaveBoolean(MHT,'A1AA',info,false)
      call SaveBoolean(MHT,info,'A1AA',false)
      call SetUnitAnimationByIndex(t,3)
      
      set d = null
    endif
  endif
  set t = null
  return false
endfunction

function Tauren_Stomp_Effect takes nothing returns nothing
  local timer t= Timer_Get()
  local unit u = GetTriggerUnit()
  local real x = GetWidgetX(u)
  local real y = GetWidgetY(u)
  local unit d = CreateUnit(GetOwningPlayer(u),'h07Z',x,y,0)
  local integer info = GetHandleId(t)
  
  if GetUnitTypeId(u)=='e00E' then//or GetUnitTypeId(u)=='h07U'then //multicast
    set u = udg_Hero[GetPlayerId(group_temp_player)]
  endif
  
  call SetUnitTimeScale(d,2.5)
  call UnitApplyTimedLife(d,'BTLF',2)
  
  set group_temp_player = GetOwningPlayer(u)
  set group_temp_unit[0] = u
  set group_temp_unit[1] = CreateUnit(group_temp_player,'e00E',x,y,0)
  set group_temp_integer[0] = 1
  
  call UnitAddAbility(group_temp_unit[1],'A1A9')
  //call SetUnitAbilityLevel(group_temp_unit[1],'A1A9',IMaxIF(GetUnitAbilityLevel(u,'A1AA'),1))
  
  call GroupEnumUnitsInRange(temp_group,x,y,500,Condition(function Tauren_Stomp_Targets))
  
  set group_temp_integer[0] = 2
  call GroupEnumUnitsOfPlayer(temp_group,GetOwningPlayer(u),Condition(function Tauren_Stomp_Spirit_Start))
  
  call SavePlayerHandle(MHT,info,0,group_temp_player)
  call SaveReal(MHT,info,0,x)
  call SaveReal(MHT,info,1,y)
  call SaveUnitHandle(MHT,info,2,u)
  
  call TimerStart(t,0.65,false,function Tauren_Stomp_Stun)
  
  set d = null
  set u = null
  set t = null
endfunction

function G4F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit W39=(LoadUnitHandle(hashtable019,(Cache),(335)))
  local boolean G7F=(LoadBoolean(hashtable019,(Cache),(336)))
  
  if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST then
    call SaveInteger(hashtable019,(GetHandleId((Source))),((4269)),(2))
    call SaveBoolean(hashtable019,(GetHandleId(W39)),(337),(true))
    
    call SaveBoolean(MHT,GetHandleId(W39),'A1AA',false)
    call IssueImmediateOrder(W39,"stop")
    
    if GetUnitAbilityLevel(W39,'Aloc')==0then
      call SetUnitAnimation(W39,"stand")
    else
      call SetUnitAnimationByIndex(W39,3)
    endif
    
    if G7F then
      call ShowUnit(W39,false)
      call KillUnit(W39)
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if G7F then
      call SetUnitFacing(W39,GetUnitFacing(Source))
    endif
  endif
  set t=null
  set W39=null
  set Source=null
  return false
endfunction

function Tauren_Stomp_Spirit_Effect takes unit u, unit s, boolean b returns nothing
  local trigger t = CreateTrigger()
  local integer info = GetHandleId(t)
  
  call UnitRemoveAbility(u,'A2LK')
  call SetUnitAnimation(u,"spell slam")
  call QueueUnitAnimation(u,"spell slam")
  
  call SaveUnitHandle(hashtable019,info,(335),u)
  call SaveUnitHandle(hashtable019,info,(2),s)
  
  if b then
    call SaveBoolean(hashtable019,info,336,true)
    call TriggerRegisterTimerEvent(t,.1,true)
  endif
  
  call TriggerRegisterUnitEvent(t,s,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerAddCondition(t,Condition(function G4F))
  
  set info = GetHandleId(u)
  call SaveBoolean(MHT,'A1AA',info,true) //prevents the spirit from stomping more than once
  call SaveBoolean(MHT,info,'A1AA',true) //stops movement while returning
  
  set t = null
endfunction

function Tauren_Stomp_Spirit takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if GetUnitTypeId(t)=='h07U'then
    if IssueImmediateOrderById(t,851972)then
      call Tauren_Stomp_Spirit_Effect(t,group_temp_unit[0],false)
    endif
    call SaveBoolean(MHT,99999,99997,false)
  endif
  set t = null
  return false
endfunction

function Tauren_Stomp_Check takes nothing returns nothing
  local unit Source = GetTriggerUnit()
  local unit W39 = null
  
  if GetUnitTypeId(Source)=='e00E'then //multicast
    set group_temp_unit[0] = udg_Hero[GetPlayerId(GetOwningPlayer(Source))]
  elseif  GetUnitTypeId(Source)=='h07U' then //spirit cast
    set group_temp_unit[0] = LoadUnitHandle(MHT,GetHandleId(Source),'A1A8')
    if IssueImmediateOrderById(group_temp_unit[0],852092)==false then
      call UnitAddAbility(Source,'A2LK')
      call SetUnitAnimation(Source,"stand")
      call IssueImmediateOrder(Source,"stop")
      call SaveBoolean(MHT,GetHandleId(Source),'A1AA',false)
      call SaveBoolean(MHT,'A1AA',GetHandleId(Source),false)
      
      set Source = null
      return
    endif
  else
    set group_temp_unit[0] = Source
  endif
  
  call SaveBoolean(MHT,99999,99997,true)
  call GroupEnumUnitsOfPlayer(temp_group,GetOwningPlayer(Source),Condition(function Tauren_Stomp_Spirit))
  
  if LoadBoolean(MHT,99999,99997)then
    set W39=CreateUnit(GetOwningPlayer(Source),'h07U',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
    call UnitAddAbility2(W39,'Aloc')
    call UnitAddAbility2(W39,'Aetl')
    call SetUnitPosition(W39,GetUnitX(Source),GetUnitY(Source))
    call SetUnitScale(W39,1.4,1.4,1.4)
    call IssueImmediateOrderById(W39,851972)
    call Tauren_Stomp_Spirit_Effect(W39,group_temp_unit[0],true)
    set W39=null
  endif
  
  set Source=null
endfunction






function GDF takes nothing returns nothing
  if IsUnitBADWithSpellbooks(GetEnumUnit())then
    return
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A1CA')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A1CA')
    call UnitRemoveAbility(GetEnumUnit(),'B0BP')
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A1C9')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A1C9')
    call UnitRemoveAbility(GetEnumUnit(),'B0BP')
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A1CB')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A1CB')
    call UnitRemoveAbility(GetEnumUnit(),'B0BP')
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A1CC')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A1CC')
    call UnitRemoveAbility(GetEnumUnit(),'B0BP')
  endif
  call GD9(GetEnumUnit(),0)
endfunction

function GEF takes nothing returns nothing
  if IsUnitBADWithSpellbooks(GetEnumUnit())then
    return
  endif
  if GF8==1 then
    if GetUnitAbilityLevel(GetEnumUnit(),'A1CA')==0 then
      call UnitAddAbility2(GetEnumUnit(),'A1CA')
    endif
  elseif GF8==2 then
    if GetUnitAbilityLevel(GetEnumUnit(),'A1C9')==0 then
      call UnitAddAbility2(GetEnumUnit(),'A1C9')
    endif
  elseif GF8==3 then
    if GetUnitAbilityLevel(GetEnumUnit(),'A1CB')==0 then
      call UnitAddAbility2(GetEnumUnit(),'A1CB')
    endif
  elseif GF8==4 then
    if GetUnitAbilityLevel(GetEnumUnit(),'A1CC')==0 then
      call UnitAddAbility2(GetEnumUnit(),'A1CC')
    endif
  endif
  if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO) then
    call GD9(GetEnumUnit(),R2I((I2R(GetHeroAgi(GetEnumUnit(),true))/ 7)*I2R(GF8)/4))
  endif
endfunction

function GFF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  local group GGF=LoadGroupHandle(hashtable019,Cache,340)
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local group g=GetAvailableGroup()
  local group g2
  local unit u = LoadUnitHandle(MHT,GetHandleId(Source),'A1A8')
  if Source==null then
    call FlushChildHashtable(hashtable019,Cache)
    call CleanTrigger(t)
    call KillGroup(GGF)
    call KillGroup(g)
    set g=null
    return false
  endif
  set tt_unit1=Source
  set GF8=GetUnitAbilityLevel(Source,'A1CD')
  if GF8==0 and GetUnitAbilityLevel(Source,'QP1I')>0 then
    set GF8=GetUnitAbilityLevel(Source,'QP1I')
  endif
  call GroupEnumUnitsInRange(g,x,y,300,Condition(function DefaultEnemyFilter))
  
  if u!=null then
    set g2=GetAvailableGroup()
    call GroupEnumUnitsInRange(g2,GetWidgetX(u),GetWidgetY(u),300,Condition(function DefaultEnemyFilter))
    call GroupAddGroup(g2,g)
    call KillGroup(g2)
    set g2=null
  endif
  call GroupRemoveGroup(g,GGF)
  call ForGroup(GGF,function GDF)
  if IsDead(Source)==false then
    call ForGroup(g,function GEF)
  endif
  call SaveGroupHandle(hashtable019,Cache,340,g)
  call KillGroup(GGF)
  set t=null
  set Source=null
  set GGF=null
  set u = null
  set g=null
  return false
endfunction

function Chieftain_NaturalOrder_Learning takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call UnitAddAbility2(Source,'A1CQ')
  call TriggerRegisterTimerEvent(t,.3,true)
  call TriggerAddCondition(t,Condition(function GFF))
  call SaveUnitHandle(hashtable019,Cache,2,Source)
  call SaveGroupHandle(hashtable019,Cache,340,GetAvailableGroup())
  call SaveTriggerHandle(hashtable019,GetHandleId(Source),338,t)
  call SaveBoolean(hashtable019,GetHandleId(Source),339,true)
  set t=null
  set Source=null
endfunction

function GIF takes nothing returns boolean
  if (GetLearnedSkill()=='A1CD' or GetLearnedSkill()=='QP1I') and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call Chieftain_NaturalOrder_Learning()
  endif
  return false
endfunction

function TJ9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function GIF))
  set t=null
endfunction

function GJF takes nothing returns nothing
  local real x1=GI8
  local real y1=GJ8
  local real x2=GK8
  local real y2=GM8
  local real x3=GetUnitX(GetEnumUnit())
  local real y3=GetUnitY(GetEnumUnit())
  local real u=((x3-x1)*(x2-x1)+(y3-y1)*(y2-y1))/((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2))
  local real x4=x1+u*(x2-x1)
  local real y4=y1+u*(y2-y1)
  local real XYE=GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)*.35/ 2
  if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO) then
    call SetUnitPosition(GetEnumUnit(),x4,y4)
  else
    call SetUnitX(GetEnumUnit(),x4)
    call SetUnitY(GetEnumUnit(),y4)
  endif
  call IssueTargetOrderById(GG8,852075,GetEnumUnit())
  call DamageTarget(GH8,GetEnumUnit(),1,XYE)
  call DamageTarget(GH8,GetEnumUnit(),2,XYE)
endfunction

function GKF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  local real x0=LoadReal(hashtable019,Cache,282)
  local real y0=LoadReal(hashtable019,Cache,283)
  local real a0=LoadReal(hashtable019,Cache,341)
  local integer i=0
  local real x
  local real y
  local group g=GetAvailableGroup()
  local group AlreadyHit=GetAvailableGroup()
  local integer Level=GetUnitAbilityLevel(Source,'A1A1')
  call FlushChildHashtable(hashtable019,Cache)
  call CleanTrigger(t)
  set tt_unit1=Source
  set GH8=Source
  set GG8=CreateUnit(GetOwningPlayer(Source),'e00E',x0,y0,0)
  call UnitAddAbility2(GG8,'A1CE')
  call SetUnitAbilityLevel(GG8,'A1CE',Level)
  loop
    exitwhen i>11
    set x=x0+i*200*Cos(a0)
    set y=y0+i*200*Sin(a0)
    call ZD8("Abilities\\Spells\\Orc\\EarthQuake\\EarthQuakeTarget.mdl",x,y,1.6)
    call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",x,y-250))
    call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",x,y))
    call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",x+250,y))
    call KillTrees(x,y,300)
    call GroupEnumUnitsInRange(g,x,y,325,Condition(function DefaultEnemyFilter))
    call GroupAddGroup(g,AlreadyHit)
    call GroupClear(g)
    set i=i+1
  endloop
  set GI8=x0
  set GJ8=y0
  set GK8=x
  set GM8=y
  call ForGroup(AlreadyHit,function GJF)
  call KillGroup(AlreadyHit)
  call KillGroup(g)
  set t=null
  set Source=null
  set g=null
  set AlreadyHit=null
  return false
endfunction

function GMF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local real x0=(LoadReal(hashtable019,(Cache),(282)))
  local real y0=(LoadReal(hashtable019,(Cache),(283)))
  local real a0
  local real GNF
  local real GOF
  local real GPF
  local real GQF
  local real GRF
  local real GSF
  local real GTF
  local real GUF
  local real GVF
  local real GWF
  local real GXF
  local real GYF
  local real x
  local real y
  local ubersplat Splat
  local integer Count=GetTriggerEvalCount(t)
  set x=x0+200*Count*Cos(a)
  set y=y0+200*Count*Sin(a)
  set Splat=CreateUbersplat(x,y,"THNE",255,255,255,255,false,false)
  call SetUbersplatRenderAlways(Splat,true)
  set GNF=x+250*Cos(bj_DEGTORAD*(a*bj_RADTODEG-45))
  set GOF=y+250*Sin(bj_DEGTORAD*(a*bj_RADTODEG-45))
  set GPF=x+250*Cos(bj_DEGTORAD*(a*bj_RADTODEG+45))
  set GQF=y+250*Sin(bj_DEGTORAD*(a*bj_RADTODEG+45))
  set GRF=x-125*Cos(bj_DEGTORAD*(a*bj_RADTODEG-45))
  set GSF=y-125*Sin(bj_DEGTORAD*(a*bj_RADTODEG-45))
  set GTF=x-125*Cos(bj_DEGTORAD*(a*bj_RADTODEG+45))
  set GUF=y-125*Sin(bj_DEGTORAD*(a*bj_RADTODEG+45))
  set GVF=x
  set GWF=y
  set GXF=x
  set GYF=y
  call TimedReveal(GetOwningPlayer(Source),4,x,y,500)
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",GNF,GOF))
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",GPF,GQF))
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",GRF,GSF))
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",GTF,GUF))
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",GVF,GWF))
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",GXF,GYF))
  if GetTriggerEvalCount(t)>11 then
    set x0=LoadReal(hashtable019,Cache,282)
    set y0=LoadReal(hashtable019,Cache,283)
    set a0=LoadReal(hashtable019,Cache,341)
    call FlushChildHashtable(hashtable019,Cache)
    call CleanTrigger(t)
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,.5,false)
    call TriggerAddCondition(t,Condition(function GKF))
    call SaveUnitHandle(hashtable019,Cache,2,Source)
    call SaveReal(hashtable019,Cache,282,x0*1.)
    call SaveReal(hashtable019,Cache,283,y0*1.)
    call SaveReal(hashtable019,Cache,341,a0*1.)
  endif
  set t=null
  set Source=null
  set Splat=null
  return false
endfunction

function Chieftain_SplitEarth takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  call TriggerRegisterTimerEvent(t,.22,true)
  call TriggerAddCondition(t,Condition(function GMF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Source))*1.))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveReal(hashtable019,(Cache),(282),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(283),((GetUnitY(Source))*1.))
  call SaveReal(hashtable019,(Cache),(341),((a)*1.))
  //call RemoveLocation(l)
  set t=null
  set Source=null
  //set l=null
endfunction

function Tauren_Spirit_Abilities takes player p, unit u, unit d returns nothing
  //unused right now, but should be used when all auras are added
  local integer skill
  local integer level
  local integer loopA = 1
  local integer id = GetPlayerId(p)
  
  loop
    exitwhen loopA == 6
    
    
    
    set skill = SkillID[PlayerSkillNumber[id*PlayerSkillOffset + loopA]]
    set level = GetUnitAbilityLevel(u,skill)
    
    if LoadBoolean(MHT,skill,0)==true and level>0 then
      call UnitAddAbility2(d,skill)
      call SetUnitAbilityLevel(d,skill,level)
    endif
    set loopA = loopA + 1
  endloop
endfunction

function Tauren_Spirit_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local unit u = LoadUnitHandle(MHT,info,0)
  
  //call LoDMovePercentage_Sub(u,LoadReal(MHT,info,0))
  call LoDStat_Sub(u,LoadInteger(MHT,info,3),"damage")
  call SubBonusMSPercent(u,R2I(LoadReal(MHT,info,0)))
  
  call Timer_End(t)
  set t = null
  set u = null
endfunction

function Tauren_Spirit_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local group g = LoadGroupHandle(MHT,group_temp_integer[0],2)
  
  if IsDead(t)==false and IsUnitEnemy(group_temp_unit[0],GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R')==0 and IsUnitInGroup(t,g)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) then
    if IsUnitType(t,UNIT_TYPE_HERO)then
      call SaveInteger(MHT,group_temp_integer[0],4,LoadInteger(MHT,group_temp_integer[0],4) + 1)
    else
      call SaveInteger(MHT,group_temp_integer[0],3,LoadInteger(MHT,group_temp_integer[0],3) + 1)
    endif
    
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl",t,"chest"))
    call DamageTarget(group_temp_unit[0],t,1,group_temp_integer[1])
    call GroupAddUnit(g,t)
  endif
  set g = null
  set t = null
  return false
endfunction

function Tauren_Spirit_Return takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer i3
  local integer i2
  local integer i1
  local unit u = LoadUnitHandle(MHT,info,0)
  local unit d = LoadUnitHandle(MHT,info,1)
  local real x2 = GetWidgetX(u)
  local real y2 = GetWidgetY(u)
  local real x1 = GetWidgetX(d)
  local real y1 = GetWidgetY(d)
  local real angle = Atan2(y2-y1,x2-x1)
  
  
  //call BJDebugMsg(I2S(GetHandleId(u)))
  
  if LoadBoolean(MHT,GetHandleId(d),'A1AA') then
    
    //call BJDebugMsg("stomping")
    
    set d = null
    set u = null
    set t = null
    return
  endif
  
  set x1 = x1 + 15*Cos(angle)
  set y1 = y1 + 15*Sin(angle)
  
  call SetUnitX(d,x1)
  call SetUnitY(d,y1)
  call SetUnitFacing(d,angle*bj_RADTODEG)
  
  set group_temp_unit[0] = u
  set group_temp_integer[0] = info
  set group_temp_integer[1] = LoadInteger(MHT,info,2)
  
  call GroupEnumUnitsInRange(temp_group,x1,y1,300,Condition(function Tauren_Spirit_Targets))
  
  if 100 > SquareRoot((x1-x2)*(x1-x2) + (y1-y2)*(y1-y2)) then
    set i3 = LoadInteger(MHT,info,1)
    set i2 = LoadInteger(MHT,info,3)
    set i1 = LoadInteger(MHT,info,4)
    
    if i1 + i2 > 0 then
      set x1 = (i2 + i1*5)//100.
      set i3 = i2*3*i3 + i1*10*i3
      
      call Buff_Add(u,LoDBuff_AbilID[15],LoDBuff_BuffID[15],9)
      
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl",u,"chest"))
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl",u,"origin"))
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl",u,"hand,left"))
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl",u,"hand,right"))
      
      call SaveInteger(MHT,info,3,i3)
      call SaveReal(MHT,info,0,x1)
      
      //call LoDMovePercentage_Add(u,x1)
      call AddBonusMSPercent(u,R2I(x1))
      call LoDStat_Add(u,i3,"damage")
      
      call TimerStart(t,9,false,function Tauren_Spirit_End)
    else
      call Timer_End(t)
    endif
    
    set info = GetHandleId(u)
    set i1 = LoadInteger(MHT,info,'A1A8')
    
    call SaveInteger(MHT,info,'A1A8',i1 - 1)
    
    if i1==1then
      call UnitRemoveAbility(u,'A21J')
      call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A1A8',true)
    endif
    
    call FlushChildHashtable(MHT,GetHandleId(d))
    call RemoveUnit(d)
  endif
  
  set d = null
  set u = null
  set t = null
endfunction

function Tauren_Spirit_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,0)
  local unit d = LoadUnitHandle(MHT,info,1)
  local real x = GetWidgetX(d)
  local real y = GetWidgetY(d)
  
  set group_temp_unit[0] = u
  set group_temp_integer[0] = info
  set group_temp_integer[1] = LoadInteger(MHT,info,2)
  
  call GroupEnumUnitsInRange(temp_group,x,y,300,Condition(function Tauren_Spirit_Targets))
  
  if count==80 or LoadBoolean(MHT,GetHandleId(u),'A1A8') or LoadBoolean(MHT,GetHandleId(d),'A1A8')then
    call UnitAddAbility(d,'Aloc')
    call SetUnitAnimationByIndex(d,1)
    call IssueImmediateOrder(d,"stop")
    call SaveBoolean(MHT,info,0,true)
    
    call TimerStart(t,0.025,true,function Tauren_Spirit_Return)
    
    set d = null
    set u = null
    set t = null
    return
  endif
  
  call SetUnitMoveSpeed(d,GetUnitMoveSpeedLOD(u))
  call SaveInteger(MHT,info,0,count+1)
  
  set d = null
  set u = null
  set t = null
endfunction

function Tauren_Spirit_Reset takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local unit u = LoadUnitHandle(MHT,GetHandleId(t),0)
  
  call UnitRemoveAbility(u,'A21J')
  call UnitAddAbility2(u,'A21J')
  
  call Timer_End(t)
  set t = null
  set u = null
endfunction

function Tauren_Spirit_Stop takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  
  call SaveUnitHandle(MHT,GetHandleId(t),0,u)
  call SaveBoolean(MHT,GetHandleId(u),'A1A8',true)
  
  call TimerStart(t,0,false,function Tauren_Spirit_Reset)
  
  set t = null
  set u = null
endfunction

function Tauren_Spirit_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local player p = GetOwningPlayer(u)
  local unit d = CreateUnit(p,'h07U',GetSpellTargetX(),GetSpellTargetY(),GetUnitFacing(u)-180)
  local integer info = GetHandleId(t)
  local integer level = GetUnitAbilityLevel(u,'A1A8')
  local integer id
  //call BJDebugMsg("casting")
  
  if GetUnitTypeId(u)=='e00E'then //multicast
    set u = udg_Hero[GetPlayerId(GetOwningPlayer(u))]
    set level = GetUnitAbilityLevel(u,'A1A8')
  endif
  
  call SaveBoolean(MHT,info,0,false)
  call SaveUnitHandle(MHT,info,0,u)
  call SaveUnitHandle(MHT,info,1,d)
  call SaveGroupHandle(MHT,info,2,GetAvailableGroup())
  call SaveInteger(MHT,info,0,0)
  call SaveInteger(MHT,info,1,level)
  call SaveInteger(MHT,info,2,20 + 40*level)
  call SaveInteger(MHT,info,3,0)
  call SaveInteger(MHT,info,4,0)
  
  set info = GetHandleId(u)
  call SaveBoolean(MHT,info,'A1A8',false)
  call SaveInteger(MHT,info,'A1A8',LoadInteger(MHT,info,'A1A8') + 1)
  call SaveUnitHandle(MHT,info,'A1A8',d)
  
  call SetPlayerAbilityAvailable2(p,'A1A8',false)
  call UnitAddAbility(u,'A21J')
  
  call TriggerRegisterUnitEvent(GAME_TRIGGER,d,EVENT_UNIT_SPELL_EFFECT)
  //call TriggerRegisterUnitEvent(GAME_TRIGGER,d,EVENT_UNIT_SPELL_FINISH)
  call TriggerRegisterUnitEvent(GAME_TRIGGER,d,EVENT_UNIT_SPELL_CAST)
  call UnitAddAbility(d,'A21J')
  call UnitAddAbility(d,'Aetl')
  if GetUnitAbilityLevel(u,'A1AA')>0then
    call UnitAddAbility(d,'A2LK')
  endif
  if GetUnitAbilityLevel(u,'A1CD')>0 or GetUnitAbilityLevel(u,'QP1I')>0 then
    call UnitAddAbility2(d,'A1CQ')
  endif
  
  call SaveUnitHandle(MHT,GetHandleId(d),'A1A8',u)
  
  call TimerStart(t,0.1,true,function Tauren_Spirit_Duration)
  
  set d = null
  set u = null
  set t = null
  set p=null
endfunction


function HXF takes nothing returns nothing
  local unit Target=GetOrderTargetUnit()
  local real x
  local real y
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER then
    set x=GetUnitX(GetOrderTargetUnit())
    set y=GetUnitY(GetOrderTargetUnit())
  else
    set x=GetOrderPointX()
    set y=GetOrderPointY()
  endif
  if DistanceBetweenXY(GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),x,y)<700 then
    call PlaySoundAtPos(FE,x,y)
  endif
  set Target=null
endfunction

function HYF takes nothing returns boolean
  if GetIssuedOrderId()==852040 then
    call HXF()
  endif
  return false
endfunction

function Techies_SuicideSquad_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterPlayerUnitEvent(t,GetOwningPlayer(GetTriggerUnit()),EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER,Condition(function ReturnTrue))
  call TriggerRegisterPlayerUnitEvent(t,GetOwningPlayer(GetTriggerUnit()),EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER,Condition(function ReturnTrue))
  call TriggerAddCondition(t,Condition(function HYF))
  set t=null
endfunction

function HAF takes nothing returns boolean
  if GetLearnedSkill()=='A06B' and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call Techies_SuicideSquad_Learn()
  endif
  return false
endfunction

function NH9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function HAF))
  set t=null
endfunction

function RemoteMines_Show takes nothing returns nothing
  call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,"Type -show to toggle the Focused Detonate sub-spell for Remote Mines")
endfunction

function HBF takes nothing returns boolean
  return(GetLearnedSkill()=='A0AK' or GetLearnedSkill()=='A1FY')and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function HCF takes nothing returns nothing
  if(GetUnitAbilityLevel(GetTriggerUnit(),'A0AK')==1 or GetUnitAbilityLevel(GetTriggerUnit(),'A1FY')==1)then
    call UnitAddAbility2(GetTriggerUnit(),'A1WF')
  endif
endfunction

function NE9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function HBF))
  call TriggerAddAction(t,function HCF)
  set t=null
endfunction

function H3F takes nothing returns boolean
  if(GetSpellAbilityId()=='A0AM' or GetSpellAbilityId()=='A0A3' or GetSpellAbilityId()=='A0A4' or GetSpellAbilityId()=='A02T' or GetSpellAbilityId()=='A1FZ' or GetSpellAbilityId()=='A1WF')then
    return true
  elseif GetSpellAbilityId()=='A0AK' or GetSpellAbilityId()=='A1FY' then
    if GetUnitAbilityLevel(GetTriggerUnit(),'A1WF')==0 then
      call UnitAddAbility2(GetTriggerUnit(),'A1WF')
    endif
  endif
  return false
endfunction

function H6F takes nothing returns boolean
  if(IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit())))then
    if(IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false)then
      if(GetUnitAbilityLevelSwapped('A04R',GetFilterUnit())==0)then
        return true
      endif
    endif
  endif
  return false
endfunction

function HLF takes nothing returns nothing
  call IssueImmediateOrderById(GetEnumUnit(),852556)
endfunction

function H1F takes nothing returns nothing
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),1,300)
endfunction

function H0F takes nothing returns nothing
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),1,450)
endfunction

function H5F takes nothing returns nothing
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),1,600)
endfunction

function H2F takes nothing returns nothing
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),1,750)
endfunction

function I4F takes nothing returns boolean
  return GetOwningPlayer(GetFilterUnit())==GY8 and GetUnitTypeId(GetFilterUnit())==GX8 and IsDead(GetFilterUnit())==false
endfunction

function I7F takes player p,integer W78,real x,real y returns nothing
  local group g=GetAvailableGroup()
  set GY8=p
  set GX8=W78
  call GroupEnumUnitsInRange(g,x,y,716,Condition(function I4F))
  call ForGroup(g,function HLF)
  call KillGroup(g)
  set g=null
endfunction

function I8F takes nothing returns nothing
  local real x=GetUnitX(GetTriggerUnit())
  local real y=GetUnitY(GetTriggerUnit())
  local group HQ9
  call DisableTrigger(GW8)
  set IsRemoveMinesBlast=true
  if(GetSpellAbilityId()=='A0AM')then
    call ZD8("Abilities\\Spells\\Human\\FlameStrike\\FlameStrike1.mdl",x,y,5)
    call TimedReveal(GetOwningPlayer(GetTriggerUnit()),3,x,y,500)
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,x,y,425,Condition(function H6F))
    call ForGroup(HQ9,function H1F)
    call RemoveUnit(GetTriggerUnit())
    call KillGroup(HQ9)
  endif
  if(GetSpellAbilityId()=='A0A3')then
    call ZD8("Abilities\\Spells\\Human\\FlameStrike\\FlameStrike1.mdl",x,y,5)
    call TimedReveal(GetOwningPlayer(GetTriggerUnit()),3,x,y,500)
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,x,y,435,Condition(function H6F))
    call ForGroup(HQ9,function H0F)
    call RemoveUnit(GetTriggerUnit())
    call KillGroup(HQ9)
  endif
  if(GetSpellAbilityId()=='A0A4')then
    call ZD8("Abilities\\Spells\\Human\\FlameStrike\\FlameStrike1.mdl",x,y,5)
    call TimedReveal(GetOwningPlayer(GetTriggerUnit()),3,x,y,500)
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,x,y,450,Condition(function H6F))
    call ForGroup(HQ9,function H5F)
    call RemoveUnit(GetTriggerUnit())
    call KillGroup(HQ9)
  endif
  if(GetSpellAbilityId()=='A1FZ')then
    call ZD8("Abilities\\Spells\\Human\\FlameStrike\\FlameStrike1.mdl",x,y,5)
    call TimedReveal(GetOwningPlayer(GetTriggerUnit()),3,x,y,500)
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,x,y,450,Condition(function H6F))
    call ForGroup(HQ9,function H2F)
    call RemoveUnit(GetTriggerUnit())
    call KillGroup(HQ9)
  endif
  if(GetSpellAbilityId()=='A02T')then
    set HQ9=GetAvailableGroup()
    set bj_groupEnumTypeId='o018'
    call GroupEnumUnitsOfPlayer(HQ9,GetOwningPlayer(GetTriggerUnit()),filterGetUnitsOfPlayerAndTypeId)
    call ForGroup(HQ9,function HLF)
    call KillGroup(HQ9)
    set HQ9=GetAvailableGroup()
    set bj_groupEnumTypeId='o002'
    call GroupEnumUnitsOfPlayer(HQ9,GetOwningPlayer(GetTriggerUnit()),filterGetUnitsOfPlayerAndTypeId)
    call ForGroup(HQ9,function HLF)
    call KillGroup(HQ9)
    set HQ9=GetAvailableGroup()
    set bj_groupEnumTypeId='o00B'
    call GroupEnumUnitsOfPlayer(HQ9,GetOwningPlayer(GetTriggerUnit()),filterGetUnitsOfPlayerAndTypeId)
    call ForGroup(HQ9,function HLF)
    call KillGroup(HQ9)
    set HQ9=GetAvailableGroup()
    set bj_groupEnumTypeId='o01B'
    call GroupEnumUnitsOfPlayer(HQ9,GetOwningPlayer(GetTriggerUnit()),filterGetUnitsOfPlayerAndTypeId)
    call ForGroup(HQ9,function HLF)
    call KillGroup(HQ9)
  endif
  if(GetSpellAbilityId()=='A1WF')then
    set x=GetSpellTargetX()
    set y=GetSpellTargetY()
    call I7F(GetOwningPlayer(GetTriggerUnit()),'o018',x,y)
    call I7F(GetOwningPlayer(GetTriggerUnit()),'o002',x,y)
    call I7F(GetOwningPlayer(GetTriggerUnit()),'o00B',x,y)
    call I7F(GetOwningPlayer(GetTriggerUnit()),'o01B',x,y)
  endif
  set IsRemoveMinesBlast=false
  call EnableTrigger(GW8)
  set HQ9=null
endfunction

function I9F takes nothing returns nothing
  local integer id=GetUnitTypeId(GetTriggerUnit())
  local real x=GetUnitX(GetTriggerUnit())
  local real y=GetUnitY(GetTriggerUnit())
  local group HQ9
  if id=='o018' then
    call ZD8("Abilities\\Spells\\Human\\FlameStrike\\FlameStrike1.mdl",x,y,5)
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,x,y,425,Condition(function H6F))
    call ForGroup(HQ9,function H1F)
    call KillGroup(HQ9)
  endif
  if id=='o002' then
    call ZD8("Abilities\\Spells\\Human\\FlameStrike\\FlameStrike1.mdl",x,y,5)
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,x,y,435,Condition(function H6F))
    call ForGroup(HQ9,function H0F)
    call KillGroup(HQ9)
  endif
  if id=='o00B' then
    call ZD8("Abilities\\Spells\\Human\\FlameStrike\\FlameStrike1.mdl",x,y,5)
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,x,y,450,Condition(function H6F))
    call ForGroup(HQ9,function H5F)
    call KillGroup(HQ9)
  endif
  if id=='o01B' then
    call ZD8("Abilities\\Spells\\Human\\FlameStrike\\FlameStrike1.mdl",x,y,5)
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,x,y,450,Condition(function H6F))
    call ForGroup(HQ9,function H2F)
    call KillGroup(HQ9)
  endif
  set HQ9=null
endfunction

function IDF takes nothing returns boolean
  local integer id=GetUnitTypeId(GetTriggerUnit())
  if id=='o018' or id=='o002' or id=='o00B' or id=='o01B' then
    call I9F()
  endif
  return false
endfunction

function NF9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddAction(t,function I8F)
  call TriggerAddCondition(t,Condition(function H3F))
  call CS8("Units\\Creeps\\GoblinSapper\\GoblinSapperYesAttack1.wav")
  set GW8=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(GW8,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(GW8,Condition(function IDF))
  set t=null
endfunction

function IEF takes nothing returns boolean
  if GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.5 and(GetUnitTypeId(GetFilterUnit())=='n00O' or GetUnitTypeId(GetFilterUnit())=='n00P' or GetUnitTypeId(GetFilterUnit())=='n00Q' or GetUnitTypeId(GetFilterUnit())=='n00N')then
    set GZ8=GZ8+1
  endif
  return false
endfunction

function IFF takes nothing returns boolean
  local group g=GetAvailableGroup()
  set GZ8=0
  call GroupEnumUnitsOfPlayer(g,GetTriggerPlayer(),Condition(function IEF))
  if GZ8>0 then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetObjectName('n0FC')+": "+I2S(GZ8))
  endif
  call KillGroup(g)
  set g=null
  return false
endfunction

function IGF takes nothing returns boolean
  if((GetUnitTypeId(GetTriggerUnit())=='n00O'))then
    return true
  endif
  if((GetUnitTypeId(GetTriggerUnit())=='n00P'))then
    return true
  endif
  if((GetUnitTypeId(GetTriggerUnit())=='n00Q'))then
    return true
  endif
  if((GetUnitTypeId(GetTriggerUnit())=='n00N'))then
    return true
  endif
  if GetUnitTypeId(GetTriggerUnit())=='o018' or GetUnitTypeId(GetTriggerUnit())=='o002' or GetUnitTypeId(GetTriggerUnit())=='o00B' or GetUnitTypeId(GetTriggerUnit())=='o01B' then
    if AutoselectionStatus[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]then
    endif
  endif
  return false
endfunction

function IHF takes nothing returns boolean
  if GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(GetTriggerUnit())then
    if((GetUnitTypeId(GetFilterUnit())=='n00O'))then
      return true
    endif
    if((GetUnitTypeId(GetFilterUnit())=='n00P'))then
      return true
    endif
    if((GetUnitTypeId(GetFilterUnit())=='n00Q'))then
      return true
    endif
    if((GetUnitTypeId(GetFilterUnit())=='n00N'))then
      return true
    endif
  endif
  return false
endfunction

function IIF takes nothing returns boolean
  return(GetUnitTypeId(GetFilterUnit())=='H00E' or GetUnitTypeId(GetFilterUnit())=='H00G' or GetUnitTypeId(GetFilterUnit())=='H00F' or GetUnitTypeId(GetFilterUnit())=='E00P' or GetUnitTypeId(GetFilterUnit())=='N00B' or GetUnitTypeId(GetFilterUnit())=='UC60' or GetUnitTypeId(GetFilterUnit())=='EC77' or GetUnitTypeId(GetFilterUnit())=='U00P' or GetUnitTypeId(GetFilterUnit())=='E02N' or GetUnitTypeId(GetFilterUnit())=='E02O' or GetUnitTypeId(GetFilterUnit())=='O016' or GetUnitTypeId(GetFilterUnit())=='O017' or GetUnitTypeId(GetFilterUnit())=='E02F' or GetUnitTypeId(GetFilterUnit())=='H0DO' or GetUnitTypeId(GetFilterUnit())=='N0M7' or GetUnitTypeId(GetFilterUnit())=='N0MB' or GetUnitTypeId(GetFilterUnit())=='N0MC' or GetUnitTypeId(GetFilterUnit())=='N0MO' or GetUnitTypeId(GetFilterUnit())=='N0MA')and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(tt_unit1))
endfunction

function IJF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit IKF=(LoadUnitHandle(hashtable019,(Cache),(347)))
  local group g
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call DestroyEffect(AddSpecialEffect("war3mapImported\\NewGroundEX.mdx",GetUnitX(IKF),GetUnitY(IKF)))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set g=GetAvailableGroup()
    set tt_unit1=IKF
    call GroupEnumUnitsInRange(g,GetUnitX(IKF),GetUnitY(IKF),200,Condition(function IIF))
    if FirstOfGroup(g)!=null then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call SetUnitExploded(IKF,true)
      call KillUnit(IKF)
    endif
    call KillGroup(g)
  endif
  set t=null
  set IKF=null
  set g=null
  return false
endfunction

function IMF takes nothing returns nothing
  local integer Cache=GetHandleId(GetOwningPlayer(GetTriggerUnit()))
  local group HQ9=GetAvailableGroup()
  local integer INF=(LoadInteger(hashtable019,(Cache),(346)))
  local integer IOF=0
  local unit IPF
  local integer IQF
  local unit unit039
  local integer IRF
  local integer VT8
  local integer VU8
  local trigger t=CreateTrigger()
  call GroupEnumUnitsInRect(HQ9,bj_mapInitialPlayableArea,Condition(function IHF))
  call TriggerRegisterTimerEvent(t,.4,true)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function IJF))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(347),(GetTriggerUnit()))
  set INF=(INF+1)
  call StartTimerBJ((LoadTimerHandle(hashtable019,(Cache),(1500+INF))),false,15000.)
  call SaveUnitHandle(hashtable019,(Cache),(1600+INF),(GetTriggerUnit()))
  set IOF=CountUnitsInGroup(HQ9)
  if(IOF>20)then
    set IQF=99999
    set VT8=1
    set VU8=INF
    loop
      exitwhen VT8>VU8
      set unit039=(LoadUnitHandle(hashtable019,(Cache),(1600+VT8)))
      set IRF=R2I(TimerGetRemaining((LoadTimerHandle(hashtable019,(Cache),(1500+VT8)))))
      if(GetUnitState(unit039,UNIT_STATE_LIFE)>0 and IRF<IQF)then
        set IPF=unit039
        set IQF=IRF
      endif
      set VT8=VT8+1
    endloop
    call ExplodeUnitBJ(IPF)
  endif
  call SaveInteger(hashtable019,(Cache),(346),(INF))
  call KillGroup(HQ9)
  set HQ9=null
  set IPF=null
  set unit039=null
  set t=null
endfunction

function NG9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-st",true)
  call TriggerAddCondition(t,Condition(function IFF))
  set t=CreateTrigger()
  call TriggerRegisterEnterRectSimple(t,GetWorldBounds())
  call TriggerAddCondition(t,Condition(function IGF))
  call TriggerAddAction(t,function IMF)
  set t=null
endfunction


function Rearm_Effect takes nothing returns nothing
  local unit u = GetTriggerUnit()
  call RefreshWithBalance(u,true)
  call Passive_Cooldown(u,'A065',GetUnitAbilityLevel(u,'A065'))
  call RemoveAbilsForUnit(u)
  set u = null
endfunction



function Tinker_MarchOfMachines takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',GetUnitX(Hero),GetUnitY(Hero),0)
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local integer i=0
  local real a=0
  local real r=0
  local integer Level=GetUnitAbilityLevel(Hero,'A0BQ')
  call UnitAddAbility2(Caster,'A05F')
  call SetUnitAbilityLevel(Caster,'A05F',Level)
  if IssuePointOrderById(Caster,852593,x,y) then
    
  else
    call Error(GetOwningPlayer(Hero),"Cannot be casted there")
    call UnitRemoveAbility(Hero,'A0BQ')
    call UnitAddAbility2(Hero,'A0BQ')
    call SetUnitAbilityLevel(Hero,'A0BQ',Level)
  endif
  //	loop
  //		exitwhen IssuePointOrderById(Caster,852593,x+r*Cos(a),y+r*Sin(a)) or i>40
  //		set i=i+1
  //		set a=a+.4
  //		set r=r+10
  //	endloop
  //call RemoveLocation(l)
  set Hero=null
  set Caster=null
  //set l=null
endfunction

function Tinker_Laser takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call DamageTarget(GetTriggerUnit(),GetSpellTargetUnit(),3,(GetUnitAbilityLevel(GetTriggerUnit(),'A049')+GetUnitAbilityLevel(GetTriggerUnit(),'A33G')) *80)
  endif
endfunction

function I3F takes nothing returns nothing
  if IsUnitType(GetEnumUnit(),UNIT_TYPE_STRUCTURE) then
    call DamageTarget(GA8,GetEnumUnit(),1,GB8/ 3)
  else
    call DamageTarget(GA8,GetEnumUnit(),1,GB8)
  endif
endfunction

function I6F takes unit Source,real x,real y,real r,real d returns nothing
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x,y,r,Condition(function LB8))
  set GA8=Source
  set GB8=d
  call ForGroup(g,function I3F)
  call KillGroup(g)
  set g=null
endfunction

function ILF takes nothing returns boolean
  return(((GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit())))and IsCourier(GetFilterUnit())==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null
endfunction

function I1F takes unit Hero, real d returns unit
  local unit Source=null
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),d,Condition(function ILF))
  if GetUnitAbilityLevel(Hero,'A04R')>0 then
    call GroupRemoveUnit(g,udg_Hero[GetPlayerId(GetOwningPlayer(Hero))])
  else
    call GroupRemoveUnit(g,Hero)
  endif
  set Source=GroupPickRandomUnit(g)
  call KillGroup(g)
  set tt_unit1=Source
  set Source=null
  set g=null
  return tt_unit1
endfunction

function I0F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=GetTriggerEvalCount(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local real x0=(LoadReal(hashtable019,(Cache),(282)))
  local real y0=(LoadReal(hashtable019,(Cache),(283)))
  local real x1=GetUnitX(Source)
  local real y1=GetUnitY(Source)
  local real x2=GetUnitX(Target)
  local real y2=GetUnitY(Target)
  local real J2E
  local real I5F
  local real QQE
  local real JJE
  local real AO8
  local real AP8
  local location l
  local integer lvl=GetUnitAbilityLevel(Hero,'A0CY')
  if lvl==0 and GetUnitAbilityLevel(Hero,'QP1K')>0 then
    set lvl=GetUnitAbilityLevel(Hero,'QP1K')
  endif
  if DistanceBetweenXY(x0,y0,x2,y2)>1000 then
    set x2=x0
    set y2=y0
  endif
  set J2E=AngleBetweenXY(x1,y1,x2,y2)
  set I5F=DistanceBetweenXY(x1,y1,x2,y2)
  set QQE=I5F/ IMaxBJ((51-Count),1)
  set JJE=(Count-25)*(Count-25)
  set AO8=x1+QQE*Cos(J2E*bj_DEGTORAD)
  set AP8=y1+QQE*Sin(J2E*bj_DEGTORAD)
  if Count<51 then
    if IsBuggyFlying(Source)==false then
      call SetUnitFlyHeight(Source,775-JJE,0)
    endif
    if IsUnitType(Source,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
    endif
    call SetUnitPosition(Source,AO8,AP8)
  else
    if IsBuggyFlying(Source)==false then
      call SetUnitFlyHeight(Source,GetUnitDefaultFlyHeight(Source),0)
    endif
    call PauseUnit(Source,false)
    call SetUnitPathing(Source,true)
    call SetUnitPosition(Source,x2,y2)
    call SaveInteger(hashtable019,(GetHandleId((Source))),((4268)),(2))
    set l=Location(x2,y2)
    call TerrainDeformationRippleBJ(.2,true,l,1.,300.,96.,1,64.)
    call RemoveLocation(l)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl",GetUnitX(Source),GetUnitY(Source)))
    if IsUnitAlly(Source,GetOwningPlayer(Hero))then
    else
      if(FindItemOfType((Hero),Item_Real[indexid_AghanimTiny])!=null)then
        call DamageTarget(Hero,Source,1,(.2+.15*(lvl+1))*75*GetUnitAbilityLevel(Hero,'A0BZ'))
      else
        call DamageTarget(Hero,Source,1,(.2+.15*lvl)*75*GetUnitAbilityLevel(Hero,'A0BZ'))
      endif
    endif
    call KillTrees(x2,y2,300)
    call I6F(Hero,x2,y2,300,75*GetUnitAbilityLevel(Hero,'A0BZ'))
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Hero=null
  set Source=null
  set Target=null
  set l=null
  return false
endfunction

function Tiny_Toss takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Source=GC8
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  if GetUnitTypeId(Hero)=='e00C' or GetUnitTypeId(Hero)=='e00E'then //multicast
    set Hero=udg_Hero[GetPlayerId(GetOwningPlayer(Hero))]
    if GetOwningPlayer(Target)==GetOwningPlayer(Hero)then
      set Target=I1F(Hero,500+200*GetUnitAbilityLevel(Hero,'A0BZ')+25)
    endif
    if Source==null or Target==null then
      return
    endif
  else
    call IssueTargetOrder(Hero,"attack",Source)
  endif
  call SetUnitAnimationByIndex(Hero,4)
  call PauseUnit(Source,true)
  call SetUnitPathing(Source,false)
  if IsBuggyFlying(Source)==false then
    call UnitAddAbility2(Source,'Amrf')
    call UnitRemoveAbility(Source,'Amrf')
  endif
  call SaveInteger(hashtable019,(GetHandleId((Source))),((4268)),(1))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl",Source,"origin")))
  call SaveReal(hashtable019,(Cache),(282),((GetUnitX(Target))*1.))
  call SaveReal(hashtable019,(Cache),(283),((GetUnitY(Target))*1.))
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function I0F))
  set Hero=null
  set Source=null
  set Target=null
  set t=null
endfunction

function Tiny_Toss_OnCast takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Source=I1F(Hero,275)
  local unit Target=GetSpellTargetUnit()
  set GC8=Source
  if GetUnitTypeId(Hero)!='e00C' and GetUnitTypeId(Hero)!='e00E' then //normal cast
    if Source==null then
      call InterruptUnit(Hero)
      call Error(GetOwningPlayer(Hero),GetObjectName('n0DA'))
    elseif GetOwningPlayer(Target)==GetOwningPlayer(Hero) then
      call InterruptUnit(Hero)
      call Error(GetOwningPlayer(Hero),GetObjectName('n0CY'))
    elseif GetSpellTargetItem()!=null and IsRune(GetItemTypeId(GetSpellTargetItem()))==false then
      call InterruptUnit(Hero)
      call Error(GetOwningPlayer(Hero),"Must target Rune")
    endif
  else //multicast
  endif
  set Hero=null
  set Source=null
  set Target=null
endfunction

function J8F takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  call HideAbility('A2KK')
  set Source=null
endfunction

function J9F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer JDF=(LoadInteger(hashtable019,(Cache),(375)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Count
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source and GetEventDamage()>20 then
      set Count=(LoadInteger(hashtable019,(GetHandleId(Source)),(674)))
      if((LoadInteger(hashtable019,(GetHandleId((Source))),((4297))))==1)==false then
        call AddTimedKeyToUnit(Source,4297,.1)
        call SaveInteger(hashtable019,(GetHandleId(Source)),(674),(Count+1))
      endif
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  return false
endfunction

function JEF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local trigger t2
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Count=(LoadInteger(hashtable019,(GetHandleId(Source)),(674)))
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED and Count<6 then
    if GetAttacker()==Source and((LoadInteger(hashtable019,(GetHandleId((Source))),((4297))))==1)==false then
      set t2=CreateTrigger()
      call TriggerRegisterUnitEvent(t2,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
      call TriggerRegisterTimerEvent(t2,1,false)
      call TriggerAddCondition(t2,Condition(function J9F))
      call SaveUnitHandle(hashtable019,(GetHandleId(t2)),(2),(Source))
    endif
  endif
  if Count>5 then
    call SaveInteger(hashtable019,(GetHandleId(GetTriggerUnit())),(674),(0))
    call UnitRemoveAbility(Source,'A1W1')
    if(LoadInteger(hashtable019,(Cache),(34)))==1 then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  endif
  if GetTriggerEventId()!=EVENT_PLAYER_UNIT_ATTACKED then
    call SaveInteger(hashtable019,(Cache),(34),(1))
    if Count>5 then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
    call UnitRemoveAbility(Source,'A1VG')
    if(FindItemOfType((Source),Item_Real[indexid_AghanimTiny])!=null)then
      call UnitAddAbility2(Source,'A1VH')
    endif
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1VH',true)
  endif
  set t=null
  set t2=null
  set Source=null
  return false
endfunction

function WarClub_Animation takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if GetTriggerEvalCount(t)==1 then
    call SetUnitTimeScalePercent(Source,250)
  else
    call SetUnitTimeScalePercent(Source,100)
    call SetUnitAnimationByIndex(Source,12)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set Source=null
  set t=null
  return false
endfunction

function JFF takes nothing returns boolean
  local trigger t
  if GetSpellAbilityId()=='A1VH' then
    call AddTimedKeyToUnit(GetTriggerUnit(),4296,29.9)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(GetTriggerUnit()),'A1VH',false)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(GetTriggerUnit()),'A1VG',true)
    call UnitAddAbility2(GetTriggerUnit(),'A1VG')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(GetTriggerUnit()),'A1W1',false)
    call UnitAddAbility2(GetTriggerUnit(),'A1W1')
    call IssueTargetOrderById(GetTriggerUnit(),852511,GetSpellTargetDestructable())
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,30,false)
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
    call TriggerAddCondition(t,Condition(function JEF))
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(GetTriggerUnit()))
    call SaveInteger(hashtable019,(GetHandleId(t)),(34),(0))
    call SaveInteger(hashtable019,(GetHandleId(GetTriggerUnit())),(674),(0))
    set t=null
  elseif GetSpellAbilityId()=='A2KA' then
    call RemoveDestructable(GetSpellTargetDestructable())
    call ShowUnit(GetTriggerUnit(),false)
    call ShowUnit(GetTriggerUnit(),true)
    call UnitRemoveAbility(GetTriggerUnit(),'Aloc')
    call UnitAddAbility(GetTriggerUnit(),'A2KB')
    call UnitRemoveAbility(GetTriggerUnit(),'A2KB')
    call UnitAddAbility(GetTriggerUnit(),'A2KC')
    call UnitRemoveAbility(GetTriggerUnit(),'A2KC')
    call AddUnitAnimationProperties(GetTriggerUnit(),"upgrade",false)
  endif
  set t=null
  return false
endfunction

function WarClub_Scan takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if(FindItemOfType((Source),Item_Real[indexid_AghanimTiny])!=null)then
    if((LoadInteger(hashtable019,(GetHandleId((Source))),((4296))))==1)==false then
      if GetUnitAbilityLevel(Source,'A1VH')==0 and GetUnitAbilityLevel(Source,'A1VG')==0 then
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1VH',true)
        call UnitAddAbility2(Source,'A1VH')
      endif
    endif
  else
    call UnitRemoveAbility(Source,'A1VH')
    call UnitRemoveAbility(Source,'A1VG')
  endif
  set t=null
  set Source=null
  return false
endfunction

function YPD takes nothing returns nothing
  local unit Source=group003
  local unit Target=group006
  local unit Caster=(LoadUnitHandle(hashtable019,(GetHandleId(Source)),(297)))
  call SaveUnitHandle(hashtable019,(GetHandleId(Target)),(297),(Caster))
  call SetUnitOwner(Caster,GetOwningPlayer(Target),true)
  set Source=null
  set Target=null
  set Caster=null
endfunction

function YE9 takes nothing returns nothing
  local unit Hero=VK
  local unit Caster=(LoadUnitHandle(hashtable019,(GetHandleId(Hero)),(297)))
  if Caster!=null and GetUnitTypeId(Caster)=='e01V' then
    call RemoveUnit(Caster)
  endif
  set Hero=null
  set Caster=null
endfunction

function JGF takes nothing returns boolean
  return (GetLearnedSkill()=='A0CY' or GetLearnedSkill()=='QP1K') and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function JHF takes nothing returns nothing
  local unit JIF=(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(298)))
  local integer Level=GetUnitAbilityLevel(JIF,'A0CY')
  local real BaseScale=U18(JIF)
  if Level==0 and GetUnitAbilityLevel(JIF,'QP1K')>0 then
    set Level=GetUnitAbilityLevel(JIF,'QP1K')
  endif
  if GetUnitState(JIF,UNIT_STATE_LIFE)>1 then
    call SetUnitScale(JIF,BaseScale+.25*Level,BaseScale+.25*Level,BaseScale+.25*Level)
  endif
  set JIF=null
endfunction

function GrowIllusion_Delayed takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  local unit Original=LoadUnitHandle(hashtable019,Cache,19)
  local integer Level
  local real BaseScale
  //if LoadUnitHandle(HY,GetHandleId(Source),'0ILU')==Original then
  set BaseScale=U18(Source)
  set Level=GetUnitAbilityLevel(Original,'A0CY')+GetUnitAbilityLevel(Original,'QP1K')
  call SetUnitScale(Source,BaseScale+.25*Level,BaseScale+.25*Level,BaseScale+.25*Level)
  //endif
  call CleanTrigger(t)
  call FlushChildHashtable(hashtable019,Cache)
  set t=null
  set Source=null
  set Original=null
  return false
endfunction

function JJF takes nothing returns boolean
  local trigger t
  local integer Cache
  local unit Source=GetTriggerUnit()
  local unit Original=LoadUnitHandle(hashtable019,GetHandleId(GetTriggeringTrigger()),298)
  if IsUnitIllusion(Source) and GetOwningPlayer(Source)==GetOwningPlayer(Original) and GetUnitTypeId(Source)==GetUnitTypeId(Original) then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,0,false)
    call TriggerAddCondition(t,Condition(function GrowIllusion_Delayed))
    call SaveUnitHandle(hashtable019,Cache,2,Source)
    call SaveUnitHandle(hashtable019,Cache,19,Original)
    set t=null
  endif
  set Source=null
  set Original=null
  return false
endfunction


function Tiny_Grow_Learning takes nothing returns nothing
  local trigger t
  local unit Hero=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'A0CY')+GetUnitAbilityLevel(Hero,'QP1K')
  local unit dummy
  local region r
  local real BaseScale=U18(Hero)
  local integer pid=GetPlayerId(GetOwningPlayer(Hero))
  local boolean isranged
  if Level==1 then
    set dummy=CreateUnit(GetOwningPlayer(Hero),'e01V',0,0,0)
    call UnitAddAbility2(dummy,'A10B')
    call SaveUnitHandle(hashtable019,(GetHandleId(Hero)),(297),(dummy))
  else
    set dummy=(LoadUnitHandle(hashtable019,(GetHandleId(Hero)),(297)))
  endif
  if Level==2 then
    call UnitRemoveAbility(dummy,'A10B')
    call UnitRemoveAbility(Hero,'B04E')
    call UnitAddAbility2(dummy,'A10A')
  elseif Level==3 then
    call UnitRemoveAbility(dummy,'A10B')
    call UnitRemoveAbility(dummy,'A10A')
    call UnitRemoveAbility(Hero,'B04E')
    call UnitAddAbility2(dummy,'A0ZS')
  endif
  
  if Mode_EB==false then
    call SetPlayerTechResearched(GetOwningPlayer(Hero),'R00E',Level)
  else
    set isranged=IsUnitType(Hero,UNIT_TYPE_RANGED_ATTACKER)==true or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+1]],"range morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+2]],"range morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+3]],"range morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+4]],"range morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+5]],"range morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+6]],"range morph",null)
    if isranged then
      call SetPlayerTechResearched(GetOwningPlayer(Hero),'R00L',Level)
    else
      call SetPlayerTechResearched(GetOwningPlayer(Hero),'R00M',Level)
    endif
  endif
  
  if Level==1 then
    set t=CreateTrigger()
    call TriggerAddAction(t,function JHF)
    call TriggerRegisterTimerEvent(t,2.,true)
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(298),(Hero))
    set t=CreateTrigger()
    set r=CreateRegion()
    call RegionAddRect(r,GetWorldBounds())
    call TriggerRegisterEnterRegion(t,r,Condition(function ReturnTrue))
    call TriggerAddCondition(t,Condition(function JJF))
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(298),(Hero))
    set t=null
    set r=null
    set t=CreateTrigger()
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Hero))
    call TriggerRegisterTimerEvent(t,.5,true)
    set t=null
  endif
  call SetUnitScale(Hero,BaseScale+.25*Level,BaseScale+.25*Level,BaseScale+.25*Level)
  set Hero=null
  set dummy=null
endfunction

function NM9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function JGF))
  call TriggerAddAction(t,function Tiny_Grow_Learning)
  call J8F()
  set t=null
endfunction

function JMF takes nothing returns boolean
  local unit Source=GetTriggerUnit()
  local unit Target=GetAttacker()
  local integer Level=(GetUnitAbilityLevel(Source,'A19Q')+GetUnitAbilityLevel(Source,'QP1J'))
  local unit Caster
  if PRD_Get(Source,'A19Q',20) then
    set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
    call UnitAddAbility2(Caster,'A0BV')
    call SetUnitAbilityLevel(Caster,'A0BV',Level)
    call IssueTargetOrderById(Caster,852095,Target)
    set Caster=null
  endif
  set Source=null
  set Target=null
  return false
endfunction

function Tiny_CraggeExterior_Leveling takes nothing returns nothing
  call LoDStat_Add(GetTriggerUnit(),1,"armour")
endfunction


function Tiny_CraggyExterior_Learning takes nothing returns nothing
  local trigger t
  local unit Source=GetTriggerUnit()
  if IsUnitIllusion(Source)==false and IMaxIF(GetUnitAbilityLevel(Source,'A19Q'),GetUnitAbilityLevel(Source,'QP1J'))==1 then
    set t=CreateTrigger()
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ATTACKED)
    call TriggerAddCondition(t,Condition(function JMF))
    call LoDStat_Add(GetTriggerUnit(),1,"armour")
  endif
  call LoDStat_Add(GetTriggerUnit(),1,"armour")
  set t=null
  set Source=null
endfunction

function JOF takes nothing returns boolean
  local unit u =  GetTriggerUnit()
  local integer id=GetLearnedSkill()
  if id=='QP1J' or id=='A19Q' then
    
    call Tiny_CraggyExterior_Learning()
    
  endif
  
  set u = null
  return false
endfunction

function NP9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function JOF))
  set t=null
endfunction

function JPF takes nothing returns boolean
  if((LoadInteger(hashtable019,(GetHandleId((GetFilterUnit()))),((4268))))==1)and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(G38)) then
    call DamageTarget(G38,GetFilterUnit(),1,G68)
  endif
  return false
endfunction

function JQF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',x,y,0)
  local integer Level=GetUnitAbilityLevel(Hero,'A0LL')
  local group g=GetAvailableGroup()
  call UnitAddAbility2(Caster,'A10J')
  call SetUnitAbilityLevel(Caster,'A10J',Level)
  set G38=Hero
  if Level==1 then
    set G68=25
  elseif Level==2 then
    set G68=45
  elseif Level==3 then
    set G68=65
  elseif Level==4 then
    set G68=75
  endif
  call GroupEnumUnitsInRange(g,x,y,275+24,Condition(function JPF))
  call KillGroup(g)
  if GetTriggerEvalCount(t)>6 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Hero=null
  set Caster=null
  set g=null
  return false
endfunction

function Tiny_Avalanche takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',GetUnitX(Hero),GetUnitY(Hero),0)
  local integer Level=GetUnitAbilityLevel(Hero,'A0LL')
  call UnitAddAbility2(Caster,'A10M')
  call SetUnitAbilityLevel(Caster,'A10M',Level)
  call IssuePointOrderById(Caster,852652,x,y)
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerAddCondition(t,Condition(function JQF))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call TriggerEvaluate(t)
  //call RemoveLocation(l)
  set Hero=null
  //set l=null
  set t=null
  set Caster=null
endfunction

function JTF takes nothing returns nothing
  local unit u = GetEnumUnit()
  
  call CN8(u,'A0XE',G18,7,'B00B')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A0XE',false)
  
  set u = null
endfunction

function Troll_BattleTrance takes nothing returns nothing
  local group g=GetAvailableGroup()
  set G18=GetUnitAbilityLevel(GetTriggerUnit(),'A1EJ')
  
  call GroupEnumUnitsInRange(g,0,0,12000,Condition(function D49))
  call ForGroup(g,function JTF)
  call KillGroup(g)
  set g=null
endfunction

function JWF takes nothing returns boolean
  return GetSpellAbilityId()=='A0BE' and GetUnitTypeId(GetTriggerUnit())!='N017' and GetUnitTypeId(GetTriggerUnit())!='N02B' and GetUnitTypeId(GetTriggerUnit())!='QTW2' and GetUnitTypeId(GetTriggerUnit())!='QTW3' 
endfunction

function JXF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  //call UnitAddAbility(Source,'QF9E')
  //call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'QF9E',false)
  call SetUnitAbilityLevel(Source,'A09E',GetUnitAbilityLevel(Source,'A0BE'))
  call UnitRemoveAbility(Source,'B09Y')
  set t=null
  set Source=null
  return false
endfunction

function JYF takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function JXF))
  set t=null
  set Source=null
endfunction

function Troll_Rage takes nothing returns nothing
  if GetUnitTypeId(GetTriggerUnit())!='N017' and GetUnitTypeId(GetTriggerUnit())!='N02B' and GetUnitTypeId(GetTriggerUnit())!='QTW2' and GetUnitTypeId(GetTriggerUnit())!='QTW3' then
    call JYF()
  endif
endfunction

function NZ9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_FINISH)
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function JWF))
  call TriggerAddAction(t,function JYF)
  
  set t=null
endfunction

function JZF takes nothing returns boolean
  return GetLearnedSkill()=='A0BE' and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function JAF takes nothing returns nothing
  call SetUnitAbilityLevel(GetTriggerUnit(),'A09E',GetLearnedSkillLevel())
endfunction

function NA9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function JZF))
  call TriggerAddAction(t,function JAF)
  set t=null
endfunction

function JBF takes nothing returns boolean
  return GetUnitAbilityLevel(GetAttacker(),('P107'))>0 and((LoadInteger(hashtable019,(GetHandleId((GetAttacker()))),((4271))))==1)==false //A0O0
endfunction

function JCF takes nothing returns nothing
  local unit u=GetAttacker()
  local unit Target=GetTriggerUnit()
  local integer Cache=GetHandleId(u)
  local integer J3F=(LoadInteger(hashtable019,(Cache),(237)))
  local unit J6F=UnitAsInteger_Load(J3F)
  local integer unit060=IMaxIF((LoadInteger(hashtable019,(Cache),(236))),0)
  local integer Level=GetUnitAbilityLevel(u,('P107')) //A0O0
  local integer asbonus
  local integer prevasbonus=LoadInteger(MHT,GetHandleId(u),'P107')
  if J6F!=Target then
    set unit060=0
  else
    set unit060=IMinIF(unit060+1,4)
  endif
  set asbonus=(10+6*Level)*unit060
  if(prevasbonus!=asbonus) then
    if prevasbonus<asbonus then
      call LoDStat_Add(u,asbonus-prevasbonus,"attack")
    else
      call LoDStat_Sub(u,prevasbonus-asbonus,"attack")
    endif
    call SaveInteger(MHT,GetHandleId(u),'P107',asbonus)
  endif
  
  //call UnitAddAbilityLevel(u,'A0NZ',KAE)
  
  call SaveInteger(hashtable019,(Cache),(236),(unit060))
  if J6F!=Target then
    call UnitAsInteger_Clear(J3F)
    set J3F=UnitAsInteger_Save(Target)
    call SaveInteger(hashtable019,(Cache),(237),(J3F))
  endif
  call AddTimedKeyToUnit(u,4271,.4)
  set u=null
  set Target=null
  set J6F=null
endfunction

function NB9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function JBF))
  call TriggerAddAction(t,function JCF)
  call PreloadAbility(('A0NZ'))
  set t=null
endfunction

function JLF takes unit Source,unit Target,unit Caster,integer Level returns nothing
  call SetUnitOwner(Caster,GetOwningPlayer(Target),false)
  call SetUnitAbilityLevel(Caster,'A21O',Level)
  call IssueTargetOrderById(Caster,852190,Target)
  call DamageTarget(Source,Target,1,25+50*Level)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Target,"overhead"))
endfunction

function J1F takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),H48)==false then
    call GroupAddUnit(H48,GetEnumUnit())
    call JLF(G08,GetEnumUnit(),G58,H78)
  endif
endfunction

function J0F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local unit J5F=(LoadUnitHandle(hashtable019,(Cache),(675)))
  local unit J2F=(LoadUnitHandle(hashtable019,(Cache),(676)))
  local real a=(LoadReal(hashtable019,(Cache),(13)))
  local real d=(LoadReal(hashtable019,(Cache),(433)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local group AlreadyHit=(LoadGroupHandle(hashtable019,(Cache),(187)))
  local group g=GetAvailableGroup()
  if GetTriggerEvalCount(t)<=50 then
    set a=a+20
    set d=d+7
    call SaveReal(hashtable019,(Cache),(13),((a)*1.))
    call SaveReal(hashtable019,(Cache),(433),((d)*1.))
  elseif GetTriggerEvalCount(t)<=100 then
    set a=a+20
    set d=d-7
    call SaveReal(hashtable019,(Cache),(13),((a)*1.))
    call SaveReal(hashtable019,(Cache),(433),((d)*1.))
  endif
  call SetUnitX(J5F,SafeX50(x+d*Cos(a*bj_DEGTORAD)))
  call SetUnitY(J5F,SafeY50(y+d*Sin(a*bj_DEGTORAD)))
  set a=a+180
  call SetUnitX(J2F,SafeX50(x+d*Cos(a*bj_DEGTORAD)))
  call SetUnitY(J2F,SafeY50(y+d*Sin(a*bj_DEGTORAD)))
  set tt_unit1=Source
  set G08=Source
  set G58=Caster
  set H48=AlreadyHit
  set H78=Level
  call GroupEnumUnitsInRange(g,GetUnitX(J5F),GetUnitY(J5F),125,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function J1F)
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,GetUnitX(J2F),GetUnitY(J2F),125,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function J1F)
  call KillGroup(g)
  if GetTriggerEvalCount(t)>100 then
    call KillUnit(J5F)
    call KillUnit(J2F)
    call KillUnit(Caster)
    call KillGroup(AlreadyHit)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set J5F=null
  set J2F=null
  set Caster=null
  set AlreadyHit=null
  set g=null
  return false
endfunction

function Troll_AxesMelee takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local unit J5F=CreateUnit(GetOwningPlayer(Source),'e02Y',x,y,0)
  local unit J2F=CreateUnit(GetOwningPlayer(Source),'e02Y',x,y,0)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  call UnitAddAbility(Caster,'A21O')
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveUnitHandle(hashtable019,(Cache),(675),(J5F))
  call SaveUnitHandle(hashtable019,(Cache),(676),(J2F))
  call SaveReal(hashtable019,(Cache),(13),((0)*1.))
  call SaveReal(hashtable019,(Cache),(433),((0)*1.))
  call SaveInteger(hashtable019,(Cache),(5),(GetUnitAbilityLevel(Source,'A21N')))
  call SaveGroupHandle(hashtable019,(Cache),(187),(GetAvailableGroup()))
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function J0F))
  set Source=null
  set J5F=null
  set J2F=null
  set t=null
  set Caster=null
endfunction

function K7F takes unit Source,unit Target,unit Caster,integer Level returns nothing
  call SetUnitOwner(Caster,GetOwningPlayer(Target),false)
  call SetUnitAbilityLevel(Caster,'A21P',Level)
  call IssueTargetOrderById(Caster,852075,Target)
  call DamageTarget(Source,Target,1,75)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Target,"overhead"))
endfunction

function K8F takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),H48)==false and G28!=null and IsDead(G28)==false then
    call GroupAddUnit(H48,GetEnumUnit())
    call K7F(G08,GetEnumUnit(),G58,H78)
  endif
endfunction

function K9F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local unit J5F=(LoadUnitHandle(hashtable019,(Cache),(393)))
  local unit J2F=(LoadUnitHandle(hashtable019,(Cache),(394)))
  local unit KDF=(LoadUnitHandle(hashtable019,(Cache),(395)))
  local unit KEF=(LoadUnitHandle(hashtable019,(Cache),(396)))
  local unit KFF=(LoadUnitHandle(hashtable019,(Cache),(397)))
  local real a=(LoadReal(hashtable019,(Cache),(13)))-12.5
  local real d=(LoadReal(hashtable019,(Cache),(433)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit MTE
  local group g
  local group AlreadyHit=(LoadGroupHandle(hashtable019,(Cache),(187)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  set d=d+900/ 20.
  call SaveReal(hashtable019,(Cache),(433),((d)*1.))
  call SetUnitX(J5F,SafeX50(x+d*Cos(a*bj_DEGTORAD)))
  call SetUnitY(J5F,SafeY50(y+d*Sin(a*bj_DEGTORAD)))
  set a=a+6.25
  call SetUnitX(J2F,SafeX50(x+d*Cos(a*bj_DEGTORAD)))
  call SetUnitY(J2F,SafeY50(y+d*Sin(a*bj_DEGTORAD)))
  set a=a+6.25
  call SetUnitX(KDF,SafeX50(x+d*Cos(a*bj_DEGTORAD)))
  call SetUnitY(KDF,SafeY50(y+d*Sin(a*bj_DEGTORAD)))
  set a=a+6.25
  call SetUnitX(KEF,SafeX50(x+d*Cos(a*bj_DEGTORAD)))
  call SetUnitY(KEF,SafeY50(y+d*Sin(a*bj_DEGTORAD)))
  set a=a+6.25
  call SetUnitX(KFF,SafeX50(x+d*Cos(a*bj_DEGTORAD)))
  call SetUnitY(KFF,SafeY50(y+d*Sin(a*bj_DEGTORAD)))
  set G08=Source
  set G58=Caster
  set H48=AlreadyHit
  set H78=Level
  set MTE=J5F
  if MTE!=null and IsDead(MTE)==false then
    set x=GetUnitX(MTE)
    set y=GetUnitY(MTE)
    set G28=MTE
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,125,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function K8F)
    call KillGroup(g)
  endif
  set MTE=J2F
  if MTE!=null and IsDead(MTE)==false then
    set x=GetUnitX(MTE)
    set y=GetUnitY(MTE)
    set G28=MTE
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,125,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function K8F)
    call KillGroup(g)
  endif
  set MTE=KDF
  if MTE!=null and IsDead(MTE)==false then
    set x=GetUnitX(MTE)
    set y=GetUnitY(MTE)
    set G28=MTE
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,125,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function K8F)
    call KillGroup(g)
  endif
  set MTE=KEF
  if MTE!=null and IsDead(MTE)==false then
    set x=GetUnitX(MTE)
    set y=GetUnitY(MTE)
    set G28=MTE
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,125,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function K8F)
    call KillGroup(g)
  endif
  set MTE=KFF
  if MTE!=null and IsDead(MTE)==false then
    set x=GetUnitX(MTE)
    set y=GetUnitY(MTE)
    set G28=MTE
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,125,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function K8F)
    call KillGroup(g)
  endif
  if GetTriggerEvalCount(t)>20 then
    call KillUnit(J5F)
    call KillUnit(J2F)
    call KillUnit(KDF)
    call KillUnit(KEF)
    call KillUnit(KFF)
    call KillUnit(Caster)
    call KillGroup(AlreadyHit)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set J5F=null
  set J2F=null
  set KDF=null
  set KEF=null
  set KFF=null
  set Caster=null
  set MTE=null
  set AlreadyHit=null
  set g=null
  return false
endfunction

function Troll_AxesRanged takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x0=GetUnitX(Source)
  local real y0=GetUnitY(Source)
  local real x1=GetSpellTargetX()
  local real y1=GetSpellTargetY()
  local real a=AngleBetweenXY(x0,y0,x1,y1)
  local unit J5F=CreateUnit(GetOwningPlayer(Source),'e02Z',x0,y0,a-12.5)
  local unit J2F=CreateUnit(GetOwningPlayer(Source),'e02Z',x0,y0,a-6.25)
  local unit KDF=CreateUnit(GetOwningPlayer(Source),'e02Z',x0,y0,a)
  local unit KEF=CreateUnit(GetOwningPlayer(Source),'e02Z',x0,y0,a+6.25)
  local unit KFF=CreateUnit(GetOwningPlayer(Source),'e02Z',x0,y0,a+12.5)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x0,y0,0)
  call UnitAddAbility(Caster,'A21P')
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveUnitHandle(hashtable019,(Cache),(393),(J5F))
  call SaveUnitHandle(hashtable019,(Cache),(394),(J2F))
  call SaveUnitHandle(hashtable019,(Cache),(395),(KDF))
  call SaveUnitHandle(hashtable019,(Cache),(396),(KEF))
  call SaveUnitHandle(hashtable019,(Cache),(397),(KFF))
  call SaveReal(hashtable019,(Cache),(6),((x0)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y0)*1.))
  call SaveReal(hashtable019,(Cache),(433),((0)*1.))
  call SaveReal(hashtable019,(Cache),(13),((a)*1.))
  call SaveGroupHandle(hashtable019,(Cache),(187),(GetAvailableGroup()))
  call SaveInteger(hashtable019,(Cache),(5),(GetUnitAbilityLevel(Source,'A21M')))
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function K9F))
  set Source=null
  set J5F=null
  set J2F=null
  set KDF=null
  set KEF=null
  set KFF=null
  set t=null
  set Caster=null
endfunction

function KIF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=GetUnitAbilityLevel(Source,'A21L')
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  if IsUnitType(Source,UNIT_TYPE_MELEE_ATTACKER)then
    if((LoadInteger(hashtable019,(GetHandleId((Source))),((4416))))==1)==false or p!=GetOwningPlayer(Source)then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21N',true)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21M',false)
      call SaveInteger(hashtable019,(GetHandleId((Source))),((4416)),(1))
      call SaveInteger(hashtable019,(GetHandleId((Source))),((4417)),(2))
      if p!=GetOwningPlayer(Source)then
        call SavePlayerHandle(hashtable019,(Cache),(54),(GetOwningPlayer(Source)))
      endif
    endif
    if GetUnitAbilityLevel(Source,'A21N')!=Level then
      call SetUnitAbilityLevel(Source,'A21N',Level)
    endif
  elseif IsUnitType(Source,UNIT_TYPE_RANGED_ATTACKER)then
    if((LoadInteger(hashtable019,(GetHandleId((Source))),((4417))))==1)==false or p!=GetOwningPlayer(Source)then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21N',false)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21M',true)
      call SaveInteger(hashtable019,(GetHandleId((Source))),((4417)),(1))
      call SaveInteger(hashtable019,(GetHandleId((Source))),((4416)),(2))
      if p!=GetOwningPlayer(Source)then
        call SavePlayerHandle(hashtable019,(Cache),(54),(GetOwningPlayer(Source)))
      endif
    endif
    if GetUnitAbilityLevel(Source,'A21M')!=Level then
      call SetUnitAbilityLevel(Source,'A21M',Level)
    endif
  endif
  set t=null
  set Source=null
  set p=null
  return false
endfunction

function Warlord_WhirlingAxes_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call UnitAddAbility2(Source,'A21N')
  call UnitAddAbility2(Source,'A21M')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21N',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21M',false)
  call SaveInteger(hashtable019,(GetHandleId((Source))),((4416)),(2))
  call SaveInteger(hashtable019,(GetHandleId((Source))),((4417)),(2))
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function KIF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SavePlayerHandle(hashtable019,(Cache),(54),(GetOwningPlayer(Source)))
  set t=null
  set Source=null
endfunction

function KKF takes nothing returns boolean
  if GetLearnedSkill()=='A21L' and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Warlord_WhirlingAxes_Learn()
  endif
  return false
endfunction

function NC9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function KKF))
  set t=null
endfunction

function KMF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local integer RHE=2+Level
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitRemoveAbility(Source,'A1N3')
    call UnitRemoveAbility(Source,'A1N6')
    call UnitRemoveAbility(Source,'A1N7')
    call UnitRemoveAbility(Source,'B0CH')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetAttacker()==Source then
      set Count=Count+1
      call SaveInteger(hashtable019,(Cache),(34),(Count))
      if Count>=RHE then
        call UnitRemoveAbility(Source,'A1N3')
        call UnitRemoveAbility(Source,'A1N6')
        call UnitRemoveAbility(Source,'A1N7')
        call UnitRemoveAbility(Source,'B0CH')
        call FlushChildHashtable(hashtable019,(Cache))
        call CleanTrigger(t)
      endif
    endif
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT then
    if GetTriggerUnit()==Source and (GetSpellAbilityId()=='A1N4' or GetSpellAbilityId()=='QB0P') and(TimerGetElapsed(GlobalTimer))>(LoadReal(hashtable019,(Cache),(442)))then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    elseif (EF9(GetSpellAbilityId()))and Source==GetSpellTargetUnit()then
      call UnitRemoveAbility(Source,'A1N3')
      call UnitRemoveAbility(Source,'A1N6')
      call UnitRemoveAbility(Source,'A1N7')
      call UnitRemoveAbility(Source,'B0CH')
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    call UnitRemoveAbility(Source,'A1N3')
    call UnitRemoveAbility(Source,'A1N6')
    call UnitRemoveAbility(Source,'A1N7')
    call UnitRemoveAbility(Source,'B0CH')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  return false
endfunction

function Ursa_Overpower takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local integer Level=IMaxIF(GetUnitAbilityLevel(Source,'A1N4'),GetUnitAbilityLevel(Source,'QB0P'))
  call UnitAddAbility2(Source,'A1N3')
  call UnitAddAbility2(Source,'A1N6')
  call UnitAddAbility2(Source,'A1N7')
  if GetUnitAbilityLevel(Source,'A0CY')>0 or GetUnitAbilityLevel(Source,'QP1K')>0 then
    call SetUnitAbilityLevel(Source,'A1N3',2)
  endif
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1N6',false)
  call TriggerRegisterTimerEvent(t,15,false)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function KMF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(442),(((TimerGetElapsed(GlobalTimer))+1)*1.))
  set t=null
  set Source=null
endfunction

function NQ9 takes nothing returns nothing
  call PreloadAbility('A1N3')
endfunction

function KPF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=GetUnitAbilityLevel(Source,'A0LC')
  local integer WHD
  local integer KQF
  if GetTriggerEventId()==EVENT_UNIT_DEATH or (GetUnitAbilityLevel(Source,'B02H')==0 and GetTriggerEvalCount(t)>4) or(GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT and GetSpellTargetUnit()==Source and EF9(GetSpellAbilityId()))then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call UnitRemoveAbility(Source,'B02H')
    call SaveInteger(hashtable019,GetHandleId(Source),'a068',0)
    call G79(Source)
  else
    set WHD=R2I(GetUnitState(Source,UNIT_STATE_LIFE)*(.04+.01*Level))
    set KQF=(LoadInteger(hashtable019,(Cache),(238)))
    if WHD!=KQF then
      call SaveInteger(hashtable019,(Cache),(238),(WHD))
      call SaveInteger(hashtable019,GetHandleId(Source),'a068',WHD)
      call G79(Source)
    endif
  endif
  set t=null
  set Source=null
  return false
endfunction

function Ursa_Enrage takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DEATH)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function KPF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(GetTriggerUnit()))
  call SaveInteger(hashtable019,(Cache),(238),(0))
  set t=null
endfunction

function KUF takes unit Caster,real x,real y,integer Level returns nothing
  call SetUnitPosition(Caster,x,y)
  call IssueImmediateOrderById(Caster,852588)
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\HowlOfTerror\\HowlCaster.mdl",x,y))
  set Caster=null
endfunction

function KVF takes nothing returns boolean
  if(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and IsUnitInGroup(GetFilterUnit(),H88)==false then
    call GroupAddUnit(H88,GetFilterUnit())
    if GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>HD8 then
      call SetUnitState(GetFilterUnit(),UNIT_STATE_LIFE,GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)-HD8)
    else
      call DamageTarget(H98,GetFilterUnit(),1,HD8*1.33)
    endif
  endif
  return false
endfunction

function KWF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local group g
  if GetTriggerEvalCount(t)>10 then
    call KillGroup(HND)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set H88=HND
    set H98=Source
    set HD8=60+20*Level
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,325,Condition(function KVF))
    call KillGroup(g)
    set g=null
    call KUF(Caster,x,y,Level)
    if ModuloInteger(GetTriggerEvalCount(t),2)==0 then
      call KillUnit(CreateUnit(GetOwningPlayer(Source),'e02A',x,y,0))
    endif
    set x=SafeX50(x+200*Cos(J2E*bj_DEGTORAD))
    set y=SafeY50(y+200*Sin(J2E*bj_DEGTORAD))
    call SaveReal(hashtable019,(Cache),(6),((x)*1.))
    call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  endif
  set t=null
  set Source=null
  set Caster=null
  set HND=null
  return false
endfunction

function VS_WaveOfTerror takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x1=GetUnitX(Source)
  local real y1=GetUnitY(Source)
  local real x2=GetSpellTargetX()
  local real y2=GetSpellTargetY()
  local real J2E=AngleBetweenXY(x1,y1,x2,y2)
  local integer Level=GetUnitAbilityLevel(Source,'A17O')
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x1,y1,0)
  call UnitAddAbility2(Caster,'A0AP')
  call SetUnitAbilityLevel(Caster,'A0AP',Level)
  //call RemoveLocation(l)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(6),((x1)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y1)*1.))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveGroupHandle(hashtable019,(Cache),(133),(GetAvailableGroup()))
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function KWF))
  set t=null
  set Source=null
  //set l=null
  set Caster=null
endfunction


function VS_Swap_Helper takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  if IsDead(u)==false then
    call SetUnitPathing(u,true)
  endif
  call FlushChildHashtable(hashtable019,h)
  call CleanTrigger(t)
  set u=null
  set t=null
endfunction

function KZF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real x1=(LoadReal(hashtable019,(Cache),(64)))
  local real x2=(LoadReal(hashtable019,(Cache),(66)))
  local real y1=(LoadReal(hashtable019,(Cache),(65)))
  local real y2=(LoadReal(hashtable019,(Cache),(67)))
  local trigger tt
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl",Source,"origin"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl",Target,"origin"))
  call SetUnitPosition(Source,x2,y2)
  call AddTimedKeyToUnit(Target,4407,1)
  if (IsTerrainPathableFixed(x1,y1)==false or IsPointInRegion(RestrictedRegion,x1,y1)) and IsUnitType(Target,UNIT_TYPE_HERO) then
    set tt=CreateTrigger()
    call SaveUnitHandle(hashtable019,GetHandleId(tt),0,Target)
    call TriggerRegisterTimerEvent(tt,5,false)
    call SetUnitPathing(Target,false)
    call TriggerAddCondition(tt,Condition(function VS_Swap_Helper))
    set tt=null
  endif
  call SetUnitPosition(Target,x1,y1)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function VS_NetherSwap takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real x1=GetUnitX(Source)
  local real y1=GetUnitY(Source)
  local real x2=GetUnitX(Target)
  local real y2=GetUnitY(Target)
  local trigger t
  local integer Cache
  if IsUnitAlly(Source,GetOwningPlayer(Target)) or IsBlocked(GetSpellTargetUnit())==false then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveReal(hashtable019,(Cache),(64),((x1)*1.))
    call SaveReal(hashtable019,(Cache),(66),((x2)*1.))
    call SaveReal(hashtable019,(Cache),(65),((y1)*1.))
    call SaveReal(hashtable019,(Cache),(67),((y2)*1.))
    call TriggerRegisterTimerEvent(t,0,false)
    call TriggerAddCondition(t,Condition(function KZF))
    call ZO8("SPLK",x1,y1,x2,y2,.5,0,1,1,.3)
    call KillTrees(x1,y1,300)
    call KillTrees(x2,y2,300)
  endif
  set Source=null
  set Target=null
  set t=null
endfunction

function VS_NetherSwap_OnCast takes nothing returns nothing
  if(IsTerrainPathable(GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),PATHING_TYPE_WALKABILITY))then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n03B'))
  endif
endfunction

function MagicMissle takes nothing returns nothing
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareMissile.mdl",GetTriggerUnit(),GetProperAttachPoint_Weapon(GetTriggerUnit())))
endfunction

function VS_MagicMissile_OnCast takes nothing returns nothing
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareMissile.mdl",GetTriggerUnit(),GetProperAttachPoint_Weapon(GetTriggerUnit())))
endfunction



function Templar_Trap_Charge takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  
  if count==4 or IsDead(LoadUnitHandle(MHT,info,0))then
    call Timer_End(t)
    set t = null
    return
  endif
  
  set count = count + 1
  call SaveInteger(MHT,info,0,count)
  call SaveInteger(MHT,LoadInteger(MHT,info,1),1,count)
  
  set t = null
endfunction

function Templar_Trap_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if IsDead(t)==false and IsUnitEnemy(group_temp_unit[0],GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R')==0 and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) then
    call Buff_Add(t,group_temp_integer[0],'B08M',5)
  endif
  set t = null
  return false
endfunction

function Templar_Trap_Find takes nothing returns boolean
  local unit t = GetFilterUnit()
  local real d
  local real x
  local real y
  
  if GetUnitTypeId(t)=='e020' and GetWidgetLife(t)>0.405 then
    set x = GetWidgetX(t) - group_temp_real[1]
    set y = GetWidgetY(t) - group_temp_real[2]
    set d = SquareRoot(x*x + y*y)
    
    if group_temp_real[0] > d then
      set group_temp_unit[0] = t
      set group_temp_real[0] = d
    endif
  endif
  set t = null
  return false
endfunction

function Templar_Trap_End_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local integer i
  
  if GetUnitTypeId(t)=='e020' and GetWidgetLife(t)>0.405 then
    set i = LoadInteger(MHT,GetHandleId(t),2)
    
    if group_temp_integer[0]==0 or group_temp_integer[1] > i then
      set group_temp_integer[1] = i
      set group_temp_unit[0] = t
    endif
    
    set group_temp_integer[0] = group_temp_integer[0] + 1
  endif
  set t = null
  return false
endfunction

function Templar_Trap_End takes player p, integer limit returns nothing
  set group_temp_integer[0] = 0
  
  call GroupEnumUnitsOfPlayer(temp_group,p,Condition(function Templar_Trap_End_Targets))
  
  if group_temp_integer[0] > limit then
    call RemoveUnit(group_temp_unit[0])
  endif
endfunction

function Templar_Trap_Start takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local player p = GetOwningPlayer(u)
  local integer info = GetHandleId(u)
  local integer count = LoadInteger(MHT,info,'A0RP')
  local real x
  local real y
  
  if GetUnitTypeId(u)=='e020'then
    set group_temp_unit[0] = u
    set group_temp_integer[0] = LoadInteger(MHT,info,1) + 'A510'
    
    set u  = LoadUnitHandle(MHT,info,0)
    set info = GetHandleId(u)
    set count = LoadInteger(MHT,info,'A0RP')
  else
    set group_temp_unit[0] = null
    set group_temp_real[0] = 99999
    set group_temp_real[1] = GetWidgetX(u)
    set group_temp_real[2] = GetWidgetY(u)
    
    call GroupEnumUnitsOfPlayer(temp_group,p,Condition(function Templar_Trap_Find))
    
    if group_temp_unit[0]==null then
      set u = null
      return
    endif
    
    set group_temp_integer[0] = LoadInteger(MHT,GetHandleId(group_temp_unit[0]),1) + 'A510'
  endif
  
  set x = GetWidgetX(group_temp_unit[0])
  set y = GetWidgetY(group_temp_unit[0])
  
  call GroupEnumUnitsInRange(temp_group,x,y,400,Condition(function Templar_Trap_Targets))
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\TomeOfRetraining\\TomeOfRetrainingCaster.mdl",x,y))
  
  call RemoveUnit(group_temp_unit[0])
  
  set p=null
  set u = null
endfunction

function Templar_Trap_Place takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local player p = GetOwningPlayer(u)
  local unit d = CreateUnit(p,'e020',GetSpellTargetX(),GetSpellTargetY(),0)
  local integer info = GetHandleId(u)
  local integer count = LoadInteger(MHT,info,'A0RP')
  local integer limit = 2 + 3*GetUnitAbilityLevel(u,'A0RP')
  
  call SaveInteger(MHT,info,'A0RP',count + 1)
  
  set info = GetHandleId(d)
  call SaveUnitHandle(MHT,info,0,u)
  call SaveInteger(MHT,info,0,0)
  call SaveInteger(MHT,info,1,0)
  call SaveInteger(MHT,info,2,count)
  call TriggerRegisterUnitEvent(GAME_TRIGGER,d,EVENT_UNIT_SPELL_EFFECT)
  
  call Templar_Trap_End(p,limit)
  
  if p==GetLocalPlayer() and AutoselectionStatus[GetPlayerId(p)]then
    call SelectUnit(d,true)
  endif
  
  set count = GetHandleId(t)
  call SaveInteger(MHT,count,0,0)
  call SaveInteger(MHT,count,1,info)
  call SaveUnitHandle(MHT,count,0,d)
  call TimerStart(t,1,true,function Templar_Trap_Charge)
  
  set d = null //not gut but close \:3/
  set p = null
  set u = null
  set t = null
endfunction

function Templar_Trap_Learn takes nothing returns nothing
  call UnitAddAbility(GetTriggerUnit(),'A0RT')
endfunction


function check_line takes real xc, real xt, real x, real yc, real yt, real y returns boolean
  if (y - yc)*(xt - xc) - (x - xc)*(yt - yc) > 0 then
    return true //to the left
  endif
  
  return false //to the right
endfunction

function check_box takes unit u, real x1a, real x1b, real x2a, real x2b, real y1a, real y1b, real y2a, real y2b returns boolean
  local real a1 = GetWidgetX(u)
  local real a2 = GetWidgetY(u)
  
  //checks to see if the unit is in a box \:D/
  //imba box face >:3
  return check_line(x1a,x1b,a1,y1a,y1b,a2)==false and check_line(x2a,x2b,a1,y2a,y2b,a2) and check_line(x1a,x2a,a1,y1a,y2a,a2) and check_line(x1b,x2b,a1,y1b,y2b,a2)==false
endfunction

function Psi_Blades_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if IsDead(t)==false and IsUnitEnemy(group_temp_unit[0],GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R')==0 and IsMagicImmune(t)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) and t!=GetTriggerUnit() then
    if check_box(t,group_temp_real[0],group_temp_real[1],group_temp_real[2],group_temp_real[3],group_temp_real[4],group_temp_real[5],group_temp_real[6],group_temp_real[7]) then
      call DamageTarget(group_temp_unit[0],t,3,group_temp_real[8])
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PriestMissile\\PriestMissile.mdl",t,"chest"))
    endif
  endif
  set t = null
  return false
endfunction

function Psi_Blades_Display_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local integer loopA
  local integer a = 0
  
  if GetLocalPlayer()==LoadPlayerHandle(MHT,info,4) then
    set a = 1
  endif
  
  if count==10 then
    call DestroyLightning(LoadLightningHandle(MHT,info,3))
    call DestroyLightning(LoadLightningHandle(MHT,info,2))
    call DestroyLightning(LoadLightningHandle(MHT,info,1))
    call DestroyLightning(LoadLightningHandle(MHT,info,0))
    
    call Timer_End(t)
    set t = null
    return
  endif
  
  set loopA = 0
  call SaveInteger(MHT,info,0,count + 1)
  
  set count = 65 + 15*count
  
  loop
    exitwhen loopA==4
    call SetLightningColor(LoadLightningHandle(MHT,info,loopA),count,count,count,a)
    set loopA = loopA + 1
  endloop
  
  set t = null
endfunction

function Psi_Blades_Display takes player p returns nothing
  local lightning l = null
  local timer t = Timer_Get()
  local integer info = GetHandleId(t)
  local integer a = 0
  
  if GetLocalPlayer()==p then
    set a = 1
  endif
  
  call SaveInteger(MHT,info,0,0)
  
  set l = AddLightning("DRAB",false,group_temp_real[0],group_temp_real[4],group_temp_real[1],group_temp_real[5])
  call SetLightningColor(l,50,50,50,a)
  call SaveLightningHandle(MHT,info,0,l)
  
  set l = AddLightning("DRAB",false,group_temp_real[0],group_temp_real[4],group_temp_real[2],group_temp_real[6])
  call SetLightningColor(l,50,50,50,a)
  call SaveLightningHandle(MHT,info,1,l)
  
  set l = AddLightning("DRAB",false,group_temp_real[2],group_temp_real[6],group_temp_real[3],group_temp_real[7])
  call SetLightningColor(l,50,50,50,a)
  call SaveLightningHandle(MHT,info,2,l)
  
  set l = AddLightning("DRAB",false,group_temp_real[3],group_temp_real[7],group_temp_real[1],group_temp_real[5])
  call SetLightningColor(l,50,50,50,a)
  call SaveLightningHandle(MHT,info,3,l)
  
  call SavePlayerHandle(MHT,info,4,p)
  
  call TimerStart(t,.05,true,function Psi_Blades_Display_End)
  set l = null
  set t = null
endfunction

function Psi_Blades_Effect takes unit u, real range, real angle, real damage, real x, real y returns nothing
  
  //fucking math
  
  local player p = GetOwningPlayer(u)
  local real a1 = angle + bj_PI/2
  local real a2 = angle - bj_PI/2
  local real x1a = x + 55*Cos(a1)
  local real y1a = y + 55*Sin(a1)
  local real x2a = x + 55*Cos(a2)
  local real y2a = y + 55*Sin(a2)
  local real x1b
  local real y1b
  local real x2b
  local real y2b
  
  set a1 = range*Cos(angle)
  set a2 = range*Sin(angle)
  
  set x1b = x1a + a1
  set y1b = y1a + a2
  set x2b = x2a + a1
  set y2b = y2a + a2
  
  set group_temp_unit[0] = u
  set group_temp_real[0] = x1a
  set group_temp_real[1] = x1b
  set group_temp_real[2] = x2a
  set group_temp_real[3] = x2b
  set group_temp_real[4] = y1a
  set group_temp_real[5] = y1b
  set group_temp_real[6] = y2a
  set group_temp_real[7] = y2b
  set group_temp_real[8] = damage
  
  if LoadBoolean(MHT,GetHandleId(p),'A0RO')then
    call Psi_Blades_Display(p)
  endif
  
  call GroupEnumUnitsInRange(temp_group,x,y,range,Condition(function Psi_Blades_Targets))
  set p=null
endfunction

function Psi_Blades_Detect takes nothing returns boolean
  local unit u = null
  local unit t = null
  local trigger trig = GetTriggeringTrigger()
  local integer info = GetHandleId(trig)
  local real damage
  local real x
  local real y
  
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    set t = GetTriggerUnit()
    set u = GetEventDamageSource()
    set damage = GetEventDamage()
    
    if LoadUnitHandle(MHT,info,0)==u and damage>1 and IsFakeDamage==false and IsRealDamage and IsDead(t)==false then
      
      set x = GetWidgetX(t)
      set y = GetWidgetY(t)
      
      call DisableTrigger(trig)
      call Psi_Blades_Effect(u,575 + IMaxIF(GetUnitAbilityLevel(u,'A0RO'),GetUnitAbilityLevel(u,'QP1S'))*40,Atan2(y-LoadReal(MHT,info,1),x-LoadReal(MHT,info,0)),damage,x,y)
      
      call FlushChildHashtable(MHT,info)
      call CleanTrigger(trig)
      
    endif
    
    set t = null
    set u = null
  endif
  
  call FlushChildHashtable(MHT,info)
  call CleanTrigger(trig)
  set trig = null
  return false
endfunction

function Psi_Blades_Cooldown takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  
  call SaveBoolean(MHT,LoadInteger(MHT,info,0),'A0RO',true)
  
  call Timer_End(t)
  set t = null
endfunction

function Psi_Blades_Start takes unit u, unit t, integer level returns nothing
  local timer time = Timer_Get()
  local trigger trig = CreateTrigger()
  local integer info = GetHandleId(trig)
  
  call TriggerRegisterUnitEvent(trig,t,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(trig,2.5,false)
  
  call TriggerAddCondition(trig,Condition(function Psi_Blades_Detect))
  
  call SaveUnitHandle(MHT,info,0,u)
  call SaveReal(MHT,info,0,GetWidgetX(u))
  call SaveReal(MHT,info,1,GetWidgetY(u))
  
  set info = GetHandleId(u)
  call SaveBoolean(MHT,info,'A0RO',false)
  call SaveInteger(MHT,GetHandleId(time),0,info)
  
  call TimerStart(time,0.4,false,function Psi_Blades_Cooldown)
  
  set time=null
  set trig = null
endfunction

function Psi_Blades_Condition takes unit u, unit t returns nothing
  local integer level = IMaxIF(GetUnitAbilityLevel(u,'A0RO'),GetUnitAbilityLevel(u,'QP1S'))
  
  if level>0 and LoadBoolean(MHT,GetHandleId(u),'A0RO') and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and IsUnitIllusion(t)==false then
    call Psi_Blades_Start(u,t,level)
  endif
endfunction

function Psi_Blades_Display_Toggle takes nothing returns nothing
  local player p = GetTriggerPlayer()
  local integer info = GetHandleId(p)
  local boolean b = LoadBoolean(MHT,info,'A0RO')
  
  call SaveBoolean(MHT,info,'A0RO',b==false)
  
  if b then
    call DisplayTextToPlayer(p,0,0,"Turning Psi Blades Display |c00FF0000OFF|r")
  else
    call DisplayTextToPlayer(p,0,0,"Turning Psi Blades Display |c0000FF00ON|r")
  endif
  set p=null
endfunction

function Psi_Blades_Init takes unit u returns nothing
  local player p = GetOwningPlayer(u)
  
  call TriggerRegisterPlayerChatEvent(CHAT_TRIGGER,p,"-display",true)
  call DisplayTextToPlayer(p,0,0,"Type -display to display the Area of Effect for Psi Blades")
  set p=null
endfunction

function TemplarAssassin_PsiBlades_Leveling takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local integer level = IMaxIF(GetUnitAbilityLevel(u,'A0RO'),GetUnitAbilityLevel(u,'QP1S'))
  
  call SetUnitAcquireRange(u,GetUnitAcquireRange(u) + 60)
  call SetPlayerTechResearched(GetOwningPlayer(u),'Repb',level)
  
  if level==1 then
    call Psi_Blades_Init(u)
    call SaveBoolean(MHT,GetHandleId(u),'A0RO',true)
  endif
  
  set u = null
endfunction



function N7F takes nothing returns boolean
  local unit Hero=GetTriggerUnit()
  local integer Cache=GetHandleId(Hero)
  local integer Y59=(LoadInteger(hashtable019,(Cache),(352)))
  if Y59>0 and GetTriggerEventId()!=EVENT_UNIT_DEATH then
    if GetEventDamage()>5 and IsRealDamage then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PriestMissile\\PriestMissile.mdl",Hero,"right hand"))
      call HealUnitFor(Hero,GetEventDamage())
      call SaveInteger(hashtable019,(Cache),(352),(Y59-1))
    endif
  else
    call UnitRemoveAbility(Hero,'A0RN')
    call UnitRemoveAbility(Hero,'B08J')
    call SaveInteger(hashtable019,(Cache),(352),(0))
  endif
  set Hero=null
  return false
endfunction

function N8F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local unit Hero=(LoadUnitHandle(hashtable019,(GetHandleId(t)),(14)))
  local integer Cache=GetHandleId(Hero)
  local integer Y59=(LoadInteger(hashtable019,(Cache),(351)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED and GetAttacker()==Hero and IsUnitAlly(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))==false)then
    if GetTriggerEventId()!=EVENT_UNIT_DEATH and Y59>0 and GetEventDamage()>0 then
      call SaveInteger(hashtable019,(Cache),(351),(Y59-1))
    else
      call UnitRemoveAbility(Hero,'A0RF')
      call UnitRemoveAbility(Hero,'A0RM')
      call UnitRemoveAbility(Hero,'B08I')
      call SaveInteger(hashtable019,(Cache),(351),(0))
    endif
  endif
  set t=null
  set Hero=null
  return false
endfunction

function N9F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local unit Hero=(LoadUnitHandle(hashtable019,(GetHandleId(t)),(14)))
  local integer Cache=GetHandleId(Hero)
  call SaveInteger(hashtable019,(Cache),(352),(0))
  call SaveInteger(hashtable019,(Cache),(351),(0))
  call UnitRemoveAbility(Hero,'A0RF')
  call UnitRemoveAbility(Hero,'A0RM')
  call UnitRemoveAbility(Hero,'A0RN')
  call FlushChildHashtable(hashtable019,(GetHandleId(t)))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  return false
endfunction

function TA_Refraction takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local integer Cache=GetHandleId(Hero)
  local trigger t=CreateTrigger()
  local integer c=GetUnitAbilityLevel(Hero,GetSpellAbilityId())+2
  call TriggerRegisterTimerEvent(t,17,false)
  call TriggerAddCondition(t,Condition(function N9F))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(Hero))
  call PlaySoundAtPos(integer009,GetUnitX(Hero),GetUnitY(Hero))
  call UnitAddAbility2(Hero,'A0RN')
  if Mode_EB then
    set c=c-1
  endif
  call SaveInteger(hashtable019,(Cache),(352),c)
  call UnitAddAbility2(Hero,'A0RF')
  call SetUnitAbilityLevel(Hero,'A0RF',GetUnitAbilityLevel(Hero,GetSpellAbilityId()))
  call UnitAddAbility2(Hero,'A0RM')
  call SaveInteger(hashtable019,(Cache),(351),c)
  set Hero=null
  set t=null
endfunction

function TemplarAssassin_Refraction_Learn takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function N7F))
  call SaveInteger(hashtable019,(GetHandleId(Hero)),(352),(0))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function N8F))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(Hero))
  call SaveInteger(hashtable019,(GetHandleId(Hero)),(351),(0))
  set t=null
  set Hero=null
endfunction

function NFF takes nothing returns boolean
  if (GetLearnedSkill()=='A1EA' or GetLearnedSkill()=='QB03') and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call TemplarAssassin_Refraction_Learn()
  endif
  return false
endfunction

function S79 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function NFF))
  set t=null
endfunction

function NHF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  call UnitRemoveAbility((LoadUnitHandle(hashtable019,(GetHandleId(t)),(14))),'A0RC')
  call FlushChildHashtable(hashtable019,(GetHandleId(t)))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function NIF takes unit Source,unit Target returns nothing
  local trigger t=CreateTrigger()
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(Target))
  call TriggerRegisterTimerEvent(t,10,false)
  call TriggerAddCondition(t,Condition(function NHF))
  call UnitAddAbility2(Target,'A0RC')
  call SetUnitAbilityLevel(Target,'A0RC',GetUnitAbilityLevel(Source,'A0RV'))
  call DamageTarget(Source,Target,2,50*GetUnitAbilityLevel(Source,'A0RV'))
  call TextTagOnUnit(I2S(50*GetUnitAbilityLevel(Source,'A0RV')),1,Target,.03,255,0,0,255)
  call UnitRemoveAbility(Source,'B08K')
  set t=null
endfunction

function NJF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local trigger NKF=(LoadTriggerHandle(hashtable019,(Cache),(353)))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source then
      call DisableTrigger(t)
      call FlushChildHashtable(hashtable019,(GetHandleId(NKF)))
      call CleanTrigger(NKF)
      call NIF(Source,Target)
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  set Source=null
  set NKF=null
  return false
endfunction

function NMF takes unit Source,unit Target,trigger NKF returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(t,2.,false)
  call TriggerAddCondition(t,Condition(function NJF))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveTriggerHandle(hashtable019,(Cache),(353),(NKF))
  set t=null
endfunction

function NNF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEventId()==EVENT_UNIT_SPELL_CAST or(GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED and GetAttacker()==Hero and IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(Hero))==false)then
    if GetTriggerEventId()!=EVENT_UNIT_DEATH and GetTriggerEventId()!=EVENT_UNIT_SPELL_CAST and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false then
      call NMF(Hero,GetTriggerUnit(),t)
      call UnitRemoveAbility(Hero,'B08K')
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
    if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEventId()==EVENT_UNIT_SPELL_CAST then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  elseif GetTriggerEventId()!=EVENT_PLAYER_UNIT_ATTACKED then
    if x!=GetUnitX(Hero)or y!=GetUnitY(Hero)then
      call UnitRemoveAbility(Hero,'B08K')
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set Hero=null
  return false
endfunction

function TA_Meld takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call DestroyEffect(AddSpecialEffectTarget("effects\\PurpleAura.mdx",Hero,"origin"))
  call PlaySoundAtPos(boolean020,GetUnitX(Hero),GetUnitY(Hero))
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_SPELL_CAST)
  call TriggerRegisterTimerEvent(t,.2,true)
  call TriggerAddCondition(t,Condition(function NNF))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Hero))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Hero))*1.))
  call IssueImmediateOrderById(Hero,851993)
  set t=null
  set Hero=null
endfunction

function NQF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer NRF=(LoadInteger(hashtable019,(Cache),(247)))
  call DestroyEffect(AddSpecialEffect("effects\\Tornado.mdx",GetUnitX(Source),GetUnitY(Source)))
  if GetTriggerEvalCount(t)>10*(2+.75*Level)or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitRemoveAbility(Source,NRF)
    call UnitRemoveAbility(Source,'B09W')
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  return false
endfunction

function WR_Windrun takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A14I')
  local integer NRF
  if Level==1 then
    set NRF='A135'
  elseif Level==2 then
    set NRF='A12O'
  elseif Level==3 then
    set NRF='A134'
  elseif Level==4 then
    set NRF='A139'
  endif
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),NRF,false)
  call AddTimedAbility(Source,NRF,1,2+.75*Level)
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function NQF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(247),(NRF))
  call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("effects\\Tornado.mdx",Source,"hand,left")))
  call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffectTarget("effects\\Tornado.mdx",Source,"hand,right")))
  set Source=null
  set t=null
endfunction

function NUF takes nothing returns nothing
  local destructable Target=GetEnumDestructable()
  local real a=Atan2(GetDestructableY(Target)-GetUnitY(tt_unit1),GetDestructableX(Target)-GetUnitX(tt_unit1))
  local real KXD=RAbsBJ((tt_real1-a)*bj_RADTODEG)
  if(WA8(Target)or GetDestructableTypeId(Target)=='B005')and GetDestructableLife(Target)>1 and KXD<HG8 and KXD<(HH8-5)then
    set HG8=KXD
    set HE8=Target
  endif
  set Target=null
endfunction

function NVF takes unit Projectile,unit Source,real J2E returns destructable
  local real x=GetUnitX(Projectile)
  local real y=GetUnitY(Projectile)
  local rect r=Rect(x-HJ8,y-HJ8,x+HJ8,y+HJ8)
  set HG8=9999
  set tt_unit1=Projectile
  set HE8=null
  call EnumDestructablesInRect(r,Condition(function ReturnTrue2),function NUF)
  call RemoveRect(r)
  set r=null
  return HE8
endfunction

function NWF takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local real a=Atan2(GetUnitY(Target)-GetUnitY(tt_unit1),GetUnitX(Target)-GetUnitX(tt_unit1))
  local real KXD=RAbsBJ((tt_real1-a)*bj_RADTODEG)
  if KXD<HG8 and KXD<HH8 and Target!=tt_unit2 then
    set HG8=KXD
    set HF8=Target
  endif
  set Target=null
endfunction

function NXF takes unit Projectile,unit Source,real J2E returns unit
  local group g=GetAvailableGroup()
  set HF8=null
  set HG8=9999
  set tt_unit1=Projectile
  set tt_real1=Atan2(GetUnitY(Source)-HM8,GetUnitX(Source)-HK8)
  set tt_unit2=Source
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),HI8,Condition(function NonImmuneEnemyFilter))
  call ForGroup(g,function NWF)
  call KillGroup(g)
  set g=null
  return HF8
endfunction

function NYF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  if(LoadLightningHandle(hashtable019,(Cache),(196)))!=null then
    call DestroyLightning((LoadLightningHandle(hashtable019,(Cache),(196))))
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function NZF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real NAF=(LoadReal(hashtable019,(Cache),(248)))
  local real J2E=Atan2(GetUnitY(Target)-GetUnitY(Projectile),GetUnitX(Target)-GetUnitX(Projectile))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real x=GetUnitX(Projectile)+50*Cos(J2E)
  local real y=GetUnitY(Projectile)+50*Sin(J2E)
  local unit NBF
  local destructable d
  local lightning ZQ8
  local unit Caster
  local boolean DCD=(LoadBoolean(hashtable019,(Cache),(249)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call KillUnit(Projectile)
  else
    call SetUnitX(Projectile,x)
    call SetUnitY(Projectile,y)
    call SetUnitFacing(Projectile,J2E*bj_RADTODEG)
    if DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))<45 then
      set HK8=(LoadReal(hashtable019,(Cache),(6)))
      set HM8=(LoadReal(hashtable019,(Cache),(7)))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      if GetUnitTypeId(Target)!='n00L' and DCD then
        set NBF=NXF(Projectile,Target,NAF)
        set d=NVF(Projectile,Target,NAF)
        if NBF!=null then
          set t=CreateTrigger()
          set Cache=GetHandleId(t)
          set Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
          call UnitAddAbility2(Caster,'A12I')
          call SetUnitAbilityLevel(Caster,'A12I',Level+1)
          call IssueTargetOrderById(Caster,852095,Target)
          set Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(NBF),GetUnitY(NBF),0)
          call UnitAddAbility2(Caster,'A12I')
          call SetUnitAbilityLevel(Caster,'A12I',Level+1)
          call IssueTargetOrderById(Caster,852095,NBF)
          call TriggerRegisterTimerEvent(t,.25+Level*.75,false)
          call TriggerAddCondition(t,Condition(function NYF))
          set ZQ8=AddLightning("MFPB",true,GetUnitX(Target),GetUnitY(Target),GetUnitX(NBF),GetUnitY(NBF))
          call SetLightningColor(ZQ8,.5,.5,1,1)
          call SaveLightningHandle(hashtable019,(Cache),(196),(ZQ8))
        elseif d!=null then
          set t=CreateTrigger()
          set Cache=GetHandleId(t)
          set Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
          call UnitAddAbility2(Caster,'A12I')
          call SetUnitAbilityLevel(Caster,'A12I',Level+1)
          call IssueTargetOrderById(Caster,852095,Target)
          call TriggerRegisterTimerEvent(t,.25+Level*.75,false)
          call TriggerAddCondition(t,Condition(function NYF))
          set ZQ8=AddLightning("MFPB",true,GetUnitX(Target),GetUnitY(Target),GetDestructableX(d),GetDestructableY(d))
          call SetLightningColor(ZQ8,.5,.5,1,1)
          call SaveLightningHandle(hashtable019,(Cache),(196),(ZQ8))
          call SetDestructableAnimation(d,"stand hit")
        else
          set Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
          call UnitAddAbility2(Caster,'A12I')
          call SetUnitAbilityLevel(Caster,'A12I',1)
          call IssueTargetOrderById(Caster,852095,Target)
        endif
      endif
      call KillUnit(Projectile)
    endif
  endif
  set t=null
  set Projectile=null
  set Target=null
  set ZQ8=null
  set NBF=null
  set d=null
  set Caster=null
  return false
endfunction

function WR_Shacleshot takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real J2E=Atan2(GetUnitY(Target)-GetUnitY(Source),GetUnitX(Target)-GetUnitX(Source))
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=CreateUnit(GetOwningPlayer(Source),'h077',GetUnitX(Source),GetUnitY(Source),J2E*bj_RADTODEG)
  local integer Level=GetUnitAbilityLevel(Source,'A12J')
  local boolean DCD=IsBlocked(GetSpellTargetUnit())==false
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(248),((J2E)*1.))
  call SaveBoolean(hashtable019,(Cache),(249),(DCD))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Source))*1.))
  call TriggerRegisterTimerEvent(t,.033,true)
  call TriggerAddCondition(t,Condition(function NZF))
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  set Source=null
  set Target=null
  set Projectile=null
  set t=null
endfunction

function N6F takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),HN8)==false and GetUnitAbilityLevel(GetEnumUnit(),'Bcyc')==0 then
    call DamageTarget((HO8),(GetEnumUnit()),1,(((HP8)*1.))*Pow(.9,(HR8))*Pow(.99,(HQ8)))
    call GroupAddUnit(HN8,GetEnumUnit())
    set HR8=HR8+1
  endif
endfunction

function NLF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  local integer N1F=(LoadInteger(hashtable019,(Cache),(354)))
  local integer N0F=(LoadInteger(hashtable019,(Cache),(355)))
  local group AlreadyHit=(LoadGroupHandle(hashtable019,(Cache),(187)))
  local real x=SafeX50(GetUnitX(Projectile)+(60*Pow(.9,N0F)*Pow(.99,N1F))*Cos(J2E))
  local real y=SafeY50(GetUnitY(Projectile)+(60*Pow(.9,N0F)*Pow(.99,N1F))*Sin(J2E))
  local group g=GetAvailableGroup()
  local real d
  if GetTriggerEvalCount(t)>2 then
    set d=150
  else
    set d=75
  endif
  call DestroyEffect(AddSpecialEffect("effects\\Tornado.mdx",x,y))
  set N1F=N1F+KillTrees(x,y,75)
  call SaveInteger(hashtable019,(Cache),(354),(N1F))
  set HN8=AlreadyHit
  set HO8=Projectile
  set HP8=Damage
  set HQ8=N1F
  set HR8=N0F
  set tt_unit1=Projectile
  call GroupEnumUnitsInRange(g,x,y,d,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function N6F)
  call KillGroup(g)
  call SaveInteger(hashtable019,(Cache),(355),(HR8))
  call SetUnitX(Projectile,x)
  call SetUnitY(Projectile,y)
  if GetTriggerEvalCount(t)>29 then
    call KillUnit(Projectile)
    call KillGroup(AlreadyHit)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Projectile=null
  set AlreadyHit=null
  set g=null
  return false
endfunction

function N5F takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x2=(LoadReal(hashtable019,(GetHandleId(Source)),(356)))
  local real y2=(LoadReal(hashtable019,(GetHandleId(Source)),(357)))
  local real N2F=RMinIF((TimerGetElapsed(GlobalTimer))-(LoadReal(hashtable019,(GetHandleId(Source)),(358))),1.)
  local real J2E=Atan2(y2-GetUnitY(Source),x2-GetUnitX(Source))
  local trigger t
  local integer Cache
  local unit Projectile
  local integer Level=GetUnitAbilityLevel(Source,'A12K')
  local real Damage=(40+80*Level)*(N2F)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  set Projectile=CreateUnit(GetOwningPlayer(Source),'h078',GetUnitX(Source),GetUnitY(Source),J2E*bj_RADTODEG)
  set x2=GetUnitX(Source)+1700*Cos(J2E)
  set y2=GetUnitY(Source)+1700*Sin(J2E)
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveReal(hashtable019,(Cache),(47),((x2)*1.))
  call SaveReal(hashtable019,(Cache),(48),((y2)*1.))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveReal(hashtable019,(Cache),(20),((Damage)*1.))
  call SaveInteger(hashtable019,(Cache),(354),(0))
  call SaveInteger(hashtable019,(Cache),(355),(0))
  call SaveGroupHandle(hashtable019,(Cache),(187),(GetAvailableGroup()))
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function NLF))
  set Source=null
  set t=null
  set Projectile=null
endfunction

function O4F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  call SetUnitTimeScale(Hero,1)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  return false
endfunction

function O7F takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local location l=GetSpellTargetLoc()
  local real x=GetLocationX(l)
  local real y=GetLocationY(l)
  call RemoveLocation(l)
  call SaveReal(hashtable019,(GetHandleId(Hero)),(356),((x)*1.))
  call SaveReal(hashtable019,(GetHandleId(Hero)),(357),((y)*1.))
  call SaveReal(hashtable019,(GetHandleId(Hero)),(358),(((TimerGetElapsed(GlobalTimer)))*1.))
  call SetUnitTimeScale(Hero,.75)
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call TriggerRegisterTimerEvent(t,.75,false)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function O4F))
  set t=null
  set Hero=null
  set l=null
endfunction

function O8F takes nothing returns boolean
  if GetSpellAbilityId()=='A12K' then
    if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_CAST then
      call SaveBoolean(hashtable019,(GetHandleId(GetTriggerUnit())),(360),(false))
      call O7F()
      //elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT then
      //call SaveBoolean(HY,(GetHandleId(GetTriggerUnit())),(360),(true))
    elseif(LoadBoolean(hashtable019,(GetHandleId(GetTriggerUnit())),(360))) then
      call N5F()
    endif
  endif
  return false
endfunction

function WR_Powershot takes nothing returns nothing
  call SaveBoolean(hashtable019,(GetHandleId(GetTriggerUnit())),(360),(true))
endfunction

function T49 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_ENDCAST)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function O8F))
  set t=null
endfunction

function O9F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local real QQE=(LoadReal(hashtable019,(Cache),(193)))
  local boolean RIE=(LoadBoolean(hashtable019,(Cache),(15)))
  if GetTriggerEvalCount(t)==1 then
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  endif
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetAttacker()==Source and GetTriggerUnit()==Target then
      call DestroyEffect(AddSpecialEffectTarget("effects\\Tornado.mdx",Source,"hand,left"))
      call DestroyEffect(AddSpecialEffectTarget("effects\\Tornado.mdx",Source,"hand,right"))
      if GetUnitAbilityLevel(Source,'A12R')==0 then
        call UnitAddAbility2(Source,'A12R')
        call UnitMakeAbilityPermanent(Source,true,'A12S')
        call UnitMakeAbilityPermanent(Source,true,'A12Q')
      endif
    elseif GetAttacker()==Source and GetTriggerUnit()!=Target then
      call UnitRemoveAbility(Source,'A12R')
      call UnitRemoveAbility(Source,'B09X')
      //call UnitAsInteger_Clear(XK8)
      //call FlushChildHashtable(HY,(Cache))
      //call CleanTrigger(t)
      call UnitRemoveAbility(Source,'A1FK')
      call UnitRemoveAbility(Source,'A1FL')
      call UnitRemoveAbility(Source,'A1FJ')
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source and RIE==false and IsRealDamage then
      call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+(QQE)*GetEventDamage())
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if GetSpellAbilityId()=='A12P' or GetSpellAbilityId()=='A1D6' then
      if GetUnitAbilityLevel(Source,'A12R')>0 then
        call UnitRemoveAbility(Source,'A12R')
      endif
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    call UnitRemoveAbility(Source,'A12R')
    call UnitRemoveAbility(Source,'B09X')
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call UnitRemoveAbility(Source,'A1FK')
    call UnitRemoveAbility(Source,'A1FL')
    call UnitRemoveAbility(Source,'A1FJ')
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function ODF takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A12P')
  local real QQE=.6-Level*.1
  local boolean RIE=false
  call UnitRemoveAbility(Source,'A12R')
  call UnitRemoveAbility(Source,'B09X')
  if Level==0 then
    call UnitRemoveAbility(Source,'A1FK')
    call UnitRemoveAbility(Source,'A1FL')
    call UnitRemoveAbility(Source,'A1FJ')
    set RIE=true
    set Level=GetUnitAbilityLevel(Source,'A1D6')
    set QQE=.6-Level*.15
    if Level==1 then
      call UnitAddAbility2(Source,'A1FK')
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1FK',false)
    elseif Level==2 then
      call UnitAddAbility2(Source,'A1FL')
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1FL',false)
    elseif Level==3 then
      call UnitAddAbility2(Source,'A1FJ')
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1FJ',false)
    endif
  endif
  call SetPlayerAbilityAvailable(GetOwningPlayer(Source),'A12R',false)
  call UnitAddAbility2(Source,'A12R')
  call UnitMakeAbilityPermanent(Source,true,'A12S')
  call UnitMakeAbilityPermanent(Source,true,'A12Q')
  call IssueTargetOrderById(Source,851983,Target)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveBoolean(hashtable019,(Cache),(15),(RIE))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveReal(hashtable019,(Cache),(193),((QQE)*1.))
  call SaveInteger(hashtable019,(Cache),(361),(0))
  call TriggerRegisterTimerEvent(t,20,false)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function O9F))
  set Source=null
  set Target=null
  set t=null
endfunction

function WR_FocusFire takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call ODF()
  endif
endfunction

function FocusFire_CloseToAttack takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=LoadUnitHandle(MHT,h,0)
  local unit target=LoadUnitHandle(MHT,h,1)
  if GetTriggerEventId()==EVENT_UNIT_ATTACKED and GetTriggerUnit()==target and GetAttacker()==caster then
    call DisableTrigger(t)
    call DisableTrigger(LoadTriggerHandle(MHT,h,2))
    call IssueTargetOrder(caster,"incineratearrowon",target)
    call EnableTrigger(t)
    call EnableTrigger(LoadTriggerHandle(MHT,h,2))
  endif
  if (GetIssuedOrderId()!=851983 and GetIssuedOrderId()!=851973) then
    call DestroyTrigger(t)
    call FlushChildHashtable(MHT,h)
    //call BJDebugMsg("destroyed")
  endif
  
  set t=null
  set caster=null
  set target=null
endfunction

function FocusFireDynamicRange takes nothing returns nothing
  local integer h
  local trigger t
  local unit caster
  local unit target
  if(GetSpellAbilityId()=='A12P' or GetSpellAbilityId()=='A1D6') then
    set t=CreateTrigger()
    set h=GetHandleId(t)
    set caster=GetTriggerUnit()
    set target=GetSpellTargetUnit()
    call IssueTargetOrderById(caster,851983,target)//attack
    call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_ATTACKED)
    call TriggerRegisterUnitEvent(t,caster,EVENT_UNIT_DEATH)
    call TriggerRegisterUnitEvent(t,caster,EVENT_UNIT_ISSUED_ORDER)
    call TriggerRegisterUnitEvent(t,caster,EVENT_UNIT_ISSUED_POINT_ORDER)
    call TriggerRegisterUnitEvent(t,caster,EVENT_UNIT_ISSUED_TARGET_ORDER)
    call TriggerAddCondition(t,Condition(function FocusFire_CloseToAttack))
    call SaveUnitHandle(MHT,h,0,caster)
    call SaveUnitHandle(MHT,h,1,target)
    call SaveTriggerHandle(MHT,h,2,GetTriggeringTrigger())
    set t=null
    set caster=null
    set target=null
  endif
  
endfunction

function T79 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function FocusFireDynamicRange))
  set t=null
endfunction

function OFF takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and GetUnitTypeId(GetFilterUnit())!='H00J' and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(HS8)))!=null
endfunction

function OGF takes nothing returns nothing
  local real x=GetUnitX(GetEnumUnit())
  local real y=GetUnitY(GetEnumUnit())
  local unit d=CreateUnit(GetOwningPlayer(HS8),'e000',x,y,0)
  call UnitAddAbility(d,'Aloc')
  call UnitApplyTimedLife(d,'BTLF',3)
  if GetSpellAbilityId()=='A29G' then
    call UnitAddAbility(d,'A06L')
    call SetUnitAbilityLevel(d,'A06L',GetUnitAbilityLevel(HS8,'A29G'))
  else
    call UnitAddAbility(d,'A07C')
    call SetUnitAbilityLevel(d,'A07C',GetUnitAbilityLevel(HS8,'A29H'))
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A1HX')==0 then
    call IssueTargetOrderById(d,852119,GetEnumUnit())
  endif
  set d=null
endfunction

function Zeus_WrathOfGod takes nothing returns nothing
  local group g=GetAvailableGroup()
  set HS8=GetTriggerUnit()
  call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function OFF))
  call ForGroup(g,function OGF)
  call KillGroup(g)
  set g=null
endfunction


function Zeus_Static_Field_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local unit u = group_temp_unit[0]
  
  if IsUnitEnemy(u,GetOwningPlayer(t)) and IsDead(t)==false and IsMagicImmune(t)==false and GetUnitAbilityLevel(t,'A04R')==0 and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(t)!='n00L' then
    call DamageTarget(u,t,1,GetWidgetLife(t)*(0.03 + 0.02*group_temp_integer[0]))
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\ForkedLightning\\ForkedLightningTarget.mdl",t,"overhead"))
  endif
  set u = null
  set t = null
  return false
endfunction

function Zeus_Static_Field_Condition takes unit u, integer spell returns nothing
  set group_temp_integer[0] = IMaxIF(GetUnitAbilityLevel(u,'A0N5'),GetUnitAbilityLevel(u,'QP1T'))
  if group_temp_integer[0]>0 and ((isPoisonArrowSkill(spell)==false and isItemSpellOrNoCd(spell)==false and isDummyAbility(spell)==false and isAintItemAbility(spell) and IsItemAbilityById(spell)==false and GetUnitAbilityLevel(u,'A04R')==0 and isFormlessAbility(spell)==false)or(Mode_BO and BalanceOffSpellChecker(spell))) then
    set group_temp_unit[0] = u
    call GroupEnumUnitsInRange(temp_group,GetWidgetX(u),GetWidgetY(u),1025,Condition(function Zeus_Static_Field_Targets))
  endif
endfunction

function ORF takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e000',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,'A05S')
  call SetUnitAbilityLevel(Caster,'A05S',GetUnitAbilityLevel(Hero,'A0JC'))
  call IssueTargetOrderById(Caster,852119,Target)
  call UnitApplyTimedLife(Caster,'BTLF',3)
  call SetUnitPathing(Caster,false)
  call UnitAddAbility2(Caster,'Aloc')
  set Hero=null
  set Target=null
  set Caster=null
endfunction

function Zeus_LightningBolt takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call ORF()
  endif
endfunction

function OSF takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit Source=LoadUnitHandle(hashtable019,h,2)
  local unit Caster=LoadUnitHandle(hashtable019,h,19)
  local integer count=LoadInteger(hashtable019,h,0)+1
  call SaveInteger(hashtable019,h,0,count)
  call SetUnitX(Caster,GetUnitX(Source))
  call SetUnitY(Caster,GetUnitY(Source))
  if count>80 then
    call FlushChildHashtable(hashtable019,h)
    call PauseTimer(t)
    call DestroyTimer(t)
  endif
  set t=null
  set Source=null
  set Caster=null
  
endfunction

function OTF takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e02C',GetUnitX(Source),GetUnitY(Source),0)
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call UnitAddAbility2(Caster,'A1FM')
  call SetUnitAbilityLevel(Caster,'A1FM',GetUnitAbilityLevel(Source,'A020'))
  call IssueTargetOrderById(Caster,852119,Target)
  call UnitApplyTimedLife(Caster,'BTLF',10)
  call SaveUnitHandle(hashtable019,h,2,Source)
  call SaveUnitHandle(hashtable019,h,19,Caster)
  call TimerStart(t,0.05,true,function OSF)
  set Source=null
  set Target=null
  set Caster=null
  set t=null
endfunction

function Zeus_ChainLightning takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call OTF()
  endif
endfunction

function OWF takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  call DamageTarget(Hero,Hero,3,Damage)
  call FlushChildHashtable(hashtable019,(Cache))
  call PauseTimer(t)
  call DestroyTimer(t)
  set t=null
  set Hero=null
endfunction

function OXF takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real Damage=25+25*GetUnitAbilityLevel(Hero,('A0I3'))
  local timer t=CreateTimer()
  local integer Cache=GetHandleId(t)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",Target,"origin"))
  if IsUnitAlly(Target,GetOwningPlayer(Hero))and GetUnitState(Target,UNIT_STATE_LIFE)>1. then
    call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+2*Damage)
  else
    call DamageTarget(Hero,Target,1,2*Damage)
  endif
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveReal(hashtable019,(Cache),(20),((Damage+25)*1.))
  call TimerStart(t,0,false,function OWF)
  set Hero=null
  set Target=null
  set t=null
endfunction

function Abaddon_DeathCoil takes nothing returns nothing
  if (IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))or IsBlocked(GetSpellTargetUnit())==false) then
    call OXF()
  endif
endfunction

function OYF takes nothing returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(HU8),'e00E',GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
  call UnitAddAbility2(Caster,'A0MJ')
  call SetUnitAbilityLevel(Caster,'A0MJ',HV8)
  call IssueTargetOrderById(Caster,852587,GetEnumUnit())
  set Caster=null
endfunction

function OZF takes unit Source,unit Target,integer Level returns nothing
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  set HV8=Level
  set HU8=Source
  call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),700,Condition(function LT8))
  call ForGroup(g,function OYF)
  call KillGroup(g)
  set g=null
endfunction

function OAF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local real OBF=(LoadReal(hashtable019,(Cache),(362)))
  local unit Source
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local integer Level
  
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if IsRealDamage then
      if LoadBoolean(MHT,GetHandleId(GetTriggerUnit()),'A0NS')==false then
        //call BJDebugMsg(R2S(GetEventDamage())+GetObjectName(GetUnitTypeId(GetEventDamageSource())))
        if OBF<GetEventDamage()then
          set Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
          set Level=(LoadInteger(hashtable019,(Cache),(5)))
          call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
          call SaveBoolean(hashtable019,(GetHandleId(Target)),(363),(false))
          call UnitAsInteger_Clear(XK8)
          call FlushChildHashtable(hashtable019,(Cache))
          call CleanTrigger(t)
          call HealUnitFor(GetTriggerUnit(),OBF)
          call OZF(Source,GetTriggerUnit(),Level)
          call Buff_Remove(Target,LoDBuff_BuffID[0])
        elseif GetEventDamage()>0 then
          call HealUnitFor(GetTriggerUnit(),GetEventDamage())
          call SaveReal(hashtable019,(Cache),(362),((OBF-GetEventDamage())*1.))
        endif
      endif
    endif
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT then
    if IsPurge(GetSpellAbilityId()) and GetSpellTargetUnit()==Target then
      set Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
      set Level=(LoadInteger(hashtable019,(Cache),(5)))
      call SaveBoolean(hashtable019,(GetHandleId(Target)),(363),(false))
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      
    endif
  else
    set Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
    set Level=(LoadInteger(hashtable019,(Cache),(5)))
    call SaveBoolean(hashtable019,(GetHandleId(Target)),(363),(false))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if GetUnitTypeId(GetTriggerUnit())!='e00C'then
      call OZF(Source,Target,Level)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Abaddon_AphoticShield takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=GetSpellTargetUnit()
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A0MF')
  local integer Cache2=GetHandleId(Target)
  local real OBF
  if(LoadBoolean(hashtable019,(Cache2),(363))) then
    call TriggerEvaluate((LoadTriggerHandle(hashtable019,(Cache2),(364))))
  endif
  if GetUnitAbilityLevel(Target,'BNdo')==0 then
    call UnitRemoveBuffs(Target,false,true)
  endif
  call E79(Target,0,0)
  if Level==1 then
    set OBF=110
  elseif Level==2 then
    set OBF=140
  elseif Level==3 then
    set OBF=170
  else
    set OBF=200
  endif
  call Buff_Add(Target,LoDBuff_AbilID[0],LoDBuff_BuffID[0],15.)
  call SaveReal(hashtable019,(Cache),(362),((OBF)*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\Defensive Barrier big.mdx",Target,"chest")))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerRegisterTimerEvent(t,15,false)
  call TriggerAddCondition(t,Condition(function OAF))
  call SaveTriggerHandle(hashtable019,(Cache2),(364),(t))
  call SaveBoolean(hashtable019,(Cache2),(363),(true))
  set t=null
  set Target=null
  set Source=null
endfunction

function Abaddon_AphoticShield_OnCast takes nothing returns nothing
  if GetUnitAbilityLevel(GetSpellTargetUnit(),'BNdo')>0 then
    //call InterruptUnit(GetTriggerUnit())
    //call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n03I'))
  endif
endfunction


function Func2552 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=(LoadUnitHandle(hashtable019,(h),(14)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH or IssueImmediateOrder(u,"windwalk")then
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
  endif
  set t=null
  set u=null
  return false
endfunction

function Func2553 takes unit u returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.5,true)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Func2552))
  call SaveUnitHandle(hashtable019,(h),(14),(u))
  set t=null
endfunction



function Abbadon_Time_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  
  if LoadBoolean(MHT,info,0)then
    call SaveBoolean(MHT,'A0NS',LoadInteger(MHT,info,0),true) //allow the spell to be activated
    call Timer_End(t)
  else
    call TimerStart(t,LoadInteger(MHT,info,1),false,function Abbadon_Time_End)
    call SaveBoolean(MHT,LoadInteger(MHT,info,0),'A0NS',false) //disable damage block
    call DestroyEffect(LoadEffectHandle(MHT,info,0))
    call SaveBoolean(MHT,info,0,true)
  endif
  
  set t = null
endfunction

function Abbadon_Time_Effect takes unit u, integer load returns nothing
  local timer t = Timer_Get()
  local player p = GetOwningPlayer(u)
  local integer info = GetHandleId(t)
  local integer level = GetUnitAbilityLevel(u,'A0NS')
  local boolean b = IsUnitSelected(u,p)
  call UnitRemoveBuffs(u,false,true)
  if IssueImmediateOrder(u,"windwalk")==false then
    //call echo("fail")
    call Func2553(u)
  endif
  if p==GetLocalPlayer() and b then
    call SelectUnit(u,true)
  endif
  
  
  call DisableTrigger(GAME_TRIGGER)
  
  if level==0 then
    set level = GetUnitAbilityLevel(u,'A1DA')
    call SaveInteger(MHT,info,1,70 - level*10 - level - 4)
    //call Passive_Cooldown(u,'A1DA',level)
    set level = level + 4
  else
    call SaveInteger(MHT,info,1,70 - level*10 - level - 2)
    //call Passive_Cooldown(u,'A0NS',level)
    set level = level + 2
  endif
  
  call EnableTrigger(GAME_TRIGGER)
  
  
  call E79(u,0,0)
  
  call SaveBoolean(MHT,load,'A0NS',true)  //active
  call SaveBoolean(MHT,'A0NS',load,false) //is avaliable
  call Buff_Add(u,LoDBuff_AbilID[22],LoDBuff_BuffID[22],level)
  
  call SaveInteger(MHT,info,0,load)
  call SaveBoolean(MHT,info,0,false)
  call SaveEffectHandle(MHT,info,0,AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Unsummon\\UnsummonTarget.mdl",u,"origin"))
  
  call TimerStart(t,level,false,function Abbadon_Time_End)
  
  set t = null
  set p=null
endfunction

function Abbadon_Time_Start takes nothing returns nothing
  local unit u = GetTriggerUnit()
  if LoadBoolean(MHT,'A0NS',GetHandleId(u)) then
    call Abbadon_Time_Effect(u,GetHandleId(u))
  else
    call Error(GetOwningPlayer(GetTriggerUnit()),"Spell is not ready yet.")
  endif
  
  set u = null
endfunction

function Abbadon_Time_Condition takes unit u, real d returns nothing
  local integer info = GetHandleId(u)
  
  if LoadBoolean(MHT,info,'A0NS')then
    if IsRealDamage then
      call Damage_Block(u,2*d,false)
    endif
  elseif LoadBoolean(MHT,'A0NS',info) and 400>GetWidgetLife(u) and GetUnitAbilityLevel(u,'BNdo')==0 then
    call Abbadon_Time_Effect(u,info)
  endif
endfunction

function Abbadon_Time_Learn takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local integer info = GetHandleId(u)
  if (GetUnitAbilityLevel(u,'A0NS')==1 or GetUnitAbilityLevel(u,'A1DA')==1) and IsUnitIllusion(u)==false then//[lich] abaddon ulti fix?
    //if LoadBoolean(MHT,info,1)==false then
    call SaveBoolean(MHT,info,1,true)
    call SaveBoolean(MHT,'A0NS',info,true)
    call TriggerRegisterUnitEvent(GAME_TRIGGER,u,EVENT_UNIT_DAMAGED)
  endif
  
  set u = null
endfunction











function P9F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local real Damage
  local integer DP9
  local unit W19
  if Level==1 then
    set Damage=15
    set DP9=10
  elseif Level==2 then
    set Damage=20
    set DP9=12
  elseif Level==3 then
    set Damage=25
    set DP9=14
  elseif Level==4 then
    set Damage=30
    set DP9=16
  endif
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if GetTriggerEvalCount(t)>1 and GetSpellAbilityId()=='A0S1' and IsBlocked(GetSpellTargetUnit())==false and Target==GetSpellTargetUnit()then
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT then
    if IsPurge(GetSpellAbilityId()) and GetSpellTargetUnit()==Target then
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_DEATH then
    set W19=GetKillingUnit()
    if WC8(W19)then
      set W19=(udg_Hero[GetPlayerId(GetOwningPlayer((W19)))])
    endif
    if GetTriggerUnit()==Target or W19==Target then
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call UnitRemoveAbility(Target,'A1W3')
      call UnitRemoveAbility(Target,'B0DO')
    endif
  else
    set Count=Count+1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    if GetUnitAbilityLevel(Target,'A1W3')==0 or Count==DP9 then
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call UnitRemoveAbility(Target,'A1W3')
      call UnitRemoveAbility(Target,'B0DO')
    endif
    call DamageTarget(Source,Target,1,Damage)
  endif
  set t=null
  set Source=null
  set Target=null
  set W19=null
  return false
endfunction

function PDF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A0S1')
  local real Damage
  local real DP9
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\ReviveDemon\\ReviveDemon.mdl",Target,"overhead"))
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A1W3',false)
  call UnitAddAbility2(Target,'A1W3')
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function P9F))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Other\\SoulBurn\\SoulBurnbuff.mdl",Target,"overhead")))
  set Source=null
  set Target=null
  set t=null
endfunction

function PEF takes nothing returns nothing
  if GetUnitAbilityLevel(GetEnumUnit(),'B0DO')>0 then
    set HX8=HX8+1
  endif
endfunction

function PFF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  set HX8=0
  call GroupEnumUnitsInRange(g,0,0,9999,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function PEF)
  call KillGroup(g)
  if HX8==0 then
    if GetUnitAbilityLevel(Source,'B0EZ')>0 then
      call UnitRemoveAbility(Source,'A2AR')
      call UnitRemoveAbility(Source,'A2AS')
      call UnitRemoveAbility(Source,'A2AU')
      call UnitRemoveAbility(Source,'A2AT')
      call UnitRemoveAbility(Source,'A2AQ')
      call UnitRemoveAbility(Source,'A2AP')
      call UnitRemoveAbility(Source,'B0EZ')
    endif
  elseif HX8==1 then
    if GetUnitAbilityLevel(Source,'A2AR')==0 then
      call UnitRemoveAbility(Source,'A2AR')
      call UnitRemoveAbility(Source,'A2AS')
      call UnitRemoveAbility(Source,'A2AU')
      call UnitRemoveAbility(Source,'A2AT')
      call UnitRemoveAbility(Source,'A2AQ')
      call UnitRemoveAbility(Source,'A2AP')
      call UnitRemoveAbility(Source,'B0EZ')
      call UnitAddAbility(Source,'A2AR')
    endif
  elseif HX8==2 then
    if GetUnitAbilityLevel(Source,'A2AS')==0 then
      call UnitRemoveAbility(Source,'A2AR')
      call UnitRemoveAbility(Source,'A2AS')
      call UnitRemoveAbility(Source,'A2AU')
      call UnitRemoveAbility(Source,'A2AT')
      call UnitRemoveAbility(Source,'A2AQ')
      call UnitRemoveAbility(Source,'A2AP')
      call UnitRemoveAbility(Source,'B0EZ')
      call UnitAddAbility(Source,'A2AS')
    endif
  elseif HX8==3 then
    if GetUnitAbilityLevel(Source,'A2AU')==0 then
      call UnitRemoveAbility(Source,'A2AR')
      call UnitRemoveAbility(Source,'A2AS')
      call UnitRemoveAbility(Source,'A2AU')
      call UnitRemoveAbility(Source,'A2AT')
      call UnitRemoveAbility(Source,'A2AQ')
      call UnitRemoveAbility(Source,'A2AP')
      call UnitRemoveAbility(Source,'B0EZ')
      call UnitAddAbility(Source,'A2AU')
    endif
  elseif HX8==4 then
    if GetUnitAbilityLevel(Source,'A2AT')==0 then
      call UnitRemoveAbility(Source,'A2AR')
      call UnitRemoveAbility(Source,'A2AS')
      call UnitRemoveAbility(Source,'A2AU')
      call UnitRemoveAbility(Source,'A2AT')
      call UnitRemoveAbility(Source,'A2AQ')
      call UnitRemoveAbility(Source,'A2AP')
      call UnitRemoveAbility(Source,'B0EZ')
      call UnitAddAbility(Source,'A2AT')
    endif
  elseif HX8==5 then
    if GetUnitAbilityLevel(Source,'A2AQ')==0 then
      call UnitRemoveAbility(Source,'A2AR')
      call UnitRemoveAbility(Source,'A2AS')
      call UnitRemoveAbility(Source,'A2AU')
      call UnitRemoveAbility(Source,'A2AT')
      call UnitRemoveAbility(Source,'A2AQ')
      call UnitRemoveAbility(Source,'A2AP')
      call UnitRemoveAbility(Source,'B0EZ')
      call UnitAddAbility(Source,'A2AQ')
    endif
  elseif HX8>=6 then
    if GetUnitAbilityLevel(Source,'A2AP')==0 then
      call UnitRemoveAbility(Source,'A2AR')
      call UnitRemoveAbility(Source,'A2AS')
      call UnitRemoveAbility(Source,'A2AU')
      call UnitRemoveAbility(Source,'A2AT')
      call UnitRemoveAbility(Source,'A2AQ')
      call UnitRemoveAbility(Source,'A2AP')
      call UnitRemoveAbility(Source,'B0EZ')
      call UnitAddAbility(Source,'A2AP')
    endif
  endif
  set t=null
  set Source=null
  set g=null
  return false
endfunction

function PHF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function PFF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2AR',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2AS',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2AU',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2AT',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2AQ',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2AP',false)
  set t=null
  set Source=null
endfunction

function PIF takes nothing returns boolean
  if GetLearnedSkill()=='A0S1' and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call PHF()
  endif
  return false
endfunction

function Axe_BattleHunger takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call PDF()
  endif
endfunction

function N69 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function PIF))
  set t=null
endfunction

function PJF takes nothing returns boolean
  return((IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and GetUnitAbilityLevel(GetFilterUnit(),'B008')==0 and GetUnitAbilityLevel(GetFilterUnit(),'Bcyc')==0)!=null
endfunction

function PKF takes integer Cache,integer PMF returns nothing
  local integer i=1
  loop
    exitwhen i>PMF
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(2700+i))))
    set i=i+1
  endloop
endfunction

function PNF takes nothing returns nothing
  call UnitWakeUp(GetEnumUnit())
  call IssueTargetOrderById(GetEnumUnit(),851983,HY8)
endfunction

function POF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local group g=(LoadGroupHandle(hashtable019,(Cache),(220)))
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer PMF=(LoadInteger(hashtable019,(Cache),(365)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  if GetTriggerEventId()!=EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER and GetTriggerEventId()!=EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER and GetTriggerEventId()!=EVENT_PLAYER_UNIT_ISSUED_ORDER then
    set Count=Count+1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    if Count==(8+2*Level)then
      call LoDStat_Sub(Hero,40,"armour")
      call UnitRemoveAbility(Hero,'A0I5')
      call KillGroup(g)
      call PKF(Cache,PMF)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    else
      call DisableTrigger(t)
      set HY8=Hero
      call ForGroup(g,function PNF)
      call EnableTrigger(t)
    endif
  else
    if IsUnitInGroup(GetTriggerUnit(),g) and UnitIsSleeping(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),'B008')==0 and GetIssuedOrderId()!=851973 and HW8==false then
      call DisableTrigger(t)
      call IssueTargetOrderById(GetTriggerUnit(),851983,Hero)
      call EnableTrigger(t)
    endif
  endif
  set t=null
  set g=null
  set Hero=null
  return false
endfunction

function PPF takes nothing returns nothing
  local unit u = GetEnumUnit()
  
  set tt_int1=tt_int1+1
  
  call Buff_Add(u,LoDBuff_AbilID[3],LoDBuff_BuffID[3],GetUnitAbilityLevel(GetTriggerUnit(),'A0I6')*0.5+1)
  call SaveEffectHandle(hashtable019,(WK),(2700+tt_int1),(AddSpecialEffectTarget("Abilities\\Weapons\\LavaSpawnMissile\\LavaSpawnBirthMissile.mdl",u,"chest")))
  
  set u = null
endfunction

function Axe_BerserkerCall takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'A0I6')
  local group g=GetAvailableGroup()
  
  set tt_unit1=Hero
  set HY8=Hero
  set tt_int1=0
  set WK=Cache
  call LoDStat_Add(Hero,40,"armour")
  call Buff_Add(Hero,LoDBuff_AbilID[4],LoDBuff_BuffID[4],Level*0.5+1)
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),325,Condition(function PJF))
  call ForGroup(g,function PPF)
  call ForGroup(g,function PNF)
  call SaveInteger(hashtable019,(Cache),(365),(tt_int1))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveGroupHandle(hashtable019,(Cache),(220),(g))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  call TriggerRegisterTimerEvent(t,.2,true)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function POF))
  set t=null
  set g=null
  set Hero=null
endfunction

function CounterHelixFilter takes nothing returns boolean
  return(IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))and((GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 or IsSiegeUnit(GetFilterUnit())) and (IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false) and IsDead(GetFilterUnit())==false))!=null
endfunction

function PSF takes nothing returns nothing
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",GetEnumUnit(),"origin"))
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),2,GetUnitAbilityLevel(GetTriggerUnit(),'P327')*35+65) //A0C6
endfunction

function PTF takes nothing returns nothing
  local group g=GetAvailableGroup()
  local unit Hero=GetTriggerUnit()
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),300,Condition(function CounterHelixFilter))
  call ForGroup(g,function PSF)
  if (GetUnitTypeId(GetTriggerUnit())!='Nbbc' and GetUnitTypeId(GetTriggerUnit())!='Opgh')then
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\SpinFX3.mdx",Hero,"origin"))
  else
    call SetUnitAnimation(Hero,"spin")
  endif
  call BF8(Hero,.6)
  call AddTimedKeyToUnit(Hero,4267,.5-.05*GetUnitAbilityLevel(GetTriggerUnit(),'P327')) //A0C6
  call KillGroup(g)
  set g=null
  set Hero=null
endfunction

function PUF takes nothing returns boolean
  if GetUnitAbilityLevel(GetTriggerUnit(),'B03P')>0 and (IsUnitType(GetAttacker(),UNIT_TYPE_STRUCTURE)==false and IsUnitType(GetAttacker(),UNIT_TYPE_MECHANICAL)==false or IsSiegeUnit(GetAttacker())) and GetUnitAbilityLevel(GetAttacker(),'A04R')==0 and IsUnitAlly(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))==false and ((LoadInteger(hashtable019,(GetHandleId((GetTriggerUnit()))),((4267))))==1)==false and GetUnitAbilityLevel(GetTriggerUnit(),'A1HX')==0 then
    if PRD_Get(GetTriggerUnit(),'B03P',17) then
      call PTF()
    endif
  endif
  return false
endfunction

function NL9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function PUF))
  set t=null
endfunction

function PVF takes nothing returns nothing
  call SetPlayerAbilityAvailable2(GetOwningPlayer(GetEnumUnit()),'A2IC',false)
  if TempBoolean then
    call CN8(GetEnumUnit(),'A2IC',1,10,'B0FV')
  else
    call CN8(GetEnumUnit(),'A2IC',1,6,'B0FV')
  endif
endfunction

function Axe_CullingBlade takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real OBF=GetUnitState(Target,UNIT_STATE_LIFE)
  local integer Level=GetUnitAbilityLevel(Hero,('A0E2'))
  local unit Caster
  local boolean PYF=false
  local group g
  local real limit
  local integer spellid=GetSpellAbilityId()
  set limit=150+100*Level
  if Level==0 then
    set Level=GetUnitAbilityLevel(Hero,'A1MR')
    if Level==1 then
      set limit=300
    elseif Level==2 then
      set limit=450
    else
      set limit=625
    endif
    set PYF=true
  endif
  if(OBF<=limit and GetUnitAbilityLevel(Target,'A21I')==0 and LoadBoolean(MHT,GetHandleId(Target),'A0NS')==false)then
    if PYF then
    endif
    set TempBoolean=PYF
    call PlaySoundOnUnitBJ(boolean023,100,Target)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile.mdl",Target,"overhead"))
    set Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',0,0,0)
    call UnitRemoveBuffs(Target,true,true)
    call UnitRemoveAbility(Target,'Aetl')
    call DamageTarget(Caster,Target,4,100000000)
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\AxeUltiMSFX_01.mdx",Hero,"origin"))
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),925,Condition(function L58))
    call ForGroup(g,function PVF)
    call KillGroup(g)
    set g=null
    if IsUnitType(Target,UNIT_TYPE_HERO) then
      call UnitRemoveAbility(Hero,spellid)
      call UnitAddAbility2(Hero,spellid)
      call SetUnitAbilityLevel(Hero,spellid,Level)
      
      if SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Hero))*PlayerSkillOffset+4]]=='A0E2' then //4th skill
        call TimerStart(PrimaryUltiCooldownTimer[GetPlayerId(GetOwningPlayer(Hero))],0.1,false,null)
      elseif SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Hero))*PlayerSkillOffset+4]]=='A0E2' then //6th skill
        call TimerStart(SecondaryUltiCooldownTimer[GetPlayerId(GetOwningPlayer(Hero))],0.1,false,null)
      endif
    endif
  endif
  set Hero=null
  set Target=null
  set Caster=null
endfunction

function PZF takes nothing returns boolean
  return GetSpellAbilityId()=='A0GK' and IsBlocked(GetSpellTargetUnit())==false
endfunction

function PAF takes nothing returns nothing
  call DamageTarget(GetTriggerUnit(),GetSpellTargetUnit(),3,20+70*GetUnitAbilityLevel(GetTriggerUnit(),'A0GK'))
  if GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)>1 then
    call SetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE,GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)+20+70*GetUnitAbilityLevel(GetTriggerUnit(),'A0GK'))
  endif
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl",GetSpellTargetUnit(),"origin"))
endfunction

function PBF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Caster
  if GetUnitAbilityLevel(Target,'B02F')==0 then
    
    if GetUnitAbilityLevel(Target,'A2O9')==1then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A04Y',true)
      call UnitRemoveAbility(Target,'A2O9')
    endif
    
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED and GetTriggerUnit()==Target then
    call UnitRemoveAbility(Target,'B02F')
    
    if GetUnitAbilityLevel(Target,'A2O9')==1then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A04Y',true)
      call UnitRemoveAbility(Target,'A2O9')
    endif
    
    set Caster=CreateUnit(p,'e00E',GetUnitX(Target),GetUnitY(Target),0)
    call UnitAddAbility2(Caster,'A04Y')
    call SetUnitAbilityLevel(Caster,'A04Y',Level)
    call IssueTargetOrderById(Caster,852227,GetAttacker())
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()!=EVENT_PLAYER_UNIT_ATTACKED then
    if GetUnitState(Target,UNIT_STATE_LIFE)>21 then
      call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)-20)
    else
      if GetUnitAbilityLevel(Target,'A2O9')==1 then
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A04Y',true)
        call UnitRemoveAbility(Target,'A2O9')
      endif
      
      call UnitRemoveAbility(Target,'B02F')
      call DamageTarget(Source,Target,1,50)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set p=null
  set Caster=null
  set Target=null
  set Source=null
  return false
endfunction

function PCF takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  set Cache=GetHandleId(t)
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SavePlayerHandle(hashtable019,(Cache),(54),(GetOwningPlayer(Source)))
  call SaveInteger(hashtable019,(Cache),(5),(GetUnitAbilityLevel(Source,'A04Y')))
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function PBF))
  
  if Target==Source then
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A04Y',false)
    call UnitAddAbility2(Target,'A2O9')
  endif
  
  set W67=true
  call DamageTarget(Source,Target,2,0)
  set W67=false
  set Source=null
  set Target=null
  set t=null
endfunction

function Bane_Nightmare takes nothing returns nothing
  if IsCourier(GetSpellTargetUnit())==false then
    call PCF()
  endif
endfunction

function P6F takes nothing returns boolean
  if GetSpellAbilityId()=='A04Y' and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) then
    if GetOwningPlayer(GetTriggerUnit())!=GetOwningPlayer(GetSpellTargetUnit())and IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))and(LoadBoolean(hashtable019,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))then
      call InterruptUnit(GetTriggerUnit())
      call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n038'))
    endif
  endif
  return false
endfunction

function Nightmare_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local unit u = LoadUnitHandle(MHT,GetHandleId(t),0)
  
  call UnitRemoveAbility(u,'B02F')
  call UnitRemoveAbility(u,'A2O9')
  
  call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A04Y',true)
  
  call Timer_End(t)
  set t = null
  set u = null
endfunction

function Nightmare_End_Check takes nothing returns boolean
  local timer t = null
  local unit u = GetTriggerUnit()
  
  if GetIssuedOrderId()==String2OrderIdBJ("manashieldon")and GetUnitAbilityLevel(u,'A2O9')>0 then
    set t = Timer_Get()
    
    call TimerStart(t,0,false,function Nightmare_End)
    call SaveUnitHandle(MHT,GetHandleId(t),0,u)
    
    set t = null
  endif
  
  set u = null
  
  return false
endfunction

function N59 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function P6F))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function Nightmare_End_Check))
  set t=null
endfunction

function PLF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real RLD
  local integer Count=6
  local fogmodifier Z58=(LoadFogModifierHandle(hashtable019,(Cache),(42)))
  if GetUnitAbilityLevel(Source,'A1D9')>0 then
    set Count=7
  endif
  if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST then
    call FogModifierStop(Z58)
    call DestroyFogModifier(Z58)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEvalCount(t)>Count then
    call FogModifierStop(Z58)
    call DestroyFogModifier(Z58)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call InterruptUnit(Source)
  else
    set RLD=RMinBJ(.05*GetUnitState(Target,UNIT_STATE_MAX_MANA),GetUnitState(Target,UNIT_STATE_MANA))
    if GetUnitAbilityLevel(Source,'A1D9')>0 then
      set RLD=RMinBJ(.1*GetUnitState(Target,UNIT_STATE_MAX_MANA),GetUnitState(Target,UNIT_STATE_MANA))
    endif
    if RLD>0 then
      call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)+RLD)
      call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)-RLD)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set Z58=null
  return false
endfunction

function Bane_Grip takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local fogmodifier Z58=CreateFogModifierRadius(GetOwningPlayer(Source),FOG_OF_WAR_VISIBLE,GetUnitX(Target),GetUnitY(Target),350,true,true)
  call FogModifierStart(Z58)
  call UnitRemoveAbility(Target,'B02F')
  call UnitRemoveAbility(Target,'BUsp')
  call UnitRemoveAbility(Target,'Bust')
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerAddCondition(t,Condition(function PLF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveFogModifierHandle(hashtable019,(Cache),(42),(Z58))
  set Source=null
  set Target=null
  set t=null
  set Z58=null
endfunction



function Bane_Enfeeble_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local unit u = LoadUnitHandle(MHT,info,0)
  
  call LoDStat_Sub(u,LoadInteger(MHT,info,0),"damageneg")
  call RemoveSavedHandle(MHT,GetHandleId(u),'A04V')
  
  call Timer_End(t)
  set t = null
  set u = null
endfunction

function Bane_Enfeeble_Start takes unit u returns nothing
  local unit d = GetTriggerUnit()
  local timer t = LoadTimerHandle(MHT,GetHandleId(u),'A04V')
  local integer info = GetHandleId(t)
  local integer amount = 30*GetUnitAbilityLevel(udg_Hero[GetPlayerId(GetOwningPlayer(d))],'A04V')
  
  if t==null or GetUnitAbilityLevel(u,LoDBuff_BuffID[18])==0 or GetUnitTypeId(d)=='e00E' then
    set t = Timer_Get()
    set info = GetHandleId(t)
    
    call SaveTimerHandle(MHT,GetHandleId(u),'A04V',t)
    call SaveUnitHandle(MHT,info,0,u)
  else
    call LoDStat_Sub(u,LoadInteger(MHT,info,0),"damageneg")
  endif
  
  call SaveInteger(MHT,info,0,amount)
  call TimerStart(t,20,false,function Bane_Enfeeble_End)
  
  call LoDStat_Add(u,amount,"damageneg")
  call Buff_Add(u,LoDBuff_AbilID[18],LoDBuff_BuffID[18],20)
  
  set d = null
  set t = null
endfunction

function Bane_Enfeeble_Condition takes nothing returns nothing
  local unit t = GetSpellTargetUnit()
  
  if IsBlocked(t)==false then
    call Bane_Enfeeble_Start(t)
  endif
  
  set t = null
endfunction

function Q7F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Count=(LoadInteger(hashtable019,(GetHandleId(Target)),(281)))
  local boolean Q8F=(LoadBoolean(hashtable019,(Cache),(280)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call SetUnitTurnSpeed(Target,GetUnitDefaultTurnSpeed(Target))
    call SaveInteger(hashtable019,(GetHandleId(Target)),(281),(0))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call E79(Target,0,0)
  elseif Count==0 then
    call SetUnitTurnSpeed(Target,GetUnitDefaultTurnSpeed(Target))
    call SaveInteger(hashtable019,(GetHandleId(Target)),(281),(0))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED and Q8F==false then
    if Count>0 and GetUnitAbilityLevel(GetEventDamageSource(),'A1EL')>0 and(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(2)))==GetEventDamageSource() and IsRealDamage then
      call SaveBoolean(hashtable019,(Cache),(280),(true))
      if I48 then
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\LordofFlameMissile\\LordofFlameMissile.mdl",Target,"chest"))
        call DamageTarget(Source,Target,1,.5*(5+5*GetUnitAbilityLevel(Source,'A1EL'))*Count)
      elseif(GetEventDamage()>25)then
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\LordofFlameMissile\\LordofFlameMissile.mdl",Target,"chest"))
        call DamageTarget(Source,Target,1,(5+5*GetUnitAbilityLevel(Source,'A1EL'))*Count)
      endif
      call SaveBoolean(hashtable019,(Cache),(280),(false))
    endif
  else
    call SetUnitTurnSpeed(Target,GetUnitDefaultTurnSpeed(Target)*.3)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Q9F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real DRD=(LoadReal(hashtable019,(GetHandleId(Target)),(675)))
  local integer StickyCount=(LoadInteger(hashtable019,(GetHandleId(Target)),(281)))
  if(TimerGetElapsed(GlobalTimer))-DRD>=8 then
    call SetUnitTurnSpeed(Target,GetUnitDefaultTurnSpeed(Target))
    call SaveInteger(hashtable019,(GetHandleId(Target)),(281),(0))
    call E79(Target,0,0)
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function QDF takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetEnumUnit()
  local trigger t
  local integer Cache
  local integer Level=GetUnitAbilityLevel(Source,'A1EL')
  local integer Count=IMinBJ((LoadInteger(hashtable019,(GetHandleId(Target)),(281)))+1,10)
  if IsMagicImmune(Target)then
    set Source=null
    set Target=null
    return
  endif
  call E79(Target,Level,Count)
  call SaveInteger(hashtable019,(GetHandleId(Target)),(281),(Count))
  call SaveReal(hashtable019,(GetHandleId(Target)),(675),(((TimerGetElapsed(GlobalTimer)))*1.))
  call SetUnitTurnSpeed(Target,GetUnitDefaultTurnSpeed(Target)*.3)
  if IsUnitType(Target,UNIT_TYPE_HERO) or IsUnitIllusion(Target) then
    call ZW8(GetOwningPlayer(Source),I2S(Count)+"!",2,Target,.026,50,0,255,216)
  endif
  if Count==1 then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveBoolean(hashtable019,(Cache),(280),(false))
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function Q7F))
  endif
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,8,false)
  call TriggerAddCondition(t,Condition(function Q9F))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  set t=null
  set Source=null
  set Target=null
endfunction

function Batrider_StickyNapalm takes nothing returns nothing
  local group g=GetAvailableGroup()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local unit Source=GetTriggerUnit()
  call GroupEnumUnitsInRange(g,x,y,400,Condition(function LR8))
  call ForGroup(g,function QDF)
  call TimedReveal(GetOwningPlayer(Source),2,x,y,500)
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl",x,y))
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl",x,y+130))
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl",x,y-130))
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl",x+130,y))
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl",x+130,y+130))
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl",x+130,y-130))
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl",x-130,y))
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl",x-130,y+130))
  call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl",x-130,y-130))
  //call RemoveLocation(l)
  call KillGroup(g)
  set g=null
  //set l=null
  set Source=null
endfunction

function TD9 takes nothing returns nothing
  local integer i
  set HZ8[1]='A1XC'
  set HZ8[2]='A1XB'
  set HZ8[3]='A1X4'
  set HZ8[4]='A1X5'
  set HZ8[5]='A1X6'
  set HZ8[6]='A1X7'
  set HZ8[7]='A1XA'
  set HZ8[8]='A1X8'
  set HZ8[9]='A1X9'
  set HZ8[10]='A1XD'
  set HA8[1]='A1XM'
  set HA8[2]='A1XE'
  set HA8[3]='A1XF'
  set HA8[4]='A1XG'
  set HA8[5]='A1XH'
  set HA8[6]='A1XI'
  set HA8[7]='A1XJ'
  set HA8[8]='A1XK'
  set HA8[9]='A1XN'
  set HA8[10]='A1XL'
  set HB8[1]='A1XO'
  set HB8[2]='A1XV'
  set HB8[3]='A1XW'
  set HB8[4]='A1XQ'
  set HB8[5]='A1XR'
  set HB8[6]='A1XS'
  set HB8[7]='A1XX'
  set HB8[8]='A1XT'
  set HB8[9]='A1XU'
  set HB8[10]='A1XP'
  set HC8[1]='A1XY'
  set HC8[2]='A1XZ'
  set HC8[3]='A1Y5'
  set HC8[4]='A1Y6'
  set HC8[5]='A1Y7'
  set HC8[6]='A1Y1'
  set HC8[7]='A1Y2'
  set HC8[8]='A1Y3'
  set HC8[9]='A1Y4'
  set HC8[10]='A1Y0'
  set i=1
  loop
    exitwhen i>10
    call PreloadAbility(HZ8[i])
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>10
    call PreloadAbility(HA8[i])
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>10
    call PreloadAbility(HB8[i])
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>10
    call PreloadAbility(HC8[i])
    set i=i+1
  endloop
endfunction

function QGF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local real d=(LoadReal(hashtable019,(Cache),(138)))
  local real x1=(LoadReal(hashtable019,(Cache),(6)))
  local real y1=(LoadReal(hashtable019,(Cache),(7)))
  local real x2
  local real y2
  local real x
  local real y
  if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>10 then
    call KillTrees(GetUnitX(Target),GetUnitY(Target),200)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set x2=x1+d*Cos(a)
    set y2=y1+d*Sin(a)
    if(IsPointInRegion(RestrictedRegion,((x2)*1.),((y2)*1.)))==false then
      call SaveReal(hashtable019,(Cache),(6),((x2)*1.))
      call SaveReal(hashtable019,(Cache),(7),((y2)*1.))
      set x=x2
      set y=y2
    else
      set x=x1
      set y=y1
    endif
    if IsUnitType(Target,UNIT_TYPE_HERO)==true then
      call SetUnitPosition(Target,x,y)
    else
      call SetUnitX(Target,x)
      call SetUnitY(Target,y)
    endif
  endif
  set t=null
  set Target=null
  return false
endfunction

function QHF takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetEnumUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A19V')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QGF))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(137),((Atan2(GetUnitY(Target)-H08,GetUnitX(Target)-H18))*1.))
  call SaveReal(hashtable019,(Cache),(138),((RMaxIF((400-DistanceBetweenXY(H18,H08,GetUnitX(Target),GetUnitY(Target))),10)/ 10)*1.))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Target))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Target))*1.))
  set Source=null
  set Target=null
  set t=null
  call DamageTarget(H38,GetEnumUnit(),1,HL8*75)
endfunction

function QIF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local group g=GetAvailableGroup()
  local unit Target
  local real x=GetUnitX(Caster)
  local real y=GetUnitY(Caster)
  local real WM3=(LoadReal(hashtable019,(Cache),(6)))
  local real WN3=(LoadReal(hashtable019,(Cache),(7)))
  set x=SafeX50(x+36*Cos(a))
  set y=SafeY50(y+36*Sin(a))
  call SetUnitX(Caster,x)
  call SetUnitY(Caster,y)
  set tt_unit1=Caster
  call GroupEnumUnitsInRange(g,x,y,125,Condition(function DefaultEnemyFilter))
  set Target=FirstOfGroup(g)
  call KillGroup(g)
  if DistanceBetweenXY(x,y,WM3,WN3)<40 or GetTriggerEvalCount(t)>100 then
    set Target=null
    set x=WM3
    set y=WN3
    set H38=Source
    set HL8=(LoadInteger(hashtable019,(Cache),(5)))
    set H68=Target
    if Target==null then
      set H18=x
      set H08=y
    else
      set H18=GetUnitX(Target)
      set H08=GetUnitY(Target)
    endif
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,400,Condition(function NonImmuneEnemyFilter))
    if Target!=null then
      call GroupRemoveUnit(g,Target)
      call StunTarget(Source,Target,.3)
      call DamageTarget(H38,Target,1,HL8*75)
    endif
    call ForGroup(g,function QHF)
    call KillUnit(Caster)
    call KillGroup(g)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  set Caster=null
  set Source=null
  set g=null
  return false
endfunction

function Batrider_FlameBreak takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A19V')
  local unit Caster
  //call RemoveLocation(l)
  set Caster=CreateUnit(GetOwningPlayer(Source),'h0ED',GetUnitX(Source),GetUnitY(Source),a*bj_RADTODEG)
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.0))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.0))
  call TriggerRegisterTimerEvent(t,.04,true)
  call TriggerAddCondition(t,Condition(function QIF))
  set Source=null
  set Caster=null
  //set l=null
  set t=null
endfunction

function QMF takes nothing returns nothing
  local unit Source=H58
  local unit H3D=GetEnumUnit()
  local unit Target
  local group g
  if GetUnitCurrentOrder(H3D)==0 then
    set g=GetAvailableGroup()
    set tt_unit1=H3D
    call GroupEnumUnitsInRange(g,GetUnitX(H3D),GetUnitY(H3D),825,Condition(function DefaultEnemyFilter))
    set Target=FirstOfGroup(g)
    if Target!=null then
      call GroupRemoveUnit(g,Target)
    endif
    if FirstOfGroup(g)==null and Target==Source then
      call IssueTargetOrderById(H3D,851983,Target)
    endif
    call KillGroup(g)
    set Target=null
    set g=null
  endif
  set Source=null
  set H3D=null
endfunction

function QNF takes unit Source returns nothing
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  set H58=Source
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1000,Condition(function Func1668))
  call ForGroup(g,function QMF)
  call KillGroup(g)
  set g=null
endfunction

function QOF takes nothing returns nothing
  call DamageTarget(H58,GetEnumUnit(),1,I78*10)
endfunction

function QPF takes unit Source,integer Cache,integer Count returns nothing
  local group g1=GetAvailableGroup()
  local group g2=GetAvailableGroup()
  local integer i=0
  set tt_unit1=Source
  loop
    exitwhen i>Count
    call GroupEnumUnitsInRange(g2,(LoadReal(hashtable019,(Cache),(2300+i))),(LoadReal(hashtable019,(Cache),(2500+i))),225,Condition(function DefaultEnemyFilter))
    call GroupAddGroup(g2,g1)
    call GroupClear(g2)
    set i=i+1
  endloop
  call KillGroup(g2)
  if FirstOfGroup(g1)!=null then
    set H58=Source
    set I78=GetUnitAbilityLevel(Source,'A19Z')
    if I78<1 then
      set I78=GetUnitAbilityLevel(Source,'QM04')
    endif
    set H28=CreateUnit(GetOwningPlayer(Source),'e00E',0,0,0)
    call UnitAddAbility2(H28,'A19U')
    call SetUnitAbilityLevel(H28,'A19U',I78)
    call ForGroup(g1,function QOF)
  endif
  call KillGroup(g1)
  set g1=null
  set g2=null
endfunction

function QQF takes nothing returns boolean
  local unit Source=null
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local integer i
  local real x
  local real y
  
  if GetTriggerEvalCount(t)>360 then
    set i=0
    
    loop
      exitwhen i>Count
      call DestroyEffect(LoadEffectHandle(hashtable019,Cache,2700 + i))
      set i=i+1
    endloop
    
    call FlushChildHashtable(hashtable019,Cache)
    call CleanTrigger(t)
    set t = null
    return false
  endif
  
  set Source = LoadUnitHandle(hashtable019,Cache,2)
  set x = GetWidgetX(Source)
  set y = GetWidgetY(Source)
  
  if udg_ObserverMode then
    call QNF(Source)
  endif
  
  if DistanceBetweenXY(x,y,LoadReal(hashtable019,Cache,23),LoadReal(hashtable019,Cache,24)) >125 then
    set Count=Count+1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    call SaveReal(hashtable019,(Cache),(23),((x)*1.))
    call SaveReal(hashtable019,(Cache),(24),((y)*1.))
    call SaveEffectHandle(hashtable019,(Cache),(2700+Count),(AddSpecialEffect("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl",x,y)))
    call SaveReal(hashtable019,(Cache),(2300+Count),((x)*1.))
    call SaveReal(hashtable019,(Cache),(2500+Count),((y)*1.))
  endif
  
  if ModuloInteger(GetTriggerEvalCount(t),10)==0 then
    set I48=true
    call QPF(Source,Cache,Count)
    set I48=false
  endif
  
  if IsDead(Source)==false then
    call KillTrees(x,y,100)
  endif
  
  set Source = null
  set t = null
  return false
endfunction

function QRF takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function QQF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveEffectHandle(hashtable019,(Cache),(2700),(AddSpecialEffect("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl",GetUnitX(Source),GetUnitY(Source))))
  call SaveReal(hashtable019,(Cache),(23),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(24),((GetUnitY(Source))*1.))
  call SaveReal(hashtable019,(Cache),(2300),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(2500),((GetUnitY(Source))*1.))
  set Source=null
  set t=null
endfunction

function QSF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if IsDead(Source)then
    return false
  endif
  if GetUnitTypeId(Source)=='O017' then
    call SetUnitFlyHeight(Source,220,0)
  endif
  set t=null
  set Source=null
  return false
endfunction

function WY3 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call TriggerRegisterTimerEvent(t,2,true)
  call TriggerAddCondition(t,Condition(function QSF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=null
  set Source=null
endfunction

function QTF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  call SetTerrainPathable(x,y,PATHING_TYPE_WALKABILITY,false)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function QUF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  call SetTerrainPathable(x,y,PATHING_TYPE_WALKABILITY,true)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function QTF))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  set Source=null
  set t=null
endfunction

function Batrider_Firefly takes nothing returns nothing
  if GetUnitTypeId(GetTriggerUnit())!='O017' then
    call QRF()
    if(GetRandomInt(1,10)==1)then
      call PlaySoundOnUnitBJ(ResQFun,100,GetTriggerUnit())
    endif
  elseif IsTerrainPathable(GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),PATHING_TYPE_WALKABILITY)then
    call QUF()
  endif
endfunction

function QWF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local real d=DistanceBetweenXY(GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))
  local real a
  local real DP9=(LoadReal(hashtable019,(Cache),(57)))
  local real x0=(LoadReal(hashtable019,(Cache),(282)))
  local real y0=(LoadReal(hashtable019,(Cache),(283)))
  local real x1
  local real y1
  if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>R2I(20*DP9)then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call KillUnit(Caster)
    call SetUnitPathing(Target,true)
    call KillTrees(GetUnitX(Target),GetUnitY(Target),175)
    call UnitRemoveAbility(Source,'Abun')
  else
    call SetUnitX(Caster,GetUnitX(Source))
    call SetUnitY(Caster,GetUnitY(Source))
    if DistanceBetweenXY(x0,y0,GetUnitX(Source),GetUnitY(Source))>400 then
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call KillUnit(Caster)
      call SetUnitPathing(Target,true)
      call KillTrees(GetUnitX(Target),GetUnitY(Target),175)
    else
      call SaveReal(hashtable019,(Cache),(282),((GetUnitX(Source))*1.))
      call SaveReal(hashtable019,(Cache),(283),((GetUnitY(Source))*1.))
      if d>300 then
        set a=Atan2(GetUnitY(Target)-GetUnitY(Source),GetUnitX(Target)-GetUnitX(Source))
        set x1=GetUnitX(Source)+300*Cos(a)
        set y1=GetUnitY(Source)+300*Sin(a)
        if(IsPointInRegion(RestrictedRegion,((x1)*1.),((y1)*1.)))==false then
          call SetUnitX(Target,x1)
          call SetUnitY(Target,y1)
        endif
      endif
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set Caster=null
  return false
endfunction

function QXF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'u00Y',GetUnitX(Source),GetUnitY(Source),0)
  local integer Level=GetUnitAbilityLevel(Source,'A19O')
  if Level==0 then
    set Level=GetUnitAbilityLevel(Source,'A1MV')+2
  endif
  call UnitAddAbility2(Source,'Abun')
  call UnitAddAbility2(Caster,'A19N')
  call SetUnitAbilityLevel(Caster,'A19N',GetUnitAbilityLevel(Source,'A19O'))
  call IssueTargetOrderById(Caster,852480,Target)
  call SetUnitPathing(Caster,false)
  call SetUnitPathing(Target,false)
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QWF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveReal(hashtable019,(Cache),(57),((2.5+Level*.5)*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Human\\AerialShackles\\AerialShacklesTarget.mdl",Target,"chest")))
  call SaveReal(hashtable019,(Cache),(282),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(283),((GetUnitY(Source))*1.))
  set t=null
  set Source=null
  set Target=null
  set Caster=null
endfunction

function Batrider_FlamingLasso takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false and GetUnitTypeId(GetSpellTargetUnit())!='n00L' then
    call QXF()
  endif
endfunction

function QZF takes unit Source,unit Target,real QQE returns nothing
  call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)+GetUnitState(Target,UNIT_STATE_MAX_LIFE)*QQE)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HeroBloodElfBlood.mdl",Source,"overhead"))
endfunction

function QAF takes nothing returns boolean
  if IsDead(GetFilterUnit())==false and IMaxIF(GetUnitAbilityLevel(GetFilterUnit(),'A0LE'),GetUnitAbilityLevel(GetFilterUnit(),'QP1Y'))>0 and IsUnitEnemy(I88,GetOwningPlayer(GetFilterUnit()))then
    call QZF(GetFilterUnit(),I88,IMaxIF(GetUnitAbilityLevel(GetFilterUnit(),'A0LE'),GetUnitAbilityLevel(GetFilterUnit(),'QP1Y'))*.1*.5)
  endif
  return false
endfunction

function QBF takes unit Source,unit Target,integer Level returns nothing
  local group g=GetAvailableGroup()
  set I88=Target
  call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),350,Condition(function QAF))
  call KillGroup(g)
  set I88=null
  set g=null
endfunction

function BS_BloodBath_Clear takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer lvl=LoadInteger(hashtable019,h,0)
  local boolean ishero=LoadBoolean(hashtable019,h,0)
  local integer bonus1=lvl*10
  local integer bonus2=lvl*5
  if ishero then
    set bonus1=bonus1*2
    set bonus2=bonus2*2
  endif
  //call echo("Removed "+I2S(bonus1))
  call LoDStat_Sub(u,bonus1,"attack")
  call LoDStat_Sub(u,bonus2,"damage")
  call UnitRemoveAbility(u,'A33M')
  call UnitRemoveAbility(u,'B0GY')
  call SaveBoolean(MHT,GetHandleId(u),'A0LE',false)
  call DestroyTimer(t)
  call FlushChildHashtable(hashtable019,h)
  set u=null
  set t=null
endfunction

function BS_BloodBath_Start takes unit u, integer lvl, boolean ishero returns nothing
  local integer oldlvl
  local timer t
  local real r
  local integer h=GetHandleId(u)
  local boolean b=LoadBoolean(MHT,h,'A0LE')//timer exists?
  local integer oldbonus1
  local integer oldbonus2
  local real duration=3
  local integer heromult=1
  if ishero then
    set duration=15
    set heromult=2
  endif
  if b then
    set t=LoadTimerHandle(MHT,h,'A0LE')
    set oldlvl=LoadInteger(hashtable019,GetHandleId(t),0)
    
    set oldbonus1=oldlvl*10
    set oldbonus2=oldlvl*5
    if LoadBoolean(hashtable019,GetHandleId(t),0) then
      set oldbonus1=oldbonus1*2
      set oldbonus2=oldbonus2*2
    endif
    //call echo(I2S(oldbonus1)+" bonus, new bonus "+I2S(lvl*10*heromult))
    if TimerGetRemaining(t)<duration or oldbonus1<lvl*10*heromult then
      //call echo("replace")
      call TimerStart(t,duration,false,function BS_BloodBath_Clear)
      if oldbonus1<lvl*10*heromult then
        //call echo("fixbonus: add "+I2S(lvl*10*heromult-oldbonus1)+" AS and "+I2S(lvl*5*heromult-oldbonus2)+" dmg")
        call LoDStat_Add(u,lvl*10*heromult-oldbonus1,"attack")
        call LoDStat_Add(u,lvl*5*heromult-oldbonus2,"damage")
        call SaveInteger(hashtable019,GetHandleId(t),0,lvl)
        call SaveBoolean(hashtable019,GetHandleId(t),0,ishero)
      endif
    endif
    
  else
    call SaveBoolean(MHT,h,'A0LE',true)
    set t=CreateTimer()
    call TimerStart(t,duration,false,function BS_BloodBath_Clear)
    call SaveBoolean(hashtable019,GetHandleId(t),0,ishero)
    call SaveInteger(hashtable019,GetHandleId(t),0,lvl)
    call SaveUnitHandle(hashtable019,GetHandleId(t),0,u)
    call SaveTimerHandle(MHT,h,'A0LE',t)
    call LoDStat_Add(u,lvl*10*heromult,"attack")
    call LoDStat_Add(u,lvl*5*heromult,"damage")
    call UnitAddAbility2(u,'A33M')
  endif
  set t=null
endfunction

function BS_BloodBath takes nothing returns boolean
  local unit Source=GetKillingUnit()
  local unit Target=GetTriggerUnit()
  local integer lvl
  if GetUnitTypeId(Source)=='e00E' or IsUnitType(Source,UNIT_TYPE_HERO)==false then
    set Source=udg_Hero[GetPlayerId(GetOwningPlayer(Source))]
  endif
  set lvl=(GetUnitAbilityLevel(Source,'A0LE')+GetUnitAbilityLevel(Source,'QP1Y'))
  if IsUnitIllusion(Target)==false and IsUnitType(Target,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Target)!='n00L' and GetUnitAbilityLevel(Source,'BNdo')==0 then
    
    if IsUnitType(Target,UNIT_TYPE_HERO)==false then
      if lvl>0 then
        
        call BS_BloodBath_Start(Source,lvl,false)
        call QZF(Source,Target,lvl*.05+.05)
      endif
    else
      if lvl>0 then
        call BS_BloodBath_Start(Source,lvl,true)
        call QZF(Source,Target,lvl*.1)
      else
        call QBF(Source,Target,lvl)
      endif
    endif
  endif
  set Source=null
  set Target=null
  return false
endfunction

function O79 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function BS_BloodBath))
  set t=null
endfunction

function Q3F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real LastX=(LoadReal(hashtable019,(Cache),(23)))
  local real LastY=(LoadReal(hashtable019,(Cache),(24)))
  local real x=GetUnitX(Target)
  local real y=GetUnitY(Target)
  local real d=SquareRoot((LastX-x)*(LastX-x)+(LastY-y)*(LastY-y))
  local real dmg=.2*Level*d
  local integer tic=(LoadInteger(hashtable019,(Cache),(25)))
  if d>1300 then
    set dmg=0
  endif
  if dmg>5 then
    call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Target,"origin"))
  endif
  if dmg>0 and IsDead(Target)==false then
    call DamageTarget(Source,Target,6,dmg)
  endif
  call SaveReal(hashtable019,(Cache),(23),((x)*1.))
  call SaveReal(hashtable019,(Cache),(24),((y)*1.))
  call SaveInteger(hashtable019,(Cache),(25),(tic+1))
  if IsDead(Target)then
    call UnitRemoveAbility(Target,'A0IH')
    call UnitRemoveAbility(Target,'B08L')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif tic>4*(6+Level)then
    call UnitRemoveAbility(Target,'A0IH')
    call UnitRemoveAbility(Target,'B08L')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Q6F takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A0LH')
  call UnitAddAbility2(Target,'A0IH')
  call SetUnitAbilityLevel(Target,'A0IH',Level)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Target,"chest"))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(23),((GetUnitX(Target))*1.))
  call SaveReal(hashtable019,(Cache),(24),((GetUnitY(Target))*1.))
  call SaveInteger(hashtable019,(Cache),(25),(0))
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerAddCondition(t,Condition(function Q3F))
  call DamageTarget(Source,Target,6,50+100*Level)
  set Source=null
  set Target=null
  set t=null
endfunction

function BS_Rupture takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false and IsCourier(GetSpellTargetUnit())==false then
    call Q6F()
  endif
endfunction

function Q1F takes nothing returns nothing
  local unit Caster
  local unit u=GetEnumUnit()
  
  if(LoadBoolean(HeroStats,GetHandleId(u),24)==false)then//dummy not created yet
    call SaveBoolean(HeroStats,GetHandleId(u),24,true)
    call SaveUnitHandle(HeroStats,GetHandleId(u),24,CreateUnit(GetOwningPlayer(IF8),'hBST',GetUnitX(u),GetUnitY(u),0))
    call SetUnitMoveSpeed(LoadUnitHandle(HeroStats,GetHandleId(u),24),522)
    call IssueTargetOrderById(LoadUnitHandle(HeroStats,GetHandleId(u),24),851986,u)
  else
    call SetUnitX(LoadUnitHandle(HeroStats,GetHandleId(u),24),GetUnitX(u))
    call SetUnitY(LoadUnitHandle(HeroStats,GetHandleId(u),24),GetUnitY(u))
    
    if GenericCondition_IsDotAInvis(u) then
      if GetUnitAbilityLevel(u,'A1HX')>0 then
        call UnitRemoveAbility(LoadUnitHandle(HeroStats,GetHandleId(u),24),'A30X')
      else
        if GetUnitAbilityLevel(LoadUnitHandle(HeroStats,GetHandleId(u),24),'A30X')==0 then
          call UnitAddAbility(LoadUnitHandle(HeroStats,GetHandleId(u),24),'A30X')
        endif
      endif
    else
      if GetUnitAbilityLevel(LoadUnitHandle(HeroStats,GetHandleId(u),24),'A30X')>0 then
        call UnitRemoveAbility(LoadUnitHandle(HeroStats,GetHandleId(u),24),'A30X')
      endif
    endif
  endif
  set Caster=null
  set u=null
endfunction

function Q0F takes nothing returns nothing
  local unit u=GetEnumUnit()
  if IsDead(IF8) or IsUnitInGroup(GetEnumUnit(),IE8)==false or GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)/ GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)>.5 or(GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)/ GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)>.25 and GenericCondition_IsDotAInvis(GetEnumUnit()))then
    call GroupRemoveUnit(ID8,GetEnumUnit())
    if(LoadBoolean(HeroStats,GetHandleId(u),24))then//dummy was created
      call SaveBoolean(HeroStats,GetHandleId(u),24,false)
      call SetUnitPosition(LoadUnitHandle(HeroStats,GetHandleId(u),24),7536,-7632)
      call KillUnit(LoadUnitHandle(HeroStats,GetHandleId(u),24))
    endif
    call UnitRemoveAbility(GetEnumUnit(),'B0EY')
  endif
  set u=null
endfunction

function Q5F takes nothing returns nothing
  local unit u = GetEnumUnit()
  local real life
  local real limit=.5
  if Mode_EB then
    set limit=0.35
  endif
  if IsDead(IF8)==false and IsUnitInGroup(u,ID8)==false and IsUnitIllusion(u)==false then
    set life = GetWidgetLife(u)/GetUnitState(u,UNIT_STATE_MAX_LIFE)
    
    if 0.25 > life or (life<limit and GenericCondition_IsDotAInvis(u)==false)then
      call GroupAddUnit(ID8,u)
    endif
  endif
  
  set u = null
endfunction

function Thirst_IsUnitLowHP takes unit u returns boolean
  local real life
  local real limit=.5
  if Mode_EB then
    set limit=0.35
  endif
  if IsDead(u) then
    return false
  endif
  if IsDead(IF8)==false then
    set life = GetWidgetLife(u)/GetUnitState(u,UNIT_STATE_MAX_LIFE)
    if 0.25 > life or (life<limit and GenericCondition_IsDotAInvis(u)==false)then
      return true
    endif
  endif
  return false
endfunction


function Thirst_StickDummiesTo takes unit u returns nothing
  local unit dummy
  local integer h=GetHandleId(u)
  if(LoadBoolean(HeroStats,h,24)==false)then//dummy not created yet
    call SaveBoolean(HeroStats,h,24,true)
    set dummy=CreateUnit(GetOwningPlayer(IF8),'hBST',GetUnitX(u),GetUnitY(u),0)
    call SaveUnitHandle(HeroStats,h,24,dummy)
    call SetUnitMoveSpeed(dummy,522)
    call IssueTargetOrderById(dummy,851986,u)
  else
    set dummy=LoadUnitHandle(HeroStats,h,24)
    call SetUnitX(dummy,GetUnitX(u))
    call SetUnitY(dummy,GetUnitY(u))
    
    if GenericCondition_IsDotAInvis(u) then
      if GetUnitAbilityLevel(u,'A1HX')>0 then
        call UnitRemoveAbility(dummy,'A30X')
      elseif GetUnitAbilityLevel(dummy,'A30X')==0 then
        call UnitAddAbility(dummy,'A30X')
      endif
    else
      if GetUnitAbilityLevel(dummy,'A30X')>0 then
        call UnitRemoveAbility(dummy,'A30X')
      endif
    endif
  endif
  set dummy=null
endfunction

function Thirst_DeleteDummiesFrom takes unit u returns nothing
  local integer h=GetHandleId(u)
  if(LoadBoolean(HeroStats,h,24))then//dummy was created
    call SaveBoolean(HeroStats,h,24,false)
    call SetUnitPosition(LoadUnitHandle(HeroStats,h,24),7536,-7632)
    call KillUnit(LoadUnitHandle(HeroStats,h,24))
    call UnitRemoveAbility(u,'B0EY')
  endif
endfunction

function Q2F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=GetUnitAbilityLevel(Source,'A0I8')+GetUnitAbilityLevel(Source,'QP1Z')
  local integer damage=Level*10-5
  local boolean BonusHere=LoadBoolean(hashtable019,Cache,0)
  local integer BonusVal=LoadInteger(hashtable019,Cache,0)
  local integer msbonus=LoadInteger(hashtable019,Cache,2)
  local integer count=0
  local integer msboost=0
  local integer fpi=1//first player index
  local integer lpi=5//last player index
  local integer i=0
  local unit u
  if IsSentinel(GetOwningPlayer(Source)) then
    set fpi=7
    set lpi=11
  endif
  set i=fpi
  loop
    set u=udg_Hero[i]
    if u!=null then
      set IF8=Source
      if(Thirst_IsUnitLowHP(u))then
        call Thirst_StickDummiesTo(u)
        set count=count+1
      elseif(LoadBoolean(HeroStats,GetHandleId(u),24))then
        call Thirst_DeleteDummiesFrom(u)
      endif
    endif
    set i=i+1
    exitwhen i>lpi
  endloop
  //call echo("there")
  if count==0 then
    call SaveInteger(hashtable019,Cache,2,0)
    call UnitRemoveAbility(Source,'A214')
    if BonusHere then
      call LoDStat_Sub(Source,BonusVal,"damage")
      call SaveBoolean(hashtable019,Cache,0,false)
    endif
    call SaveInteger(HeroStats,GetHandleId(Source),'A214',0)
  else
    set damage=damage*count
    if BonusHere==false then
      call LoDStat_Add(Source,damage,"damage")
      call SaveBoolean(hashtable019,Cache,0,true)
      call SaveInteger(hashtable019,Cache,0,damage)
    elseif BonusVal!=damage then
      call LoDStat_Sub(Source,BonusVal,"damage")
      call LoDStat_Add(Source,damage,"damage")
      call SaveInteger(hashtable019,Cache,0,damage)
    endif
    set msboost=Level*7*count
    if msboost!=msbonus then
      call SaveInteger(hashtable019,Cache,2,msboost)
    endif
    call SaveInteger(HeroStats,GetHandleId(Source),'A214',count)
    call SaveInteger(HeroStats,GetHandleId(Source),'A215',Level)
    call UnitAddAbility2(Source,'A214')
  endif
  set t=null
  set Source=null
  set u=null
  return false
endfunction

function BS_RemoveSpeedCap_Moveunit takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer bonus=LoadInteger(hashtable019,h,0)
  local real x
  local real y
  local real dx
  local real dy
  local real angle
  local real ms
  local real d
  local real angle2
  local real i=1
  local real currentspeed=GetUnitDefaultMoveSpeed(u)+GetUnitOffsetSpeed(u)
  if currentspeed>1000 then
    set currentspeed=1000-522
  endif
  if LoadBoolean(hashtable019,h,0) then
    set bonus=100
  endif
  call SaveReal(HeroStats,GetHandleId(u),99,R2I(currentspeed*bonus/100))
  if bonus>0 and IsDead(u)==false then
    set x=GetUnitX(u)
    set y=GetUnitY(u)
    set dx=LoadReal(hashtable019,h,10)
    set dy=LoadReal(hashtable019,h,11)
    set d=DistanceBetweenXY(dx,dy,x,y)
    //call echo(R2S(d))
    if LoadBoolean(HeroStats,GetHandleId(u),99)==false then//not triggered
      if (d<100 and d>1) and GetUnitCurrentOrder(u)!=851993 and GetUnitCurrentOrder(u)!=851972 and GetUnitCurrentOrder(u)!=851973 then//not holded, stopped or stunned
        set angle=Atan2(y-dy,x-dx)
        //if RAbsBJ(GetUnitFacing(u)*bj_DEGTORAD)-RAbsBJ(angle)<2 then
        //set angle=GetUnitFacing(u)*bj_DEGTORAD
        //endif
        set ms=currentspeed*bonus*ThirstInterval/100
        call SaveReal(HeroStats,GetHandleId(u),99,R2I(ms*(1/ThirstInterval)))
        //				loop
        //					if not(IsTerrainPathable(x+i*Cos(angle),y+i*Cos(angle),PATHING_TYPE_WALKABILITY))then
        //						set i=i+32
        //					else
        //						set ms=i-1
        //					endif
        //					exitwhen i>=ms
        //				endloop
        
        call SetUnitX(u,SafeX50(x+ms*Cos(angle)))
        call SetUnitY(u,SafeY50(y+ms*Sin(angle)))
        
      endif
    else
      call SaveBoolean(HeroStats,GetHandleId(u),99,false)
    endif
    call SaveReal(hashtable019,h,10,GetUnitX(u))
    call SaveReal(hashtable019,h,11,GetUnitY(u))
    
  endif
  set t=null
  set u=null
endfunction

function BS_RemoveSpeedCap takes unit u, integer bonus,boolean isVoid returns nothing
  local timer t
  if LoadBoolean(HeroStats,GetHandleId(u),'A214')==false then
    call SaveBoolean(HeroStats,GetHandleId(u),'A214',true)//timer created
    set t=CreateTimer()
    call TimerStart(t,ThirstInterval,true,function BS_RemoveSpeedCap_Moveunit)
    call SaveUnitHandle(hashtable019,GetHandleId(t),0,u)
    call SaveReal(hashtable019,GetHandleId(t),10,GetUnitX(u))
    call SaveReal(hashtable019,GetHandleId(t),11,GetUnitY(u))
    call SaveBoolean(hashtable019,GetHandleId(t),100,true)
    call SaveTimerHandle(HeroStats,GetHandleId(u),'A214',t)
  else
    set t=LoadTimerHandle(HeroStats,GetHandleId(u),'A214')
  endif
  call SaveInteger(hashtable019,GetHandleId(t),0,bonus)
  call SaveBoolean(hashtable019,GetHandleId(t),0,isVoid)
  if isVoid then
    set bonus=100
  endif
  if bonus==0 then
    call PauseTimer(t)
    call SaveReal(HeroStats,GetHandleId(u),99,0)
    call SaveBoolean(hashtable019,GetHandleId(t),100,false)
  elseif LoadBoolean(hashtable019,GetHandleId(t),100)==false then
    call TimerStart(t,ThirstInterval,true,function BS_RemoveSpeedCap_Moveunit)
    call SaveBoolean(hashtable019,GetHandleId(t),100,true)
  endif
  set t=null
endfunction

function BS_update_dummies takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer i=1
  local integer count=LoadInteger(HeroStats,GetHandleId(u),'A214')
  local integer Level=LoadInteger(HeroStats,GetHandleId(u),'A215')
  local integer bonus=(10*Level-5)*count
  loop
    if(LoadBoolean(HeroStats,GetHandleId(udg_Hero[i]),24))then
      call SetUnitX(LoadUnitHandle(HeroStats,GetHandleId(udg_Hero[i]),24),GetUnitX(udg_Hero[i]))
      call SetUnitY(LoadUnitHandle(HeroStats,GetHandleId(udg_Hero[i]),24),GetUnitY(udg_Hero[i]))
      call IssueTargetOrderById(LoadUnitHandle(HeroStats,GetHandleId(udg_Hero[i]),24),851986,udg_Hero[i])
    endif
    set i=i+1
    if i==6 then
      set i=7
    endif
    exitwhen i>11
  endloop
  call BS_RemoveSpeedCap(u,bonus,false)
  set t=null
  set u=null
endfunction

function Bloodseeker_Thrist_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerAddCondition(t,Condition(function Q2F))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  //call SaveGroupHandle(HY,(Cache),(22),(GetAvailableGroup()))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function BS_update_dummies))
  call SaveUnitHandle(hashtable019,GetHandleId(t),0,Source)
  set t=null
  set Source=null
endfunction 

function R8F takes nothing returns boolean
  if (GetLearnedSkill()=='A0I8' or GetLearnedSkill()=='QP1Z') and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Bloodseeker_Thrist_Learn()
  endif
  return false
endfunction

function OD9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function R8F))
  set t=null
endfunction

function BS_Bloodrage_Action takes nothing returns nothing
  local unit Target
  
  local unit Dummy
  set Target=GetSpellTargetUnit()
  set Dummy=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  
  if UnitAddAbility(Dummy,'A2TN') then
  endif
  if IssueTargetOrderById(Dummy,852111,Target) then//852275
  endif
  if IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(Target))==false then
    call UnitRemoveAbility(Target,'Aetl')
  endif
  set Target=null
  set Dummy=null
endfunction

function BS_Bloodrage_StopCastInit takes nothing returns boolean
  if GetSpellAbilityId()=='A0EC' and GetSpellTargetUnit()!=GetTriggerUnit()and IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))and(LoadBoolean(hashtable019,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n038'))
  endif
  return false
endfunction

function BS_Bloodrage_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function BS_Bloodrage_StopCastInit))
  set t=null
endfunction

function RDF takes nothing returns boolean
  return GetUnitTypeId(GetSummonedUnit())=='o003'
endfunction

function REF takes nothing returns nothing
  local unit RFF=GetSummonedUnit()
  local unit RGF=udg_Hero[GetPlayerId(GetOwningPlayer(GetSummoningUnit()))]
  local integer Cache=GetHandleId(RGF)
  local integer Level=GetUnitAbilityLevel(RGF,'Z234') //A0BG
  local integer RHF=(LoadInteger(hashtable019,(Cache),(279)))
  local unit RIF=(LoadUnitHandle(hashtable019,(Cache),(1400+1)))
  local integer x=1
  set RHF=RHF+1
  call SetUnitVertexColorBJ(RFF,100,100,100,85)
  call UnitAddAbility2(RFF,'Aloc')
  call SaveUnitHandle(hashtable019,(Cache),(1400+RHF),(RFF))
  if(RHF>Level*2)then
    call KillUnit(RIF)
    loop
      exitwhen x==RHF
      call SaveUnitHandle(hashtable019,(Cache),(1400+x),((LoadUnitHandle(hashtable019,(Cache),(1400+x+1)))))
      set x=x+1
    endloop
    set RHF=RHF-1
  endif
  call SaveInteger(hashtable019,(Cache),(279),(RHF))
  call SetUnitAbilityLevel(RFF,'A0BF',Level)
  set RFF=null
  set RGF=null
  set RIF=null
endfunction

function LoDSpinWeb_Cast takes nothing returns nothing
  local unit RFF=CreateUnit(GetOwningPlayer(GetTriggerUnit()),'o003',GetSpellTargetX(),GetSpellTargetY(),0)
  local unit RGF=udg_Hero[GetPlayerId(GetOwningPlayer(RFF))]
  local integer Cache=GetHandleId(RGF)
  local integer Level=GetUnitAbilityLevel(RGF,'Z234') //A0BG
  local integer RHF=(LoadInteger(hashtable019,(Cache),(279)))
  local unit RIF=(LoadUnitHandle(hashtable019,(Cache),(1400+1)))
  local integer x=1
  call SetUnitAnimation(RFF,"birth")
  call QueueUnitAnimation(RFF,"stand")
  set RHF=RHF+1
  call SetUnitVertexColorBJ(RFF,100,100,100,85)
  call UnitAddAbility2(RFF,'Aloc')
  call SaveUnitHandle(hashtable019,(Cache),(1400+RHF),(RFF))
  if(RHF>Level*2)then
    call KillUnit(RIF)
    loop
      exitwhen x==RHF
      call SaveUnitHandle(hashtable019,(Cache),(1400+x),((LoadUnitHandle(hashtable019,(Cache),(1400+x+1)))))
      set x=x+1
    endloop
    set RHF=RHF-1
  endif
  call SaveInteger(hashtable019,(Cache),(279),(RHF))
  call SetUnitAbilityLevel(RFF,'A0BF',Level)
  set RFF=null
  set RGF=null
  set RIF=null
endfunction


function Func1114 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function RDF))
  call TriggerAddAction(t,function REF)
  set t=null
endfunction

function Brood_WebAllies takes nothing returns boolean
  return GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(BroodWebTemp) and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0
endfunction

function Brood_Web_OutOfRange takes nothing returns nothing
  local real x
  local real y
  local unit web
  local integer i=1
  local unit u
  local boolean b=false
  set u=udg_Hero[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]
  if u!=null then
    loop
      set web=LoadUnitHandle(hashtable019,GetHandleId(u),1400+i)
      if web!=null then
        set x=GetUnitX(web)
        set y=GetUnitY(web)
        if(DistanceBetweenXY(x,y,GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()))<875)then
          set b=true
        endif
      else 
        set i=9
      endif
      set i=i+1
      exitwhen i>9 or b
    endloop
  endif
  if b==false then
    //call BJDebugMsg("notfound "+GetObjectName(GetUnitTypeId(TEMPUNIT)))
    if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO)then
      call UnitRemoveAbility(GetEnumUnit(),'A021')
    else
      call UnitRemoveAbility(GetEnumUnit(),'A29C')
    endif
    call UnitRemoveAbility(GetEnumUnit(),'B01C')
    call SetUnitPathing(GetEnumUnit(),true)
  endif
  set web=null
  set u=null
endfunction

function Brood_Web_InRange takes nothing returns nothing
  local unit u=GetEnumUnit()
  local player p=Sentinels[0]
  if IsSentinel(GetOwningPlayer(u)) then
    set p=Scourges[0]
  endif
  if IsUnitType(u,UNIT_TYPE_HERO)then
    if GetUnitAbilityLevel(u,'A021')==0 then
      call UnitAddAbility(u,'A021')
    endif
  else
    if GetUnitAbilityLevel(u,'A29C')==0 then
      call UnitAddAbility(u,'A29C')
    endif
  endif
  if IsUnitVisibleLoD(u,p)==false then
    call SetUnitPathing(u,false)
  else
    call SetUnitPathing(u,true)
  endif
endfunction

function Brood_WebDuration takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local group g
  local group gg
  local unit u
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call DestroyGroup(LoadGroupHandle(hashtable019,h,1))
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  else
    if LoadBoolean(hashtable019,h,0)==false then
      set g=CreateGroup()
      call SaveBoolean(hashtable019,h,0,true)
      call SaveGroupHandle(hashtable019,h,1,g)
    endif
    set u=LoadUnitHandle(hashtable019,h,0)
    set g=LoadGroupHandle(hashtable019,h,1)
    
    set gg=GetAvailableGroup()
    set BroodWebTemp=u
    call GroupEnumUnitsInRange(gg,GetUnitX(u),GetUnitY(u),900,Condition(function Brood_WebAllies))
    call GroupRemoveGroup(gg,g)//
    set BroodWebTemp=u
    call ForGroup(g,function Brood_Web_OutOfRange)
    call ForGroup(gg,function Brood_Web_InRange)
    call GroupClear(g)
    call GroupAddGroup(gg,g)
    call KillGroup(gg)
    set gg=null
  endif
  set t=null
  set g=null
  set u=null
endfunction

function Brood_WebDecected takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.3,true)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Brood_WebDuration))
  call SaveUnitHandle(hashtable019,h,0,GetTriggerUnit())
  call SaveBoolean(hashtable019,h,0,false)
  set t=null
endfunction

function Brood_RegisterSpinWeb takes nothing returns nothing
  if GetUnitTypeId(GetTriggerUnit())=='o003' then
    call Brood_WebDecected()
  endif
endfunction

function Brood_RegisterSpinWebAppears takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterEnterRectSimple(t,GetWorldBounds())
  call TriggerAddCondition(t,Condition(function Brood_RegisterSpinWeb))
  set t=null
endfunction
//
//function Brood_Hunger_LifestealForRanged takes nothing returns nothing
//	local trigger t=GetTriggeringTrigger()
//	local integer h=GetHandleId(t)
//	local unit brood=LoadUnitHandle(HY,h,0)
//	local unit target=LoadUnitHandle(HY,h,1)
//	local integer bh=GetHandleId(brood)
//	local integer th=GetHandleId(target)
//	local integer lvl=LoadInteger(HY,h,0)
//	local real r
//	local real heal
//	if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
//		call RemoveSavedBoolean(HeroStats,bh,th)
//		call RemoveSavedHandle(HeroStats,bh,th)
//		call FlushChildHashtable(HY,h)
//		call CleanTrigger(t)
//	else
//		if GetEventDamageSource()==brood and IsRealDamage and IsDamageReal(GetEventDamage()) then
//			call RemoveSavedBoolean(HeroStats,bh,th)
//			call RemoveSavedHandle(HeroStats,bh,th)
//			if IsDead(brood)==false then
//				set r=0.2+0.2*lvl
//				set heal=GetEventDamage()*r
//				call SetUnitState(brood,UNIT_STATE_LIFE,GetUnitState(brood,UNIT_STATE_LIFE)+heal)
//			endif
//			call CleanTrigger(t)
//			call FlushChildHashtable(HY,h)
//			
//			
//		endif
//	endif
//	
//	set brood=null
//	set target=null
//	set t=null
//endfunction
//
//function Brood_Hunger_CustomLifesteal takes unit brood, unit target returns nothing
//	local trigger t=CreateTrigger()
//	local integer h=GetHandleId(t)
//	local integer bh=GetHandleId(brood)
//	local integer th=GetHandleId(target)
//	local boolean triggeralreadyexist=LoadBoolean(HeroStats,bh,th)
//	if triggeralreadyexist then
//		call FlushChildHashtable(HY,GetHandleId(LoadTriggerHandle(HeroStats,bh,th)))
//		call CleanTrigger(LoadTriggerHandle(HeroStats,bh,th))
//	endif
//	call TriggerRegisterTimerEvent(t,3.5,false)
//	call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DAMAGED)
//	call SaveUnitHandle(HY,h,0,brood)
//	call SaveUnitHandle(HY,h,1,target)
//	call SaveInteger(HY,h,0,GetUnitAbilityLevel(brood,'A0WR'))
//	call TriggerAddCondition(t,Condition(function Brood_Hunger_LifestealForRanged))
//	call SaveBoolean(HeroStats,bh,th,true)
//	call SaveTriggerHandle(HeroStats,bh,th,t)
//	set t=null
//endfunction

function RQF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  if GetTriggerEventId()!=EVENT_PLAYER_UNIT_SPELL_EFFECT or(GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT and EF9(GetSpellAbilityId())and GetSpellTargetUnit()==Hero)then
    if IsDead(Hero)==false then
      call UnitRemoveAbility(Hero,'A0WR')
      call UnitRemoveAbility(Hero,'B01E')
    endif
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Hero=null
  return false
endfunction

function Brood_Hunger takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  call TriggerRegisterTimerEvent(t,14,false)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function RQF))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Items\\VampiricPotion\\VampPotionCaster.mdl",Hero,"origin")))
  call UnitAddAbility2(Hero,'A0WR')
  call SetUnitAbilityLevel(Hero,'A0WR',GetUnitAbilityLevel(Hero,'A0WQ'))
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A0WR',false)
  set t=null
  set Hero=null
endfunction

function RTF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  if GetTriggerEvalCount(t)>300 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetUnitAbilityLevel(Target,'B0E7')>0 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call DamageTarget(Source,Target,1,GetUnitAbilityLevel(Source,'A0BH')*75)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Brood_SpawnSpiderlings takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  call TriggerRegisterTimerEvent(t,.01,true)
  call TriggerAddCondition(t,Condition(function RTF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  set t=null
  set Source=null
  set Target=null
endfunction






function Chaos_Bolt_Damage takes nothing returns boolean
  local texttag text
  local unit u
  local trigger trig = GetTriggeringTrigger()
  local integer info = GetHandleId(trig)
  local integer i
  local real d
  
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call FlushChildHashtable(MHT,info)
    call CleanTrigger(trig)
  elseif GetEventDamageSource()==LoadUnitHandle(MHT,info,0) then
    set text = CreateTextTag()
    set d = LoadReal(MHT,info,0)
    set i = LoadInteger(MHT,info,0)
    set u = LoadUnitHandle(MHT,info,2)
    
    call SetTextTagText(text,"+"+I2S(R2I(d)),.025) //damage
    call SetTextTagPosUnit(text,u,10)
    call SetTextTagColor(text,255,0,0,255)
    call SetTextTagVelocity(text,0,.0355)
    call SetTextTagFadepoint(text,2)
    call SetTextTagPermanent(text,false)
    call SetTextTagLifespan(text,2)
    
    call TextTagOnUnit(I2S(i),i,u,.03,127,127,255,255) //stun
    
    call DamageTarget(LoadUnitHandle(MHT,info,1),u,1,d)
    call FlushChildHashtable(MHT,info)
    call CleanTrigger(trig)
    set text = null
    set u = null
  endif
  
  set trig = null
  return false
endfunction

function Chaos_Bolt_Start takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local unit t = GetSpellTargetUnit()
  local unit d = CreateUnit(GetOwningPlayer(t),'e00E',GetWidgetX(u),GetWidgetY(u),0)
  local trigger trig = CreateTrigger()
  local integer level = IMaxIF(GetUnitAbilityLevel(u,'A055'),GetUnitAbilityLevel(u,'QB00'))
  local integer info = GetHandleId(trig)
  local integer stun
  set stun=GetRandomInt(1 + level/4,1 + level - level/4)//this is correct and doesnt require an additional if statement, so dont change it
  if level==1 then
    call SaveReal(MHT,info,0,200/stun)
  elseif level==2 then
    if stun==1 then
      call SaveReal(MHT,info,0,225)
    elseif stun==2 then
      call SaveReal(MHT,info,0,150)
    elseif stun==3 then
      call SaveReal(MHT,info,0,50)
    endif
  elseif level==3 then
    if stun==1 then
      call SaveReal(MHT,info,0,250)
    elseif stun==2 then
      call SaveReal(MHT,info,0,175)
    elseif stun==3 then
      call SaveReal(MHT,info,0,100)
    elseif stun==4 then
      call SaveReal(MHT,info,0,75)
    endif
  else
    if stun==2 then
      call SaveReal(MHT,info,0,275)
    elseif stun==3 then
      call SaveReal(MHT,info,0,180)
    elseif stun==4 then
      call SaveReal(MHT,info,0,100)
    endif
  endif
  
  call SaveUnitHandle(MHT,info,0,d)
  call SaveUnitHandle(MHT,info,1,u)
  call SaveUnitHandle(MHT,info,2,t)
  call SaveInteger(MHT,info,0,stun)
  call TriggerRegisterTimerEvent(trig,10,false)
  call TriggerRegisterUnitEvent(trig,t,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(trig,Condition(function Chaos_Bolt_Damage))
  
  call UnitAddAbility(d,'A04U')
  call SetUnitAbilityLevel(d,'A04U',stun)
  call IssueTargetOrder(d,"thunderbolt",t)
  
  set trig = null
  set d = null
  set u = null
  set t = null
endfunction


function RAF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call SaveInteger(hashtable019,GetHandleId(Source),'a430',(0))
  call G79(Source)
  set t=null
  set Source=null
  return false
endfunction

function RBF takes nothing returns boolean
  if GetUnitTypeId(GetFilterUnit())==GetUnitTypeId(IK8)and GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(IK8)and IsUnitIllusion(GetFilterUnit()) then
    call SetUnitX(GetFilterUnit(),II8)
    call SetUnitY(GetFilterUnit(),IJ8)
    call IssueTargetOrderById(GetFilterUnit(),851983,IM8)
  endif
  return false
endfunction

function CK_RealityRift takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real TargetX=GetUnitX(Target)
  local real TargetY=GetUnitY(Target)
  local real J2E=AngleBetweenXY(SourceX,SourceY,TargetX,TargetY)
  local real YR8=DistanceBetweenXY(SourceX,SourceY,TargetX,TargetY)
  local real d=GetRandomReal(YR8*.3,YR8*.8)
  local integer Level=GetUnitAbilityLevel(Source,'A0RW')
  local real AO8=SourceX+d*Cos(J2E*bj_DEGTORAD)
  local real AP8=SourceY+d*Sin(J2E*bj_DEGTORAD)
  local unit u=CreateUnit(GetOwningPlayer(Source),IH8,AO8,AP8,0)
  local unit u2
  local group g
  local trigger t
  local integer Cache
  call SetUnitX(Source,AO8)
  call SetUnitY(Source,AP8)
  call SetUnitFacing(Source,-J2E)
  call PlaySoundOnUnitBJ(sound005,100,Target)
  if IsUnitEnemy(Target,GetOwningPlayer(Source))and GetUnitTypeId(Target)!='n00L' then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,1.2,false)
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function RAF))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    set t=null
    call SaveInteger(hashtable019,GetHandleId(Source),'a430',(25*Level))
    call G79(Source)
    set AO8=SourceX+(d-25)*Cos(J2E*bj_DEGTORAD)
    set AP8=SourceY+(d-25)*Sin(J2E*bj_DEGTORAD)
    call AddTimedKeyToUnit(Target,4405,1)
    call SetUnitX(Target,AO8)
    call SetUnitY(Target,AP8)
    call SetUnitFacing(Target,J2E)
    call IssueTargetOrderById(Source,851983,Target)
    set g=GetAvailableGroup()
    set II8=AO8
    set IJ8=AP8
    set IK8=Source
    set IM8=Target
    call GroupEnumUnitsInRange(g,SourceX,SourceY,1400,Condition(function RBF))
    call KillGroup(g)
    set u2=CreateUnit(GetOwningPlayer(Source),IH8,AO8,AP8,0)
    call KillUnit(u2)
  endif
  call KillUnit(u)
  set Source=null
  set Target=null
  set u=null
  set u2=null
  set g=null
endfunction

function R6F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit u=CreateUnit(GetOwningPlayer(Hero),IH8,GetUnitX(Hero),GetUnitY(Hero),0)
  call PlaySoundOnUnitBJ(sound005,100,Hero)
  call KillUnit(u)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set u=null
  set t=null
  set Hero=null
  return false
endfunction

function CK_RealityRift_OnCast takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerAddCondition(t,Condition(function R6F))
  call TriggerRegisterTimerEvent(t,.3,false)
  call SaveUnitHandle(hashtable019,(Cache),(14),(GetTriggerUnit()))
  set t=null
endfunction

function Bone_SearingArrows_Learn takes nothing returns nothing
  local integer lvl=GetUnitAbilityLevel(GetTriggerUnit(),'A303')
  if lvl==1 then
    call UnitAddAbility2(GetTriggerUnit(),'AHfa')
  endif
  call SetUnitAbilityLevel(GetTriggerUnit(),'AHfa',lvl)
endfunction

function Bone_SearingArrows_Check takes nothing returns nothing
  if GetLearnedSkill()=='A303'then
    call Bone_SearingArrows_Learn()
  endif
endfunction

function QF9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Bone_SearingArrows_Check))
  set t=null
endfunction

function R2F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real S4F=GetUnitState(Source,UNIT_STATE_LIFE)
  call UnitRemoveAbility(Source,'A1R0')
  call UnitRemoveAbility(Source,'B0D5')
  call SaveInteger(hashtable019,GetHandleId(Source),'a272',0)
  call G79(Source)
  call SaveInteger(hashtable019,GetHandleId(Source),'h272',0)
  call G89(Source,0)
  call SetUnitState(Source,UNIT_STATE_LIFE,S4F)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function S7F takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A04Q')
  local real S8F=GetUnitState(Target,UNIT_STATE_LIFE)
  local real S4F=GetUnitState(Source,UNIT_STATE_LIFE)
  local integer S9F=R2I((.035+.015*Level)*S8F)
  local integer SDF=R2I((.35+.15*Level)*S8F)
  call SaveInteger(hashtable019,GetHandleId(Source),'a272',S9F)
  call G79(Source)
  call SaveInteger(hashtable019,GetHandleId(Source),'h272',SDF)
  call G89(Source,SDF)
  call UnitAddAbility2(Source,'A1R0')
  call SetUnitState(Target,UNIT_STATE_LIFE,1)
  call DamageTarget(Source,Target,2,20)
  call DamageTarget(Source,Target,1,20)
  call DamageTarget(Source,Target,3,20)
  call SetUnitState(Source,UNIT_STATE_LIFE,S4F+SDF)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Target,"chest"))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,35,false)
  call TriggerAddCondition(t,Condition(function R2F))
  set Source=null
  set Target=null
  set t=null
endfunction

function BoneFletcher_DeathPact takes nothing returns nothing
  if GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)>.5 and IsCourier(GetSpellTargetUnit())==false then
    call S7F()
  endif
endfunction

function SFF takes integer x returns boolean
  return x=='A06X' or x=='A0AQ' or x=='A14O' or x=='A0NE' or x=='A14O' or x=='A1C0' or x=='A0SB'
endfunction

function SGF takes nothing returns boolean
  return(GetLearnedSkill()=='A0IF' or GetLearnedSkill()=='QP1A')and(IsUnitIllusion(GetTriggerUnit())==false)
endfunction

function SHF takes nothing returns boolean
  return GetUnitAbilityLevel(GetTriggerUnit(),'B06X')>0 and(IsItemAbilityById(GetSpellAbilityId())==false)and SFF(GetSpellAbilityId())==false and isDummyAbility(GetSpellAbilityId())==false and isItemSpellOrNoCd(GetSpellAbilityId())==false and isAintItemAbility(GetSpellAbilityId())
endfunction

function OD_EssenceAura_Delayed takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local unit u=LoadUnitHandle(hashtable019,GetHandleId(t),0)
  call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MANA)+.25*GetUnitState(u,UNIT_STATE_MAX_MANA))
  set u=null
  call FlushChildHashtable(hashtable019,GetHandleId(t))
  call CleanTrigger(t)
  set t=null
endfunction

function SIF takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit XX8=GetTriggerUnit()
  local unit SJF=(LoadUnitHandle(hashtable019,(Cache),(254)))
  local integer integer519=GetUnitAbilityLevel(SJF,'P347') //A0IF
  local trigger t
  if PRD_Get(XX8,'P347',integer519*10) and YQ8(XX8,SJF,1400)then
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,0,false)
    call TriggerAddCondition(t,Condition(function OD_EssenceAura_Delayed))
    call SaveUnitHandle(hashtable019,GetHandleId(t),0,XX8)
    set t=null
    
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl",XX8,"overhead"))
  endif
  set XX8=null
  set SJF=null
endfunction

function Destroyer_EssenceAura_Leveling takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local integer integer519=GetUnitAbilityLevel(XX8,'A0IF')
  local trigger t
  if integer519==0 and GetUnitAbilityLevel(XX8,'QP1A')>0 then
    set integer519=GetUnitAbilityLevel(XX8,'QP1A')
  endif
  if(integer519==1)then
    set t=CreateTrigger()
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
    call TriggerAddCondition(t,Condition(function SHF))
    call TriggerAddAction(t,function SIF)
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(254),(XX8))
  endif
  if(integer519==1)then
    call UnitAddAbility2(XX8,'A0OL')
  elseif(integer519==2)then
    call UnitAddAbility2(XX8,'A0OM')
  elseif(integer519==3)then
    call UnitAddAbility2(XX8,'A0ON')
  elseif(integer519==4)then
    call UnitAddAbility2(XX8,'A0OH')
  endif
  set XX8=null
  set t=null
endfunction

function QV9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function SGF))
  call TriggerAddAction(t,function Destroyer_EssenceAura_Leveling)
  set t=null
endfunction

function SMF takes nothing returns boolean
  local real d
  if GetUnitAbilityLevel(GetTriggerUnit(),'B06Y')>0 and GetUnitAbilityLevel(GetEventDamageSource(),'A0OI')>0 and(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(2)))==GetEventDamageSource()then
    call UnitRemoveAbility(GetTriggerUnit(),'B06Y')
    set d=.01*(5+GetUnitAbilityLevel(GetEventDamageSource(),'A0OI'))*(GetUnitState(GetEventDamageSource(),UNIT_STATE_MANA)+100)
    if(IsUnitType(GetTriggerUnit(),UNIT_TYPE_SUMMONED) or IsUnitIllusion(GetTriggerUnit()))and GetUnitTypeId(GetTriggerUnit())!='n004' and GetUnitTypeId(GetTriggerUnit())!='n018' and GetUnitTypeId(GetTriggerUnit())!='n01C' and GetUnitTypeId(GetTriggerUnit())!='n01G' and GetUnitTypeId(GetTriggerUnit())!='n00U' and GetUnitTypeId(GetTriggerUnit())!='n00Y' and GetUnitTypeId(GetTriggerUnit())!='n00Z' then
      set d=d+100*GetUnitAbilityLevel(GetEventDamageSource(),'A0OI')
    endif
    call TextTagOnUnit("+"+I2S(R2I(d)),1,GetTriggerUnit(),.023,191,64,255,216)
    if PRD_Get(GetEventDamageSource(),'P347',GetUnitAbilityLevel(GetEventDamageSource(),'P347')*10)and((LoadBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(264)))==false)then //A0IF
      call SetUnitState(GetEventDamageSource(),UNIT_STATE_MANA,GetUnitState(GetEventDamageSource(),UNIT_STATE_MANA)+.25*GetUnitState(GetEventDamageSource(),UNIT_STATE_MAX_MANA))
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl",GetEventDamageSource(),"overhead"))
    endif
    call DisableTrigger(GetTriggeringTrigger())
    call DamageTarget(GetEventDamageSource(),GetTriggerUnit(),3,d)
    call FlushChildHashtable(hashtable019,(GetHandleId(GetTriggeringTrigger())))
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function SNF takes nothing returns nothing
  local trigger t
  local unit Target
  local unit Source
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    set Target=GetSpellTargetUnit()
    set Source=GetTriggerUnit()
  else
    set Target=GetTriggerUnit()
    set Source=GetAttacker()
  endif
  if IsUnitIllusion(Source)==false then
    set t=CreateTrigger()
    if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
      call SaveBoolean(hashtable019,(GetHandleId(t)),(264),(true))
    else
      call SaveBoolean(hashtable019,(GetHandleId(t)),(264),(false))
    endif
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Source))
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerAddCondition(t,Condition(function SMF))
  endif
  set t=null
  set Target=null
  set Source=null
endfunction

function SOF takes nothing returns boolean
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetUnitAbilityLevel(GetAttacker(),'A0OI')>0 and(LoadBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263)))and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetAttacker()==(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(14)))then
      call SNF()
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER then
    if(GetIssuedOrderId()==852255)then
      call SaveBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263),(true))
    elseif(GetIssuedOrderId()==852256)then
      call SaveBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(263),(false))
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A0OI' then
    call SNF()
  endif
  return false
endfunction

function Destroyer_ArcaneOrb_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function SOF))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(GetTriggerUnit()))
  set t=null
endfunction

function SQF takes nothing returns boolean
  if GetLearnedSkill()=='A0OI' and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Destroyer_ArcaneOrb_Learn()
  endif
  return false
endfunction

function QW9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function SQF))
  set t=null
endfunction

function SRF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer SSF=(LoadInteger(hashtable019,(Cache),(262)))
  call SetHeroInt(Target,GetHeroInt(Target,false)+SSF,true)
  call SetHeroInt(Source,GetHeroInt(Source,false)-SSF,true)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function STF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call SaveInteger(hashtable019,(GetHandleId((Target))),((4303)),(2))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
  call SetUnitInvulnerable(Target,false)
  call PauseUnit(Target,false)
  call ShowUnit(Target,true)
  call ClearSelectionForPlayer(GetOwningPlayer(Target))
  call SelectUnitAddForPlayer(Target,GetOwningPlayer(Target))
  call RemoveSavedHandle(hashtable019,(GetHandleId(Source)),(748))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function OD_AstralImprisonment takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A0OJ')
  local integer SSF=IMinIF(GetHeroInt(Target,false),Level*2) + 2
  local trigger t
  local integer Cache
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'o019',GetUnitX(Target),GetUnitY(Target),0)
  call UnitApplyTimedLife(Caster,'BTLF',Level+1)
  if(IsUnitEnemy(Target,GetOwningPlayer(Source)))==false or IsBlocked(GetSpellTargetUnit())==false then
    call SaveInteger(hashtable019,(GetHandleId((Target))),((4303)),(1))
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SelectUnitRemoveForPlayer(Target,GetOwningPlayer(Target))
    call SetUnitInvulnerable(Target,true)
    call PauseUnit(Target,true)
    call ShowUnit(Target,false)
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffect("Abilities\\Spells\\Demon\\DarkConversion\\ZombifyTarget.mdl",GetUnitX(Target),GetUnitY(Target))))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call TriggerRegisterTimerEvent(t,Level,false)
    call TriggerAddCondition(t,Condition(function STF))
    if(IsUnitEnemy(Target,GetOwningPlayer(Source))) then
      call SaveUnitHandle(hashtable019,(GetHandleId(Source)),(748),(Target))
      call SetHeroInt(Target,GetHeroInt(Target,false)-SSF,true)
      call SetHeroInt(Source,GetHeroInt(Source,false)+SSF,true)
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
      call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
      call SaveInteger(hashtable019,(Cache),(262),(SSF))
      call TriggerRegisterTimerEvent(t,60,false)
      call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
      call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
      call TriggerAddCondition(t,Condition(function SRF))
    endif
  endif
  set Source=null
  set Target=null
  set Caster=null
  set t=null
endfunction

function OD_AstralImprisonment_OnCast takes nothing returns nothing
  if IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))and(LoadBoolean(hashtable019,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))and GetSpellTargetUnit()!=GetTriggerUnit()then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n038'))
  endif
endfunction

function SZF takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local unit SJF=GetTriggerUnit()
  local integer SAF
  local integer array SBF
  local integer Level=GetUnitAbilityLevel(SJF,'A0OK')
  local integer SCF=7+1*Level
  local integer i
  if GetHeroInt(SJF,true)==0 then
    set SJF=udg_Hero[GetPlayerId(GetOwningPlayer(SJF))]
  endif
  set i=GetUnitPrimaryAttribute(SJF)
  if i==1 then
    set SAF=GetHeroInt(SJF,true)-GetHeroInt(Target,true)
  elseif i==2 then
    set SAF=GetHeroAgi(SJF,true)-GetHeroAgi(Target,true)
  else
    set SAF=GetHeroStr(SJF,true)-GetHeroStr(Target,true)
  endif
  //set SAF=GetHeroInt(SJF,true)-GetHeroInt(Target,true)
  
  if Level==0 then
    set Level=GetUnitAbilityLevel(SJF,'A1VW')
    set SCF=7+1*Level+1
  endif
  set SBF[1]=10
  set SBF[2]=30
  set SBF[3]=50
  if(SAF>0)then
    call DamageTarget(SJF,Target,1,SAF*SCF)
    call TextTagOnUnit(I2S(R2I(SAF*SCF)),3,Target,.023,216,30,30,216)
    if(SAF<SBF[Level])then
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\SpellBreakerAttack.mdl",Target,"overhead"))
      call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)*.25)
    endif
  endif
  set Target=null
  set SJF=null
endfunction

function S3F takes nothing returns boolean
  if(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO))then
    if(IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit())))then
      return true
    endif
  endif
  return false
endfunction

function OD_SanityEclipse takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local integer integer519=GetUnitAbilityLevel(XX8,'A0OK')
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local group HQ9=GetAvailableGroup()
  local integer offset=0
  local unit SLF=(LoadUnitHandle(hashtable019,(GetHandleId(XX8)),(748)))
  if integer519==0 then
    set integer519=GetUnitAbilityLevel(XX8,'A1VW')
  endif
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl",x,y))
  loop
    exitwhen offset>=360
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl",x+(200+integer519*50)*Cos(offset*bj_DEGTORAD),y+(200+integer519*50)*Sin(offset*bj_DEGTORAD)))
    set offset=offset+45
  endloop
  call GroupEnumUnitsInRange(HQ9,x,y,300+integer519*100,Condition(function S3F))
  if SLF!=null and DistanceBetweenXY(x,y,GetUnitX(SLF),GetUnitY(SLF))<(300+integer519*100)then
    call SetUnitInvulnerable(SLF,false)
    call GroupAddUnit(HQ9,SLF)
  endif
  call ForGroup(HQ9,function SZF)
  if SLF!=null and IsDead(SLF)==false then
    call SetUnitInvulnerable(SLF,true)
  endif
  call KillGroup(HQ9)
  set HQ9=null
  set SLF=null
  set XX8=null
endfunction

function S1F takes nothing returns nothing
  call DamageTarget(IN8,GetEnumUnit(),1,IO8)
endfunction

function S0F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local group g
  //local integer Count= GetTriggerEvalCount(t)
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  //if GetTriggerEvalCount(t)>200 or GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEvalCount(t)>1 and GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A0QG' and GetSpellTargetUnit()==Target)then
  if Count>200 or GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call Buff_Remove(Target,LoDBuff_BuffID[1])
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(31))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A0QG' and GetSpellTargetUnit()==Target then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(31))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if Count==1 then
      call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
    endif
    
    set Count=Count+1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    set g=GetAvailableGroup()
    set tt_unit1=Source
    set IN8=Source
    set IO8=1.+2.*GetUnitAbilityLevel(Source,'A0QG')
    call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),275,Condition(function DefaultEnemyFilter))
    call GroupRemoveUnit(g,Target)
    call ForGroup(g,function S1F)
    call KillGroup(g)
    set Target=null
  endif
  set t=null
  set Source=null
  set g=null
  return false
endfunction

function DS_IonShell takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local unit target = GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local effect fx=AddSpecialEffectTarget("war3mapImported\\NewSoulArmor.mdx",GetSpellTargetUnit(),"chest")
  local integer Cache=GetHandleId(t)
  
  call Buff_Add(target,LoDBuff_AbilID[1],LoDBuff_BuffID[1],0)
  
  call PlaySoundAtPos(LC,GetUnitX(GetSpellTargetUnit()),GetUnitY(GetSpellTargetUnit()))
  call SaveUnitHandle(hashtable019,(Cache),(2),(u))
  call SaveUnitHandle(hashtable019,(Cache),(17),(target))
  call SaveEffectHandle(hashtable019,(Cache),(31),(fx))
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerRegisterDeathEvent(t,target)
  call TriggerAddCondition(t,Condition(function S0F))
  
  set u=null
  set t=null
  set fx=null
  set target=null
endfunction

function T4F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local integer Level
  local unit Source
  local unit Target
  local real x1
  local real y1
  local real d
  local real a
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
    set d=(LoadReal(hashtable019,(Cache),(138)))
    set x=(LoadReal(hashtable019,(Cache),(6)))
    set y=(LoadReal(hashtable019,(Cache),(7)))
    set a=(LoadReal(hashtable019,(Cache),(137)))
    set x1=GetUnitX(Target)+d/ 15*Cos(a)
    set y1=GetUnitY(Target)+d/ 15*Sin(a)
    if IsUnitType(Target,UNIT_TYPE_HERO) then
      call SaveBoolean(HeroStats,GetHandleId(Target),99,true)
      call SetUnitPosition(Target,x1,y1)
    else
      call SetUnitX(Target,x1)
      call SetUnitY(Target,y1)
    endif
    if GetTriggerEvalCount(t)>15 then
      set Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
      set Level=(LoadInteger(hashtable019,(Cache),(5)))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call DamageTarget(Source,Target,1,Level*40)
      set Source=null
    endif
    set Target=null
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function T7F takes nothing returns nothing
  local trigger t=null
  local unit Source=null
  local unit Target=GetEnumUnit()
  local integer Cache
  
  if IsUnitInvulnerable(Target) then
    set Target = null
    return
  endif
  
  set t = CreateTrigger()
  set Source = GetTriggerUnit()
  set Cache = GetHandleId(t)
  
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,.025,true)
  call TriggerAddCondition(t,Condition(function T4F))
  call SaveReal(hashtable019,(Cache),(6),((IP8)*1.))
  call SaveReal(hashtable019,(Cache),(7),((IQ8)*1.))
  call SaveReal(hashtable019,(Cache),(138),((DistanceBetweenXY(IP8,IQ8,GetUnitX(Target),GetUnitY(Target)))*1.))
  call SaveReal(hashtable019,(Cache),(137),((Atan2(IQ8-GetUnitY(Target),IP8-GetUnitX(Target)))*1.))
  call SaveInteger(hashtable019,(Cache),(5),(IR8))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  set t=null
  set Source=null
  set Target=null
endfunction

function DS_Vacuum takes nothing returns nothing
  local group g=GetAvailableGroup()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local integer Level=GetUnitAbilityLevel(GetTriggerUnit(),'A0QE')
  local real r=175+100*Level
  set tt_unit1=GetTriggerUnit()
  call PlaySoundAtPos(integer009,x,y)
  call DestroyEffect(AddSpecialEffect("war3mapImported\\Star Aura.mdx",x,y))
  call GroupEnumUnitsInRange(g,x,y,r,Condition(function NonImmuneEnemyFilter))
  set IP8=x
  set IQ8=y
  set IR8=Level
  call ForGroup(g,function T7F)
  call KillTrees(x,y,200)
  //call RemoveLocation(l)
  call KillGroup(g)
  //set l=null
  set g=null
endfunction

function DS_Vacuum_OnCast takes nothing returns nothing
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  if IsTerrainPathableFixed(x,y)==false or(IsPointInRegion(RestrictedRegion,((x)*1.),((y)*1.)))then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n03K'))
  endif
  //call RemoveLocation(l)
  //set l=null
endfunction

function TFF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call UnitRemoveAbility(Target,'B07W')
  call UnitRemoveAbility(Target,'Bblo')
  call UnitRemoveAbility(Target,'B062')
  call UnitRemoveAbility(Target,'B065')
  call UnitRemoveAbility(Target,'Bcrs')
  call UnitRemoveAbility(Target,'B016')
  call UnitRemoveAbility(Target,'B05R')
  set t=null
  set Target=null
  return false
endfunction

function DS_Surge takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,GetUnitAbilityLevel(GetTriggerUnit(),'A0R7')*1.5+1.5,false)
  call TriggerAddCondition(t,Condition(function TFF))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(17),(GetSpellTargetUnit()))
  call PlaySoundAtPos(sound019,GetUnitX(GetSpellTargetUnit()),GetUnitY(GetSpellTargetUnit()))
  call DestroyEffect(AddSpecialEffectTarget("effects\\Surge.mdx",GetSpellTargetUnit(),"origin"))
  set t=null
endfunction

function TIF takes boolean RIE returns boolean
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit TJF=(LoadUnitHandle(hashtable019,(Cache),(259)))
  local unit Target=GetTriggerUnit()
  local unit TKF=CreateUnit(GetOwningPlayer(TJF),'e01S',GetUnitX(Target),GetUnitY(Target),0)
  local unit Hero=udg_Hero[GetPlayerId(GetOwningPlayer(TJF))]
  local integer Level=GetUnitAbilityLevel(Hero,'A0QK')
  if Level==0 then
    set Level=GetUnitAbilityLevel(Hero,'A21Q')
  endif
  call SetUnitAbilityLevel(TJF,'A0QL',Level)
  set IS8=GetUnitX(Target)
  set IT8=GetUnitY(Target)
  set IU8=Target
  call SaveUnitHandle(hashtable019,GetHandleId(TJF),'0ILU',Target) //Wall of Replica source info
  if RIE then
    call SetUnitAbilityLevel(TJF,'A0QL',3+Level)
    call IssueTargetOrderById(TJF,852274,Target)
    call DamageTarget(TJF,Target,1,150)
  else
    call IssueTargetOrderById(TJF,852274,Target)
    call DamageTarget(TJF,Target,1,150)
  endif
  call UnitApplyTimedLife(TKF,'BTLF',.5)
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl",GetUnitX(Target),GetUnitY(Target)))
  set TJF=null
  set Target=null
  set TKF=null
  set Hero=null
  return false
endfunction

function TMF takes nothing returns boolean
  local group g
  if IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer((LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(259)))))and(GetUnitTypeId((GetFilterUnit()))=='H00J')==false then
    set g=(LoadGroupHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(257)))
    if IsUnitInGroup(GetFilterUnit(),g)==false then
      call GroupAddUnit(g,GetFilterUnit())
      call TIF(false)
    endif
  endif
  set g=null
  return false
endfunction

function TNF takes nothing returns boolean
  local group g
  if IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer((LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(259)))))and(GetUnitTypeId((GetFilterUnit()))=='H00J')==false then
    set g=(LoadGroupHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(257)))
    if IsUnitInGroup(GetFilterUnit(),g)==false then
      call GroupAddUnit(g,GetFilterUnit())
      call TIF(true)
    endif
  endif
  set g=null
  return false
endfunction

function WallOfReplica_FindSource takes nothing returns nothing
  if GetPlayerId(GetOwningPlayer(GetEnumUnit()))==tt_int1 then
    call GroupAddUnit(DK,GetEnumUnit())
  endif
endfunction

function TOF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  call GroupRemoveUnit((LoadGroupHandle(hashtable019,(Cache),(257))),(LoadUnitHandle(hashtable019,(Cache),(261))))
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl",GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit())))
  call FlushChildHashtable(hashtable019,(Cache))
  call DisableTrigger(t)
  set t=null
  return false
endfunction

function TPF takes nothing returns boolean
  local unit TJF=GetSummoningUnit()
  local unit W39=GetSummonedUnit()
  local integer Cache=GetHandleId(TJF)
  local integer TQF=(LoadInteger(hashtable019,(Cache),(260)))
  local trigger t=CreateTrigger()
  call SetUnitVertexColor(W39,255,255,255,100)
  call TriggerRegisterUnitEvent(t,W39,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function TOF))
  call SaveGroupHandle(hashtable019,(GetHandleId(t)),(257),((LoadGroupHandle(hashtable019,(Cache),(257)))))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(261),(IU8))
  set TQF=TQF+1
  call SaveInteger(hashtable019,(Cache),(260),(TQF))
  call SaveInteger(hashtable019,(Cache),(2800+TQF),(UnitAsInteger_Save(W39)))
  call SaveTriggerHandle(hashtable019,(Cache),(2900+TQF),(t))
  call SetUnitX(W39,IS8)
  call SetUnitY(W39,IT8)
  set TJF=null
  set W39=null
  set t=null
  return false
endfunction

function TRF takes nothing returns nothing
  call RemoveUnit(GetEnumUnit())
endfunction

function TSF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer R2E=GetHandleId(t)
  local trigger TTF=(LoadTriggerHandle(hashtable019,(R2E),(255)))
  local integer Cache2=GetHandleId(TTF)
  local trigger TUF=(LoadTriggerHandle(hashtable019,(Cache2),(256)))
  local group TVF=(LoadGroupHandle(hashtable019,(Cache2),(257)))
  local group TWF=(LoadGroupHandle(hashtable019,(Cache2),(258)))
  local unit TJF=(LoadUnitHandle(hashtable019,(Cache2),(259)))
  local integer TXF=GetHandleId(TJF)
  local integer TQF=(LoadInteger(hashtable019,(TXF),(260)))
  local integer TYF
  local integer i
  local unit u
  call ForGroup(TWF,function TRF)
  set i=1
  loop
    exitwhen i>TQF
    set TYF=(LoadInteger(hashtable019,(TXF),(2800+i)))
    set u=UnitAsInteger_Load(TYF)
    call FlushChildHashtable(hashtable019,(GetHandleId((LoadTriggerHandle(hashtable019,(TXF),(2900+i))))))
    call CleanTrigger((LoadTriggerHandle(hashtable019,(TXF),(2900+i))))
    if IsUnitIllusion(u)then
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl",GetUnitX(u),GetUnitY(u)))
      call RemoveUnit(u)
      call UnitAsInteger_Clear(TYF)
    endif
    set i=i+1
  endloop
  call FlushChildHashtable(hashtable019,(R2E))
  call FlushChildHashtable(hashtable019,(Cache2))
  call FlushChildHashtable(hashtable019,(TXF))
  call RemoveUnit(TJF)
  call KillGroup(TVF)
  call KillGroup(TWF)
  call CleanTrigger(TTF)
  call CleanTrigger(TUF)
  call CleanTrigger(t)
  set t=null
  set TTF=null
  set TUF=null
  set TVF=null
  set TWF=null
  set TJF=null
  set u=null
  return false
endfunction

function DS_WallOfReplica takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real TAF=GetUnitFacing(Hero)-45
  local unit TJF=CreateUnit(GetOwningPlayer(Hero),'h00O',x,y,TAF)
  local unit u
  local real M6E
  local real MLE
  local integer i
  local real offset
  local trigger t=CreateTrigger()
  local group g1=GetAvailableGroup()
  local integer Cache=GetHandleId(t)
  local group g2=GetAvailableGroup()
  local trigger TTF=t
  local integer Level=GetUnitAbilityLevel(Hero,'A0QK')
  local boolean RIE=false
  if Level==0 then
    set RIE=true
    set Level=GetUnitAbilityLevel(Hero,'A21Q')
  endif
  call SetUnitAbilityLevel(TJF,'A0QL',Level)
  call PlaySoundAtPos(sound022,x,y)
  call SaveGroupHandle(hashtable019,(Cache),(257),(g1))
  call SaveGroupHandle(hashtable019,(GetHandleId(TJF)),(257),(g1))
  call SaveGroupHandle(hashtable019,(Cache),(258),(g2))
  call SaveUnitHandle(hashtable019,(Cache),(259),(TJF))
  call SaveInteger(hashtable019,(GetHandleId(TJF)),(260),(0))
  set i=0
  loop
    exitwhen i>39
    set M6E=x+(500-25*i)*Cos((TAF-45)*bj_DEGTORAD)
    set MLE=y+(500-25*i)*Sin((TAF-45)*bj_DEGTORAD)
    set u=CreateUnit(GetOwningPlayer(Hero),'h00P',M6E,MLE,TAF)
    call GroupAddUnit(g2,u)
    call TriggerRegisterUnitInRange(t,u,17,Condition(function ReturnTrue2))
    set i=i+1
  endloop
  if RIE then
    call TriggerAddCondition(t,Condition(function TNF))
  else
    call TriggerAddCondition(t,Condition(function TMF))
  endif
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,TJF,EVENT_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function TPF))
  call SaveTriggerHandle(hashtable019,(Cache),(256),(t))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,15*Level,false)
  call TriggerAddCondition(t,Condition(function TSF))
  call SaveTriggerHandle(hashtable019,(GetHandleId(t)),(255),(TTF))
  //call RemoveLocation(l)
  set Hero=null
  //set l=null
  set u=null
  set t=null
  set TTF=null
  set g1=null
  set g2=null
  set TJF=null
endfunction

function TCF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer T3F=(LoadInteger(hashtable019,(Cache),(29)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    if(LoadBoolean(hashtable019,(Cache),(276)))==false and GetTriggerUnit()==(LoadUnitHandle(hashtable019,(Cache),(2)))then
      call SaveBoolean(hashtable019,(Cache),(276),(true))
      call SetHeroStr((LoadUnitHandle(hashtable019,(Cache),(2))),GetHeroStr((LoadUnitHandle(hashtable019,(Cache),(2))),false)-T3F,true)
    elseif(LoadBoolean(hashtable019,(Cache),(277)))==false and GetTriggerUnit()==(LoadUnitHandle(hashtable019,(Cache),(17)))then
      call SaveBoolean(hashtable019,(Cache),(277),(true))
      call SetHeroStr((LoadUnitHandle(hashtable019,(Cache),(17))),GetHeroStr((LoadUnitHandle(hashtable019,(Cache),(17))),false)+T3F,true)
    endif
  else
    if(LoadBoolean(hashtable019,(Cache),(276)))==false then
      call SaveBoolean(hashtable019,(Cache),(276),(true))
      call SetHeroStr((LoadUnitHandle(hashtable019,(Cache),(2))),GetHeroStr((LoadUnitHandle(hashtable019,(Cache),(2))),false)-T3F,true)
    endif
    if(LoadBoolean(hashtable019,(Cache),(277)))==false then
      call SaveBoolean(hashtable019,(Cache),(277),(true))
      call SetHeroStr((LoadUnitHandle(hashtable019,(Cache),(17))),GetHeroStr((LoadUnitHandle(hashtable019,(Cache),(17))),false)+T3F,true)
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  return false
endfunction

function T6F takes nothing returns nothing
  local unit Source=IV8
  local unit Target=GetEnumUnit()
  local integer T3F
  local integer Level=IW8
  local trigger t
  local integer Cache
  if IsUnitType(Target,UNIT_TYPE_HERO) and GetUnitTypeId(Target)!='H00J' then
    set T3F=IMinBJ(GetHeroStr(Target,false)-1,4)
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SetHeroStr(Source,GetHeroStr(Source,false)+T3F,true)
    call SetHeroStr(Target,GetHeroStr(Target,false)-T3F,true)
    call TriggerRegisterTimerEvent(t,40,false)
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function TCF))
    call SaveBoolean(hashtable019,(Cache),(276),(false))
    call SaveBoolean(hashtable019,(Cache),(277),(false))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveInteger(hashtable019,(Cache),(29),(T3F))
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl",Source,"origin"))
  endif
  call DamageTarget(Source,Target,1,40*Level - 20)
  set Source=null
  set Target=null
  set t=null
endfunction

function Undying_Decay takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local group g=GetAvailableGroup()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A15S')
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'h07J',x,y,0)
  call DestroyEffect(AddSpecialEffect("effects\\DecayGreen_Groundonly_1.mdx",x,y))
  //call RemoveLocation(l)
  if IsUnitType(Source,UNIT_TYPE_HERO)==false then
    set Source=udg_Hero[GetPlayerId(GetOwningPlayer(Source))]
  endif
  set tt_unit1=Source
  set IV8=Source
  
  set IW8=Level
  call GroupEnumUnitsInRange(g,x,y,350,Condition(function NonImmuneEnemyFilter))
  call ForGroup(g,function T6F)
  call KillGroup(g)
  call KillUnit(Caster)
  set Source=null
  //set l=null
  set g=null
  set t=null
  set Caster=null
endfunction

function T0F takes nothing returns nothing
  if IA8<=IB8 then
    set IA8=IA8+1
    call GroupAddUnit(IX8,GetEnumUnit())
  endif
endfunction

function T5F takes unit Source,unit Target returns nothing
  call ZO8("SPLK",GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target),.1,.6,.44,.9,.6)
endfunction

function T2F takes nothing returns nothing
  call SetUnitState(IZ8,UNIT_STATE_LIFE,GetUnitState(IZ8,UNIT_STATE_LIFE)+25)
  if GetUnitTypeId(GetEnumUnit())!='n0F5' then
    call B18(GetEnumUnit(),25)
  endif
  call T5F(GetEnumUnit(),IZ8)
endfunction

function U4F takes nothing returns nothing
  call DamageTarget(IY8,IZ8,1,25)
  if GetUnitTypeId(GetEnumUnit())!='n0F5' then
    call B18(GetEnumUnit(),25)
  endif
  call T5F(GetEnumUnit(),IZ8)
endfunction

function U7F takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local group g=GetAvailableGroup()
  local integer U8F=GetUnitAbilityLevel(Hero,'A0R5')*5
  set IX8=GetAvailableGroup()
  set IA8=0
  set IB8=U8F
  set tt_unit1=Hero
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),1000,Condition(function DK9))
  call GroupRemoveUnit(g,Hero)
  call GroupRemoveUnit(g,GetSpellTargetUnit())
  call ForGroup(g,function T0F)
  call KillGroup(g)
  set g=IX8
  set IZ8=GetSpellTargetUnit()
  set IY8=Hero
  if IsUnitAlly(IZ8,GetOwningPlayer(Hero))then
    call ForGroup(g,function T2F)
  else
    call ForGroup(g,function U4F)
  endif
  call KillGroup(g)
  set Hero=null
  set g=null
endfunction

function Undying_SoulRip takes nothing returns nothing
  if (IsUnitType(GetSpellTargetUnit(),UNIT_TYPE_STRUCTURE)==false or GetOwningPlayer(GetSpellTargetUnit())==GetOwningPlayer(GetTriggerUnit()))then
    call U7F()
  endif
endfunction

function UDF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local unit UEF=(LoadUnitHandle(hashtable019,(Cache),(269)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if GetTriggerUnit()==Target then
      call KillUnit(UEF)
    endif
  elseif GameEnded then
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call PauseUnit(UEF,true)
  elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_POINT_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_TARGET_ORDER then
    call DisableTrigger(t)
    call IssueTargetOrderById(UEF,851983,Target)
    call EnableTrigger(t)
  elseif (GetWidgetLife(Target)<(100*I38)or GetWidgetLife(Target)/GetUnitState(Target,UNIT_STATE_MAX_LIFE) < I38*0.05)and GetUnitAbilityLevel(UEF,'B0AN')==0 then
    call IssueTargetOrderById(I68[GetPlayerId(GetOwningPlayer(UEF))],852101,UEF)
  elseif IsUnitVisibleLoD(Target,GetOwningPlayer(UEF))==false then
    if(LoadBoolean(hashtable019,(Cache),(270))) then
      if(LoadBoolean(hashtable019,(Cache),(271))) then
        if(LoadBoolean(hashtable019,(Cache),(272))) then
          call FlushChildHashtable(hashtable019,(Cache))
          call CleanTrigger(t)
          call KillUnit(UEF)
        else
          call SaveBoolean(hashtable019,(Cache),(272),(true))
        endif
      else
        call SaveBoolean(hashtable019,(Cache),(271),(true))
      endif
    else
      call SaveBoolean(hashtable019,(Cache),(270),(true))
    endif
  else
    call SaveBoolean(hashtable019,(Cache),(270),(false))
    call SaveBoolean(hashtable019,(Cache),(271),(false))
    call SaveBoolean(hashtable019,(Cache),(272),(false))
  endif
  set t=null
  set Target=null
  set UEF=null
  return false
endfunction

function UFF takes nothing returns boolean
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=GetEnumUnit()
  local unit UEF=CreateUnit(IC8,'n0F5',GetUnitX(Target),GetUnitY(Target),0)
  call IssueTargetOrderById(UEF,851983,Target)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,UEF,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,UEF,EVENT_UNIT_ISSUED_ORDER)
  call TriggerRegisterUnitEvent(t,UEF,EVENT_UNIT_ISSUED_POINT_ORDER)
  call TriggerRegisterUnitEvent(t,UEF,EVENT_UNIT_ISSUED_TARGET_ORDER)
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function UDF))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveUnitHandle(hashtable019,(Cache),(269),(UEF))
  call SaveInteger(hashtable019,(Cache),(5),(I38))
  set t=null
  set Target=null
  set UEF=null
  return false
endfunction

function UGF takes nothing returns boolean
  if GetUnitTypeId(GetFilterUnit())=='n0F5' and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>1 then
    call KillUnit(GetFilterUnit())
  endif
  return false
endfunction

function UHF takes player p returns nothing
  local group g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,p,Condition(function UGF))
  call KillGroup(g)
  set g=null
endfunction

function UIF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit UJF=(LoadUnitHandle(hashtable019,(Cache),(266)))
  local unit UKF=(LoadUnitHandle(hashtable019,(Cache),(267)))
  local unit UMF=(LoadUnitHandle(hashtable019,(Cache),(268)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local group g
  local player AXD
  if IsSentinel(GetOwningPlayer(Source))then
    set AXD=Scourges[0]
  else
    set AXD=Sentinels[0]
  endif
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    if(LoadBoolean(hashtable019,(Cache),(265)))then
      call TimedReveal(AXD,.4,GetUnitX(Source),GetUnitY(Source),600)
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call ShowUnit(Source,false)
    call RemoveUnit(UJF)
    call RemoveUnit(UKF)
    call RemoveUnit(UMF)
    call UHF(GetOwningPlayer(Source))
  else
    if IsUnitVisibleLoD(Source,AXD)then
      call SaveBoolean(hashtable019,(Cache),(265),(true))
    endif
    set g=GetAvailableGroup()
    set tt_unit1=Source
    set IC8=GetOwningPlayer(Source)
    set I38=Level
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),25+200+200*Level,Condition(function LT8))
    if GameEnded==false then
      call ForGroup(g,function UFF)
    endif
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Source=null
  set UJF=null
  set UKF=null
  set UMF=null
  set AXD=null
  return false
endfunction

function Undying_TombStone takes nothing returns nothing
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local unit Source
  local real M6E
  local real MLE
  local real UOF
  local unit UJF
  local unit UKF
  local unit UMF
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(GetTriggerUnit(),'A15V')
  local integer id
  local real a
  if Level==1 then
    set Source=CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0FJ',x,y,0)
  elseif Level==2 then
    set Source=CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0FI',x,y,0)
  elseif Level==3 then
    set Source=CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0F6',x,y,0)
  else
    set Source=CreateUnit(GetOwningPlayer(GetTriggerUnit()),'n0FH',x,y,0)
  endif
  call PlaySoundAtPos(sound043,x,y)
  set id=GetPlayerId(GetOwningPlayer(Source))
  if I68[id]==null then
    set I68[id]=CreateUnit(GetOwningPlayer(Source),'e01V',x,y,0)
    call UnitAddAbility2(I68[id],'A176')
  endif
  call SetUnitPosition(Source,SafeX50(x),SafeY50(y))
  call UnitApplyTimedLife(Source,'BTLF',10+5*Level)
  call KillTrees(x,y,300)
  set M6E=x+200*Cos(0*bj_DEGTORAD)
  set MLE=y+200*Sin(0*bj_DEGTORAD)
  set UOF=AngleBetweenXY(M6E,MLE,x,y)
  set UJF=CreateUnit(GetOwningPlayer(Source),'h07H',M6E,MLE,UOF)
  call SetUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  call QueueUnitAnimation(UJF,"Stand Work Gold")
  set M6E=x+200*Cos(120*bj_DEGTORAD)
  set MLE=y+200*Sin(120*bj_DEGTORAD)
  set UOF=AngleBetweenXY(M6E,MLE,x,y)
  set UKF=CreateUnit(GetOwningPlayer(Source),'h07H',M6E,MLE,UOF)
  call SetUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  call QueueUnitAnimation(UKF,"Stand Work Gold")
  set M6E=x+200*Cos(240*bj_DEGTORAD)
  set MLE=y+200*Sin(240*bj_DEGTORAD)
  set UOF=AngleBetweenXY(M6E,MLE,x,y)
  set UMF=CreateUnit(GetOwningPlayer(Source),'h07H',M6E,MLE,UOF)
  call SetUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call QueueUnitAnimation(UMF,"Stand Work Gold")
  call SetUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call QueueUnitAnimation(Source,"Stand Work")
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,3,true)
  call TriggerAddCondition(t,Condition(function UIF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(266),(UJF))
  call SaveUnitHandle(hashtable019,(Cache),(267),(UKF))
  call SaveUnitHandle(hashtable019,(Cache),(268),(UMF))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveBoolean(hashtable019,(Cache),(265),(false))
  call TriggerEvaluate(t)
  set Source=null
  set UJF=null
  set UKF=null
  set UMF=null
  set t=null
endfunction

function UQF takes unit whichUnit returns boolean
  return(FindItemOfType(whichUnit,Item_Real[indexid_AghanimZombie])!=null)
endfunction

function FleshGolem_ValidCorpse takes nothing returns boolean
  if GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit()) then
    set IL8=IL8+1
  endif
  return false
endfunction

function URF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=IMaxIF(GetUnitAbilityLevel(Source,'A15J'),GetUnitAbilityLevel(Source,'QM03'))
  //call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A15K',false)
  //call SetUnitAbilityLevel(Source,'A15K',Level)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function USF takes nothing returns nothing
  if IsUnitType(tt_unit1,UNIT_TYPE_HERO) then
    if UQF(tt_unit2)then
      call SetUnitState(tt_unit2,UNIT_STATE_LIFE,GetUnitState(tt_unit2,UNIT_STATE_LIFE)+GetUnitState(tt_unit2,UNIT_STATE_MAX_LIFE)*.1)
    else
      call SetUnitState(tt_unit2,UNIT_STATE_LIFE,GetUnitState(tt_unit2,UNIT_STATE_LIFE)+GetUnitState(tt_unit2,UNIT_STATE_MAX_LIFE)*.06)
    endif
  else
    if UQF(tt_unit2)then
      call SetUnitState(tt_unit2,UNIT_STATE_LIFE,GetUnitState(tt_unit2,UNIT_STATE_LIFE)+GetUnitState(tt_unit2,UNIT_STATE_MAX_LIFE)*.03)
    else
      call SetUnitState(tt_unit2,UNIT_STATE_LIFE,GetUnitState(tt_unit2,UNIT_STATE_LIFE)+GetUnitState(tt_unit2,UNIT_STATE_MAX_LIFE)*.02)
    endif
  endif
endfunction


function Dirge_Golem_Fix_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  
  call SaveBoolean(MHT,LoadInteger(MHT,GetHandleId(t),0),'QM03',false)
  
  call Timer_End(t)
  set t = null
endfunction

function Dirge_Golem_Fix_Start takes unit u returns nothing
  local timer t = Timer_Get()
  local integer info = GetHandleId(u)
  //call UnitRemoveAbility(u,'A15K')
  //prevents back-transformation from activating flesh golem again :3
  call SaveBoolean(MHT,info,'QM03',true)
  
  call SaveInteger(MHT,GetHandleId(t),0,info)
  call TimerStart(t,.25,false,function Dirge_Golem_Fix_End)
  
  set t = null
endfunction

function UTF takes nothing returns boolean
  local trigger t2=GetTriggeringTrigger()
  local integer Cache2=GetHandleId(t2)
  local trigger t1=(LoadTriggerHandle(hashtable019,(Cache2),(274)))
  local integer R2E=GetHandleId(t1)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache2),(2)))
  local unit Target
  local real d
  local real a
  local boolean UUF=(LoadBoolean(hashtable019,(Cache2),(273)))
  if(GetTriggerEventId()==EVENT_UNIT_DEATH and GetTriggerUnit()==Source)or(GetTriggerEventId()!=EVENT_UNIT_DAMAGED and GetTriggerEventId()!=EVENT_UNIT_DEATH)then
    call Dirge_Golem_Fix_Start(Source)
    
    call FlushChildHashtable(hashtable019,(R2E))
    call FlushChildHashtable(hashtable019,(Cache2))
    call CleanTrigger(t1)
    call CleanTrigger(t2)
  elseif GetTriggerEventId()==EVENT_UNIT_DEATH then
    if IsUnitIllusion(GetDyingUnit())==false then
      call AddProjectile(GetDyingUnit(),Source,'h07Y',"USF",600,false)
    endif
  elseif UUF==false and IsRealDamage then
    set Target=GetTriggerUnit()
    set d=DistanceBetweenUnits(Source,Target)
    if d<775 and GetEventDamage()>4 then
      if UQF(Source)then
        set a=20+5*I18
      else
        set a=15+5*I18
      endif
      if d>200 then
        set a=a-15*((d-150)/(775-150))
      endif
      call SaveBoolean(hashtable019,(Cache2),(273),(true))
      call DamageTarget(GetEventDamageSource(),GetTriggerUnit(),3,GetEventDamage()*a/ 100)
      call SaveBoolean(hashtable019,(Cache2),(273),(false))
    endif
  endif
  set t2=null
  set t1=null
  set Source=null
  set Target=null
  return false
endfunction

function UVF takes nothing returns boolean
  local trigger t1=GetTriggeringTrigger()
  local integer R2E=GetHandleId(t1)
  local trigger t2=(LoadTriggerHandle(hashtable019,(R2E),(275)))
  local integer Cache2=GetHandleId(t2)
  local unit Target=GetTriggerUnit()
  local unit Source=(LoadUnitHandle(hashtable019,(R2E),(2)))
  if IsUnitEnemy(Source,GetOwningPlayer(Target)) and IsUnitType(Target,UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(Target,'A04R')==0 then
    if(LoadBoolean(hashtable019,(Cache2),(GetHandleId(Target))))==false then
      call TriggerRegisterUnitEvent(t2,Target,EVENT_UNIT_DAMAGED)
      call TriggerRegisterUnitEvent(t2,Target,EVENT_UNIT_DEATH)
      call SaveBoolean(hashtable019,(Cache2),(GetHandleId(Target)),(true))
    endif
  endif
  set t1=null
  set t2=null
  set Target=null
  set Source=null
  return false
endfunction

function UWF takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t1=CreateTrigger()
  local integer R2E=GetHandleId(t1)
  local trigger t2=CreateTrigger()
  local integer Cache2=GetHandleId(t2)
  local trigger t3=CreateTrigger()
  local integer TXF=GetHandleId(t3)
  local integer Level=GetUnitAbilityLevel(Source,'QM03')
  set I18=Level
  //call UnitAddAbility2(Source,'A15K')
  call TriggerRegisterUnitInRange(t1,Source,750,Condition(function ReturnTrue2))
  call TriggerAddCondition(t1,Condition(function UVF))
  call SaveTriggerHandle(hashtable019,(R2E),(275),(t2))
  call SaveUnitHandle(hashtable019,(R2E),(2),(Source))
  call TriggerRegisterTimerEvent(t2,30,false)
  call TriggerRegisterUnitEvent(t2,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t2,Condition(function UTF))
  call SaveTriggerHandle(hashtable019,(Cache2),(274),(t1))
  call SaveUnitHandle(hashtable019,(Cache2),(2),(Source))
  call SaveBoolean(hashtable019,(Cache2),(273),(false))
  call TriggerRegisterTimerEvent(t3,.01,false)
  call TriggerAddCondition(t3,Condition(function URF))
  call SaveUnitHandle(hashtable019,(TXF),(2),(Source))
  set Source=null
  set t1=null
  set t2=null
  set t3=null
endfunction

function Undying_FleshGolem takes nothing returns nothing
  if GetUnitTypeId(GetTriggerUnit())!='H07I' then
    call UWF()
  endif
endfunction

function R69 takes nothing returns nothing
  //call PreloadAbility('A15K')
endfunction

function UYF takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),I58)==false and IsMagicImmune(GetEnumUnit())==false then
    call GroupAddUnit(I58,GetEnumUnit())
    call SetPlayerAbilityAvailable2(GetOwningPlayer(GetEnumUnit()),I28,false)
    call CN8(GetEnumUnit(),I28,1,3,'B05Q')
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\SpellShieldAmulet\\SpellShieldCaster.mdl",GetEnumUnit(),"overhead"))
  endif
endfunction

function UZF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real x2=(LoadReal(hashtable019,(Cache),(66)))
  local real y2=(LoadReal(hashtable019,(Cache),(67)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local integer Count=GetTriggerEvalCount(t)
  local real x=GetUnitX(Hero)
  local real y=GetUnitY(Hero)
  local real LastX=(LoadReal(hashtable019,(Cache),(23)))
  local real LastY=(LoadReal(hashtable019,(Cache),(24)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local group g=GetAvailableGroup()
  local group AlreadyHit=(LoadGroupHandle(hashtable019,(Cache),(187)))
  local integer Level=GetUnitAbilityLevel(Hero,'A0LK')
  local string s=LoadStr(HeroStats,GetUnitTypeId(Hero),COLOR)
  local integer r
  local integer gr
  local integer b
  if DistanceBetweenXY(x,y,x2,y2)<=55 then
    set x=x2
    set y=y2
  else
    set x=LastX+65*Cos(a*bj_DEGTORAD)
    set y=LastY+65*Sin(a*bj_DEGTORAD)
  endif
  if Level==1 then
    set I28='A29A'
  elseif Level==2 then
    set I28='A299'
  elseif Level==3 then
    set I28='A29B'
  elseif Level==4 then
    set I28='A298'
  endif
  set tt_unit1=Hero
  set I58=AlreadyHit
  call GroupEnumUnitsInRange(g,x,y,325,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function UYF)
  call KillGroup(g)
  call SaveReal(hashtable019,(Cache),(23),((x)*1.))
  call SaveReal(hashtable019,(Cache),(24),((y)*1.))
  call SetUnitPosition(Hero,x,y)
  if(x==x2 and y==y2)or Count>40 then
    if IsUnitType(Caster,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(Caster),99,true)
    endif
    call SetUnitX(Caster,SafeX50(x))
    call SetUnitY(Caster,SafeY50(y))
    call IssueImmediateOrderById(Caster,852096)
    call KillGroup(AlreadyHit)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call SetUnitAnimation(Hero,"stand")
    call SetUnitPathing(Hero,true)
    call SetUnitInvulnerable(Hero,false)
    set r=255
    set gr=255
    set b=255
    if(s!="" and s!=null) then
      set r=S2I(SubString(s,0,3))
      set gr=S2I(SubString(s,3,6))
      set b=S2I(SubString(s,6,9))
    endif
    call SetUnitVertexColor(Hero,r,gr,b,255)
    call SaveInteger(hashtable019,(GetHandleId((Hero))),((4261)),(2))
  endif
  set t=null
  set Hero=null
  set Caster=null
  set AlreadyHit=null
  set g=null
  return false
endfunction

function Void_Timewalk takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  //local location l
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real x1=GetUnitX(Hero)
  local real y1=GetUnitY(Hero)
  local real x2
  local real y2
  local real a
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',x1,y1,0)
  if GetSpellTargetUnit()==null then
    set x2=GetSpellTargetX()
    set y2=GetSpellTargetY()
  else
    set x2=GetUnitX(GetSpellTargetUnit())
    set y2=GetUnitY(GetSpellTargetUnit())
  endif
  set a=AngleBetweenXY(x1,y1,x2,y2)
  //call RemoveLocation(l)
  call SetUnitAnimationByIndex(Hero,0)
  call SetUnitPathing(Hero,false)
  call SetUnitInvulnerable(Hero,true)
  call SetUnitVertexColor(Hero,0,0,0,255)
  call SaveInteger(hashtable019,(GetHandleId((Hero))),((4261)),(1))
  call SaveReal(hashtable019,(Cache),(66),((x2)*1.))
  call SaveReal(hashtable019,(Cache),(67),((y2)*1.))
  call SaveReal(hashtable019,(Cache),(23),((x1)*1.))
  call SaveReal(hashtable019,(Cache),(24),((y1)*1.))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveGroupHandle(hashtable019,(Cache),(187),(GetAvailableGroup()))
  call UnitAddAbility2(Caster,'A0LA')
  call SetUnitAbilityLevel(Caster,'A0LA',GetUnitAbilityLevel(Hero,'A0LK'))
  call TriggerRegisterTimerEvent(t,.025,true)
  call TriggerAddCondition(t,Condition(function UZF))
  set Hero=null
  //set l=null
  set t=null
  set Caster=null
endfunction

function Void_Backtrack_Check takes nothing returns boolean
  return (GetLearnedSkill()=='QP22' or GetLearnedSkill()=='A0CZ') and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function Void_Backtrack_Act takes nothing returns nothing
  local unit void=GetTriggerUnit()
  local real Damage=GetEventDamage()
  if(Damage>0)and GetUnitState(void,UNIT_STATE_LIFE)>1 and IsRealDamage then
    if PRD_Get(void,'A0CZ',5+5*IMaxIF(GetUnitAbilityLevel(void,'A0CZ'),GetUnitAbilityLevel(void,'QP22'))) then
      call SetUnitState(void,UNIT_STATE_LIFE,GetUnitState(void,UNIT_STATE_LIFE)+Damage)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl",void,"hand,left"))
    endif
  endif
  set void=null
endfunction

function Void_Backtrack_Init takes nothing returns nothing
  local trigger t
  if IMaxIF(GetUnitAbilityLevel(GetTriggerUnit(),'A0CZ'),GetUnitAbilityLevel(GetTriggerUnit(),'QP22'))==1 then
    set t=CreateTrigger()
    call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
    call TriggerAddAction(t,function Void_Backtrack_Act)
    set t=null
  endif
endfunction

function Void_Backtrack_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Void_Backtrack_Check))
  call TriggerAddAction(t,function Void_Backtrack_Init)
  set t=null
endfunction

function U1F takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer Cache=GetHandleId(t)
  local unit U0F=(LoadUnitHandle(hashtable019,(Cache),(19)))
  call PauseTimer(t)
  call FlushChildHashtable(hashtable019,(Cache))
  call DestroyTimer(t)
  set t=null
  set U0F=null
endfunction

function U5F takes unit whichUnit returns boolean
  local integer ID=GetUnitTypeId(whichUnit)
  return ID=='osp4' or ID=='o008' or ID=='o009' or ID=='ebal' or ID=='e026' or ID=='umtw' or ID=='u00R'
endfunction

function U2F takes nothing returns boolean
  return GetOwningPlayer(GetFilterUnit())!=GetOwningPlayer(TmpUnit376)and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 or U5F(GetFilterUnit()))
endfunction

function V4F takes nothing returns nothing
  local unit u = GetEnumUnit()
  
  //	if GetUnitAbilityLevel(u,'A0J1') + GetUnitAbilityLevel(u,'A1D7') > 0 then
  //		set u = null
  //		return
  //	endif
  
  call PauseUnit(u,true)
  call SetUnitTimeScale(u,0)
  call UnitRemoveAbility(u,'BUsl')
  call UnitRemoveAbility(u,'BUsp')
  call UnitRemoveAbility(u,'BUst')
  call SaveBoolean(hashtable019,GetHandleId(u),4306,true)
  
  set u = null
endfunction

function V7F takes nothing returns nothing
  local unit u = GetEnumUnit()
  
  call SaveBoolean(hashtable019,GetHandleId(u),4306,false) //a boolean! :D
  call PauseUnit(u,false)
  call SetUnitTimeScale(u,1)
  
  set u = null
endfunction

function V8F takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer Cache=GetHandleId(t)
  local unit U0F=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local group V9F=(LoadGroupHandle(hashtable019,(Cache),(220)))
  local integer unit060=(LoadInteger(hashtable019,(Cache),(28)))
  local real TargetX=GetUnitX(U0F)
  local real TargetY=GetUnitY(U0F)
  local boolexpr VH9=Condition(function U2F)
  local group V7E=GetAvailableGroup()
  local integer DP9=35+Level*5
  if GetUnitAbilityLevel(Hero,'A1D7')>0 then
    set DP9=30+Level*10
  endif
  call ForGroup(V9F,function V7F)
  set TmpUnit376=Hero
  call GroupEnumUnitsInRange(V7E,TargetX,TargetY,475,VH9)
  call GroupClear(V9F)
  call GroupAddGroup(V7E,V9F)
  call ForGroup(V7E,function V4F)
  call KillGroup(V7E)
  set unit060=unit060+1
  call SaveInteger(hashtable019,(Cache),(28),(unit060))
  if DistanceBetweenUnits(Hero,U0F)>470 then
    call UnitRemoveAbility(Hero,'A33W')
    call BS_RemoveSpeedCap(Hero,0,false)
  else
    call UnitAddAbility2(Hero,'A33W')
    call BS_RemoveSpeedCap(Hero,1,true)
  endif
  if unit060>DP9 then
    if GameEnded==false then
      call ForGroup(V9F,function V7F)
    endif
    call UnitRemoveAbility(Hero,'A33W')
    call BS_RemoveSpeedCap(Hero,0,false)
    call RemoveUnit(U0F)
    call KillGroup(V9F)
    call PauseTimer(t)
    call FlushChildHashtable(hashtable019,(Cache))
    call DestroyTimer(t)
  endif
  set t=null
  set U0F=null
  set Hero=null
  set V9F=null
  set V7E=null
  set VH9=null
endfunction

function Void_Chronosphere takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Hero,('A0J1'))
  //local location Target=GetSpellTargetLoc()
  local real TargetX=GetSpellTargetX()
  local real TargetY=GetSpellTargetY()
  local unit U0F=CreateUnit(GetOwningPlayer(Hero),('u00L'),TargetX,TargetY,0)
  local timer t=CreateTimer()
  local integer Cache=GetHandleId(t)
  local group V9F=GetAvailableGroup()
  if Level==0 then
    set Level=GetUnitAbilityLevel(Hero,'A1D7')
  endif
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(19),(U0F))
  call TimerStart(t,.8,false,function U1F)
  set t=CreateTimer()
  set Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(19),(U0F))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveGroupHandle(hashtable019,(Cache),(220),(V9F))
  call SaveInteger(hashtable019,(Cache),(28),(0))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call TimerStart(t,.1,true,function V8F)
  //call RemoveLocation(Target)
  //set Target=null
  set Hero=null
  set U0F=null
  set t =null
  set V9F=null
endfunction










function Void_Bash_Effect takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local unit u = LoadUnitHandle(MHT,GetHandleId(t),0)
  
  if GetUnitAbilityLevel(u,'B0C2')==0 then
    call RemoveSavedHandle(MHT,GetHandleId(u),'A081')
    call Timer_End(t)
    set t = null
    set u = null
    return
  endif
  
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl",u,"chest"))
  
  set t = null
  set u = null
endfunction

function Void_Bash_Start takes unit u, integer info returns nothing
  local timer t = Timer_Get()
  
  call SaveTimerHandle(MHT,info,'A081',t)
  call SaveUnitHandle(MHT,GetHandleId(t),0,u)
  call TimerStart(t,0.1,true,function Void_Bash_Effect)
  
  set t = null
endfunction

function Void_Bash_Condition takes unit u, unit t returns nothing
  local integer info = GetHandleId(t)
  local integer level = GetUnitAbilityLevel(u,'P275')//A081
  
  if level>0 and GetUnitAbilityLevel(t,'B0C2')==1 and HaveSavedHandle(MHT,info,'A081')==false then
    call Void_Bash_Start(t,info)
    
    if LoadBoolean(hashtable019,info,4306)then
      call DisableTrigger(GAME_TRIGGER)
      call DamageTarget(u,t,1,level*10 + 30)
      call EnableTrigger(GAME_TRIGGER)
    endif
  endif
endfunction

function Void_Bash_Detect takes unit u, unit t returns nothing
  local integer info = GetHandleId(t)
  
  if GetUnitAbilityLevel(u,'P275')>0 and IsUnitEnemy(t,GetOwningPlayer(u)) and LoadBoolean(MHT,info,1)==false then
    call SaveBoolean(MHT,info,1,true)
    call TriggerRegisterUnitEvent(GAME_TRIGGER,t,EVENT_UNIT_DAMAGED)
  endif
endfunction




function VVF takes nothing returns nothing
  local real VWF=RMaxIF(RMinIF(GetUnitState(GetEnumUnit(),UNIT_STATE_MANA),JF8),0)
  local real VXF=VWF*.5
  if IsMagicImmune(GetEnumUnit())==false and VWF>0 and IsUnitCycloned(GetEnumUnit())==false then
    if GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)>(VXF+.5) then
      call SetUnitState(GetEnumUnit(),UNIT_STATE_LIFE,GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)-VXF)
    else
      call SetUnitState(GetEnumUnit(),UNIT_STATE_LIFE,1)
      call DamageTarget(JG8,GetEnumUnit(),1,VXF)
    endif
    call SetUnitState(GetEnumUnit(),UNIT_STATE_MANA,GetUnitState(GetEnumUnit(),UNIT_STATE_MANA)-VWF)
  endif
endfunction

function VYF takes unit Source,integer VZF,integer VAF returns nothing
  local group g=GetAvailableGroup()
  set JG8=Source
  set tt_unit1=Source
  set JF8=VZF*50+50
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),700,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function VVF)
  call KillGroup(g)
  set g=null
endfunction

function VBF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=GetTriggerEvalCount(t)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit VCF
  local real V3F=4-.28*(LoadInteger(hashtable019,(Cache),(3000)))
  local real V6F=1+(4-1)*Count/(V3F/ .05)
  call SetUnitScale(Caster,V6F,V6F,V6F)
  if Count>(V3F/ .05)then
    call VYF(Caster,(LoadInteger(hashtable019,(Cache),(3000))),(LoadInteger(hashtable019,(Cache),(3002))))
    set VCF=CreateUnit(GetOwningPlayer(Caster),'e01O',GetUnitX(Caster),GetUnitY(Caster),0)
    call SetUnitTimeScale(VCF,.3)
    call RemoveUnit(Caster)
    call KillUnit(VCF)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Caster=null
  set VCF=null
  return false
endfunction

function VLF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  //local location l=GetSpellTargetLoc()
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e01M',x,y,a*bj_RADTODEG)
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function VBF))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveInteger(hashtable019,(Cache),(3000),((LoadInteger(hashtable019,(GetHandleId(Source)),(3000)))))
  call SaveInteger(hashtable019,(Cache),(3001),((LoadInteger(hashtable019,(GetHandleId(Source)),(3001)))))
  call SaveInteger(hashtable019,(Cache),(3002),((LoadInteger(hashtable019,(GetHandleId(Source)),(3002)))))
  //call RemoveLocation(l)
  set t=null
  //set l=null
  set Source=null
  set Caster=null
endfunction

function V1F takes nothing returns boolean
  if GetSpellAbilityId()=='A0VS' then
    call VLF()
  endif
  return false
endfunction

function V0F takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function V1F))
  //set t=null
endfunction

function V5F takes unit Source,unit Target,integer VZF,integer V2F returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local unit W4F=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local real W7F=.5+.3*V2F
  if V2F==7 then
    set W7F=2.5
  endif
  call UnitAddAbility2(Caster,'A0XK')
  call SetUnitAbilityLevel(Caster,'A0XK',V2F)
  call IssueTargetOrderById(Caster,852144,Target)
  call DamageTarget_Delayed(W4F,Target,1,70.+(VZF+V2F)*20.,W7F)
  set Caster=null
  set W4F=null
endfunction

function W8F takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),DK)==false then
    call GroupAddUnit(DK,GetEnumUnit())
    call V5F(tt_unit1,GetEnumUnit(),tt_int1,MJ)
  endif
endfunction

function W9F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local real x2=(LoadReal(hashtable019,(Cache),(66)))
  local real y2=(LoadReal(hashtable019,(Cache),(67)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local integer VZF=(LoadInteger(hashtable019,(Cache),(3000)))
  local integer V2F=(LoadInteger(hashtable019,(Cache),(3001)))
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  local real x=GetUnitX(Caster)+25*Cos(a)
  local real y=GetUnitY(Caster)+25*Sin(a)
  local group WDF=GetAvailableGroup()
  local real YR8=DistanceBetweenXY(x,y,x2,y2)
  if YR8<=30 then
    set x=x2
    set y=y2
  endif
  call SetUnitX(Caster,SafeX50(x))
  call SetUnitY(Caster,SafeX50(y))
  set tt_unit1=Caster
  set DK=g
  set tt_int1=VZF
  set MJ=V2F
  call GroupEnumUnitsInRange(WDF,x,y,200,Condition(function DefaultEnemyFilter))
  call ForGroup(WDF,function W8F)
  call KillGroup(WDF)
  if YR8<=30 or GetTriggerEvalCount(t)>125 then
    call KillGroup(g)
    call KillUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Caster=null
  set g=null
  set WDF=null
  return false
endfunction

function WEF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  //local location l=GetSpellTargetLoc()
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local unit Caster
  set x=GetUnitX(Source)
  set y=GetUnitY(Source)
  set Caster=CreateUnit(GetOwningPlayer(Source),'n01U',x,y,a*bj_RADTODEG)
  call TriggerRegisterTimerEvent(t,.025,true)
  call TriggerAddCondition(t,Condition(function W9F))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveReal(hashtable019,(Cache),(66),((x+(400+400.*(LoadInteger(hashtable019,(GetHandleId((Source))),(3000))))*Cos(a))*1.))
  call SaveReal(hashtable019,(Cache),(67),((y+(400+400.*(LoadInteger(hashtable019,(GetHandleId((Source))),(3000))))*Sin(a))*1.))
  call SaveInteger(hashtable019,(Cache),(3000),((LoadInteger(hashtable019,(GetHandleId(Source)),(3000)))))
  call SaveInteger(hashtable019,(Cache),(3001),((LoadInteger(hashtable019,(GetHandleId(Source)),(3001)))))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveGroupHandle(hashtable019,(Cache),(22),(GetAvailableGroup()))
  //call RemoveLocation(l)
  set t=null
  //set l=null
  set Source=null
  set Caster=null
endfunction

function WFF takes nothing returns boolean
  if GetSpellAbilityId()=='A0VK' then
    call WEF()
  endif
  return false
endfunction

function WGF takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function WFF))
  call PreloadAbilityDelayed('A0XK',GetRandomReal(1,25))
  //set t=null
endfunction

function WHF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call UnitRemoveAbility(Target,'A0VJ')
  call UnitRemoveAbility(Target,'A109')
  if GetUnitAbilityLevel(Target,'A0VJ')==0 or GetUnitAbilityLevel(Target,'A109')==0 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  return false
endfunction

function WIF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real counter=LoadInteger(hashtable019,Cache,0)
  if GetTriggerEvalCount(t)>counter or GetUnitAbilityLevel(Target,'BNdo')>0 or IsDead(Target) then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call UnitRemoveAbility(Target,'A0VJ')
    call UnitRemoveAbility(Target,'A109')
    if GetUnitAbilityLevel(Target,'A0VJ')>0 or GetUnitAbilityLevel(Target,'A109')>0 then
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
      call TriggerRegisterTimerEvent(t,1,true)
      call TriggerAddCondition(t,Condition(function WHF))
    endif
  endif
  set t=null
  set Target=null
  return false
endfunction

function WJF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer VZF=(LoadInteger(hashtable019,(GetHandleId(Hero)),(3000)))
  local integer VAF=(LoadInteger(hashtable019,(GetHandleId(Hero)),(3002)))
  call UnitAddAbility2(Target,'A0VJ')
  call SetUnitAbilityLevel(Target,'A0VJ',VZF)
  call UnitAddAbility2(Target,'A109')
  call SetUnitAbilityLevel(Target,'A109',VAF)
  call TriggerRegisterTimerEvent(t,0.5,false)
  call SaveInteger(hashtable019,Cache,0,18)
  call TriggerAddCondition(t,Condition(function WIF))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIsp\\SpeedTarget.mdl",Target,"origin")))
  set t=null
  set Hero=null
  set Target=null
endfunction

function WKF takes nothing returns boolean
  if GetSpellAbilityId()=='A0VQ' then
    call WJF()
  endif
  return false
endfunction

function WMF takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function WKF))
  call PreloadAbilityDelayed('A0VJ',GetRandomReal(1,25))
  call PreloadAbilityDelayed('A109',GetRandomReal(1,25))
  //set t=null
endfunction

function WNF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  if GetUnitAbilityLevel(Hero,'B08X')==0 then
    call KillUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SetUnitAbilityLevel(Caster,'A0VH',(LoadInteger(hashtable019,(GetHandleId(Hero)),(3001))))
    call SetUnitX(Caster,GetUnitX(Hero))
    call SetUnitY(Caster,GetUnitY(Hero))
  endif
  set t=null
  set Caster=null
  set Hero=null
  return false
endfunction

function WOF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e01V',GetUnitX(Hero),GetUnitY(Hero),0)
  call UnitAddAbility2(Caster,'A0VH')
  call SetUnitAbilityLevel(Caster,'A0VH',(LoadInteger(hashtable019,(GetHandleId(Hero)),(3001))))
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function WNF))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  set t=null
  set Hero=null
  set Caster=null
endfunction

function WPF takes nothing returns boolean
  if GetSpellAbilityId()=='A0XL' then
    call WOF()
  endif
  return false
endfunction

function WQF takes unit Hero returns nothing
  if GetUnitAbilityLevel(Hero,'A0XL')>0 then
    call SetUnitAbilityLevel(Hero,'A0XL',(LoadInteger(hashtable019,(GetHandleId(Hero)),(3000))))
  endif
endfunction

function WRF takes nothing returns boolean
  if IsUnitIllusion(GetTriggerUnit())==false then
    call WQF(GetTriggerUnit())
  endif
  return false
endfunction

function WSF takes nothing returns nothing
  local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function WPF))
  //set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function WRF))
  call PreloadAbilityDelayed('A0VH',GetRandomReal(1,25))
  set t=null
endfunction

function WTF takes unit Source,unit Target,integer VZF returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,'A0VT')
  call SetUnitAbilityLevel(Caster,'A0VT',VZF)
  call IssueTargetOrderById(Caster,852585,Target)
  set Caster=null
endfunction

function WUF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real QQE=(LoadReal(hashtable019,(Cache),(193)))
  local integer VZF=(LoadInteger(hashtable019,(Cache),(3000)))
  local integer V2F=(LoadInteger(hashtable019,(Cache),(3001)))
  local integer RHE=V2F*25/ 3
  local real x
  local real y
  local integer Count=GetTriggerEvalCount(t)
  if Count>RHE/ 3 then
    call SaveReal(hashtable019,(Cache),(193),((QQE*.98)*1.))
  endif
  if Count>RHE or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if GetTriggerEventId()!=EVENT_UNIT_DEATH then
      call WTF(Source,Target,VZF)
    endif
  else
    set x=SafeX50(GetUnitX(Target)+QQE*Cos(J2E))
    set y=SafeY50(GetUnitY(Target)+QQE*Sin(J2E))
    call KillTrees(x,y,150)
    if IsUnitType(Target,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(Target),99,true)
    endif
    call SetUnitPosition(Target,x,y)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function WVF takes unit Source,unit Target,integer VZF,integer V2F,integer VAF returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real J2E=Atan2(GetUnitY(Target)-GetUnitY(Source),GetUnitX(Target)-GetUnitX(Source))
  call DamageTarget(Source,Target,1,VAF*40)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveReal(hashtable019,(Cache),(193),((6)*1.))
  call SaveInteger(hashtable019,(Cache),(3000),(VZF))
  call SaveInteger(hashtable019,(Cache),(3001),(V2F))
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function WUF))
  set t=null
endfunction

function WWF takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),DK)==false and IsMagicImmune(GetEnumUnit())==false then
    call GroupAddUnit(DK,GetEnumUnit())
    call WVF(tt_unit1,GetEnumUnit(),tt_int1,MJ,NJ)
  endif
endfunction

function WXF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local real x2=(LoadReal(hashtable019,(Cache),(66)))
  local real y2=(LoadReal(hashtable019,(Cache),(67)))
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  local integer VZF=(LoadInteger(hashtable019,(Cache),(3000)))
  local integer V2F=(LoadInteger(hashtable019,(Cache),(3001)))
  local integer VAF=(LoadInteger(hashtable019,(Cache),(3002)))
  local real x=GetUnitX(Caster)
  local real y=GetUnitY(Caster)
  local group g2
  if DistanceBetweenXY(x,y,x2,y2)<100 then
    set x=x2
    set y=y2
  else
    set x=x+33*Cos(a)
    set y=y+33*Sin(a)
  endif
  if IsUnitType(Caster,UNIT_TYPE_HERO)then
    call SaveBoolean(HeroStats,GetHandleId(Caster),99,true)
  endif
  call SetUnitX(Caster,SafeX50(x))
  call SetUnitY(Caster,SafeY50(y))
  set g2=GetAvailableGroup()
  set tt_unit1=Caster
  set DK=g
  set tt_int1=VZF
  set MJ=V2F
  set NJ=VAF
  call GroupEnumUnitsInRange(g2,x,y,200,Condition(function DefaultEnemyFilter))
  call ForGroup(g2,function WWF)
  call KillGroup(g2)
  if(x==x2 and y==y2)or GetTriggerEvalCount(t)>35 then
    set g2=GetAvailableGroup()
    set tt_unit1=Caster
    set DK=g
    set tt_int1=VZF
    set MJ=V2F
    set NJ=VAF
    call GroupEnumUnitsInRange(g2,x,y,250,Condition(function DefaultEnemyFilter))
    call ForGroup(g2,function WWF)
    call KillGroup(g2)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call KillUnit(Caster)
    call KillGroup(g)
  endif
  set t=null
  set Caster=null
  set g=null
  set g2=null
  return false
endfunction

function WYF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  //local location l=GetSpellTargetLoc()
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'n01X',GetUnitX(Source),GetUnitY(Source),a*bj_RADTODEG)
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function WXF))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveReal(hashtable019,(Cache),(66),((GetUnitX(Source)+1000*Cos(a))*1.))
  call SaveReal(hashtable019,(Cache),(67),((GetUnitY(Source)+1000*Sin(a))*1.))
  call SaveGroupHandle(hashtable019,(Cache),(22),(GetAvailableGroup()))
  call SaveInteger(hashtable019,(Cache),(3000),((LoadInteger(hashtable019,(GetHandleId(Source)),(3000)))))
  call SaveInteger(hashtable019,(Cache),(3001),((LoadInteger(hashtable019,(GetHandleId(Source)),(3001)))))
  call SaveInteger(hashtable019,(Cache),(3002),((LoadInteger(hashtable019,(GetHandleId(Source)),(3002)))))
  //call RemoveLocation(l)
  set t=null
  //set l=null
  set Source=null
  set Caster=null
endfunction

function WZF takes nothing returns boolean
  if GetSpellAbilityId()=='A0VM' then
    call WYF()
  endif
  return false
endfunction

function WAF takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function WZF))
  call PreloadAbilityDelayed('A0VT',GetRandomReal(1,25))
  //set t=null
endfunction

function WBF takes unit Hero returns real
  local integer VAF=(LoadInteger(hashtable019,(GetHandleId(Hero)),(3002)))
  return(80+VAF*35.)/ 2
endfunction

function WCF takes unit Hero returns real
  local integer VZF=(LoadInteger(hashtable019,(GetHandleId(Hero)),(3000)))
  local integer V2F=(LoadInteger(hashtable019,(GetHandleId(Hero)),(3001)))
  local integer VAF=(LoadInteger(hashtable019,(GetHandleId(Hero)),(3002)))
  return 325+VZF*175.
endfunction

function W3F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  local effect FX=(LoadEffectHandle(hashtable019,(Cache),(32)))
  local integer Count=GetTriggerEvalCount(t)
  call DamageTarget(Source,Target,1,Damage)
  if Count==3 then
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call DestroyEffect(FX)
  endif
  set t=null
  set Source=null
  set Target=null
  set FX=null
  return false
endfunction

function W6F takes unit Source,unit Target,real Damage returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveReal(hashtable019,(Cache),(20),((Damage)*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Environment\\SmallBuildingFire\\SmallBuildingFire2.mdl",Target,"chest")))
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function W3F))
  set t=null
endfunction

function WLF takes nothing returns nothing
  call W6F(tt_unit1,GetEnumUnit(),tt_real1/ 5)
  call DamageTarget(tt_unit1,GetEnumUnit(),1,tt_real1)
endfunction

function W1F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local integer Count=GetTriggerEvalCount(t)-26
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real AO8
  local real AP8
  local unit Caster
  local group g
  if Count==1 then
    set Caster=CreateUnit(GetOwningPlayer(Source),'e01L',x,y,a*bj_RADTODEG)
    call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  elseif Count>1 then
    set Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  endif
  if Count>0 then
    set AO8=SafeX50(GetUnitX(Caster)+15*Cos(a))
    set AP8=SafeY50(GetUnitY(Caster)+15*Sin(a))
    call SetUnitX(Caster,AO8)
    call SetUnitY(Caster,AP8)
    if(Count>1 and ModuloInteger(Count,10)==0)or Count==1 then
      set g=GetAvailableGroup()
      set tt_unit1=Source
      set tt_real1=WBF(Source)
      call GroupEnumUnitsInRange(g,AO8,AP8,300,Condition(function DefaultEnemyFilter))
      call ForGroup(g,function WLF)
      call KillGroup(g)
      call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl",AO8,AP8))
    endif
    if Count>WCF(Source)/ 16.6 then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call KillUnit(Caster)
    endif
  endif
  set t=null
  set g=null
  set Caster=null
  set Source=null
  return false
endfunction

function W0F takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  //local location l=GetSpellTargetLoc()
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local unit W5F=CreateUnit(GetOwningPlayer(Source),'e01K',x,y,a*bj_RADTODEG)
  call SetUnitTimeScale(W5F,.58)
  call UnitApplyTimedLife(W5F,'BTLF',1.75)
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function W1F))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  //call RemoveLocation(l)
  set t=null
  //set l=null
  set W5F=null
  set Source=null
endfunction

function W2F takes nothing returns boolean
  if GetSpellAbilityId()=='A0VN' then
    call W0F()
  endif
  return false
endfunction

function X4F takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function W2F))
  //set t=null
endfunction

function X7F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local real DRD=(LoadReal(hashtable019,(GetHandleId(Target)),(3007)))
  if DRD+5<=(TimerGetElapsed(GlobalTimer))then
    call UnitRemoveAbility(Target,'A0VW')
  endif
  call UnitAsInteger_Clear(XK8)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Target=null
  return false
endfunction

function X8F takes unit Target returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Target,'A0VW')
  if Level==0 then
    call UnitAddAbility2(Target,'A0VW')
  endif
  call SetUnitAbilityLevel(Target,'A0VW',Level+1)
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveReal(hashtable019,(GetHandleId(Target)),(3007),(((TimerGetElapsed(GlobalTimer)))*1.))
  call TriggerRegisterTimerEvent(t,5,false)
  call TriggerAddCondition(t,Condition(function X7F))
  set t=null
endfunction

function X9F takes nothing returns boolean
  local real d
  if GetUnitAbilityLevel(GetTriggerUnit(),'B091')>0 and GetUnitAbilityLevel(GetEventDamageSource(),'A0VV')>0 and(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(2)))==GetEventDamageSource()then
    call UnitRemoveAbility(GetTriggerUnit(),'B091')
    call DisableTrigger(GetTriggeringTrigger())
    call X8F(GetTriggerUnit())
    call FlushChildHashtable(hashtable019,(GetHandleId(GetTriggeringTrigger())))
    call CleanTrigger(GetTriggeringTrigger())
  endif
  return false
endfunction

function XDF takes nothing returns nothing
  local trigger t
  local unit Target
  local unit Source
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    set Target=GetSpellTargetUnit()
    set Source=GetTriggerUnit()
  else
    set Target=GetTriggerUnit()
    set Source=GetAttacker()
  endif
  if IsUnitIllusion(Source)==false then
    set t=CreateTrigger()
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Source))
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerAddCondition(t,Condition(function X9F))
  endif
  set t=null
  set Target=null
  set Source=null
endfunction

function XEF takes nothing returns boolean
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetUnitAbilityLevel(GetAttacker(),'A0VV')>0 and(LoadBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(3008)))and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetAttacker()==(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(2)))then
      call XDF()
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER then
    if(GetIssuedOrderId()==852255)then
      call SaveBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(3008),(true))
    elseif(GetIssuedOrderId()==852256)then
      call SaveBoolean(hashtable019,(GetHandleId(GetTriggeringTrigger())),(3008),(false))
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A0VV' then
    call XDF()
  endif
  return false
endfunction

function XFF takes unit Source returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function XEF))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Source))
  call SaveBoolean(hashtable019,(GetHandleId(t)),(3008),(true))
  set t=null
endfunction

function XGF takes nothing returns nothing
  call KillUnit(GetEnumUnit())
endfunction

function XHF takes nothing returns boolean
  return(GetUnitTypeId(GetFilterUnit())=='n027')
endfunction

function XIF takes player p returns nothing
  local group g=GetAvailableGroup()
  call GroupEnumUnitsOfPlayer(g,p,Condition(function XHF))
  call ForGroup(g,function XGF)
  call KillGroup(g)
  set g=null
endfunction

function XJF takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Caster
  local integer V2F=(LoadInteger(hashtable019,(GetHandleId(Source)),(3001)))
  local integer VAF=(LoadInteger(hashtable019,(GetHandleId(Source)),(3002)))
  call XIF(GetOwningPlayer(Source))
  set Caster=CreateUnit(GetOwningPlayer(Source),'n027',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
  call SetUnitColor(Caster,GetPlayerColor(Sentinels[0]))
  call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",Caster,"chest")
  call UnitApplyTimedLife(Caster,'BTLF',10+10*V2F)
  call SetUnitAbilityLevel(Caster,'A0VV',VAF)
  call XFF(Caster)
  if AutoselectionStatus[GetPlayerId(GetOwningPlayer(Source))]then
    call SelectUnitAddForPlayer(Caster,GetOwningPlayer(Source))
  endif
  if V2F>3 and VAF>3 then
    set Caster=CreateUnit(GetOwningPlayer(Source),'n027',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
    call SetUnitColor(Caster,GetPlayerColor(Sentinels[0]))
    call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",Caster,"chest")
    call UnitApplyTimedLife(Caster,'BTLF',10+10*V2F)
    call SetUnitAbilityLevel(Caster,'A0VV',VAF)
    call XFF(Caster)
    if AutoselectionStatus[GetPlayerId(GetOwningPlayer(Source))]then
      call SelectUnitAddForPlayer(Caster,GetOwningPlayer(Source))
    endif
  endif
  call SetPlayerTechResearched(GetOwningPlayer(Source),'R00G',VAF)
  call SetPlayerTechResearched(GetOwningPlayer(Source),'R00H',V2F)
  set Source=null
  set Caster=null
endfunction

function XKF takes nothing returns boolean
  if GetSpellAbilityId()=='A0VO' then
    call XJF()
  endif
  return false
endfunction

function XMF takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function XKF))
  call PreloadAbilityDelayed('A0VV',GetRandomReal(1,25))
  call PreloadAbilityDelayed('A0VW',GetRandomReal(1,25))
  //set t=null
endfunction

function XNF takes unit Source returns integer
  local integer Level=(LoadInteger(hashtable019,(GetHandleId(Source)),(3001)))
  if Level==1 then
    return 'A230'
  elseif Level==2 then
    return 'A22Z'
  elseif Level==3 then
    return 'A22Y'
  elseif Level==4 then
    return 'A22U'
  elseif Level==5 then
    return 'A22V'
  elseif Level==6 then
    return 'A22W'
  elseif Level==7 then
    return 'A22X'
  endif
  return 'A230'
endfunction

function XOF takes unit Target returns nothing
  call UnitRemoveAbility(Target,'A230')
  call UnitRemoveAbility(Target,'A22Z')
  call UnitRemoveAbility(Target,'A22Y')
  call UnitRemoveAbility(Target,'A22U')
  call UnitRemoveAbility(Target,'A22V')
  call UnitRemoveAbility(Target,'A22W')
  call UnitRemoveAbility(Target,'A22X')
  call UnitRemoveAbility(Target,'B08Z')
endfunction

function XPF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real JSD=(LoadReal(hashtable019,(GetHandleId(Target)),(681)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or JSD<(TimerGetElapsed(GlobalTimer))then
    call XOF(Target)
  endif
  set t=null
  set Target=null
  return false
endfunction

function XQF takes nothing returns nothing
  local unit Source=tt_unit1
  local unit Target=GetEnumUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real JSD=(LoadReal(hashtable019,(GetHandleId(Target)),(681)))
  if JSD<(TimerGetElapsed(GlobalTimer))then
    call UnitAddAbility2(Target,XNF(Source))
  endif
  call SaveReal(hashtable019,(GetHandleId(Target)),(681),(((TimerGetElapsed(GlobalTimer))+2)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call TriggerRegisterTimerEvent(t,2.01,false)
  call TriggerRegisterDeathEvent(t,Target)
  call TriggerAddCondition(t,Condition(function XPF))
  set t=null
  set Source=null
  set Target=null
endfunction

function XRF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(6)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(7)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local real DP9=(LoadReal(hashtable019,(Cache),(57)))
  local real x
  local real y
  local integer i=1
  local integer Count=GetTriggerEvalCount(t)
  local group g
  if Count*.1>DP9 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set g=GetAvailableGroup()
    set tt_unit1=Source
    loop
      exitwhen i>7
      set x=SourceX+80*i*Cos((a+90)*bj_DEGTORAD)
      set y=SourceY+80*i*Sin((a+90)*bj_DEGTORAD)
      call GroupEnumUnitsInRange(g,x,y,105,Condition(function NonImmuneEnemyFilter))
      call ForGroup(g,function XQF)
      set x=SourceX+80*i*Cos((a-90)*bj_DEGTORAD)
      set y=SourceY+80*i*Sin((a-90)*bj_DEGTORAD)
      call GroupEnumUnitsInRange(g,x,y,105,Condition(function NonImmuneEnemyFilter))
      call ForGroup(g,function XQF)
      set i=i+1
    endloop
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Source=null
  return false
endfunction

function XSF takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real a=GetUnitFacing(Source)
  local integer i=1
  local unit Caster
  local real x
  local real y
  local real SourceX=GetUnitX(Source)+225*Cos(a*bj_DEGTORAD)
  local real SourceY=GetUnitY(Source)+225*Sin(a*bj_DEGTORAD)
  local integer V2F=(LoadInteger(hashtable019,(GetHandleId(Source)),(3001)))
  local integer VAF=(LoadInteger(hashtable019,(GetHandleId(Source)),(3002)))
  local real DP9=1.5+1.5*V2F
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  loop
    exitwhen i>7
    set x=SourceX+80*i*Cos((a+90)*bj_DEGTORAD)
    set y=SourceY+80*i*Sin((a+90)*bj_DEGTORAD)
    set Caster=CreateUnit(GetOwningPlayer(Source),'u00O',x,y,GetRandomReal(0,360))
    call SetUnitAbilityLevel(Caster,'S00H',V2F)
    call SetUnitAbilityLevel(Caster,'A0XN',VAF)
    call SetUnitAnimation(Caster,"birth")
    call QueueUnitAnimation(Caster,"stand")
    call UnitApplyTimedLife(Caster,'BTLF',DP9)
    set x=SourceX+80*i*Cos((a-90)*bj_DEGTORAD)
    set y=SourceY+80*i*Sin((a-90)*bj_DEGTORAD)
    set Caster=CreateUnit(GetOwningPlayer(Source),'u00O',x,y,GetRandomReal(0,360))
    call SetUnitAbilityLevel(Caster,'S00H',V2F)
    call SetUnitAbilityLevel(Caster,'A0XN',VAF)
    call SetUnitAnimation(Caster,"birth")
    call QueueUnitAnimation(Caster,"stand")
    call UnitApplyTimedLife(Caster,'BTLF',DP9)
    set i=i+1
  endloop
  call TriggerAddCondition(t,Condition(function XRF))
  call TriggerRegisterTimerEvent(t,.1,true)
  call SaveReal(hashtable019,(Cache),(6),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(7),((SourceY)*1.))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(57),((DP9)*1.))
  set Caster=null
  set Source=null
  set t=null
endfunction

function XTF takes nothing returns boolean
  if GetSpellAbilityId()=='A0VP' then
    call XSF()
  endif
  return false
endfunction

function XUF takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function XTF))
  call PreloadAbilityDelayed('S00H',GetRandomReal(1,25))
  call PreloadAbilityDelayed('A0XN',GetRandomReal(1,25))
  //set t=null
endfunction

function XVF takes nothing returns nothing
  if IsCourier(GetEnumUnit())==false then
    call DamageTarget(tt_unit1,GetEnumUnit(),3,tt_real1)
  endif
endfunction

function XWF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local group g=GetAvailableGroup()
  local integer Count
  set tt_unit1=Hero
  call TimedReveal(GetOwningPlayer(Hero),4,x,y,400)
  call GroupEnumUnitsInRange(g,x,y,200,Condition(function DefaultEnemyFilter))
  set Count=CountUnitsInGroup(g)
  if Count<1 then
    set Count=1
  endif
  set tt_real1=Damage/ Count
  call ForGroup(g,function XVF)
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",x,y))
  call KillGroup(g)
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  set g=null
  return false
endfunction

function XXF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real Damage=(LoadInteger(hashtable019,(GetHandleId(Hero)),(3002)))*62.5+12.5+25
  local string s=""
  if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Hero)) or(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2))then
    set s="Abilities\\Spells\\Items\\VampiricPotion\\VampPotionCaster.mdl"
  endif
  call TimedReveal(GetOwningPlayer(Hero),5.7,x,y,400)
  call TriggerRegisterTimerEvent(t,1.7,false)
  call TriggerAddCondition(t,Condition(function XWF))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveReal(hashtable019,(Cache),(20),((Damage)*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffect(s,x,y)))
  //call RemoveLocation(l)
  set t=null
  set Hero=null
  //set l=null
endfunction

function XZF takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function XYF))
  //set t=null
endfunction

function XAF takes unit Source,unit Target returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,'A0VI')
  call IssueTargetOrderById(Caster,852095,Target)
  if IsMagicImmune(Target)==false then
    call DamageTarget(Source,Target,1,30)
  endif
  set Caster=null
endfunction

function XBF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamage()>10 and((LoadInteger(hashtable019,(GetHandleId((t))),((4263))))==1)==false and GetOwningPlayer(GetEventDamageSource())!=GetOwningPlayer(GetTriggerUnit()) and IsRealDamage then
      call DisableTrigger(t)
      call XAF(Source,Target)
      call EnableTrigger(t)
      call AddTimedKeyForTrigger(t,4263,.8-Level*.0285)
    endif
  else
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  set Source=null
  return false
endfunction

function XCF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=(LoadInteger(hashtable019,(GetHandleId(Hero)),(3001)))
  call TriggerRegisterTimerEvent(t,2.5+Level*.5,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function XBF))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Hero))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Weapons\\SpiritOfVengeanceMissile\\SpiritOfVengeanceMissile.mdl",Target,"overhead")))
  call XAF(Hero,Target)
  set t=null
  set Hero=null
  set Target=null
endfunction

function X3F takes nothing returns boolean
  if GetSpellAbilityId()=='A0VZ' then
    call XCF()
  endif
  return false
endfunction

function X6F takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function X3F))
  call PreloadAbilityDelayed('A0VI',GetRandomReal(1,25))
  //set t=null
endfunction

function XLF takes unit Hero returns nothing
  local integer Cache=GetHandleId(Hero)
  local boolean X1F=(LoadBoolean(hashtable019,(Cache),(3003)))
  local trigger t
  if X1F then
    call SaveBoolean(hashtable019,(Cache),(3003),(false))
    set t=(LoadTriggerHandle(hashtable019,(Cache),(3006)))
    call FlushChildHashtable(hashtable019,(GetHandleId(t)))
    call CleanTrigger(t)
  endif
  set t=null
endfunction

function X0F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  call SetUnitState(Hero,UNIT_STATE_LIFE,GetUnitState(Hero,UNIT_STATE_LIFE)+Level*1)
  set t=null
  set Hero=null
  return false
endfunction

function X5F takes unit Hero,integer Level returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(Hero)
  call SaveBoolean(hashtable019,(Cache),(3003),(true))
  call SaveTriggerHandle(hashtable019,(Cache),(3006),(t))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(Hero))
  call SaveInteger(hashtable019,(GetHandleId(t)),(5),(Level))
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function X0F))
  set t=null
endfunction

function X2F takes nothing returns nothing
  local integer Y4F=0
  local unit Hero=GetTriggerUnit()
  local integer Cache=GetHandleId(Hero)
  local integer Y7F=(LoadInteger(hashtable019,(Cache),(3013)))
  local integer Y8F=(LoadInteger(hashtable019,(Cache),(3014)))
  local integer Y9F=(LoadInteger(hashtable019,(Cache),(3015)))
  local integer YDF=(LoadInteger(hashtable019,(Cache),(3016)))
  local integer YEF=(LoadInteger(hashtable019,(Cache),(3017)))
  if Y7F==3 and Y8F==0 and Y9F==0 then
    set Y4F=1
  elseif Y7F==2 and Y8F==1 and Y9F==0 then
    set Y4F=2
  elseif Y7F==2 and Y8F==0 and Y9F==1 then
    set Y4F=3
  elseif Y7F==1 and Y8F==2 and Y9F==0 then
    set Y4F=4
  elseif Y7F==1 and Y8F==1 and Y9F==1 then
    set Y4F=5
  elseif Y7F==1 and Y8F==0 and Y9F==2 then
    set Y4F=6
  elseif Y7F==0 and Y8F==1 and Y9F==2 then
    set Y4F=7
  elseif Y7F==0 and Y8F==2 and Y9F==1 then
    set Y4F=8
  elseif Y7F==0 and Y8F==0 and Y9F==3 then
    set Y4F=9
  elseif Y7F==0 and Y8F==3 and Y9F==0 then
    set Y4F=10
  endif
  if JH8[Y4F]==YEF then
    return
  endif
  if GetUnitAbilityLevel(Hero,'A21Y')==1 or GetUnitAbilityLevel(Hero,'A1GU')==1 then
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),YEF,false)
    set YEF=JH8[Y4F]
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),YEF,true)
  else
    if YDF!=0 and YEF!=0 then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),YDF,false)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),YEF,false)
      set YDF=YEF
      set YEF=JH8[Y4F]
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),YDF,true)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),YEF,true)
    elseif YDF==0 and YEF!=0 then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),YEF,false)
      set YDF=YEF
      set YEF=JH8[Y4F]
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),YDF,true)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),YEF,true)
    else
      set YEF=JH8[Y4F]
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),YEF,true)
    endif
  endif
  call SaveInteger(hashtable019,(Cache),(3016),(YDF))
  call SaveInteger(hashtable019,(Cache),(3017),(YEF))
  call WQF(Hero)
  set Hero=null
endfunction

function YFF takes unit Hero returns nothing
  local integer Cache=GetHandleId(Hero)
  local integer Y7F=(LoadInteger(hashtable019,(Cache),(3013)))
  local integer Y8F=(LoadInteger(hashtable019,(Cache),(3014)))
  local integer Y9F=(LoadInteger(hashtable019,(Cache),(3015)))
  local integer VZF=GetUnitAbilityLevel(Hero,'A21X')
  local integer V2F=GetUnitAbilityLevel(Hero,'A21W')
  local integer VAF=GetUnitAbilityLevel(Hero,'A21V')
  if VZF==2 then
    set VZF=3
  elseif VZF==3 then
    set VZF=5
  elseif VZF==4 then
    set VZF=7
  endif
  if V2F==2 then
    set V2F=3
  elseif V2F==3 then
    set V2F=5
  elseif V2F==4 then
    set V2F=7
  endif
  if VAF==2 then
    set VAF=3
  elseif VAF==3 then
    set VAF=5
  elseif VAF==4 then
    set VAF=7
  endif
  call UnitRemoveAbility(Hero,'A0WD')
  call UnitRemoveAbility(Hero,'A0VE')
  call XLF(Hero)
  call UnitRemoveAbility(Hero,'A0V7')
  if Y7F>0 then
    call UnitAddAbility2(Hero,'A0WD')
    call UnitAddAbility2(Hero,'A0VE')
    call SetUnitAbilityLevel(Hero,'A0WD',Y7F*VZF)
    call SetUnitAbilityLevel(Hero,'A0VE',Y7F*VZF)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A0WD',false)
  endif
  if Y8F>0 then
    call X5F(Hero,Y8F*V2F)
  endif
  if Y9F>0 then
    call UnitAddAbility2(Hero,'A0V7')
    call SetUnitAbilityLevel(Hero,'A0V7',Y9F*VAF)
  endif
endfunction

function YGF takes unit Hero,integer Y7F,integer Y8F,integer Y9F returns nothing
  local integer Orb1=0
  local integer Orb2=0
  local integer Orb3=0
  local integer YHF
  local integer YIF
  local integer YJF
  local integer YKF
  local integer YMF
  local integer YNF
  local integer YOF
  local integer YPF
  local integer YQF
  call UnitRemoveAbility(Hero,'A0DN')
  call UnitRemoveAbility(Hero,'A0DG')
  call UnitRemoveAbility(Hero,'A0IX')
  call UnitRemoveAbility(Hero,'A0I1')
  call UnitRemoveAbility(Hero,'A0I0')
  call UnitRemoveAbility(Hero,'A0HZ')
  call UnitRemoveAbility(Hero,'A0IC')
  call UnitRemoveAbility(Hero,'A0IB')
  call UnitRemoveAbility(Hero,'A0ID')
  call UnitRemoveAbility(Hero,'A22C')
  call UnitRemoveAbility(Hero,'A22D')
  call UnitRemoveAbility(Hero,'A22E')
  call UnitRemoveAbility(Hero,'A22F')
  call UnitRemoveAbility(Hero,'A22G')
  call UnitRemoveAbility(Hero,'A22H')
  call UnitRemoveAbility(Hero,'A22I')
  call UnitRemoveAbility(Hero,'A22J')
  call UnitRemoveAbility(Hero,'A22K')
  if FindItemByIndex(Hero,indexid_AghanimInvoker)==null then
    set YHF='A0DN'
    set YIF='A0DG'
    set YJF='A0IX'
    set YKF='A0I1'
    set YMF='A0I0'
    set YNF='A0HZ'
    set YOF='A0IC'
    set YPF='A0IB'
    set YQF='A0ID'
  else
    set YHF='A22C'
    set YIF='A22D'
    set YJF='A22E'
    set YKF='A22F'
    set YMF='A22G'
    set YNF='A22H'
    set YOF='A22I'
    set YPF='A22J'
    set YQF='A22K'
  endif
  if Y7F==1 and Y8F==0 and Y9F==0 then
    call UnitAddAbility2(Hero,YHF)
  elseif Y7F==0 and Y8F==1 and Y9F==0 then
    call UnitAddAbility2(Hero,YKF)
  elseif Y7F==0 and Y8F==0 and Y9F==1 then
    call UnitAddAbility2(Hero,YOF)
  elseif Y7F==2 and Y8F==0 and Y9F==0 then
    call UnitAddAbility2(Hero,YHF)
    call UnitAddAbility2(Hero,YIF)
  elseif Y7F==1 and Y8F==1 and Y9F==0 then
    call UnitAddAbility2(Hero,YHF)
    call UnitAddAbility2(Hero,YMF)
  elseif Y7F==1 and Y8F==0 and Y9F==1 then
    call UnitAddAbility2(Hero,YHF)
    call UnitAddAbility2(Hero,YPF)
  elseif Y7F==0 and Y8F==2 and Y9F==0 then
    call UnitAddAbility2(Hero,YKF)
    call UnitAddAbility2(Hero,YMF)
  elseif Y7F==0 and Y8F==1 and Y9F==1 then
    call UnitAddAbility2(Hero,YKF)
    call UnitAddAbility2(Hero,YPF)
  elseif Y7F==0 and Y8F==0 and Y9F==2 then
    call UnitAddAbility2(Hero,YOF)
    call UnitAddAbility2(Hero,YPF)
  elseif Y7F==3 and Y8F==0 and Y9F==0 then
    call UnitAddAbility2(Hero,YHF)
    call UnitAddAbility2(Hero,YIF)
    call UnitAddAbility2(Hero,YJF)
  elseif Y7F==2 and Y8F==1 and Y9F==0 then
    call UnitAddAbility2(Hero,YHF)
    call UnitAddAbility2(Hero,YIF)
    call UnitAddAbility2(Hero,YNF)
  elseif Y7F==2 and Y8F==0 and Y9F==1 then
    call UnitAddAbility2(Hero,YHF)
    call UnitAddAbility2(Hero,YIF)
    call UnitAddAbility2(Hero,YQF)
  elseif Y7F==1 and Y8F==2 and Y9F==0 then
    call UnitAddAbility2(Hero,YHF)
    call UnitAddAbility2(Hero,YMF)
    call UnitAddAbility2(Hero,YNF)
  elseif Y7F==1 and Y8F==1 and Y9F==1 then
    call UnitAddAbility2(Hero,YHF)
    call UnitAddAbility2(Hero,YMF)
    call UnitAddAbility2(Hero,YQF)
  elseif Y7F==1 and Y8F==0 and Y9F==2 then
    call UnitAddAbility2(Hero,YHF)
    call UnitAddAbility2(Hero,YPF)
    call UnitAddAbility2(Hero,YQF)
  elseif Y7F==0 and Y8F==1 and Y9F==2 then
    call UnitAddAbility2(Hero,YOF)
    call UnitAddAbility2(Hero,YPF)
    call UnitAddAbility2(Hero,YNF)
  elseif Y7F==0 and Y8F==2 and Y9F==1 then
    call UnitAddAbility2(Hero,YKF)
    call UnitAddAbility2(Hero,YMF)
    call UnitAddAbility2(Hero,YQF)
  elseif Y7F==0 and Y8F==0 and Y9F==3 then
    call UnitAddAbility2(Hero,YOF)
    call UnitAddAbility2(Hero,YPF)
    call UnitAddAbility2(Hero,YQF)
  elseif Y7F==0 and Y8F==3 and Y9F==0 then
    call UnitAddAbility2(Hero,YKF)
    call UnitAddAbility2(Hero,YMF)
    call UnitAddAbility2(Hero,YNF)
  endif
endfunction

function YRF takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local integer Cache=GetHandleId(Hero)
  local integer YSF=GetSpellAbilityId()
  local integer YTF=(LoadInteger(hashtable019,(Cache),(3010)))
  local integer YUF=(LoadInteger(hashtable019,(Cache),(3011)))
  local integer YVF=(LoadInteger(hashtable019,(Cache),(3012)))
  local integer Y7F=0
  local integer Y8F=0
  local integer Y9F=0
  set YTF=YUF
  set YUF=YVF
  set YVF=YSF
  if YTF=='A21X' then
    set Y7F=Y7F+1
  elseif YTF=='A21W' then
    set Y8F=Y8F+1
  elseif YTF=='A21V' then
    set Y9F=Y9F+1
  endif
  if YUF=='A21X' then
    set Y7F=Y7F+1
  elseif YUF=='A21W' then
    set Y8F=Y8F+1
  elseif YUF=='A21V' then
    set Y9F=Y9F+1
  endif
  if YVF=='A21X' then
    set Y7F=Y7F+1
  elseif YVF=='A21W' then
    set Y8F=Y8F+1
  elseif YVF=='A21V' then
    set Y9F=Y9F+1
  endif
  call SaveInteger(hashtable019,(Cache),(3010),(YTF))
  call SaveInteger(hashtable019,(Cache),(3011),(YUF))
  call SaveInteger(hashtable019,(Cache),(3012),(YVF))
  call SaveInteger(hashtable019,(Cache),(3013),(Y7F))
  call SaveInteger(hashtable019,(Cache),(3014),(Y8F))
  call SaveInteger(hashtable019,(Cache),(3015),(Y9F))
  call YGF(Hero,Y7F,Y8F,Y9F)
  call YFF(Hero)
  call WQF(Hero)
  set Hero=null
endfunction

function CJ9 takes nothing returns nothing
  local unit Hero=tt_unit1
  local integer Cache=GetHandleId(Hero)
  local integer YTF=(LoadInteger(hashtable019,(Cache),(3010)))
  local integer YUF=(LoadInteger(hashtable019,(Cache),(3011)))
  local integer YVF=(LoadInteger(hashtable019,(Cache),(3012)))
  local integer Y7F=0
  local integer Y8F=0
  local integer Y9F=0
  if YTF=='A21X' then
    set Y7F=Y7F+1
  elseif YTF=='A21W' then
    set Y8F=Y8F+1
  elseif YTF=='A21V' then
    set Y9F=Y9F+1
  endif
  if YUF=='A21X' then
    set Y7F=Y7F+1
  elseif YUF=='A21W' then
    set Y8F=Y8F+1
  elseif YUF=='A21V' then
    set Y9F=Y9F+1
  endif
  if YVF=='A21X' then
    set Y7F=Y7F+1
  elseif YVF=='A21W' then
    set Y8F=Y8F+1
  elseif YVF=='A21V' then
    set Y9F=Y9F+1
  endif
  call YGF(Hero,Y7F,Y8F,Y9F)
  set Hero=null
endfunction

function YWF takes nothing returns boolean
  if IsUnitIllusion(GetTriggerUnit())==false and(IsInvokersOrbs(GetLearnedSkill()))then
    call YFF(GetTriggerUnit())
    if GetLearnedSkill()=='A21X' then
      call SetHeroAgi(GetTriggerUnit(),GetHeroAgi(GetTriggerUnit(),false)+4,true)
      call SaveInteger(hashtable019,(GetHandleId(GetTriggerUnit())),(3000),(GetUnitAbilityLevel(GetTriggerUnit(),'A21X')))
    endif
    if GetLearnedSkill()=='A21W' then
      call SetHeroStr(GetTriggerUnit(),GetHeroStr(GetTriggerUnit(),false)+4,true)
      call SaveInteger(hashtable019,(GetHandleId(GetTriggerUnit())),(3001),(GetUnitAbilityLevel(GetTriggerUnit(),'A21W')))
    endif
    if GetLearnedSkill()=='A21V' then
      call SetHeroInt(GetTriggerUnit(),GetHeroInt(GetTriggerUnit(),false)+4,true)
      call SaveInteger(hashtable019,(GetHandleId(GetTriggerUnit())),(3002),(GetUnitAbilityLevel(GetTriggerUnit(),'A21V')))
    endif
  endif
  return false
endfunction

function VW9 takes nothing returns nothing
  local unit Hero=tt_unit1
  local integer i=1
  local integer A38
  if GetUnitTypeId(Hero)!='H00U' then
    return
  endif
  loop
    exitwhen i>11
    set A38=JH8[i]
    call UnitAddAbility2(Hero,A38)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),A38,false)
    set i=i+1
  endloop
  set Hero=null
endfunction

function YYF takes nothing returns boolean
  if b_isPickTime==false then
    if GetUnitTypeId(GetTriggerUnit())=='H00U' and IsUnitIllusion(GetTriggerUnit())==false then
      set tt_unit1=GetTriggerUnit()
      call VW9()
    elseif(isPlayerPickedAbility(GetOwningPlayer(GetTriggerUnit()),316)or isPlayerPickedAbility(GetOwningPlayer(GetTriggerUnit()),212))and IsUnitIllusion(GetTriggerUnit())==false then
      set tt_unit1=GetTriggerUnit()
      //call ExeFunc("Weaver_TimeLapse_Learn")
    elseif isPlayerPickedAbility(GetOwningPlayer(GetTriggerUnit()),356) and IsUnitIllusion(GetTriggerUnit())==false and GetUnitTypeId(GetTriggerUnit())!='H00J' then
      set tt_unit1=GetTriggerUnit()
      call ExeFunc("Register_DividedWeStand")
    endif
  endif
  return false
endfunction

function SM9 takes nothing returns nothing
  //	local trigger t=CreateTrigger()
  //	call PreloadAbility((JH8[1]))
  //	call PreloadAbility((JH8[2]))
  //	call PreloadAbility((JH8[3]))
  //	call PreloadAbility((JH8[4]))
  //	call PreloadAbility((JH8[5]))
  //	call PreloadAbility((JH8[6]))
  //	call PreloadAbility((JH8[7]))
  //	call PreloadAbility((JH8[8]))
  //	call PreloadAbility((JH8[9]))
  //	call PreloadAbility((JH8[10]))
  //	call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  //	call TriggerAddCondition(t,Condition(function YWF))
  //	set t=null
  call DisplayTimedTextToForceEx(bj_FORCE_ALL_PLAYERS,15.,GetObjectName('n06G'))
  //call PreloadAbilityDelayed('A0XO',GetRandomReal(1,25))
  //call PreloadAbilityDelayed('A0WD',GetRandomReal(1,25))
  call PreloadAbilityDelayed('A0VE',GetRandomReal(1,25))
  call PreloadAbilityDelayed('A0V7',GetRandomReal(1,25))
  call PreloadAbilityDelayed('A21V',GetRandomReal(1,25))
  call PreloadAbilityDelayed('A21X',GetRandomReal(1,25))
  call PreloadAbilityDelayed('A21W',GetRandomReal(1,25))
  call V0F()
  call WGF()
  call WMF()
  call WSF()
  call WAF()
  call X4F()
  call XMF()
  call XUF()
  call XZF()
  call X6F()
endfunction

function Lod_DeafeningBlast_DisableAffected takes unit Source,unit Target,integer Level returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,'A0VT')
  call SetUnitAbilityLevel(Caster,'A0VT',Level+1)
  call IssueTargetOrderById(Caster,852585,Target)
  set Caster=null
endfunction

function Lod_DeafeningBlast_MoveAffected takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real QQE=(LoadReal(hashtable019,(Cache),(193)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer RHE=Level*40/ 3
  local real x
  local real y
  local integer Count=GetTriggerEvalCount(t)
  if Count>RHE/ 3 then
    call SaveReal(hashtable019,(Cache),(193),((QQE*.98)*1.))
  endif
  if Count>RHE or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if GetTriggerEventId()!=EVENT_UNIT_DEATH then
      call Lod_DeafeningBlast_DisableAffected(Source,Target,Level)
    endif
  else
    set x=SafeX50(GetUnitX(Target)+QQE*Cos(J2E))
    set y=SafeY50(GetUnitY(Target)+QQE*Sin(J2E))
    call KillTrees(x,y,150)
    call SetUnitPosition(Target,x,y)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Lod_DeafeningBlast_Affect takes unit Source,unit Target,integer Level returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real J2E=Atan2(GetUnitY(Target)-GetUnitY(Source),GetUnitX(Target)-GetUnitX(Source))
  call DamageTarget(Source,Target,1,20+60*Level)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveReal(hashtable019,(Cache),(193),((6)*1.))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Lod_DeafeningBlast_MoveAffected))
  set t=null
endfunction

function Lod_DeafeningBlast_HitCheck takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),DK)==false and IsMagicImmune(GetEnumUnit())==false then
    call GroupAddUnit(DK,GetEnumUnit())
    call Lod_DeafeningBlast_Affect(tt_unit1,GetEnumUnit(),tt_int1)
  endif
endfunction

function Lod_DeafeningBlast_Move takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local real x2=(LoadReal(hashtable019,(Cache),(66)))
  local real y2=(LoadReal(hashtable019,(Cache),(67)))
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real x=GetUnitX(Caster)
  local real y=GetUnitY(Caster)
  local group g2
  if DistanceBetweenXY(x,y,x2,y2)<100 then
    set x=x2
    set y=y2
  else
    set x=x+33*Cos(a)
    set y=y+33*Sin(a)
  endif
  call SetUnitX(Caster,SafeX50(x))
  call SetUnitY(Caster,SafeY50(y))
  set g2=GetAvailableGroup()
  set tt_unit1=Caster
  set DK=g
  set tt_int1=Level
  call GroupEnumUnitsInRange(g2,x,y,200,Condition(function DefaultEnemyFilter))
  call ForGroup(g2,function Lod_DeafeningBlast_HitCheck)
  call KillGroup(g2)
  if(x==x2 and y==y2)or GetTriggerEvalCount(t)>35 then
    set g2=GetAvailableGroup()
    set tt_unit1=Caster
    set DK=g
    set tt_int1=Level
    call GroupEnumUnitsInRange(g2,x,y,250,Condition(function DefaultEnemyFilter))
    call ForGroup(g2,function Lod_DeafeningBlast_HitCheck)
    call KillGroup(g2)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call KillUnit(Caster)
    call KillGroup(g)
  endif
  set t=null
  set Caster=null
  set g=null
  set g2=null
  return false
endfunction

function Lod_DeafeningBlast_Effect takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local integer Level=GetUnitAbilityLevel(Source,'Z610')
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'n01X',GetUnitX(Source),GetUnitY(Source),a*bj_RADTODEG)
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function Lod_DeafeningBlast_Move))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveReal(hashtable019,(Cache),(66),((GetUnitX(Source)+1000*Cos(a))*1.))
  call SaveReal(hashtable019,(Cache),(67),((GetUnitY(Source)+1000*Sin(a))*1.))
  call SaveGroupHandle(hashtable019,(Cache),(22),(GetAvailableGroup()))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  set t=null
  set Source=null
  set Caster=null
endfunction

function Lod_DeafeningBlast takes nothing returns boolean
  if GetSpellAbilityId()=='Z610' then
    call Lod_DeafeningBlast_Effect()
  endif
  return false
endfunction

function Lod_DeafeningBlast_Register takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Lod_DeafeningBlast))
  call PreloadAbilityDelayed('A0VT',GetRandomReal(1,25))
  //set t=null
endfunction

function Lod_EMP_Hit takes nothing returns nothing
  local real VWF=RMaxIF(RMinIF(GetUnitState(GetEnumUnit(),UNIT_STATE_MANA),JF8),0)
  local real VXF=VWF*.5
  local real manasteal=0
  if IsMagicImmune(GetEnumUnit())==false and VWF>0 and IsUnitCycloned(GetEnumUnit())==false then
    if IsUnitIllusion(GetEnumUnit())==false then
      if GetUnitState(GetEnumUnit(),UNIT_STATE_MANA)>VWF then
        set manasteal=manasteal+VWF
      else
        set manasteal=manasteal+GetUnitState(GetEnumUnit(),UNIT_STATE_MANA)
      endif
    endif
    if GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)>(VXF+.5) then
      call SetUnitState(GetEnumUnit(),UNIT_STATE_LIFE,GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)-VXF)
    else
      call SetUnitState(GetEnumUnit(),UNIT_STATE_LIFE,1)
      call DamageTarget(JG8,GetEnumUnit(),1,VXF)
    endif
    
    call SetUnitState(GetEnumUnit(),UNIT_STATE_MANA,GetUnitState(GetEnumUnit(),UNIT_STATE_MANA)-VWF)
    
  endif
  set manasteal=manasteal/2
  call SetUnitState(tt_unit1,UNIT_STATE_MANA,GetUnitState(tt_unit1,UNIT_STATE_MANA)+manasteal)
endfunction

function Lod_EMP_Explode takes unit Source,integer Level, unit Hero returns nothing
  local group g=GetAvailableGroup()
  set JG8=Source
  set tt_unit1=Source
  set JF8=Level*125
  set tt_unit1=Hero
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),700,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function Lod_EMP_Hit)
  call KillGroup(g)
  set g=null
endfunction

function Lod_EMP_Delay takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=GetTriggerEvalCount(t)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  local unit VCF
  local real V3F=2.6
  local real V6F=1+(3.9-1)*Count/(V3F/ .05)
  call SetUnitScale(Caster,V6F,V6F,V6F)
  if Count>(V3F/ .05)then
    call Lod_EMP_Explode(Caster,Level,Source)
    set VCF=CreateUnit(GetOwningPlayer(Caster),'e01O',GetUnitX(Caster),GetUnitY(Caster),0)
    call SetUnitTimeScale(VCF,.3)
    call RemoveUnit(Caster)
    call KillUnit(VCF)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Caster=null
  set VCF=null
  set Source=null
  return false
endfunction

function Lod_EMP_Effect takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local integer Level=GetUnitAbilityLevel(Source,'Z609')
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e01M',x,y,a*bj_RADTODEG)
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function Lod_EMP_Delay))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  set t=null
  set Source=null
  set Caster=null
endfunction

function Lod_EMP takes nothing returns boolean
  if GetSpellAbilityId()=='Z609' then
    call Lod_EMP_Effect()
  endif
  return false
endfunction

function Lod_EMP_Register takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Lod_EMP))
  //set t=null
endfunction

function Lod_Tornado_Affect takes unit Source,unit Target,integer Level returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local unit W4F=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local real W7F=.8+.3*Level
  call UnitAddAbility2(Caster,'A0XK')
  call SetUnitAbilityLevel(Caster,'A0XK',Level+1)
  call IssueTargetOrderById(Caster,852144,Target)
  call DamageTarget_Delayed(W4F,Target,1,60.+Level*60.,W7F)
  set Caster=null
  set W4F=null
endfunction

function Lod_Tornado_HitCheck takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),DK)==false then
    call GroupAddUnit(DK,GetEnumUnit())
    call Lod_Tornado_Affect(tt_unit1,GetEnumUnit(),tt_int1)
  endif
endfunction

function Lod_Tornado_Move takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local real x2=(LoadReal(hashtable019,(Cache),(66)))
  local real y2=(LoadReal(hashtable019,(Cache),(67)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  local real x=GetUnitX(Caster)+25*Cos(a)
  local real y=GetUnitY(Caster)+25*Sin(a)
  local group WDF=GetAvailableGroup()
  local real YR8=DistanceBetweenXY(x,y,x2,y2)
  if YR8<=30 then
    set x=x2
    set y=y2
  endif
  call SetUnitX(Caster,SafeX50(x))
  call SetUnitY(Caster,SafeX50(y))
  set tt_unit1=Caster
  set DK=g
  set tt_int1=Level
  call GroupEnumUnitsInRange(WDF,x,y,200,Condition(function DefaultEnemyFilter))
  call ForGroup(WDF,function Lod_Tornado_HitCheck)
  call KillGroup(WDF)
  if YR8<=30 or GetTriggerEvalCount(t)>125 then
    call KillGroup(g)
    call KillUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Caster=null
  set g=null
  set WDF=null
  return false
endfunction

function Lod_Tornado_Effect takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'Z608')
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local unit Caster
  if GetUnitTypeId(Source)=='e00E' then //Multicast
    if GetRandomInt(0,1)==1 then
      set a=a+GetRandomReal(0,bj_PI/4)
    else
      set a=a-GetRandomReal(0,bj_PI/4)
    endif
  endif
  set x=GetUnitX(Source)
  set y=GetUnitY(Source)
  set Caster=CreateUnit(GetOwningPlayer(Source),'n01U',x,y,a*bj_RADTODEG)
  call TriggerRegisterTimerEvent(t,.025,true)
  call TriggerAddCondition(t,Condition(function Lod_Tornado_Move))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveReal(hashtable019,(Cache),(66),(x+(750+500.*Level)*Cos(a)))
  call SaveReal(hashtable019,(Cache),(67),(y+(750+500.*Level)*Sin(a)))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveGroupHandle(hashtable019,(Cache),(22),(GetAvailableGroup()))
  set t=null
  set Source=null
  set Caster=null
endfunction

function Lod_Tornado takes nothing returns boolean
  if GetSpellAbilityId()=='Z608' then
    call Lod_Tornado_Effect()
  endif
  return false
endfunction

function Lod_Tornado_Register takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Lod_Tornado))
  call PreloadAbilityDelayed('A0XK',GetRandomReal(1,25))
  //set t=null
endfunction

function Lod_Alacrity_ExpireRetry takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call UnitRemoveAbility(Target,'A0VJ')
  call UnitRemoveAbility(Target,'A109')
  if GetUnitAbilityLevel(Target,'A0VJ')==0 and GetUnitAbilityLevel(Target,'A109')==0 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  return false
endfunction

function Lod_Alacrity_Expire takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call UnitRemoveAbility(Target,'A0VJ')
  call UnitRemoveAbility(Target,'A109')
  if GetUnitAbilityLevel(Target,'A0VJ')>0 or GetUnitAbilityLevel(Target,'A109')>0 then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function Lod_Alacrity_ExpireRetry))
  endif
  set t=null
  set Target=null
  return false
endfunction

function Lod_Alacrity_Effect takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'Z607')
  call UnitAddAbility2(Target,'A0VJ')
  call SetUnitAbilityLevel(Target,'A0VJ',1+Level)
  call UnitAddAbility2(Target,'A109')
  call SetUnitAbilityLevel(Target,'A109',1+Level)
  call TriggerRegisterTimerEvent(t,9,false)
  call TriggerAddCondition(t,Condition(function Lod_Alacrity_Expire))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIsp\\SpeedTarget.mdl",Target,"origin")))
  set t=null
  set Hero=null
  set Target=null
endfunction

function Lod_Alacrity takes nothing returns boolean
  if GetSpellAbilityId()=='Z607' then
    call Lod_Alacrity_Effect()
  endif
  return false
endfunction

function Lod_Alacrity_Register takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Lod_Alacrity))
  call PreloadAbilityDelayed('A0VJ',GetRandomReal(1,25))
  call PreloadAbilityDelayed('A109',GetRandomReal(1,25))
  //set t=null
endfunction

function Lod_IceWall_GetSlow takes unit Source returns integer
  local integer Level=GetUnitAbilityLevel(Source,'Z606')+1
  if Level==1 then
    return 'A230'
  elseif Level==2 then
    return 'A22Z'
  elseif Level==3 then
    return 'A22Y'
  elseif Level==4 then
    return 'A22U'
  elseif Level==5 then
    return 'A22V'
  elseif Level==6 then
    return 'A22W'
  elseif Level==7 then
    return 'A22X'
  endif
  return 'A230'
endfunction

function Lod_IceWall_RemoveSlow takes unit Target returns nothing
  call UnitRemoveAbility(Target,'A230')
  call UnitRemoveAbility(Target,'A22Z')
  call UnitRemoveAbility(Target,'A22Y')
  call UnitRemoveAbility(Target,'A22U')
  call UnitRemoveAbility(Target,'A22V')
  call UnitRemoveAbility(Target,'A22W')
  call UnitRemoveAbility(Target,'A22X')
  call UnitRemoveAbility(Target,'B08Z')
endfunction

function Lod_IceWall_Remove takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real JSD=(LoadReal(hashtable019,(GetHandleId(Target)),(681)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or JSD<(TimerGetElapsed(GlobalTimer))then
    call Lod_IceWall_RemoveSlow(Target)
  endif
  set t=null
  set Target=null
  return false
endfunction

function Lod_IceWall_Slow takes nothing returns nothing
  local unit Source=tt_unit1
  local unit Target=GetEnumUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real JSD=(LoadReal(hashtable019,(GetHandleId(Target)),(681)))
  if JSD<(TimerGetElapsed(GlobalTimer))then
    call UnitAddAbility2(Target,Lod_IceWall_GetSlow(Source))
  endif
  call SaveReal(hashtable019,(GetHandleId(Target)),(681),(((TimerGetElapsed(GlobalTimer))+2)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call TriggerRegisterTimerEvent(t,2.01,false)
  call TriggerRegisterDeathEvent(t,Target)
  call TriggerAddCondition(t,Condition(function Lod_IceWall_Remove))
  set t=null
  set Source=null
  set Target=null
endfunction

function Lod_IceWall_Periodic takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(6)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(7)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local real Duration=(LoadReal(hashtable019,(Cache),(57)))
  local real x
  local real y
  local integer i=1
  local integer Count=GetTriggerEvalCount(t)
  local group g
  if Count*.1>Duration then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set g=GetAvailableGroup()
    set tt_unit1=Source
    loop
      exitwhen i>7
      set x=SourceX+80*i*Cos((a+90)*bj_DEGTORAD)
      set y=SourceY+80*i*Sin((a+90)*bj_DEGTORAD)
      call GroupEnumUnitsInRange(g,x,y,105,Condition(function NonImmuneEnemyFilter))
      call ForGroup(g,function Lod_IceWall_Slow)
      set x=SourceX+80*i*Cos((a-90)*bj_DEGTORAD)
      set y=SourceY+80*i*Sin((a-90)*bj_DEGTORAD)
      call GroupEnumUnitsInRange(g,x,y,105,Condition(function NonImmuneEnemyFilter))
      call ForGroup(g,function Lod_IceWall_Slow)
      set i=i+1
    endloop
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Source=null
  return false
endfunction

function Lod_IceWall_Effect takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real a=GetUnitFacing(Source)
  local integer i=1
  local unit Caster
  local real x
  local real y
  local real SourceX=GetUnitX(Source)+225*Cos(a*bj_DEGTORAD)
  local real SourceY=GetUnitY(Source)+225*Sin(a*bj_DEGTORAD)
  local integer Level=GetUnitAbilityLevel(Source,'Z606')
  local real Duration=1.5+2*Level
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  if GetUnitTypeId(Source)=='e00E' then //Multicast
    set Source=udg_Hero[GetPlayerId(GetOwningPlayer(Source))]
    set a=GetRandomReal(0,360)
    set SourceX=GetUnitX(Source)+225*Cos(a*bj_DEGTORAD)
    set SourceY=GetUnitY(Source)+225*Sin(a*bj_DEGTORAD)
  endif
  loop
    exitwhen i>7
    set x=SourceX+80*i*Cos((a+90)*bj_DEGTORAD)
    set y=SourceY+80*i*Sin((a+90)*bj_DEGTORAD)
    set Caster=CreateUnit(GetOwningPlayer(Source),'u00O',x,y,GetRandomReal(0,360))
    call SetUnitAbilityLevel(Caster,'S00H',1+Level)
    call SetUnitAbilityLevel(Caster,'A0XN',1+Level)
    call SetUnitAnimation(Caster,"birth")
    call QueueUnitAnimation(Caster,"stand")
    call UnitApplyTimedLife(Caster,'BTLF',Duration)
    set x=SourceX+80*i*Cos((a-90)*bj_DEGTORAD)
    set y=SourceY+80*i*Sin((a-90)*bj_DEGTORAD)
    set Caster=CreateUnit(GetOwningPlayer(Source),'u00O',x,y,GetRandomReal(0,360))
    call SetUnitAbilityLevel(Caster,'S00H',1+Level)
    call SetUnitAbilityLevel(Caster,'A0XN',1+Level)
    call SetUnitAnimation(Caster,"birth")
    call QueueUnitAnimation(Caster,"stand")
    call UnitApplyTimedLife(Caster,'BTLF',Duration)
    set i=i+1
  endloop
  call TriggerAddCondition(t,Condition(function Lod_IceWall_Periodic))
  call TriggerRegisterTimerEvent(t,.1,true)
  call SaveReal(hashtable019,(Cache),(6),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(7),((SourceY)*1.))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(57),((Duration)*1.))
  set Caster=null
  set Source=null
  set t=null
endfunction

function Lod_IceWall takes nothing returns boolean
  if GetSpellAbilityId()=='Z606' then
    call Lod_IceWall_Effect()
  endif
  return false
endfunction

function Lod_IceWall_Register takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Lod_IceWall))
  call PreloadAbilityDelayed('S00H',GetRandomReal(1,25))
  call PreloadAbilityDelayed('A0XN',GetRandomReal(1,25))
  //set t=null
endfunction

function RemoveGhostWalkDeact takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local unit u=LoadUnitHandle(hashtable019,GetHandleId(t),0)
  if IsDead(u)==false then
    call UnitRemoveAbility(u,'QFZZ')
    if GetUnitAbilityLevel(u,'QFZZ')==0 then
      call FlushChildHashtable(hashtable019,GetHandleId(t))
      call DestroyTrigger(t)
    endif
  endif
  set t=null
  set u=null
  return false
endfunction

function Lod_GhostWalk_Move takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local trigger tt
  if GetUnitAbilityLevel(Hero,'B08X')==0 then
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'Z605',true)
    call UnitRemoveAbility(Hero,'QFZZ')
    if GetUnitAbilityLevel(Hero,'QFZZ')>0 then
      set tt=CreateTrigger()
      call TriggerRegisterTimerEvent(tt,1,true)
      call TriggerAddCondition(tt,Condition(function RemoveGhostWalkDeact))
      call SaveUnitHandle(hashtable019,GetHandleId(tt),0,Hero)
      set tt=null
    endif
    call KillUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SetUnitAbilityLevel(Caster,'A0VH',GetUnitAbilityLevel(Hero,'Z604'))
    call SetUnitX(Caster,GetUnitX(Hero))
    call SetUnitY(Caster,GetUnitY(Hero))
  endif
  set t=null
  set Caster=null
  set Hero=null
  return false
endfunction

function Lod_GhostWalk_Effect takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e01V',GetUnitX(Hero),GetUnitY(Hero),0)
  local integer id='QH50'
  local integer lvl=GetUnitAbilityLevel(Hero,'Z605')
  local integer i=GetUnitAbilityLevel(Hero,'Z605')
  if lvl==4 then
    set id='QH51'
    set i=1
  endif
  call UnitAddAbility2(Caster,id)
  call SetUnitAbilityLevel(Caster,id,i)
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function Lod_GhostWalk_Move))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'Z605',false)
  call UnitAddAbility(Hero,'QFZZ')
  call SetUnitAbilityLevel(Hero,'QFZZ',1)
  set t=null
  set Hero=null
  set Caster=null
endfunction

function Lod_GhostWalk takes nothing returns boolean
  if GetSpellAbilityId()=='Z605' then
    call Lod_GhostWalk_Effect()
  endif
  return false
endfunction

function Lod_GhostWalk_Register takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Lod_GhostWalk))
  call PreloadAbilityDelayed('A0VH',GetRandomReal(1,25))
  //set t=null
endfunction

function Lod_ColdSnap_Stun takes unit Source,unit Target returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,'A0VI')
  call IssueTargetOrderById(Caster,852095,Target)
  if IsMagicImmune(Target)==false then
    call DamageTarget(Source,Target,1,25+5*GetUnitAbilityLevel(Source,'Z604'))
  endif
  set Caster=null
endfunction

function Lod_ColdSnap_OnHit takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamage()>10 and((LoadInteger(hashtable019,(GetHandleId((t))),((4263))))==1)==false and GetOwningPlayer(GetEventDamageSource())!=GetOwningPlayer(GetTriggerUnit()) and IsRealDamage then
      call DisableTrigger(t)
      call Lod_ColdSnap_Stun(Source,Target)
      call EnableTrigger(t)
      call AddTimedKeyForTrigger(t,4263,.6)
    endif
  else
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  set Source=null
  return false
endfunction

function Lod_ColdSnap_Effect takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'Z604')
  call TriggerRegisterTimerEvent(t,2.5+Level*.5,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function Lod_ColdSnap_OnHit))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Hero))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Weapons\\SpiritOfVengeanceMissile\\SpiritOfVengeanceMissile.mdl",Target,"overhead")))
  call Lod_ColdSnap_Stun(Hero,Target)
  set t=null
  set Hero=null
  set Target=null
endfunction

function Lod_ColdSnap takes nothing returns boolean
  if GetSpellAbilityId()=='Z604' then
    call Lod_ColdSnap_Effect()
  endif
  return false
endfunction

function Lod_ColdSnap_Register takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Lod_ColdSnap))
  call PreloadAbilityDelayed('A0VI',GetRandomReal(1,25))
  //set t=null
endfunction

function Lod_ForgeSpirit_Effect takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Caster
  local integer Level=GetUnitAbilityLevel(Source,'Z603')
  if GetUnitTypeId(Source)!='e00E' then
    call XIF(GetOwningPlayer(Source))
  endif
  set Caster=CreateUnit(GetOwningPlayer(Source),'n027',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
  call SetUnitColor(Caster,GetPlayerColor(Sentinels[0]))
  call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",Caster,"chest")
  call UnitApplyTimedLife(Caster,'BTLF',35)//[lich] forged lie
  call SetUnitAbilityLevel(Caster,'A0VV',1+Level)
  call XFF(Caster)
  if AutoselectionStatus[GetPlayerId(GetOwningPlayer(Source))]then
    call SelectUnitAddForPlayer(Caster,GetOwningPlayer(Source))
  endif
  if Level>2 then
    set Caster=CreateUnit(GetOwningPlayer(Source),'n027',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
    call SetUnitColor(Caster,GetPlayerColor(Sentinels[0]))
    call AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",Caster,"chest")
    call UnitApplyTimedLife(Caster,'BTLF',35)
    call SetUnitAbilityLevel(Caster,'A0VV',1+Level)
    call XFF(Caster)
    if AutoselectionStatus[GetPlayerId(GetOwningPlayer(Source))]then
      call SelectUnitAddForPlayer(Caster,GetOwningPlayer(Source))
    endif
  endif
  call SetPlayerTechResearched(GetOwningPlayer(Source),'R00G',1+Level)
  call SetPlayerTechResearched(GetOwningPlayer(Source),'R00H',1+Level)
  set Source=null
  set Caster=null
endfunction

function Lod_ForgeSpirit takes nothing returns boolean
  if GetSpellAbilityId()=='Z603' then
    call Lod_ForgeSpirit_Effect()
  endif
  return false
endfunction

function Lod_ForgeSpirit_Register takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Lod_ForgeSpirit))
  call PreloadAbilityDelayed('A0VV',GetRandomReal(1,25))
  call PreloadAbilityDelayed('A0VW',GetRandomReal(1,25))
  //set t=null
endfunction

function Lod_ChaosMeteor_ResidualPeriodic takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  local effect FX=(LoadEffectHandle(hashtable019,(Cache),(32)))
  local integer Count=GetTriggerEvalCount(t)
  call DamageTarget(Source,Target,1,Damage)
  if Count==3 then
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call DestroyEffect(FX)
  endif
  set t=null
  set Source=null
  set Target=null
  set FX=null
  return false
endfunction

function Lod_ChaosMeteor_Residual takes unit Source,unit Target,real Damage returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveReal(hashtable019,(Cache),(20),((Damage)*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Environment\\SmallBuildingFire\\SmallBuildingFire2.mdl",Target,"chest")))
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function Lod_ChaosMeteor_ResidualPeriodic))
  set t=null
endfunction

function Lod_ChaosMeteor_Affect takes nothing returns nothing
  call Lod_ChaosMeteor_Residual(tt_unit1,GetEnumUnit(),tt_real1/ 5)
  call DamageTarget(tt_unit1,GetEnumUnit(),1,tt_real1)
endfunction

function Lod_ChaosMeteor_Rolling takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer Count=GetTriggerEvalCount(t)-26
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real AO8
  local real AP8
  local unit Caster
  local group g
  if Count==1 then
    set Caster=CreateUnit(GetOwningPlayer(Source),'e01L',x,y,a*bj_RADTODEG)
    call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  elseif Count>1 then
    set Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  endif
  if Count>0 then
    set AO8=SafeX50(GetUnitX(Caster)+15*Cos(a))
    set AP8=SafeY50(GetUnitY(Caster)+15*Sin(a))
    call SetUnitX(Caster,AO8)
    call SetUnitY(Caster,AP8)
    if(Count>1 and ModuloInteger(Count,10)==0)or Count==1 then
      set g=GetAvailableGroup()
      set tt_unit1=Source
      set tt_real1=40+20*Level
      call GroupEnumUnitsInRange(g,AO8,AP8,300,Condition(function DefaultEnemyFilter))
      call ForGroup(g,function Lod_ChaosMeteor_Affect)
      call KillGroup(g)
      call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl",AO8,AP8))
    endif
    if Count>(350+200*Level)/ 16.6 then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call KillUnit(Caster)
    endif
  endif
  set t=null
  set g=null
  set Caster=null
  set Source=null
  return false
endfunction

function Lod_ChaosMeteor_Effect takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local unit W5F=CreateUnit(GetOwningPlayer(Source),'e01K',x,y,a*bj_RADTODEG)
  local integer Level=GetUnitAbilityLevel(Source,'Z602')
  call SetUnitTimeScale(W5F,.58)
  call UnitApplyTimedLife(W5F,'BTLF',1.75)
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function Lod_ChaosMeteor_Rolling))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveInteger(hashtable019,(Cache),(5),Level)
  set t=null
  set Source=null
  set W5F=null
endfunction

function Lod_ChaosMeteor takes nothing returns boolean
  if GetSpellAbilityId()=='Z602' then
    call Lod_ChaosMeteor_Effect()
  endif
  return false
endfunction

function Lod_ChaosMeteor_Register takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Lod_ChaosMeteor))
  //set t=null
endfunction

function Lod_SunStrike_Damage takes nothing returns nothing
  if IsCourier(GetEnumUnit())==false then
    call DamageTarget(tt_unit1,GetEnumUnit(),3,tt_real1)
  endif
endfunction

function Lod_SunStrike_Land takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local group g=GetAvailableGroup()
  local integer Count
  set tt_unit1=Hero
  call TimedReveal(GetOwningPlayer(Hero),4,x,y,400)
  call GroupEnumUnitsInRange(g,x,y,200,Condition(function DefaultEnemyFilter))
  set Count=CountUnitsInGroup(g)
  if Count<1 then
    set Count=1
  endif
  set tt_real1=Damage/ Count
  call ForGroup(g,function Lod_SunStrike_Damage)
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",x,y))
  call KillGroup(g)
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  set g=null
  return false
endfunction

function Lod_SunStrike_Effect takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real Damage=100+75*GetUnitAbilityLevel(Hero,'Z601')
  local string s=""
  if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Hero)) or(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2))then
    set s="Abilities\\Spells\\Items\\VampiricPotion\\VampPotionCaster.mdl"
  endif
  call TimedReveal(GetOwningPlayer(Hero),5.7,x,y,400)
  call TriggerRegisterTimerEvent(t,1.7,false)
  call TriggerAddCondition(t,Condition(function Lod_SunStrike_Land))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveReal(hashtable019,(Cache),(20),((Damage)*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffect(s,x,y)))
  //call RemoveLocation(l)
  set t=null
  set Hero=null
  //set l=null
endfunction

function Lod_SunStrike takes nothing returns boolean
  if GetSpellAbilityId()=='Z601' then
    call Lod_SunStrike_Effect()
  endif
  return false
endfunction

function Lod_SunStrike_Register takes nothing returns nothing
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function Lod_SunStrike))
  //set t=null
endfunction

function LodInvoker_InitAll takes nothing returns nothing
  call Lod_SunStrike_Register()
  call Lod_ChaosMeteor_Register()
  call Lod_ForgeSpirit_Register()
  call Lod_ColdSnap_Register()
  call Lod_GhostWalk_Register()
  call Lod_IceWall_Register()
  call Lod_Alacrity_Register()
  call Lod_Tornado_Register()
  call Lod_EMP_Register()
  call Lod_DeafeningBlast_Register()
endfunction



function MyTrueshotTargets takes nothing returns boolean
  local unit t=GetFilterUnit()
  local integer dmg=0
  local integer h=GetHandleId(t)
  local integer key=344691
  local boolean b=false//is unit had effect of trueshot?
  if IsUnitAlly(t,TrueshotPlayer) and IsDead(t)==false then
    if LoadBoolean(hashtable019,h,key)==true then//was affected?
      set dmg=LoadInteger(hashtable019,h,key)
      set b=true//yes
    endif
    if IsUnitType(t,UNIT_TYPE_HERO)==true then
      if IsUnitType(t,UNIT_TYPE_RANGED_ATTACKER)==IsUnitType(TrueshotBearer,UNIT_TYPE_RANGED_ATTACKER) then//if its melee or ranged units
        if b or GetUnitAbilityLevel(t,LoDBuff_BuffID[6])>0 then//already had bonus
          if TrueshotAlive then//trax is alive - add bonus and store it
            if dmg!=TrueshotDmg then
              
              call LoDStat_Sub(t,dmg,"damage")
              call SaveInteger(hashtable019,h,key,TrueshotDmg)
              call LoDStat_Add(t,TrueshotDmg,"damage")
            endif
          else//trax is dead, remove buff and bonus
            call Buff_Remove(t,LoDBuff_BuffID[6])
            call LoDStat_Sub(t,dmg,"damage")
            call SaveInteger(hashtable019,h,key,0)
            call SaveBoolean(hashtable019,h,key,false)
          endif
        else//first time or new unit
          if TrueshotAlive then
            call SaveInteger(hashtable019,h,key,TrueshotDmg)
            call SaveBoolean(hashtable019,h,key,true)
            call LoDStat_Add(t,TrueshotDmg,"damage")
            call Buff_Add(t,LoDBuff_AbilID[6],LoDBuff_BuffID[6],-1)
          endif
        endif
      else//if types are different, but maybe it morph ability, so lets check was it affected
        if b then//it was, remove bonus
          call LoDStat_Sub(t,dmg,"damage")//remove old
          call SaveInteger(hashtable019,h,key,0)
          call SaveBoolean(hashtable019,h,key,false)
          call Buff_Remove(t,LoDBuff_BuffID[6])
        endif
      endif
    else
      if IsUnitType(t,UNIT_TYPE_RANGED_ATTACKER) and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false then
        if b then//was affected
          if TrueshotAlive and LoadInteger(hashtable019,GetHandleId(TrueshotBearer),344692)==1 then
            if dmg!=TrueshotDmg then
              call SaveInteger(hashtable019,h,key,TrueshotDmg)
              call LoDStat_Sub(t,dmg,"damage")
              call LoDStat_Add(t,TrueshotDmg,"damage")
            endif
          else
            call Buff_Remove(t,LoDBuff_BuffID[6])
            call LoDStat_Sub(t,dmg,"damage")
            call SaveInteger(hashtable019,h,key,0)
            call SaveBoolean(hashtable019,h,key,false)
          endif
        else//wasnt affected
          if TrueshotAlive and LoadInteger(hashtable019,GetHandleId(TrueshotBearer),344692)==1 then
            call SaveInteger(hashtable019,h,key,TrueshotDmg)
            call SaveBoolean(hashtable019,h,key,true)
            call LoDStat_Add(t,TrueshotDmg,"damage")
            call Buff_Add(t,LoDBuff_AbilID[6],LoDBuff_BuffID[6],-1)
          endif
        endif
      endif
    endif
  endif
  set t=null
  return false
endfunction

function MyTrueshotDuration takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local boolean Destroy=LoadBoolean(hashtable019,h,0)
  local integer lvl=GetUnitAbilityLevel(u,'A2O2')+GetUnitAbilityLevel(u,'QP1R')
  local integer i=GetUnitPrimaryAttribute(u)
  local integer dmg=0
  local integer stat=0
  //local unit dummy=LoadUnitHandle(HY,h,1)
  local integer auralvl=LoadInteger(hashtable019,GetHandleId(u),344692)
  if i==3 then
    set stat=IMaxIF(GetHeroStr(u,true),0)
  elseif i==2 then
    set stat=IMaxIF(GetHeroAgi(u,true),0)
  elseif i==1 then
    set stat=IMaxIF(GetHeroInt(u,true),0)
  endif
  set dmg=R2I((0.12+0.06*lvl)*stat)
  set TrueshotBearer=u
  set TrueshotPlayer=GetOwningPlayer(u)
  set TrueshotDmg=dmg
  set TrueshotAlive=true
  if IsDead(u)then
    set TrueshotDmg=0
    set TrueshotAlive=false
  endif
  
  call GroupEnumUnitsInRange(g_TrueshotGroup,0,0,12000,Condition(function MyTrueshotTargets))
  if (u==null) or GetUnitTypeId(u)<1 then
    call SaveBoolean(hashtable019,h,0,true)
  endif
  if Destroy then
    call FlushChildHashtable(hashtable019,h)
    call DestroyTimer(t)
  endif
  set TrueshotDmg=0
  set t=null
  set u=null
  //set dummy=null
endfunction

function MyTrueshot takes nothing returns nothing
  local unit u=GetTriggerUnit()//trax
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  //local unit dummy=CreateUnit(GetOwningPlayer(u),'e01V',0,0,0)
  //call UnitAddAbility(dummy,'A30W')
  call TimerStart(t,0.75,true,function MyTrueshotDuration)
  call SaveUnitHandle(hashtable019,h,0,u)
  //call SaveUnitHandle(HY,h,1,dummy)
  set t=null
  //set dummy=null
  set u=null
endfunction

function Drow_Trueshot_Toggling takes nothing returns nothing
  call AddTimedKeyToUnit(GetTriggerUnit(),344692,30)
endfunction


function Traxex_Gust_PushDur takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=LoadUnitHandle(hashtable019,h,2)
  local unit target=LoadUnitHandle(hashtable019,h,17)
  local real angle=LoadReal(hashtable019,h,13)
  local real dist=LoadReal(hashtable019,h,138)
  local real pushdist=dist/10
  local real newX
  local real newY
  local integer c=GetTriggerEvalCount(t)
  if c>10 or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call KillTrees(GetUnitX(target),GetUnitY(target),100)
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  else
    set newX=SafeX50(GetUnitX(target)+pushdist*Cos(angle))
    set newY=SafeY50(GetUnitY(target)+pushdist*Sin(angle))
    call SetUnitX(target,newX)
    call SetUnitY(target,newY)
  endif
  set t=null
  set caster=null
  set target=null
  return false
endfunction

function Traxex_Gust_PushUnits takes unit dummy,unit target,unit caster,real x,real y returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local real angle=Atan2(GetUnitY(target)-GetUnitY(dummy),GetUnitX(target)-GetUnitX(dummy))
  local real dist=DistanceBetweenXY(x,y,GetUnitX(target),GetUnitY(target))
  local real pustdist=RMaxBJ(1,350*(1-dist/900))
  call SaveUnitHandle(hashtable019,h,2,caster)
  call SaveUnitHandle(hashtable019,h,17,target)
  call SaveReal(hashtable019,h,13,(angle*1.0))
  call SaveReal(hashtable019,h,138,(pustdist*1.0))
  //call Traxex_Gust_ApplySilence(target,GetUnitAbilityLevel(caster,'A2WF'))
  call TriggerRegisterTimerEvent(t,0.02,true)
  call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Traxex_Gust_PushDur))
  set t=null
endfunction

function Traxex_Gust_ForGroup takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),Traxex_Gust_TempGroup)==false and IsMagicImmune(GetEnumUnit())==false then
    call GroupAddUnit(Traxex_Gust_TempGroup,GetEnumUnit())
    call Traxex_Gust_PushUnits(tt_unit1,GetEnumUnit(),Traxex_Gust_Tempunit,Traxex_Gust_TempX,Traxex_Gust_TempY)
  endif
endfunction

function Traxex_Gust_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=LoadUnitHandle(hashtable019,h,2)
  local unit dummy=LoadUnitHandle(hashtable019,h,19)
  local real angle=LoadReal(hashtable019,h,137)
  local real casterX=LoadReal(hashtable019,h,64)
  local real casterY=LoadReal(hashtable019,h,65)
  local real targetX=LoadReal(hashtable019,h,66)
  local real targetY=LoadReal(hashtable019,h,67)
  local group g=LoadGroupHandle(hashtable019,h,22)
  local real dummyX=GetUnitX(dummy)
  local real dummyY=GetUnitY(dummy)
  local group gg
  local unit dummysilencer=LoadUnitHandle(hashtable019,h,0)
  if DistanceBetweenXY(dummyX,dummyY,targetX,targetY)<100 then
    set dummyX=targetX
    set dummyY=targetY
  else
    set dummyX=dummyX+40*Cos(angle)
    set dummyY=dummyY+40*Sin(angle)
  endif
  set dummyX=SafeX50(dummyX)
  set dummyY=SafeY50(dummyY)
  call SetUnitX(dummy,(dummyX))
  call SetUnitY(dummy,(dummyY))
  call IssuePointOrder(dummysilencer,"silence",dummyX,dummyY)
  call SetUnitX(dummysilencer,(dummyX))
  call SetUnitY(dummysilencer,(dummyY))
  set gg=GetAvailableGroup()
  set tt_unit1=dummy
  set Traxex_Gust_Tempunit=caster
  set Traxex_Gust_TempX=casterX
  set Traxex_Gust_TempY=casterY
  set Traxex_Gust_TempGroup=g
  call GroupEnumUnitsInRange(gg,dummyX,dummyY,275,Condition(function DefaultEnemyFilter))
  call ForGroup(gg,function Traxex_Gust_ForGroup)
  call KillGroup(gg)
  if(dummyX==targetX and dummyY==targetY)or GetTriggerEvalCount(t)>35 then
    set gg=GetAvailableGroup()
    set tt_unit1=dummy
    set Traxex_Gust_Tempunit=caster
    set Traxex_Gust_TempX=casterX
    set Traxex_Gust_TempY=casterY
    set Traxex_Gust_TempGroup=g
    call GroupEnumUnitsInRange(gg,dummyX,dummyY,275,Condition(function DefaultEnemyFilter))
    call ForGroup(gg,function Traxex_Gust_ForGroup)
    call KillGroup(gg)
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
    call KillUnit(dummy)
    call KillGroup(g)
  endif
  set dummysilencer=null
  set t=null
  set dummy=null
  set g=null
  set gg=null
  set caster=null
  return false
endfunction

function Traxex_Gust_Start takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local location l=GetSpellTargetLoc()
  local unit u=GetTriggerUnit()
  local real x=GetLocationX(l)
  local real y=GetLocationY(l)
  local real angle=Atan2(y-GetUnitY(u),x-GetUnitX(u))
  local unit d=CreateUnit(GetOwningPlayer(u),'h02J',GetUnitX(u),GetUnitY(u),angle*bj_RADTODEG)//use Basilius dummy
  local unit dummysilencer=CreateUnit(GetOwningPlayer(u),'e00E',GetUnitX(u),GetUnitY(u),0)
  call UnitAddAbility(dummysilencer,'A0QB')
  call SetUnitAbilityLevel(dummysilencer,'A0QB',GetUnitAbilityLevel(u,GetSpellAbilityId()))
  call TriggerRegisterTimerEvent(t,0.02,true)
  call TriggerAddCondition(t,Condition(function Traxex_Gust_Duration))
  call SaveUnitHandle(hashtable019,h,2,u)
  call SaveUnitHandle(hashtable019,h,19,d)
  call SaveUnitHandle(hashtable019,h,0,dummysilencer)
  call SaveReal(hashtable019,h,137,(angle*1.0))
  call SaveReal(hashtable019,h,64,(GetUnitX(u)*1.0))
  call SaveReal(hashtable019,h,65,(GetUnitY(u)*1.0))
  call SaveReal(hashtable019,h,66,((GetUnitX(u)+900*Cos(angle))*1.0))
  call SaveReal(hashtable019,h,67,((GetUnitY(u)+900*Sin(angle))*1.0))
  call SaveGroupHandle(hashtable019,h,22,GetAvailableGroup())
  call RemoveLocation(l)
  set t=null
  set dummysilencer=null
  set l=null
  set d=null
  set u=null
endfunction

function Trax_Marksmanship_Targets takes nothing returns nothing
  local unit t = GetFilterUnit()
  local unit u = group_temp_unit[0]
  
  if group_temp_boolean and IsUnitType(t,UNIT_TYPE_HERO) and IsUnitEnemy(u,GetOwningPlayer(t)) and IsDead(t)==false and GetUnitAbilityLevel(t,'A04R')==0 and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false then
    set group_temp_boolean = false
  endif
  
  set t = null
  set u = null
endfunction

function Trax_Marksmanship_Duration takes nothing returns nothing
  local integer level
  local timer t = GetExpiredTimer()
  local integer id='QF89'
  
  set group_temp_unit[0] = LoadUnitHandle(hashtable019,GetHandleId(t),0)
  set group_temp_boolean = true
  if GetUnitAbilityLevel(group_temp_unit[0],'A0VC')>0 then
    set id='A0VC'
  endif
  if GetUnitAbilityLevel(group_temp_unit[0],id)< GetUnitAbilityLevel(group_temp_unit[0],'QF88') then
    call SetUnitAbilityLevel(group_temp_unit[0],id,GetUnitAbilityLevel(group_temp_unit[0],'QF88'))
  endif
  call GroupEnumUnitsInRange(temp_group,GetWidgetX(group_temp_unit[0]),GetWidgetY(group_temp_unit[0]),400+25,Condition(function Trax_Marksmanship_Targets))
  
  if group_temp_boolean or LoadBoolean(hashtable019,GetHandleId(group_temp_unit[0]),4336821) then
    set level = GetUnitAbilityLevel(group_temp_unit[0],'QF88')
    
    if GetUnitAbilityLevel(group_temp_unit[0],'A2NX')!=level then
      call UnitAddAbility2(group_temp_unit[0],'A2NX')
      call SetUnitAbilityLevel(group_temp_unit[0],'A2NX',level)
      if (GetUnitPrimaryAttribute(group_temp_unit[0])!=2)then
        call UnitAddAbility2(group_temp_unit[0],'A33L')
        call SetUnitAbilityLevel(group_temp_unit[0],'A33L',level)
      else
        call UnitRemoveAbility(group_temp_unit[0],'A33L')
      endif
    endif
    
    set t = null
    return
  endif
  
  call UnitRemoveAbility(group_temp_unit[0],'A2NX')
  call UnitRemoveAbility(group_temp_unit[0],'A33L')
  set t = null
endfunction

function MARKSMANSHIP_EFFECT_END takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local unit u=LoadUnitHandle(hashtable019,GetHandleId(t),0)
  call SaveBoolean(hashtable019,GetHandleId(u),4336821,false)
  call DestroyEffect(LoadEffectHandle(hashtable019,GetHandleId(t),1))
  call DestroyEffect(LoadEffectHandle(hashtable019,GetHandleId(t),2))
  call FlushChildHashtable(hashtable019,GetHandleId(t))
  call UnitRemoveAbility(u,'QF86')
  call UnitRemoveAbility(u,'DF86')
  call DestroyTimer(t)
  set u=null
  set t=null
endfunction

function MARKSMANSHIP_EFFECT takes nothing returns boolean
  local timer t
  if GetSpellAbilityId()=='QF89' then
    set t=CreateTimer()
    call SaveBoolean(hashtable019,GetHandleId(GetTriggerUnit()),4336821,true)
    call TimerStart(t,6,false,function MARKSMANSHIP_EFFECT_END)
    call SaveUnitHandle(hashtable019,GetHandleId(t),0,GetTriggerUnit())
    call SaveEffectHandle(hashtable019,GetHandleId(t),1,AddSpecialEffectTarget("Abilities\\Weapons\\ProcMissile\\ProcMissile.mdl",GetTriggerUnit(),"left hand"))
    call SaveEffectHandle(hashtable019,GetHandleId(t),2,AddSpecialEffectTarget("Abilities\\Weapons\\ProcMissile\\ProcMissile.mdl",GetTriggerUnit(),"right hand"))
    call UnitAddAbility(GetTriggerUnit(),'QF86')
    set t=null
  endif
  
  return false
endfunction

function MARKSMANSHIP_EFFECT_sup takes nothing returns nothing
  local timer t=CreateTimer()
  call SaveBoolean(hashtable019,GetHandleId(GetTriggerUnit()),4336821,true)
  call TimerStart(t,6,false,function MARKSMANSHIP_EFFECT_END)
  call SaveUnitHandle(hashtable019,GetHandleId(t),0,GetTriggerUnit())
  call SaveEffectHandle(hashtable019,GetHandleId(t),1,AddSpecialEffectTarget("Abilities\\Weapons\\ProcMissile\\ProcMissile.mdl",GetTriggerUnit(),"left hand"))
  call SaveEffectHandle(hashtable019,GetHandleId(t),2,AddSpecialEffectTarget("Abilities\\Weapons\\ProcMissile\\ProcMissile.mdl",GetTriggerUnit(),"right hand"))
  call UnitAddAbility(GetTriggerUnit(),'QF86')
  set t=null
endfunction

function Trax_Marksmanship_learn takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local timer t = CreateTimer()
  local integer id='A0VC'
  //local trigger tt
  local integer pid=GetPlayerId(GetOwningPlayer(u))
  if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==true or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+1]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+2]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+3]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+4]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+5]],"melee morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+6]],"melee morph",null) then
    set id='QF89'
  endif
  
  call UnitAddAbility2(u,id)
  call SetUnitAbilityLevel(u,id,GetUnitAbilityLevel(u,'QF88'))
  //
  //local unit u = GetTriggerUnit()
  
  call SaveUnitHandle(hashtable019,GetHandleId(t),0,u)
  call SaveBoolean(hashtable019,GetHandleId(u),4336821,false)
  call TimerStart(t,0.1,true,function Trax_Marksmanship_Duration)
  //set tt=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(tt,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(tt,Condition(function MARKSMANSHIP_EFFECT))
  set t = null
  set u = null
  //set tt=null
endfunction







function YBF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real Damage
  if Level==1 then
    set Damage=15
  elseif Level==2 then
    set Damage=30
  elseif Level==3 then
    set Damage=40
  elseif Level==4 then
    set Damage=50
  endif
  if GetTriggerEvalCount(t)==3 or GetTriggerEvalCount(t)==4 then
    call DamageTarget(Source,Target,1,Damage)
  endif
  if GetTriggerEvalCount(t)==4 then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call UnitRemoveAbility(Target,'A1VS')
    call UnitRemoveAbility(Target,'B0DN')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function YCF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=GetUnitAbilityLevel(Source,'AHtb')
  if Level<1 then
    set Level=GetUnitAbilityLevel(Source,'QB0H')
  endif
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetEventDamageSource()==Source and GetEventDamage()==0 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function YBF))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveInteger(hashtable019,(Cache),(5),(Level))
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl",Target,"chest")))
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A1VS',false)
    call UnitAddAbility2(Target,'A1VS')
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Y3F takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real d=DistanceBetweenUnits(Source,Target)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(t,6,false)
  call TriggerAddCondition(t,Condition(function YCF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  set t=null
  set Source=null
  set Target=null
endfunction

function SkeletonKing_HellfireBlast_OnCast takes nothing returns nothing
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIfb\\AIfbSpecialArt.mdl",GetTriggerUnit(),GetProperAttachPoint_Weapon(GetTriggerUnit())))
  //call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIfb\\AIfbSpecialArt.mdl",GetTriggerUnit(),"hand"))
endfunction

function SkeletonKing_HellfireBlast takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call Y3F()
  endif
endfunction

function LifestealAuraRanged takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local unit target=LoadUnitHandle(hashtable019,h,1)
  local integer lvl
  local real percent
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==u and IsFakeDamage==false and GetEventDamage()<6000 and GetEventDamage()>5 then
      if GetUnitAbilityLevel(u,'BVA1')>0 or GetUnitAbilityLevel(u,'BVA2')>0 or GetUnitAbilityLevel(u,'BVA3')>0 or GetUnitAbilityLevel(u,'BVA4')>0 then
        set lvl=GetUnitAbilityLevel(u,'BVA1')+GetUnitAbilityLevel(u,'BVA2')*2+GetUnitAbilityLevel(u,'BVA3')*3+GetUnitAbilityLevel(u,'BVA4')*4
        set percent=0.1+0.05*lvl
        call SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_LIFE)+GetEventDamage()*percent)
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl",GetEventDamageSource(),"origin"))
      endif
      call FlushChildHashtable(hashtable019,h)
      call CleanTrigger(t)
      
    endif
  else
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  endif
  set t=null
  set u=null
  set target=null
endfunction

function CustomLifestealAura takes nothing returns nothing 
  local trigger t 
  local integer h
  if IsUnitIllusion(GetTriggerUnit())==false and IsMagicImmune(GetTriggerUnit())==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))==false and (GetUnitAbilityLevel(GetAttacker(),'BVA1')>0 or GetUnitAbilityLevel(GetAttacker(),'BVA2')>0 or GetUnitAbilityLevel(GetAttacker(),'BVA3')>0 or GetUnitAbilityLevel(GetAttacker(),'BVA4')>0) then
    call FlushChildHashtable(hashtable019,GetHandleId(LoadTriggerHandle(hashtable019,GetHandleId(GetAttacker()),'CSLS')))
    call DestroyTrigger(LoadTriggerHandle(hashtable019,GetHandleId(GetAttacker()),'CSLS'))
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call SaveUnitHandle(hashtable019,h,0,GetAttacker())
    call SaveUnitHandle(hashtable019,h,1,GetTriggerUnit())
    call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
    call TriggerRegisterTimerEvent(t,4,false)
    call SaveTriggerHandle(hashtable019,GetHandleId(GetAttacker()),'CSLS',t)
    call TriggerAddCondition(t,Condition(function LifestealAuraRanged))
    set t=null
  endif
endfunction

function Y1F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  
  call SelectUnitForPlayerSingle(Source,GetOwningPlayer(Source))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  
  set Cache = GetHandleId(Source)
  
  if LoadBoolean(MHT,Cache,StringHash("morphedburn")) then
    //call Transform_Movement(Source,'A2NE',GetUnitTypeId(Source))
    call UnMorphUnit(Source,LoadInteger(MHT,Cache,StringHash("second")))
    call UnMorphUnit(Source,LoadInteger(MHT,Cache,StringHash("first")))
    call SaveBoolean(MHT,Cache,StringHash("morphedburn"),false)
  endif
  
  
  set t=null
  set Source=null
  return false
endfunction

function Y0F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=GetUnitAbilityLevel(Source,'A01Y')
  local unit Caster
  if SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(Source))*PlayerSkillOffset+4]]=='A01Y' then
    if TimerGetRemaining(PrimaryUltiCooldownTimer[GetPlayerId(GetOwningPlayer(Source))])==0 and GetUnitState(Source,UNIT_STATE_MANA)>=140 then
      call TimerStart(PrimaryUltiCooldownTimer[GetPlayerId(GetOwningPlayer(Source))],360-100*Level,false,null)
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
      call UnitAddAbility(Caster,'A274')
      call IssueImmediateOrderById(Caster,852096)
      set Caster=null
      call TriggerRegisterTimerEvent(t,3+.01,false)
      call TriggerAddCondition(t,Condition(function Y1F))
      call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    endif
  else
    if TimerGetRemaining(SecondaryUltiCooldownTimer[GetPlayerId(GetOwningPlayer(Source))])==0 and GetUnitState(Source,UNIT_STATE_MANA)>=140 then
      call TimerStart(SecondaryUltiCooldownTimer[GetPlayerId(GetOwningPlayer(Source))],360-100*Level,false,null)
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
      call UnitAddAbility(Caster,'A274')
      call IssueImmediateOrderById(Caster,852096)
      set Caster=null
      call TriggerRegisterTimerEvent(t,3+.01,false)
      call TriggerAddCondition(t,Condition(function Y1F))
      call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    endif
  endif
  set t=null
  set Source=null
  return false
endfunction

function Leoric_Reincarnation_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerAddCondition(t,Condition(function Y0F))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=null
  set Source=null
endfunction

function Y2F takes nothing returns boolean
  if GetLearnedSkill()=='A01Y' and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call Leoric_Reincarnation_Learn()
  endif
  return false
endfunction

function SZ9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Y2F))
  set t=null
endfunction

function SkeletonKing_MortalStrike_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=LoadUnitHandle(hashtable019,h,2)
  local unit target=LoadUnitHandle(hashtable019,h,17)
  local integer lvl=GetUnitAbilityLevel(caster,'A2S0')
  local real StolenHPCounter=LoadReal(hashtable019,h,797)
  local real StolenHPCounterTarget=LoadReal(hashtable019,h,798)
  if GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call SaveInteger(hashtable019,GetHandleId(caster),4338,2)
    call SetPlayerAbilityAvailable(GetOwningPlayer(caster),'AOcr',true)
    call DestroyEffect(LoadEffectHandle(hashtable019,h,175))
    call DestroyEffect(LoadEffectHandle(hashtable019,h,176))
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  elseif StolenHPCounter>0 then
    call SaveInteger(hashtable019,GetHandleId(caster),4338,2)
    call SetPlayerAbilityAvailable(GetOwningPlayer(caster),'AOcr',true)
    call DestroyEffect(LoadEffectHandle(hashtable019,h,175))
    call DestroyEffect(LoadEffectHandle(hashtable019,h,176))
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
    if IsDead(caster)==false then
      call SetUnitState(caster,UNIT_STATE_LIFE,RMaxIF(1,GetUnitState(caster,UNIT_STATE_LIFE)-StolenHPCounter))
    endif
    if IsDead(target)==false then
      call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+StolenHPCounterTarget)
    endif
  else
    set StolenHPCounter=GetUnitState(target,UNIT_STATE_MAX_LIFE)*0.2
    call SaveReal(hashtable019,h,798,StolenHPCounter*1.0)
    if IsUnitType(caster,UNIT_TYPE_HERO) then
      call SetUnitState(target,UNIT_STATE_LIFE,RMaxIF(1,GetUnitState(target,UNIT_STATE_LIFE)-StolenHPCounter))
    endif
    if StolenHPCounter+GetUnitState(caster,UNIT_STATE_LIFE)>GetUnitState(caster,UNIT_STATE_MAX_LIFE) then
      set StolenHPCounter=GetUnitState(caster,UNIT_STATE_MAX_LIFE)-GetUnitState(caster,UNIT_STATE_LIFE)
    endif
    if StolenHPCounter==0 then
      set StolenHPCounter=0.01
    endif
    call SetUnitState(caster,UNIT_STATE_LIFE,GetUnitState(caster,UNIT_STATE_LIFE)+StolenHPCounter)
    call SaveReal(hashtable019,h,797,StolenHPCounter*1.0)
  endif
  set t=null
  set caster=null
  set target=null
  return false
endfunction

function SkeletonKing_MortalStrike_Effect takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local unit caster=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  call TriggerRegisterTimerEvent(t,0.01,false)
  call TriggerRegisterTimerEvent(t,7,false)
  call TriggerRegisterDeathEvent(t,caster)
  call TriggerAddCondition(t,Condition(function SkeletonKing_MortalStrike_Duration))
  call SaveUnitHandle(hashtable019,h,2,caster)
  call SaveUnitHandle(hashtable019,h,17,target)
  call SaveReal(hashtable019,h,797,0)
  call SaveReal(hashtable019,h,798,0)
  call SaveEffectHandle(hashtable019,h,175,AddSpecialEffectTarget("war3mapImported\\MortalStrikeCaster.mdx",caster,"overhead"))
  call SaveEffectHandle(hashtable019,h,176,AddSpecialEffectTarget("war3mapImported\\MortalStrikeTarget.mdx",target,"overhead"))
  call SaveInteger(hashtable019,GetHandleId(caster),4338,1)
  call SetPlayerAbilityAvailable(GetOwningPlayer(caster),'AOcr',false)
  set t=null
  set caster=null
  set target=null
endfunction

function SkeletonKing_MortalStrike_AddCrit takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer lvl=GetUnitAbilityLevel(u,'A2S0')
  if lvl==1 and GetUnitAbilityLevel(u,'Q251')==0 then
    call UnitAddAbility(u,'Q251')
  endif
  call SetUnitAbilityLevel(u,'AOcr',lvl)
  set u=null
endfunction

function SkeletonKing_MortalStrike_Init takes nothing returns boolean
  //if GetTriggerEventId()==EVENT_PLAYER_HERO_SKILL then
  if GetLearnedSkill()=='A2S0' and IsUnitIllusion(GetTriggerUnit())==false then
    call SkeletonKing_MortalStrike_AddCrit()
  endif
  //else
  //	if GetSpellAbilityId()=='A2S0' then
  //		if IsBlocked(GetSpellTargetUnit())==false then
  //			call SkeletonKing_MortalStrike_Effect()
  //		endif
  //	endif
  //endif
  return false
endfunction

function SkeletonKing_MortalStrike_RegSup takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call SkeletonKing_MortalStrike_Effect()
  endif
endfunction

function SkeletonKing_MortalStrike_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function SkeletonKing_MortalStrike_Init))
  set t=null
endfunction

function Z4F takes unit whichUnit returns boolean
  return(GetUnitTypeId(whichUnit)==('H00I')or GetUnitTypeId(whichUnit)==('H00J')or GetUnitTypeId(whichUnit)==GetUnitTypeId(GetTriggerUnit()))and GetUnitState(whichUnit,UNIT_STATE_LIFE)>.5 and GetOwningPlayer(whichUnit)==GetOwningPlayer(GetTriggerUnit())
endfunction

function Z8F takes nothing returns boolean
  return Z4F(GetFilterUnit())
endfunction

function Z9F takes nothing returns nothing
  local unit YLD=GetEnumUnit()
  local real ZDF=YX8(YLD,Y3)
  if ZDF<TmpReal378 then
    set TmpReal378=ZDF
    set TmpUnit376=YLD
  endif
  set YLD=null
endfunction

function ZEF takes nothing returns boolean
  return(IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0)!=null
endfunction

function ZFF takes nothing returns nothing
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\ArcaneTowerAttack.mdl",GetEnumUnit(),"origin"))
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),1,TmpReal378)
endfunction

function Meepo_Poof takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local location unit049
  local real x
  local real y
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local group HQ9
  local boolexpr VH9
  local boolean ZHF=false
  if Target!=null and Z4F(Target)then
    set x=GetUnitX(Target)
    set y=GetUnitY(Target)
    set ZHF=true
  else
    set VH9=Condition(function Z8F)
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,0,0,999999,VH9)
    if Target!=null then
      set unit049=GetUnitLoc(Target)
    else
      set unit049=GetSpellTargetLoc()
    endif
    set TmpUnit376=FirstOfGroup(HQ9)
    if TmpUnit376!=null then
      set ZHF=true
      call GroupRemoveUnit(HQ9,TmpUnit376)
      set TmpReal378=YX8(TmpUnit376,unit049)
      set Y3=unit049
      call ForGroup(HQ9,function Z9F)
      set Target=TmpUnit376
      set x=GetUnitX(Target)
      set y=GetUnitY(Target)
    endif
    call KillGroup(HQ9)
    call RemoveLocation(unit049)
  endif
  if ZHF then
    call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\ToonBoom\\ToonBoom.mdl",SourceX,SourceY))
    call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\ToonBoom\\ToonBoom.mdl",x,y))
    call SetUnitX(Source,x)
    call SetUnitY(Source,y)
    set TmpReal378=60+GetUnitAbilityLevel(GetTriggerUnit(),('A0N8'))*40
    if Source==Target then
      //set TmpReal378=TmpReal378*1.5
    endif
    set VH9=Condition(function ZEF)
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,SourceX,SourceY,400,VH9)
    call ForGroup(HQ9,function ZFF)
    call KillGroup(HQ9)
    set HQ9=GetAvailableGroup()
    call GroupEnumUnitsInRange(HQ9,x,y,400,VH9)
    call ForGroup(HQ9,function ZFF)
    call KillGroup(HQ9)
  endif
  set HQ9=null
  set Source=null
  set Target=null
  set unit049=null
  set VH9=null
endfunction

function ZIF takes nothing returns boolean
  return GetSpellAbilityId()==('A0N8')
endfunction

function ZJF takes nothing returns nothing
  call SetUnitAnimationByIndex((LoadUnitHandle(hashtable019,(GetHandleId(GetExpiredTimer())),(221))),2)
endfunction

function ZKF takes nothing returns nothing
  local timer t=CreateTimer()
  //call SetUnitAnimationByIndex(GetTriggerUnit(),2)
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(221),(GetTriggerUnit()))
  call TimerStart(t,1,false,function ZJF)
  set t=null
endfunction

function Func1081 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CHANNEL)
  call TriggerAddCondition(t,Condition(function ZIF))
  call TriggerAddAction(t,function ZKF)
  set t=null
endfunction

function ZNF takes nothing returns boolean
  return(IsMagicImmune(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(TmpUnit376))and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(TmpUnit376)) and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.5 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and GetUnitTypeId(GetFilterUnit())!='n00L')!=null
endfunction

function ZOF takes nothing returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(TmpUnit376),'e00E',TmpReal378,Meepo_Earthbind_TempY,0)
  call UnitAddAbility2(Caster,'A0NC')
  call SetUnitAbilityLevel(Caster,'A0NC',GetUnitAbilityLevel(udg_Hero[GetPlayerId(GetOwningPlayer(TmpUnit376))],'A0NB'))
  call IssueTargetOrderById(Caster,852106,GetEnumUnit())
  call DamageTarget(udg_Hero[GetPlayerId(GetOwningPlayer(TmpUnit376))],GetEnumUnit(),1,75+25*GetUnitAbilityLevel(udg_Hero[GetPlayerId(GetOwningPlayer(TmpUnit376))],'A0NB'))
  set Caster=null
endfunction

function ZPF takes unit Projectile,real x,real y returns nothing
  local boolexpr VH9=Condition(function ZNF)
  local group HQ9=GetAvailableGroup()
  set TmpUnit376=Projectile
  call GroupEnumUnitsInRange(HQ9,x,y,325,VH9)
  set TmpReal378=x
  set Meepo_Earthbind_TempY=y
  call ForGroup(HQ9,function ZOF)
  call KillGroup(HQ9)
  set HQ9=null
  set VH9=null
endfunction

function ZQF takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer Cache=GetHandleId(t)
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real SourceX=GetUnitX(Projectile)
  local real SourceY=GetUnitY(Projectile)
  local real AO8=GetUnitX(Projectile)+30*Cos(J2E)
  local real AP8=GetUnitY(Projectile)+30*Sin(J2E)
  if(AO8-TargetX)*(AO8-TargetX)+(AP8-TargetY)*(AP8-TargetY)<1200 then
    call SetUnitX(Projectile,TargetX)
    call SetUnitY(Projectile,TargetY)
    call ZPF(Projectile,TargetX,TargetY)
    call PauseTimer(t)
    call FlushChildHashtable(hashtable019,(Cache))
    call KillUnit(Projectile)
    call DestroyTimer(t)
  else
    call SetUnitX(Projectile,AO8)
    call SetUnitY(Projectile,AP8)
  endif
  set t=null
  set Projectile=null
endfunction

function Meepo_Earthbind takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  //local location PKE=GetSpellTargetLoc()
  local real TargetX=SafeX50(GetSpellTargetX())
  local real TargetY=SafeY50(GetSpellTargetY())
  local real SourceX=SafeX50(GetUnitX(Hero))
  local real SourceY=SafeY50(GetUnitY(Hero))
  local unit Projectile=CreateUnit(GetOwningPlayer(Hero),('h00C'),SourceX,SourceY,0)
  local real J2E=Atan2(TargetY-SourceY,TargetX-SourceX)
  local timer t=CreateTimer()
  local integer Cache=GetHandleId(t)
  call SetUnitScale(Projectile,2,2,2)
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
  call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call TimerStart(t,.035,true,function ZQF)
  //call RemoveLocation(PKE)
  //set PKE=null
  set Hero=null
  set Projectile=null
  set t=null
endfunction

function ZSF takes unit u returns boolean
  return GetUnitTypeId(u)=='H00I' or GetUnitTypeId(u)=='H00J'
endfunction

function ZTF takes unit whichUnit returns boolean
  return GetUnitTypeId(whichUnit)==('H00I')or GetUnitTypeId(whichUnit)==('H00J')
endfunction

function DoubleTrouble_IsKoboldCondition takes nothing returns boolean
  return GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(TmpUnit376)and GetFilterUnit()!=TmpUnit376 and(GetUnitTypeId(GetFilterUnit())==('H00I')or GetUnitTypeId(GetFilterUnit())==('H00J'))
endfunction

function DoubleTrouble_UnshareXPCondition takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(TmpUnit376)) and ZTF(GetFilterUnit())==false)!=null
endfunction

function DoubleTrouble_UnshareXPGive takes nothing returns nothing
  call AddHeroXP(GetEnumUnit(),TmpInt377,true)
endfunction

function ZUF takes nothing returns nothing
  local integer ZVF=GetHandleId(GetTriggeringTrigger())
  local player p=(LoadPlayerHandle(hashtable019,(ZVF),(370)))
  local integer ZWF=GetHandleId(p)
  local unit JJ9=(LoadUnitHandle(hashtable019,(ZWF),(699)))
  local unit JK9=(LoadUnitHandle(hashtable019,(ZWF),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(ZWF),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(ZWF),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(ZWF),(703)))
  local integer ZXF=GetUnitAbilityLevel(JJ9,'Aamk')*2
  local integer BUE=GetHeroAgi(JJ9,false)
  local integer ZYF=GetHeroAgi(JJ9,true)-BUE-ZXF
  local integer BVE=GetHeroStr(JJ9,false)
  local integer ZZF=GetHeroStr(JJ9,true)-BVE-ZXF
  local integer ZAF=GetHeroInt(JJ9,false)
  local integer ZBF=GetHeroInt(JJ9,true)-ZAF-ZXF
  local real ZCF=.25
  local integer Z3F=R2I(BUE+ZYF*ZCF)
  local integer Z6F=R2I(BVE+ZZF*ZCF)
  local integer ZLF=R2I(ZAF+ZBF*ZCF)
  if GetUnitState(JJ9,UNIT_STATE_LIFE)>1 then
    if JK9!=null then
      call SetHeroAgi(JK9,Z3F,false)
      call SetHeroStr(JK9,Z6F,false)
      call SetHeroInt(JK9,ZLF,false)
    endif
    if JM9!=null then
      call SetHeroAgi(JM9,Z3F,false)
      call SetHeroStr(JM9,Z6F,false)
      call SetHeroInt(JM9,ZLF,false)
    endif
    if JN9!=null then
      call SetHeroAgi(JN9,Z3F,false)
      call SetHeroStr(JN9,Z6F,false)
      call SetHeroInt(JN9,ZLF,false)
    endif
    if JO9!=null then
      call SetHeroAgi(JO9,Z3F,false)
      call SetHeroStr(JO9,Z6F,false)
      call SetHeroInt(JO9,ZLF,false)
    endif
  endif
  set p=null
  set JJ9=null
  set JK9=null
  set JM9=null
  set JN9=null
  set JO9=null
endfunction

function Z1F takes nothing returns nothing
  local integer ZVF=GetHandleId(GetTriggeringTrigger())
  local player p=(LoadPlayerHandle(hashtable019,(ZVF),(370)))
  local integer ZWF=GetHandleId(p)
  local unit JJ9=(LoadUnitHandle(hashtable019,(ZWF),(699)))
  local unit JK9=(LoadUnitHandle(hashtable019,(ZWF),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(ZWF),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(ZWF),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(ZWF),(703)))
  local integer Z0F=GetHandleId(JJ9)
  local integer Z5F=GetHandleId(JK9)
  local integer Z2F=GetHandleId(JM9)
  local integer A4F=GetHandleId(JN9)
  local integer A7F=GetHandleId(JO9)
  local integer A8F=(LoadInteger(hashtable019,(Z0F),(367)))
  local integer A9F=(LoadInteger(hashtable019,(Z0F),(368)))
  local integer ADF=(LoadInteger(hashtable019,(Z5F),(367)))
  local integer AEF=(LoadInteger(hashtable019,(Z5F),(368)))
  local integer AFF=(LoadInteger(hashtable019,(Z2F),(367)))
  local integer AGF=(LoadInteger(hashtable019,(Z2F),(368)))
  local integer AHF=(LoadInteger(hashtable019,(A4F),(367)))
  local integer AIF=(LoadInteger(hashtable019,(A4F),(368)))
  local integer AJF=(LoadInteger(hashtable019,(A7F),(367)))
  local integer AKF=(LoadInteger(hashtable019,(A7F),(368)))
  local integer AMF=GetHeroXP(JJ9)
  local integer ANF=GetHeroXP(JK9)
  local integer AOF=GetHeroXP(JM9)
  local integer APF=GetHeroXP(JN9)
  local integer AQF=GetHeroXP(JO9)
  local integer ARF=AMF-A8F-A9F
  local integer ASF=ANF-ADF-AEF
  local integer ATF=AOF-AFF-AGF
  local integer AUF=APF-AHF-AIF
  local integer AVF=AQF-AJF-AKF
  if GetUnitState(JJ9,UNIT_STATE_LIFE)>1 then
    set A8F=A8F+ARF
    set ADF=ADF+ASF
    set AFF=AFF+ATF
    set AHF=AHF+AUF
    set AJF=AJF+AVF
    if JJ9!=null then
      call AddHeroXP(JK9,ARF,false)
      if GetHeroXP(JK9)!=ANF then
        set AEF=AEF+ARF
      endif
      call AddHeroXP(JM9,ARF,false)
      if GetHeroXP(JM9)!=AOF then
        set AGF=AGF+ARF
      endif
      call AddHeroXP(JN9,ARF,false)
      if GetHeroXP(JN9)!=APF then
        set AIF=AIF+ARF
      endif
      call AddHeroXP(JO9,ARF,false)
      if GetHeroXP(JO9)!=AQF then
        set AKF=AKF+ARF
      endif
    endif
    if JK9!=null then
      call AddHeroXP(JJ9,ASF,false)
      if GetHeroXP(JJ9)!=AMF then
        set A9F=A9F+ASF
      endif
      call AddHeroXP(JM9,ASF,false)
      if GetHeroXP(JM9)!=AOF then
        set AGF=AGF+ASF
      endif
      call AddHeroXP(JN9,ASF,false)
      if GetHeroXP(JN9)!=APF then
        set AIF=AIF+ASF
      endif
      call AddHeroXP(JO9,ASF,false)
      if GetHeroXP(JO9)!=AQF then
        set AKF=AKF+ASF
      endif
    endif
    if JM9!=null then
      call AddHeroXP(JK9,ATF,false)
      if GetHeroXP(JK9)!=ANF then
        set AEF=AEF+ATF
      endif
      call AddHeroXP(JJ9,ATF,false)
      if GetHeroXP(JJ9)!=AMF then
        set A9F=A9F+ATF
      endif
      call AddHeroXP(JN9,ATF,false)
      if GetHeroXP(JN9)!=APF then
        set AIF=AIF+ATF
      endif
      call AddHeroXP(JO9,ATF,false)
      if GetHeroXP(JO9)!=AQF then
        set AKF=AKF+ATF
      endif
    endif
    if JN9!=null then
      call AddHeroXP(JK9,AUF,false)
      if GetHeroXP(JK9)!=ANF then
        set AEF=AEF+AUF
      endif
      call AddHeroXP(JM9,AUF,false)
      if GetHeroXP(JM9)!=AOF then
        set AGF=AGF+AUF
      endif
      call AddHeroXP(JJ9,AUF,false)
      if GetHeroXP(JJ9)!=AMF then
        set A9F=A9F+AUF
      endif
      call AddHeroXP(JO9,AUF,false)
      if GetHeroXP(JO9)!=AQF then
        set AKF=AKF+AUF
      endif
    endif
    if JO9!=null then
      call AddHeroXP(JK9,AVF,false)
      if GetHeroXP(JK9)!=ANF then
        set AEF=AEF+AVF
      endif
      call AddHeroXP(JM9,AVF,false)
      if GetHeroXP(JM9)!=AOF then
        set AGF=AGF+AVF
      endif
      call AddHeroXP(JJ9,AVF,false)
      if GetHeroXP(JJ9)!=AMF then
        set A9F=A9F+AVF
      endif
      call AddHeroXP(JN9,AVF,false)
      if GetHeroXP(JN9)!=APF then
        set AIF=AIF+AVF
      endif
    endif
    call SaveInteger(hashtable019,(Z0F),(367),(A8F))
    call SaveInteger(hashtable019,(Z0F),(368),(A9F))
    call SaveInteger(hashtable019,(Z5F),(367),(ADF))
    call SaveInteger(hashtable019,(Z5F),(368),(AEF))
    call SaveInteger(hashtable019,(Z2F),(367),(AFF))
    call SaveInteger(hashtable019,(Z2F),(368),(AGF))
    call SaveInteger(hashtable019,(A4F),(367),(AHF))
    call SaveInteger(hashtable019,(A4F),(368),(AIF))
    call SaveInteger(hashtable019,(A7F),(367),(AJF))
    call SaveInteger(hashtable019,(A7F),(368),(AKF))
  endif
  set p=null
  set JJ9=null
  set JK9=null
  set JM9=null
  set JN9=null
  set JO9=null
endfunction

function AWF takes nothing returns boolean
  return ZTF(GetTriggerUnit())and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function AXF takes nothing returns nothing
  local unit CE8=GetTriggerUnit()
  local integer Cache=GetHandleId(GetOwningPlayer(CE8))
  local unit JJ9=(LoadUnitHandle(hashtable019,(Cache),(699)))
  local unit JK9=(LoadUnitHandle(hashtable019,(Cache),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(Cache),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(Cache),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(Cache),(703)))
  local boolean WS9=false
  call DisableTrigger(QF)
  if JJ9!=null and JJ9!=CE8 then
    call KillUnit(JJ9)
  endif
  if JK9!=null and JK9!=CE8 then
    call KillUnit(JK9)
  endif
  if JM9!=null and JM9!=CE8 then
    call KillUnit(JM9)
  endif
  if JN9!=null and JN9!=CE8 then
    call KillUnit(JN9)
  endif
  if JO9!=null and JO9!=CE8 then
    call KillUnit(JO9)
  endif
  call EnableTrigger(QF)
  set CE8=null
  set JJ9=null
  set JK9=null
  set JM9=null
  set JN9=null
  set JO9=null
endfunction

function AYF takes nothing returns boolean
  return ZTF(GetTriggerUnit())and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function AZF takes unit NewHero,unit Hero returns nothing
  local trigger t=(LoadTriggerHandle(hashtable019,(GetHandleId(GetOwningPlayer(Hero))),(369)))
  local integer i=0
  local boolean ABF=false
  local boolean ACF=false
  local boolean A3F=false
  local boolean A6F=false
  local boolean ALF=false
  local boolean A1F=false
  local boolean A0F=false
  local boolean A5F=false
  local boolean A2F=false
  call DisableTrigger(t)
  call DisableTrigger(t_manipulateitem)
  loop
    exitwhen i>5
    if GetItemTypeId(UnitItemInSlot(Hero,i))==(Item_Real[indexid_BootsOfSpeed])then
      set ABF=true
    endif
    if (GetItemTypeId(UnitItemInSlot(Hero,i)))==(Item_Real[indexid_bootsOfTravel])then
      set ACF=true
    endif
    if GetItemTypeId(UnitItemInSlot(Hero,i))==(Item_Real[indexid_PowerTreadsIntelligence])then
      set A3F=true
    endif
    if GetItemTypeId(UnitItemInSlot(Hero,i))==(Item_Real[indexid_PowerTreadsStrength])then
      set A6F=true
    endif
    if GetItemTypeId(UnitItemInSlot(Hero,i))==(Item_Real[indexid_PowerTreadsAgility])then
      set ALF=true
    endif
    if GetItemTypeId(UnitItemInSlot(Hero,i))==(Item_Real[indexid_PhaseBoots])then
      set A1F=true
    endif
    if GetItemTypeId(UnitItemInSlot(Hero,i))==(Item_Real[indexid_ArcaneBoots])then
      set A0F=true
    endif
    if GetItemTypeId(UnitItemInSlot(Hero,i))==(Item_Real[indexid_TranquilBoots])then
      set A5F=true
    endif
    if GetItemTypeId(UnitItemInSlot(Hero,i))==(Item_Real[indexid_TranquilBootsBroken])then
      set A2F=true
    endif
    set i=i+1
  endloop
  if A2F then
    call UnitAddItem(NewHero,CreateItem((Item_Real[indexid_TranquilBootsBroken]),0,0))
  elseif A5F then
    call UnitAddItem(NewHero,CreateItem((Item_Real[indexid_TranquilBoots]),0,0))
  elseif A0F then
    call UnitAddItem(NewHero,CreateItem((Item_Real[indexid_ArcaneBoots]),0,0))
  elseif A1F then
    call UnitAddItem(NewHero,CreateItem((Item_Real[indexid_PhaseBoots]),0,0))
  elseif ALF then
    call UnitAddItem(NewHero,CreateItem((Item_Real[indexid_PowerTreadsAgility]),0,0))
  elseif A6F then
    call UnitAddItem(NewHero,CreateItem((Item_Real[indexid_PowerTreadsStrength]),0,0))
  elseif A3F then
    call UnitAddItem(NewHero,CreateItem((Item_Real[indexid_PowerTreadsIntelligence]),0,0))
  elseif ACF then
    call UnitAddItem(NewHero,CreateItem((Item_Real[indexid_bootsOfTravel]),0,0))
  elseif ABF then
    call UnitAddItem(NewHero,CreateItem((Item_Real[indexid_BootsOfSpeed]),0,0))
  endif
  call EnableTrigger(t)
  call EnableTrigger(t_manipulateitem)
  set t=null
endfunction

function B4F takes nothing returns nothing
  local unit JP9=GetTriggerUnit()
  local integer i=0
  local boolean ABF=false
  local boolean ACF=false
  local boolean A3F=false
  local boolean A6F=false
  local boolean ALF=false
  local boolean A1F=false
  local boolean A0F=false
  local boolean A5F=false
  local boolean A2F=false
  local integer ZWF=GetHandleId(GetOwningPlayer(JP9))
  local unit JJ9=(LoadUnitHandle(hashtable019,(ZWF),(699)))
  local unit JK9=(LoadUnitHandle(hashtable019,(ZWF),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(ZWF),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(ZWF),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(ZWF),(703)))
  local integer FQ9
  local boolean B7F=false
  local integer B8F=0
  local integer B9F=0
  local integer BDF=0
  local integer BEF=0
  local integer BFF=0
  local integer BGF=0
  local integer BHF=0
  local integer BIF=0
  local integer BJF=0
  call DisableTrigger(GetTriggeringTrigger())
  if GetUnitTypeId(JP9)==('H00J')then
    call UnitRemoveItemFromSlot(JP9,0)
    call EnableTrigger(GetTriggeringTrigger())
    return
  endif
  if not(GetItemTypeId(GetManipulatedItem())==(Item_Real[indexid_BootsOfSpeed])or (GetItemTypeId(GetManipulatedItem()))==(Item_Real[indexid_bootsOfTravel])or GetItemTypeId(GetManipulatedItem())==(Item_Real[indexid_PowerTreadsIntelligence])or GetItemTypeId(GetManipulatedItem())==(Item_Real[indexid_PowerTreadsStrength])or GetItemTypeId(GetManipulatedItem())==(Item_Real[indexid_PowerTreadsAgility])or (GetItemTypeId(GetManipulatedItem()))==(Item_Real[indexid_PhaseBoots])or GetItemTypeId(GetManipulatedItem())==(Item_Real[indexid_ArcaneBoots])or GetItemTypeId(GetManipulatedItem())==(Item_Real[indexid_TranquilBoots])or GetItemTypeId(GetManipulatedItem())==(Item_Real[indexid_TranquilBootsBroken]))then
    call EnableTrigger(GetTriggeringTrigger())
    return
  endif
  call DisableTrigger(t_manipulateitem)
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_DROP_ITEM then
    set B7F=true
  endif
  loop
    exitwhen i>5
    set FQ9=GetItemTypeId(UnitItemInSlot(JP9,i))
    if FQ9==(Item_Real[indexid_BootsOfSpeed])then
      set B8F=B8F+1
      if(not(B7F and FQ9==GetItemTypeId(GetManipulatedItem())))or(B8F>1 and FQ9==GetItemTypeId(GetManipulatedItem()))then
        set ABF=true
      endif
    endif
    if (FQ9)==(Item_Real[indexid_bootsOfTravel])then
      set B9F=B9F+1
      if(not(B7F and FQ9==GetItemTypeId(GetManipulatedItem())))or(B9F>1 and FQ9==GetItemTypeId(GetManipulatedItem()))then
        set ACF=true
      endif
    endif
    if FQ9==(Item_Real[indexid_PowerTreadsIntelligence])then
      set BDF=BDF+1
      if(not(B7F and FQ9==GetItemTypeId(GetManipulatedItem())))or(BDF>1 and FQ9==GetItemTypeId(GetManipulatedItem()))then
        set A3F=true
      endif
    endif
    if FQ9==(Item_Real[indexid_PowerTreadsStrength])then
      set BEF=BEF+1
      if(not(B7F and FQ9==GetItemTypeId(GetManipulatedItem())))or(BEF>1 and FQ9==GetItemTypeId(GetManipulatedItem()))then
        set A6F=true
      endif
    endif
    if FQ9==(Item_Real[indexid_PowerTreadsAgility])then
      set BFF=BFF+1
      if(not(B7F and FQ9==GetItemTypeId(GetManipulatedItem())))or(BFF>1 and FQ9==GetItemTypeId(GetManipulatedItem()))then
        set ALF=true
      endif
    endif
    if (FQ9)==(Item_Real[indexid_PhaseBoots])then
      set BGF=BGF+1
      if(not(B7F and FQ9==GetItemTypeId(GetManipulatedItem())))or(BGF>1 and FQ9==GetItemTypeId(GetManipulatedItem()))then
        set A1F=true
      endif
    endif
    if FQ9==(Item_Real[indexid_ArcaneBoots])then
      set BHF=BHF+1
      if(not(B7F and FQ9==GetItemTypeId(GetManipulatedItem())))or(BHF>1 and FQ9==GetItemTypeId(GetManipulatedItem()))then
        set A0F=true
      endif
    endif
    if FQ9==(Item_Real[indexid_TranquilBoots])then
      set BIF=BIF+1
      if(not(B7F and FQ9==GetItemTypeId(GetManipulatedItem())))or(BIF>1 and FQ9==GetItemTypeId(GetManipulatedItem()))then
        set A5F=true
      endif
    endif
    if FQ9==(Item_Real[indexid_TranquilBootsBroken])then
      set BJF=BJF+1
      if(not(B7F and FQ9==GetItemTypeId(GetManipulatedItem())))or(BIF>1 and FQ9==GetItemTypeId(GetManipulatedItem()))then
        set A2F=true
      endif
    endif
    set i=i+1
  endloop
  call RemoveItem(UnitRemoveItemFromSlot(JK9,0))
  if JM9!=null then
    call RemoveItem(UnitRemoveItemFromSlot(JM9,0))
  endif
  if JN9!=null then
    call RemoveItem(UnitRemoveItemFromSlot(JN9,0))
  endif
  if JO9!=null then
    call RemoveItem(UnitRemoveItemFromSlot(JO9,0))
  endif
  if A2F then
    call UnitAddItem(JK9,CreateItem((Item_Real[indexid_TranquilBootsBroken]),0,0))
    if JM9!=null then
      call UnitAddItem(JM9,CreateItem((Item_Real[indexid_TranquilBootsBroken]),0,0))
    endif
    if JN9!=null then
      call UnitAddItem(JN9,CreateItem((Item_Real[indexid_TranquilBootsBroken]),0,0))
    endif
    if JO9!=null then
      call UnitAddItem(JO9,CreateItem((Item_Real[indexid_TranquilBootsBroken]),0,0))
    endif
  elseif A5F then
    call UnitAddItem(JK9,CreateItem((Item_Real[indexid_TranquilBoots]),0,0))
    if JM9!=null then
      call UnitAddItem(JM9,CreateItem((Item_Real[indexid_TranquilBoots]),0,0))
    endif
    if JN9!=null then
      call UnitAddItem(JN9,CreateItem((Item_Real[indexid_TranquilBoots]),0,0))
    endif
    if JO9!=null then
      call UnitAddItem(JO9,CreateItem((Item_Real[indexid_TranquilBoots]),0,0))
    endif
  elseif A0F then
    call UnitAddItem(JK9,CreateItem((Item_Real[indexid_ArcaneBoots]),0,0))
    if JM9!=null then
      call UnitAddItem(JM9,CreateItem((Item_Real[indexid_ArcaneBoots]),0,0))
    endif
    if JN9!=null then
      call UnitAddItem(JN9,CreateItem((Item_Real[indexid_ArcaneBoots]),0,0))
    endif
    if JO9!=null then
      call UnitAddItem(JO9,CreateItem((Item_Real[indexid_ArcaneBoots]),0,0))
    endif
  elseif A1F then
    call UnitAddItem(JK9,CreateItem((Item_Real[indexid_PhaseBoots]),0,0))
    if JM9!=null then
      call UnitAddItem(JM9,CreateItem((Item_Real[indexid_PhaseBoots]),0,0))
    endif
    if JN9!=null then
      call UnitAddItem(JN9,CreateItem((Item_Real[indexid_PhaseBoots]),0,0))
    endif
    if JO9!=null then
      call UnitAddItem(JO9,CreateItem((Item_Real[indexid_PhaseBoots]),0,0))
    endif
  elseif ALF then
    call UnitAddItem(JK9,CreateItem((Item_Real[indexid_PowerTreadsAgility]),0,0))
    if JM9!=null then
      call UnitAddItem(JM9,CreateItem((Item_Real[indexid_PowerTreadsAgility]),0,0))
    endif
    if JN9!=null then
      call UnitAddItem(JN9,CreateItem((Item_Real[indexid_PowerTreadsAgility]),0,0))
    endif
    if JO9!=null then
      call UnitAddItem(JO9,CreateItem((Item_Real[indexid_PowerTreadsAgility]),0,0))
    endif
  elseif A6F then
    call UnitAddItem(JK9,CreateItem((Item_Real[indexid_PowerTreadsStrength]),0,0))
    if JM9!=null then
      call UnitAddItem(JM9,CreateItem((Item_Real[indexid_PowerTreadsStrength]),0,0))
    endif
    if JN9!=null then
      call UnitAddItem(JN9,CreateItem((Item_Real[indexid_PowerTreadsStrength]),0,0))
    endif
    if JO9!=null then
      call UnitAddItem(JO9,CreateItem((Item_Real[indexid_PowerTreadsStrength]),0,0))
    endif
  elseif A3F then
    call UnitAddItem(JK9,CreateItem((Item_Real[indexid_PowerTreadsIntelligence]),0,0))
    if JM9!=null then
      call UnitAddItem(JM9,CreateItem((Item_Real[indexid_PowerTreadsIntelligence]),0,0))
    endif
    if JN9!=null then
      call UnitAddItem(JN9,CreateItem((Item_Real[indexid_PowerTreadsIntelligence]),0,0))
    endif
    if JO9!=null then
      call UnitAddItem(JO9,CreateItem((Item_Real[indexid_PowerTreadsIntelligence]),0,0))
    endif
  elseif ACF then
    call UnitAddItem(JK9,CreateItem((Item_Real[indexid_bootsOfTravel]),0,0))
    if JM9!=null then
      call UnitAddItem(JM9,CreateItem((Item_Real[indexid_bootsOfTravel]),0,0))
    endif
    if JN9!=null then
      call UnitAddItem(JN9,CreateItem((Item_Real[indexid_bootsOfTravel]),0,0))
    endif
    if JO9!=null then
      call UnitAddItem(JO9,CreateItem((Item_Real[indexid_bootsOfTravel]),0,0))
    endif
  elseif ABF then
    call UnitAddItem(JK9,CreateItem((Item_Real[indexid_BootsOfSpeed]),0,0))
    if JM9!=null then
      call UnitAddItem(JM9,CreateItem((Item_Real[indexid_BootsOfSpeed]),0,0))
    endif
    if JN9!=null then
      call UnitAddItem(JN9,CreateItem((Item_Real[indexid_BootsOfSpeed]),0,0))
    endif
    if JO9!=null then
      call UnitAddItem(JO9,CreateItem((Item_Real[indexid_BootsOfSpeed]),0,0))
    endif
  endif
  call EnableTrigger(GetTriggeringTrigger())
  call EnableTrigger(t_manipulateitem)
  set JP9=null
  set JM9=null
  set JN9=null
  set JO9=null
  set JJ9=null
  set JK9=null
endfunction

function DoubleTrouble_LevelAbility takes unit BMF,integer BNF returns nothing
  local integer ZWF=GetHandleId(GetOwningPlayer(BMF))
  local unit JJ9=(LoadUnitHandle(hashtable019,(ZWF),(699)))
  local unit JK9=(LoadUnitHandle(hashtable019,(ZWF),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(ZWF),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(ZWF),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(ZWF),(703)))
  if JJ9!=null and JJ9!=BMF then
    call SelectHeroSkill(JJ9,BNF)
  endif
  if JK9!=null and JK9!=BMF then
    call SelectHeroSkill(JK9,BNF)
  endif
  if JM9!=null and JM9!=BMF then
    call SelectHeroSkill(JM9,BNF)
  endif
  if JN9!=null and JN9!=BMF then
    call SelectHeroSkill(JN9,BNF)
  endif
  if JO9!=null and JO9!=BMF then
    call SelectHeroSkill(JO9,BNF)
  endif
  set JM9=null
  set JN9=null
  set JO9=null
  set JJ9=null
  set JK9=null
endfunction

function BOF takes integer AF8,unit YCD,unit Y3D returns nothing
  local integer VT8=1
  local integer VU8=GetUnitAbilityLevel(YCD,AF8)
  loop
    exitwhen VT8>VU8
    call SelectHeroSkill(Y3D,AF8)
    set VT8=VT8+1
  endloop
endfunction

function BPF takes unit NewHero,unit BQF returns nothing
  local integer i=GetPlayerId(GetOwningPlayer(BQF))
  local integer aid1=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+1]]
  local integer aid2=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+2]]
  local integer aid3=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+3]]
  local integer aid4=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+4]]
  local integer aid5=AlternateSkillID[PlayerSkillNumber[i*PlayerSkillOffset+4]]
  call UnitAddAbility2(NewHero,EngineeringUpgradeSkillID[PlayerSkillNumber[i*PlayerSkillOffset+1]])
  call UnitAddAbility2(NewHero,EngineeringUpgradeSkillID[PlayerSkillNumber[i*PlayerSkillOffset+2]])
  call UnitAddAbility2(NewHero,EngineeringUpgradeSkillID[PlayerSkillNumber[i*PlayerSkillOffset+3]])
  call UnitAddAbility2(NewHero,EngineeringUpgradeSkillID[PlayerSkillNumber[i*PlayerSkillOffset+4]])
  call AddHeroXP(NewHero,GetHeroXP(BQF),false)
  call SaveInteger(hashtable019,(GetHandleId(NewHero)),(368),(GetHeroXP(BQF)))
  call SaveInteger(hashtable019,(GetHandleId(NewHero)),(367),(0))
  call BOF(aid1,BQF,NewHero)
  call BOF(aid2,BQF,NewHero)
  call BOF(aid3,BQF,NewHero)
  call BOF('A0NR',BQF,NewHero)
  call BOF(aid4,BQF,NewHero)
  call BOF(aid5,BQF,NewHero)
endfunction

function BRF takes unit JK9,unit JM9,integer BNF,integer B8F,integer B9F returns nothing
  if B8F>B9F then
    call SelectHeroSkill(JM9,BNF)
  elseif B9F>B8F then
    call SelectHeroSkill(JK9,BNF)
  endif
endfunction

function BSF takes unit JK9,unit JM9 returns nothing
  local integer ANF=GetHeroXP(JK9)
  local integer AOF=GetHeroXP(JM9)
  local integer Z5F=GetHandleId(JK9)
  local integer Z2F=GetHandleId(JM9)
  local integer AEF=(LoadInteger(hashtable019,(Z5F),(368)))
  local integer AGF=(LoadInteger(hashtable019,(Z2F),(368)))
  local integer YND
  if ANF>AOF then
    set YND=ANF-AOF
    call AddHeroXP(JM9,YND,true)
    if AOF!=GetHeroXP(JM9)then
      call SaveInteger(hashtable019,(Z2F),(368),(AGF+YND))
    endif
  elseif ANF<AOF then
    set YND=AOF-ANF
    call AddHeroXP(JK9,YND,true)
    if ANF!=GetHeroXP(JK9)then
      call SaveInteger(hashtable019,(Z5F),(368),(AEF+YND))
    endif
  endif
endfunction

function BTF takes unit JK9,unit JM9 returns nothing
  local integer i=GetPlayerId(GetOwningPlayer(JK9))
  local integer aid1=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+1]]
  local integer aid2=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+2]]
  local integer aid3=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+3]]
  local integer aid4=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+4]]
  local integer aid5=AlternateSkillID[PlayerSkillNumber[i*PlayerSkillOffset+4]]
  local integer BUF=GetUnitAbilityLevel(JK9,aid1)
  local integer BVF=GetUnitAbilityLevel(JK9,aid2)
  local integer BWF=GetUnitAbilityLevel(JK9,aid3)
  local integer BXF=GetUnitAbilityLevel(JK9,aid4)
  local integer BYF=GetUnitAbilityLevel(JK9,'A0NR')
  local integer BZF=GetUnitAbilityLevel(JK9,aid5)
  local integer BAF=GetUnitAbilityLevel(JM9,aid1)
  local integer BBF=GetUnitAbilityLevel(JM9,aid2)
  local integer BCF=GetUnitAbilityLevel(JM9,aid3)
  local integer B3F=GetUnitAbilityLevel(JM9,aid4)
  local integer B6F=GetUnitAbilityLevel(JM9,'A0NR')
  local integer BLF=GetUnitAbilityLevel(JM9,aid5)
  call BSF(JK9,JM9)
  call BRF(JK9,JM9,aid1,BUF,BAF)
  call BRF(JK9,JM9,aid2,BVF,BBF)
  call BRF(JK9,JM9,aid3,BWF,BCF)
  call BRF(JK9,JM9,aid4,BXF,B3F)
  call BRF(JK9,JM9,aid5,BZF,BLF)
  call BRF(JK9,JM9,'A0NR',BYF,B6F)
endfunction

function B1F takes unit JK9,unit JM9 returns nothing
  if JK9!=null and JM9!=null then
    call BTF(JK9,JM9)
  endif
endfunction

function B0F takes nothing returns nothing
  local integer ZWF=GetHandleId((LoadPlayerHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(370))))
  local unit JJ9=(LoadUnitHandle(hashtable019,(ZWF),(699)))
  local unit JK9=(LoadUnitHandle(hashtable019,(ZWF),(700)))
  local unit JM9=(LoadUnitHandle(hashtable019,(ZWF),(701)))
  local unit JN9=(LoadUnitHandle(hashtable019,(ZWF),(702)))
  local unit JO9=(LoadUnitHandle(hashtable019,(ZWF),(703)))
  call DisableTrigger(DoubleTroubleTrigger)
  call B1F(JJ9,JK9)
  call B1F(JJ9,JM9)
  call B1F(JJ9,JN9)
  call B1F(JJ9,JO9)
  call B1F(JK9,JM9)
  call B1F(JK9,JN9)
  call B1F(JK9,JO9)
  call B1F(JM9,JN9)
  call B1F(JM9,JO9)
  call B1F(JN9,JO9)
  call EnableTrigger(DoubleTroubleTrigger)
  set JM9=null
  set JN9=null
  set JO9=null
  set JJ9=null
  set JK9=null
endfunction

function B5F takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.2,true)
  call TriggerAddAction(t,function B0F)
  call SavePlayerHandle(hashtable019,(GetHandleId(t)),(370),(GetOwningPlayer(GetTriggerUnit())))
  set t=null
endfunction

function DividedWeStand_Initialize takes unit Source returns nothing
  local trigger t
  call SaveUnitHandle(hashtable019,(GetHandleId(GetOwningPlayer(Source))),(699),(Source))
  call SaveInteger(hashtable019,(GetHandleId(Source)),(367),(GetHeroXP(Source)))
  call SaveInteger(hashtable019,(GetHandleId(Source)),(368),(0))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddAction(t,function Z1F)
  call SavePlayerHandle(hashtable019,(GetHandleId(t)),(370),(GetOwningPlayer(Source)))
  call SaveTriggerHandle(hashtable019,(GetHandleId(GetOwningPlayer(Source))),(371),(t))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.3,true)
  call TriggerAddAction(t,function ZUF)
  call SavePlayerHandle(hashtable019,(GetHandleId(t)),(370),(GetOwningPlayer(Source)))
  call SaveTriggerHandle(hashtable019,(GetHandleId(GetOwningPlayer(Source))),(372),(t))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddAction(t,function AXF)
  call TriggerAddCondition(t,Condition(function AWF))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PICKUP_ITEM)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DROP_ITEM)
  call TriggerAddAction(t,function B4F)
  call TriggerAddCondition(t,Condition(function AYF))
  call SaveTriggerHandle(hashtable019,(GetHandleId(GetOwningPlayer(Source))),(369),(t))
  call ExeFunc("B5F")
  set t=null
endfunction

function DividedWeStand_CreateNewClone takes unit Source,boolean CZ9 returns nothing
  local player p=GetOwningPlayer(Source)
  local integer Cache=GetHandleId(p)
  local unit NewHero
  set dividedwestand_count=dividedwestand_count+1
  if dividedwestand_count==1 then
    call DividedWeStand_Initialize(Source)
    call BJDebugMsg("dividedwestand start")
  endif
  call TriggerExecute((LoadTriggerHandle(hashtable019,(GetHandleId(GetOwningPlayer(Source))),(371))))
  call TriggerExecute((LoadTriggerHandle(hashtable019,(GetHandleId(GetOwningPlayer(Source))),(372))))
  if CZ9==false then
    call DoubleTrouble_LevelAbility(Source,'A0MW')
    call DoubleTrouble_LevelAbility(Source,'A27C')
  endif
  set NewHero=CreateUnit(GetOwningPlayer(Source),'H00J',GetUnitX(Source),GetUnitY(Source),0)
  call BPF(NewHero,Source)
  call AZF(NewHero,Source)
  call SaveUnitHandle(hashtable019,(Cache),(699+dividedwestand_count),(NewHero))
  set p=null
  set NewHero=null
endfunction

function FCD takes nothing returns nothing
  if dividedwestand_usedscepter==false then
    set dividedwestand_usedscepter=true
    call DisableTrigger(DoubleTroubleTrigger)
    call DividedWeStand_CreateNewClone(tt_unit1,true)
    call EnableTrigger(DoubleTroubleTrigger)
  endif
endfunction

function DividedWeStand_Learned takes nothing returns boolean
  local integer i=GetPlayerId(GetOwningPlayer(GetTriggerUnit()))
  local integer aid1=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+1]]
  local integer aid2=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+2]]
  local integer aid3=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+3]]
  local integer aid4=SkillID[PlayerSkillNumber[i*PlayerSkillOffset+4]]
  local integer aid5=AlternateSkillID[PlayerSkillNumber[i*PlayerSkillOffset+4]]
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if IsUnitIllusion(GetTriggerUnit())==false and GetOwningPlayer(GetTriggerUnit())==GetOwningPlayer(Source)then //and ZSF(GetTriggerUnit())then
    if GetLearnedSkill()=='A0MW' or GetLearnedSkill()=='A27C' then //Divided We Stand is leveled
      call DisableTrigger(GetTriggeringTrigger())
      call DividedWeStand_CreateNewClone(GetTriggerUnit(),false)
      call EnableTrigger(GetTriggeringTrigger())
    elseif GetLearnedSkill()=='A0NR' or GetLearnedSkill()==aid1 or GetLearnedSkill()==aid2 or GetLearnedSkill()==aid3 or GetLearnedSkill()==aid4 or GetLearnedSkill()==aid5 then
      call TriggerExecute((LoadTriggerHandle(hashtable019,(GetHandleId(GetOwningPlayer(GetTriggerUnit()))),(371))))
      call TriggerExecute((LoadTriggerHandle(hashtable019,(GetHandleId(GetOwningPlayer(GetTriggerUnit()))),(372))))
      call DisableTrigger(GetTriggeringTrigger())
      call DoubleTrouble_LevelAbility(GetTriggerUnit(),GetLearnedSkill())
      call EnableTrigger(GetTriggeringTrigger())
    endif
  endif
  set Source=null
  set t=null
  return false
endfunction

function Register_DividedWeStand takes nothing returns nothing
  local unit Source=tt_unit1
  local integer Cache
  set dividedwestand_t=CreateTrigger()
  set DoubleTroubleTrigger=dividedwestand_t
  set Cache=GetHandleId(dividedwestand_t)
  call TriggerRegisterAnyUnitEvent(dividedwestand_t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(dividedwestand_t,Condition(function DividedWeStand_Learned))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set Source=null
endfunction

function Leshrak_SplitEarth takes nothing returns nothing
  local location l=GetSpellTargetLoc()
  local unit Caster=CreateUnitAtLoc(GetOwningPlayer(GetTriggerUnit()),'e00E',l,0)
  call UnitAddAbility(Caster,'A06W')
  call SetUnitAbilityLevel(Caster,'A06W',GetUnitAbilityLevel(GetTriggerUnit(),GetSpellAbilityId()))
  if IssuePointOrderLoc(Caster,"dreadlordinferno",l)==false then
    call IssuePointOrderLoc(Caster,"inferno",l)
  endif
  call ZD8("Abilities\\Spells\\Orc\\EarthQuake\\EarthQuakeTarget.mdl",GetLocationX(l),GetLocationY(l),2)
  call TerrainDeformationRippleBJ(.3,false,l,0,300,100,.4,20)
  call RemoveLocation(l)
  set l=null
  set Caster=null
endfunction

function GenericCondition_BasicsAndStructureNoInvul takes nothing returns boolean
  return GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false and IsUnitInvulAdvanced(GetFilterUnit())==false
endfunction

function CDF takes nothing returns boolean
  return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false and IsUnitInvulAdvanced(GetFilterUnit())==false)
endfunction

function CEF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local group g
  local unit u
  local real d
  local real a
  local real x
  local real y
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  if GetTriggerEvalCount(t)>32 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set g=GetAvailableGroup()
    set tt_unit1=Hero
    call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),500,Condition(function CDF))
    set u=GroupPickRandomUnit(g)
    if u==null then
      set d=GetRandomReal(175,400)
      set a=GetRandomReal(0,6)
      set x=GetUnitX(Hero)+d*Cos(a)
      set y=GetUnitY(Hero)+d*Sin(a)
      call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\SteamTank\\SteamTankImpact.mdl",x,y))
    else
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SteamTank\\SteamTankImpact.mdl",u,"origin"))
      call DamageTarget(Caster,u,5,12.5*Level)
    endif
    call KillGroup(g)
  endif
  set u=null
  set g=null
  set t=null
  set Hero=null
  set Caster=null
  return false
endfunction

function Leshrak_DiabolicEdict takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',GetUnitX(Hero),GetUnitY(Hero),0)
  if GetUnitTypeId(Hero)=='e00E' then
    set Hero=udg_Hero[GetPlayerId(GetOwningPlayer(Hero))]
  endif
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RocketMissile\\RocketMissile.mdl",Hero,"hand right"))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveInteger(hashtable019,(Cache),(5),(GetUnitAbilityLevel(Hero,'A20T')))
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerAddCondition(t,Condition(function CEF))
  set t=null
  set Hero=null
  set Caster=null
endfunction

function CHF takes nothing returns nothing
  local unit Source=JN8
  local unit Target=GetEnumUnit()
  call DamageTarget(Source,Target,1,JO8)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",Target,"origin"))
  set Source=null
  set Target=null
endfunction

function CIF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=GetUnitAbilityLevel(Source,'A21F')
  local group g
  local boolean b=GetUnitAbilityLevel(Source,'A21G')>0
  if not b then
    if Level==1 then
      set JO8=66
    elseif Level==2 then
      set JO8=100
    else
      set JO8=144
    endif
  else
    set Level=GetUnitAbilityLevel(Source,'A21G')
    if Level==1 then
      set JO8=100
    elseif Level==2 then
      set JO8=150
    else
      set JO8=200
    endif
  endif
  if GetTriggerEvalCount(t)==1 then
    call UnitAddAbility2(Source,'A345')
    if b then
      call SetUnitAbilityLevel(Source,'A345',2)
    endif
  endif
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or GetUnitState(Source,UNIT_STATE_MANA)<20*Level or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==-1 or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and(GetSpellAbilityId()=='A21H' or GetSpellAbilityId()=='A27H' or GetSpellAbilityId()=='A30J'))then
    if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A21F' then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21F',true)
    endif
    if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A21G' then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21G',true)
    endif
    call UnitRemoveAbility(Source,'A345')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21H',false)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT then
    
    
    call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)-20*Level)
    set tt_unit1=Source
    set JN8=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),475,Condition(function DefaultEnemyFilter))
    
    call ForGroup(g,function CHF)
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Source=null
  return false
endfunction

function Leshrak_PulseNova takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",Source,"origin"))
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21F',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21G',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A21H',true)
  call UnitAddAbility(Source,'A21H')
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function CIF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call TriggerEvaluate(t)
  set Source=null
  set t=null
endfunction

function CMF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit YSE=(LoadUnitHandle(hashtable019,(Cache),(374)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer CNF=(LoadInteger(hashtable019,(Cache),(233)))
  local integer RHE=(LoadInteger(hashtable019,(Cache),(12)))
  local unit Caster
  local group g
  local real a
  local real x
  local real y
  local integer D09=(LoadInteger(hashtable019,(Cache),(720)))
  if D09>0 then
    set D09=D09-1
    call SaveInteger(hashtable019,(Cache),(720),(D09))
    return false
  endif
  if DistanceBetweenXY(GetUnitX(YSE),GetUnitY(YSE),GetUnitX(Target),GetUnitY(Target))>20 then
    set a=AngleBetweenXY(GetUnitX(YSE),GetUnitY(YSE),GetUnitX(Target),GetUnitY(Target))
    call SetUnitFacing(YSE,a)
    set x=GetUnitX(YSE)+13.5*Cos(a*bj_DEGTORAD)
    set y=GetUnitY(YSE)+13.5*Sin(a*bj_DEGTORAD)
    call SetUnitX(YSE,x)
    call SetUnitY(YSE,y)
  else
    if IsDead(Target)==false then
      set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
      call UnitAddAbility2(Caster,'A091')
      call SetUnitAbilityLevel(Caster,'A091',Level)
      call IssueTargetOrderById(Caster,852226,Target)
    endif
    if CNF>RHE then
      call RemoveUnit(YSE)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    else
      set g=GetAvailableGroup()
      set tt_unit1=Source
      call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),600,Condition(function LT8))
      call GroupRemoveUnit(g,Target)
      set Target=GroupPickRandomUnit(g)
      call KillGroup(g)
      if Target==null then
        call RemoveUnit(YSE)
        call FlushChildHashtable(hashtable019,(Cache))
        call CleanTrigger(t)
      else
        call SaveInteger(hashtable019,(Cache),(720),(10))
        call SaveInteger(hashtable019,(Cache),(233),(CNF+1))
        call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
      endif
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set YSE=null
  set Caster=null
  set g=null
  return false
endfunction

function Lich_ChainFrost takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A05T')
  local integer RHE=10
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit YSE
  if GetSpellAbilityId()=='A08H' then
    set Level=GetUnitAbilityLevel(Source,'A08H')+1
  endif
  set YSE=CreateUnit(GetOwningPlayer(Source),'e009',GetUnitX(Source),GetUnitY(Source),0)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(374),(YSE))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(233),(1))
  call SaveInteger(hashtable019,(Cache),(12),(RHE))
  call SaveInteger(hashtable019,(Cache),(720),(0))
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function CMF))
  set Source=null
  set Target=null
  set YSE=null
  set t=null
endfunction

function Lion_Impale takes nothing returns nothing
  //local location l
  local unit Hero=GetTriggerUnit()
  local real x1=GetUnitX(Hero)
  local real y1=GetUnitY(Hero)
  local real a
  local real x2
  local real y2
  local integer Level=GetUnitAbilityLevel(Hero,'A0X5')
  local real Damage
  local real DP9
  local unit D09=null
  if GetSpellTargetUnit()!=null then
    //set l=GetUnitLoc(GetSpellTargetUnit())
    set x2=GetUnitX(GetSpellTargetUnit())
    set y2=GetUnitY(GetSpellTargetUnit())
  else
    set x2=GetSpellTargetX()
    set y2=GetSpellTargetY()
  endif
  set a=Atan2(y2-y1,x2-x1)
  set x2=x1+700*Cos(a)
  set y2=y1+700*Sin(a)
  if Level==1 then
    set Damage=60
    set DP9=.5
  elseif Level==2 then
    set Damage=130
    set DP9=1
  elseif Level==3 then
    set Damage=200
    set DP9=1.5
  elseif Level==4 then
    set Damage=260
    set DP9=2
  endif
  if GetSpellTargetUnit()!=null and IsBlocked(GetSpellTargetUnit())then
    set D09=GetSpellTargetUnit()
  endif
  call D19(Hero,D09,Damage,DP9,.52,x1,y1,x2,y2,150,null,true,1600)
  //call RemoveLocation(l)
  //set l=null
  set Hero=null
  set D09=null
endfunction


function Lion_FingerOfDeath_SplashAct takes nothing returns nothing
  local real dmg=475+125*GetUnitAbilityLevel(Lion_Finger_TempUnit,'A09W')
  call DamageTarget(Lion_Finger_TempUnit,GetEnumUnit(),1,dmg)
endfunction

function Lion_FingerOfDeath_Splash_Delayed takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit caster=LoadUnitHandle(hashtable019,h,0)
  local unit target=LoadUnitHandle(hashtable019,h,1)
  local integer lvl=GetUnitAbilityLevel(caster,GetSpellAbilityId())
  local group g=GetAvailableGroup()
  set tt_unit1=caster
  call GroupEnumUnitsInRange(g,GetUnitX(target),GetUnitY(target),200+25,Condition(function NonImmuneEnemyFilter))
  call GroupRemoveUnit(g,target)
  if FirstOfGroup(g)!=null then
    set Lion_Finger_TempUnit=caster
    call ForGroup(g,function Lion_FingerOfDeath_SplashAct)
  endif
  call KillGroup(g)
  call CleanTimer(t)
  set t=null
  set g=null
  set target=null
  set caster=null
endfunction

function Lion_FingerOfDeath_Splash takes nothing returns nothing
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call TimerStart(t,.25,false,function Lion_FingerOfDeath_Splash_Delayed)
  call SaveUnitHandle(hashtable019,h,0,GetTriggerUnit())
  call SaveUnitHandle(hashtable019,h,1,GetSpellTargetUnit())
  set t=null
endfunction

function CSF takes nothing returns boolean
  if(GetSpellAbilityId()=='A095' or GetSpellAbilityId()=='A09W')and IsMagicImmune(GetSpellTargetUnit())then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n0LR'))
  endif
  return false
endfunction

function SR9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function CSF))
  set t=null
endfunction


function Lycan_Shapeshift_Crit_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if GetUnitAbilityLevel(t,'A04R')==0 and GetUnitAbilityLevel(t,'Aloc')==0then
    if LoadBoolean(MHT,99999,99996)then
      call UnitRemoveAbility(t,'A521')
    else
      call UnitAddAbility2(t,'A521')
      call UnitMakeAbilityPermanent(t,true,'A03B')
    endif
  endif
  set t = null
  return false
endfunction

function Lycan_Shapeshift_Crit takes player p, boolean b returns nothing
  call SaveBoolean(MHT,99999,99996,b)
  call GroupEnumUnitsOfPlayer(temp_group,p,Condition(function Lycan_Shapeshift_Crit_Targets))
  call RemoveSavedBoolean(MHT,99999,99996)
endfunction

function CTF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  
  call Lycan_Shapeshift_Crit(GetOwningPlayer(Hero),true)
  
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl",Hero,"origin"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl",Hero,"origin"))
  call UnitRemoveAbility(Hero,'A0ZC')
  call UnitRemoveAbility(Hero,'B00V')
  call UnitRemoveAbility(Hero,'A521')
  
  call RemoveUnit(LoadUnitHandle(hashtable019,Cache,15))
  
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call G89(Hero,0)
  set t=null
  set Hero=null
  return false
endfunction

function CUF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit d = LoadUnitHandle(hashtable019,Cache,15)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl",Hero,"origin"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl",Hero,"origin"))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,18-.1,false)
  call TriggerRegisterDeathEvent(t,Hero)
  call TriggerAddCondition(t,Condition(function CTF))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,Cache,15,d)
  
  call Lycan_Shapeshift_Crit(GetOwningPlayer(Hero),false)
  
  set d = null
  set t=null
  set Hero=null
  return false
endfunction

function CVF takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e01V',0,0,0)
  local real DP9=18
  local real hp=GetUnitState(Hero,UNIT_STATE_LIFE)
  local real bon=100*GetUnitAbilityLevel(Hero,GetSpellAbilityId())
  call G89(Hero,R2I(bon))
  call SetUnitState(Hero,UNIT_STATE_LIFE,hp+bon)//[lich] triggered hp bonus to lycan
  call UnitAddAbility2(Caster,'A0ZC')
  call UnitApplyTimedLife(Caster,'BTLF',DP9)
  call C78(Hero,DP9,175)
  call TriggerRegisterTimerEvent(t,.1,false)
  call TriggerAddCondition(t,Condition(function CUF))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,Cache,15,Caster)
  set t=null
  set Hero=null
  set Caster=null
endfunction

function Lycan_Shapeshift takes nothing returns nothing
  if GetUnitTypeId(GetTriggerUnit())!='E015' then
    call CVF()
  endif
endfunction

function Lycan_SpiritWolves takes nothing returns nothing
  call SetPlayerAbilityAvailable2(GetOwningPlayer(GetTriggerUnit()),'A03B',true)
endfunction


function YOD takes nothing returns nothing
  local unit Source=group003
  local unit Target=group006
  local unit Caster=(LoadUnitHandle(hashtable019,(GetHandleId(Source)),(219)))
  call SaveUnitHandle(hashtable019,(GetHandleId(Source)),(219),(Caster))
  call SetUnitOwner(Caster,GetOwningPlayer(Target),true)
  set Source=null
  set Target=null
  set Caster=null
endfunction

function YD9 takes nothing returns nothing
  local unit Hero=VK
  local unit Caster=(LoadUnitHandle(hashtable019,(GetHandleId(Hero)),(219)))
  if Caster!=null and GetUnitTypeId(Caster)=='e01V' then
    call RemoveUnit(Caster)
  endif
  set Hero=null
  set Caster=null
endfunction

function CXF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if Caster!=null and GetUnitTypeId(Caster)=='e01V' then
    if IsDead(Source)==false then
      call SetUnitX(Caster,GetUnitX(Source))
      call SetUnitY(Caster,GetUnitY(Source))
    endif
  endif
  set t=null
  set Caster=null
  set Source=null
  return false
endfunction

function Lycan_FeralImpulse_Leveling takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local integer Level=IMaxIF(GetUnitAbilityLevel(Hero,'A03E'),GetUnitAbilityLevel(Hero,'QP0Q'))
  local unit Caster
  local trigger t
  local integer Cache
  if Level==1 then
    set Caster=CreateUnit(GetOwningPlayer(Hero),'e01V',0,0,0)
    call UnitAddAbility2(Caster,'A0ZJ')
    call SaveUnitHandle(hashtable019,(GetHandleId(Hero)),(219),(Caster))
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerAddCondition(t,Condition(function CXF))
    call TriggerRegisterTimerEvent(t,.2,true)
    call SaveUnitHandle(hashtable019,(Cache),(2),(Hero))
    call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
    set t=null
  else
    set Caster=(LoadUnitHandle(hashtable019,(GetHandleId(Hero)),(219)))
  endif
  if Level==2 then
    call UnitRemoveAbility(Caster,'A0ZJ')
    call UnitAddAbility2(Caster,'A0ZI')
    call UnitRemoveAbility(Hero,'B09B')
  elseif Level==3 then
    call UnitRemoveAbility(Caster,'A0ZJ')
    call UnitRemoveAbility(Caster,'A0ZI')
    call UnitRemoveAbility(Hero,'B09A')
    call UnitRemoveAbility(Hero,'B09B')
    call UnitAddAbility2(Caster,'A0ZH')
  elseif Level==4 then
    call UnitRemoveAbility(Caster,'A0ZJ')
    call UnitRemoveAbility(Caster,'A0ZI')
    call UnitRemoveAbility(Caster,'A0ZH')
    call UnitRemoveAbility(Hero,'B097')
    call UnitRemoveAbility(Hero,'B09A')
    call UnitRemoveAbility(Hero,'B09B')
    call UnitAddAbility2(Caster,'A0ZG')
  endif
  set Hero=null
  set Caster=null
endfunction

function CZF takes nothing returns boolean
  if (GetLearnedSkill()=='A03E' or GetLearnedSkill()=='QP0Q') and IsUnitIllusion(GetTriggerUnit())==false then
    call Lycan_FeralImpulse_Leveling()
  endif
  return false
endfunction

function SW9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function CZF))
  set t=null
endfunction

function Lycan_Howl takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Caster
  local integer i=1
  local boolean WV8=IsSentinel(GetOwningPlayer(Hero))
  local player p
  local integer CBF
  local integer CCF
  local integer Level=GetUnitAbilityLevel(Hero,'A0ZF')
  if Level==1 then
    set CBF='A104'
    set CCF='A107'
  elseif Level==2 then
    set CBF='A101'
    set CCF='A106'
  elseif Level==3 then
    set CBF='A102'
    set CCF='A105'
  elseif Level==4 then
    set CBF='A103'
    set CCF='A108'
  endif
  loop
    exitwhen i>5
    if WV8 then
      set p=Sentinels[i]
    else
      set p=Scourges[i]
    endif
    set Caster=CreateUnit(p,'e01V',0,0,0)
    call UnitAddAbility2(Caster,CBF)
    call UnitAddAbility2(Caster,CCF)
    call UnitApplyTimedLife(Caster,'BTLF',12)
    set i=i+1
  endloop
  set Hero=null
  set Caster=null
  set p=null
endfunction

function Doom_LvlDeath takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer CLF=GetHeroLevel(Target)
  
  if IsUnitType(Source,UNIT_TYPE_HERO) and (ModuloInteger(CLF,7-GetUnitAbilityLevel(Source,'A094'))==0 or CLF==25) then
    call DamageTarget(Source,Target,1,GetUnitState(Target,UNIT_STATE_MAX_LIFE)*.2)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\DemonBoltImpact\\DemonBoltImpact.mdl",Target,"chest"))
  endif
  
  set Source=null
  set Target=null
endfunction

function Doom_DoomCast takes nothing returns nothing
  call RemovePositiveBuffs(GetSpellTargetUnit())
  call UnitRemoveBuffsEx(GetSpellTargetUnit(),true,false,true,true,false,false,false)
endfunction

function C0F takes unit Source returns nothing
  call UnitRemoveAbility(Source,'A1OQ')
  call UnitRemoveAbility(Source,'A1OR')
  call UnitRemoveAbility(Source,'A1OS')
  call UnitRemoveAbility(Source,'A1OT')
  call UnitRemoveAbility(Source,'A1OU')
  call UnitRemoveAbility(Source,'A1OV')
  call UnitRemoveAbility(Source,'A1OW')
  call UnitRemoveAbility(Source,'A1OX')
  call UnitRemoveAbility(Source,'A1OY')
  call UnitRemoveAbility(Source,'S00M')
  call UnitRemoveAbility(Source,'A1OZ')
  call UnitRemoveAbility(Source,'S00N')
  call UnitRemoveAbility(Source,'A1P0')
  call UnitRemoveAbility(Source,'A1P1')
  call UnitRemoveAbility(Source,'A1P7')
  call UnitRemoveAbility(Source,'A1PA')
  call UnitRemoveAbility(Source,'A1P3')
  call UnitRemoveAbility(Source,'A1P4')
  call UnitRemoveAbility(Source,'A1P5')
  call UnitRemoveAbility(Source,'A1P6')
  call UnitRemoveAbility(Source,'A2AG')
  call UnitRemoveAbility(Source,'QDP0')
  call UnitRemoveAbility(Source,'QDP1')
  call UnitRemoveAbility(Source,'QDP2')
  call UnitRemoveAbility(Source,'QDP3')
  call UnitRemoveAbility(Source,'QDP4')
  call UnitRemoveAbility(Source,'QDP5')
  call UnitRemoveAbility(Source,'QDP6')
  call UnitRemoveAbility(Source,'QDP7')
endfunction

function C5F takes unit Source,integer Target returns nothing
  local integer C2F=Target
  local integer L4F=0
  local integer L7F=0
  local boolean b1=false
  local boolean b2=false
  local integer s1=0
  local integer s2=0
  if C2F=='n0HX' then
    set L4F='A1OQ'
  elseif C2F=='nomg' then
    set L4F='A1OR'
  elseif C2F=='nfpu' then
    set L4F='A1OS'
  elseif C2F=='nstl' then
    set L4F='A1OT'
  elseif C2F=='nsat' then
    set L4F='A1OU'
  elseif C2F=='nsth' then//big satyr
    set L4F='A1OV'
    set L7F='QDP0'
    set s2='A1OW'
    set b2=true
  elseif C2F=='n00S' then
    set L4F='QDP6'
    set s1='A1OX'
    set b1=true
    set s2='A1OY'
  elseif C2F=='nkol' then
    set L4F='QDP1'
    set s1='S00M'
    set b1=true
  elseif C2F=='nfsh' then
    set L4F='A1OZ'
    set L7F='QDP2'
    set s2='A2AG'
    set b2=true
  elseif C2F=='ncnk' then
    set L4F='QDP3'
    set s1='S00N'
    set b1=true
    set L7F='A1P0'
  elseif C2F=='ngns' then
    set L4F='QDP4'
    set s1='A1P1'
    set b1=true
  elseif C2F=='ngh1' then
    set L4F='QDP7'
    set s1='A1P7'
    set b1=true
    set s2='A1PA'
    
  elseif C2F=='nowe' then
    set L4F='QDP5'
    set s1='A1P3'
    set b1=true
    set L7F='A1P4'
  elseif C2F=='ndtw' then
    set L4F='A1P5'
    set L7F='A1P6'
  elseif C2F=='nwlg' then
    set L4F='QDP8'
    set s1='A1OY'
    set b1=true
  endif
  if L4F!=0 then
    call C0F(Source)
    call UnitAddAbility2(Source,L4F)
    if b1 then
      call SetPlayerAbilityAvailable(GetOwningPlayer(Source),L4F,false)
      call UnitMakeAbilityPermanent(Source,true,s1)
      call UnitMakeAbilityPermanent(Source,true,s2)
    endif
  endif
  if L7F!=0 then
    call UnitAddAbility2(Source,L7F)
    if b2 then
      call SetPlayerAbilityAvailable(GetOwningPlayer(Source),L7F,false)
      call UnitMakeAbilityPermanent(Source,true,s1)
      call UnitMakeAbilityPermanent(Source,true,s2)
    endif
  endif
endfunction

function L8F takes real L9F returns string
  local string c1="|c00ff0303"
  local string c="||"
  local string p=" "
  local string s=c1+c+"|r"
  local string result
  if L9F>85 then
    set result=s+p+s+p+s+p+s+p+s+p+s+p+s
  elseif L9F>70 then
    set result=s+p+s+p+s+p+s+p+s+p+s+p+c
  elseif L9F>55 then
    set result=s+p+s+p+s+p+s+p+s+p+c+p+c
  elseif L9F>40 then
    set result=s+p+s+p+s+p+s+p+c+p+c+p+c
  elseif L9F>25 then
    set result=s+p+s+p+s+p+c+p+c+p+c+p+c
  elseif L9F>10 then
    set result=s+p+s+p+c+p+c+p+c+p+c+p+c
  elseif L9F>0 then
    set result=s+p+c+p+c+p+c+p+c+p+c+p+c
  else
    set result=c+p+c+p+c+p+c+p+c+p+c+p+c
  endif
  return result
endfunction

function LDF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real HP=(LoadReal(hashtable019,(Cache),(232)))
  local texttag tt=(LoadTextTagHandle(hashtable019,(Cache),(231)))
  local integer Count=GetTriggerEvalCount(t)
  local real LFF=RMaxIF(HP-Count,0)
  call SetTextTagText(tt,L8F(100*LFF/ HP),.018)
  call SetTextTagPosUnit(tt,Hero,0)
  call SetTextTagVisibility(tt,IsUnitVisibleLoD(Hero,GetLocalPlayer()) or IsObserver(GetLocalPlayer()))
  if LFF==0 then
    call ImitateBountyGain(GetOwningPlayer(Hero),Hero,25*Level)
  endif
  if LFF==0 or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A10R',true)
    call UnitRemoveAbility(Hero,'A10S')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call DestroyTextTag(tt)
  endif
  set t=null
  set Hero=null
  set tt=null
  return false
endfunction

function Doom_Devour takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'A10R')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real HP=GetUnitState(Target,UNIT_STATE_LIFE)
  local texttag tt=CreateTextTag()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',0,0,0)
  call ZO8("SPLK",GetUnitX(Hero),GetUnitY(Hero),GetUnitX(Target),GetUnitY(Target),.1,.1,.2,.9,.5)
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\Devour\\DevourEffectArt.mdl",GetUnitX(Target),GetUnitY(Target)))
  call SaveInteger(MHT,GetHandleId(Hero),StringHash("lasteaten"),GetUnitTypeId(Target))
  call SetTextTagText(tt,L8F(100),.018)
  call SetTextTagPosUnit(tt,Hero,0)
  call SetTextTagVisibility(tt,IsUnitVisibleLoD(Hero,GetLocalPlayer()))
  call SetTextTagPermanent(tt,true)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Hero),'A10R',false)
  call UnitAddAbility2(Hero,'A10S')
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveTextTagHandle(hashtable019,(Cache),(231),(tt))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(232),((HP)*1.))
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function LDF))
  call C5F(Hero,GetUnitTypeId(Target))
  call ShowUnit(Target,false)
  call UnitRemoveBuffs(Target,true,true)
  call UnitRemoveAbility(Target,'Aetl')
  call DamageTarget(Caster,Target,4,100000000)
  
  set t=null
  set Hero=null
  set Target=null
  set tt=null
  set Caster=null
endfunction

function Doom_Devour_Leveling takes nothing returns nothing
  call UnitAddAbility2(GetTriggerUnit(),'A10R')
  call SetUnitAbilityLevel(GetTriggerUnit(),'A10R',GetUnitAbilityLevel(GetTriggerUnit(),'A32Z'))
endfunction

function LIF takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'A10R')
  local integer integer475=LoadInteger(UnitStats,GetUnitTypeId(Target),EXP)
  if(GetOwningPlayer(Target)!=Sentinels[0]and GetOwningPlayer(Target)!=Scourges[0])and((Level==1 and integer475>41)or(Level==2 and integer475>62)or(Level==3 and integer475>88)or(Level==4 and integer475>119))then
    call InterruptUnit(Hero)
    call Error(GetOwningPlayer(Hero),GetObjectName('n0CX'))
  endif
  set Hero=null
  set Target=null
endfunction

function LJF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer id=(LoadInteger(hashtable019,(Cache),(34)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function LKF takes nothing returns nothing
  local integer id=GetSpellAbilityId()
  local trigger t
  local integer Cache
  if id=='A1OQ' or id=='A1OR' or id=='A1OS' or id=='A1OT' or id=='A1OU' or id=='A1OV' or id=='A1OW' or id=='A1OX' or id=='A1OY' or id=='S00M' or id=='A1OZ' or id=='S00N' or id=='A1P0' or id=='A1P1' or id=='A1P2' or id=='A1P3' or id=='A1P4' or id=='A1P5' or id=='A1P6' then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DEATH)
    call TriggerRegisterTimerEvent(t,1,false)
    call TriggerAddCondition(t,Condition(function LJF))
    call SaveUnitHandle(hashtable019,(Cache),(2),(GetTriggerUnit()))
    call SaveInteger(hashtable019,(Cache),(34),(id))
    set t=null
  endif
endfunction

function LNF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=LoadInteger(hashtable019,Cache,3)
  local integer bookabil
  local integer fireabil
  local integer regenabil
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    
    if Level==1 then
      set fireabil='A1OE'
      set regenabil='A1OJ'
    elseif Level==2 then
      set fireabil='A1OF'
      set regenabil='A1OH'
    elseif Level==3 then
      set fireabil='A1OG'
      set regenabil='A1OK'
    elseif Level==4 then
      set fireabil='A1OD'
      set regenabil='A1OF'
    endif
    call SetUnitAbilityLevel(Source,fireabil,1)
    call UnitMakeAbilityPermanent(Source,true,fireabil)
    call SetUnitAbilityLevel(Source,regenabil,1)
    call UnitMakeAbilityPermanent(Source,true,regenabil)
  else
    call UnitRemoveAbility(Source,'A1OL')
    call UnitRemoveAbility(Source,'A1ON')
    call UnitRemoveAbility(Source,'A1OO')
    call UnitRemoveAbility(Source,'A1OM')
    call UnitRemoveAbility(Source,'B04J')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  return false
endfunction

function Doom_ScorchedEarth takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A1OP')
  if Level==1 then
    call UnitAddAbility2(Source,'A1OL')
    call UnitMakeAbilityPermanent(Source,true,'A10E')
    call UnitMakeAbilityPermanent(Source,true,'A10J')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1OL',false)
  elseif Level==2 then
    call UnitAddAbility2(Source,'A1ON')
    call UnitMakeAbilityPermanent(Source,true,'A10F')
    call UnitMakeAbilityPermanent(Source,true,'A10H')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1ON',false)
  elseif Level==3 then
    call UnitAddAbility2(Source,'A1OO')
    call UnitMakeAbilityPermanent(Source,true,'A10G')
    call UnitMakeAbilityPermanent(Source,true,'A10K')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1OO',false)
  elseif Level==4 then
    call UnitAddAbility2(Source,'A1OM')
    call UnitMakeAbilityPermanent(Source,true,'A10D')
    call UnitMakeAbilityPermanent(Source,true,'A0FF')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1OM',false)
  endif
  call UnitMakeAbilityPermanent(Source,true,'A33I')
  call TriggerRegisterTimerEvent(t,8+2*Level,false)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function LNF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,Cache,3,Level)
  set Source=null
  set t=null
endfunction

function Doom_AghanimDoom_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=LoadUnitHandle(hashtable019,h,2)
  local unit target=LoadUnitHandle(hashtable019,h,17)
  local integer time=LoadInteger(hashtable019,h,34)
  if DistanceBetweenUnits(caster,target)>900 or IsDead(caster)==true then
    set time=time+1
    call SaveInteger(hashtable019,h,34,time)
  endif
  if time>160 then
    call UnitRemoveAbility(target,'BNdo')
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  elseif GetUnitAbilityLevel(target,'BNdo')==0 then
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  endif
  set t=null
  set caster=null
  set target=null
  return false
endfunction

function Doom_AghanimDoom_Act takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.1,true)
  call TriggerAddCondition(t,Condition(function Doom_AghanimDoom_Duration))
  call SaveUnitHandle(hashtable019,h,2,caster)
  call SaveUnitHandle(hashtable019,h,17,target)
  call SaveInteger(hashtable019,h,34,0)
  call RemovePositiveBuffs(GetSpellTargetUnit())
  call UnitRemoveBuffsEx(GetSpellTargetUnit(),true,false,true,true,false,false,false)
  set caster=null
  set target=null
  set t=null
endfunction

function LQF takes nothing returns boolean
  local real x
  local real y
  if(IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))then
    set x=JP8+GetRandomReal(20,70)*Cos(GetUnitFacing(GetTriggerUnit())*bj_DEGTORAD)
    set y=JQ8+GetRandomReal(20,70)*Sin(GetUnitFacing(GetTriggerUnit())*bj_DEGTORAD)
    call SetUnitPosition(GetFilterUnit(),x,y)
  endif
  return false
endfunction

function Magnus_ReversePolarity takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local real x=GetUnitX(Hero)
  local real y=GetUnitY(Hero)
  local group g=GetAvailableGroup()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',x,y,0)
  local integer Level=GetUnitAbilityLevel(Hero,'A29L')
  set JP8=GetUnitX(Hero)+100*Cos(GetUnitFacing(Hero)*bj_DEGTORAD)
  set JQ8=GetUnitY(Hero)+100*Sin(GetUnitFacing(Hero)*bj_DEGTORAD)
  call GroupEnumUnitsInRange(g,x,y,410+24,Condition(function LQF))
  call KillGroup(g)
  call UnitAddAbility2(Caster,'A06F')
  call SetUnitAbilityLevel(Caster,'A06F',Level)
  call IssueImmediateOrderById(Caster,852127)
  set Hero=null
  set g=null
  set Caster=null
endfunction

function LTF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  if GetUnitAbilityLevel(Target,'B00U')==0 or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitRemoveAbility(Target,'A1Q0')
    call UnitRemoveAbility(Target,'A1Q1')
    call UnitRemoveAbility(Target,'A1Q2')
    call UnitRemoveAbility(Target,'A1Q3')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  return false
endfunction

function Magnus_Empower takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A037')
  local integer A38
  local integer realID
  if Level==1 then
    set A38='A1Q0'
    set realID='A1Q0'
  elseif Level==2 then
    set A38='A1Q1'
    set realID='A1PI'
  elseif Level==3 then
    set A38='A1Q2'
    set realID='A1PY'
  elseif Level==4 then
    set A38='A1Q3'
    set realID='A1PX'
  endif
  call UnitRemoveAbility(Target,'A1Q0')
  call UnitRemoveAbility(Target,'A1Q1')
  call UnitRemoveAbility(Target,'A1Q2')
  call UnitRemoveAbility(Target,'A1Q3')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),A38,false)
  call UnitAddAbility2(Target,A38)
  call UnitMakeAbilityPermanent(Target,true,realID)
  call UnitMakeAbilityPermanent(Target,true,'A1PI')
  call UnitMakeAbilityPermanent(Target,true,'A1PX')
  call UnitMakeAbilityPermanent(Target,true,'A1PY')
  call UnitMakeAbilityPermanent(Target,true,'A1PZ')
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function LTF))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  set t=null
  set Source=null
  set Target=null
endfunction

function LWF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call UnitRemoveAbility(Target,'A1Q6')
  call UnitRemoveAbility(Target,'B0CX')
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Target=null
  return false
endfunction

function LXF takes unit Source,unit Target,integer Level returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SetUnitPathing(Target,true)
  call TriggerRegisterTimerEvent(t,2.5,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function LWF))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call UnitAddAbility2(Target,'A1Q6')
  call UnitMakeAbilityPermanent(Target,true,'A1Q6')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A1Q6',false)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl",Target,"chest"))
  call DamageTarget(Source,Target,1,70*Level)
  set t=null
endfunction

function Skewer_MOAR_Conditions takes nothing returns nothing
  local unit u = GetEnumUnit()
  
  if IsMagicImmune(u) or IsUnitType(u,UNIT_TYPE_HERO)==false then
    call GroupRemoveUnit(LoadGroupHandle(MHT,99999,99999),u)
  endif
  
  set u = null
endfunction

function LYF takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit U01=(LoadUnitHandle(hashtable019,(Cache),(393)))
  local unit U02=(LoadUnitHandle(hashtable019,(Cache),(394)))
  local unit U03=(LoadUnitHandle(hashtable019,(Cache),(395)))
  local unit U04=(LoadUnitHandle(hashtable019,(Cache),(396)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real NHE=(LoadReal(hashtable019,(Cache),(6)))
  local real NIE=(LoadReal(hashtable019,(Cache),(7)))
  local real AO8=SafeX75(NHE+19*Cos(J2E))
  local real AP8=SafeY75(NIE+19*Sin(J2E))
  local group g
  local integer L3F=(LoadInteger(hashtable019,(Cache),(12)))
  local location l
  if IsUnitType(Source,UNIT_TYPE_HERO)then
    call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
  endif
  call SetUnitPosition(Source,AO8,AP8)
  call SetUnitFacing(Source,J2E*bj_RADTODEG)
  call SaveReal(hashtable019,(Cache),(6),((AO8)*1.))
  call SaveReal(hashtable019,(Cache),(7),((AP8)*1.))
  if ModuloInteger(GetTriggerEvalCount(t),4)==0 then
    call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",AO8,AP8))
  endif
  if GetTriggerEvalCount(t)==2 then
    call SetUnitAnimationByIndex(Source,3)
  endif
  if U01==null or U02==null or U03==null or U04==null then
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,AO8,AP8,120,Condition(function DefaultEnemyFilter))
    
    call SaveGroupHandle(MHT,99999,99999,g)
    call ForGroup(g,function Skewer_MOAR_Conditions)
    call RemoveSavedHandle(MHT,99999,99999)
    
    if FirstOfGroup(g)!=null then
      if U01!=null then
        call GroupRemoveUnit(g,U01)
      endif
      if U02!=null then
        call GroupRemoveUnit(g,U02)
      endif
      if U03!=null then
        call GroupRemoveUnit(g,U03)
      endif
      if FirstOfGroup(g)!=null then
        if U01==null then
          set U01=FirstOfGroup(g)
          call SetUnitPathing(U01,false)
          call AddTimedKeyToUnit(U01,4404,5)
        elseif U02==null and Level>1 then
          set U02=FirstOfGroup(g)
          call SetUnitPathing(U02,false)
          call AddTimedKeyToUnit(U02,4404,5)
        elseif U03==null and Level>2 then
          set U03=FirstOfGroup(g)
          call SetUnitPathing(U03,false)
          call AddTimedKeyToUnit(U03,4404,5)
        elseif U04==null and Level>3 then
          set U04=FirstOfGroup(g)
          call SetUnitPathing(U04,false)
          call AddTimedKeyToUnit(U04,4404,5)
        endif
      endif
    endif
    call KillGroup(g)
    set g=null
  endif
  call SaveUnitHandle(hashtable019,(Cache),(393),(U01))
  call SaveUnitHandle(hashtable019,(Cache),(394),(U02))
  call SaveUnitHandle(hashtable019,(Cache),(395),(U03))
  call SaveUnitHandle(hashtable019,(Cache),(396),(U04))
  if U01!=null then
    if IsUnitType(U01,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(U01),99,true)
    endif
    call SetUnitPosition(U01,AO8,AP8)
  endif
  if U02!=null then
    if IsUnitType(U02,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(U02),99,true)
    endif
    call SetUnitPosition(U02,AO8,AP8)
  endif
  if U03!=null then
    if IsUnitType(U03,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(U03),99,true)
    endif
    call SetUnitPosition(U03,AO8,AP8)
  endif
  if U04!=null then
    if IsUnitType(U04,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(U04),99,true)
    endif
    call SetUnitPosition(U04,AO8,AP8)
  endif
  if ModuloInteger(GetTriggerEvalCount(t),3)==0 then
    call KillTrees(AO8,AP8,200)
  endif
  if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>L3F then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call SetUnitAnimationByIndex(Source,0)
    call SetUnitTimeScale(Source,1.)
    call SetUnitPathing(Source,true)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if U01!=null then
      if IsPointInRegion(RestrictedRegion,GetUnitX(U01),GetUnitY(U01)) then
        set l=LI8(GetUnitX(U01),GetUnitY(U01))
        if IsUnitType(U01,UNIT_TYPE_HERO)then
          call SaveBoolean(HeroStats,GetHandleId(U01),99,true)
        endif
        call SetUnitX(U01,SafeX75(GetLocationX(l)))
        call SetUnitY(U01,SafeY75(GetLocationY(l)))
        call RemoveLocation(l)
        set l=null
      endif
      call LXF(Source,U01,Level)
      call KillTrees(GetUnitX(U01),GetUnitY(U01),300)
    endif
    if U02!=null then
      if IsPointInRegion(RestrictedRegion,GetUnitX(U02),GetUnitY(U02)) then
        set l=LI8(GetUnitX(U02),GetUnitY(U02))
        if IsUnitType(U02,UNIT_TYPE_HERO)then
          call SaveBoolean(HeroStats,GetHandleId(U02),99,true)
        endif
        call SetUnitX(U02,SafeX75(GetLocationX(l)))
        call SetUnitY(U02,SafeY75(GetLocationY(l)))
        call RemoveLocation(l)
        set l=null
      endif
      call LXF(Source,U02,Level)
      call KillTrees(GetUnitX(U02),GetUnitY(U02),300)
    endif
    if U03!=null then
      if IsPointInRegion(RestrictedRegion,GetUnitX(U03),GetUnitY(U03)) then
        set l=LI8(GetUnitX(U03),GetUnitY(U03))
        if IsUnitType(U03,UNIT_TYPE_HERO)then
          call SaveBoolean(HeroStats,GetHandleId(U03),99,true)
        endif
        call SetUnitX(U03,SafeX75(GetLocationX(l)))
        call SetUnitY(U03,SafeY75(GetLocationY(l)))
        call RemoveLocation(l)
        set l=null
      endif
      call LXF(Source,U03,Level)
      call KillTrees(GetUnitX(U03),GetUnitY(U03),300)
    endif
    if U04!=null then
      if IsPointInRegion(RestrictedRegion,GetUnitX(U04),GetUnitY(U04)) then
        set l=LI8(GetUnitX(U04),GetUnitY(U04))
        if IsUnitType(U04,UNIT_TYPE_HERO)then
          call SaveBoolean(HeroStats,GetHandleId(U04),99,true)
        endif
        call SetUnitX(U04,SafeX75(GetLocationX(l)))
        call SetUnitY(U04,SafeY75(GetLocationY(l)))
        call RemoveLocation(l)
        set l=null
      endif
      call LXF(Source,U04,Level)
      call KillTrees(GetUnitX(U04),GetUnitY(U04),300)
    endif
    if U01!=null and IsDead(U01)==false then
      call IssueTargetOrderById(Source,851983,U01)
    elseif U02!=null and IsDead(U02)==false then
      call IssueTargetOrderById(Source,851983,U02)
    elseif U03!=null and IsDead(U03)==false then
      call IssueTargetOrderById(Source,851983,U03)
    elseif U04!=null and IsDead(U04)==false then
      call IssueTargetOrderById(Source,851983,U04)
    endif
    call KillTrees(AO8,AP8,375)
    if IsPointInRegion(RestrictedRegion,GetUnitX(Source),GetUnitY(Source)) then
      set l=LI8(GetUnitX(Source),GetUnitY(Source))
      if IsUnitType(Source,UNIT_TYPE_HERO)then
        call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
      endif
      call SetUnitX(Source,SafeX75(GetLocationX(l)))
      call SetUnitY(Source,SafeY75(GetLocationY(l)))
      call RemoveLocation(l)
      set l=null
    endif
  endif
  set t=null
  set Source=null
  set U01=null
  set U02=null
  set U03=null
  set U04=null
  return false
endfunction

function Magnus_Skewer takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real TargetX=SafeX75(GetSpellTargetX())
  local real TargetY=SafeY75(GetSpellTargetY())
  local unit Source=GetTriggerUnit()
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local integer Level=GetUnitAbilityLevel(Source,'A1RD')
  local real a=AngleBetweenXY(SourceX,SourceY,TargetX,TargetY)*bj_DEGTORAD
  local real range = Level*200 + 425
  if DistanceBetweenXY(SourceX,SourceY,TargetX,TargetY)>range then
    set TargetX=SafeX75(SourceX + range*Cos(a))
    set TargetY=SafeY75(SourceY + range*Sin(a))
  endif
  call SetUnitPathing(Source,false)
  call SetUnitAnimationByIndex(Source,3)
  call SetUnitTimeScale(Source,1.5)
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function LYF))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveUnitHandle(hashtable019,(Cache),(393),(null))
  call SaveUnitHandle(hashtable019,(Cache),(394),(null))
  call SaveUnitHandle(hashtable019,(Cache),(395),(null))
  call SaveUnitHandle(hashtable019,(Cache),(396),(null))
  call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
  call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
  call SaveReal(hashtable019,(Cache),(6),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(7),((SourceY)*1.))
  call SaveReal(hashtable019,(Cache),(13),((Atan2(TargetY-SourceY,TargetX-SourceX))*1.))
  call SaveInteger(hashtable019,(Cache),(12),(R2I(DistanceBetweenXY(SourceX,SourceY,TargetX,TargetY)/ 19.)))
  call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("war3mapImported\\SkewerTuskGlow_1.mdx",Source,"head")))
  set t=null
  set Source=null
endfunction

function L1F takes nothing returns boolean
  if GetSpellAbilityId()=='A1RD' then
    call SetUnitAnimationByIndex(GetTriggerUnit(),7)
  endif
  return false
endfunction

function OZ9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function L1F))
  set t=null
endfunction

function L0F takes nothing returns boolean
  local real d
  if IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(JS8)) and IsUnitInGroup(GetFilterUnit(),JU8)==false and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(JT8)) then
    set d=DistanceBetweenXY(GetUnitX(GetFilterUnit()),GetUnitY(GetFilterUnit()),GetUnitX(JS8),GetUnitY(JS8))
    if d<JV8 then
      set JR8=GetFilterUnit()
      set JV8=d
    endif
  endif
  return false
endfunction

function L5F takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local group AlreadyHit=(LoadGroupHandle(hashtable019,(Cache),(187)))
  local real L2F=(LoadReal(hashtable019,(Cache),(222)))
  local real D4G=(LoadReal(hashtable019,(Cache),(223)))
  local real D7G=(LoadReal(hashtable019,(Cache),(224)))
  local real RLD
  local group g
  local real a
  local real x
  local real y
  set a=Atan2(GetUnitY(Target)-GetUnitY(Caster),GetUnitX(Target)-GetUnitX(Caster))
  if Source==Target then
    set x=GetUnitX(Caster)+25*Cos(a)
    set y=GetUnitY(Caster)+25*Sin(a)
  else
    set x=GetUnitX(Caster)+15*Cos(a)
    set y=GetUnitY(Caster)+15*Sin(a)
  endif
  call SetUnitX(Caster,x)
  call SetUnitY(Caster,y)
  if DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))<60 then
    call SetUnitX(Caster,GetUnitX(Target))
    call SetUnitY(Caster,GetUnitY(Target))
    if Source==Target then
      call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)+L2F)
      call KillUnit(Caster)
      call KillGroup(AlreadyHit)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    else
      if IsUnitVisibleLoD(Target,GetOwningPlayer(Caster)) then
        if GetUnitAbilityLevel(Target,'A2S5')>0 then //if stoned
          call DamageTarget(Source,Target,3,(40+40*Level)+.25*D7G*(40+40*Level))
        else
          call DamageTarget(Source,Target,1,(40+40*Level)+.25*D7G*(40+40*Level))
        endif
        set D7G=D7G+1
        if GetUnitState(Target,UNIT_STATE_MANA)>0 then
          set RLD=RMinBJ(GetUnitState(Target,UNIT_STATE_MANA),(10+10*Level)+.2*D4G*(10+10*Level))
          call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)-RLD)
          call PlaySoundAtPos(sound027,GetUnitX(Target),GetUnitY(Target))
          set L2F=L2F+RLD
          set D4G=D4G+1
        endif
      endif
      call SaveReal(hashtable019,(Cache),(222),((L2F)*1.))
      call SaveReal(hashtable019,(Cache),(224),((D7G)*1.))
      call SaveReal(hashtable019,(Cache),(223),((D4G)*1.))
      set g=GetAvailableGroup()
      set JR8=null
      set JS8=Target
      set JU8=AlreadyHit
      set JV8=99999
      set JT8=Source
      call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),500,Condition(function L0F))
      call KillGroup(g)
      if JR8==null or D7G==(2+Level)then
        call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Source)))
      else
        call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(JR8)))
        call GroupAddUnit(AlreadyHit,JR8)
      endif
    endif
    call UnitAsInteger_Clear(XK8)
  endif
  set t=null
  set Source=null
  set Target=null
  set Caster=null
  set g=null
  set AlreadyHit=null
  return false
endfunction

function Medusa_MysticSnake takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A0G2')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local group g=GetAvailableGroup()
  local real D7G=0
  local real D4G=0
  local real RLD=0
  local real L2F=0
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'h090',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
  call PlaySoundAtPos(sound026,GetUnitX(Source),GetUnitY(Source))
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function L5F))
  call SaveGroupHandle(hashtable019,(Cache),(187),(g))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  call SaveReal(hashtable019,(Cache),(222),((L2F)*1.))
  call SaveReal(hashtable019,(Cache),(224),((D7G)*1.))
  call SaveReal(hashtable019,(Cache),(223),((D4G)*1.))
  call GroupAddUnit(g,Target)
  set Source=null
  set Target=null
  set Caster=null
  set t=null
  set g=null
endfunction

function Medusa_StoneGaze_NullTimers takes nothing returns nothing
  local unit u=GetEnumUnit()
  call SaveReal(hashtable019,(GetHandleId(u)),(799),0.0)
  set u=null
endfunction

function Medusa_StoneGaze_RemoveSlow takes nothing returns nothing
  local unit u=GetEnumUnit()
  call UnitRemoveAbility(u,'A2S3')
  call UnitRemoveAbility(u,'A2TM')
  call UnitRemoveAbility(u,'B0BQ')
  call SetUnitTurnSpeed(u,GetUnitDefaultTurnSpeed(u))
  set u=null
endfunction

function Medusa_StoneGaze_DamageAmplify takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=(LoadUnitHandle(hashtable019,(h),(2)))
  local unit victim=(LoadUnitHandle(hashtable019,(h),(17)))
  local integer lvl=IMaxIF(GetUnitAbilityLevel(u,'A1AT'),GetUnitAbilityLevel(u,'QB10'))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    call DisableTrigger(t)
    call DamageTarget(GetEventDamageSource(),victim,7,GetEventDamage()*(0.2+0.1*lvl))
    call EnableTrigger(t)
    if IsDead(victim)==true then
      call DestroyEffect((LoadEffectHandle(hashtable019,(h),(32))))
      call FlushChildHashtable(hashtable019,(h))
      call CleanTrigger(t)
      call UnitRemoveAbility(victim,'A2S1')
      call UnitRemoveAbility(victim,'A2TL')
    endif
  else
    call DestroyEffect((LoadEffectHandle(hashtable019,(h),(32))))
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
    call UnitRemoveAbility(victim,'A2S1')
    call UnitRemoveAbility(victim,'A2TL')
  endif
  set t=null
  set u=null
  set victim=null
  return false
endfunction

function Medusa_StoneGaze_Paralize takes unit u,unit victim returns nothing
  local trigger t
  local integer h
  local unit dummy
  if IsUnitIllusion(victim)==true then
    call KillUnit(victim)
    return
  endif
  set t=CreateTrigger()
  set h=GetHandleId(t)
  set dummy=CreateUnit(GetOwningPlayer(victim),'e00E',GetUnitX(victim),GetUnitY(victim),0)
  call UnitAddAbility(dummy,'A2S4')
  call IssueTargetOrder(dummy,"thunderbolt",victim)
  call TriggerRegisterDeathEvent(t,victim)
  call TriggerRegisterUnitEvent(t,victim,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(t,3,false)
  call TriggerAddCondition(t,Condition(function Medusa_StoneGaze_DamageAmplify))
  call SaveUnitHandle(hashtable019,(h),(2),(u))
  call SaveUnitHandle(hashtable019,(h),(17),(victim))
  call SaveEffectHandle(hashtable019,(h),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl",victim,"chest")))
  call UnitAddAbility2(victim,'A2S1')
  call UnitAddAbility2(victim,'A2TL')
  call SetPlayerAbilityAvailable(GetOwningPlayer(victim),'A2S1',false)
  set t=null
  set dummy=null
endfunction

function Medusa_StoneGaze_Targets takes nothing returns nothing
  local unit u=GetEnumUnit()
  call SaveReal(hashtable019,(GetHandleId(u)),(799),(((LoadReal(hashtable019,(GetHandleId(u)),(799)))+0.02)*1.0))
  if GetUnitAbilityLevel(u,'A2S3')==0 then
    call UnitAddAbility2(u,'A2S3')
    call UnitAddAbility2(u,'A2TM')
    call SetUnitTurnSpeed(u,GetUnitDefaultTurnSpeed(u)*0.5)
  endif
  if(LoadReal(hashtable019,(GetHandleId(u)),(799)))==2.0 then
    call Medusa_StoneGaze_Paralize(Medusa_StoneGaze_TempUnit,u)
  endif
  set u=null
endfunction

function Medusa_StoneGaze_CheckAngle takes unit u,unit victim returns boolean
  local real angle=GetAngleBetweenUnits(victim,u)
  local real face=GetUnitFacing(victim)
  local real fixface
  local real doubleFace
  local real limit1st=-1.0
  local real limit1st2=-1.0
  local real copyface
  local real fixcopyface
  local real limit2nd=-1.0
  local real limit2nd2=-1.0
  set fixface=RMaxBJ(face-85,0)
  set doubleFace=face
  if face-85<=0 then
    set limit1st=360-(85-(doubleFace-fixface))
    set limit1st2=360
  endif
  set copyface=face
  set fixcopyface=RMinBJ(face+85,360)
  if face+85>=360 then
    set limit2nd=0
    set limit2nd2=0+(85-(fixcopyface-copyface))
  endif
  if angle<0 then
    set angle=angle+360
  elseif angle>360 then
    set angle=angle-360
  endif
  if(angle>fixface and angle<doubleFace)or(limit1st!=-1 and angle>limit1st and angle<limit1st2)or(angle>copyface and angle<fixcopyface)or(limit2nd!=-1 and angle>limit2nd and angle<limit2nd2)then
    return true
  endif
  return false
endfunction

function Medusa_StoneGaze_Filter takes nothing returns boolean
  return(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and Medusa_StoneGaze_CheckAngle(tt_unit1,GetFilterUnit())
endfunction

function Medusa_StoneGaze_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local integer lvl=IMaxIF(GetUnitAbilityLevel(caster,'A1AT'),GetUnitAbilityLevel(caster,'QB10'))
  local group g=GetAvailableGroup()
  local group gg=GetAvailableGroup()
  local group ag=(LoadGroupHandle(hashtable019,(h),(187)))
  set Medusa_StoneGaze_Group=ag
  set Medusa_StoneGaze_TempUnit=caster
  set tt_unit1=caster
  call GroupEnumUnitsInRange(g,GetUnitX(caster),GetUnitY(caster),1025,Condition(function Medusa_StoneGaze_Filter))
  call ForGroup(g,function Medusa_StoneGaze_Targets)
  call GroupAddGroup(g,ag)
  call GroupAddGroup(ag,gg)
  call GroupRemoveGroup(g,gg)
  call KillGroup(g)
  call KillGroup(gg)
  call DestroyEffect((LoadEffectHandle(hashtable019,(h),(32))))
  if GetTriggerEvalCount(t)>R2I(6/0.02)then
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,(h))
    call ForGroup(ag,function Medusa_StoneGaze_RemoveSlow)
    call ForGroup(ag,function Medusa_StoneGaze_NullTimers)
    call KillGroup(ag)
  else
    call SaveEffectHandle(hashtable019,(h),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl",caster,"chest")))
  endif
  set caster=null
  set g=null
  set gg=null
  set ag=null
  set t=null
  return false
endfunction

function Medusa_StoneGaze_Start takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.02,true)
  call TriggerRegisterTimerEvent(t,0.0,false)
  call TriggerAddCondition(t,Condition(function Medusa_StoneGaze_Duration))
  call SaveUnitHandle(hashtable019,(h),(2),(GetTriggerUnit()))
  call SaveEffectHandle(hashtable019,(h),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl",GetTriggerUnit(),"chest")))
  call SaveGroupHandle(hashtable019,(h),(187),(GetAvailableGroup()))
  set t=null
endfunction

function DKG takes integer Count,unit Source,unit Target returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  if Count==0 then
    call IssueTargetOrderById(Source,851983,Target)
  elseif Count==1 then
    call UnitAddAbility2(Caster,'A0TH')
    call SetUnitAbilityLevel(Caster,'A0TH',1)
    call IssueTargetOrderById(Caster,852075,Target)
  elseif Count==2 then
    call UnitAddAbility2(Caster,'A0TH')
    call SetUnitAbilityLevel(Caster,'A0TH',1)
    call IssueTargetOrderById(Caster,852075,Target)
  elseif Count==3 then
    call UnitAddAbility2(Caster,'A0TH')
    call SetUnitAbilityLevel(Caster,'A0TH',2)
    call IssueTargetOrderById(Caster,852075,Target)
  elseif Count==4 then
    call UnitAddAbility2(Caster,'A0TH')
    call SetUnitAbilityLevel(Caster,'A0TH',3)
    call IssueTargetOrderById(Caster,852075,Target)
  elseif Count==5 then
    call UnitAddAbility2(Caster,'A0TH')
    call SetUnitAbilityLevel(Caster,'A0TH',4)
    call IssueTargetOrderById(Caster,852075,Target)
  elseif Count==6 then
    call UnitAddAbility2(Caster,'A0TH')
    call SetUnitAbilityLevel(Caster,'A0TH',5)
    call IssueTargetOrderById(Caster,852075,Target)
  endif
  set Caster=null
endfunction

function DMG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local real VUE=(10.+Level*5.)/ 100.
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    set Count=Count+1
    call DKG(Count,Source,Target)
    if Count==9 then
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    else
      call SaveInteger(hashtable019,(Cache),(34),(Count))
    endif
  elseif IsDamageReal(GetEventDamage())and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetEventDamageSource()))and IsUnitType(GetEventDamageSource(),UNIT_TYPE_STRUCTURE)==false then
    
    if IsUnitType(GetEventDamageSource(),UNIT_TYPE_HERO)or GetUnitAbilityLevel(GetEventDamageSource(),'A04R')==0 then
      call SetUnitState(GetEventDamageSource(),UNIT_STATE_LIFE,GetUnitState(GetEventDamageSource(),UNIT_STATE_LIFE)+GetEventDamage()*VUE)
    else
      call SetUnitState(udg_Hero[GetPlayerId(GetOwningPlayer(GetEventDamageSource()))],UNIT_STATE_LIFE,GetUnitState(udg_Hero[GetPlayerId(GetOwningPlayer(GetEventDamageSource()))],UNIT_STATE_LIFE)+GetEventDamage()*VUE)
    endif
    
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl",GetEventDamageSource(),"origin"))
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function DNG takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call DKG(0,Source,Target)
  call SaveInteger(hashtable019,(Cache),(375),(0))
  call SaveInteger(hashtable019,(Cache),(5),(GetUnitAbilityLevel(Source,'A194')))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterTimerEvent(t,.01,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function DMG))
  set t=null
  set Source=null
  set Target=null
endfunction

function Lifestealer_OpenWounds takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call DNG()
  endif
endfunction

function SK9 takes nothing returns nothing
  call PreloadAbility('A0TH')
endfunction

function Snatch_Damage takes nothing returns nothing
  call DamageTarget(JZ8,GetEnumUnit(),1,JA8*125+25)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Naga\\NagaBlood\\NagaBloodWindserpent.mdl",GetEnumUnit(),"overhead"))
endfunction

function Snatch_Process takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit1
  local unit Target=tt_unit2
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  call DamageTarget(Source,Target,1,Damage)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Naga\\NagaBlood\\NagaBloodWindserpent.mdl",Target,"overhead"))
  set Source=null
  set Target=null
endfunction

function DPG takes nothing returns nothing
  local unit Source=JZ8
  local unit Target=GetEnumUnit()
  local integer Level=JA8
  local trigger t=AddProjectile(Source,Target,'h0DF',"DQG",600,false)
  local integer Cache=GetHandleId(t)
  call SaveReal(hashtable019,(Cache),(20),((Level*125+25)*1.))
  set Source=null
  set Target=null
  set t=null
endfunction

function DRG takes unit Source,unit Target,integer Level returns nothing
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  set JZ8=Source
  set JA8=Level
  call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),725,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function DPG)
  call KillGroup(g)
  set g=null
endfunction

function DSG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitShareVision(Target,GetOwningPlayer(Hero),false)
    call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl",GetUnitX(Target),GetUnitY(Target)))
    call SetUnitPosition(Hero,GetUnitX(Target),GetUnitY(Target))
    call PauseUnit(Hero,false)
    call ShowUnit(Hero,true)
    call SetUnitPathing(Hero,true)
    call ClearSelectionForPlayer(GetOwningPlayer(Hero))
    call SelectUnitForPlayerSingle(Hero,GetOwningPlayer(Hero))
    call SetUnitInvulnerable(Hero,false)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(177))))
    call RemoveUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call DRG(Hero,Target,Level)
    call SaveInteger(hashtable019,(GetHandleId((Hero))),((4310)),(2))
  elseif IsUnitType(Target,UNIT_TYPE_HERO) and IsUnitEnemy(Target,GetOwningPlayer(Hero)) then
    call UnitShareVision(Target,GetOwningPlayer(Hero),false)
    call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl",GetUnitX(Target),GetUnitY(Target)))
    call SetUnitPosition(Hero,GetUnitX(Target),GetUnitY(Target))
    call PauseUnit(Hero,false)
    call ShowUnit(Hero,true)
    call SetUnitPathing(Hero,true)
    call ClearSelectionForPlayer(GetOwningPlayer(Hero))
    call SelectUnitForPlayerSingle(Hero,GetOwningPlayer(Hero))
    call SetUnitInvulnerable(Hero,false)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(177))))
    call RemoveUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call DRG(Hero,Target,Level)
    call SaveInteger(hashtable019,(GetHandleId((Hero))),((4310)),(2))
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A0SX' then
    call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl",GetUnitX(Target),GetUnitY(Target)))
    if IsUnitEnemy(Target,GetOwningPlayer(Hero))then
      call SetUnitState(Hero,UNIT_STATE_LIFE,GetUnitState(Hero,UNIT_STATE_LIFE)+GetUnitState(Target,UNIT_STATE_LIFE))
    endif
    call UnitShareVision(Target,GetOwningPlayer(Hero),false)
    call SetUnitPosition(Hero,GetUnitX(Target),GetUnitY(Target))
    call PauseUnit(Hero,false)
    call ShowUnit(Hero,true)
    call SetUnitPathing(Hero,true)
    call SetUnitAnimation(Hero,"Stand Victory")
    call BF8(Hero,1.5)
    call ClearSelectionForPlayer(GetOwningPlayer(Hero))
    call SelectUnitForPlayerSingle(Hero,GetOwningPlayer(Hero))
    call SetUnitInvulnerable(Hero,false)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(177))))
    call RemoveUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call DRG(Hero,Target,Level)
    if IsUnitEnemy(Target,GetOwningPlayer(Hero))then
      call UnitRemoveBuffs(Target,true,true)
      call E79(Target,0,0)
      call DamageTarget(Hero,Target,1,100000)
      call DamageTarget(Hero,Target,2,100000)
      call DamageTarget(Hero,Target,3,100000)
    endif
    call SaveInteger(hashtable019,(GetHandleId((Hero))),((4310)),(2))
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_SELECTED and GetTriggerUnit()==Target then
    call ClearSelectionForPlayer(GetOwningPlayer(Hero))
    call SelectUnitAddForPlayer(Caster,GetOwningPlayer(Hero))
  else
    call SetUnitPosition(Hero,GetUnitX(Target),GetUnitY(Target))
  endif
  set t=null
  set Target=null
  set Hero=null
  set Caster=null
  return false
endfunction

function Lifestealer_Infest takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e010',7260,-7732,0)
  local string DUG="Objects\\Spawnmodels\\Naga\\NagaBlood\\NagaBloodWindserpent.mdl"
  local string DVG="Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBase.mdl"
  local string DWG="Abilities\\Spells\\Other\\Aneu\\AneuTarget.mdl"
  if IsPlayerEnemy(GetLocalPlayer(),GetOwningPlayer(Hero))and IsObserver(GetLocalPlayer())==false then
    set DUG=""
    set DVG=""
    set DWG=""
  endif
  call UnitRemoveBuffs(Hero,true,true)
  call E79(Hero,0,0)
  call SetUnitInvulnerable(Caster,true)
  call UnitAddAbility2(Caster,'A0SX')
  call ClearSelectionForPlayer(GetOwningPlayer(Hero))
  call SelectUnitForPlayerSingle(Caster,GetOwningPlayer(Hero))
  call UnitShareVision(Target,GetOwningPlayer(Hero),true)
  call SetUnitInvulnerable(Hero,true)
  call ShowUnit(Hero,false)
  call PauseUnit(Hero,true)
  call SetUnitPathing(Hero,false)
  call DestroyEffect(AddSpecialEffectTarget(DUG,Target,"overhead"))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget(DVG,Target,"overhead")))
  call SaveEffectHandle(hashtable019,(Cache),(177),(AddSpecialEffectTarget(DWG,Target,"overhead")))
  call SaveInteger(hashtable019,(Cache),(5),(GetUnitAbilityLevel(Hero,'A0SW')))
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterPlayerUnitEvent(t,GetOwningPlayer(Hero),EVENT_PLAYER_UNIT_SELECTED,Condition(function ReturnTrue2))
  call TriggerRegisterUnitEvent(t,Caster,EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterTimerEvent(t,.2,true)
  call TriggerAddCondition(t,Condition(function DSG))
  call SaveInteger(hashtable019,(GetHandleId((Hero))),((4310)),(1))
  set t=null
  set Hero=null
  set Target=null
  set Caster=null
endfunction

function DYG takes nothing returns boolean
  if GetSpellAbilityId()=='A0SW' and IsUnitEnemy(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit())) and (IsUnitType(GetSpellTargetUnit(),UNIT_TYPE_HERO) or IsUnitIllusion(GetSpellTargetUnit())) then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n0LV'))
  endif
  return false
endfunction

function SJ9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function DYG))
  set t=null
endfunction

function DZG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=LoadUnitHandle(hashtable019,Cache,14)
  local string s=LoadStr(HeroStats,GetUnitTypeId(Hero),COLOR)
  local integer r=255
  local integer g=255
  local integer b=255
  if(s!="" and s!=null)then
    set r=S2I(SubString(s,0,3))
    set g=S2I(SubString(s,3,6))
    set b=S2I(SubString(s,6,9))
  endif
  call SetUnitVertexColor(Hero,r,g,b,255)
  
  call DestroyEffect(LoadEffectHandle(hashtable019,Cache,175))
  call DestroyEffect(LoadEffectHandle(hashtable019,Cache,176))
  call UnitRemoveAbility(Hero,'A0SR')
  call UnitRemoveAbility(Hero,'A0ST')
  call FlushChildHashtable(hashtable019,Cache)
  call CleanTrigger(t)
  set t=null
  set Hero=null
  return false
endfunction

function Lifestealer_Rage takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'A0T2')+GetUnitAbilityLevel(Hero,'QB0Q')
  local integer i=0
  if GetUnitAbilityLevel(Hero,'QB0Q')>0 then
    set i=-1
  endif
  call SetUnitVertexColor(Hero,0,0,0,255)
  call SetPlayerAbilityAvailable(GetOwningPlayer(Hero),'A0ST',false)
  call UnitAddAbility2(Hero,'A0ST')
  call UnitAddAbility2(Hero,'A0SR')
  call SetUnitAbilityLevel(Hero,'A0SR',Level)
  call E79(Hero,0,0)
  call SaveUnitHandle(hashtable019,h,14,Hero)
  call SaveEffectHandle(hashtable019,h,175,AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl",Hero,"right hand"))
  call SaveEffectHandle(hashtable019,h,176,AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl",Hero,"left hand"))
  call TriggerRegisterTimerEvent(t,2+Level+i,false)
  call TriggerAddCondition(t,Condition(function DZG))
  set Hero=null
  set t=null
endfunction

function DCG takes unit Source,unit Target returns nothing
  local integer Level=IMaxIF(GetUnitAbilityLevel(Source,'A0SS'),GetUnitAbilityLevel(Source,'QP1W'))
  local real Damage
  if(not(Mode_BO))and(IsUnitIdType(GetUnitTypeId(Source),UNIT_TYPE_RANGED_ATTACKER))then
    set Damage=(FeastBaseForRanged+.01*Level)*GetUnitState(Target,UNIT_STATE_LIFE)
  else
    set Damage=(.03+.01*Level)*GetUnitState(Target,UNIT_STATE_LIFE)
  endif
  if GetUnitAbilityLevel(Target,'A04R')==0 and GetUnitAbilityLevel(Source,'BNdo')==0 then
    if GetUnitAbilityLevel(Source,'P067')+GetUnitAbilityLevel(Source,'P611')+GetUnitAbilityLevel(Source,'QP0A')>0 then //check for fury swipes
      call DamageTarget(CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0),Target,2,Damage)
    else
      call DamageTarget(Source,Target,2,Damage)
    endif
    call SetUnitState(Source,UNIT_STATE_LIFE,Damage+GetUnitState(Source,UNIT_STATE_LIFE))
    //call echo("Feast just heals")
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl",Source,"origin"))
  endif
endfunction

function D3G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer XK8=LoadInteger(hashtable019,Cache,30)
  local unit Target=UnitAsInteger_Load(XK8)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source then
      call DisableTrigger(t)
      call DCG(Source,Target)
      call UnitAsInteger_Clear(XK8)
      call FlushChildHashtable(hashtable019,Cache)
      call CleanTrigger(t)
    endif
  else
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,Cache)
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function D6G takes nothing returns nothing
  local trigger t=CreateTrigger()
  local unit Target=GetTriggerUnit()
  local unit Source=GetAttacker()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(t,1,false)
  call TriggerAddCondition(t,Condition(function D3G))
  call SaveInteger(hashtable019,Cache,30,UnitAsInteger_Save(Target))
  call SaveUnitHandle(hashtable019,Cache,2,Source)
  set Target=null
  set Source=null
  set t=null
endfunction

function DLG takes nothing returns nothing
  local unit Source=GetAttacker()
  if (LoadInteger(hashtable019,GetHandleId(Source),4274)==1)==false then
    call AddTimedKeyToUnit(Source,4274,.4)
    call D6G()
  endif
  set Source=null
endfunction

function D1G takes nothing returns boolean
  if IMaxIF(GetUnitAbilityLevel(GetAttacker(),'A0SS'),GetUnitAbilityLevel(GetAttacker(),'QP1W'))>0  and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetAttacker()==(LoadUnitHandle(hashtable019,GetHandleId(GetTriggeringTrigger()),14))and GetUnitTypeId(GetTriggerUnit())!='n00L' and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))then
    call DLG()
  endif
  return false
endfunction

function Lifestealer_Feast_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function D1G))
  call SaveUnitHandle(hashtable019,GetHandleId(t),14,GetTriggerUnit())
  set t=null
endfunction

function Lifestealer_Feast_Reg takes nothing returns boolean
  if (GetLearnedSkill()=='A0SS' or GetLearnedSkill()=='QP1W') and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Lifestealer_Feast_Learn()
  endif
  return false
endfunction

function Lifestealer_Feast_InitTrig takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Lifestealer_Feast_Reg))
  set t=null
endfunction

function Necrolyte_Heartstopper_ForGroup takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local real hp=GetUnitState(Target,UNIT_STATE_LIFE)
  local real maxhp=GetUnitState(Target,UNIT_STATE_MAX_LIFE)
  local real dmg=0.003*Necrolyte_Heartstopper_Lvl*maxhp/2
  if hp<dmg then
    call SetUnitState(Target,UNIT_STATE_LIFE,1)
    call DamageTarget(Necrolyte_Heartstopper_Caster,Target,1,100)
    call DamageTarget(Necrolyte_Heartstopper_Caster,Target,2,100)
    call DamageTarget(Necrolyte_Heartstopper_Caster,Target,3,100)
  else
    call SetUnitState(Target,UNIT_STATE_LIFE,RMaxIF(GetUnitState(Target,UNIT_STATE_LIFE)-dmg,1))
  endif
  set Target=null
endfunction

function Necrolyte_Heartstopper_Filter takes nothing returns boolean
  return((IsUnitEnemy(Necrolyte_Heartstopper_Caster,GetOwningPlayer(GetFilterUnit()) )and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and GetUnitAbilityLevel(GetFilterUnit(),'B084')>0)!=null
endfunction

function Necrolyte_Heartstopper_Tick takes nothing returns nothing
  local integer h=GetHandleId(GetExpiredTimer())
  local unit Source=LoadUnitHandle(hashtable019,h,2)
  local group g
  if IsDead(Source)==false then
    set g=GetAvailableGroup()
    set Necrolyte_Heartstopper_Caster=Source
    set Necrolyte_Heartstopper_Lvl=GetUnitAbilityLevel(Source,'P302')+1 //A01N
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1025,Condition(function Necrolyte_Heartstopper_Filter))
    call ForGroup(g,function Necrolyte_Heartstopper_ForGroup)
    call KillGroup(g)
  endif
  set g=null
  set Source=null
endfunction

function Necrolyte_Heartstopper_Learn takes nothing returns nothing
  local timer t=CreateTimer()
  call TimerStart(t,.5,true,function Necrolyte_Heartstopper_Tick)
  call SaveUnitHandle(hashtable019,GetHandleId(t),2,GetTriggerUnit())
  set t=null
endfunction

function Necrolyte_Heartstopper_Register takes nothing returns boolean
  if (GetLearnedSkill()=='A01N' or GetLearnedSkill()=='QP11') and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call Necrolyte_Heartstopper_Learn()
  endif
  return false
endfunction

function Necrolyte_Heartstopper_InitTrig takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Necrolyte_Heartstopper_Register))
  set t=null
endfunction


function Sadist_Dur takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local unit u = LoadUnitHandle(MHT,info,0)
  local integer c=LoadInteger(MHT,info,2)+1
  //call UnitRemoveBuffs(u,true,true)
  //call LoDStat_Sub(u,LoadInteger(MHT,info,0),"regen")
  //call LoDStat_Sub(u,LoadInteger(MHT,info,1),"manaregen")
  if IsDead(u) or c>6*10 then
    call Timer_End(t)
  else
    call SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_LIFE)+LoadInteger(MHT,info,0)*0.1)
    call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MANA)+LoadInteger(MHT,info,1)*0.1)
    call SaveInteger(MHT,info,2,c)
  endif
  set t = null
  set u = null
endfunction

function Sadist_Start takes unit u, integer level, boolean b returns nothing
  local timer t = Timer_Get()
  local integer info = GetHandleId(t)
  local integer amount = level*2
  if amount==8 then
    set amount=10
  endif
  if b then
    set amount=amount*10
    set level=level*10
  endif
  call Buff_Add(u,LoDBuff_AbilID[12],LoDBuff_BuffID[12],6)
  call echo(I2S(amount)+" mp/s; "+I2S(level)+" hp/s")
  //call LoDStat_Add(u,level,"regen")
  //call LoDStat_Add(u,amount,"manaregen")
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl",u,"origin"))
  call SaveUnitHandle(MHT,info,0,u)
  call SaveInteger(MHT,info,0,level)
  call SaveInteger(MHT,info,1,amount)
  call TimerStart(t,0.1,true,function Sadist_Dur)
  set t = null
endfunction

function Sadist_Condition takes nothing returns nothing
  local unit u = udg_Hero[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]
  local integer level
  if IsUnitIllusion(GetTriggerUnit()) then
    set u=null
    return
  endif
  if LoadInteger(hashtable019,GetHandleId(GetTriggerUnit()),4333)==1 then
    set u=udg_Hero[GetPlayerId(LoadPlayerHandle(hashtable019,GetHandleId(GetTriggerUnit()),4333))]
  endif
  set level=GetUnitAbilityLevel(u,'P303') //A060
  if level > 0 and IsDead(u)==false then
    call Sadist_Start(u,level,IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true)
  endif
  set u = null
endfunction

function O39 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Sadist_Condition))
  set t = null
endfunction


function DQG takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit1
  local unit Target=tt_unit2
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  local real DJF=(LoadReal(hashtable019,(Cache),(21)))
  if IsUnitAlly(Target,GetOwningPlayer(Source))then
    call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+DJF)
  else
    call DamageTarget(Source,Target,1,Damage)
  endif
  set Source=null
  set Target=null
endfunction

function EGG takes nothing returns nothing
  local trigger t=AddProjectile(tt_unit1,GetEnumUnit(),'h00W',"DQG",400,false)
  local integer Cache=GetHandleId(t)
  call SaveReal(hashtable019,(Cache),(20),((tt_real1)*1.))
  call SaveReal(hashtable019,(Cache),(21),((real084)*1.))
  set t=null
endfunction

function EHG takes nothing returns nothing
  if IsUnitVisibleLoD(GetEnumUnit(),GetOwningPlayer(tt_unit1))or (IsUnitFogged(GetEnumUnit(),GetOwningPlayer(tt_unit1)) and GenericCondition_IsDotAInvis(GetEnumUnit())==false)then
    call EGG()
  endif
endfunction

function Necrolyte_DeathPulse takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local group g=GetAvailableGroup()
  local integer Level=GetUnitAbilityLevel(Hero,'A05V')
  local real r = 500
  local real Damage
  if Level==1 then
    set Damage=75
  elseif Level==2 then
    set Damage=125
  elseif Level==3 then
    set Damage=200
  elseif Level==4 then
    set Damage=275
  endif
  set tt_unit1=Hero
  set tt_real1=Damage
  set real084=50 + 20*Level
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),r,Condition(function DH9))
  call GroupRemoveUnit(g,Hero)
  call ForGroup(g,function EHG)
  call KillGroup(g)
  call SetUnitState(Hero,UNIT_STATE_LIFE,GetUnitState(Hero,UNIT_STATE_LIFE)+real084)
  set Hero=null
  set g=null
endfunction

function integers134 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real VUE=(LoadReal(hashtable019,(Cache),(680)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",Target,"origin"))
  call DamageTarget(Source,Target,1,VUE*(GetUnitState(Target,UNIT_STATE_MAX_LIFE)-GetUnitState(Target,UNIT_STATE_LIFE)))
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function gamecache002 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer ENG=GetUnitAbilityLevel(Source,'A067')
  local integer gamecache005=GetUnitAbilityLevel(Source,'A08P')
  local real VUE
  if ENG==1 then
    set VUE=.4
  elseif ENG==2 or gamecache005==1 then
    set VUE=.6
  elseif ENG==3 or gamecache005==2 then
    set VUE=.9
  elseif gamecache005==3 then
    set VUE=1.2
  endif
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(680),((VUE)*1.))
  call TriggerRegisterTimerEvent(t,1.,false)
  call TriggerAddCondition(t,Condition(function integers134))
  call AddTimedKeyToUnit(Target,4333,1.5)
  call SavePlayerHandle(hashtable019,GetHandleId(Target),4333,GetOwningPlayer(Source))
  if gamecache005>0 then
    call AddTimedKeyToUnit(Target,4418,1.51)
  endif
  set t=null
  set Source=null
  set Target=null
endfunction

function Necrolyte_ReapersScythe takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call gamecache002()
  endif
endfunction

function NA_Impale takes nothing returns nothing
  //local location l
  local unit Hero=GetTriggerUnit()
  local real x1=GetUnitX(Hero)
  local real y1=GetUnitY(Hero)
  local real a
  local real x2
  local real y2
  local integer Level=GetUnitAbilityLevel(Hero,'A0X7')
  local real Damage
  local real DP9
  local unit D09=null
  if GetSpellTargetUnit()!=null then
    //set l=GetUnitLoc(GetSpellTargetUnit())
    set x2=GetUnitX(GetSpellTargetUnit())
    set y2=GetUnitY(GetSpellTargetUnit())
  else
    //set l=GetSpellTargetLoc()
    set x2=GetSpellTargetX()
    set y2=GetSpellTargetY()
  endif
  set a=Atan2(y2-y1,x2-x1)
  set x2=x1+700*Cos(a)
  set y2=y1+700*Sin(a)
  if Level==1 then
    set Damage=80
    set DP9=.75
  elseif Level==2 then
    set Damage=140
    set DP9=1.25
  elseif Level==3 then
    set Damage=200
    set DP9=1.75
  elseif Level==4 then
    set Damage=260
    set DP9=2.25
  endif
  if GetSpellTargetUnit()!=null and IsBlocked(GetSpellTargetUnit())then
    set D09=GetSpellTargetUnit()
  endif
  call D19(Hero,D09,Damage,DP9,.52,x1,y1,x2,y2,150,null,true,1600)
  //call RemoveLocation(l)
  //set l=null
  set Hero=null
  set D09=null
endfunction

function ESG takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real r=GetHeroInt(Target,true)*(3+0.5*GetUnitAbilityLevel(Source,'A1H5'))
  local integer M7E=IMinBJ(R2I(r),R2I(GetUnitState(Target,UNIT_STATE_MANA)))
  call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)-M7E)
  call DamageTarget(Source,Target,1,M7E)
  call CR8("MBUR",Source,Target,1,1,1,1,.5)
  call TextTagOnUnit("-"+I2S(M7E),3,Target,.023,82,82,255,255)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ManaBurn\\ManaBurnTarget.mdl",Target,"chest"))
  set Source=null
  set Target=null
endfunction

function NA_Manaburn takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call ESG()
  endif
endfunction

function SU9 takes nothing returns nothing
  call PreloadAbility('A1GG')
endfunction

function Spiked_Carapace_End takes trigger trig, unit u, integer info returns nothing
  call Buff_Remove(u,LoDBuff_BuffID[8])
  
  call DestroyEffect(LoadEffectHandle(hashtable019,info,3))
  call DestroyEffect(LoadEffectHandle(hashtable019,info,4))
  call DestroyEffect(LoadEffectHandle(hashtable019,info,5))
  call DestroyEffect(LoadEffectHandle(hashtable019,info,6))
  call KillGroup(LoadGroupHandle(hashtable019,info,7))
  call FlushChildHashtable(hashtable019,info)
  call CleanTrigger(trig)
endfunction

function A94 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target
  local integer Level=GetUnitAbilityLevel(Source,'A2KO')
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamage()>0 and IsPlayerEnemy(GetOwningPlayer(GetEventDamageSource()),GetOwningPlayer(Source))==true and IsRealDamage and IsUnitInGroup(udg_Hero[GetPlayerId(GetOwningPlayer(GetEventDamageSource()))],LoadGroupHandle(hashtable019,Cache,7))==false then
      if IsPlayerBelongToTeams(GetOwningPlayer(GetEventDamageSource()))and IsDamageReal(GetEventDamage())then
        call HealUnitFor(Source,GetEventDamage())
        if GetUnitAbilityLevel(GetEventDamageSource(),'A04R')>0 or GetUnitAbilityLevel(GetEventDamageSource(),'Aloc')>0 then
          set Target=udg_Hero[GetPlayerId(GetOwningPlayer(GetEventDamageSource()))]
        else
          set Target=GetEventDamageSource()
        endif
        call GroupAddUnit(LoadGroupHandle(hashtable019,Cache,7),Target)
        if IsDead(Target)==false then
          call StunTarget(Source,Target,0.6*Level)
          call DamageTarget(Source,Target,3,GetEventDamage())
        endif
      endif
    endif
  else
    call Spiked_Carapace_End(t,Source,Cache)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function NA_SpikedCarapace takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,2.25,false)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function A94))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  
  call Buff_Add(Source,LoDBuff_AbilID[8],LoDBuff_BuffID[8],2.75)
  
  call SaveGroupHandle(hashtable019,Cache,7,GetAvailableGroup())
  call SaveEffectHandle(hashtable019,Cache,3,AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestLeft.mdl",Source,"chest,left"))
  call SaveEffectHandle(hashtable019,Cache,4,AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestRight.mdl",Source,"chest,right"))
  call SaveEffectHandle(hashtable019,Cache,5,AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestMountLeft.mdl",Source,"mount,left"))
  call SaveEffectHandle(hashtable019,Cache,6,AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ThornyShield\\ThornyShieldTargetChestMountRight.mdl",Source,"mount,right"))
  
  set Source=null
  set t=null
endfunction


function EXG takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit2
  local unit Target=tt_unit1
  local integer EYG
  local integer EZG
  local integer Level
  if GetUnitAbilityLevel(Source,'A04R')!=0 then
    set Source=udg_Hero[GetPlayerId(GetOwningPlayer(Source))]
  endif
  set EYG=GetUnitAbilityLevel(Source,'A0CQ')
  set Level=GetUnitAbilityLevel(Source,'A0BR')
  if Level==1 then
    set EZG=12
  elseif Level==2 then
    set EZG=20
  elseif Level==3 then
    set EZG=28
  else
    set EZG=36
  endif
  set EZG=EZG+1
  if IsUnitType(Target,UNIT_TYPE_HERO)==false then
    set EYG=EYG+1
  else
    set EYG=EYG+12
  endif
  set EYG=IMinBJ(EZG,EYG)
  call SetUnitAbilityLevel(Source,'A0CQ',EYG)
  call SaveInteger(hashtable019,(GetHandleId(Source)),(710),(EYG))
  set Source=null
  set Target=null
endfunction

function gamecache004 takes nothing returns nothing
  local integer EYG
  local integer Level
  local integer EZG
  local trigger t
  local integer Cache
  local unit Source=GetKillingUnit()
  if GetUnitTypeId(Source)=='e00E' then
    set Source=udg_Hero[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]
  endif
  set EYG=GetUnitAbilityLevel(Source,'A0CQ')
  set Level=GetUnitAbilityLevel(Source,'A0BR')
  if Level==1 then
    set EZG=12
  elseif Level==2 then
    set EZG=20
  elseif Level==3 then
    set EZG=28
  else
    set EZG=36
  endif
  if EYG<=EZG then
    set t=AddProjectile(GetTriggerUnit(),Source,'h0CR',"EXG",500,false)
    set Cache=GetHandleId(t)
    set t=null
    call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\ZigguratMissile\\ZigguratMissile.mdl",GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit())))
  endif
  set Source=null
endfunction

function EBG takes nothing returns nothing
  call SaveInteger(hashtable019,(GetHandleId(GetTriggerUnit())),(710),(R2I(GetUnitAbilityLevel(GetTriggerUnit(),'A0CQ')*.5)+1))
  call SetUnitAbilityLevel(GetTriggerUnit(),'A0CQ',R2I(GetUnitAbilityLevel(GetTriggerUnit(),'A0CQ')*.5)+1)
endfunction

function gamecache003 takes nothing returns boolean
  local unit k=GetKillingUnit()
  if IsUnitType(k,UNIT_TYPE_HERO)==false then//[lich] added support for any dummy
    set k=udg_Hero[GetPlayerId(GetOwningPlayer(k))]
  endif
  //if GetUnitTypeId(k)=='e00E' then 
  //	set k=udg_Hero[GetPlayerId(GetOwningPlayer(k))]
  //endif
  if GetUnitAbilityLevel(k,'A0BR')>0 and IsUnitIllusion(GetTriggerUnit())==false then
    call gamecache004()
  endif
  if GetUnitAbilityLevel(GetTriggerUnit(),'A0BR')>0 and IsUnitIllusion(GetTriggerUnit())==false then
    call EBG()
  endif
  set k=null
  return false
endfunction

function integers136 takes nothing returns boolean
  local unit Hero=udg_Hero[GetPlayerId(GetTriggerPlayer())]
  local integer E6G=GetUnitAbilityLevel(Hero,'A0CQ')-1
  local integer ELG=0
  local integer Level=GetUnitAbilityLevel(Hero,'A0BR')
  if Level==1 then
    set ELG=12
  elseif Level==2 then
    set ELG=20
  elseif Level==3 then
    set ELG=28
  elseif Level==4 then
    set ELG=36
  endif
  set E6G=IMaxBJ(IMinBJ(E6G,ELG),0)
  if isPlayerPickedAbility(GetTriggerPlayer(),318)and E6G>0 then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetObjectName('n0KE')+" "+I2S(E6G)+"/"+I2S(ELG))
  endif
  set Hero=null
  return false
endfunction

function O09 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function gamecache003))
  set t=CreateTrigger()
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-st",true)
  call TriggerAddCondition(t,Condition(function integers136))
  set t=null
endfunction


function Shadowraze_Filter takes nothing returns boolean
  return IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0
endfunction

function Shadowraze_Damage takes nothing returns nothing
  call DamageTarget(Shadowraze_Source,GetEnumUnit(),1,75*Shadowraze_Level)
endfunction

function Shadowraze_Cast takes nothing returns boolean
  local unit Hero=GetTriggerUnit()
  local real range
  local real a
  local real x
  local real y
  local group g=GetAvailableGroup()
  
  if GetUnitAbilityLevel(Hero,'A04R')>0 then // multicast
    set Hero=udg_Hero[GetPlayerId(GetOwningPlayer(Hero))]
  endif
  
  if GetSpellAbilityId()=='A0EY'then
    set range = 200
  elseif GetSpellAbilityId()=='A0FH'then
    set range = 450
  elseif GetSpellAbilityId()=='A0F0'then
    set range = 700
  endif
  
  set a = GetUnitFacing(Hero)
  set x = GetWidgetX(Hero) + range*Cos(a*bj_DEGTORAD)
  set y = GetWidgetY(Hero) + range*Sin(a*bj_DEGTORAD)
  set Shadowraze_Source=Hero
  set Shadowraze_Level=GetUnitAbilityLevel(Hero,GetSpellAbilityId())
  
  call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(Hero),'e006',x,y,0),'BTLF',2)
  call GroupEnumUnitsInRange(g,x,y,275,Condition(function Shadowraze_Filter))
  call ForGroup(g,function Shadowraze_Damage)
  call KillGroup(g)
  
  set Hero = null
  set g=null
  return false
endfunction

function F4G takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local integer skill = GetLearnedSkill()
  local integer level = GetLearnedSkillLevel()
  
  if skill=='A0EY'then
    if level==1 then
      call UnitAddAbility2(u,'A0F0')
      call UnitAddAbility2(u,'A0FH')
    else
      call SetUnitAbilityLevel(u,'A0F0',level)
      call SetUnitAbilityLevel(u,'A0FH',level)
    endif
  elseif skill=='A0BR' and level==1 then
    call UnitAddAbility2(u,'A0CQ')
  endif
  
  set u = null
endfunction

function NL takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddAction(t,function F4G)
  call PreloadAbility('A0CQ')
  set t = null
endfunction


function Requiem_Start takes unit u, integer max returns nothing
  local real x = GetWidgetX(u)
  local real y = GetWidgetY(u)
  local unit d = CreateUnit(GetOwningPlayer(u),'e00E',x,y,0)
  local integer loopA = 0
  local integer angle = 360/max
  local integer level = GetUnitAbilityLevel(u,'A29J')
  
  call UnitAddAbility(d,'A0HG')
  call SetUnitAbilityLevel(d,'A0HG',level)
  
  loop
    exitwhen loopA > max
    call IssuePointOrderById(d,852218,x+50*Cos(bj_DEGTORAD*loopA*angle),y+50*Sin(bj_DEGTORAD*loopA*angle))
    set loopA = loopA + 1
  endloop
  
  set d = null
endfunction

function Requiem_Condition takes nothing returns boolean
  local unit u = GetTriggerUnit()
  
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_DEATH and (GetUnitAbilityLevel(u,'A29J')>0 or GetUnitAbilityLevel(u,'A1MP')>0) then
    call Requiem_Start(u,9)
  elseif GetSpellAbilityId()=='A29J'then
    call Requiem_Start(u,18)
  endif
  
  set u = null
  return false
endfunction

function O29 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Requiem_Condition))
  set t = null
endfunction



function FEG takes nothing returns boolean
  return(( not(IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)))and( not(GetUnitAbilityLevelSwapped('A04R',GetFilterUnit())==1))and( not(IsUnitAliveBJ(GetFilterUnit())==false))and( not(GetUnitTypeId(GetFilterUnit())=='o003'))and( not(IsUnitEnemy(GetFilterUnit(),GetTriggerPlayer())==false))and( not(GetTriggerUnit()==GetFilterUnit()))and( not(IsUnitVisibleLoD(GetFilterUnit(),GetTriggerPlayer())==false)))!=null
endfunction

function FFG takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local location YT9=GetUnitLoc(XX8)
  local integer Level=GetUnitAbilityLevelSwapped('A29J',GetTriggerUnit())
  if Level==0 then
    set Level=GetUnitAbilityLevelSwapped('A1MP',GetTriggerUnit())
  endif
  call CreateNUnitsAtLoc(1,'e00C',GetOwningPlayer(XX8),YT9,bj_UNIT_FACING)
  call UnitAddAbility(bj_lastCreatedUnit,'A0HH')
  call SetUnitAbilityLevelSwapped('A0HH',bj_lastCreatedUnit,Level)
  call UnitApplyTimedLifeBJ(2.,'BTLF',bj_lastCreatedUnit)
  call IssueTargetOrderById(bj_lastCreatedUnit,852189,GetEnumUnit())
  call SetUnitPathing(bj_lastCreatedUnit,false)
  call SetUnitInvulnerable(bj_lastCreatedUnit,true)
  call UnitAddAbility(bj_lastCreatedUnit,'Aloc')
  call RemoveLocation(YT9)
  set YT9=null
  set XX8=null
endfunction

function FGG takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local location YT9=GetUnitLoc(XX8)
  local integer Level=GetUnitAbilityLevelSwapped('A29J',GetTriggerUnit())
  if Level==0 then
    set Level=GetUnitAbilityLevelSwapped('A1MP',GetTriggerUnit())
  endif
  call CreateNUnitsAtLoc(1,'e00C',GetOwningPlayer(XX8),YT9,bj_UNIT_FACING)
  call UnitAddAbility(bj_lastCreatedUnit,'A0HH')
  call SetUnitAbilityLevelSwapped('A0HH',bj_lastCreatedUnit,Level)
  call UnitApplyTimedLifeBJ(2.,'BTLF',bj_lastCreatedUnit)
  call IssueTargetOrderById(bj_lastCreatedUnit,852189,GetEnumUnit())
  call SetUnitPathing(bj_lastCreatedUnit,false)
  call SetUnitInvulnerable(bj_lastCreatedUnit,true)
  call UnitAddAbility(bj_lastCreatedUnit,'Aloc')
  call RemoveLocation(YT9)
  set YT9=null
  set XX8=null
endfunction

function FHG takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local location YT9=GetUnitLoc(XX8)
  local integer Level=GetUnitAbilityLevelSwapped('A29J',GetTriggerUnit())
  if Level==0 then
    set Level=GetUnitAbilityLevelSwapped('A1MP',GetTriggerUnit())
  endif
  call CreateNUnitsAtLoc(1,'e00C',GetOwningPlayer(XX8),YT9,bj_UNIT_FACING)
  call UnitAddAbility(bj_lastCreatedUnit,'A0HH')
  call SetUnitAbilityLevelSwapped('A0HH',bj_lastCreatedUnit,Level)
  call UnitApplyTimedLifeBJ(2.,'BTLF',bj_lastCreatedUnit)
  call IssueTargetOrderById(bj_lastCreatedUnit,852189,GetEnumUnit())
  call SetUnitPathing(bj_lastCreatedUnit,false)
  call SetUnitInvulnerable(bj_lastCreatedUnit,true)
  call UnitAddAbility(bj_lastCreatedUnit,'Aloc')
  call RemoveLocation(YT9)
  set YT9=null
  set XX8=null
endfunction

function SF_RequiemOfSouls takes nothing returns nothing
  local location YT9=GetUnitLoc(GetTriggerUnit())
  local unit XX8=GetTriggerUnit()
  local group HQ9
  set HQ9=GetAvailableGroup()
  call GroupEnumUnitsInRangeOfLoc(HQ9,YT9,700,Condition(function FEG))
  call ForGroup(HQ9,function FFG)
  call KillGroup(HQ9)
  set HQ9=GetAvailableGroup()
  call GroupEnumUnitsInRangeOfLoc(HQ9,YT9,400,Condition(function FEG))
  call ForGroup(HQ9,function FGG)
  call KillGroup(HQ9)
  set HQ9=GetAvailableGroup()
  call GroupEnumUnitsInRangeOfLoc(HQ9,YT9,200,Condition(function FEG))
  call ForGroup(HQ9,function FHG)
  call KillGroup(HQ9)
  call RemoveLocation(YT9)
  set YT9=null
  set XX8=null
  set HQ9=null
endfunction

function NightHunter_Void takes nothing returns nothing
  local unit Caster
  if(IsDayTime()==false)then
    set Caster=CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E',GetUnitX(GetSpellTargetUnit()),GetUnitY(GetSpellTargetUnit()),bj_UNIT_FACING)
    call UnitAddAbility2(Caster,'A02R')
    call IssueTargetOrderById(Caster,852075,GetSpellTargetUnit())
  else
    set Caster=CreateUnit(GetOwningPlayer(GetTriggerUnit()),'e00E',GetUnitX(GetSpellTargetUnit()),GetUnitY(GetSpellTargetUnit()),bj_UNIT_FACING)
    call UnitAddAbility2(Caster,'A1H1')
    call IssueTargetOrderById(Caster,852075,GetSpellTargetUnit())
  endif
  set Caster=null
endfunction

function FMG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  call ResetUnitAnimation(Source)
  call RemoveUnit(Caster)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set Source=null
  set Caster=null
  set t=null
  return false
endfunction

function FNG takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'u01I',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerAddCondition(t,Condition(function FMG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SetUnitVertexColorBJ(Caster,0,0,0,75)
  call SetUnitAnimation(Caster,"spell third")
  set Source=null
  set Caster=null
  set t=null
endfunction

function FOG takes nothing returns boolean
  if GetSpellAbilityId()=='A08C' and GetUnitAbilityLevel(GetTriggerUnit(),'A08C')<5 then
    call FNG()
  endif
  return false
endfunction

function P99 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function FOG))
  set t=null
endfunction

function FPG takes nothing returns boolean
  return(GetLearnedSkill()=='QP0T'or GetLearnedSkill()=='A086' or GetLearnedSkill()=='A08E')and IsUnitIllusion(GetTriggerUnit())==false
endfunction

function FQG takes nothing returns boolean
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit stalker=(LoadUnitHandle(hashtable019,(Cache),(304)))
  local unit dummy=(LoadUnitHandle(hashtable019,(Cache),(305)))
  if GetTriggerEvalCount(GetTriggeringTrigger())==1 then
    call UnitAddAbility(dummy,'Aloc')
  endif
  if stalker==null or IsDead(stalker)or IsDayTime() or GetUnitAbilityLevel(stalker,'DRKN')==0 then
    call ShowUnit(dummy,false)
  else
    call ShowUnit(dummy,true)
    call SetUnitX(dummy,GetUnitX(stalker))
    call SetUnitY(dummy,GetUnitY(stalker))
  endif
  if GetOwningPlayer(dummy)!=GetOwningPlayer(stalker)then
    call SetUnitOwner(dummy,GetOwningPlayer(stalker),true)
  endif
  set stalker=null
  set dummy=null
  return false
endfunction

function FTG takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit FRG=(LoadUnitHandle(hashtable019,(Cache),(304)))
  local integer lvl=GetUnitAbilityLevel(FRG,'A086')
  if lvl==0 and GetUnitAbilityLevel(FRG,'QP0T')>0 then
    set lvl=GetUnitAbilityLevel(FRG,'QP0T')
  endif
  if FRG!=null and IsDayTime()and IsDead(FRG)==false then
    call UnitRemoveAbility(FRG,'A116')
    call UnitRemoveAbility(FRG,'A117')
    call SetUnitAbilityLevel(FRG,'S00A',5) //S00A
    call SetPlayerAbilityAvailable(GetOwningPlayer(FRG),'S00A',false)
    call UnitRemoveAbility(FRG,'B02L')
    //call UnitRemoveAbility(FRG,'Q247')
    call SetUnitAbilityLevel(FRG,'P247',5) //S00A
    call SetUnitAbilityLevel(FRG,'A08C',5)
  elseif FRG!=null and IsDayTime()==false and IsDead(FRG)==false then
    call UnitAddAbility2(FRG,'A116')
    call UnitAddAbility2(FRG,'A117')
    call SetPlayerAbilityAvailable(GetOwningPlayer(FRG),'S00A',true)
    //call UnitAddAbility2(FRG,'Q247')
    call SetPlayerAbilityAvailable(GetOwningPlayer(FRG),'Q247',false)
    call SetUnitAbilityLevel(FRG,'S00A',lvl) //S00A
    call SetUnitAbilityLevel(FRG,'P247',lvl) //S00A
    call SetUnitAbilityLevel(FRG,'A08C',GetUnitAbilityLevel(FRG,'A08E'))
  endif
  set FRG=null
endfunction

function NighthunterFixS5 takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggerUnit())
  local unit u=GetTriggerUnit()
  local integer lvl=TempInteger
  call UnitAddAbility2(u,'P247') //dummy ability used to provide icon
  if(IsDayTime())then
    call SetUnitAbilityLevel(u,'P247',5) //S00A
  else
    call SetUnitAbilityLevel(u,'P247',lvl) //S00A
  endif
  set u=null
endfunction

function NightStalker_NightHunter_Leveling takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggerUnit())
  local trigger t
  local unit u=GetTriggerUnit()
  local integer lvl=IMaxIF(GetUnitAbilityLevel(u,'A086'),GetUnitAbilityLevel(u,'QP0T'))
  //	if((LoadBoolean(HY,(Cache),(306)))==false)then
  //		call SaveBoolean(HY,(Cache),(306),(true))
  //		set t=CreateTrigger()
  //		call TriggerRegisterTimerEventPeriodic(t,2.)
  //		call TriggerRegisterGameStateEventTimeOfDay(t,LESS_THAN,6.)
  //		call TriggerRegisterGameStateEventTimeOfDay(t,GREATER_THAN,18.)
  //		call TriggerAddAction(t,function FTG)
  //		call SaveUnitHandle(HY,(GetHandleId(t)),(304),(u))
  //		
  //	endif
  if(GetLearnedSkill()=='A086' or GetLearnedSkill()=='QP0T')then
    call UnitAddAbility2(u,'P247') //dummy ability used to provide icon
    //		if GetLearnedSkillLevel()==1 then
    //			call UnitAddAbility2(u,'Q247') //spellbook with aura
    //			call UnitMakeAbilityPermanent(u,true,'S00A')// make aura permanent to not lose it on morphs
    //		endif
    //		call SetPlayerAbilityAvailable(GetOwningPlayer(u),'Q247',false)//hide
    if(IsDayTime())then
      //			call SetUnitAbilityLevel(u,'S00A',5) //S00A
      call SetUnitAbilityLevel(u,'P247',5) //S00A
      //			call UnitRemoveAbility(u,'B02L')
    else
      //			call SetUnitAbilityLevel(u,'S00A',lvl) //S00A 
      call SetUnitAbilityLevel(u,'P247',lvl) //S00A
    endif
  endif
  if(GetLearnedSkill()=='A08E')then
    call UnitAddAbility(u,'A08C')
    call UnitMakeAbilityPermanent(u,true,'A08C')
    if(IsDayTime())then
      call SetUnitAbilityLevel(u,'A08C',5)
    else
      call SetUnitAbilityLevel(u,'A08C',GetLearnedSkillLevel())
    endif
  endif
  set t=null
  set u=null
endfunction

function P79 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function FPG))
  call TriggerAddAction(t,function NightStalker_NightHunter_Leveling)
  set t=null
endfunction

function Nightstalker_Darkness_VisionAffected takes nothing returns boolean
  return IsUnitEnemy(GetFilterUnit(),tt_player1) and GetOwningPlayer(GetFilterUnit())!=NeutralsPlayer and IsCourier(GetFilterUnit())==false and IsUnitFamiliar(GetUnitTypeId(GetFilterUnit()))==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false
endfunction

function Nightstalker_Darkness_RemoveVision takes nothing returns nothing
  local real sight
  local real nsight=800
  local integer id
  local integer i
  if LoadReal(UnitStats,GetUnitTypeId(GetEnumUnit()),NSIGHT)>0 then
    set nsight=LoadReal(UnitStats,GetUnitTypeId(GetEnumUnit()),NSIGHT)
  endif
  set i=IMinIF(R2I(nsight/400),5)
  set id='DRK0'-1+i
  if GetUnitAbilityLevel(GetEnumUnit(),id)==0 then
    call UnitRemoveAbility(GetEnumUnit(),'DRK0')
    call UnitRemoveAbility(GetEnumUnit(),'DRK1')
    call UnitRemoveAbility(GetEnumUnit(),'DRK2')
    call UnitRemoveAbility(GetEnumUnit(),'DRK3')
    call UnitRemoveAbility(GetEnumUnit(),'DRK4')
    call UnitAddAbility2(GetEnumUnit(),id)
  endif
endfunction

function Nightstalker_Darkness_BringVisionBack takes nothing returns nothing
  if GetUnitAbilityLevel(GetEnumUnit(),'DRK0')>0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK1')>0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK2')>0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK3')>0 or GetUnitAbilityLevel(GetEnumUnit(),'DRK4')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'DRK0')
    call UnitRemoveAbility(GetEnumUnit(),'DRK1')
    call UnitRemoveAbility(GetEnumUnit(),'DRK2')
    call UnitRemoveAbility(GetEnumUnit(),'DRK3')
    call UnitRemoveAbility(GetEnumUnit(),'DRK4')
  endif
endfunction

function Nightstalker_Darkness_FixVision takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local player p=LoadPlayerHandle(hashtable019,h,0)
  local real limit=LoadReal(hashtable019,h,0)-0.5
  local group g=GetAvailableGroup()
  call SaveReal(hashtable019,h,0,limit)
  set tt_player1=p
  call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function Nightstalker_Darkness_VisionAffected))
  if limit>0 then
    call ForGroup(g,function Nightstalker_Darkness_RemoveVision)
  else
    call ForGroup(g,function Nightstalker_Darkness_BringVisionBack)
  endif
  if limit<-20 then
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  endif
  call KillGroup(g)
  set t=null
  set g=null
endfunction


function Nightstalker_Darkness_ReducedVision takes unit u, real dur returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.5,true)
  call TriggerAddCondition(t,Condition(function Nightstalker_Darkness_FixVision))
  call SavePlayerHandle(hashtable019,h,0,GetOwningPlayer(u))
  call SaveReal(hashtable019,h,0,dur)
  set t=null
endfunction

function Nightstalker_Darkness_Start takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer lvl=GetUnitAbilityLevel(u,GetSpellAbilityId())
  local real dur=25
  local real curTime=TimerGetElapsed(GlobalTimer)
  local real darknessEnd=LoadReal(MHT,'DARK',0)
  local real endTime
  if lvl==2 then
    set dur=50
  elseif lvl==3 then
    set dur=80
  endif
  if curTime+dur>darknessEnd then
    call TimerStart(DarknessTimer,dur,false,function DarknessStop)
    //call SaveReal(MHT,'DARK',0,curTime+dur)
    call SuspendTimeOfDay(true)
    if LoadBoolean(MHT,'DARK',0)==false then//if false there are no other darkness so time is real, not 00:00. when true it always 00:00
      call SaveReal(MHT,'DARK',1,GetFloatGameState(GAME_STATE_TIME_OF_DAY))
    endif
    call SetFloatGameState(GAME_STATE_TIME_OF_DAY,0)
    call SaveBoolean(MHT,'DARK',0,true)
  endif
  call Nightstalker_Darkness_ReducedVision(u,dur)
  set u=null
endfunction

function FVG takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit1
  local unit Target=tt_unit2
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real Damage=Level*40+20
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local boolean b=false
  if LoadInteger(hashtable019,Cache,6)>0 and PRD_Get(Source,'P240',15) then
    set b=true
    set Damage=Damage*(1.5+LoadInteger(hashtable019,Cache,6))
  endif
  call UnitAddAbility2(Caster,'A0YL')
  call SetUnitAbilityLevel(Caster,'A0YL',Level)
  call IssueTargetOrderById(Caster,852075,Target)
  if IsUnitType(Target,UNIT_TYPE_HERO) then
    set Damage=Damage/2
  endif
  call DamageTarget(Source,Target,3,Damage)
  if b then
    call TextTagOnUnit(I2S(R2I(Damage))+"!",3,Target,0.02,255,0,0,255)
  endif
  set Source=null
  set Target=null
  set Caster=null
endfunction

function FWG takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=AddProjectile(Hero,Target,'h010',"FVG",1200,false)
  local integer Cache=GetHandleId(t)
  call SaveInteger(hashtable019,(Cache),(5),(GetUnitAbilityLevel(Hero,'A0YM')))
  call SaveInteger(hashtable019,(Cache),(6),GetUnitAbilityLevel(Hero,'A0YM')-1)
  set Hero=null
  set Target=null
  set t=null
endfunction

function PA_StiflingDagger takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call FWG()
  endif
endfunction

function FYG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitRemoveAbility(Source,'A1CO')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetTriggerUnit()!=Target and GetAttacker()==Source then
      call UnitRemoveAbility(Source,'A1CO')
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    elseif GetTriggerUnit()==Target and GetAttacker()==Source then
      set Count=Count+1
      call SaveInteger(hashtable019,(Cache),(34),(Count))
      if Count==4 then
        call UnitRemoveAbility(Source,'A1CO')
        call FlushChildHashtable(hashtable019,(Cache))
        call CleanTrigger(t)
      endif
    endif
  else
    call UnitRemoveAbility(Source,'A1CO')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function PA_Blink takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A0PL')
  local trigger t
  local integer Cache
  call DestroyEffect(AddSpecialEffect("war3mapImported\\PhantomStrike.mdx",GetUnitX(Source),GetUnitY(Source)))
  call SetUnitX(Source,GetUnitX(Target))
  call SetUnitY(Source,GetUnitY(Target))
  if IsUnitAlly(Source,GetOwningPlayer(Target))==false then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call UnitAddAbility2(Source,'A1CO')
    call IssueTargetOrderById(Source,851983,Target)
    call TriggerRegisterTimerEvent(t,3,false)
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function FYG))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  endif
  set Source=null
  set Target=null
  set t=null
endfunction

function FBG takes unit Source,boolean show returns nothing
  local integer Level=GetUnitAbilityLevel(Source,'P239')
  if show==false then
    call UnitRemoveAbility(Source,'A13F')
    call UnitRemoveAbility(Source,'B0A2')
  else
    call UnitAddAbility2(Source,'A13F')
  endif
endfunction

function FCG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local group g
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local boolean F3G=(LoadBoolean(hashtable019,(Cache),(674)))
  local string s=LoadStr(HeroStats,GetUnitTypeId(Source),COLOR)
  local integer r=255
  local integer gr=255
  local integer b=255
  if(s!="" and s!=null)then
    set r=S2I(SubString(s,0,3))
    set gr=S2I(SubString(s,3,6))
    set b=S2I(SubString(s,6,9))
  endif
  set Count=Count+1
  call SaveInteger(hashtable019,(Cache),(34),(Count))
  if Source!=null and IsDead(Source)==false and GetUnitAbilityLevel(Source,'P239')>0 then //A03P
    set tt_unit1=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1625,Condition(function LV8))
    if FirstOfGroup(g)==null then
      if F3G and Count>7 then
        set F3G=false
        call SaveBoolean(hashtable019,(Cache),(674),(F3G))
        set Count=0
        call SaveInteger(hashtable019,(Cache),(34),(Count))
      endif
      if F3G==false then
        set Count=0
        call SaveInteger(hashtable019,(Cache),(34),(Count))
        call SaveInteger(hashtable019,(GetHandleId((Source))),((4302)),(2))
        call FBG(Source,false)
        call SetUnitVertexColor(Source,r,gr,b,255)
        
        if GetUnitAbilityLevel(Source,'A20S')==0 then
          call UnitSetUsesAltIcon(Source,false)
        endif
      endif
    else
      if F3G==false and Count>15 then
        set F3G=true
        set Count=0
        call SaveBoolean(hashtable019,(Cache),(674),(F3G))
        call SaveInteger(hashtable019,(Cache),(34),(Count))
      endif
      if F3G then
        set Count=0
        call SaveInteger(hashtable019,(Cache),(34),(Count))
        call SaveInteger(hashtable019,(GetHandleId((Source))),((4302)),(1))
        call FBG(Source,true)
        call SetUnitVertexColor(Source,r,gr,b,64)//25% visible
        //call SetUnitVertexColorBJ(Source,100,100,100,75)
        call UnitSetUsesAltIcon(Source,IsPlayerEnemy(GetOwningPlayer(Source),GetLocalPlayer()) and IsObserver(GetLocalPlayer())==false)
      endif
    endif
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Source=null
  return false
endfunction

function PhantomAssassin_Blur_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function FCG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  call SaveBoolean(hashtable019,(Cache),(674),(false))
  set t=null
  set Source=null
endfunction

function FLG takes nothing returns boolean
  if GetLearnedSkill()=='A03P' or GetLearnedSkill()=='QP0R' and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call PhantomAssassin_Blur_Learn()
  endif
  return false
endfunction

function PD9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function FLG))
  set t=null
endfunction

function F1G takes nothing returns nothing
  local unit Caster
  if IsUnitInGroup(GetEnumUnit(),DK)==false and IsUnitVisibleLoD(GetEnumUnit(),GetOwningPlayer(J08)) then
    call GroupAddUnit(DK,GetEnumUnit())
    set Caster=CreateUnit(GetOwningPlayer(J08),'e00E',GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
    call UnitAddAbility2(Caster,'A0RI')
    call SetUnitAbilityLevel(Caster,'A0RI',GetUnitAbilityLevel(J08,'A0RA'))
    call IssueTargetOrderById(Caster,852106,GetEnumUnit())
    call DamageTarget(J08,GetEnumUnit(),1,100)
  endif
  set Caster=null
endfunction

function F0G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer i
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local group DA9=GetAvailableGroup()
  local unit XX8=(LoadUnitHandle(hashtable019,(Cache),(221)))
  set tt_unit1=XX8
  set J08=XX8
  call GroupEnumUnitsInRange(DA9,x,y,300,Condition(function DefaultEnemyFilter))
  set DK=g
  call ForGroup(DA9,function F1G)
  call KillGroup(DA9)
  if GetTriggerEvalCount(t)>7*10 then
    set i=1
    loop
      exitwhen i>16
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(2700+i))))
      set i=i+1
    endloop
    call KillGroup(g)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set g=null
  set DA9=null
  set XX8=null
  return false
endfunction

function PitLord_PitOfMalice takes nothing returns nothing
  local integer i=1
  //local location l=GetSpellTargetLoc()
  local real F2G=GetSpellTargetX()
  local real G4G=GetSpellTargetY()
  local real x
  local real y
  local integer boolean131=16
  local string fx="Abilities\\Spells\\Undead\\Graveyard\\GraveMarker.mdl"
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local group g=GetAvailableGroup()
  call TimedReveal(GetOwningPlayer(GetTriggerUnit()),7,F2G,G4G,300+500)
  call PlaySoundAtPos(sound007,F2G,G4G)
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function F0G))
  call SaveGroupHandle(hashtable019,(Cache),(22),(g))
  call SaveUnitHandle(hashtable019,(Cache),(221),(GetTriggerUnit()))
  call SaveReal(hashtable019,(Cache),(6),((F2G)*1.))
  call SaveReal(hashtable019,(Cache),(7),((G4G)*1.))
  call CreateCorpse(GetOwningPlayer(GetTriggerUnit()),'ugho',F2G,G4G,0)
  loop
    exitwhen i>boolean131
    set x=F2G+300*Cos(i*360/ boolean131*bj_DEGTORAD)
    set y=G4G+300*Sin(i*360/ boolean131*bj_DEGTORAD)
    call SaveEffectHandle(hashtable019,(Cache),(2700+i),(AddSpecialEffect(fx,x,y)))
    if i==1 or i==5 or i==9 or i==13 then
      set x=F2G+275*Cos(i*360/ boolean131*bj_DEGTORAD)
      set y=G4G+275*Sin(i*360/ boolean131*bj_DEGTORAD)
      call CreateCorpse(GetOwningPlayer(GetTriggerUnit()),'ugho',x,y,0)
    endif
    set i=i+1
  endloop
  //call RemoveLocation(l)
  //set l=null
  set t=null
  set g=null
endfunction

function G8G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(393)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer MIE=90
  local integer Count=GetTriggerEvalCount(t)
  
  if GetSpellAbilityId()=='A2MB'then
    call KillUnit(Caster)
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,(Cache))
    
    set t=null
    set Caster=null
    set Source=null
    return false
  endif
  
  if Level==1 then
    set MIE=160
  elseif Level==2 then
    set MIE=120
  endif
  call SetUnitX(Caster,GetUnitX(Source))
  call SetUnitY(Caster,GetUnitY(Source))
  if Count>MIE then
    call KillUnit(Caster)
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,(Cache))
  elseif Count==30 then
    call ShowUnit(Caster,true)
    call UnitAddAbility(Caster,'Aloc')
  endif
  set t=null
  set Caster=null
  set Source=null
  return false
endfunction

function G9G takes nothing returns nothing
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl",GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit())))
  call AddTimedKeyToUnit(GetEnumUnit(),4406,1)
  call SetUnitPosition(GetEnumUnit(),tt_real1,real084)
  call PanCameraToTimedForPlayer(GetOwningPlayer(GetEnumUnit()),tt_real1,real084,0)
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl",GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit())))
endfunction


function Pitlord_Rift_Remove takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local unit u = LoadUnitHandle(MHT,GetHandleId(t),0)
  
  call UnitRemoveAbility(u,'A2MB')
  call UnitAddAbility2(u,'A2MB')
  
  call Timer_End(t)
  
  set t = null
  set u = null
endfunction

function Pitlord_Rift_Stop takes unit u returns nothing
  local timer t = Timer_Get()
  
  call SaveUnitHandle(MHT,GetHandleId(t),0,u)
  call TimerStart(t,0,false,function Pitlord_Rift_Remove)
  
  set t = null
endfunction

function DarkRiftFilter takes nothing returns boolean
  return IsUnitAlly(GetFilterUnit(),GetOwningPlayer(tt_unit1)) and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')==0 and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false and GetOwningPlayer(GetFilterUnit())!=Sentinels[0] and GetOwningPlayer(GetFilterUnit())!=Scourges[0]
endfunction

function GDG takes unit Source,unit Target returns nothing
  local group g=GetAvailableGroup()
  local player p = GetOwningPlayer(Source)
  local real x1 = GetWidgetX(Source)
  local real y1 = GetWidgetY(Source)
  local real x2 = GetWidgetX(Target)
  local real y2 = GetWidgetY(Target)
  
  call DestroyEffect(AddSpecialEffect("Doodads\\Cinematic\\ShimmeringPortal\\ShimmeringPortal.mdl",x1,y1))
  call DestroyEffect(AddSpecialEffect("Doodads\\Cinematic\\ShimmeringPortal\\ShimmeringPortal.mdl",x2,y2))
  set tt_real1=x2
  set real084=y2
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x1,y1,475,Condition(function DarkRiftFilter))
  call ForGroup(g,function G9G)
  call KillGroup(g)
  
  call UnitRemoveAbility(Source,'A2MB')
  call SetPlayerAbilityAvailable2(p,'A2MB',false)
  call SetPlayerAbilityAvailable2(p,'A0R0',true)
  
  set g=null
  set p=null
endfunction

function GEG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local player p = GetOwningPlayer(Source)
  local boolean b = GetSpellAbilityId()=='A2MB'
  
  if IsDead(Target) or IsDead(Source) or Target==null or Source==null or b then
    if b then
      call Pitlord_Rift_Stop(Source)
    else
      call Error(p,GetObjectName('n03F'))
    endif
    
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call UnitRemoveType(Target,UNIT_TYPE_PEON)
    call SetPlayerAbilityAvailable2(p,'A2MB',false)
    call SetPlayerAbilityAvailable2(p,'A0R0',true)
    
    call CleanTrigger(t)
    call FlushChildHashtable(hashtable019,Cache)
    
    set t=null
    set Source=null
    set Target=null
    return false
  endif
  
  if GetTriggerEventId()==EVENT_GAME_TIMER_EXPIRED then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call GDG(Source,Target)
  endif
  
  set t=null
  set Source=null
  set Target=null
  set p=null
  return false
endfunction

function GFG takes nothing returns boolean
  local real d
  if IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))==false or GetUnitAbilityLevel(GetFilterUnit(),'A04R')>0 or GetOwningPlayer(GetFilterUnit())==Player(15) or IsDead(GetFilterUnit()) then
    return false
  endif
  if IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)or(tt_int1>0 and IsCreep(GetFilterUnit()))then
    set d=DistanceBetweenXY(real084,real085,GetUnitX(GetFilterUnit()),GetUnitY(GetFilterUnit()))
    if d<tt_real1 then
      set tt_real1=d
      set tt_unit1=GetFilterUnit()
    endif
  endif
  return false
endfunction

function unit104 takes unit Source returns unit
  local location l
  local group g
  local real x
  local real y
  set x=GetSpellTargetX()
  set y=GetSpellTargetY()
  set g=GetAvailableGroup()
  set tt_int1=GetUnitAbilityLevel(Source,'A0R0')
  set tt_unit1=null
  set tt_real1=9999
  set real084=x
  set real085=y
  call GroupEnumUnitsInRange(g,x,y,4000,Condition(function GFG))
  call KillGroup(g)
  set g=null
  set l=null
  return tt_unit1
endfunction

function unit102 takes unit Source returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=GetSpellTargetUnit()
  local real x
  local real y
  local unit u
  if Target==null then
    set Target=unit104(Source)
  endif
  if Target==null then
    call Error(GetOwningPlayer(Source),GetObjectName('n03H'))
    return
  endif
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A0R0',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2MB',true)
  call UnitAddAbility2(Source,'A2MB')
  call TriggerRegisterTimerEvent(t,6-GetUnitAbilityLevel(Source,'A0R0'),false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function GEG))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\DarkHands.mdl",Target,"overhead")))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call UnitAddType(Target,UNIT_TYPE_PEON)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function G8G))
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call SaveInteger(hashtable019,(Cache),(5),(GetUnitAbilityLevel(Source,'A0R0')))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set u=CreateUnit(GetOwningPlayer(Source),'h098',GetUnitX(Source),GetUnitY(Source),0)
  call SaveUnitHandle(hashtable019,(Cache),(393),(u))
  call UnitRemoveAbility(u,'Aloc')
  call ShowUnit(u,false)
  set t=null
  set Target=null
  set u=null
endfunction

function Pitlord_DarkRift_OnCast takes nothing returns nothing
  local unit Target=GetSpellTargetUnit()
  local unit Hero=GetTriggerUnit()
  if Target!=null then
    if IsUnitAlly(Target,GetOwningPlayer(Hero))==false then
      call InterruptUnit(Hero)
      call Error(GetOwningPlayer(Hero),GetObjectName('n041'))
    elseif GetUnitAbilityLevel(Hero,'A0R0')>0 and IsCreep(Target)==false then
      call InterruptUnit(Hero)
      call Error(GetOwningPlayer(Hero),GetObjectName('n041'))
    endif
  endif
  if Target==null then
    set Target=unit104(Hero)
  endif
  if Target==null then
    call InterruptUnit(Hero)
    call Error(GetOwningPlayer(Hero),GetObjectName('n040'))
  endif
  set Target=null
  set Hero=null
endfunction

function unit112 takes nothing returns boolean
  if GetSpellAbilityId()=='A0R0' then
    call unit102(GetTriggerUnit())
  endif
  return false
endfunction

function RV9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function unit112))
  set t=null
  call B08('h094')
  call B08('h095')
  call B08('h096')
endfunction

function Pitlord_Firestorm_Damage takes nothing returns nothing
  local unit t = GetEnumUnit()
  
  if GetUnitAbilityLevel(t,'D009')==1 then
    call DamageTarget(group_temp_unit[0],t,1,group_temp_integer[0])
  endif
  
  set t = null
endfunction

function Pitlord_Firestorm_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local unit u = group_temp_unit[0]
  
  if IsUnitEnemy(u,GetOwningPlayer(t)) and IsDead(t)==false and GetUnitAbilityLevel(t,'A04R')==0 and IsMagicImmune(t)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t))then
    call DamageTarget(u,t,1,group_temp_integer[0])
    call Buff_Add(t,LoDBuff_AbilID[9],LoDBuff_BuffID[9],2)
    
    call GroupAddUnit(LoadGroupHandle(MHT,group_temp_integer[1],1),t)
  endif
  
  set u = null
  set t = null
  return false
endfunction

function Pitlord_Firestorm_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer loopA = 0
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local real x = LoadReal(MHT,info,0)
  local real y = LoadReal(MHT,info,1)
  local group g = LoadGroupHandle(MHT,info,1)
  
  set group_temp_unit[0] = LoadUnitHandle(MHT,info,0)
  set group_temp_integer[0] = LoadInteger(MHT,info,1)
  call ForGroup(g,function Pitlord_Firestorm_Damage)
  call SaveInteger(MHT,info,0,count-1)
  
  if count>2 then
    set group_temp_integer[0] = LoadInteger(MHT,info,2)
    set group_temp_integer[1] = info
    
    call GroupEnumUnitsInRange(temp_group,x,y,425,Condition(function Pitlord_Firestorm_Targets))
    
    if count==3 then
      set t = null
      set g = null
      return
    endif
    
    loop
      exitwhen loopA == 12
      call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\RainOfFire\\RainOfFireTarget.mdl",x + GetRandomReal(50,275)*Cos(loopA*30*bj_DEGTORAD),y + GetRandomReal(50,275)*Sin(loopA*30*bj_DEGTORAD)))
      set loopA = loopA + 1
    endloop
  elseif count==1 then
    call KillGroup(g)
    call Timer_End(t)
  endif
  
  set g = null // no gut :<
  set t = null
endfunction

function Pitlord_Firestorm_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local group g = GetAvailableGroup()
  local integer loopA = 0
  local integer info = GetHandleId(t)
  local integer level = GetUnitAbilityLevel(u,'A01I')
  local real x = GetSpellTargetX()
  local real y = GetSpellTargetY()
  
  loop
    exitwhen loopA == 12
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\RainOfFire\\RainOfFireTarget.mdl",x + GetRandomReal(50,275)*Cos(loopA*30*bj_DEGTORAD),y + GetRandomReal(50,275)*Sin(loopA*30*bj_DEGTORAD)))
    set loopA = loopA + 1
  endloop
  
  call SaveInteger(MHT,info,0,8)
  call SaveInteger(MHT,info,1,level*5)
  call SaveInteger(MHT,info,2,10 + 15*level)
  call SaveReal(MHT,info,0,x)
  call SaveReal(MHT,info,1,y)
  call SaveUnitHandle(MHT,info,0,u)
  call SaveGroupHandle(MHT,info,1,g)
  
  call TimerStart(t,.9,true,function Pitlord_Firestorm_Duration)
  
  set g = null //moar gut :3
  set u = null
  set t = null
endfunction




function Pitlord_Atrophy_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  
  call LoDStat_Sub(LoadUnitHandle(MHT,info,0),LoadInteger(MHT,info,0),"damage")
  
  call Timer_End(t)
  set t = null
endfunction

function Pitlord_Atrophy_Effect takes unit u, boolean b returns nothing
  local timer t = Timer_Get()
  local integer info = GetHandleId(t)
  local integer damage = 5
  local integer lvl=GetUnitAbilityLevel(u,'AIcd')
  if lvl==0 and GetUnitAbilityLevel(u,'QP1C')>0 then
    set lvl=GetUnitAbilityLevel(u,'QP1C')
  endif
  if b then
    set damage = 30
  endif
  
  call SaveUnitHandle(MHT,info,0,u)
  call SaveInteger(MHT,info,0,damage)
  call LoDStat_Add(u,damage,"damage")
  
  call TimerStart(t,lvl*5 + 25,false,function Pitlord_Atrophy_End)
  
  set t = null
endfunction

function Pitlord_Atrophy_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if LoadBoolean(MHT,GetHandleId(t),'AIcd')and IsDead(t)==false and IsUnitEnemy(t,group_temp_player) then
    call Pitlord_Atrophy_Effect(t,IsUnitType(group_temp_unit[0],UNIT_TYPE_HERO))
  endif
  
  set t = null
  return false
endfunction

function Pitlord_Atrophy_Start takes nothing returns boolean
  local unit u = GetTriggerUnit()
  local integer id = GetUnitTypeId(u)
  
  if GetUnitAbilityLevel(u,'A04R')==0 and id!='n0F5' and id!='H00J' and id!='N0MM' and IsUnitIllusion(u)==false and IsDead(u) then
    set group_temp_player = GetOwningPlayer(u)
    set group_temp_unit[0] = u
    
    call GroupEnumUnitsInRange(temp_group,GetWidgetX(group_temp_unit[0]),GetWidgetY(group_temp_unit[0]),925,Condition(function Pitlord_Atrophy_Targets))
  endif
  
  set u = null
  return false
endfunction

function Pitlord_Atrophy_Init takes nothing returns nothing
  local trigger trig = null
  
  call SaveBoolean(MHT,GetHandleId(GetTriggerUnit()),'AIcd',true) // works for both illusions as well :3
  
  if LoadBoolean(MHT,'AIcd',0)then
    return
  endif
  
  set trig = CreateTrigger()
  
  call TriggerRegisterAnyUnitEvent(trig,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(trig, Condition(function Pitlord_Atrophy_Start))
  
  call SaveBoolean(MHT,'AIcd',0,true)
  
  set trig = null
endfunction

function string045 takes nothing returns boolean
  return GetUnitAbilityLevel(GetTriggerUnit(),'A06K')>0
endfunction

function HFG takes nothing returns nothing
  if(GetIssuedOrderId()==852177)then
    call UnitAddAbility2(GetTriggerUnit(),'A0AZ')
  endif
  if(GetIssuedOrderId()==852178)then
    call UnitRemoveAbility(GetTriggerUnit(),'A0AZ')
  endif
endfunction

function PG9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function string045))
  call TriggerAddAction(t,function HFG)
  set t=null
endfunction

function boolean187 takes nothing returns nothing
  local unit u = GetEnumUnit()
  local integer Cache=GetHandleId(u)
  
  if GetTriggerUnit()!=u then
    call SaveInteger(hashtable019,(Cache),(672),((LoadInteger(hashtable019,(Cache),(672)))+1))
  endif
  
  set u = null
endfunction

function boolean184 takes nothing returns boolean
  return isPlayerPickedAbility(GetOwningPlayer(GetFilterUnit()),307)and IsUnitIllusion(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))
endfunction

function integer553 takes nothing returns boolean
  local group g = null
  local unit u = GetTriggerUnit()
  
  if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) and GetUnitTypeId(u)!='H00J' and IsUnitIllusion(u)==false then
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetWidgetX(u),GetWidgetY(u),475,Condition(function boolean184))
    
    set u = GetKillingUnit()
    
    if isPlayerPickedAbility(GetOwningPlayer(u),307)then //check for flesh heap
      call GroupAddUnit(g,udg_Hero[GetPlayerId(GetOwningPlayer(u))])
    endif
    
    
    call ForGroup(g,function boolean187)
    call KillGroup(g)
    set g=null
  endif
  
  set u = null
  return false
endfunction

function HJG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if GetTriggerEvalCount(t)==1 then
    call ShowUnit(Source,false)
  elseif GetTriggerEvalCount(t)>80 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  return false
endfunction

function booleans055 takes nothing returns boolean
  local unit Caster
  local unit Source
  local unit WY9
  local trigger t
  local integer Cache
  if isPlayerPickedAbility(GetOwningPlayer(GetKillingUnit()),306)then
    set Source=GetTriggerUnit()
    set WY9=GetKillingUnit()
    if Source==WY9 then
      set Caster=CreateUnit(GetOwningPlayer(Source),'h0BB',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
      call SetUnitTimeScale(Caster,.75)
      call UnitApplyTimedLife(Caster,'BTLF',1.)
      call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodAbomination.mdl",Caster,"origin"))
      set Caster=null
      call SetSoundPosition(sound028,GetUnitX(Source),GetUnitY(Source),50)
      call SetSoundVolumeBJ(sound028,100)
      call PlaySoundBJ(sound028)
      call SetSoundPosition(sound029,GetUnitX(Source),GetUnitY(Source),50)
      call SetSoundVolumeBJ(sound029,100)
      call PlaySoundBJ(sound029)
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call TriggerRegisterTimerEvent(t,.1,true)
      call TriggerAddCondition(t,Condition(function HJG))
      call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
      set t=null
    endif
    set Source=null
    set WY9=null
    set Caster=null
  endif
  return false
endfunction

function HMG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local unit Source=(LoadUnitHandle(hashtable019,(GetHandleId(t)),(2)))
  local integer Cache=GetHandleId(Source)
  local integer HNG=(LoadInteger(hashtable019,(Cache),(672)))
  local integer integers129=(LoadInteger(hashtable019,(Cache),(673)))
  local integer Level=IMaxIF(GetUnitAbilityLevel(Source,'QP13'),GetUnitAbilityLevel(Source,'A06D')) //A06D
  local integer booleans053=R2I(I2R(HNG)*(.5+.5*Level))
  if booleans053>integers129 then
    call ModifyHeroStat(0,Source,0,booleans053-integers129)
    call SaveInteger(hashtable019,(Cache),(673),(booleans053))
    call TextTagOnUnit("+"+I2S(booleans053-integers129)+" "+GetObjectName('n0MJ'),3,Source,.023,0,255,0,230)
  endif
  set t=null
  set Source=null
  return false
endfunction

function Butcher_FleshHeap_Learn takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function HMG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set Source=null
  set t=null
endfunction

function boolean186 takes nothing returns boolean
  if (GetLearnedSkill()=='A06D' or GetLearnedSkill()=='QP13') and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Butcher_FleshHeap_Learn()
  endif
  return false
endfunction

function HSG takes nothing returns boolean
  if isPlayerPickedAbility(GetTriggerPlayer(),307)then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,"Victims count : "+I2S((LoadInteger(hashtable019,(GetHandleId(udg_Hero[GetPlayerId(GetTriggerPlayer())])),(672)))))
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetObjectName('n09R')+" "+I2S((LoadInteger(hashtable019,(GetHandleId(udg_Hero[GetPlayerId(GetTriggerPlayer())])),(673))))+" "+GetObjectName('n09S'))
  endif
  return false
endfunction

function Func1124 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function boolean186))
  set t=CreateTrigger()
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-st",true)
  call TriggerAddCondition(t,Condition(function HSG))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function booleans055))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function integer553))
  set t=null
endfunction

function Pudge_Hook_BonusPathing takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  if IsDead(u)==false then
    call SetUnitPathing(u,true)
  endif
  call FlushChildHashtable(hashtable019,h)
  call CleanTrigger(t)
  set u=null
  set t=null
endfunction

function HTG takes unit Source,unit Target returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local unit VCF=CreateUnit(GetOwningPlayer(Source),'e02A',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,'A0PZ')
  call IssueTargetOrderById(Caster,852095,Target)
  call UnitApplyTimedLife(Caster,'BTLF',1)
  call UnitApplyTimedLife(VCF,'BTLF',1)
  set Caster=null
  set VCF=null
endfunction

function boolean183 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer HVG=(LoadInteger(hashtable019,(Cache),(376)))
  local boolean HWG=(LoadBoolean(hashtable019,(Cache),(377)))
  local unit Target
  local unit boolean188=(LoadUnitHandle(hashtable019,(Cache),(2100+HVG)))
  local real x
  local real y
  local trigger tt
  if HWG then
    set Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
    set x=GetUnitX(boolean188)
    set y=GetUnitY(boolean188)
    if IsUnitType(Target,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(Target),99,true)
    endif
    call SetUnitX(Target,x)
    call SetUnitY(Target,y)
  endif
  call RemoveUnit(boolean188)
  set HVG=HVG-1
  call SaveInteger(hashtable019,(Cache),(376),(HVG))
  if HVG==0 then
    if (IsTerrainPathableFixed(x,y)==false or IsPointInRegion(RestrictedRegion,x,y)) and IsUnitType(Target,UNIT_TYPE_HERO) then
      set tt=CreateTrigger()
      call SaveUnitHandle(hashtable019,GetHandleId(tt),0,Target)
      call TriggerRegisterTimerEvent(tt,5,false)
      call SetUnitPathing(Target,false)
      call TriggerAddCondition(tt,Condition(function Pudge_Hook_BonusPathing))
      set tt=null
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  set boolean188=null
  return false
endfunction

function HYG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer HVG=(LoadInteger(hashtable019,(Cache),(376)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local trigger boolean136=(LoadTriggerHandle(hashtable019,(Cache),(11)))
  local integer sound002=GetHandleId(boolean136)
  local group g
  local unit u
  local real x
  local real y
  local real z
  if HVG<10+5*Level then
    set HVG=HVG+1
    call SaveInteger(hashtable019,(Cache),(376),(HVG))
    set x=GetUnitX(Hero)+HVG*40*Cos(J2E*bj_DEGTORAD)
    set y=GetUnitY(Hero)+HVG*40*Sin(J2E*bj_DEGTORAD)
    call SaveUnitHandle(hashtable019,(sound002),(2100+HVG),(CreateUnit(GetOwningPlayer(Hero),'u00H',x,y,J2E)))
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,125,Condition(function DG9))
    call GroupRemoveUnit(g,Hero)
    if GetUnitTypeId(Hero)=='e00E' then
      call GroupRemoveUnit(g,udg_Hero[GetPlayerId(GetOwningPlayer(Hero))])
    endif
    set u=GroupPickRandomUnit(g)
    call KillGroup(g)
    if u!=null then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call TriggerRegisterTimerEvent(boolean136,.03,true)
      call TriggerAddCondition(boolean136,Condition(function boolean183))
      call SaveInteger(hashtable019,(sound002),(376),(HVG))
      call SaveBoolean(hashtable019,(sound002),(377),(true))
      call SaveUnitHandle(hashtable019,(sound002),(17),(u))
      if IsUnitEnemy(u,GetOwningPlayer(Hero))then
        if IsUnitType(u,UNIT_TYPE_HERO) then
          call Traffic_RegisterData("HA_Hits"+I2S(GetPlayerId(GetOwningPlayer(Hero))),K88[GetPlayerId(GetOwningPlayer(Hero))])
          set K88[GetPlayerId(GetOwningPlayer(Hero))]=K88[GetPlayerId(GetOwningPlayer(Hero))]+1
          call AddTimedKeyToUnit(Hero,4400,1.5)
        endif
        set K98[GetPlayerId(GetOwningPlayer(Hero))]=K98[GetPlayerId(GetOwningPlayer(Hero))]+1
        call Traffic_RegisterData("HA_Total"+I2S(GetPlayerId(GetOwningPlayer(Hero))),K98[GetPlayerId(GetOwningPlayer(Hero))])
        call HTG(Hero,u)
        call DamageTarget(Hero,u,3,90*Level)
        call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",u,"origin"))
      endif
    endif
  else
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    set K98[GetPlayerId(GetOwningPlayer(Hero))]=K98[GetPlayerId(GetOwningPlayer(Hero))]+1
    call TriggerRegisterTimerEvent(boolean136,.03,true)
    call TriggerAddCondition(boolean136,Condition(function boolean183))
    call SaveInteger(hashtable019,(sound002),(376),(HVG))
    call SaveBoolean(hashtable019,(sound002),(377),(false))
  endif
  set t=null
  set Hero=null
  set boolean136=null
  set g=null
  set u=null
  return false
endfunction

function Pudge_MeatHook takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real J2E=AngleBetweenXY(GetUnitX(Hero),GetUnitY(Hero),GetSpellTargetX(),GetSpellTargetY())
  local integer Level=GetUnitAbilityLevel(Hero,'A06I')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveInteger(hashtable019,(Cache),(376),(0))
  call SaveTriggerHandle(hashtable019,(Cache),(11),(CreateTrigger()))
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function HYG))
  //call RemoveLocation(l)
  set Hero=null
  //set l=null
  set t=null
endfunction

function HBG takes nothing returns boolean
  local integer units005=K88[GetPlayerId(GetTriggerPlayer())]
  local integer YO8=K98[GetPlayerId(GetTriggerPlayer())]
  if isPlayerPickedAbility(GetTriggerPlayer(),305)and YO8>0 then
    call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,group008,10.,GetObjectName('n0EL')+" "+R2S(I2R(units005)/ I2R(YO8)*100)+"% ("+I2S(units005)+"/"+I2S(YO8)+")")
  endif
  return false
endfunction

function Func1122 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-stats",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-st",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-st",true)
  call TriggerAddCondition(t,Condition(function HBG))
  set t=null
endfunction

function boolean189 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real Damage=(75+50*Level)+GetHeroMainStatValue(Source)
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST then
    if GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST and GetSpellAbilityId()=='A1CX')then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  elseif GetTriggerEvalCount(t)>7 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call InterruptUnit(Source)
  else
    if Level>0 then
      set Count=Count+1
      if(Count<4 and IsUnitType(Target,UNIT_TYPE_HERO))or(Count<8 and IsUnitType(Target,UNIT_TYPE_HERO)==false)then
        call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)+Damage)
        call DamageTarget(Source,Target,1,Damage)
      endif
      call SaveInteger(hashtable019,(Cache),(34),(Count))
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function unit084 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A1CX')
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function boolean189))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  call TriggerEvaluate(t)
  set t=null
  set Source=null
  set Target=null
endfunction

function Pudge_Dismember takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call unit084()
  endif
endfunction

function HLG takes nothing returns boolean
  return(GetUnitTypeId(GetSummonedUnit())=='o00L')or(GetUnitTypeId(GetSummonedUnit())=='o00M')or(GetUnitTypeId(GetSummonedUnit())=='o00N')or(GetUnitTypeId(GetSummonedUnit())=='o00O')
endfunction

function HealNetherWard takes unit ward,real for returns nothing
  local real maxlife=GetUnitState(ward,UNIT_STATE_MAX_LIFE)
  local real curlife=GetUnitState(ward,UNIT_STATE_LIFE)
  if for>0 then
    if for>(maxlife-curlife)then
      if for>=curlife then
        call SetUnitState(ward,UNIT_STATE_LIFE,maxlife)
        call HealUnitFor(ward,for-(maxlife-curlife))
      else
        call HealUnitFor(ward,for)
      endif
    else
      call SetUnitState(ward,UNIT_STATE_LIFE,GetUnitState(ward,UNIT_STATE_LIFE)+for)
    endif
  endif
endfunction

function Oblivion_NetherWard_DmgBlock takes nothing returns nothing
  local real dmg=.25
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if IsUnitType(GetEventDamageSource(),UNIT_TYPE_HERO)==false then
      call HealNetherWard(GetTriggerUnit(),GetEventDamage()-0.25)
    else
      call HealNetherWard(GetTriggerUnit(),GetEventDamage()-1)
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_DEATH then
    call CleanTrigger(GetTriggeringTrigger())
  endif
endfunction

function boolean192 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,GetSummonedUnit(),EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,GetSummonedUnit(),EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Oblivion_NetherWard_DmgBlock))
  call SetUnitAbilityLevel(GetSummonedUnit(),'A08T',GetUnitAbilityLevel(GetSummoningUnit(),'A09D'))
  call SetUnitAbilityLevel(GetSummonedUnit(),'A0CF',GetUnitAbilityLevel(GetSummoningUnit(),'A09D'))
  call IssueImmediateOrderById(GetSummonedUnit(),852512)
  set t=null
endfunction

function NW takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function HLG))
  call TriggerAddAction(t,function boolean192)
  set t=null
endfunction

function Oblivion_LifeDrain_Duration takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local unit target=LoadUnitHandle(hashtable019,h,1)
  local real lvl=LoadInteger(hashtable019,h,0)
  local boolean isAgh=LoadBoolean(hashtable019,h,0)
  local real suck=0
  local real targetsMana=0
  if GetUnitAbilityLevel(u,'Bdcl')==0 or (GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST and(GetSpellAbilityId()=='A0CC' or GetSpellAbilityId()=='A02Z')) then
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  else
    if isAgh then
      set suck=30+15*lvl
    else
      set suck=20+10*lvl
    endif
    if (GetUnitState(u,UNIT_STATE_LIFE)+suck>=GetUnitState(u,UNIT_STATE_MAX_LIFE))then
      call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MANA)+suck+GetUnitState(u,UNIT_STATE_LIFE)-GetUnitState(u,UNIT_STATE_MAX_LIFE))
    endif
  endif
  set u=null
  set target=null
  set t=null
endfunction


function Oblivion_LifeDrain_Start takes nothing returns nothing
  local unit u
  local unit target
  local trigger t
  local integer h
  local boolean isAgh
  if IsUnitType(GetSpellTargetUnit(),UNIT_TYPE_HERO)then
    set isAgh=GetSpellAbilityId()=='A02Z'
    set t=CreateTrigger()
    set h=GetHandleId(t)
    set target=GetSpellTargetUnit()
    set u=GetTriggerUnit()
    call TriggerRegisterTimerEvent(t,0.25,true)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_SPELL_ENDCAST)
    call SaveInteger(hashtable019,h,0,GetUnitAbilityLevel(u,GetSpellAbilityId()))
    call SaveBoolean(hashtable019,h,0,isAgh)
    call SaveUnitHandle(hashtable019,h,0,u)
    call SaveUnitHandle(hashtable019,h,1,target)
    call TriggerAddCondition(t,Condition(function Oblivion_LifeDrain_Duration))
  endif
  set t=null
  set target=null
  set u=null
endfunction

function Oblivion_Decripify_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit target=(LoadUnitHandle(hashtable019,(h),(17)))
  call SetUnitVertexColor(target,255,255,255,255)
  call DestroyEffect((LoadEffectHandle(hashtable019,(h),(32))))
  call UnitRemoveAbility(target,'A30D')
  call UnitRemoveAbility(target,'A30E')
  call FlushChildHashtable(hashtable019,(h))
  call CleanTrigger(t)
  set t=null
  set target=null
  return false
endfunction

function Oblivion_Decripify_Act takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  local unit dummy=CreateUnit(GetOwningPlayer(caster),'e00E',GetUnitX(target),GetUnitY(target),0)
  local integer lvl=GetUnitAbilityLevel(caster,'A2TD')
  local trigger t
  local integer h
  call UnitAddAbility(dummy,'A0CE')
  call SetUnitAbilityLevel(dummy,'A0CE',lvl)
  call IssueTargetOrder(dummy,"banish",target)
  if GetUnitTypeId(target)=='n0FJ' or GetUnitTypeId(target)=='n0FI' or GetUnitTypeId(target)=='n0F6' or GetUnitTypeId(target)=='n0FH' then
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,1.5+0.5*lvl,false)
    call TriggerRegisterDeathEvent(t,target)
    call TriggerAddCondition(t,Condition(function Oblivion_Decripify_Duration))
    if IsUnitAlly(target,GetOwningPlayer(caster))then
      call UnitAddAbility(target,'A30D')
    else
      call UnitAddAbility(target,'A30E')
    endif
    call SaveUnitHandle(hashtable019,(h),(17),(target))
    call SetUnitVertexColor(target,50,255,50,150)
    call SaveEffectHandle(hashtable019,(h),(32),(AddSpecialEffect("Abilities\\Spells\\Undead\\Cripple\\CrippleTarget.mdl",GetUnitX(target),GetUnitY(target))))
    set t=null
  endif
  set caster=null
  set target=null
  set dummy=null
endfunction

function Oblivion_Decripify_Init takes nothing returns boolean
  if GetSpellAbilityId()=='A2TD' then
    //if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_CAST then
    if(IsUnitType(GetSpellTargetUnit(),UNIT_TYPE_STRUCTURE)==false and IsMagicImmune(GetSpellTargetUnit())==false)or GetUnitTypeId(GetSpellTargetUnit())=='n0FJ' or GetUnitTypeId(GetSpellTargetUnit())=='n0FI' or GetUnitTypeId(GetSpellTargetUnit())=='n0F6' or GetUnitTypeId(GetSpellTargetUnit())=='n0FH' then//tombstone
    else
      call InterruptUnit(GetTriggerUnit())
      call Error(GetOwningPlayer(GetTriggerUnit()),"Invalid Target")
    endif
    //else
    //	call Oblivion_Decripify_Act()
    //endif
  endif
  return false
endfunction

function Oblivion_Decripify_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function Oblivion_Decripify_Init))
  set t=null
endfunction









function H0G takes unit Source,unit Target returns nothing
  local real unit085=20+40*KE8
  local real E29=70+30*KE8
  local real DV9=unit085+(E29-unit085)*KG8/ 700
  call DamageTarget(Source,Target,1,DV9)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\ChimaeraLightningMissile\\ChimaeraLightningMissile.mdl",Target,"chest"))
endfunction

function boolean194 takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local group HND=KD8
  local unit Source=KF8
  if IsUnitInGroup(Target,HND)==false then
    call GroupAddUnit(HND,Target)
    call H0G(Source,Target)
  endif
  set Target=null
  set HND=null
  set Source=null
endfunction

function I4G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local effect fx
  local integer Count=GetTriggerEvalCount(t)
  local real x
  local real x0=GetUnitX(Source)
  local real y
  local real y0=GetUnitY(Source)
  local integer i
  local integer d
  local group g=GetAvailableGroup()
  call SetUnitX(Caster,GetUnitX(Source))
  call SetUnitY(Caster,GetUnitY(Source))
  set KD8=HND
  set KF8=Source
  set KE8=GetUnitAbilityLevel(Source,'A1E7')
  if Count>20 then
    set d=21*36+(20-Count)*36
    set KG8=d
    set i=0
    loop
      exitwhen i>36
      set x=x0+d*Cos(360*i/ 36*bj_DEGTORAD)
      set y=y0+d*Sin(360*i/ 36*bj_DEGTORAD)
      set tt_unit1=Source
      call GroupEnumUnitsInRange(g,x,y,100,Condition(function LA8))
      call ForGroup(g,function boolean194)
      set i=i+1
    endloop
  else
    set d=Count*36
    set KG8=d
    set i=0
    loop
      exitwhen i>36
      set x=x0+d*Cos(360*i/ 36*bj_DEGTORAD)
      set y=y0+d*Sin(360*i/ 36*bj_DEGTORAD)
      set tt_unit1=Source
      call GroupEnumUnitsInRange(g,x,y,100,Condition(function LA8))
      call ForGroup(g,function boolean194)
      set i=i+1
    endloop
  endif
  call KillGroup(g)
  if Count==40 then
    call KillUnit(Caster)
    call KillGroup(HND)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif Count==20 then
    call GroupClear(HND)
    set fx=null
  endif
  set t=null
  set Caster=null
  set HND=null
  set Source=null
  set g=null
  return false
endfunction

function Razor_PlasmaField takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local real x=GetUnitX(Hero)
  local real y=GetUnitY(Hero)
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'h092',x,y,0)
  local integer i=0
  local integer AUD=36
  local group HND=GetAvailableGroup()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("effects\\Lightning_Ball_Tail_FX.mdx",Hero,"origin")))
  call SaveGroupHandle(hashtable019,(Cache),(133),(HND))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call TriggerRegisterTimerEvent(t,.06,true)
  call TriggerAddCondition(t,Condition(function I4G))
  set t=null
  set Caster=null
  set Hero=null
  set HND=null
endfunction

function unit078 takes integer IDG returns boolean
  return IDG!='A09V' and IDG!='A026' and IDG!='A0LZ' and IDG!='A0QN' and IDG!='A0OI' and IDG!='A0DY' and IDG!='A1WB' and IDG!='AHfa'
endfunction

function integer548 takes unit WH8,unit Source,unit Target,integer Level returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(WH8),'e00E',GetUnitX(Source),GetUnitY(Source),0)
  call UnitAddAbility2(Caster,'A1AK')
  call SetUnitAbilityLevel(Caster,'A1AK',Level)
  call IssueTargetOrderById(Caster,852119,Target)
  call UnitAddAbility2(Caster,'A18D')
  call SetUnitAbilityLevel(Caster,'A18D',Level)
  call IssueTargetOrderById(Caster,852111,Target)
  set Caster=null
endfunction

function IFG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level
  if GetSpellTargetUnit()==Source and unit078(GetSpellAbilityId()) and IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(Source))==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) then
    set Level=GetUnitAbilityLevel(Source,'P283') //A1E6
    call integer548(Source,Source,GetTriggerUnit(),Level)
  endif
  set t=null
  set Source=null
  return false
endfunction

function Razor_UnstableCurrent_Learn takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function IFG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set Source=null
  set t=null
endfunction

function integer547 takes nothing returns boolean
  if (GetLearnedSkill()=='A1E6' or GetLearnedSkill()=='QP0Z') and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Razor_UnstableCurrent_Learn()
  endif
  return false
endfunction

function RJ9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function integer547))
  set t=null
endfunction





function Razor_Link_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer i = LoadInteger(MHT,info,1)
  
  call LoDStat_Sub(LoadUnitHandle(MHT,info,1),i,"damageneg")
  call LoDStat_Sub(LoadUnitHandle(MHT,info,0),i,"damage")
  
  call Timer_End(t)
  set t = null
endfunction

function Razor_Link_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0) + 1
  local integer amount = LoadInteger(MHT,info,1)
  local unit u1 = LoadUnitHandle(MHT,info,0)
  local unit u2 = LoadUnitHandle(MHT,info,1)
  local unit dummy=LoadUnitHandle(MHT,info,33)
  local real x2 = GetWidgetX(u2)
  local real y2 = GetWidgetY(u2)
  local real x1 = GetWidgetX(u1)
  local real y1 = GetWidgetY(u1)
  
  if count==320 or IsDead(u1) or IsDead(u2) or SquareRoot((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2))>700 then
    call DestroyLightning(LoadLightningHandle(MHT,info,2))
    call Buff_Add(u1,LoDBuff_AbilID[23],LoDBuff_BuffID[23],18)
    call Buff_Add(u2,LoDBuff_AbilID[24],LoDBuff_BuffID[24],18)
    call TimerStart(t,18,false,function Razor_Link_End)
    call RemoveUnit(dummy)
    set u2 = null
    set u1 = null
    set t = null
    set dummy=null
    return
  endif
  
  call SaveInteger(MHT,info,0,count)
  call MoveLightning(LoadLightningHandle(MHT,info,2),false,x1,y1,x2,y2)
  call SetUnitPosition(dummy,GetUnitX(u2),GetUnitY(u2))
  if count/40 == count/40. then
    set count = LoadInteger(MHT,info,2)
    set amount = amount + count
    call LoDStat_Add(u2,count,"damageneg")
    call LoDStat_Add(u1,count,"damage")
    
    call SaveInteger(MHT,info,1,amount)
  endif
  set dummy=null
  set u2 = null
  set u1 = null
  set t = null
endfunction

function Razor_Link_Start takes nothing returns nothing
  local lightning l = null
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local unit d = GetSpellTargetUnit()
  local integer info = GetHandleId(t)
  local integer i
  local unit dummy
  
  //check for mulitcast
  if GetUnitTypeId(u)=='e00E'then
    set u = udg_Hero[GetPlayerId(GetOwningPlayer(u))]
  else
    set dummy=CreateUnit(GetOwningPlayer(u),'h088',GetUnitX(d),GetUnitY(d),0)
  endif
  
  set l = AddLightning("CLSB",true,GetWidgetX(u),GetWidgetY(u),GetWidgetX(d),GetWidgetY(d))
  set i = 7*GetUnitAbilityLevel(u,'A1DP')
  
  call SetLightningColor(l,0.3,0.5,1,1)
  
  call SaveUnitHandle(MHT,info,0,u)
  call SaveUnitHandle(MHT,info,1,d)
  call SaveUnitHandle(MHT,info,33,dummy)
  call SaveLightningHandle(MHT,info,2,l)
  call SaveInteger(MHT,info,0,0)
  call SaveInteger(MHT,info,1,i)
  call SaveInteger(MHT,info,2,i)
  
  call LoDStat_Add(d,i,"damageneg")
  call LoDStat_Add(u,i,"damage")
  
  call TimerStart(t,0.025,true,function Razor_Link_Duration)
  
  set d = null //dult :3
  set u = null
  set l = null
  set t = null
  set dummy=null
endfunction





function ISG takes integer Cache returns nothing
  local integer i=1
  local integer JBE=(LoadInteger(hashtable019,(Cache),(136)))
  local unit Target
  local integer XK8
  if JBE==0 then
    return
  endif
  loop
    exitwhen i>JBE
    set XK8=(LoadInteger(hashtable019,(Cache),(2200+i)))
    set Target=UnitAsInteger_Load(XK8)
    call UnitAsInteger_Clear(XK8)
    call UnitRemoveAbility(Target,CN[0])
    call UnitRemoveAbility(Target,CN[1])
    call UnitRemoveAbility(Target,CN[2])
    call UnitRemoveAbility(Target,CN[3])
    call UnitRemoveAbility(Target,CN[4])
    call UnitRemoveAbility(Target,CN[5])
    set i=i+1
  endloop
  set Target=null
endfunction

function ITG takes unit Target,integer Cache returns nothing
  local integer XK8=UnitAsInteger_Save(Target)
  local integer JBE=(LoadInteger(hashtable019,(Cache),(136)))
  set JBE=JBE+1
  call SaveInteger(hashtable019,(Cache),(136),(JBE))
  call SaveInteger(hashtable019,(Cache),(2200+JBE),(XK8))
endfunction

function IUG takes unit u returns integer
  return GetUnitAbilityLevel(u,CN[0])*1+GetUnitAbilityLevel(u,CN[1])*2+GetUnitAbilityLevel(u,CN[2])*4+GetUnitAbilityLevel(u,CN[3])*8+GetUnitAbilityLevel(u,CN[4])*16
endfunction

function IVG takes unit u,integer d returns nothing
  local integer array b
  local integer a=d
  local integer c=1
  local integer i=0
  local integer E29
  if d<1 then
    call UnitRemoveAbility(u,CN[0])
    call UnitRemoveAbility(u,CN[1])
    call UnitRemoveAbility(u,CN[2])
    call UnitRemoveAbility(u,CN[3])
    call UnitRemoveAbility(u,CN[4])
    call UnitRemoveAbility(u,CN[5])
    return
  endif
  loop
    exitwhen c==0
    set c=a/ 2
    set b[i]=a-c*2
    set a=c
    set i=i+1
  endloop
  set E29=i
  set i=0
  loop
    exitwhen i>E29
    if b[i]==1 then
      call UnitAddAbility2(u,CN[i])
    else
      call UnitRemoveAbility(u,CN[i])
    endif
    set i=i+1
  endloop
endfunction

function IWG takes unit u,integer d returns nothing
  if IsUnitType(u,UNIT_TYPE_STRUCTURE)==false then
    call IVG(u,d+IUG(u))
    call ITG(u,KO8)
  endif
endfunction

function IXG takes unit Source,unit Caster,unit Target,integer Level returns nothing
  call IssueTargetOrderById(Caster,852119,Target)
  call DamageTarget_Delayed(Source,Target,2,(50+25*Level)/ 2,.3)
  call IWG(Target,1)
endfunction

function IYG takes nothing returns boolean
  if(IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false))and GetUnitTypeId(GetFilterUnit())!='n00L' then
    if GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)<KN8 then
      set KN8=GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)
      set KM8=GetFilterUnit()
    endif
  endif
  return false
endfunction

function IZG takes nothing returns boolean
  if(IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false))and GetUnitTypeId(GetFilterUnit())!='emow' and GetUnitTypeId(GetFilterUnit())!='uzig' and GetUnitTypeId(GetFilterUnit())!='n00L' then
    if GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)<KN8 then
      set KN8=GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)
      set KM8=GetFilterUnit()
    endif
  endif
  return false
endfunction

function IAG takes unit Source,unit Caster,integer Level returns nothing
  local group g=GetAvailableGroup()
  set KM8=null
  set KN8=999999
  set KJ8=30+30*Level
  set KK8=Source
  set tt_unit1=Source
  if GetUnitAbilityLevel(Source,'A1UV')>0 then
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),525,Condition(function IZG))
  else
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),525,Condition(function IYG))
  endif
  call KillGroup(g)
  if KM8!=null then
    call IXG(Source,Caster,KM8,Level)
  endif
  set g=null
endfunction

function IBG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer Count=GetTriggerEvalCount(t)
  local integer interval
  local real delay
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call ISG(Cache)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if GetTriggerUnit()==Source then
      call KillUnit(Caster)
    endif
  else
    if GetUnitAbilityLevel(Source,'A1UV')>0 then
      if Level==1 then
        set delay=0.55
      elseif Level==2 then
        set delay=0.45
      else
        set delay=0.35
      endif
    else
      if Level==1 then
        set delay=0.7
      elseif Level==2 then
        set delay=0.6
      else
        set delay=0.5
      endif
    endif
    set delay=delay/0.05
    if ModuloInteger(Count,R2I(delay))==0 or Count==1 then
      set KO8=Cache
      call IAG(Source,Caster,Level)
    endif
    call SetUnitX(Caster,GetUnitX(Source))
    call SetUnitY(Caster,GetUnitY(Source))
  endif
  set t=null
  set Source=null
  set Caster=null
  return false
endfunction

function Razor_EyeOfTheStorm takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A1AO')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'h081',GetUnitX(Source),GetUnitY(Source),0)
  if Level==0 then
    set Level=GetUnitAbilityLevel(Source,'A1UV')
  endif
  if GetUnitTypeId(Source)=='e00E' then
    set Source=udg_Hero[GetPlayerId(GetOwningPlayer(Source))]
  endif
  call UnitApplyTimedLife(Caster,'BTLF',30)
  call SetUnitAbilityLevel(Caster,'A1DJ',Level)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Caster,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function IBG))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  set Source=null
  set Caster=null
  set t=null
endfunction

function RM9 takes nothing returns nothing
  set CN[0]='A1DK'
  set CN[1]='A1DL'
  set CN[2]='A1DN'
  set CN[3]='A1DM'
  set CN[4]='A1DO'
endfunction

function I6G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  call SetUnitPosition(Hero,SafeX50(x),SafeY50(y))
  call SetUnitAnimation(Hero,"morph ALTERNATE")
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  return false
endfunction

function SK_Burrowstrike takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'A06O')
  //local location l
  local real J2E
  local real x=GetUnitX(Hero)
  local real y=GetUnitY(Hero)
  local real TargetX
  local real TargetY
  local real I1G
  local real I0G
  local real CasterX
  local real CasterY
  local integer CasterAbility
  local unit Caster
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real Damage
  local real DP9=1.65
  local unit D09=null
  if Level==1 then
    set Damage=100
  elseif Level==2 then
    set Damage=160
  elseif Level==3 then
    set Damage=220
  elseif Level==4 then
    set Damage=280
  endif
  if GetSpellTargetUnit()!=null then
    //set l=GetUnitLoc(GetSpellTargetUnit())
    set TargetX=GetUnitX(GetSpellTargetUnit())
    set TargetY=GetUnitY(GetSpellTargetUnit())
  else
    //set l=GetSpellTargetLoc()
    set TargetX=GetSpellTargetX()
    set TargetY=GetSpellTargetY()
  endif
  //call RemoveLocation(l)
  set J2E=AngleBetweenXY(x,y,TargetX,TargetY)
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveReal(hashtable019,(Cache),(6),((TargetX)*1.))
  call SaveReal(hashtable019,(Cache),(7),((TargetY)*1.))
  call TriggerRegisterTimerEvent(t,DistanceBetweenXY(x,y,TargetX,TargetY)/ 2000,false)
  call TriggerAddCondition(t,Condition(function I6G))
  if DistanceBetweenXY(x,y,TargetX,TargetY)<150 then
    set TargetX=x+150*Cos(J2E*bj_DEGTORAD)
    set TargetY=y+150*Sin(J2E*bj_DEGTORAD)
  endif
  if GetSpellTargetUnit()!=null and IsBlocked(GetSpellTargetUnit())then
    set D09=GetSpellTargetUnit()
  endif
  call D19(Hero,D09,Damage,DP9,.52,x,y,TargetX,TargetY,175,null,true,1600)
  set Caster=null
  //set l=null
  set Hero=null
  set t=null
  set D09=null
endfunction

function unit081 takes nothing returns nothing
  local unit d=CreateUnit(GetOwningPlayer(GetEnumUnit()),'e00E',GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
  call UnitAddAbility(d,'A33J')
  call IssueTargetOrderById(d,852095,GetEnumUnit())
  set d=null
  call DamageTarget(KQ8,GetEnumUnit(),1,130)
  call IssueTargetOrderById(KR8,852075,GetEnumUnit())
endfunction

function J4G takes unit Source,real x,real y,integer Level,integer J7G returns nothing
  local group g=GetAvailableGroup()
  local real r
  local string fx
  if J7G==8 then
    set r=675
  elseif J7G==9 then
    set r=700
  elseif J7G==10 then
    set r=725
  else
    set r=250+50*J7G
  endif
  if J7G<4 then
    set fx="war3mapImported\\EpiPulse_1_4.mdx"
  elseif J7G<8 then
    set fx="war3mapImported\\EpiPulse_5_8.mdx"
  else
    set fx="war3mapImported\\EpiPulse_9_12.mdx"
  endif
  call DestroyEffect(AddSpecialEffect(fx,x,y))
  set tt_unit1=Source
  set KQ8=Source
  set KR8=KP8[GetPlayerId(GetOwningPlayer(Source))]
  call GroupEnumUnitsInRange(g,x,y,r,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function unit081)
  call KillGroup(g)
  call BG8(.03,false,x,y,150+100*J7G,150+100*J7G,72,.03,512)
  set g=null
endfunction

function J8G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real LastX=(LoadReal(hashtable019,(Cache),(23)))
  local real LastY=(LoadReal(hashtable019,(Cache),(24)))
  local boolean RIE=(LoadBoolean(hashtable019,(Cache),(15)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer EZE=(LoadInteger(hashtable019,(Cache),(25)))
  local integer J9G=4+Level*2
  local real x=LastX
  local real y=LastY
  if RIE then
    set J9G=J9G+2
  endif
  if EZE>J9G then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if Hero!=null and IsDead(Hero)==false then
      set x=GetUnitX(Hero)
      set y=GetUnitY(Hero)
    endif
    call J4G(Hero,x,y,Level,EZE)
    call SaveInteger(hashtable019,(Cache),(25),(EZE+1))
    call SaveReal(hashtable019,(Cache),(23),((x)*1.))
    call SaveReal(hashtable019,(Cache),(24),((y)*1.))
  endif
  set t=null
  set p=null
  set Hero=null
  return false
endfunction

function JDG takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local player p=GetOwningPlayer(Hero)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Hero,'A06R')
  local boolean RIE=false
  if Level==0 then
    set RIE=true
    set Level=GetUnitAbilityLevel(Hero,'A1B4')
  endif
  if IsSentinel(p)then
    set KP8[GetPlayerId(p)]=CreateUnit(Scourges[0],'e00E',GetUnitX(Hero),GetUnitY(Hero),0)
  else
    set KP8[GetPlayerId(p)]=CreateUnit(Sentinels[0],'e00E',GetUnitX(Hero),GetUnitY(Hero),0)
  endif
  call UnitAddAbility2(KP8[GetPlayerId(p)],'A17B')
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SavePlayerHandle(hashtable019,(Cache),(54),(GetOwningPlayer(Hero)))
  call SaveReal(hashtable019,(Cache),(23),((GetUnitX(Hero))*1.))
  call SaveReal(hashtable019,(Cache),(24),((GetUnitY(Hero))*1.))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(25),(2))
  call SaveBoolean(hashtable019,(Cache),(15),(RIE))
  call TriggerRegisterTimerEvent(t,.35,true)
  call TriggerAddCondition(t,Condition(function J8G))
  call J4G(Hero,GetUnitX(Hero),GetUnitY(Hero),Level,1)
  set Hero=null
  set p=null
  set t=null
endfunction

function JEG takes nothing returns boolean
  if GetSpellAbilityId()=='A06R' or GetSpellAbilityId()=='A1B4' then
    call JDG()
  endif
  return false
endfunction

function Func1127 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_FINISH)
  call TriggerAddCondition(t,Condition(function JEG))
  call PreloadAbility('A17B')
  set t=null
endfunction

function JFG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  if((LoadInteger(hashtable019,(GetHandleId((Hero))),((4299))))==1)==false then
    call UnitRemoveAbility(Hero,'B04R')
  endif
  call RemoveUnit((LoadUnitHandle(hashtable019,(Cache),(379))))
  call RemoveUnit((LoadUnitHandle(hashtable019,(Cache),(380))))
  call RemoveUnit((LoadUnitHandle(hashtable019,(Cache),(381))))
  call RemoveUnit((LoadUnitHandle(hashtable019,(Cache),(382))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  return false
endfunction

function JGG takes unit Hero,integer Level,unit JHG,unit JIG,unit JJG,unit JKG returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real DP9=1.5
  
  call SaveInteger(hashtable019,(GetHandleId((Hero))),((4299)),(2))
  call TriggerRegisterTimerEvent(t,DP9,false)
  call TriggerAddCondition(t,Condition(function JFG))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(379),(JHG))
  call SaveUnitHandle(hashtable019,(Cache),(380),(JIG))
  call SaveUnitHandle(hashtable019,(Cache),(381),(JJG))
  call SaveUnitHandle(hashtable019,(Cache),(382),(JKG))
  set t=null
endfunction

function JMG takes nothing returns boolean
  if(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))then
    call DamageTarget(tt_unit1,GetFilterUnit(),1,tt_real1)
  endif
  return false
endfunction

function JNG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit JHG=(LoadUnitHandle(hashtable019,(Cache),(379)))
  local unit JIG=(LoadUnitHandle(hashtable019,(Cache),(380)))
  local unit JJG=(LoadUnitHandle(hashtable019,(Cache),(381)))
  local unit JKG=(LoadUnitHandle(hashtable019,(Cache),(382)))
  local integer Level=GetUnitAbilityLevel(Hero,'A0H0')
  local integer Count=GetTriggerEvalCount(t)
  local group g
  local integer JOG=550
  if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST or Count>Level*40 then
    call JGG(Hero,Level,JHG,JIG,JJG,JKG)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set g=GetAvailableGroup()
    set tt_unit1=Hero
    set tt_real1=Level*25/2
    call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),JOG,Condition(function JMG))
    call KillGroup(g)
  endif
  set t=null
  set Hero=null
  set JHG=null
  set JIG=null
  set JJG=null
  set JKG=null
  set g=null
  return false
endfunction

function SK_Sandstorm takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit JHG=CreateUnit(GetOwningPlayer(Hero),'e00Q',GetUnitX(Hero)+150,GetUnitY(Hero)+150,0)
  local unit JIG=CreateUnit(GetOwningPlayer(Hero),'e00Q',GetUnitX(Hero)+150,GetUnitY(Hero)-150,0)
  local unit JJG=CreateUnit(GetOwningPlayer(Hero),'e00Q',GetUnitX(Hero)-150,GetUnitY(Hero)+150,0)
  local unit JKG=CreateUnit(GetOwningPlayer(Hero),'e00Q',GetUnitX(Hero)-150,GetUnitY(Hero)-150,0)
  local integer Level=GetUnitAbilityLevel(Hero,'A0H0')
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',GetUnitX(Hero),GetUnitY(Hero),0)
  call SaveInteger(hashtable019,(GetHandleId((Hero))),((4299)),(1))
  call UnitAddAbility2(Caster,'A0HO')
  call SetUnitAbilityLevel(Caster,'A0HO',Level)
  call IssueTargetOrderById(Caster,852069,Hero)
  call TriggerRegisterTimerEvent(t,0.5,true)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerAddCondition(t,Condition(function JNG))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(379),(JHG))
  call SaveUnitHandle(hashtable019,(Cache),(380),(JIG))
  call SaveUnitHandle(hashtable019,(Cache),(381),(JJG))
  call SaveUnitHandle(hashtable019,(Cache),(382),(JKG))
  call SetUnitTimeScale(JHG,0)
  call SetUnitTimeScale(JIG,0)
  call SetUnitTimeScale(JJG,0)
  call SetUnitTimeScale(JKG,0)
  set t=null
  set Hero=null
  set Caster=null
  set JHG=null
  set JIG=null
  set JJG=null
  set JKG=null
endfunction

function JRG takes nothing returns nothing
  call DamageTarget(KS8,GetEnumUnit(),2,50*KT8)
endfunction

function Slardar_SlithereenCrush takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  local group g=GetAvailableGroup()
  local integer Level=GetUnitAbilityLevel(Source,GetSpellAbilityId())
  call UnitAddAbility2(Caster,'A0M9')
  call SetUnitAbilityLevel(Caster,'A0M9',Level)
  call IssueImmediateOrderById(Caster,852096)
  call UnitAddAbility2(Caster,'A01W')
  call SetUnitAbilityLevel(Caster,'A01W',Level)
  call IssueImmediateOrderById(Caster,852127)
  set KS8=Source
  set KT8=Level
  call GroupEnumUnitsInRange(g,x,y,350+25,Condition(function LR8))
  call ForGroup(g,function JRG)
  call KillGroup(g)
  set Source=null
  set Caster=null
  set g=null
endfunction

function Slardar_AmplifyDamage_Check takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit target=LoadUnitHandle(hashtable019,h,0)
  local real time=TimerGetElapsed(GlobalTimer)
  local real limit=LoadReal(MHT,GetHandleId(target),'A034')
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitRemoveAbility(target,'A310')
    call UnitRemoveAbility(target,'B30Z')
    call FlushChildHashtable(hashtable019,h)
    call RemoveSavedHandle(MHT,GetHandleId(target),'A034')
    call CleanTrigger(t)
  else
    if time>limit then
      call UnitRemoveAbility(target,'A310')
      call UnitRemoveAbility(target,'B30Z')
      call FlushChildHashtable(hashtable019,h)
      call RemoveSavedHandle(MHT,GetHandleId(target),'A034')
      call CleanTrigger(t)
    endif
  endif
  
  set t=null
  set target=null
endfunction

function Slardar_AmplifyDamage takes nothing returns nothing
  local trigger t
  local integer h
  local unit caster=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  local real duration
  local integer lvl=GetUnitAbilityLevel(caster,GetSpellAbilityId())
  if IsUnitType(target,UNIT_TYPE_HERO) or IsUnitIllusion(target) then
    set duration=30
  else
    set duration=120
  endif
  call SaveReal(MHT,GetHandleId(target),'A034',TimerGetElapsed(GlobalTimer)+duration)
  call UnitAddAbility2(target,'A310')
  call SetPlayerAbilityAvailable(GetOwningPlayer(target),'A310',false)
  call UnitMakeAbilityPermanent(target,true,'A30Y')
  call UnitMakeAbilityPermanent(target,true,'A30Z')
  call SetUnitAbilityLevel(target,'A30Y',lvl)
  call ShareVision(target,caster,'A310')
  call DetectMagicDispell(target,'A310','B30Z')
  if LoadTriggerHandle(MHT,GetHandleId(target),'A304')==null then
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function Slardar_AmplifyDamage_Check))
    call SaveUnitHandle(hashtable019,h,0,target)
    call SaveTriggerHandle(MHT,GetHandleId(target),'A034',t)
    set t=null
  endif
  
  
  
  set caster=null
  set target=null
endfunction

function JUG takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer Cache=GetHandleId(t)
  local unit XX8=(LoadUnitHandle(hashtable019,(Cache),(221)))
  local unit JVG=(LoadUnitHandle(hashtable019,(Cache),(383)))
  local unit Caster
  local real DP9=(LoadReal(hashtable019,(Cache),(57)))
  local integer Level=GetUnitAbilityLevel(JVG,('A0HW'))
  local real JWG=(LoadReal(hashtable019,(Cache),(6)))
  local real JXG=(LoadReal(hashtable019,(Cache),(7)))
  local real AO8=GetUnitX(XX8)
  local real AP8=GetUnitY(XX8)
  if(AO8-JWG)*(AO8-JWG)+(AP8-JXG)*(AP8-JXG)>900 then
    set Caster=CreateUnit(GetOwningPlayer(JVG),('h002'),GetUnitX(XX8),GetUnitY(XX8),0)
    call SetUnitAbilityLevel(Caster,('A0I2'),Level)
    call SetUnitAbilityLevel(Caster,('A0HY'),Level)
    call UnitApplyTimedLife(Caster,'BTLF',7)
    call SaveReal(hashtable019,(Cache),(6),((AO8)*1.))
    call SaveReal(hashtable019,(Cache),(7),((AP8)*1.))
  endif
  set DP9=DP9+.2
  call SaveReal(hashtable019,(Cache),(57),((DP9)*1.))
  if DP9>7 or GetUnitState(XX8,UNIT_STATE_LIFE)<1 then
    call PauseTimer(t)
    call FlushChildHashtable(hashtable019,(Cache))
  endif
  set t=null
  set XX8=null
  set JVG=null
  set Caster=null
endfunction

function JYG takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local sound XP8
  local timer t
  local integer Cache
  call DamageTarget(TmpUnit376,Target,1,TmpReal378)
  
  call GroupAddUnit(C2,Target)
  if IsUnitType(Target,UNIT_TYPE_HERO) then
    set t=CreateTimer()
    set Cache=GetHandleId(t)
    set XP8=CreateSound("Sounds\\Spectral Dagger.mp3",false,true,true,10,10,"DefaultEAXON")
    call SetSoundPosition(XP8,GetUnitX(Target),GetUnitY(Target),0)
    call SetSoundDistanceCutoff(XP8,700)
    call StartSound(XP8)
    call KillSoundWhenDone(XP8)
    call SaveUnitHandle(hashtable019,(Cache),(221),(Target))
    call SaveUnitHandle(hashtable019,(Cache),(383),(TmpUnit376))
    call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Target))*1.))
    call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Target))*1.))
    call TimerStart(t,.2,true,function JUG)
  endif
  set Target=null
  set t=null
endfunction

function JZG takes nothing returns boolean
  return(IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(TmpUnit376))and IsUnitInGroup(GetFilterUnit(),C2)==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>1 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false)!=null
endfunction

function JAG takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer Cache=GetHandleId(t)
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local group HQ9=GetAvailableGroup()
  local boolexpr VH9=Condition(function JZG)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local integer XK8=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(XK8)
  local real TargetX=GetUnitX(Target)
  local real TargetY=GetUnitY(Target)
  local real SourceX=GetUnitX(Projectile)
  local real SourceY=GetUnitY(Projectile)
  local real J2E=Atan2(TargetY-SourceY,TargetX-SourceX)
  local real AO8=SafeX50(GetUnitX(Projectile)+30*Cos(J2E))
  local real AP8=SafeY50(GetUnitY(Projectile)+30*Sin(J2E))
  local unit Caster
  local integer Level=GetUnitAbilityLevel(Hero,('A0HW'))
  if(LoadBoolean(hashtable019,(Cache),(384)))then
    call SaveBoolean(hashtable019,(Cache),(384),(false))
    set Caster=CreateUnit(GetOwningPlayer(Hero),('h002'),SourceX,SourceY,0)
    call SetUnitAbilityLevel(Caster,('A0I2'),Level)
    call SetUnitAbilityLevel(Caster,('A0HY'),Level)
    call UnitApplyTimedLife(Caster,'BTLF',12)
  else
    call SaveBoolean(hashtable019,(Cache),(384),(true))
  endif
  call SetUnitX(Projectile,AO8)
  call SetUnitY(Projectile,AP8)
  call SetUnitFacing(Projectile,J2E*bj_RADTODEG)
  set C2=HND
  set TmpUnit376=Hero
  set TmpReal378=50*GetUnitAbilityLevel(Hero,('A0HW'))
  call GroupEnumUnitsInRange(HQ9,AO8,AP8,150,VH9)
  call ForGroup(HQ9,function JYG)
  call KillGroup(HQ9)
  if(AO8-TargetX)*(AO8-TargetX)+(AP8-TargetY)*(AP8-TargetY)<1600 then
    call PauseTimer(t)
    call UnitAsInteger_Clear(XK8)
    call FlushChildHashtable(hashtable019,(Cache))
    call KillUnit(Projectile)
    call KillGroup(HND)
  endif
  set HND=null
  set t=null
  set HQ9=null
  set Hero=null
  set Projectile=null
  set Target=null
  set Caster=null
  set VH9=null
endfunction

function JBG takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer Cache=GetHandleId(t)
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local group HQ9=GetAvailableGroup()
  local boolexpr VH9=Condition(function JZG)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real SourceX=GetUnitX(Projectile)
  local real SourceY=GetUnitY(Projectile)
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real AO8=SafeX50(GetUnitX(Projectile)+30*Cos(J2E))
  local real AP8=SafeY50(GetUnitY(Projectile)+30*Sin(J2E))
  local unit Caster
  local integer Level=GetUnitAbilityLevel(Hero,('A0HW'))
  if(LoadBoolean(hashtable019,(Cache),(384)))then
    call SaveBoolean(hashtable019,(Cache),(384),(false))
    set Caster=CreateUnit(GetOwningPlayer(Hero),('h002'),SourceX,SourceY,0)
    call SetUnitAbilityLevel(Caster,('A0I2'),Level)
    call SetUnitAbilityLevel(Caster,('A0HY'),Level)
    call UnitApplyTimedLife(Caster,'BTLF',12)
  else
    call SaveBoolean(hashtable019,(Cache),(384),(true))
  endif
  call SetUnitX(Projectile,AO8)
  call SetUnitY(Projectile,AP8)
  set C2=HND
  set TmpUnit376=Hero
  set TmpReal378=50*GetUnitAbilityLevel(Hero,('A0HW'))+50
  call GroupEnumUnitsInRange(HQ9,AO8,AP8,165,VH9)
  call ForGroup(HQ9,function JYG)
  call KillGroup(HQ9)
  if(AO8-TargetX)*(AO8-TargetX)+(AP8-TargetY)*(AP8-TargetY)<1600 then
    call PauseTimer(t)
    call FlushChildHashtable(hashtable019,(Cache))
    call KillUnit(Projectile)
    call KillGroup(HND)
  endif
  set HND=null
  set t=null
  set HQ9=null
  set Hero=null
  set Projectile=null
  set Caster=null
  set VH9=null
endfunction

function JCG takes unit XX8,integer ZG8 returns boolean
  return(GetItemTypeId(UnitItemInSlot(XX8,ZG8))=='pspd')or(GetItemTypeId(UnitItemInSlot(XX8,ZG8))=='oflg')
endfunction

function J3G takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real DP9=(LoadReal(hashtable019,(Cache),(57)))
  local integer VT8=0
  loop
    exitwhen VT8>5
    if JCG(Hero,VT8)then
      if GetUnitAbilityLevel(Hero,('B047'))==0 then
        call SetItemDropOnDeath(UnitItemInSlot(Hero,VT8),true)
        if GetItemTypeId(UnitItemInSlot(Hero,VT8))=='oflg' then
          call SetItemDroppable(UnitItemInSlot(Hero,VT8),true)
        endif
      else
        call SetItemDropOnDeath(UnitItemInSlot(Hero,VT8),false)
        if GetItemTypeId(UnitItemInSlot(Hero,VT8))=='oflg' then
          call SetItemDroppable(UnitItemInSlot(Hero,VT8),false)
        endif
      endif
    endif
    set VT8=VT8+1
  endloop
  set DP9=DP9+.2
  call SaveReal(hashtable019,(Cache),(57),((DP9)*1.))
  if GetUnitAbilityLevel(Hero,('B047'))==0 then
    call SetUnitPathing(Hero,true)
  else
    call SetUnitPathing(Hero,false)
  endif
  if DP9>30 then
    call PauseTimer(t)
    call FlushChildHashtable(hashtable019,(Cache))
    call SetUnitPathing(Hero,true)
    set VT8=0
    loop
      exitwhen VT8>5
      if JCG(Hero,VT8)then
        call SetItemDropOnDeath(UnitItemInSlot(Hero,VT8),true)
        if GetItemTypeId(UnitItemInSlot(Hero,VT8))=='oflg' then
          call SetItemDroppable(UnitItemInSlot(Hero,VT8),true)
        endif
      endif
      set VT8=VT8+1
    endloop
  endif
  set t=null
  set Hero=null
endfunction

function Spectre_SpectralDagger takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real SourceX=SafeX50(GetUnitX(Hero))
  local real SourceY=SafeY50(GetUnitY(Hero))
  local unit Projectile=CreateUnit(GetOwningPlayer(Hero),('h003'),SourceX,SourceY,0)
  local timer t=CreateTimer()
  local integer Cache=GetHandleId(t)
  local group HND=GetAvailableGroup()
  //local location PKE
  local real J2E
  local real TargetX
  local real TargetY
  call SetUnitPathing(Projectile,false)
  call SaveGroupHandle(hashtable019,(Cache),(133),(HND))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  if Target!=null then
    call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
    call TimerStart(t,.035,true,function JAG)
  else
    //set PKE=GetSpellTargetLoc()
    set TargetX=GetSpellTargetX()
    set TargetY=GetSpellTargetY()
    set J2E=Atan2(TargetY-SourceY,TargetX-SourceX)
    call SetUnitFacing(Projectile,J2E*bj_RADTODEG)
    set TargetX=SafeX50(SourceX+2100*Cos(J2E))
    set TargetY=SafeY50(SourceY+2100*Sin(J2E))
    call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
    call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
    call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
    call TimerStart(t,.035,true,function JBG)
  endif
  set t=CreateTimer()
  set Cache=GetHandleId(t)
  call SetUnitPathing(Hero,false)
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call TimerStart(t,.2,true,function J3G)
  set Hero=null
  set Target=null
  set Projectile=null
  set t=null
  set HND =null
  //set PKE=null
endfunction

function QM9 takes nothing returns nothing
  call CreateSound("Sounds\\Spectral Dagger.mp3",false,false,false,10,10,"DefaultEAXON")
  call PreloadAbility(('A0I2'))
  call PreloadAbility(('A0HY'))
endfunction

function J1G takes nothing returns boolean
  return(IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) and GetUnitAbilityLevel(GetAttacker(),('P338'))>0)!=null //A0FX
endfunction

function J0G takes nothing returns boolean
  return(IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>1 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false)!=null
endfunction

function J5G takes nothing returns nothing
  local unit DOD=GetAttacker()
  local unit integer516=GetTriggerUnit()
  local group HQ9=GetAvailableGroup()
  local boolexpr VH9=Condition(function J0G)
  local integer Cache
  local real d=10+20*GetUnitAbilityLevel(DOD,'P338')
  call GroupEnumUnitsInRange(HQ9,GetUnitX(integer516),GetUnitY(integer516),275,VH9)
  call GroupRemoveUnit(HQ9,integer516)
  if FirstOfGroup(HQ9)==null then
    set Cache=GetHandleId(DOD)
    if((LoadInteger(hashtable019,(GetHandleId((DOD))),((4275))))==1)==false then
      if IsUnitIllusion(DOD) and IsUnitType(DOD,UNIT_TYPE_RANGED_ATTACKER)==true then
        set d=d/2
      endif
      call DamageTarget(DOD,integer516,3,d)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl",integer516,"overhead"))
      call AddTimedKeyToUnit(DOD,4275,.3)
    endif
  endif
  call KillGroup(HQ9)
  set HQ9=null
  set DOD=null
  set integer516=null
  set VH9=null
endfunction

function QN9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function J1G))
  call TriggerAddAction(t,function J5G)
  set t=null
endfunction

function Spectre_Dispersion_Spread takes nothing returns nothing
  local real d=DistanceBetweenUnits(GetTriggerUnit(),GetEnumUnit())-25
  local real multiplier=(1000-d)/700
  if multiplier>1. then
    set multiplier=1.
  endif
  if multiplier>0 then
    set WL7[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=true
    call DamageTarget(GetTriggerUnit(),GetEnumUnit(),3,KU8*multiplier)
    set WL7[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=false
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl",GetEnumUnit(),"chest"))
  endif
endfunction

function Spectre_Dispersion_Act takes nothing returns boolean
  local unit Hero=GetTriggerUnit()
  local real Damage=GetEventDamage()
  local integer Level=IMaxIF(GetUnitAbilityLevel(Hero,'A0NA'),GetUnitAbilityLevel(Hero,'QP20'))
  local group g
  if IsDamageReal(Damage) and IsRealDamage and GetUnitAbilityLevel(Hero,'BNdo')==0 then
    set g=GetAvailableGroup()
    if not(Mode_BO) and GetUnitPrimaryAttribute(Hero)==3 then
      set KU8=Damage*(.06+.02*Level)
    else
      set KU8=Damage*(.06+.04*Level)
    endif
    call HealUnitFor(Hero,KU8)
    call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),1025,Condition(function LR8))
    call ForGroup(g,function Spectre_Dispersion_Spread)
    call KillGroup(g)
  endif
  set Hero=null
  set g=null
  return false
endfunction

function Spectre_Dispersion_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function Spectre_Dispersion_Act))
  set t=null
endfunction

function Spectre_Dispersion_Init takes nothing returns boolean
  if (GetLearnedSkill()=='A0NA' or GetLearnedSkill()=='QP20') and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call Spectre_Dispersion_Learn()
  endif
  return false
endfunction

function Spectre_Dispersion_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Spectre_Dispersion_Init))
  set t=null
endfunction

function KDG takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local unit Hero=GetTriggerUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call SaveUnitHandle(hashtable019,(GetHandleId(Caster)),(387),(Target))
  call UnitAddAbility2(Caster,('A0N9'))
  call SetUnitAbilityLevel(Caster,('A0N9'),GetUnitAbilityLevel(Hero,('A0H9')))
  call IssueTargetOrderById(Caster,852274,Hero)
  
  set Target = null
  set Caster = null
  set Hero = null
endfunction

function strings024 takes nothing returns boolean
  return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit())))!=null
endfunction

function KFG takes nothing returns nothing
  local trigger trig = GetTriggeringTrigger()
  local integer Cache=GetHandleId(trig)
  local unit W39=(LoadUnitHandle(hashtable019,(Cache),(386)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(387)))
  local integer integer573=(LoadInteger(hashtable019,(Cache),(385)))
  if GetTriggerEventId()!=EVENT_UNIT_DEATH and GetTriggerEventId()!=EVENT_UNIT_ISSUED_TARGET_ORDER and GetTriggerEventId()!=EVENT_UNIT_ISSUED_POINT_ORDER then
    set integer573=integer573+1
    call SaveInteger(hashtable019,(Cache),(385),(integer573))
  endif
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call DisableTrigger(GetTriggeringTrigger())
    call FlushChildHashtable(hashtable019,(GetHandleId(trig)))
    call SaveInteger(hashtable019,(Cache),(385),(integer573))
    if Target==GetTriggerUnit()then
      call KillUnit(W39)
    endif
    call CleanTrigger(trig)
  elseif IsUnitPaused(W39)==false then
    if integer573==2 then
      call SetUnitVertexColor(W39,255,255,255,255)
    endif
    if integer573>1 then
      call DisableTrigger(trig)
      call IssueTargetOrderById(W39,851983,Target)
      call EnableTrigger(trig)
    else
      call DisableTrigger(trig)
      call IssueTargetOrderById(W39,851986,Target)
      call EnableTrigger(trig)
    endif
  endif
  
  set Target = null
  set trig = null
  set W39 = null
endfunction

function integers153 takes nothing returns boolean
  return GetUnitAbilityLevel(GetSummonedUnit(),('B06L'))>0
endfunction

function integers151 takes nothing returns nothing
  local unit Caster=GetSummoningUnit()
  local unit W39=GetSummonedUnit()
  local unit Target=(LoadUnitHandle(hashtable019,(GetHandleId(Caster)),(387)))
  local trigger t=CreateTrigger()
  call SaveUnitHandle(hashtable019,(GetHandleId(udg_Hero[GetPlayerId(GetOwningPlayer(Caster))])),(7100+GetHandleId(W39)),(Target))
  call SetUnitPathing(W39,false)
  call SetUnitMoveSpeed(W39,400)
  call SetUnitX(W39,GetUnitX(Target))
  call SetUnitY(W39,GetUnitY(Target))
  call IssueTargetOrderById(W39,851986,Target)
  call SetUnitVertexColor(W39,255,255,255,50)
  call TriggerRegisterUnitEvent(t,W39,EVENT_UNIT_ISSUED_TARGET_ORDER)
  call TriggerRegisterUnitEvent(t,W39,EVENT_UNIT_ISSUED_POINT_ORDER)
  call TriggerRegisterUnitEvent(t,W39,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddAction(t,function KFG)
  call DestroyEffect(AddSpecialEffect("units\\nightelf\\SpiritOfVengeance\\SpiritOfVengeance.mdl",GetUnitX(W39),GetUnitY(W39)))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(387),(Target))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(386),(W39))
  call SaveInteger(hashtable019,(GetHandleId(t)),(385),(0))
  call FlushChildHashtable(hashtable019,(GetHandleId(Caster)))
  set Caster=null
  set W39=null
  set Target=null
  set t=null
endfunction

function Spectre_Haunt takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local group HQ9=GetAvailableGroup()
  local boolexpr VH9=Condition(function strings024)
  local sound XP8
  call UnitAddAbility2(GetTriggerUnit(),('A0HA'))
  call SetUnitPathing(Hero,false)
  call GroupEnumUnitsInRect(HQ9,bj_mapInitialPlayableArea,VH9)
  call ForGroup(HQ9,function KDG)
  call SetUnitPathing(Hero,true)
  if FirstOfGroup(HQ9)!=null then
    set XP8=CreateSound("Abilities\\Spells\\Other\\ANsa\\SacrificeUnit.wav",false,false,false,10,10,"DefaultEAXON")
    call StartSound(XP8)
    call KillSoundWhenDone(XP8)
  endif
  call KillGroup(HQ9)
  set HQ9=null
  set Hero=null
  set VH9=null
endfunction

function integer578 takes nothing returns boolean
  return GetLearnedSkill()==('A0H9')and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1
endfunction

function integer574 takes nothing returns nothing
  call UnitAddAbility2(GetTriggerUnit(),('A0HA'))
endfunction

function QP9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function integers153))
  call TriggerAddAction(t,function integers151)
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function integer578))
  call TriggerAddAction(t,function integer574)
  call CreateSound("Abilities\\Spells\\Other\\ANsa\\SacrificeUnit.wav",false,false,false,10,10,"DefaultEAXON")
  call PreloadAbility(('A0N9'))
  set t = null
endfunction

function KOG takes nothing returns boolean
  return GetUnitAbilityLevel(GetFilterUnit(),('B06L'))>0
endfunction

function KPG takes nothing returns nothing
  local unit XX8
  local real YR8=YX8(GetEnumUnit(),GetSpellTargetLoc())
  if YR8<TmpReal378 then
    set TmpUnit376=GetEnumUnit()
    set TmpReal378=YR8
  endif
  set XX8=null
endfunction

function KQG takes nothing returns unit
  local group HQ9=GetAvailableGroup()
  local boolexpr VH9=Condition(function KOG)
  set TmpUnit376=null
  set TmpReal378=9999999
  call GroupEnumUnitsOfPlayer(HQ9,GetOwningPlayer(GetTriggerUnit()),VH9)
  call ForGroup(HQ9,function KPG)
  set KV8=HQ9
  set HQ9=null
  set VH9=null
  return TmpUnit376
endfunction

function Spectre_Reality_DmgFunc takes nothing returns nothing
  call DamageTarget(RealityTempUnit,GetEnumUnit(),1,GetUnitAbilityLevel(RealityTempUnit,'A0H9')*50+50)
endfunction

function Spectre_Reality_AoEDamage takes unit hero, unit illus returns nothing
  local group g=GetAvailableGroup()
  set tt_unit1=hero
  call GroupEnumUnitsInRange(g,GetUnitX(illus),GetUnitY(illus),375,Condition(function DefaultEnemyFilter))
  set RealityTempUnit=hero
  call ForGroup(g,function Spectre_Reality_DmgFunc)
  call KillGroup(g)
  set g=null
endfunction

function Spectre_Reality takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=KQG()
  local unit HYD=(LoadUnitHandle(hashtable019,(GetHandleId(Hero)),(7100+GetHandleId(Target))))
  local real TargetX
  local real TargetY
  if Target==null then
    call Error(GetOwningPlayer(Hero),GetObjectName('n03Z'))
  else
    set TargetX=GetUnitX(Target)
    set TargetY=GetUnitY(Target)
    set KV8=null
    call Spectre_Reality_AoEDamage(Hero,Target)
    call SetUnitX(Hero,TargetX)
    call SetUnitY(Hero,TargetY)
    call KillUnit(Target)
    
    if DistanceBetweenXY(GetCameraEyePositionX(),GetCameraEyePositionY(),GetUnitX(Target),GetUnitY(Target))>1400 then
      call PanCameraToTimedForPlayer(GetOwningPlayer(Hero),TargetX,TargetY,0)
    endif
    call IssueTargetOrderById(Hero,851983,HYD)
  endif
  set Hero=null
  set Target=null
  set HYD=null
endfunction

function Reality_CheckValid takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=KQG()
  if Target==null then
    call InterruptUnit(Hero)
    call Error(GetOwningPlayer(Hero),GetObjectName('n03Z'))
  endif
  set Hero=null
  set Target=null
endfunction


function Spiritbreaker_Greaterbash_Duration takes nothing returns nothing
  local unit u = null
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)-1
  local real angle
  local real speed
  local real x
  local real y
  
  call SaveInteger(MHT,info,0,count)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl",u,"origin"))
  if count > LoadInteger(MHT,info,1)then
    set speed = 5.
    set angle = LoadReal(MHT,info,0)
    set u = LoadUnitHandle(MHT,info,0)
    
    if count==119 and LoadBoolean(MHT,info,0)then
      call IssueTargetOrder(LoadUnitHandle(MHT,info,1),"attack",u)
    elseif 105 > count then
      set speed = 2.45
    endif
    
    set x = SafeX50(GetWidgetX(u) + speed*Cos(angle))
    set y = SafeY50(GetWidgetY(u) + speed*Sin(angle))
    
    if IsPointInRegion(RestrictedRegion,x,y)==false then
      call SetUnitX(u,x)
      call SetUnitY(u,y)
    endif
    
    
    call KillTrees(x,y,150)
    
    set u = null
  elseif count==0 then
    set u = LoadUnitHandle(MHT,info,1)
    set info = GetHandleId(u)
    set count = LoadInteger(MHT,info,'A0G5')-1
    
    call SaveInteger(MHT,info,'A0G5',count)
    
    if count==0then
      call UnitRemoveAbility(u,'A24H')
      call UnitRemoveAbility(u,'B0EC')
    endif
    
    call Timer_End(t)
    
    set u = null
  endif
  
  set t = null
endfunction

function Spiritbreaker_GreaterBash_Pushing takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit target=(LoadUnitHandle(hashtable019,(h),(17)))
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local real angle=(LoadReal(hashtable019,(h),(13)))
  local real x=GetUnitX(target)
  local real y=GetUnitY(target)
  local integer count=GetTriggerEvalCount(t)
  local real dist=2
  local integer limit=(LoadInteger(hashtable019,(h),(12)))
  local integer i
  if count>35 then
    set dist=2*0.98
  endif
  if GetTriggerEventId()==EVENT_UNIT_DEATH or count>limit then
    set i = LoadInteger(MHT,h,'A0G5')-1
    call SaveInteger(MHT,h,'A0G5',i)
    call UnitRemoveAbility(caster,'A24H')
    call UnitRemoveAbility(caster,'B0EC')
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
  else
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl",x,y))
    call KillTrees(x,y,150)
    set x=SafeX50(x+dist*Cos(angle))
    set y=SafeY50(y+dist*Sin(angle))
    if(IsPointInRegion(RestrictedRegion,((x)*1.0),((y)*1.0)))==false then
      if IsUnitType(target,UNIT_TYPE_HERO)then
        call SaveBoolean(HeroStats,GetHandleId(target),99,true)
      endif
      call SetUnitX(target,x)
      call SetUnitY(target,y)
    endif
    if count==1 and LoadBoolean(hashtable019,h,0) then
      call IssueTargetOrder(caster,"attack",target)
    endif
  endif
  set t=null
  set target=null
  set caster=null
  return false
endfunction

function Spiritbreaker_Greaterbash_Start takes unit caster, unit target, integer level, boolean attack returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.01,true)
  call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Spiritbreaker_GreaterBash_Pushing))
  call SaveInteger(hashtable019,h,12,80+20*level)//1,1.2,1.4,1.6
  call SaveUnitHandle(hashtable019,h,2,caster)
  call SaveUnitHandle(hashtable019,h,17,target)
  call SaveBoolean(hashtable019,h,0,attack)
  call SaveReal(hashtable019,h,13,Atan2(GetUnitY(target)-GetUnitY(caster),GetUnitX(target)-GetUnitX(caster)))
  call UnitAddAbility2(caster,'A24H')
  call DamageTarget(caster,target,1,GetUnitMoveSpeedLOD(caster)*0.1*level)
  call SaveInteger(MHT,GetHandleId(caster),'A0G5',LoadInteger(MHT,GetHandleId(caster),'A0G5')+1)
  set t=null
endfunction

function Spiritbreaker_Greaterbash_Start_Old takes unit u, unit t, integer level, boolean b returns nothing
  local timer time = Timer_Get()
  local integer info = GetHandleId(time)
  local real x2 = GetWidgetX(t)
  local real y2 = GetWidgetY(t)
  local real x1 = GetWidgetX(u)
  local real y1 = GetWidgetY(u)
  call UnitAddAbility2(u,'A24H')
  call DamageTarget(u,t,1,GetUnitMoveSpeedLOD(u)*0.1*level)
  call SaveInteger(MHT,GetHandleId(u),'A0G5',LoadInteger(MHT,GetHandleId(u),'A0G5')+1) //stacking integer so that the movespeed ability is not removed early >:3
  
  call SaveBoolean(MHT,info,0,b)
  call SaveInteger(MHT,info,0,120)
  call SaveInteger(MHT,info,1,120 - (8*level + 32))
  call SaveReal(MHT,info,0,Atan2(y2-y1,x2-x1))
  call SaveUnitHandle(MHT,info,0,t)
  call SaveUnitHandle(MHT,info,1,u)
  
  call TimerStart(time,0.025,true, function Spiritbreaker_Greaterbash_Duration)
  set time=null
  set t = null
endfunction

function Spiritbreaker_Greaterbash_Cast takes unit u, unit t, boolean b, integer i returns nothing
  //types: 1=greater bash itself, 2=bara's strike, 3=charge
  local unit d 
  local integer level
  if GetUnitAbilityLevel(u,'BNdo')>0 then
    return
  endif
  set level=GetUnitAbilityLevel(u,'A0G5')+GetUnitAbilityLevel(u,'QP1X')
  set d=CreateUnit(GetOwningPlayer(t),'e00E',0,0,0)
  if level==0 then
    if i==2 then
      set level=4
    elseif i==3 then
      set level=GetUnitAbilityLevel(u,'A1P8')
    endif
  endif
  call UnitAddAbility(d,'A1WQ')
  call SetUnitAbilityLevel(d,'A1WQ',level)
  
  if IssueTargetOrderById(d,852095,t)then
    call Spiritbreaker_Greaterbash_Start(u,t,level,b)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl",u,GetProperAttachPoint_Weapon(u)))
  endif
  
  set d = null
endfunction

function GreaterBash_CD takes nothing returns nothing
  local timer t=GetExpiredTimer()
  call SaveBoolean(MHT,LoadInteger(MHT,GetHandleId(t),0),StringHash("greaterbash_cd"),false)
  call FlushChildHashtable(MHT,GetHandleId(t))
  call DestroyTimer(t)
  set t=null
endfunction

function Spiritbreaker_Greaterbash_Condition_Old takes nothing returns boolean
  local unit u = GetAttacker()
  local unit t = GetTriggerUnit()
  local real chance = .17
  local timer tt
  if IMaxIF(GetUnitAbilityLevel(u,'A0G5'),GetUnitAbilityLevel(u,'QP1X'))>0 and IsUnitEnemy(u,GetOwningPlayer(t)) and IsUnitIllusion(u)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(t)!='n00L' and (Mode_BO or LoadBoolean(MHT,GetHandleId(u),StringHash("greaterbash_cd"))==false)then
    if not(Mode_BO) and IsUnitType(u,UNIT_TYPE_RANGED_ATTACKER)==true then
      set chance = .1
    endif
    
    if chance > GetRandomReal(0.01,1) then
      call Spiritbreaker_Greaterbash_Cast(u,t,true,1)
      if Mode_BO==false then
        set tt=CreateTimer()
        call TimerStart(tt,1.5,false,function GreaterBash_CD)
        call SaveBoolean(MHT,GetHandleId(u),StringHash("greaterbash_cd"),true)
        call SaveInteger(MHT,GetHandleId(tt),0,GetHandleId(u))
        set tt=null
      endif
    endif
  endif
  
  set u = null
  set t = null
  return false
endfunction

function Spiritbreaker_Greaterbash_Damaged takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local unit target=LoadUnitHandle(hashtable019,h,1)
  local timer tt
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==u and IsRealDamage and IsFakeDamage==false and GetEventDamage()>0 then
      call DisableTrigger(t)
      call Spiritbreaker_Greaterbash_Cast(u,target,true,1)
      if Mode_BO==false then
        set tt=CreateTimer()
        call TimerStart(tt,1.5,false,function GreaterBash_CD)
        call SaveBoolean(MHT,GetHandleId(u),StringHash("greaterbash_cd"),true)
        call SaveInteger(MHT,GetHandleId(tt),0,GetHandleId(u))
        set tt=null
      endif
      call RemoveSavedHandle(MHT,GetHandleId(u),'GBSH')
      call FlushChildHashtable(hashtable019,h)
      call CleanTrigger(t)
    endif
  else
    call RemoveSavedHandle(MHT,GetHandleId(u),'GBSH')
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  endif
  set t=null
  set u=null
  set target=null
endfunction

function Spiritbreaker_Greaterbash_Condition takes nothing returns nothing
  local trigger t
  local integer h
  local unit u=GetAttacker()
  local unit target=GetTriggerUnit()
  local real chance=17
  local trigger tt
  if GetUnitAbilityLevel(u,'A0G5')+GetUnitAbilityLevel(u,'QP1X')>0 and IsUnitEnemy(u,GetOwningPlayer(target)) and IsUnitIllusion(u)==false and IsUnitType(target,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(target)!='n00L' and (Mode_BO or LoadBoolean(MHT,GetHandleId(u),StringHash("greaterbash_cd"))==false) then
    if not(Mode_BO) and IsUnitType(u,UNIT_TYPE_RANGED_ATTACKER)==true then
      set chance =10
    endif
    if PRD_Get(u,'A0G5',chance) then
      set t=CreateTrigger()
      //call echo("created")
      set h=GetHandleId(t)
      call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DAMAGED)
      call TriggerRegisterTimerEvent(t,4,false)
      call SaveUnitHandle(hashtable019,h,0,u)
      call SaveUnitHandle(hashtable019,h,1,target)
      call TriggerAddCondition(t,Condition(function Spiritbreaker_Greaterbash_Damaged))
      set tt=LoadTriggerHandle(MHT,GetHandleId(u),'GBSH')
      if tt!=null then
        call FlushChildHashtable(hashtable019,GetHandleId(tt))
        call DestroyTrigger(tt)
      endif
      call SaveTriggerHandle(MHT,GetHandleId(u),'GBSH',t)
      set tt=null
    endif
    
    
  endif
  set t=null
  set u=null
  set target=null
endfunction

function Spiritbreaker_Greaterbash_Init takes nothing returns nothing
  local integer loopA = 1
  local trigger trig = CreateTrigger()
  
  call TriggerRegisterAnyUnitEvent(trig,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(trig,Condition(function Spiritbreaker_Greaterbash_Condition))
  
  loop
    exitwhen loopA == 11
    call SetPlayerAbilityAvailable2(Player(loopA),'A24H',false)
    set loopA = loopA + 1
  endloop
  
  set trig = null
endfunction


function Spiritbreaker_Charge_Retargets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local unit u = group_temp_unit[0]
  local real x1
  local real y1
  local real x2
  local real y2
  local real distance
  
  if IsUnitEnemy(u,GetOwningPlayer(t)) and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(t,'A04R')==0 and IsUnitVisibleLoD(t,GetOwningPlayer(u)) and IsDead(t)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) and IsMagicImmune(t)==false then
    set u = group_temp_unit[2]
    set x1 = GetWidgetX(u)
    set y1 = GetWidgetY(u)
    set x2 = GetWidgetX(t)
    set y2 = GetWidgetY(t)
    set distance = SquareRoot((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2))
    
    if group_temp_real[0] > distance then
      set group_temp_unit[1] = t
      set group_temp_real[0] = distance
    endif
  endif
  set t = null
  set u = null
  return false
endfunction

function Spiritbreaker_Charge_Retarget takes unit u, unit t, integer i returns boolean
  local string s = ""
  
  set group_temp_unit[0] = u
  set group_temp_unit[1] = null
  set group_temp_unit[2] = t
  set group_temp_real[0] = 99999.0
  
  call GroupEnumUnitsInRange(temp_group,GetWidgetX(t),GetWidgetY(t),4000,Condition(function Spiritbreaker_Charge_Retargets))
  
  if group_temp_unit[1]==null then
    call IssueImmediateOrder(u,"stop")
    return true
  endif
  if group_temp_unit[1]!=null then
    //call UnitShareVision(group_temp_unit[1],GetOwningPlayer(u),true)
    call UnitAddAbility2(group_temp_unit[1],'A315')
    call ShareVision(group_temp_unit[1],u,'A315')
    call SaveUnitHandle(MHT,GetHandleId(u),StringHash("ChargedUnit"),group_temp_unit[1])
  endif
  if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(u))or IsObserver(GetLocalPlayer())then
    set s="Abilities\\Spells\\Other\\HowlOfTerror\\HowlTarget.mdl"
  endif
  
  call DestroyEffect(LoadEffectHandle(MHT,i,5))
  call DestroyEffect(LoadEffectHandle(MHT,i,4))
  
  call SaveEffectHandle(MHT,i,4,AddSpecialEffectTarget(s,group_temp_unit[1],"overhead"))
  call SaveEffectHandle(MHT,i,5,AddSpecialEffectTarget(s,group_temp_unit[1],"overhead"))
  
  call SaveUnitHandle(MHT,i,1,group_temp_unit[1])
  //call UnitShareVision(group_temp_unit[2],GetOwningPlayer(u),false)
  call UnitRemoveAbility(group_temp_unit[2],'A315')
  return false
endfunction

function Spiritbreaker_Charge_End takes timer t, unit u, unit target, integer info returns nothing
  local string s=LoadStr(HeroStats,GetUnitTypeId(u),COLOR)
  local integer r=255
  local integer g=255
  local integer b=255
  if(s!="" and s!=null)then
    set r=S2I(SubString(s,0,3))
    set g=S2I(SubString(s,3,6))
    set b=S2I(SubString(s,6,9))
  endif
  
  call SetUnitTimeScale(u,1)
  call SetUnitPathing(u,true)
  call SetUnitAnimation(u,"stand")
  call SetUnitVertexColor(u,r,g,b,255)
  if LoadUnitHandle(MHT,GetHandleId(u),StringHash("ChargedUnit"))!=null then //[lich] fix retargeted unit vision
    //call UnitShareVision(LoadUnitHandle(MHT,GetHandleId(u),StringHash("ChargedUnit")),GetOwningPlayer(u),false)
    call UnitRemoveAbility(LoadUnitHandle(MHT,GetHandleId(u),StringHash("ChargedUnit")),'A315')
  endif //
  
  //call UnitShareVision(target,GetOwningPlayer(u),false)
  call UnitRemoveAbility(target,'A315')
  call SaveBoolean(MHT,GetHandleId(u),'A1P8',false)
  
  call DestroyEffect(LoadEffectHandle(MHT,info,5))
  call DestroyEffect(LoadEffectHandle(MHT,info,4))
  call DestroyEffect(LoadEffectHandle(MHT,info,3))
  call KillGroup(LoadGroupHandle(MHT,info,2))
  
  call Timer_End(t)
endfunction

function Spiritbreaker_Charge_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local unit u = group_temp_unit[0]
  local group g = LoadGroupHandle(MHT,group_temp_integer[0],2)
  
  if IsUnitEnemy(u,GetOwningPlayer(t)) and IsUnitInGroup(t,g)==false and t!=group_temp_unit[1] and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(t,'A04R')==0 and IsDead(t)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) then
    call GroupAddUnit(g,t)
    call Spiritbreaker_Greaterbash_Cast(u,t,false,3)
  endif
  
  set t = null // reverse gut E:
  set u = null
  set g = null
  return false
endfunction

function Spiritbreaker_Charge_Duration takes nothing returns nothing
  local timer time = GetExpiredTimer()
  local integer info = GetHandleId(time)
  local unit u = LoadUnitHandle(MHT,info,0)
  local unit t = LoadUnitHandle(MHT,info,1)
  local real x1 = GetWidgetX(u)
  local real y1 = GetWidgetY(u)
  local real distance
  local real angle
  local real speed
  local real x2
  local real y2
  
  if LoadBoolean(MHT,GetHandleId(u),'A1P8')==false  or (IsDead(t) and Spiritbreaker_Charge_Retarget(u,t,info))then
    call Spiritbreaker_Charge_End(time,u,t,info)
    call KillTrees(x1,y1,200)
    set time = null
    set t = null
    set u = null
    return
  endif
  
  set x2 = GetWidgetX(t)
  set y2 = GetWidgetY(t)
  set speed = LoadReal(MHT,info,0)
  set distance = SquareRoot((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2))
  
  if 100 > distance then
    call Spiritbreaker_Charge_End(time,u,t,info)
    //call SetUnitPosition(u,x2,y2)
    call IssueTargetOrder(u,"attack",t)
    call SetUnitAnimation(u,"attack")
    call Spiritbreaker_Greaterbash_Cast(u,t,true,3)
    call KillTrees(x1,y1,200)
    set u=CreateUnit(GetOwningPlayer(t),'e00E',GetWidgetX(t),GetWidgetY(t),0)
    call UnitAddAbility(u,'A0GS')
    call SetUnitAbilityLevel(u,'A0GS',LoadInteger(MHT,info,0))
    call IssueTargetOrderById(u,852095,t)
    
    set time = null
    set t = null
    set u = null
    return
  endif
  
  set angle = Atan2(y2-y1,x2-x1)
  set group_temp_integer[0] = info
  set x2 = x1 + speed*Cos(angle)
  set y2 = y1 + speed*Sin(angle)
  set group_temp_unit[0] = u
  set group_temp_unit[1] = t
  
  call SetUnitFacing(u,angle*bj_RADTODEG)
  call SetUnitX(u,x2)
  call SetUnitY(u,y2)
  
  call GroupEnumUnitsInRange(temp_group,x2,y2,325,Condition(function Spiritbreaker_Charge_Targets))
  
  set time = null
  set t = null
  set u = null
endfunction

function Spiritbreaker_Charge_Stop takes nothing returns nothing
  local unit target=LoadUnitHandle(MHT,GetHandleId(GetTriggerUnit()),StringHash("ChargedUnit"))
  call SaveBoolean(MHT,GetHandleId(GetTriggerUnit()),'A1P8',false)
  //call UnitShareVision(target,GetOwningPlayer(GetTriggerUnit()),false)
  call UnitRemoveAbility(target,'A315')
  set target=null
endfunction

function Spiritbreaker_Charge_Start takes nothing returns nothing
  local timer time = Timer_Get()
  local unit caster = GetTriggerUnit()
  local unit target = GetSpellTargetUnit()
  local integer info = GetHandleId(time)
  local integer save = GetHandleId(caster)
  local integer level = GetUnitAbilityLevel(caster,'A1P8')
  local string s=LoadStr(HeroStats,GetUnitTypeId(caster),COLOR)
  local integer r=255
  local integer g=255
  local integer b=255
  if(s!="" and s!=null)then
    set r=S2I(SubString(s,0,3))
    set g=S2I(SubString(s,3,6))
    set b=S2I(SubString(s,6,9))
  endif
  set s=""
  if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(caster))or IsObserver(GetLocalPlayer())then
    set s="Abilities\\Spells\\Other\\HowlOfTerror\\HowlTarget.mdl"
    call PingMinimapEx(GetWidgetX(target),GetWidgetY(target),2,255,255,255,false)
  endif
  call SetUnitPathing(caster,false)
  call SetUnitTimeScale(caster,2.5)
  call SetUnitAnimationByIndex(caster,LoadInteger(MHT,GetUnitTypeId(caster),'A1P8'))
  call SetUnitVertexColor(caster,r,g,b,100)
  //call UnitShareVision(target,GetOwningPlayer(caster),true)
  call UnitAddAbility2(target,'A315')
  call ShareVision(target,caster,'A315')
  
  call SaveBoolean(MHT,save,'A1P8',true)
  
  call SaveUnitHandle(MHT,info,0,caster)
  call SaveUnitHandle(MHT,info,1,target)
  call SaveUnitHandle(MHT,GetHandleId(caster),StringHash("ChargedUnit"),target)
  call SaveGroupHandle(MHT,info,2,GetAvailableGroup())
  call SaveEffectHandle(MHT,info,3,AddSpecialEffectTarget("war3mapImported\\ShockwaveMissilePurple.mdx",caster,"origin"))
  call SaveEffectHandle(MHT,info,4,AddSpecialEffectTarget(s,target,"overhead"))
  call SaveEffectHandle(MHT,info,5,AddSpecialEffectTarget(s,target,"overhead"))
  call SaveInteger(MHT,info,0,level)
  call SaveReal(MHT,info,0,level*1.25 + 13.75)
  
  call TimerStart(time,0.025,true,function Spiritbreaker_Charge_Duration)
  
  set caster = null
  set target = null
  set time = null
endfunction

function Spiritbreaker_Charge_Learn takes nothing returns nothing
  call SetPlayerAbilityAvailable2(GetOwningPlayer(GetTriggerUnit()),'A179',false)
endfunction

function Spiritbreaker_Charge_Init takes nothing returns nothing
  //call PreloadAbility('A0X6')
  
  //walking animations
  call SaveInteger(MHT,'H06S','A1P8',11) //kunka
  call SaveInteger(MHT,'H00D','A1P8',0)  //Beastmaster
  call SaveInteger(MHT,'H000','A1P8',0)  //Centaur
  call SaveInteger(MHT,'Otch','A1P8',1)  //Earthshaker
  call SaveInteger(MHT,'Harf','A1P8',12) //Omniknight
  call SaveInteger(MHT,'Npbm','A1P8',0)  //Panda Brewmaster
  call SaveInteger(MHT,'H001','A1P8',0)  //Sven
  call SaveInteger(MHT,'Ucrl','A1P8',1)  //Tiny, no tree
  call SaveInteger(MHT,'Ucrl','A1P8',8)  //Tiny, with tree
  call SaveInteger(MHT,'O015','A1P8',1)  //Tauren Chieften
  call SaveInteger(MHT,'Hamg','A1P8',8)  //Roof
  call SaveInteger(MHT,'O01F','A1P8',3)  //Wisp
  call SaveInteger(MHT,'N01I','A1P8',4)  //Alchemist, normal
  call SaveInteger(MHT,'N01H','A1P8',15) //Alchemist, chemical rage 1
  call SaveInteger(MHT,'N01T','A1P8',15) //Alchemist, chemical rage 2
  call SaveInteger(MHT,'N01J','A1P8',15) //Alchemist, chemical rage 3
  call SaveInteger(MHT,'H600','A1P8',15) //Alchemist, chemical rage 1
  call SaveInteger(MHT,'H601','A1P8',15) //Alchemist, chemical rage 2
  call SaveInteger(MHT,'H602','A1P8',15) //Alchemist, chemical rage 3
  call SaveInteger(MHT,'H00T','A1P8',0)  //Clockwerk
  call SaveInteger(MHT,'Hlgr','A1P8',6)  //Dragon Knight
  call SaveInteger(MHT,'H00E','A1P8',4)  //Dragon Knight, dragon 1
  call SaveInteger(MHT,'H00F','A1P8',4)  //Dragon Knight, dragon 2
  call SaveInteger(MHT,'H00G','A1P8',4)  //Dragon Knight, dragon 3
  call SaveInteger(MHT,'H00Q','A1P8',17) //Huskar
  call SaveInteger(MHT,'H008','A1P8',1)  //Bristleback
  call SaveInteger(MHT,'E02F','A1P8',5)  //Phoenix
  call SaveInteger(MHT,'E02I','A1P8',12) //Tuskarr
  call SaveInteger(MHT,'E02K','A1P8',0)  //Legion Commander
  call SaveInteger(MHT,'E032','A1P8',6)  //Shredder
  call SaveInteger(MHT,'N0MU','A1P8',0)  //Kaolin
  
  call SaveInteger(MHT,'Edem','A1P8',8)  //antimage
  call SaveInteger(MHT,'Usyl','A1P8',4)  //sniper
  call SaveInteger(MHT,'Nbbc','A1P8',6)  //juggernaut
  call SaveInteger(MHT,'N01O','A1P8',8)  //Syllabear, normal form
  call SaveInteger(MHT,'N013','A1P8',13) //Syllabear, bear form 1
  call SaveInteger(MHT,'N014','A1P8',13) //Syllabear, bear form 2
  call SaveInteger(MHT,'N015','A1P8',13) //Syllabear, bear form 3
  call SaveInteger(MHT,'E005','A1P8',1)  //Luna
  call SaveInteger(MHT,'H0DL','A1P8',1)  //morphling
  call SaveInteger(MHT,'HC49','A1P8',2)  //Siren
  call SaveInteger(MHT,'Ogrh','A1P8',0)  //Phantom Lancer
  call SaveInteger(MHT,'N01V','A1P8',6)  //Potm
  call SaveInteger(MHT,'HC92','A1P8',10) //Riki
  call SaveInteger(MHT,'N016','A1P8',8)  //Troll Warlord, normal form
  call SaveInteger(MHT,'N017','A1P8',8)  //Troll Warlord, melee1
  call SaveInteger(MHT,'QTW2','A1P8',8)  //Troll Warlord, melee2
  call SaveInteger(MHT,'QTW3','A1P8',8)  //Troll Warlord, melee3
  call SaveInteger(MHT,'N02B','A1P8',8)  //Troll Warlord, melee4
  call SaveInteger(MHT,'E02N','A1P8',2)  //gryo, normal form
  call SaveInteger(MHT,'E02O','A1P8',2)  //gryo, barrage form
  call SaveInteger(MHT,'Nbrn','A1P8',8)  //Drow Ranger
  call SaveInteger(MHT,'E01Y','A1P8',2)  //Templar Assassin, dat ass :3
  call SaveInteger(MHT,'Huth','A1P8',0)  //Ursa Warrior
  call SaveInteger(MHT,'Hvwd','A1P8',5)  //Vengeful Spirit	
  call SaveInteger(MHT,'Naka','A1P8',2)  //Bounty Hunter
  call SaveInteger(MHT,'N0M0','A1P8',0)  //Ember Spirit
  
  call SaveInteger(MHT,'Hjai','A1P8',6)  //Crystal Maiden
  call SaveInteger(MHT,'Emoo','A1P8',8)  //Enchantress
  call SaveInteger(MHT,'N00B','A1P8',3)  //Fairie Dragon
  call SaveInteger(MHT,'H00A','A1P8',2)  //Chen
  call SaveInteger(MHT,'Hblm','A1P8',0)  //keeper of the light
  call SaveInteger(MHT,'Hmbr','A1P8',20) //Zeus
  call SaveInteger(MHT,'Emns','A1P8',7)  //Furion
  call SaveInteger(MHT,'N01A','A1P8',1)  //Silencer
  call SaveInteger(MHT,'H004','A1P8',2)  //Lina
  call SaveInteger(MHT,'H00S','A1P8',0)  //Storm
  call SaveInteger(MHT,'N0M0','A1P8',0)  //Xin
  call SaveInteger(MHT,'N0MU','A1P8',0)  //Kaolin
  call SaveInteger(MHT,'N0EG','A1P8',8)  //Windrunner
  call SaveInteger(MHT,'E02J','A1P8',2)  //Thrall
  call SaveInteger(MHT,'Hmkg','A1P8',11) //Ogre
  call SaveInteger(MHT,'H00K','A1P8',0)  //Techies
  call SaveInteger(MHT,'E00P','A1P8',4)  //Twin Headed Dragon
  call SaveInteger(MHT,'Ntin','A1P8',0)  //Tinker
  if GetRandomReal(0,1)>0.9 then
    call SaveInteger(MHT,'Ntin','A1P8',13) //Tinker, robogobo!
  endif
  call SaveInteger(MHT,'Orkn','A1P8',0)  //Rhasta
  call SaveInteger(MHT,'E02X','A1P8',1)  //Rubick
  call SaveInteger(MHT,'H0DO','A1P8',4)  //Skyhawk
  call SaveInteger(MHT,'NOMD','A1P8',1)  //Oracle
  
  call SaveInteger(MHT,'Opgh','A1P8',6)  //Axe
  call SaveInteger(MHT,'U00A','A1P8',7)  //Chaos Knight
  call SaveInteger(MHT,'UC42','A1P8',1)  //Doombringer
  call SaveInteger(MHT,'U007','A1P8',1)  //Niax
  call SaveInteger(MHT,'Udea','A1P8',0)  //Abaddon
  call SaveInteger(MHT,'U008','A1P8',2)  //Lycan, normal form
  call SaveInteger(MHT,'E015','A1P8',2)  //Lycan, wolf form
  call SaveInteger(MHT,'Udre','A1P8',4)  //Night Stalker
  call SaveInteger(MHT,'N00R','A1P8',3)  //Pit Lord
  call SaveInteger(MHT,'U00F','A1P8',1)  //Pudge
  call SaveInteger(MHT,'NC00','A1P8',2)  //Skeleton King
  call SaveInteger(MHT,'UC91','A1P8',1)  //Slardar
  call SaveInteger(MHT,'H00R','A1P8',1)  //Dirge, normal form
  call SaveInteger(MHT,'H07I','A1P8',8)  //Dirge, flesh golem
  call SaveInteger(MHT,'Ofar','A1P8',1)  //Tide
  call SaveInteger(MHT,'UC11','A1P8',3)  //Magnus
  call SaveInteger(MHT,'O00J','A1P8',2)  //Spirit Breaker
  call SaveInteger(MHT,'U00K','A1P8',1)  //Sandking
  call SaveInteger(MHT,'KODO','A1P8',9)  //KODO
  
  call SaveInteger(MHT,'Hvsh','A1P8',3)  //Bloodseeker
  call SaveInteger(MHT,'E004','A1P8',4)  //Clinkz
  call SaveInteger(MHT,'U006','A1P8',1)  //Broodmother
  call SaveInteger(MHT,'U000','A1P8',13) //Nerubian Assassin
  call SaveInteger(MHT,'Ubal','A1P8',2)  //Nerubian weaver
  call SaveInteger(MHT,'Ewar','A1P8',2)  //Phantom Assassin
  call SaveInteger(MHT,'Nfir','A1P8',2)  //Shadow Fiend
  call SaveInteger(MHT,'Eevi','A1P8',7)  //terrorblade
  call SaveInteger(MHT,'Eevm','A1P8',14) //terrorblade morphed 1
  call SaveInteger(MHT,'E02V','A1P8',14) //terrorblade morphed 2
  call SaveInteger(MHT,'E02W','A1P8',14) //terrorblade morphed 3
  call SaveInteger(MHT,'E02U','A1P8',14) //terrorblade morphed 4
  call SaveInteger(MHT,'E01B','A1P8',1)  //Spectre
  call SaveInteger(MHT,'EC57','A1P8',2)  //Venomancer
  call SaveInteger(MHT,'EC77','A1P8',5)  //Viper
  call SaveInteger(MHT,'H00I','A1P8',1)  //Meepo
  call SaveInteger(MHT,'E002','A1P8',1)  //Razor
  call SaveInteger(MHT,'H071','A1P8',1)  //Night crawler
  call SaveInteger(MHT,'EC45','A1P8',0)  //Faceless Void
  call SaveInteger(MHT,'H00V','A1P8',1)  //Medusa
  call SaveInteger(MHT,'N0MK','A1P8',9)  //Arc Warden
  
  call SaveInteger(MHT,'Oshd','A1P8',5)  //Bane Elemental
  call SaveInteger(MHT,'H00N','A1P8',2)  //Dark Seer
  call SaveInteger(MHT,'UC76','A1P8',2)  //Krobelus
  call SaveInteger(MHT,'UC18','A1P8',0)  //Lion
  call SaveInteger(MHT,'Uktl','A1P8',2)  //Enigma
  call SaveInteger(MHT,'Ulic','A1P8',4)  //Lich
  call SaveInteger(MHT,'U00E','A1P8',6)  //Necro
  call SaveInteger(MHT,'H00H','A1P8',3)  //pugna
  call SaveInteger(MHT,'U00P','A1P8',4)  //Oblivion Destroyer
  call SaveInteger(MHT,'UC01','A1P8',7)  //Queen of Pain
  call SaveInteger(MHT,'E01C','A1P8',5)  //Warlock
  call SaveInteger(MHT,'E02H','A1P8',2)  //Shadow Deamon
  call SaveInteger(MHT,'O016','A1P8',3)  //Batrider
  call SaveInteger(MHT,'O017','A1P8',3)  //Batrider, firefly
  call SaveInteger(MHT,'N01W','A1P8',8)  //Dazzle
  call SaveInteger(MHT,'H00U','A1P8',2)  //Invoker
  call SaveInteger(MHT,'UC60','A1P8',5)  //Visage
  call SaveInteger(MHT,'Ekee','A1P8',2)  //Leshrac
  call SaveInteger(MHT,'E01A','A1P8',8)  //Witch Doctor
  call SaveInteger(MHT,'N0HP','A1P8',9)  //Ancient Apperation
  call SaveInteger(MHT,'N0M7','A1P8',3)  //Winter Wyvern
  call SaveInteger(MHT,'N0MB','A1P8',3)  //Winter Wyvern, flyer 1
  call SaveInteger(MHT,'N0MC','A1P8',3)  //Winter Wyvern, flyer 2
  call SaveInteger(MHT,'N0MO','A1P8',3)  //Winter Wyvern, flyer 3
  call SaveInteger(MHT,'N0MA','A1P8',3)  //Winter Wyvern, flyer 4
endfunction

function Spiritbreaker_EmpoweringHaste_Periodic takes nothing returns nothing
  local integer i=1
  local integer prevbonus
  local integer newbonus
  local unit u
  loop
    set u=udg_Hero[i]
    if u!=null and IsDead(u)==false and IsHeroDead[i]==false and GetUnitAbilityLevel(u,'P310')>0 then
      set prevbonus=LoadInteger(MHT,GetHandleId(u),'P310')
      set newbonus=R2I(0.03*GetUnitAbilityLevel(u,'P310')*GetUnitMoveSpeedLOD(u))
      if prevbonus>newbonus then
        call LoDStat_Sub(u,prevbonus-newbonus,"damage")
        call SaveInteger(MHT,GetHandleId(u),'P310',newbonus)
      elseif prevbonus<newbonus then
        call LoDStat_Add(u,newbonus-prevbonus,"damage")
        call SaveInteger(MHT,GetHandleId(u),'P310',newbonus)
      endif
    endif
    set i=i+1
    exitwhen i>11
  endloop
  set u=null
endfunction

function Spiritbreaker_EmpoweringHaste takes nothing returns nothing
  call TimerStart(CreateTimer(),0.5,true,function Spiritbreaker_EmpoweringHaste_Periodic)
endfunction



function M7G takes unit Source,unit Target returns nothing
  call Spiritbreaker_Greaterbash_Cast(Source,Target,true,2)
endfunction

function M8G takes nothing returns nothing
  call Spiritbreaker_Greaterbash_Cast(K38,GetEnumUnit(),false,2)
endfunction

function M9G takes unit Source,unit Targer returns nothing
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  set K38=Source
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),275,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function M8G)
  call KillGroup(g)
  set g=null
endfunction

function MDG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Count=GetTriggerEvalCount(t)
  local integer real089
  local integer Level
  local real J2E
  local real LastX=(LoadReal(hashtable019,(Cache),(23)))
  local real LastY=(LoadReal(hashtable019,(Cache),(24)))
  local real x=GetUnitX(Target)
  local real y=GetUnitY(Target)
  local real d=DistanceBetweenXY(x,y,LastX,LastY)
  local string s=LoadStr(HeroStats,GetUnitTypeId(Source),COLOR)
  local integer r=255
  local integer g=255
  local integer b=255
  if(s!="" and s!=null)then
    set r=S2I(SubString(s,0,3))
    set g=S2I(SubString(s,3,6))
    set b=S2I(SubString(s,6,9))
  endif
  call SaveReal(hashtable019,(Cache),(23),((x)*1.))
  call SaveReal(hashtable019,(Cache),(24),((y)*1.))
  if GetTriggerEventId()==EVENT_UNIT_DEATH or d>1800 or Count>100 then
    call SetUnitVertexColor(Source,r,g,b,255)
    //call UnitShareVision(Target,GetOwningPlayer(Source),false)
    call UnitRemoveAbility(Target,'A314')
    call UnitRemoveAbility(Source,'A179')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set real089=50+Count*2
    call SetUnitVertexColor(Source,r,g,b,real089)
    if Count==1 then
      set Level=(LoadInteger(hashtable019,(Cache),(5)))
      set J2E=Atan2(GetUnitY(Target)-GetUnitY(Source),GetUnitX(Target)-GetUnitX(Source))
      call SetUnitPosition(Source,GetUnitX(Target)+80*Cos(J2E),GetUnitY(Target)+80*Sin(J2E))
      call SetUnitAnimation(Source,"attack")
      call IssueTargetOrderById(Source,851983,Target)
      if GetUnitAbilityLevel(Source,'A0G4')>0 then
        call M7G(Source,Target)
      else
        call M9G(Source,Target)
      endif
      call DamageTarget(Source,Target,1,50+100*Level)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function MFG takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A0G4')
  local boolean b=false
  if Level==0 then
    set Level=GetUnitAbilityLevel(Source,'A1D8')
    set b=true
  endif
  //call UnitShareVision(Target,GetOwningPlayer(Source),true)
  call UnitAddAbility2(Target,'A314')
  call ShareVision(Target,Source,'A314')
  call IssueImmediateOrder(Source,"halt")
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(23),((GetUnitX(Target))*1.))
  call SaveReal(hashtable019,(Cache),(24),((GetUnitY(Target))*1.))
  call TriggerRegisterTimerEvent(t,.01,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function MDG))
  if b then
    call UnitAddAbility2(Source,'A179')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A179',false)
  endif
  set t=null
  set Source=null
  set Target=null
endfunction

function Spiritbreaker_NetherStrike takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call MFG()
  endif
endfunction

function Sunder_SwitchConditions takes nothing returns boolean
  return GetSpellAbilityId()=='A07R'
endfunction

function MJG takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real unit127=(LoadReal(hashtable019,(Cache),(295)))
  local real unit120=(LoadReal(hashtable019,(Cache),(296)))
  local integer Level=GetUnitAbilityLevel(Source,'A07Q')
  local real MNG=.33
  if Level==2 then
    set MNG=.28
  elseif Level==3 then
    set MNG=.23
  endif
  if GetSpellTargetUnit()==Source then
    call SetUnitState(Source,UNIT_STATE_LIFE,RMaxBJ(GetUnitState(Source,UNIT_STATE_MAX_LIFE)*unit120*.01,GetUnitState(Source,UNIT_STATE_MAX_LIFE)*MNG))
  endif
  if GetSpellTargetUnit()==Target then
    call SetUnitLifePercentBJ(Target,unit127)
    if GetUnitLifePercent(Target)<25. and Level==1 and GetUnitState(Target,UNIT_STATE_LIFE)>1 then
      call SetUnitLifePercentBJ(Target,25.)
    endif
    if GetUnitLifePercent(Target)<20. and Level==2 and GetUnitState(Target,UNIT_STATE_LIFE)>1 then
      call SetUnitLifePercentBJ(Target,20.)
    endif
    if GetUnitLifePercent(Target)<15. and Level==3 and GetUnitState(Target,UNIT_STATE_LIFE)>1 then
      call SetUnitLifePercentBJ(Target,15.)
    endif
  endif
  if GetTriggerEvalCount(t)==2 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set Source=null
  set Target=null
  set t=null
endfunction

function unit124 takes nothing returns boolean
  if GetSpellAbilityId()=='A07R' then
    call MJG()
  endif
  return false
endfunction

function TB_Sunder takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local unit Caster
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(295),((GetUnitLifePercent(Source))*1.))
  call SaveReal(hashtable019,(Cache),(296),((GetUnitLifePercent(Target))*1.))
  call TriggerAddCondition(t,Condition(function unit124))
  set Caster=CreateUnit(GetOwningPlayer(Target),'e00Y',GetUnitX(Target),GetUnitY(Target),0)
  call TriggerRegisterUnitEvent(t,Caster,EVENT_UNIT_SPELL_EFFECT)
  call UnitAddAbility2(Caster,'A07R')
  call IssueTargetOrderById(Caster,852095,Source)
  call ShowUnit(Caster,false)
  call SetUnitPathing(Caster,false)
  call SetUnitInvulnerable(Caster,true)
  call UnitApplyTimedLife(Caster,'BTLF',.2)
  set Caster=CreateUnit(GetOwningPlayer(Source),'e00Y',GetUnitX(Source),GetUnitY(Source),0)
  call TriggerRegisterUnitEvent(t,Caster,EVENT_UNIT_SPELL_EFFECT)
  call UnitAddAbility2(Caster,'A07R')
  call IssueTargetOrderById(Caster,852095,Target)
  call ShowUnit(Caster,false)
  call SetUnitPathing(Caster,false)
  call SetUnitInvulnerable(Caster,true)
  call UnitApplyTimedLife(Caster,'BTLF',.2)
  set t=null
  set Source=null
  set Target=null
  set Caster=null
endfunction

function Terrorblase_Reflection_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local unit d = LoadUnitHandle(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,1)
  
  if IsDead(u) or IsDead(d)then
    call DestroyEffect(LoadEffectHandle(MHT,info,2))
    call KillUnit(d)
    call Timer_End(t)
  endif
  
  call IssueTargetOrder(d,"attack",u)
  
  set d = null
  set u = null
  set t = null
endfunction

function Terrorblase_Reflection_Illusion takes nothing returns nothing
  local integer load = GetHandleId(GetTriggerUnit())
  local unit d = GetSummonedUnit()
  local unit u = LoadUnitHandle(MHT,load,0)
  local timer t = LoadTimerHandle(MHT,load,1)
  local integer info = GetHandleId(t)
  call SetUnitMoveSpeed(d,522)
  call UnitAddAbility(d,'Aloc')
  call SetUnitOwner(d,LoadPlayerHandle(MHT,load,2),false)
  call IssueTargetOrder(d,"attack",u)
  call SetUnitX(d,GetWidgetX(u) + 100*Cos(GetRandomReal(-1.8,1.8)))
  call SetUnitY(d,GetWidgetY(u) + 100*Sin(GetRandomReal(-1.8,1.8)))
  
  call SaveUnitHandle(MHT,info,0,d)
  call SaveUnitHandle(MHT,info,1,u)
  call SaveEffectHandle(MHT,info,2,AddSpecialEffectTarget("war3mapImported\\UnholyPresence.mdx",u,"overhead"))
  
  call TimerStart(t,0.2,true,function Terrorblase_Reflection_Duration)
  call FlushChildHashtable(MHT,load)
  
  set t = null
  set u = null
  set d = null
endfunction

function Terrorblade_Reflection_Start takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local unit t = GetSpellTargetUnit()
  local unit d = CreateUnit(GetOwningPlayer(u),'e00E',0,0,0)
  local timer time = Timer_Get()
  local integer info = GetHandleId(d)
  set TempInteger=GetPlayerId(GetOwningPlayer(t))
  call Buff_Add(t,LoDBuff_AbilID[16],LoDBuff_BuffID[16],5)
  call TriggerRegisterUnitEvent(GAME_TRIGGER,d,EVENT_UNIT_SUMMON)
  call SaveUnitHandle(MHT,info,0,t)
  call SaveTimerHandle(MHT,info,1,time)
  call SavePlayerHandle(MHT,info,2,GetOwningPlayer(u))
  call SaveInteger(MHT,info,'SPEL','A24K') //used to detected illusion spells
  call UnitAddAbility(d,'A24K')
  call SetUnitAbilityLevel(d,'A24K',GetUnitAbilityLevel(u,'A2KZ'))
  call IssueTargetOrderById(d,852274,t)
  set time = null //look, not the usual order of nulling :O
  set d = null
  set t = null
  set u = null
endfunction

function TB_SoulSteal_Clear takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local unit target=(LoadUnitHandle(hashtable019,(h),(17)))
  local unit d=(LoadUnitHandle(hashtable019,(h),(19)))
  local integer lvl=(LoadInteger(hashtable019,(h),(5)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>(28)or IsUnitSilenced(target)or DistanceBetweenUnits(caster,target)>600 or IsUnitVisibleLoD(target,GetOwningPlayer(caster))==false then
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
    call KillUnit(d)
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if GetTriggerEvalCount(t)>1 and GetSpellAbilityId()=='A1RA' then
      call FlushChildHashtable(hashtable019,(h))
      call CleanTrigger(t)
      call UnitRemoveAbility(caster,'A1RA')
      call KillUnit(d)
    endif
  else
    if IsUnitAlly(caster,GetOwningPlayer(target))==false then
      call SetUnitState(caster,UNIT_STATE_LIFE,GetUnitState(caster,UNIT_STATE_LIFE)+lvl*20.0/4.0)
    else
      call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+lvl*20.0/4.0)
    endif
  endif
  set t=null
  set caster=null
  set target=null
  set d=null
  return false
endfunction

function TB_SoulSteal_Moves takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local unit target=(LoadUnitHandle(hashtable019,(h),(17)))
  local unit d=(LoadUnitHandle(hashtable019,(h),(19)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitRemoveAbility(caster,'A1RA')
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
  else
    if GetTriggerEvalCount(t)==1 then
      call IssueImmediateOrderById(caster,851993)
    endif
    if IsUnitAlly(caster,GetOwningPlayer(target))==false then
      call SetUnitX(d,GetUnitX(caster))
      call SetUnitY(d,GetUnitY(caster))
    else
      call SetUnitX(d,GetUnitX(target))
      call SetUnitY(d,GetUnitY(target))
    endif
  endif
  set t=null
  set caster=null
  set target=null
  set d=null
  return false
endfunction

function TB_SoulSteal_Start takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  local integer lvl=GetUnitAbilityLevel(caster,'A1PH')
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local unit d
  if IsUnitAlly(caster,GetOwningPlayer(target))==false then
    set d=CreateUnit(GetOwningPlayer(caster),'u01G',0,0,0)
    call UnitAddAbility(d,'A04L')
    call SetUnitAbilityLevel(d,'A04L',lvl)
    call SetUnitX(d,GetUnitX(caster))
    call SetUnitY(d,GetUnitY(caster))
    call IssueTargetOrderById(d,852487,target)
  else
    call UnitAddAbility(caster,'A1RA')
    call UnitMakeAbilityPermanent(caster,true,'A1RA')
    set d=CreateUnit(NeutralsPlayer,'u01G',0,0,0)
    call SetUnitUserData(d,GetPlayerId(GetOwningPlayer(caster)))
    call UnitAddAbility(d,'A04L')
    call SetUnitAbilityLevel(d,'A04L',lvl)
    call SetUnitX(d,GetUnitX(target))
    call SetUnitY(d,GetUnitY(target))
    call IssueTargetOrderById(d,852487,caster)
  endif
  call TriggerRegisterTimerEvent(t,0.25,true)
  call TriggerRegisterUnitEvent(t,caster,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,target,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,caster,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function TB_SoulSteal_Clear))
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  call SaveUnitHandle(hashtable019,(h),(17),(target))
  call SaveUnitHandle(hashtable019,(h),(19),(d))
  call SaveInteger(hashtable019,(h),(5),(lvl))
  set t=CreateTrigger()
  set h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0.01,true)
  call TriggerRegisterUnitEvent(t,d,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function TB_SoulSteal_Moves))
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  call SaveUnitHandle(hashtable019,(h),(17),(target))
  call SaveUnitHandle(hashtable019,(h),(19),(d))
  set caster=null
  set target=null
  set t=null
endfunction

function TB_SoulSteal takes nothing returns boolean
  if GetUnitTypeId(GetSpellTargetUnit())!='n00L' and(IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))or(IsBlocked(GetSpellTargetUnit())==false))then
    call TB_SoulSteal_Start()
  endif
  return false
endfunction


function MWG takes nothing returns nothing
  local unit Source=GetSummoningUnit()
  local unit W39=GetSummonedUnit()
  call SelectUnitAddForPlayer(W39,GetOwningPlayer(Source))
  set Source=null
  set W39=null
endfunction

function unit121 takes nothing returns boolean
  if GetUnitAbilityLevel(GetSummonedUnit(),'B0EI')>0 then
    call MWG()
  endif
  return false
endfunction

function MYG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster
  local integer Level=GetUnitAbilityLevel(Source,'A1RI')
  if Level>1 then
    set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
    call UnitAddAbility2(Caster,'A08Q')
    call SetUnitAbilityLevel(Caster,'A08Q',Level)
    call IssueTargetOrderById(Caster,852274,Source)
    if Level==4 then
      call IssueTargetOrderById(Caster,852274,Source)
    endif
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  set Caster=null
  return false
endfunction

function MZG takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.2,false)
  call TriggerAddCondition(t,Condition(function MYG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(GetTriggerUnit()))
  set t=null
endfunction

function unit123 takes nothing returns boolean
  if GetSpellAbilityId()=='A1RI' and GetUnitTypeId(GetTriggerUnit())!='Eevm' and GetUnitTypeId(GetTriggerUnit())!='E02V' and GetUnitTypeId(GetTriggerUnit())!='E02W' and GetUnitTypeId(GetTriggerUnit())!='E02U' then
    call MZG()
  endif
  return false
endfunction

function PY9 takes nothing returns nothing //need to re-enable to handle items, unless u handle on attack like da stronk boy u want to b C:
  //local trigger t=CreateTrigger()
  //call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  //call TriggerAddCondition(t,Condition(function MAG))
  //set t=CreateTrigger()
  // call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  // call TriggerAddCondition(t,Condition(function MXG))
  //set t=null
endfunction

function TB_ConjureImage takes nothing returns nothing
  local unit XX8=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(XX8,'A0H4')
  local unit Caster=CreateUnit(GetOwningPlayer(XX8),'e00E',GetUnitX(XX8),GetUnitY(XX8),0)
  if GetUnitTypeId(XX8)=='e00E' then
    set XX8=udg_Hero[GetPlayerId(GetOwningPlayer(XX8))]
  endif
  //call echo("here "+GetObjectName(GetUnitTypeId(XX8)))
  call UnitAddAbility(Caster,'A2JN')
  call SetUnitAbilityLevel(Caster,'A2JN',Level)
  call IssueTargetOrderById(Caster,852274,XX8)
  set Caster = null
  set XX8 = null
endfunction

function TB_ConjureImage_Leveled takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local integer lvl=GetUnitAbilityLevel(u,'A0H4')
  local integer id='A275'+lvl
  //call LoDStat_Add(u,10,"attack")
  if lvl==1 then
    //call LoDStat_Add(u,10,"attack")
    call UnitAddAbility2(u,'A33N')
  else
    call SetUnitAbilityLevel(u,'A33N',lvl)
    call UnitRemoveAbility(u,id-1)//remove prev hp regen
  endif
  call UnitAddAbility2(u,id)
  set u=null
endfunction

function unit129 takes nothing returns nothing
  local unit t=GetSpellTargetUnit()
  local real unit131=(60.+(50.*I2R(GetUnitAbilityLevel(GetTriggerUnit(),'A046'))))
  call DamageTarget(GetTriggerUnit(),t,1,unit131)
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",t,"chest"))
  set t=null
endfunction

function Tidehunter_Gush takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call unit129()
  endif
endfunction

function N4G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=GetEventDamageSource()
  local real d=GetEventDamage()
  local real dmgStored=(LoadReal(hashtable019,(Cache),(412)))
  local real time=(LoadReal(hashtable019,(Cache),(411)))
  local integer lvl=GetUnitAbilityLevel(Source,'QP10')+GetUnitAbilityLevel(Source,'A04E')
  if IsPlayerBelongToTeams(GetOwningPlayer(Target))then
    if(time+6)<(TimerGetElapsed(GlobalTimer))then
      set dmgStored=0
    endif
    set time=(TimerGetElapsed(GlobalTimer))
    set dmgStored=dmgStored+d
    if dmgStored>650-50*lvl and GetUnitAbilityLevel(Source,'BNdo')==0 then
      set dmgStored=0
      call RemoveDispellableBuffs(Source)
      call E79(Source,0,0)
      call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",Source,"origin"))
    endif
    call SaveReal(hashtable019,(Cache),(412),((dmgStored)*1.))
    call SaveReal(hashtable019,(Cache),(411),((time)*1.))
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Tidehunter_KrakenShell_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function N4G))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(412),((0)*1.))
  call SaveReal(hashtable019,(Cache),(411),(((TimerGetElapsed(GlobalTimer)))*1.))
  set t=null
  set Source=null
endfunction

function N8G takes nothing returns boolean
  if (GetLearnedSkill()=='A04E' or GetLearnedSkill()=='QP10') and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call Tidehunter_KrakenShell_Learn()
  endif
  return false
endfunction

function PZ9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function N8G))
  set t=null
endfunction

function N9G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  call KillGroup(g)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set g=null
  return false
endfunction

function NDG takes group g returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveGroupHandle(hashtable019,(Cache),(22),(g))
  call TriggerRegisterTimerEvent(t,10,false)
  call TriggerAddCondition(t,Condition(function N9G))
  set t=null
endfunction

function Tidehunter_Ravage takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Caster
  local integer i=1
  local real x1=GetUnitX(Hero)
  local real y1=GetUnitY(Hero)
  local real x2
  local real y2
  local real Damage
  local real DP9
  local integer Level=GetUnitAbilityLevel(Hero,'A29I')
  local group g=GetAvailableGroup()
  local real d=500
  if Level==1 then
    set DP9=1.5
    set Damage=200
  elseif Level==2 then
    set DP9=1.8
    set Damage=325
  elseif Level==3 then
    set DP9=2.25
    set Damage=450
  endif
  loop
    exitwhen i>16
    set x2=x1+(d+3*100)*Cos(22.5*i*bj_DEGTORAD)
    set y2=y1+(d+3*100)*Sin(22.5*i*bj_DEGTORAD)
    call D19(Hero,null,Damage,DP9,.52,x1,y1,x2,y2,250,g,false,775)
    set i=i+1
  endloop
  call NDG(g)
  set Hero=null
  set Caster=null
  set g=null
endfunction

function NGG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  if(LoadReal(hashtable019,GetHandleId(Target),715)<TimerGetElapsed(GlobalTimer))then
    call UnitRemoveAbility(Target,'A228')
    call UnitRemoveAbility(Target,'B0E8')
  endif
  
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set Target=null
  set t=null
  return false
endfunction

function NHG takes unit Target returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call UnitAddAbility2(Target,'A228')
  
  //call LoDBuff_Add(Target,LoDBuff_AbilID[33],LoDBuff_BuffID[33],6)
  //call LoDStat_Add(Target,
  
  
  
  call TriggerRegisterDeathEvent(t,Target)
  call TriggerRegisterTimerEvent(t,6,false)
  call TriggerAddCondition(t,Condition(function NGG))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(GetHandleId(Target)),(715),((5.9+(TimerGetElapsed(GlobalTimer)))*1.))
  //call BJDebugMsg(R2S(5.9+(TimerGetElapsed(GlobalTimer)*1.)))
  //set Cache = GetHandleId(Target)
  //call SaveInteger(MHT,Cache,'A228',LoadInteger(MHT,Cache,'A228') + 1)
  
  set t=null
endfunction

function NIG takes nothing returns nothing
  if IsUnitBADWithSpellbooks(GetEnumUnit())==false then
    call NHG(GetEnumUnit())
  endif
  //call SetPlayerAbilityAvailable2(GetOwningPlayer(GetEnumUnit()),'A228',false)
  call DamageTarget(K18,GetEnumUnit(),2,25+50*K08)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl",GetEnumUnit(),"chest"))
endfunction

function Tidehunter_AnchorSmash takes nothing returns nothing
  local group g=GetAvailableGroup()
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A226')
  set tt_unit1=Source
  set K08=Level
  set K18=Source
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),425,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function NIG)
  call KillGroup(g)
  set g=null
  set Source=null
endfunction

function NKG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call SetUnitTimeScale(Source,1)
  set t=null
  set Source=null
  return false
endfunction

function Tidehunter_AnhorSmash_OnCast takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call TriggerRegisterTimerEvent(t,.3,false)
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerAddCondition(t,Condition(function NKG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SetUnitTimeScale(Source,2)
  set t=null
  set Source=null
endfunction

function NPG takes nothing returns boolean
  return(IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(TmpUnit376))and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0)!=null
endfunction

function NQG takes nothing returns nothing
  call DamageTarget(TmpUnit376,GetEnumUnit(),2,TmpReal378)
endfunction

function NRG takes unit Source,unit Target,real Damage returns nothing
  local group HQ9=GetAvailableGroup()
  local boolexpr VH9=Condition(function NPG)
  set TmpUnit376=Source
  set TmpReal378=Damage
  call GroupEnumUnitsInRange(HQ9,GetUnitX(Target),GetUnitY(Target),210,VH9)
  call ForGroup(HQ9,function NQG)
  call KillGroup(HQ9)
  set HQ9=null
  set VH9=null
endfunction

function NSG takes nothing returns boolean
  return(IsUnitInGroup(GetFilterUnit(),C2)==false and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(TmpUnit376)) and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false and GetFilterUnit()!=K58)!=null
endfunction

function NTG takes group AffectedGroup,unit LastTarget,unit Source,unit OriginalTargetreturns returns unit
  local group g=GetAvailableGroup()
  local unit altu=null
  local unit u
  set C2=AffectedGroup
  set TmpUnit376=Source
  call GroupEnumUnitsInRange(g,GetUnitX(LastTarget),GetUnitY(LastTarget),500,Condition(function NSG))
  set u=FirstOfGroup(g)
  set altu=u
  loop
    exitwhen u==null
    if GetUnitState(u,UNIT_STATE_LIFE)!=GetUnitState(u,UNIT_STATE_MAX_LIFE)then
      if u!=Source and IsUnitType(u,UNIT_TYPE_HERO) and IsUnitType(altu,UNIT_TYPE_HERO)==false then
        set altu=u
      elseif u!=Source and GetUnitState(u,UNIT_STATE_LIFE)<GetUnitState(altu,UNIT_STATE_LIFE)and IsUnitType(u,UNIT_TYPE_HERO) and IsUnitType(altu,UNIT_TYPE_HERO) then
        set altu=u
      elseif u!=Source and IsUnitType(altu,UNIT_TYPE_HERO)==false and GetUnitState(u,UNIT_STATE_LIFE)<GetUnitState(altu,UNIT_STATE_LIFE)then
        set altu=u
      elseif u==Source then
        set altu=u
      endif
    endif
    call GroupRemoveUnit(g,u)
    set u=FirstOfGroup(g)
  endloop
  call KillGroup(g)
  set g=null
  set u=null
  set TEMPUNIT=altu
  set altu=null
  return TEMPUNIT
endfunction

function Dazzle_ShadowWave takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local string NZG="Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCaster.mdl"
  local string NAG="origin"
  local unit array NBG
  local integer x
  local integer i=1
  local integer Level=GetUnitAbilityLevel(Hero,'A0OR')
  local real Damage=60+Level*20
  local group NUG=GetAvailableGroup()
  local integer limit=Level+2
  local boolean N3G=false
  set K58=Hero
  call SetUnitState(Hero,UNIT_STATE_LIFE,GetUnitState(Hero,UNIT_STATE_LIFE)+Damage)
  call NRG(Hero,Hero,Damage)
  call GroupAddUnit(NUG,Hero)
  call Z48(NZG,Hero,NAG,2)
  if Target==Hero then
    set NBG[i]=NTG(NUG,Hero,Hero,Target)
  else
    set NBG[i]=Target
  endif
  if NBG[i]==null then
    call KillGroup(NUG)
    //call echo("fail")
    set Hero=null
    set Target=null
    return
  endif
  call SetUnitState(NBG[i],UNIT_STATE_LIFE,GetUnitState(NBG[i],UNIT_STATE_LIFE)+Damage)
  call NRG(Hero,NBG[i],Damage)
  call GroupAddUnit(NUG,NBG[i])
  call Z48(NZG,NBG[i],NAG,2)
  call ZO8("SPLK",GetUnitX(Hero),GetUnitY(Hero),GetUnitX(NBG[i]),GetUnitY(NBG[i]),.3,.5,.9,1,.7)
  set i=2
  loop
    exitwhen i>limit or N3G
    set NBG[i]=NTG(NUG,NBG[i-1],Hero,Target)
    if NBG[i]==null then
      set N3G=true
      //call echo("not")
    else
      call GroupAddUnit(NUG,NBG[i])
      call Z48(NZG,NBG[i],NAG,2)
      call SetUnitState(NBG[i],UNIT_STATE_LIFE,GetUnitState(NBG[i],UNIT_STATE_LIFE)+Damage)
      call NRG(Hero,NBG[i],Damage)
      call ZO8("SPLK",GetUnitX(NBG[i-1]),GetUnitY(NBG[i-1]),GetUnitX(NBG[i]),GetUnitY(NBG[i]),.3,.5,.9,1,.7)
      set i=i+1
    endif
  endloop
  call KillGroup(NUG)
  set NUG=null
  set Hero=null
  set Target=null
  
endfunction

function NLG takes unit Source,unit Target,integer Level returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,('A0NJ'))
  call SetUnitAbilityLevel(Caster,('A0NJ'),Level)
  call IssueTargetOrderById(Caster,852075,Target)
  set Caster=null
endfunction

function N1G takes unit Source,unit Target returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,('A0NK'))
  call IssueTargetOrderById(Caster,852095,Target)
  set Caster=null
endfunction

function N0G takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  local unit Target=LoadUnitHandle(hashtable019,Cache,17)
  local integer Level=GetUnitAbilityLevel(Source,'A0NQ')
  local integer EZE=GetTriggerEvalCount(t)
  local real Damage=8+6*Level
  local unit Caster=LoadUnitHandle(hashtable019,Cache,19)
  if Level==1 then
    call UnitAddAbility2(Target,'A0OW')
    call DamageTarget(Caster,Target,2,Damage)
    if EZE<3 then
      call NLG(Source,Target,1)
    endif
    if EZE==8 then
      call UnitRemoveAbility(Target,'A0OW')
      call FlushChildHashtable(hashtable019,Cache)
      call CleanTrigger(t)
    endif
  elseif Level==2 then
    if EZE==1 then
      call NLG(Source,Target,1)
    endif
    if EZE==2 then
      call NLG(Source,Target,2)
    endif
    if EZE>2 then
      call UnitAddAbility2(Target,'A0OW')
      call DamageTarget(Caster,Target,2,Damage)
    endif
    if EZE==9 then
      call UnitRemoveAbility(Target,'A0OW')
      call FlushChildHashtable(hashtable019,Cache)
      call CleanTrigger(t)
    endif
  elseif Level==3 then
    if EZE==1 then
      call NLG(Source,Target,2)
    endif
    if EZE==2 then
      call NLG(Source,Target,3)
    endif
    if EZE>2 then
      call UnitAddAbility2(Target,'A0OW')
      call DamageTarget(Caster,Target,2,Damage)
    endif
    if EZE==10 then
      call UnitRemoveAbility(Target,'A0OW')
      call FlushChildHashtable(hashtable019,Cache)
      call CleanTrigger(t)
    endif
  elseif Level==4 then
    if EZE==1 then
      call NLG(Source,Target,2)
    endif
    if EZE==2 then
      call N1G(Source,Target)
    endif
    if EZE>2 then
      call UnitAddAbility2(Target,'A0OW')
      call DamageTarget(Caster,Target,2,Damage)
    endif
    if EZE==10 then
      call UnitRemoveAbility(Target,'A0OW')
      call FlushChildHashtable(hashtable019,Cache)
      call CleanTrigger(t)
    endif
  endif
  set Caster=null
  set Source=null
  set Target=null
  set t=null
endfunction

function N5Gold takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit triggerunit=tt_unit1
  local unit target=tt_unit2
  local unit Caster=CreateUnit(GetOwningPlayer(tt_unit1),'e00E',GetUnitX(tt_unit2),GetUnitY(tt_unit2),0)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function N0G))
  call SaveUnitHandle(hashtable019,Cache,2,tt_unit1)
  call SaveUnitHandle(hashtable019,Cache,17,tt_unit2)
  call SaveUnitHandle(hashtable019,Cache,19,Caster)
  call NLG(tt_unit1,tt_unit2,1)
  set Caster=null
  set t=null
  set triggerunit=null
  set target=null
endfunction

function N5G takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=AddProjectile(Hero,Target,'e00E',"N5Gold",1300,true)
  local integer Cache=GetHandleId(t)
  call SaveInteger(hashtable019,Cache,5,GetUnitAbilityLevel(Hero,GetSpellAbilityId()))
  set Hero=null
  set Target=null
  set t=null
endfunction


function Dazzle_PoisonTouch takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call N5G()
  endif
endfunction

function RF9 takes nothing returns nothing
  call PreloadAbility(('A0NJ'))
  call PreloadAbility(('A0NK'))
endfunction

function N2G takes nothing returns nothing//weave
  local unit Target=GetEnumUnit()
  local integer armor=LoadInteger(HeroStats,GetHandleId(Target),GetHandleId(GetTriggeringTrigger()))
  if IsUnitAlly(Target,tt_player1)==false then
    call LoDStat_Sub(Target,armor,"armourneg")
  else
    call LoDStat_Sub(Target,armor,"armour")
  endif
  call SaveInteger(HeroStats,GetHandleId(Target),GetHandleId(GetTriggeringTrigger()),0)
  set Target=null
endfunction

function O4G takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local integer armor=R2I(tt_int1*tt_real1)
  local integer prevarmor
  if tt_int1>0 then
    set prevarmor=R2I((tt_int1-1)*tt_real1)
    if IsUnitAlly(Target,tt_player1)==false then
      call LoDStat_Sub(Target,prevarmor,"armourneg")
    else
      call LoDStat_Sub(Target,prevarmor,"armour")
    endif
  endif
  if IsDead(Target)==false then
    if IsUnitAlly(Target,tt_player1)==false then
      call LoDStat_Add(Target,armor,"armourneg")
      call SaveInteger(HeroStats,GetHandleId(Target),GetHandleId(GetTriggeringTrigger()),armor)
    else
      call LoDStat_Add(Target,armor,"armour")
      call SaveInteger(HeroStats,GetHandleId(Target),GetHandleId(GetTriggeringTrigger()),armor)
    endif
  endif
  set Target=null
endfunction

function O7G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  local player p=(LoadPlayerHandle(hashtable019,(Cache),(54)))
  local integer Count=GetTriggerEvalCount(t)
  local integer DP9=(LoadInteger(hashtable019,(Cache),(188)))
  local real armor=LoadReal(hashtable019,Cache,0)
  set tt_player1=p
  set tt_int1=Count
  set tt_real1=armor
  if Count==DP9 then
    call ForGroup(g,function N2G)
    call KillGroup(g)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call ForGroup(g,function O4G)
  endif
  set t=null
  set g=null
  set p=null
  return false
endfunction

function O8G takes nothing returns nothing
  call Z48(unit004,GetEnumUnit(),"chest",3)
  call Z48(unit004,GetEnumUnit(),"chest",3)
  call Z48(unit004,GetEnumUnit(),"right hand",3)
  call Z48(unit004,GetEnumUnit(),"left hand",3)
endfunction

function Dazzle_Weave takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local group g=GetAvailableGroup()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Hero,'A10Q')
  local integer DP9=24
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'h007',x,y,0)
  local integer a=0
  local boolean RIE=false
  local real armor=Level*0.25+0.5
  if Level==0 then
    set Level=GetUnitAbilityLevel(Hero,'A1DB')
    set DP9=20
    set RIE=true
    set armor=Level*0.25+0.75
  endif
  //call RemoveLocation(l)
  set unit004=""
  set tt_int1=DP9
  set a=255
  set unit004="Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl"
  call SetUnitVertexColor(Caster,255,255,255,a)
  call UnitApplyTimedLife(Caster,'BTLF',5)
  if RIE then
    call GroupEnumUnitsInRange(g,x,y,800,Condition(function DI9))
  else
    call GroupEnumUnitsInRange(g,x,y,600,Condition(function DI9))
  endif
  call ForGroup(g,function O8G)
  call SaveGroupHandle(hashtable019,(Cache),(22),(g))
  call SavePlayerHandle(hashtable019,(Cache),(54),(GetOwningPlayer(Hero)))
  call SaveInteger(hashtable019,(Cache),(188),(DP9))
  call SaveReal(hashtable019,Cache,0,armor)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function O7G))
  call TriggerEvaluate(t)
  set Hero=null
  //set l=null
  set g=null
  set t=null
  set Caster=null
endfunction

function integers143 takes string ZS8,unit Target,unit Hero returns nothing
  local texttag tt=CreateTextTag()
  if GetHandleId(tt)>0 then
    call SetTextTagText(tt,ZS8,.033)
    call SetTextTagPosUnit(tt,Target,64)
    call SetTextTagColor(tt,160,0,255,255)
    call SetTextTagVelocity(tt,0,.0355)
    call SetTextTagFadepoint(tt,.15)
    call SetTextTagPermanent(tt,false)
    call SetTextTagLifespan(tt,.65)
    call SetTextTagVisibility(tt,IsUnitAlly(Hero,GetLocalPlayer())or IsObserver(GetLocalPlayer()))
  else
    call DestroyTextTag(tt)
  endif
  set tt=null
endfunction

function OFG takes real DP9 returns string
  if DP9>4.5 then
    return"5.0"
  elseif DP9>4. then
    return"4.5"
  elseif DP9>3.5 then
    return"4.0"
  elseif DP9>3. then
    return"3.5"
  elseif DP9>2.5 then
    return"3.0"
  elseif DP9>2. then
    return"2.5"
  elseif DP9>1.5 then
    return"2.0"
  elseif DP9>1. then
    return"1.5"
  elseif DP9>.5 then
    return"1.0"
  elseif DP9>.0 then
    return"0.5"
  else
    return"0.0"
  endif
  return" "
endfunction

function integers144 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Count=GetTriggerEvalCount(t)
  if Count>11 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call integers143(OFG(5.5-.5*Count),Target,Target)
  endif
  set t=null
  set Target=null
  return false
endfunction

function integer562 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  local real integer561=RMaxIF(GetUnitState(Target,UNIT_STATE_LIFE)-Damage,1)
  local real OJG=(LoadReal(hashtable019,(GetHandleId(Target)),(243)))
  call SetUnitState(Target,UNIT_STATE_LIFE,integer561)
  call SaveReal(hashtable019,(GetHandleId(Target)),(243),((OJG-Damage)*1.))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Target=null
  return false
endfunction

function unit161 takes unit Target,real Damage returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real OJG=(LoadReal(hashtable019,(GetHandleId(Target)),(243)))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(20),((Damage)*1.))
  call SaveReal(hashtable019,(GetHandleId(Target)),(243),((OJG+Damage)*1.))
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function integer562))
  set t=null
endfunction

function integer564 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target
  local real OBF
  local real Damage
  local integer Count=GetTriggerEvalCount(t)
  local real OJG
  local real ONG=(LoadReal(hashtable019,(Cache),(389)))
  local real integer566=(LoadReal(hashtable019,(Cache),(390)))
  if ONG!=(TimerGetElapsed(GlobalTimer))then
    set ONG=(TimerGetElapsed(GlobalTimer))
    set integer566=0
    call SaveReal(hashtable019,(Cache),(389),((ONG)*1.))
    call SaveReal(hashtable019,(Cache),(390),((integer566)*1.))
  endif
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if IsRealDamage then
      set Target=GetTriggerUnit()
      set OJG=(LoadReal(hashtable019,(GetHandleId(Target)),(243)))
      set OBF=GetUnitState(Target,UNIT_STATE_LIFE)
      set Damage=GetEventDamage()
      if((OBF-OJG-integer566)-Damage)<1 then
        call SetUnitState(Target,UNIT_STATE_LIFE,OBF+Damage+integer566)
        call unit161(Target,Damage)
      else
        set integer566=integer566+Damage
        call SaveReal(hashtable019,(Cache),(390),((integer566)*1.))
      endif
    endif
  else
    call SaveInteger(hashtable019,(GetHandleId(((LoadUnitHandle(hashtable019,(Cache),(17)))))),((2485)),(2))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call UnitRemoveAbility((LoadUnitHandle(hashtable019,(Cache),(17))),'A21I')
    call UnitRemoveAbility((LoadUnitHandle(hashtable019,(Cache),(17))),'B07D')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set Target=null
  set t=null
  return false
endfunction

function Dazzle_Grave takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  call UnitAddAbility2(Target,'A21I')
  call TriggerRegisterTimerEvent(t,5,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function integer564))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\DarkHands.mdx",Target,"overhead")))
  call SaveReal(hashtable019,(GetHandleId(Target)),(243),((0)*1.))
  call SaveReal(hashtable019,(Cache),(389),(((TimerGetElapsed(GlobalTimer)))*1.))
  call SaveReal(hashtable019,(Cache),(390),((0)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(GetHandleId((Target))),((2485)),(1))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function integers144))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  set t=null
  set Source=null
  set Target=null
endfunction

function integer563 takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),DK)==false then
    set K28=CreateUnit(GetOwningPlayer(tt_unit1),'e00E',GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
    call UnitShareVision(GetEnumUnit(),GetOwningPlayer(tt_unit1),true)
    call UnitAddAbility2(K28,'A17N')
    call SetUnitAbilityLevel(K28,'A17N',M48)
    call IssueTargetOrderById(K28,852527,GetEnumUnit())
    call GroupAddUnit(DK,GetEnumUnit())
    call UnitShareVision(GetEnumUnit(),GetOwningPlayer(tt_unit1),false)
  endif
endfunction

function OSG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local group V7E
  local real x
  local real y
  local real OTG
  local real integers142
  local real QQE=30
  set M48=Level
  if GetTriggerEvalCount(t)>28 then
    call KillGroup(g)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call ShowUnit(Caster,false)
    call KillUnit(Caster)
  else
    set x=GetUnitX(Caster)
    set y=GetUnitY(Caster)
    set V7E=GetAvailableGroup()
    set DK=g
    set tt_unit1=Caster
    set tt_real1=Level*70
    call GroupEnumUnitsInRange(V7E,x,y,150,Condition(function LA8))
    call ForGroup(V7E,function integer563)
    call KillGroup(V7E)
    set OTG=SafeX50(x+QQE*Cos(J2E*bj_DEGTORAD))
    set integers142=SafeY50(y+QQE*Sin(J2E*bj_DEGTORAD))
    call SetUnitX(Caster,OTG)
    call SetUnitY(Caster,integers142)
  endif
  set t=null
  set g=null
  set V7E=null
  set Caster=null
  return false
endfunction

function Venomancer_VenomousGale takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local group g=GetAvailableGroup()
  local unit Hero=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x1=GetUnitX(Hero)
  local real y1=GetUnitY(Hero)
  local real x2=GetSpellTargetX()
  local real y2=GetSpellTargetY()
  local real J2E=AngleBetweenXY(x1,y1,x2,y2)
  local integer Level=GetUnitAbilityLevel(Hero,'A173')
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),'h07K',x1,y1,J2E)
  call PlaySoundAtPos(sound024,x1,y1)
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveGroupHandle(hashtable019,(Cache),(22),(g))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call TriggerRegisterTimerEvent(t,.025,true)
  call TriggerAddCondition(t,Condition(function OSG))
  //call RemoveLocation(l)
  set t=null
  set Caster=null
  set g=null
  set Hero=null
  //set l=null
endfunction

function Venomancer_PlagueWard_Check takes nothing returns nothing
  local integer id=GetUnitTypeId(GetSummonedUnit())
  local integer lvl
  if id=='o00T' or id=='o00U' or id=='o00V' or id=='o00W' then
    set lvl=id+1-'o00T'
    call UnitAddAbility2(GetSummonedUnit(),'QVEN')
    call SetUnitAbilityLevel(GetSummonedUnit(),'QVEN',lvl)
    //if GetUnitAbilityLevel(GetSummoningUnit(),'P418')>0 then
    //endif
  endif
endfunction

function Venomancer_PlagueWard_Init takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function Venomancer_PlagueWard_Check))
  set t=null
endfunction

function Venomancer_PoisonNova takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local integer OYG
  local integer i=1
  local real x=GetUnitX(Hero)
  local real y=GetUnitY(Hero)
  local unit Caster
  local player p
  if IsScourge(GetOwningPlayer(Hero)) then
    set p=Sentinels[0]
  else
    set p=Scourges[0]
  endif
  if GetSpellAbilityId()=='A013' then
    set OYG=GetUnitAbilityLevel(Hero,'A013')
  else
    set OYG=GetUnitAbilityLevel(Hero,'A0A6')+1
  endif
  loop
    exitwhen i>18
    set Caster=CreateUnit(GetOwningPlayer(Hero),'e017',x,y,0)
    call UnitAddAbility2(Caster,'A057')
    call SetUnitAbilityLevel(Caster,'A057',OYG)
    call IssuePointOrderById(Caster,851986,x+675*Cos(i*20*bj_DEGTORAD),y+675*Sin(i*20*bj_DEGTORAD))
    call UnitApplyTimedLife(Caster,'BTLF',1.15)
    set Caster=CreateUnit(p,'e017',x,y,0)
    call UnitAddAbility2(Caster,'A30G')
    call SetUnitAbilityLevel(Caster,'A30G',OYG)
    call IssuePointOrderById(Caster,851986,x+675*Cos(i*20*bj_DEGTORAD),y+675*Sin(i*20*bj_DEGTORAD))
    call UnitApplyTimedLife(Caster,'BTLF',1.15)
    set i=i+1
  endloop
  
  set Hero=null
  set Caster=null
endfunction


function Viper_Toxin_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  
  call LoDStat_Sub(LoadUnitHandle(MHT,info,0),LoadInteger(MHT,info,0),"damage")
  call SaveBoolean(MHT,LoadInteger(MHT,info,1),'A1A3',false) //finish cooldown
  
  call Timer_End(t)
  set t = null
endfunction

function Viper_Toxin_Start takes unit u, unit d, integer level returns nothing
  local timer t = Timer_Get()
  local integer info = GetHandleId(t)
  local integer amount = R2I(2.5*Pow(2,4 - R2I(((GetWidgetLife(d)-1)/GetUnitState(d,UNIT_STATE_MAX_LIFE))*5))) * level
  
  if IsUnitType(d,UNIT_TYPE_HERO)==false then
    set amount = amount/2
  endif
  
  call LoDStat_Add(u,amount,"damage")
  call SaveUnitHandle(MHT,info,0,u)
  call SaveInteger(MHT,info,0,amount)
  call SaveInteger(MHT,info,1,GetHandleId(u))
  
  call SaveBoolean(MHT,GetHandleId(u),'A1A3',true) //start cooldown
  
  call TimerStart(t,.5,false,function Viper_Toxin_End)
  //call Passive_Cooldown(u,'A1A3',level)
  
  set t = null
endfunction

function integer565 takes nothing returns boolean
  local unit u = null
  local unit t = null
  local integer level
  
  
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_CAST then
    set u = GetTriggerUnit()
    
    if LoadBoolean(MHT,GetHandleId(u),'A1A3')then //cooldown
      set u = null
    endif
    
    set t = GetSpellTargetUnit()
    set level = IMaxIF(GetUnitAbilityLevel(u,'A1A3'),GetUnitAbilityLevel(u,'QP21'))
    
    if isPoisonArrowSkill(GetSpellAbilityId()) and level>0 then //A09V by default
      call Viper_Toxin_Start(u,t,level)
    endif
    
    set t = null
    set u = null
  endif
  
  set u = GetAttacker()
  
  if LoadBoolean(MHT,GetHandleId(u),'A1A3')then //cooldown
    set u = null
  endif
  
  set t = GetTriggerUnit()
  set level = IMaxIF(GetUnitAbilityLevel(u,'A1A3'),GetUnitAbilityLevel(u,'QP21'))
  
  if level>0 and IsUnitIllusion(u)==false and IsUnitEnemy(u,GetOwningPlayer(t))then
    call Viper_Toxin_Start(u,t,level)
  endif
  
  set t = null
  set u = null
  return false
endfunction

function PL9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function integer565))
  set t=null
endfunction

function Viper_CorrosiveSkin_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real JSD=(LoadReal(hashtable019,(GetHandleId(Target)),(684)))
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or JSD<(TimerGetElapsed(GlobalTimer))or IsMagicImmune(Target)then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call SaveReal(hashtable019,(GetHandleId(Target)),(684),((0)*1.))
    call UnitRemoveAbility(Target,'A23W')
    call UnitRemoveAbility(Target,'A23U')
    call UnitRemoveAbility(Target,'A23V')
    call UnitRemoveAbility(Target,'A23X')
    call UnitRemoveAbility(Target,'B0EA')
  else
    set IsCorrosiveSkinDamage=true
    call DamageTarget(Source,Target,1,5+5*Level)
    set IsCorrosiveSkinDamage=false
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Viper_CorrosiveSkin_Tick takes nothing returns nothing
  local trigger t
  local integer Cache
  local unit Source=GetTriggerUnit()
  local unit Target=GetEventDamageSource()
  local real JSD=(LoadReal(hashtable019,(GetHandleId(Target)),(684)))
  local integer Level=IMaxIF(GetUnitAbilityLevel(Source,'A0MM'),GetUnitAbilityLevel(Source,'QP0Y'))
  if JSD>(TimerGetElapsed(GlobalTimer))then
    call SaveReal(hashtable019,(GetHandleId(Target)),(684),(((TimerGetElapsed(GlobalTimer))+4)*1.))
  else
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveReal(hashtable019,(GetHandleId(Target)),(684),(((TimerGetElapsed(GlobalTimer))+4)*1.))
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerRegisterDeathEvent(t,Target)
    call TriggerAddCondition(t,Condition(function Viper_CorrosiveSkin_Duration))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveInteger(hashtable019,(Cache),(5),(Level))
    if IsUnitBADWithSpellbooks(Target)==false then
      if Level==1 then
        call UnitAddAbility2(Target,'A23W')
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A23W',false)
      elseif Level==2 then
        call UnitAddAbility2(Target,'A23U')
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A23U',false)
      elseif Level==3 then
        call UnitAddAbility2(Target,'A23V')
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A23V',false)
      elseif Level==4 then
        call UnitAddAbility2(Target,'A23X')
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A23X',false)
      endif
    endif
  endif
  set t=null
  set Source=null
  set Target=null
endfunction

function Viper_CorrosiveSkin_Start takes nothing returns boolean
  if IMaxIF(GetUnitAbilityLevel(GetTriggerUnit(),'A0MM'),GetUnitAbilityLevel(GetTriggerUnit(),'QP0Y'))>0 and GetUnitAbilityLevel(GetEventDamageSource(),'A04R')==0 and IsUnitType(GetEventDamageSource(),UNIT_TYPE_STRUCTURE)==false and IsUnitEnemy(GetEventDamageSource(),GetOwningPlayer(GetTriggerUnit()))and IsMagicImmune(GetEventDamageSource())==false then //A0MM
    if GetUnitAbilityLevel(GetTriggerUnit(),'BNdo')==0 and IsCorrosiveSkinDamage==false then
      call Viper_CorrosiveSkin_Tick()
    endif
  endif
  return false
endfunction

function Viper_CorrosiveSkin_Reg2 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function Viper_CorrosiveSkin_Start))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(14),(GetTriggerUnit()))
  set t=null
endfunction


function Viper_CorrosiveSkin_Init takes nothing returns boolean
  if (GetLearnedSkill()=='A0MM' or GetLearnedSkill()=='QP0Y') and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call Viper_CorrosiveSkin_Reg2()
    
  endif
  return false
endfunction



function Viper_CorrosiveSkin_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Viper_CorrosiveSkin_Init))
  set t=null
endfunction

function Viper_ViperStrike takes nothing returns nothing
  local unit Target=GetSpellTargetUnit()
  call UnitRemoveAbility(Target,'BEsh')
  call UnitRemoveAbility(Target,'B0AQ')
  set Target=null
endfunction

function Visage_GraveChill takes nothing returns nothing
  local location YT9=GetUnitLoc(GetSpellAbilityUnit())
  call CreateNUnitsAtLocFacingLocBJ(1,'e00E',GetOwningPlayer(GetSpellAbilityUnit()),YT9,YT9)
  call RemoveLocation(YT9)
  call UnitAddAbility(bj_lastCreatedUnit,'A09C')
  call SetUnitAbilityLevelSwapped('A09C',bj_lastCreatedUnit,GetUnitAbilityLevelSwapped('A08X',GetSpellAbilityUnit()))
  call IssueTargetOrderById(bj_lastCreatedUnit,852101,GetSpellAbilityUnit())
  set YT9=null
endfunction

function P4G takes unit Target,integer P7G returns nothing
  call UnitRemoveAbility(Target,'A1M3')
  call UnitRemoveAbility(Target,'A1M4')
  call UnitRemoveAbility(Target,'A1MC')
  call UnitRemoveAbility(Target,'A1M7')
  call UnitRemoveAbility(Target,'A1M8')
  call UnitRemoveAbility(Target,'A1M9')
  call UnitRemoveAbility(Target,'A1MA')
  call UnitRemoveAbility(Target,'A1M5')
  call UnitRemoveAbility(Target,'A1MB')
  call UnitRemoveAbility(Target,'A1M6')
  if P7G==1 then
    call UnitAddAbility2(Target,'A1M3')
  elseif P7G==2 then
    call UnitAddAbility2(Target,'A1M4')
  elseif P7G==3 then
    call UnitAddAbility2(Target,'A1MC')
  elseif P7G==4 then
    call UnitAddAbility2(Target,'A1M7')
  elseif P7G==5 then
    call UnitAddAbility2(Target,'A1M8')
  elseif P7G==6 then
    call UnitAddAbility2(Target,'A1M9')
  elseif P7G==7 then
    call UnitAddAbility2(Target,'A1MA')
  elseif P7G==8 then
    call UnitAddAbility2(Target,'A1M5')
  elseif P7G==9 then
    call UnitAddAbility2(Target,'A1MB')
  elseif P7G==10 then
    call UnitAddAbility2(Target,'A1M6')
  endif
endfunction

function GravekeepersCloakEnemy_Decay takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer P7G
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set Cache=GetHandleId(Target)
  set P7G=(LoadInteger(hashtable019,(Cache),(427)))
  set P7G=IMaxIF(P7G-1,0)
  call SaveInteger(hashtable019,(Cache),(427),(P7G))
  call P4G(Target,P7G)
  set t=null
  set Target=null
  return false
endfunction

function P8G takes unit Source,integer Level,integer timers008 returns nothing
  call UnitRemoveAbility(Source,'A1KR')
  call UnitRemoveAbility(Source,'A1KS')
  call UnitRemoveAbility(Source,'A1KQ')
  call UnitRemoveAbility(Source,'A1KP')
  call UnitRemoveAbility(Source,'A1K1')
  call UnitRemoveAbility(Source,'A1KW')
  call UnitRemoveAbility(Source,'A1KX')
  call UnitRemoveAbility(Source,'A1KY')
  call UnitRemoveAbility(Source,'A1L4')
  call UnitRemoveAbility(Source,'A1L3')
  call UnitRemoveAbility(Source,'A1L2')
  call UnitRemoveAbility(Source,'A1L1')
  call UnitRemoveAbility(Source,'A1L8')
  call UnitRemoveAbility(Source,'A1L7')
  call UnitRemoveAbility(Source,'A1L9')
  call UnitRemoveAbility(Source,'A1LB')
  if Level==1 then
    if timers008==1 then
      call UnitAddAbility2(Source,'A1KR')
    elseif timers008==2 then
      call UnitAddAbility2(Source,'A1KS')
    elseif timers008==3 then
      call UnitAddAbility2(Source,'A1KQ')
    elseif timers008==4 then
      call UnitAddAbility2(Source,'A1KP')
    endif
  elseif Level==2 then
    if timers008==1 then
      call UnitAddAbility2(Source,'A1K1')
    elseif timers008==2 then
      call UnitAddAbility2(Source,'A1KW')
    elseif timers008==3 then
      call UnitAddAbility2(Source,'A1KX')
    elseif timers008==4 then
      call UnitAddAbility2(Source,'A1KY')
    endif
  elseif Level==3 then
    if timers008==1 then
      call UnitAddAbility2(Source,'A1L4')
    elseif timers008==2 then
      call UnitAddAbility2(Source,'A1L3')
    elseif timers008==3 then
      call UnitAddAbility2(Source,'A1L2')
    elseif timers008==4 then
      call UnitAddAbility2(Source,'A1L1')
    endif
  elseif Level==4 then
    if timers008==1 then
      call UnitAddAbility2(Source,'A1L8')
    elseif timers008==2 then
      call UnitAddAbility2(Source,'A1L7')
    elseif timers008==3 then
      call UnitAddAbility2(Source,'A1L9')
    elseif timers008==4 then
      call UnitAddAbility2(Source,'A1LB')
    endif
  endif
endfunction

function PDG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer unit170=(LoadInteger(hashtable019,(Cache),(426)))
  local unit Source=(LoadUnitHandle(hashtable019,(unit170),(2)))
  local integer timers008=(LoadInteger(hashtable019,(unit170),(425)))
  local integer Level=IMaxIF(GetUnitAbilityLevel(Source,'A0VX'),GetUnitAbilityLevel(Source,'QP23'))
  set timers008=IMinIF(timers008+1,4)
  call SaveInteger(hashtable019,(unit170),(425),(timers008))
  call P8G(Source,Level,timers008)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function rthyrtt takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local integer Cache=LoadInteger(hashtable019,h,426)
  local unit u=LoadUnitHandle(hashtable019,(Cache),(2))
  local integer timers008=LoadInteger(hashtable019,(Cache),(425))
  local integer Level=IMaxIF(GetUnitAbilityLevel(u,'A0VX'),GetUnitAbilityLevel(u,'QP23'))
  call P8G(u,Level,timers008)
  call DestroyTrigger(t)
  call FlushChildHashtable(hashtable019,h)
  set u=null
  set t=null
  
endfunction

function PFG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer timers008=(LoadInteger(hashtable019,(Cache),(425)))
  local integer Level=IMaxIF(GetUnitAbilityLevel(GetTriggerUnit(),'A0VX'),GetUnitAbilityLevel(GetTriggerUnit(),'QP23'))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamage()>2 and GetEventDamageSource()!=GetTriggerUnit()and IsPlayerBelongToTeams(GetOwningPlayer(GetEventDamageSource())) and IsRealDamage then
      set timers008=IMaxIF(timers008-1,0)
      call SaveInteger(hashtable019,(Cache),(425),(timers008))
      call P8G(Source,Level,timers008)
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call TriggerRegisterTimerEvent(t,14-2*Level,false)
      call TriggerAddCondition(t,Condition(function PDG))
      call SaveInteger(hashtable019,(Cache),(426),(GetHandleId(GetTriggeringTrigger())))
    endif
  else
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,0.4,false)
    call TriggerAddCondition(t,Condition(function rthyrtt))
    call SaveInteger(hashtable019,(Cache),(426),GetHandleId(GetTriggeringTrigger()))
    
    //call P8G(Source,Level,P9G)
  endif
  set t=null
  set Source=null
  return false
endfunction

function Visage_GravekeeperCloak_Leveling takes nothing returns nothing
  local trigger t
  local integer Cache
  local unit Source=GetTriggerUnit()
  local integer Level=IMaxIF(GetUnitAbilityLevel(Source,'QP23'),GetUnitAbilityLevel(Source,'A0VX'))
  if Level==1 then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DAMAGED)
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
    call TriggerAddCondition(t,Condition(function PFG))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveInteger(hashtable019,(Cache),(425),(4))
  endif
  call P8G(Source,Level,4)
  set t=null
  set Source=null
endfunction

function unit169 takes nothing returns boolean
  if (GetLearnedSkill()=='QP23' or GetLearnedSkill()=='A0VX') and IsUnitIllusion(GetTriggerUnit())==false then
    call Visage_GravekeeperCloak_Leveling()
  endif
  return false
endfunction

function unit167 takes player p returns nothing
  call SetPlayerAbilityAvailable2(p,'A1KR',false)
  call SetPlayerAbilityAvailable2(p,'A1KS',false)
  call SetPlayerAbilityAvailable2(p,'A1KQ',false)
  call SetPlayerAbilityAvailable2(p,'A1KP',false)
  call SetPlayerAbilityAvailable2(p,'A1KU',false)
  call SetPlayerAbilityAvailable2(p,'A1KV',false)
  call SetPlayerAbilityAvailable2(p,'A1K1',false)
  call SetPlayerAbilityAvailable2(p,'A1KW',false)
  call SetPlayerAbilityAvailable2(p,'A1KX',false)
  call SetPlayerAbilityAvailable2(p,'A1KY',false)
  call SetPlayerAbilityAvailable2(p,'A1KZ',false)
  call SetPlayerAbilityAvailable2(p,'A1KT',false)
  call SetPlayerAbilityAvailable2(p,'A1L4',false)
  call SetPlayerAbilityAvailable2(p,'A1L3',false)
  call SetPlayerAbilityAvailable2(p,'A1L2',false)
  call SetPlayerAbilityAvailable2(p,'A1L1',false)
  call SetPlayerAbilityAvailable2(p,'A1L0',false)
  call SetPlayerAbilityAvailable2(p,'A1L5',false)
  call SetPlayerAbilityAvailable2(p,'A1L8',false)
  call SetPlayerAbilityAvailable2(p,'A1L7',false)
  call SetPlayerAbilityAvailable2(p,'A1L9',false)
  call SetPlayerAbilityAvailable2(p,'A1LB',false)
  call SetPlayerAbilityAvailable2(p,'A1LA',false)
  call SetPlayerAbilityAvailable2(p,'A1L6',false)
  call SetPlayerAbilityAvailable2(p,'A1LH',false)
  call SetPlayerAbilityAvailable2(p,'A1M3',false)
  call SetPlayerAbilityAvailable2(p,'A1M4',false)
  call SetPlayerAbilityAvailable2(p,'A1MC',false)
  call SetPlayerAbilityAvailable2(p,'A1M7',false)
  call SetPlayerAbilityAvailable2(p,'A1M8',false)
  call SetPlayerAbilityAvailable2(p,'A1M9',false)
  call SetPlayerAbilityAvailable2(p,'A1MA',false)
  call SetPlayerAbilityAvailable2(p,'A1M5',false)
  call SetPlayerAbilityAvailable2(p,'A1MB',false)
  call SetPlayerAbilityAvailable2(p,'A1M6',false)
endfunction

function Q79 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer i=0
  local player p
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function unit169))
  loop
    exitwhen i>5
    set p=Sentinels[i]
    call unit167(p)
    set p=Scourges[i]
    call unit167(p)
    set i=i+1
  endloop
  set t=null
  set p=null
endfunction

function PJG takes nothing returns nothing
  local integer Level
  local unit Source=GetTriggerUnit()
  local unit Caster
  if GetUnitTypeId(Source)=='u017' or GetUnitTypeId(Source)=='u019' or GetUnitTypeId(Source)=='u018' or GetUnitTypeId(Source)=='u01A' or GetUnitTypeId(Source)=='u01B' or GetUnitTypeId(Source)=='u01C' or GetUnitTypeId(Source)=='u01U' or GetUnitTypeId(Source)=='u01V' or GetUnitTypeId(Source)=='u01W' then
    return
  endif
  set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
  if GetUnitTypeId(Source)=='u014' or GetUnitTypeId(Source)=='u01D' or GetUnitTypeId(Source)=='u01R' then
    set Level=1
  elseif GetUnitTypeId(Source)=='u015' or GetUnitTypeId(Source)=='u01E' or GetUnitTypeId(Source)=='u01S' then
    set Level=2
  else
    set Level=3
  endif
  call UnitAddAbility2(Caster,'A1NF')
  call SetUnitAbilityLevel(Caster,'A1NF',Level)
  call IssueImmediateOrderById(Caster,852127)
  set Source=null
  set Caster=null
endfunction

function timers007 takes unit integer567,integer Y59,integer Level returns nothing
  local integer PNG
  if Level==1 then
    set PNG=8
  elseif Level==2 then
    set PNG=14
  elseif Level==3 then
    set PNG=22
  endif
  call AddBonusDamage(integer567,Y59*PNG)
endfunction

function integer568 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit integer567=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Source=integer567
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer unit060=(LoadInteger(hashtable019,(Cache),(28)))
  local integer Y59=(LoadInteger(hashtable019,(Cache),(194)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetAttacker()==integer567 then
      set Y59=IMaxBJ(Y59-1,0)
      call SaveInteger(hashtable019,(Cache),(194),(Y59))
      call timers007(integer567,Y59,Level)
    endif
  else
    set unit060=unit060+1
    call SaveInteger(hashtable019,(Cache),(28),(unit060))
    if ModuloInteger(unit060,15)==0 then
      set Y59=IMinBJ(Y59+1,7)
      call SaveInteger(hashtable019,(Cache),(194),(Y59))
    endif
    if GetUnitTypeId(Source)=='u017' or GetUnitTypeId(Source)=='u019' or GetUnitTypeId(Source)=='u018' or GetUnitTypeId(Source)=='u01A' or GetUnitTypeId(Source)=='u01B' or GetUnitTypeId(Source)=='u01C' or GetUnitTypeId(Source)=='u01U' or GetUnitTypeId(Source)=='u01V' or GetUnitTypeId(Source)=='u01W' then
      set Y59=7
      call SaveInteger(hashtable019,(Cache),(194),(Y59))
    endif
    call timers007(integer567,Y59,Level)
    if GetUnitTypeId(integer567)=='u017' or GetUnitTypeId(integer567)=='u019' or GetUnitTypeId(integer567)=='u018' or GetUnitTypeId(integer567)=='u01A' or GetUnitTypeId(integer567)=='u01B' or GetUnitTypeId(integer567)=='u01C' or GetUnitTypeId(integer567)=='u01U' or GetUnitTypeId(integer567)=='u01V' or GetUnitTypeId(integer567)=='u01W' then
      call SetUnitState(integer567,UNIT_STATE_LIFE,GetUnitState(integer567,UNIT_STATE_LIFE)+31.25+18.75*Level)
    endif
  endif
  set t=null
  set integer567=null
  set Source=null
  return false
endfunction

function player014 takes nothing returns boolean
  if GetUnitTypeId(GetFilterUnit())=='u014' or GetUnitTypeId(GetFilterUnit())=='u015' or GetUnitTypeId(GetFilterUnit())=='u016' or GetUnitTypeId(GetFilterUnit())=='u01D' or GetUnitTypeId(GetFilterUnit())=='u01E' or GetUnitTypeId(GetFilterUnit())=='u01F' or GetUnitTypeId(GetFilterUnit())=='u01R' or GetUnitTypeId(GetFilterUnit())=='u01S' or GetUnitTypeId(GetFilterUnit())=='u01T' or GetUnitTypeId(GetFilterUnit())=='u017' or GetUnitTypeId(GetFilterUnit())=='u019' or GetUnitTypeId(GetFilterUnit())=='u018' or GetUnitTypeId(GetFilterUnit())=='u01A' or GetUnitTypeId(GetFilterUnit())=='u01B' or GetUnitTypeId(GetFilterUnit())=='u01C' or GetUnitTypeId(GetFilterUnit())=='u01U' or GetUnitTypeId(GetFilterUnit())=='u01V' or GetUnitTypeId(GetFilterUnit())=='u01W' then
    call KillUnit(GetFilterUnit())
  endif
  return false
endfunction

function Visage_Familiars takes nothing returns nothing
  local group g=GetAvailableGroup()
  local unit Source=GetTriggerUnit()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local integer Level=GetUnitAbilityLevel(Source,'A1NE')
  local unit unit171
  local unit PSG
  local unit PTG
  local trigger t
  local integer Cache
  local boolean PYF=false
  call GroupEnumUnitsOfPlayer(g,GetOwningPlayer(Source),Condition(function player014))
  call KillGroup(g)
  if Level==0 then
    set Level=GetUnitAbilityLevel(Source,'A2IG')
    set PYF=true
  endif
  if Level==1 then
    set unit171=CreateUnit(GetOwningPlayer(Source),'u014',x+75,y+75,GetUnitFacing(Source))
    set PSG=CreateUnit(GetOwningPlayer(Source),'u01D',x-75,y-75,GetUnitFacing(Source))
  elseif Level==2 then
    set unit171=CreateUnit(GetOwningPlayer(Source),'u015',x+75,y+75,GetUnitFacing(Source))
    set PSG=CreateUnit(GetOwningPlayer(Source),'u01E',x-75,y-75,GetUnitFacing(Source))
  elseif Level==3 then
    set unit171=CreateUnit(GetOwningPlayer(Source),'u016',x+75,y+75,GetUnitFacing(Source))
    set PSG=CreateUnit(GetOwningPlayer(Source),'u01F',x-75,y-75,GetUnitFacing(Source))
  endif
  call SelectUnitAddForPlayer(unit171,GetOwningPlayer(Source))
  call SelectUnitAddForPlayer(PSG,GetOwningPlayer(Source))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl",unit171,"origin"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl",PSG,"origin"))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterUnitEvent(t,unit171,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function integer568))
  call SaveUnitHandle(hashtable019,(Cache),(2),(unit171))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(28),(0))
  call SaveInteger(hashtable019,(Cache),(194),(7))
  call timers007(unit171,7,Level)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterUnitEvent(t,PSG,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function integer568))
  call SaveUnitHandle(hashtable019,(Cache),(2),(PSG))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(28),(0))
  call SaveInteger(hashtable019,(Cache),(194),(7))
  call timers007(PSG,7,Level)
  if PYF then
    if Level==1 then
      set PTG=CreateUnit(GetOwningPlayer(Source),'u01R',x+75,y,GetUnitFacing(Source))
    elseif Level==2 then
      set PTG=CreateUnit(GetOwningPlayer(Source),'u01S',x+75,y,GetUnitFacing(Source))
    elseif Level==3 then
      set PTG=CreateUnit(GetOwningPlayer(Source),'u01T',x+75,y,GetUnitFacing(Source))
    endif
    call SelectUnitAddForPlayer(PTG,GetOwningPlayer(Source))
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl",PTG,"origin"))
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerRegisterUnitEvent(t,PTG,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function integer568))
    call SaveUnitHandle(hashtable019,(Cache),(2),(PTG))
    call SaveInteger(hashtable019,(Cache),(5),(Level))
    call SaveInteger(hashtable019,(Cache),(28),(0))
    call SaveInteger(hashtable019,(Cache),(194),(7))
    call timers007(PTG,7,Level)
  endif
  set g=null
  set Source=null
  set unit171=null
  set PSG=null
  set PTG=null
  set t=null
endfunction

function unit168 takes nothing returns boolean
  //if GetSpellAbilityId()=='A1NE' or GetSpellAbilityId()=='A2IG' then
  //call Visage_Familiars()
  //else
  if GetSpellAbilityId()=='A1NB' or GetSpellAbilityId()=='A1NC' or GetSpellAbilityId()=='A1ND' or GetSpellAbilityId()=='A1NL' or GetSpellAbilityId()=='A1NM' or GetSpellAbilityId()=='A1NN' or GetSpellAbilityId()=='A2IZ' or GetSpellAbilityId()=='A2J0' or GetSpellAbilityId()=='A2J1' then
    call PJG()
  endif
  return false
endfunction

function P59 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function unit168))
  set t=null
endfunction

function PVG takes unit Source,integer HTD,integer PWG returns nothing
  local string c1="|c0000cc00"
  local string c="||"
  local string p=" "
  local string s=c1+"|||r"
  local string result
  local texttag tt=(LoadTextTagHandle(hashtable019,(GetHandleId(Source)),(451)))
  if HTD==0 then
    set result=" "
  elseif PWG==1 then
    if HTD==0 then
      set result=c+p+c+p+c
    elseif HTD==1 then
      set result=s+p+c+p+c
    elseif HTD==2 then
      set result=s+p+s+p+c
    elseif HTD==3 then
      set result=s+p+s+p+s
    endif
  elseif PWG==2 then
    if HTD==0 then
      set result=c+p+c+p+c+p+c
    elseif HTD==1 then
      set result=s+p+c+p+c+p+c
    elseif HTD==2 then
      set result=s+p+s+p+c+p+c
    elseif HTD==3 then
      set result=s+p+s+p+s+p+c
    elseif HTD==4 then
      set result=s+p+s+p+s+p+s
    endif
  elseif PWG==3 then
    if HTD==0 then
      set result=c+p+c+p+c+p+c+p+c
    elseif HTD==1 then
      set result=s+p+c+p+c+p+c+p+c
    elseif HTD==2 then
      set result=s+p+s+p+c+p+c+p+c
    elseif HTD==3 then
      set result=s+p+s+p+s+p+c+p+c
    elseif HTD==4 then
      set result=s+p+s+p+s+p+s+p+c
    elseif HTD==5 then
      set result=s+p+s+p+s+p+s+p+s
    endif
  elseif PWG==4 then
    if HTD==0 then
      set result=c+p+c+p+c+p+c+p+c+p+c
    elseif HTD==1 then
      set result=s+p+c+p+c+p+c+p+c+p+c
    elseif HTD==2 then
      set result=s+p+s+p+c+p+c+p+c+p+c
    elseif HTD==3 then
      set result=s+p+s+p+s+p+c+p+c+p+c
    elseif HTD==4 then
      set result=s+p+s+p+s+p+s+p+c+p+c
    elseif HTD==5 then
      set result=s+p+s+p+s+p+s+p+s+p+c
    elseif HTD==6 then
      set result=s+p+s+p+s+p+s+p+s+p+s
    endif
  endif
  call SetTextTagText(tt,result,.023)
  call SetTextTagPosUnit(tt,Source,0)
  call SetTextTagVisibility(tt,GetOwningPlayer(Source)==GetLocalPlayer() and IsDead(Source)==false)
  call SetTextTagPermanent(tt,true)
  set tt=null
endfunction

function PXG takes unit Hero,integer Level returns nothing
  local integer PWG=GetUnitAbilityLevel(Hero,'A1NA')
  call PVG(Hero,Level,PWG)
  if Level==0 or((LoadInteger(hashtable019,(GetHandleId((Hero))),((2484))))==1) then
    call UnitRemoveAbility(Hero,'A1O7')
    call UnitRemoveAbility(Hero,'A1O8')
    call UnitRemoveAbility(Hero,'A1O9')
    call UnitAddAbility2(Hero,'A1O1')
    call UnitRemoveAbility(Hero,'A1O2')
    call UnitRemoveAbility(Hero,'A1NZ')
    call UnitRemoveAbility(Hero,'A1N9')
    call UnitRemoveAbility(Hero,'A1NY')
    call UnitRemoveAbility(Hero,'A1O0')
    call UnitRemoveAbility(Hero,'A1O3')
    call UnitRemoveAbility(Hero,'A0LR')
    call UnitRemoveAbility(Hero,'A0YP')
    call UnitRemoveAbility(Hero,'A0OG')
    call UnitRemoveAbility(Hero,'A0YO')
    call UnitRemoveAbility(Hero,'A0NF')
    call UnitRemoveAbility(Hero,'A0MD')
  elseif Level==1 then
    call UnitRemoveAbility(Hero,'A1O7')
    call UnitRemoveAbility(Hero,'A1O8')
    call UnitRemoveAbility(Hero,'A1O9')
    call UnitRemoveAbility(Hero,'A1O1')
    call UnitAddAbility2(Hero,'A1O2')
    call UnitRemoveAbility(Hero,'A1NZ')
    call UnitRemoveAbility(Hero,'A1N9')
    call UnitRemoveAbility(Hero,'A1NY')
    call UnitRemoveAbility(Hero,'A1O0')
    call UnitRemoveAbility(Hero,'A1O3')
    call UnitAddAbility2(Hero,'A0LR')
    call UnitRemoveAbility(Hero,'A0YP')
    call UnitRemoveAbility(Hero,'A0OG')
    call UnitRemoveAbility(Hero,'A0YO')
    call UnitRemoveAbility(Hero,'A0NF')
    call UnitRemoveAbility(Hero,'A0MD')
  elseif Level==2 then
    call UnitRemoveAbility(Hero,'A1O7')
    call UnitRemoveAbility(Hero,'A1O8')
    call UnitRemoveAbility(Hero,'A1O9')
    call UnitRemoveAbility(Hero,'A1O1')
    call UnitRemoveAbility(Hero,'A1O2')
    call UnitAddAbility2(Hero,'A1NZ')
    call UnitRemoveAbility(Hero,'A1N9')
    call UnitRemoveAbility(Hero,'A1NY')
    call UnitRemoveAbility(Hero,'A1O0')
    call UnitRemoveAbility(Hero,'A1O3')
    call UnitRemoveAbility(Hero,'A0LR')
    call UnitAddAbility2(Hero,'A0YP')
    call UnitRemoveAbility(Hero,'A0OG')
    call UnitRemoveAbility(Hero,'A0YO')
    call UnitRemoveAbility(Hero,'A0NF')
    call UnitRemoveAbility(Hero,'A0MD')
  elseif Level==3 then
    call UnitRemoveAbility(Hero,'A1O7')
    call UnitRemoveAbility(Hero,'A1O8')
    call UnitRemoveAbility(Hero,'A1O9')
    call UnitRemoveAbility(Hero,'A0LR')
    call UnitRemoveAbility(Hero,'A0YP')
    call UnitAddAbility2(Hero,'A0OG')
    call UnitRemoveAbility(Hero,'A0YO')
    call UnitRemoveAbility(Hero,'A0NF')
    call UnitRemoveAbility(Hero,'A0MD')
    call UnitRemoveAbility(Hero,'A1O1')
    call UnitRemoveAbility(Hero,'A1O2')
    call UnitRemoveAbility(Hero,'A1NZ')
    call UnitRemoveAbility(Hero,'A1N9')
    call UnitRemoveAbility(Hero,'A1NY')
    call UnitRemoveAbility(Hero,'A1O0')
    call UnitRemoveAbility(Hero,'A1O3')
    if PWG==1 then
      call UnitAddAbility2(Hero,'A1O7')
    else
      call UnitAddAbility2(Hero,'A1N9')
    endif
  elseif Level==4 then
    call UnitRemoveAbility(Hero,'A1O7')
    call UnitRemoveAbility(Hero,'A1O8')
    call UnitRemoveAbility(Hero,'A1O9')
    call UnitRemoveAbility(Hero,'A0LR')
    call UnitRemoveAbility(Hero,'A0YP')
    call UnitRemoveAbility(Hero,'A0OG')
    call UnitAddAbility2(Hero,'A0YO')
    call UnitRemoveAbility(Hero,'A0NF')
    call UnitRemoveAbility(Hero,'A0MD')
    call UnitRemoveAbility(Hero,'A1O1')
    call UnitRemoveAbility(Hero,'A1O2')
    call UnitRemoveAbility(Hero,'A1NZ')
    call UnitRemoveAbility(Hero,'A1N9')
    call UnitRemoveAbility(Hero,'A1NY')
    call UnitRemoveAbility(Hero,'A1O0')
    call UnitRemoveAbility(Hero,'A1O3')
    if PWG==2 then
      call UnitAddAbility2(Hero,'A1O8')
    else
      call UnitAddAbility2(Hero,'A1NY')
    endif
  elseif Level==5 then
    call UnitRemoveAbility(Hero,'A1O7')
    call UnitRemoveAbility(Hero,'A1O8')
    call UnitRemoveAbility(Hero,'A1O9')
    call UnitRemoveAbility(Hero,'A1O1')
    call UnitRemoveAbility(Hero,'A1O2')
    call UnitRemoveAbility(Hero,'A1NZ')
    call UnitRemoveAbility(Hero,'A1N9')
    call UnitRemoveAbility(Hero,'A1NY')
    call UnitAddAbility2(Hero,'A1O0')
    call UnitRemoveAbility(Hero,'A1O3')
    call UnitRemoveAbility(Hero,'A0LR')
    call UnitRemoveAbility(Hero,'A0YP')
    call UnitRemoveAbility(Hero,'A0OG')
    call UnitRemoveAbility(Hero,'A0YO')
    call UnitAddAbility2(Hero,'A0NF')
    call UnitRemoveAbility(Hero,'A0MD')
    call UnitRemoveAbility(Hero,'A1O1')
    call UnitRemoveAbility(Hero,'A1O2')
    call UnitRemoveAbility(Hero,'A1NZ')
    call UnitRemoveAbility(Hero,'A1N9')
    call UnitRemoveAbility(Hero,'A1NY')
    call UnitRemoveAbility(Hero,'A1O0')
    call UnitRemoveAbility(Hero,'A1O3')
    if PWG==3 then
      call UnitAddAbility2(Hero,'A1O9')
    else
      call UnitAddAbility2(Hero,'A1O0')
    endif
  elseif Level==6 then
    call UnitRemoveAbility(Hero,'A1O7')
    call UnitRemoveAbility(Hero,'A1O8')
    call UnitRemoveAbility(Hero,'A1O9')
    call UnitRemoveAbility(Hero,'A1O1')
    call UnitRemoveAbility(Hero,'A1O2')
    call UnitRemoveAbility(Hero,'A1NZ')
    call UnitRemoveAbility(Hero,'A1N9')
    call UnitRemoveAbility(Hero,'A1NY')
    call UnitRemoveAbility(Hero,'A1O0')
    call UnitAddAbility2(Hero,'A1O3')
    call UnitRemoveAbility(Hero,'A0LR')
    call UnitRemoveAbility(Hero,'A0YP')
    call UnitRemoveAbility(Hero,'A0OG')
    call UnitRemoveAbility(Hero,'A0YO')
    call UnitRemoveAbility(Hero,'A0NF')
    call UnitAddAbility2(Hero,'A0MD')
  endif
  if(GetUnitAbilityLevel(Hero,'A1NA')+2)==Level then
    call UnitAddAbility2(Hero,'A1NJ')
  else
    call UnitRemoveAbility(Hero,'A1NJ')
  endif
endfunction

function PYG takes unit Source,real Damage returns nothing
  local integer Level=0
  local real PZG=110
  if Damage>PZG*6 then
    set Level=6
  elseif Damage>PZG*5 then
    set Level=5
  elseif Damage>PZG*4 then
    set Level=4
  elseif Damage>PZG*3 then
    set Level=3
  elseif Damage>PZG*2 then
    set Level=2
  elseif Damage>PZG*1 then
    set Level=1
  endif
  set Level=IMinIF(Level,2+GetUnitAbilityLevel(Source,'A1NA'))
  call SaveInteger(hashtable019,(GetHandleId(Source)),(450),(Level))
  call PXG(Source,Level)
endfunction

function PAG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer PWG=GetUnitAbilityLevel(Source,'A1NA')
  call PVG(Source,(LoadInteger(hashtable019,(GetHandleId((Source))),(450))),PWG)
  call PYG(Source,(LoadReal(hashtable019,(GetHandleId(Source)),(443))))
  set t=null
  set Source=null
  return false
endfunction

function PBG takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit1
  local unit Target=tt_unit2
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  if IsUnitAlly(Target,GetOwningPlayer(Source))==false then
    set M88=true
    call DamageTarget(Source,Target,1,Damage)
    set M88=false
  else
    call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+Damage)
  endif
  set Source=null
  set Target=null
endfunction

function PCG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call PYG(Source,(LoadReal(hashtable019,(GetHandleId(Source)),(443))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function Visage_SoulAssumption takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=(LoadInteger(hashtable019,(GetHandleId((Source))),(450)))
  local trigger t=AddProjectile(Source,Target,'h0BE',"PBG",1000,false)
  local integer Cache=GetHandleId(t)
  call SaveReal(hashtable019,(Cache),(20),((20+Level*65)*1.))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AntiMagicShell\\AntiMagicShell.mdl",Source,"chest"))
  call SaveReal(hashtable019,(GetHandleId(Source)),(443),((0)*1.))
  call PYG(Source,0)
  call AddTimedKeyToUnit(Source,2484,4)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerAddCondition(t,Condition(function PCG))
  call TriggerRegisterTimerEvent(t,4,false)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set Source=null
  set Target=null
  set t=null
endfunction

function P6G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  if GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A1NA')then
    if GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT then
      call SaveReal(hashtable019,(GetHandleId(Source)),(443),(((LoadReal(hashtable019,(GetHandleId(Source)),(443)))-Damage)*1.))
    endif
    call PYG(Source,(LoadReal(hashtable019,(GetHandleId(Source)),(443))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  return false
endfunction

function Visage_SoulAssumption_Learn takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local integer Cache=GetHandleId(Source)
  local texttag tt=CreateTextTag()
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function PAG))
  call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(Source))
  call SetTextTagText(tt," ",.023)
  call SetTextTagPosUnit(tt,Source,0)
  call SetTextTagVisibility(tt,GetOwningPlayer(Source)==GetLocalPlayer())
  call SetTextTagPermanent(tt,true)
  set M78[GetPlayerId(GetOwningPlayer(Source))]=Source
  call SaveReal(hashtable019,(Cache),(443),((0)*1.))
  call PYG(Source,0)
  call SaveTextTagHandle(hashtable019,(Cache),(451),(tt))
  set Source=null
  set t=null
  set tt=null
endfunction

function integers148 takes unit P0G,unit reals034 returns nothing
  local real Damage=GetEventDamage()
  local integer Level=GetUnitAbilityLevel(P0G,'A1NA')
  local real integers149=(LoadReal(hashtable019,(GetHandleId(P0G)),(443)))
  local trigger t
  local integer Cache
  if DistanceBetweenUnits(P0G,reals034)<1400 and M88==false and IsRealDamage then
    if IsDamageReal(Damage)and GetEventDamage()>2 and GetEventDamageSource()!=GetTriggerUnit()and(IsPlayerBelongToTeams(GetOwningPlayer(GetEventDamageSource()))or GetUnitTypeId(GetEventDamageSource())=='n00L')then
      set integers149=integers149+Damage
      call SaveReal(hashtable019,(GetHandleId(P0G)),(443),((integers149)*1.))
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call SaveUnitHandle(hashtable019,(Cache),(2),(P0G))
      call SaveReal(hashtable019,(Cache),(20),((Damage)*1.))
      call TriggerRegisterTimerEvent(t,6,false)
      call TriggerRegisterUnitEvent(t,P0G,EVENT_UNIT_DEATH)
      call TriggerRegisterUnitEvent(t,P0G,EVENT_UNIT_SPELL_EFFECT)
      call TriggerAddCondition(t,Condition(function P6G))
      call PYG(P0G,integers149)
    endif
  endif
  set t=null
endfunction

function Q4G takes nothing returns nothing
  local integer i=0
  loop
    exitwhen i>12
    if M78[i]!=null then
      call integers148(M78[i],GetTriggerUnit())
    endif
    set i=i+1
  endloop
endfunction

function Q7G takes nothing returns boolean
  if GetLearnedSkill()=='A1NA' and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call Visage_SoulAssumption_Learn()
  endif
  return false
endfunction

function Q49 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Q7G))
  set t=null
  call RAD("Q4G")
endfunction

function QDG takes nothing returns boolean
  return(IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(TmpUnit376))and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>1)!=null
endfunction

function QEG takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(TmpUnit376),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,('A0JE'))
  call SetUnitAbilityLevel(Caster,('A0JE'),TmpInt377)
  call IssueTargetOrderById(Caster,852075,Target)
  set Target=null
  set Caster=null
endfunction

function QFG takes unit Caster,unit Hero returns nothing
  local group HQ9=GetAvailableGroup()
  local boolexpr VH9=Condition(function QDG)
  set TmpUnit376=Hero
  call GroupEnumUnitsInRange(HQ9,GetUnitX(Caster),GetUnitY(Caster),675,VH9)
  call ForGroup(HQ9,function QEG)
  call KillGroup(HQ9)
  set HQ9=null
  set VH9=null
endfunction

function QGG takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST then
    call KillUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger((t))
  elseif GetTriggerEvalCount(t)>22 then
    call KillUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger((t))
    call InterruptUnit((LoadUnitHandle(hashtable019,(Cache),(14))))
  else
    call SetUnitAnimation(Caster,"birth")
    set Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
    set TmpInt377=GetTriggerExecCount(t)*GetUnitAbilityLevel(Hero,('A06P'))/ 2
    call QFG(Caster,Hero)
  endif
  set t=null
  set Caster=null
  set Hero=null
endfunction

function WL_Upheaval takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  //local location YT9=GetSpellTargetLoc()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local unit Caster=CreateUnit(GetOwningPlayer(Hero),('e01G'),x,y,0)
  //call RemoveLocation(YT9)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddAction(t,function QGG)
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  set Hero=null
  //set YT9=null
  set Caster=null
  set t=null
endfunction

function QL9 takes nothing returns nothing
  call PreloadAbility(('A0JE'))
endfunction

function QJG takes nothing returns nothing
  call UnitAddAbility2(GetEnumUnit(),('A0P2'))
endfunction

function integer571 takes nothing returns nothing
  call UnitRemoveAbility(GetEnumUnit(),('A0P2'))
endfunction

function unit173 takes unit QNG,unit QOG returns nothing
  if QNG!=null and QOG!=null then
    call ZO8("CLPB",GetUnitX(QNG),GetUnitY(QNG),GetUnitX(QOG),GetUnitY(QOG),.7,.1,.9,1,.3)
  endif
endfunction

function boolean195 takes nothing returns nothing
  local unit Hero=(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(14)))
  local real Damage=.2*GetEventDamage()
  set Damage=RMinIF(Damage,GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE))
  if GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)>1 and GetEnumUnit()!=GetTriggerUnit()then
    if GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)<Damage then
      call DamageTarget(Hero,GetEnumUnit(),3,Damage)
    else
      call B18(GetEnumUnit(),Damage)
    endif
  endif
  set Hero=null
endfunction

function timer010 takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local group HQ9=(LoadGroupHandle(hashtable019,(Cache),(220)))
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call ForGroup(HQ9,function integer571)
    call FlushChildHashtable(hashtable019,(Cache))
    call KillGroup(HQ9)
    call CleanTrigger((t))
  elseif GetEventDamage()>10 and GetEventDamage()<6000 and IsRealDamage then
    call DisableTrigger(t)
    call ForGroup(HQ9,function boolean195)
    call EnableTrigger(t)
  endif
  set t=null
  set HQ9=null
endfunction

function unit172 takes nothing returns boolean
  return(IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsDead(GetFilterUnit())==false)!=null
endfunction

function WL_FatalBonds_FindClosest takes nothing returns nothing
  set tt_real1=DistanceBetweenUnits(GetEnumUnit(),tt_unit1)
  if tt_real1<tt_real2 then
    set tt_real2=tt_real1
    set TEMPUNIT=GetEnumUnit()
  endif
endfunction

function WL_FatalBounds takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local group g=GetAvailableGroup()
  local integer Level=GetUnitAbilityLevel(Hero,('A0J5'))
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer i=2
  local group WDF=GetAvailableGroup()
  local unit array QTG
  local string FX="Abilities\\Spells\\Undead\\Curse\\CurseTarget.mdl"
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call unit173(Hero,Target)
  call Z48(FX,Target,"overhead",25)
  set QTG[1]=Target
  call SaveUnitHandle(hashtable019,(Cache),(246),(QTG[1]))
  call TriggerRegisterUnitEvent(t,QTG[1],EVENT_UNIT_DAMAGED)
  call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),600,Condition(function unit172))
  call GroupRemoveUnit(g,Target)
  call GroupAddUnit(WDF,Target)
  call SaveGroupHandle(hashtable019,(Cache),(220),(WDF))
  set tt_unit1=null
  loop
    exitwhen i>(2+Level)or FirstOfGroup(g)==null
    set tt_real2=9999
    set tt_unit1=QTG[i-1]
    set TEMPUNIT=null
    call ForGroup(g,function WL_FatalBonds_FindClosest)
    if TEMPUNIT!=null then
      set QTG[i]=TEMPUNIT
      call unit173(QTG[i-1],QTG[i])
      call TriggerRegisterUnitEvent(t,QTG[i],EVENT_UNIT_DAMAGED)
      call GroupAddUnit(WDF,QTG[i])
      call GroupRemoveUnit(g,QTG[i])
      call Z48(FX,QTG[i],"overhead",25)
      set i=i+1
    else
      exitwhen true
      
    endif
  endloop
  call SaveInteger(hashtable019,(Cache),(245),(i-1))
  set TmpInt377=GetUnitAbilityLevel(Hero,('A0J5'))
  call ForGroup(WDF,function QJG)
  call TriggerRegisterTimerEvent(t,25,false)
  call TriggerAddAction(t,function timer010)
  call KillGroup(g)
  set g=null
  set t=null
  set Hero=null
  set Target=null
  set WDF=null
endfunction

function Q19 takes nothing returns nothing
  //call PreloadAbility(('A0J9'))
endfunction

function QVG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=GetUnitAbilityLevel(Source,'A0AS')
  if GetTriggerEvalCount(t)>9 or GetTriggerEventId()==EVENT_UNIT_DEATH then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call UnitRemoveAbility(Target,'A17K')
    call UnitRemoveAbility(Target,'B0AP')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call DamageTarget(Source,Target,1,Level*10+10)
  endif
  set Source=null
  set Target=null
  set t=null
  return false
endfunction

function QWG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=GetUnitAbilityLevel(Source,'A0AS')
  if GetTriggerEvalCount(t)>9 or GetTriggerEventId()==EVENT_UNIT_DEATH or GetUnitAbilityLevel(Target,'BNdo')>0 then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call UnitRemoveAbility(Target,'A0P0')
    call UnitRemoveAbility(Target,'B073')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call Y18(Target,Level*10+10)
  endif
  set Source=null
  set Target=null
  set t=null
  return false
endfunction

function WL_ShadowWord takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  if IsUnitAlly(Target,GetOwningPlayer(Source))then
    call TriggerAddCondition(t,Condition(function QWG))
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Items\\StaffOfSanctuary\\Staff_Sanctuary_Target.mdl",Target,"chest")))
    call UnitAddAbility2(Target,'A0P0')
  elseif IsBlocked(GetSpellTargetUnit())==false then
    call TriggerAddCondition(t,Condition(function QVG))
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Voodoo\\VoodooAuraTarget.mdl",Target,"overhead")))
    call UnitAddAbility2(Target,'A17K')
  endif
  set Source=null
  set Target=null
  set t=null
endfunction

function Q09 takes nothing returns nothing
  call PreloadAbility('A0P0')
  call PreloadAbility('A17K')
endfunction

function QZG takes nothing returns nothing
  call DamageTarget(M98,GetEnumUnit(),1,20+10*MD8)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Immolation\\ImmolationDamage.mdl",GetEnumUnit(),"head"))
endfunction

function QAG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level
  local integer W78=GetUnitTypeId(Source)
  local group g
  if W78=='n00U' or W78=='n0KU' then
    set Level=1
  elseif W78=='n00Y' or W78=='n0KV' then
    set Level=2
  elseif W78=='n00Z' or W78=='n0KW' then
    set Level=3
  endif
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set tt_unit1=Source
    set M98=Source
    set MD8=Level
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),275,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function QZG)
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Source=null
  return false
endfunction

function QBG takes unit u returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QAG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(u))
  set t=null
endfunction

function unit174 takes nothing returns boolean
  local integer W78=GetUnitTypeId(GetTriggerUnit())
  if W78=='n00U' or W78=='n0KU' or W78=='n00Y' or W78=='n0KV' or W78=='n00Z' or W78=='n0KW' then
    call QBG(GetTriggerUnit())
  endif
  return false
endfunction

function Q3G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local real PLE=(LoadReal(hashtable019,(Cache),(191)))
  local real P1E=(LoadReal(hashtable019,(Cache),(192)))
  local integer Level=GetUnitAbilityLevel(Source,'S00U')
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',PLE,P1E,0)
  call UnitAddAbility2(Caster,'S00U')
  call SetUnitAbilityLevel(Caster,'S00U',Level)
  call IssuePointOrderById(Caster,852224,x,y)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set Source=null
  set Caster=null
  set t=null
  return false
endfunction

function Q6G takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.3,false)
  call TriggerAddCondition(t,Condition(function Q3G))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((GetSpellTargetX())*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetSpellTargetY())*1.))
  call SaveReal(hashtable019,(Cache),(191),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(192),((GetUnitY(Source))*1.))
  set Source=null
  set t=null
endfunction

function WL_Infernal takes nothing returns nothing
  if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) then
    call Q6G()
  endif
  
endfunction

function Q59 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterEnterRectSimple(t,GetWorldBounds())
  call TriggerAddCondition(t,Condition(function unit174))
  set t=null
endfunction

function integer572 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  if GetUnitAbilityLevel(Hero,'BHfs')==0 then
    call UnitRemoveAbility(Hero,'A0C9')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Hero=null
  return false
endfunction

function Q0G takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  call UnitAddAbility2(Hero,'A0C9')
  call SetUnitAbilityLevel(Hero,'A0C9',GetUnitAbilityLevel(Hero,GetSpellAbilityId()))
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call TriggerRegisterTimerEvent(t,.2,true)
  call TriggerAddCondition(t,Condition(function integer572))
  set Hero=null
  set t=null
endfunction

function IsShukuching takes nothing returns boolean
  return GetUnitAbilityLevel(GetFilterUnit(),'BHfs')>0
endfunction

function Shukuchi_Caster_Near takes unit cho returns unit
  local group ShukuGroup= CreateGroup()
  local unit u
  local player p
  call GroupEnumUnitsInRange(ShukuGroup,GetUnitX(cho),GetUnitY(cho),201,Condition(function IsShukuching))
  set u=FirstOfGroup(ShukuGroup)
  set p=GetOwningPlayer(u)
  
  if IsUnitEnemy(cho,p)==false then       //this makes it doesnt affect allies, it will find the enemies
    loop
      call GroupRemoveUnit(ShukuGroup,u)
      set u=FirstOfGroup(ShukuGroup)
      set p=GetOwningPlayer(u)
      exitwhen IsUnitEnemy(cho,p) or u==null
    endloop
  endif
  
  call DestroyGroup(ShukuGroup)
  set ShukuGroup=null
  set TEMPUNIT=u
  set u=null
  return TEMPUNIT
endfunction

function Weaver_Shukuchi_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local unit u = Shukuchi_Caster_Near(t)
  //local player p= GetOwningPlayer(u)
  local group chango = LoadGroupHandle(MHT,GetHandleId(u),StringHash("ShukuGroup"))
  if u!=null and (t!=u) and IsUnitInGroup(t,chango)==false and GetUnitAbilityLevel(t,'A04R')==0 and IsMagicImmune(t)==false and IsDead(t)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) then  //IsUnitEnemy(t,p)
    call GroupAddUnit(chango,t)
    call DamageTarget(u,t,1,LoadInteger(MHT,GetHandleId(u),StringHash("ShukuDamage")))
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl",t,"chest"))
  endif
  set chango=null
  //set p=null
  set u=null
  set t = null
  return false
endfunction
function Weaver_Shukuchi_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local unit u = LoadUnitHandle(MHT,info,0)
  local group chango
  
  if GetUnitAbilityLevel(u,'BHfs')==0 then
    call KillGroup(LoadGroupHandle(MHT,GetHandleId(u),StringHash("ShukuGroup")))
    call Timer_End(t)
    set t = null
    set u = null
    return
  endif
  
  set chango= CreateGroup()
  //call SaveInteger(MHT,GetHandleId(u),StringHash("Damage"),LoadInteger(MHT,info,0))
  //set temp_group2 = LoadGroupHandle(MHT,info,1)
  //set group_temp_unit[0] = u
  //set group_temp_integer[0] = LoadInteger(MHT,info,0)
  //set group_temp_player = GetOwningPlayer(u)
  call GroupEnumUnitsInRange(chango,GetWidgetX(u),GetWidgetY(u),200,Condition(function Weaver_Shukuchi_Targets))
  
  call DestroyGroup(chango)
  set chango=null
  set t = null
  set u = null
endfunction

function Weaver_Shukuchi_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local integer info = GetHandleId(t)
  local integer level=GetUnitAbilityLevel(u,'A0CA')
  if level<1 then
    set level=GetUnitAbilityLevel(u,'QB01')
  endif
  call SaveUnitHandle(MHT,info,0,u)
  call SaveGroupHandle(MHT,GetHandleId(u),StringHash("ShukuGroup"),CreateGroup())      //GetAvailableGroup()
  // call SaveInteger(MHT,info,0,GetUnitAbilityLevel(u,'A0CA')*20 + 70)
  call SaveInteger(MHT,GetHandleId(u),StringHash("ShukuDamage"),level*20 + 70)
  call TimerStart(t,0.05,true,function Weaver_Shukuchi_Duration)
  
  set t = null
  set u = null
endfunction

function integers150 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  call SetUnitState((LoadUnitHandle(hashtable019,(Cache),(26))),UNIT_STATE_MANA,(LoadReal(hashtable019,(Cache),(242))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  return false
endfunction

function R4G takes unit u,real R7G returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function integers150))
  call SaveUnitHandle(hashtable019,(Cache),(26),(u))
  call SaveReal(hashtable019,(Cache),(242),((R7G)*1.))
  set t=null
endfunction

function Weaver_TimeLapse takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggerUnit())
  local real OBF=RMaxIF((LoadReal(hashtable019,(Cache),(7200+1))),1)
  local real RLD=RMaxIF((LoadReal(hashtable019,(Cache),(7250+1))),1)
  local real x=(LoadReal(hashtable019,(Cache),(7300+1)))
  local real y=(LoadReal(hashtable019,(Cache),(7350+1)))
  local unit XX8=GetTriggerUnit()
  if(LoadReal(hashtable019,(Cache),(7200+1)))>1 and GetUnitState(XX8,UNIT_STATE_LIFE)>1 then
    call AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl",GetUnitX(XX8),GetUnitY(XX8))
    call SetUnitX(XX8,x)
    call SetUnitY(XX8,y)
    call SetUnitState(XX8,UNIT_STATE_LIFE,OBF)
    call SetUnitState(XX8,UNIT_STATE_MANA,RLD)
    call UnitRemoveBuffs(XX8,false,true)
    call RemoveDispellableBuffs(XX8)
    call R4G(XX8,RLD)
  endif
  set XX8=null
endfunction

function RDG takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local unit u=(LoadUnitHandle(hashtable019,(GetHandleId(t)),(221)))
  local integer Cache=GetHandleId(u)
  local integer i=1
  local integer k=10
  loop
    exitwhen i>k
    call SaveReal(hashtable019,(Cache),(7300+(i-1)),(((LoadReal(hashtable019,(Cache),(7300+(i)))))*1.))
    call SaveReal(hashtable019,(Cache),(7350+(i-1)),(((LoadReal(hashtable019,(Cache),(7350+(i)))))*1.))
    call SaveReal(hashtable019,(Cache),(7200+(i-1)),(((LoadReal(hashtable019,(Cache),(7200+(i)))))*1.))
    call SaveReal(hashtable019,(Cache),(7250+(i-1)),(((LoadReal(hashtable019,(Cache),(7250+(i)))))*1.))
    set i=i+1
  endloop
  call SaveReal(hashtable019,(Cache),(7300+10),((GetUnitX(u))*1.))
  call SaveReal(hashtable019,(Cache),(7350+10),((GetUnitY(u))*1.))
  call SaveReal(hashtable019,(Cache),(7200+10),((GetUnitState(u,UNIT_STATE_LIFE))*1.))
  call SaveReal(hashtable019,(Cache),(7250+10),((GetUnitState(u,UNIT_STATE_MANA))*1.))
  set t=null
  set u=null
endfunction

function Weaver_TimeLapse_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEventPeriodic(t,.5)
  call TriggerAddAction(t,function RDG)
  call SaveUnitHandle(hashtable019,GetHandleId(t),221,GetTriggerUnit())
  set t=null
endfunction

function unit094 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitRemoveAbility(Target,'A1QZ')
    call SaveInteger(hashtable019,(GetHandleId((Target))),((4290)),(2))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if GetTriggerUnit()==Target then
      call KillUnit(Source)
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source then
      call SetUnitAbilityLevel(Target,'A1QZ',GetUnitAbilityLevel(Target,'A1QZ')+1)
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SkeletalMageMissile\\SkeletalMageMissile.mdl",Target,"chest"))
    endif
  else
    call SetUnitX(Source,GetUnitX(Target)-40)
    call SetUnitY(Source,GetUnitY(Target)-40)
    if GenericCondition_IsDotAInvis(Target)and IsUnitVisibleLoD(Target,GetOwningPlayer(Source))==false then
      call KillUnit(Source)
    elseif ModuloInteger(GetTriggerEvalCount(t),5)==0 then
      call IssueTargetOrderById(Source,851983,Target)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function unit087 takes unit RNG,unit Target,integer Level returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call UnitRemoveAbility(RNG,'Avul')
  call SaveUnitHandle(hashtable019,(Cache),(2),(RNG))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call UnitAddAbility2(Target,'A1QZ')
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerRegisterUnitEvent(t,RNG,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function unit094))
  call TriggerEvaluate(t)
  call UnitApplyTimedLife(RNG,'BTLF',4+4*Level)
  set t=null
endfunction

function unit091 takes nothing returns boolean
  return((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))and((LoadInteger(hashtable019,(GetHandleId((GetFilterUnit()))),((4290))))==1)==false and(IsUnitVisibleLoD(GetFilterUnit(),GetOwningPlayer(tt_unit1)) or GenericCondition_IsDotAInvis(GetFilterUnit())==false))!=null
endfunction

function unit092 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local group g
  local integer i=1
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local unit RNG
  local unit Target
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  set x=SafeX50(x+18*Cos(a))
  set y=SafeY50(y+18*Sin(a))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  if GetTriggerEvalCount(t)>166 then
    loop
      exitwhen i>12
      if(LoadBoolean(hashtable019,(Cache),(511+i-1)))==false then
        call KillUnit((LoadUnitHandle(hashtable019,(Cache),(393+i-1))))
      endif
      set i=i+1
    endloop
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set g=GetAvailableGroup()
    set tt_unit1=Source
    call GroupEnumUnitsInRange(g,x,y,400,Condition(function unit091))
    loop
      exitwhen i>12
      if(LoadBoolean(hashtable019,(Cache),(511+i-1)))==false then
        set RNG=(LoadUnitHandle(hashtable019,(Cache),(393+i-1)))
        set x=(LoadReal(hashtable019,(Cache),(549+i-1)))
        set y=(LoadReal(hashtable019,(Cache),(567+i-1)))
        set x=SafeX50(x+18*Cos(a))
        set y=SafeY50(y+18*Sin(a))
        call SaveReal(hashtable019,(Cache),(549+i-1),((x)*1.))
        call SaveReal(hashtable019,(Cache),(567+i-1),((y)*1.))
        call SetUnitX(RNG,x)
        call SetUnitY(RNG,y)
        set Target=FirstOfGroup(g)
        if Target!=null then
          call GroupRemoveUnit(g,Target)
          call SaveInteger(hashtable019,(GetHandleId((Target))),((4290)),(1))
          call SaveBoolean(hashtable019,(Cache),(511+i-1),(true))
          call unit087(RNG,Target,GetUnitAbilityLevel(Source,'A1QW'))
        endif
      endif
      set i=i+1
    endloop
    call KillGroup(g)
    set g=null
    set RNG=null
    set Target=null
  endif
  set t=null
  set Source=null
  return false
endfunction

function Weaver_TheSwarm takes nothing returns nothing
  //local location l=GetSpellTargetLoc()
  local real TargetX=GetSpellTargetX()
  local real TargetY=GetSpellTargetY()
  local unit Source=GetTriggerUnit()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local real a=AngleBetweenXY(x,y,TargetX,TargetY)*bj_DEGTORAD
  local unit Caster
  local real AO8=SafeX50(x+3000*Cos(a))
  local real AP8=SafeY50(y+3000*Sin(a))
  local integer i=1
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real offset
  local integer Level=GetUnitAbilityLevel(Source,'A1QW')
  local integer W78
  //call RemoveLocation(l)
  if Level==1 then
    set W78='u01K'
  elseif Level==2 then
    set W78='u01H'
  elseif Level==3 then
    set W78='u01J'
  elseif Level==4 then
    set W78='u01L'
  endif
  loop
    exitwhen i>12
    set Caster=CreateUnit(GetOwningPlayer(Source),W78,x+GetRandomInt(-300,300),y+GetRandomInt(-300,300),a*bj_RADTODEG)
    call SaveUnitHandle(hashtable019,(Cache),(393+i-1),(Caster))
    call SaveBoolean(hashtable019,(Cache),(511+i-1),(false))
    call SaveReal(hashtable019,(Cache),(549+i-1),((GetUnitX(Caster))*1.))
    call SaveReal(hashtable019,(Cache),(567+i-1),((GetUnitY(Caster))*1.))
    set i=i+1
  endloop
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function unit092))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveReal(hashtable019,(Cache),(47),((AO8)*1.))
  call SaveReal(hashtable019,(Cache),(48),((AP8)*1.))
  set Source=null
  set Caster=null
  //set l=null
  set t=null
endfunction

function Func1139 takes nothing returns nothing
  call B08('u01K')
  call B08('u01H')
  call B08('u01J')
  call B08('u01L')
  call PreloadAbility('A1QZ')
endfunction

function RSG takes unit Source,unit FJD,unit RTG,integer Level,boolean weathereffect005 returns real
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(FJD),GetUnitY(FJD),0)
  if IsUnitIllusion(RTG) then
    call UnitAddAbility2(Caster,'QBT5')
  else
    if weathereffect005 then
      call UnitAddAbility2(Caster,'A0WY')
    else
      call UnitAddAbility2(Caster,'A0NL')
    endif
  endif
  call IssueTargetOrderById(Caster,852095,RTG)
  set Caster=null
  if IsUnitType(RTG,UNIT_TYPE_HERO)==false then
    call DamageTarget_Delayed(Source,RTG,1,50+25*Level,.4)
  else
    call DamageTarget_Delayed(Source,RTG,1,50,.4)
  endif
  if weathereffect005 then
    return((GetUnitX(RTG)-GetUnitX(FJD))*(GetUnitX(RTG)-GetUnitX(FJD))+(GetUnitY(RTG)-GetUnitY(FJD))*(GetUnitY(RTG)-GetUnitY(FJD)))/ 1000000
  endif
  return((GetUnitX(RTG)-GetUnitX(FJD))*(GetUnitX(RTG)-GetUnitX(FJD))+(GetUnitY(RTG)-GetUnitY(FJD))*(GetUnitY(RTG)-GetUnitY(FJD)))/ 360000
endfunction

function RVG takes unit Source,unit FJD returns unit
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,GetUnitX(FJD),GetUnitY(FJD),600,Condition(function NonImmuneEnemyFilter))
  call GroupRemoveUnit(g,FJD)
  set tt_unit1=GroupPickRandomUnit(g)
  call KillGroup(g)
  set g=null
  return tt_unit1
endfunction

function RWG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer unit088=(LoadInteger(hashtable019,(Cache),(391)))
  local unit FJD=UnitAsInteger_Load(unit088)
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local unit RTG
  local real SB8
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  if Count<(Level*2+1)then
    set RTG=RVG(Source,FJD)
    if RTG!=null then
      set SB8=RSG(Source,FJD,RTG,Level,false)
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
      call SaveInteger(hashtable019,(Cache),(5),(Level))
      call SaveInteger(hashtable019,(Cache),(391),(UnitAsInteger_Save(RTG)))
      call SaveInteger(hashtable019,(Cache),(34),(Count+1))
      call TriggerRegisterTimerEvent(t,SB8+.4,false)
      call TriggerAddCondition(t,Condition(function RWG))
    endif
  endif
  call UnitAsInteger_Clear(unit088)
  set t=null
  set Source=null
  set FJD=null
  set RTG=null
  return false
endfunction

function RYG takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local unit RZG=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Hero,'A0NM')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real SB8=RSG(Hero,Hero,RZG,Level,true)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Hero))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(391),(UnitAsInteger_Save(RZG)))
  call SaveInteger(hashtable019,(Cache),(34),(1))
  call TriggerRegisterTimerEvent(t,SB8,false)
  call TriggerAddCondition(t,Condition(function RWG))
  set Hero=null
  set RZG=null
  set t=null
endfunction

function WD_ParalyzingCask takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call RYG()
  endif
endfunction

function RBG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local integer Level=GetUnitAbilityLevel(Hero,'A0NE')
  call UnitRemoveAbility(Hero,'A0NE')
  call UnitAddAbility2(Hero,'A0NE')
  call SetUnitAbilityLevel(Hero,'A0NE',Level)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Hero=null
  return false
endfunction

function unit089 takes unit Target,integer Level returns nothing
  local real VBE=(8+Level*8)/ 3
  call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+VBE)
endfunction

function unit096 takes nothing returns boolean
  if(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))then
    call unit089(GetFilterUnit(),tt_int1)
  endif
  return false
endfunction

function R6G takes unit Hero returns nothing
  local integer Level=GetUnitAbilityLevel(Hero,'A0NE')
  local group g=GetAvailableGroup()
  set tt_unit1=Hero
  set tt_int1=Level
  call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),525,Condition(function unit096))
  call KillGroup(g)
  set g=null
endfunction

function RLG takes unit Hero returns nothing
  local integer Level=GetUnitAbilityLevel(Hero,'A0NE')
  local real unit098=4+4*Level
  call SetUnitState(Hero,UNIT_STATE_MANA,GetUnitState(Hero,UNIT_STATE_MANA)-(unit098/ 3))
  if GetUnitState(Hero,UNIT_STATE_MANA)<unit098 then
    if((LoadInteger(hashtable019,(GetHandleId((Hero))),((4265))))==1)==false then
      call IssueImmediateOrderById(Hero,852178)
    endif
  endif
endfunction

function R0G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  if GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER then
    if GetIssuedOrderId()==852178 then
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
      call TriggerRegisterTimerEvent(t,0,false)
      call TriggerAddCondition(t,Condition(function RBG))
    endif
  else
    call R6G(Hero)
    call RLG(Hero)
  endif
  set t=null
  set Hero=null
  return false
endfunction

function WD_VoodooRestoration takes nothing returns nothing
  local unit Hero=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call TriggerRegisterTimerEvent(t,.33,true)
  call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function R0G))
  set Hero=null
  set t=null
endfunction

function S4G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=GetUnitAbilityLevel(Source,'A0NO')
  local integer Count=GetTriggerEvalCount(t)
  local real S7G=(LoadReal(hashtable019,(Cache),(392)))
  local real S9F=0
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call Buff_Remove(Target,LoDBuff_BuffID[2])
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if Count==4 or Count==8 or Count==12 then
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      if Count==12 then
        call FlushChildHashtable(hashtable019,(Cache))
        call CleanTrigger(t)
      elseif Count==4 or Count==8 then
        call DestroyEffect(LoadEffectHandle(hashtable019,Cache,32))// to prevent leaks from this \/  stupid frog D:
        call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("effects\\NetherInferno.mdx",Target,"origin")))
      endif
      set S9F=(Level*.08 + 0.08)*RMaxIF(S7G-GetUnitState(Target,UNIT_STATE_LIFE),0)
      if S9F>0 then
        call TextTagOnUnit("+"+I2S(R2I(S9F)),2,Target,.023,68,0,187,216)
      endif
    endif
    call DamageTarget(Source,Target,1,Level*5+S9F)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function S8G takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetEnumUnit()
  call Buff_Add(Target,LoDBuff_AbilID[2],LoDBuff_BuffID[2],12.)
  call DestroyEffect(AddSpecialEffectTarget("effects\\NetherInferno.mdx",Target,"origin"))
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function S4G))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(392),((GetUnitState(Target,UNIT_STATE_LIFE))*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("effects\\NetherInferno.mdx",Target,"origin")))
  set t=null
  set Source=null
  set Target=null
endfunction

function WD_Maledict takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local group g=GetAvailableGroup()
  //local integer Level=GetUnitAbilityLevel(Source,'A0NO')
  call GroupEnumUnitsInRange(g,x,y,190,Condition(function D89))
  call ForGroup(g,function S8G)
  call KillGroup(g)
  //call RemoveLocation(l)
  //set l=null
  set g=null
  set Source=null
endfunction

function SEG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  if GetTriggerEventId()!=EVENT_UNIT_SPELL_ENDCAST then
    call InterruptUnit(Source)
  endif
  set Source=null
  set t=null
  return false
endfunction

function WD_DeathWard takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerRegisterTimerEvent(t,10,false)
  call TriggerAddCondition(t,Condition(function SEG))
  set t=null
  set Source=null
endfunction

function SHG takes nothing returns boolean
  if GetUnitTypeId(GetSummonedUnit())=='o000' or GetUnitTypeId(GetSummonedUnit())=='o001' or GetUnitTypeId(GetSummonedUnit())=='o00A' or GetUnitTypeId(GetSummonedUnit())=='o00X' then
    call AddTimedKeyToUnit(GetSummoningUnit(),4265,8)
  endif
  return false
endfunction

function Func1137 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function SHG))
  set t=null
endfunction

function SIG takes nothing returns boolean
  local integer id=0
  local unit Target
  local real Time=(TimerGetElapsed(GlobalTimer))
  local real mp
  local real hp
  loop
    exitwhen id>12
    set Target=udg_Hero[id]
    if Target!=null and GetUnitAbilityLevel(Target,'B0CD')==0 and ME8[id]>Time then
      set ME8[id]=0
    endif
    if Target!=null and GetUnitAbilityLevel(Target,'B0CD')>0 then
      if ME8[id]>Time and IsDead(Target)==false then
        set hp=GetUnitState(Target,UNIT_STATE_LIFE)
        set mp=GetUnitState(Target,UNIT_STATE_MANA)
        if hp<MF8[id]then
          set MF8[id]=hp
        endif
        if mp<MG8[id]then
          set MG8[id]=mp
        endif
        call SetUnitState(Target,UNIT_STATE_LIFE,MF8[id])
        
        set MI8[id]=MI8[id]+1
        if MI8[id]==10 then
          set MI8[id]=0
          if MJ8[id]==1 then
            call DamageTarget(MH8[id],Target,1,12.5)
          elseif MJ8[id]==2 then
            call DamageTarget(MH8[id],Target,1,20)
          elseif MJ8[id]==3 then
            call DamageTarget(MH8[id],Target,1,32)
          endif
        endif
      elseif ME8[id]>Time and IsDead(Target) then
        set ME8[id]=0
        set MF8[id]=9999
        set MG8[id]=9999
      endif
      if(GetUnitAbilityLevel(Target,'B0CD')>0 and ME8[id]<Time)then
        call UnitRemoveAbility(Target,'A1JA')
        call UnitRemoveAbility(Target,'B0CD')
        call UnitRemoveAbility(Target,'A1LD')
      endif
    endif
    set id=id+1
  endloop
  set Target=null
  return false
endfunction

function SJG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Caster
  if GetUnitAbilityLevel(Target,'B0CD')==0 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetOwningPlayer(Target)!=GetOwningPlayer(GetEventDamageSource())and GetUnitState(Target,UNIT_STATE_MAX_LIFE)*(.09+.01*Level)>GetUnitState(Target,UNIT_STATE_LIFE)and((LoadInteger(hashtable019,(GetHandleId((Target))),((2485))))==1)==false then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call UnitRemoveAbility(Target,'A1JA')
    call UnitRemoveAbility(Target,'B0CD')
    call UnitRemoveAbility(Target,'A1LD')
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl",Target,"overhead"))
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl",Target,"chest"))
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl",Target,"origin"))
    set Caster=CreateUnit(GetOwningPlayer(GetEventDamageSource()),'e00E',0,0,0)
    call UnitRemoveBuffs(Target,true,true)
    call UnitRemoveAbility(Target,'Aetl')
    call DamageTarget(Caster,Target,4,100000000.)
    set Caster=null
  endif
  set t=null
  set Target=null
  return false
endfunction

function SKG takes unit Source,unit Target returns nothing
  local integer Level=GetUnitAbilityLevel(Source,'A1MI')+GetUnitAbilityLevel(Source,'A2QE')
  local integer id=GetPlayerId(GetOwningPlayer(Target))
  local trigger t
  local integer Cache
  set ME8[id]=(TimerGetElapsed(GlobalTimer))+7+Level
  if Level==0 then
    set Level=GetUnitAbilityLevel(Source,'A2QE')
    set ME8[id]=(TimerGetElapsed(GlobalTimer))+17
  endif
  if Level>0 and IsUnitType(Target,UNIT_TYPE_HERO) and IsUnitIllusion(Target)==false and GetUnitTypeId(Target)!='H00J' and GetUnitAbilityLevel(Target,'A04R')==0 then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerAddCondition(t,Condition(function SJG))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveInteger(hashtable019,(Cache),(5),(Level))
    call UnitAddAbility2(Target,'A1JA')
    call UnitAddAbility2(Target,'A1LD')
    
    set MF8[id]=GetUnitState(Target,UNIT_STATE_LIFE)
    set MG8[id]=GetUnitState(Target,UNIT_STATE_MANA)
    set MH8[id]=Source
    set MJ8[id]=Level
  endif
  set t=null
endfunction

function SMG takes nothing returns nothing
  local unit Source=tt_unit1
  local unit Target=GetEnumUnit()
  local integer id=GetPlayerId(GetOwningPlayer(Target))
  local integer Level=GetUnitAbilityLevel(Source,'A1MI')+GetUnitAbilityLevel(Source,'A2QE')
  local trigger t
  local integer Cache
  if IsUnitType(Target,UNIT_TYPE_HERO) and IsUnitIllusion(Target)==false and GetUnitAbilityLevel(Target,'B0CD')==0 and GetUnitTypeId(Target)!='H00J' then
    set ME8[id]=(TimerGetElapsed(GlobalTimer))+7+Level
    call UnitAddAbility2(Target,'A1JA')
    call UnitAddAbility2(Target,'A1LD')
    set MF8[id]=GetUnitState(Target,UNIT_STATE_LIFE)
    set MG8[id]=GetUnitState(Target,UNIT_STATE_MANA)
    set MH8[id]=Source
    set MJ8[id]=Level
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerAddCondition(t,Condition(function SJG))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveInteger(hashtable019,(Cache),(5),(Level))
    set t=null
  endif
  set Source=null
  set Target=null
endfunction

function SNG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x0=(LoadReal(hashtable019,(Cache),(282)))
  local real y0=(LoadReal(hashtable019,(Cache),(283)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x0,y0,825,Condition(function DE9))
  call ForGroup(g,function SMG)
  call KillGroup(g)
  if GetTriggerEvalCount(t)>120 then
    call KillUnit((LoadUnitHandle(hashtable019,(Cache),(434))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set g=null
  return false
endfunction

function Gust takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real J2E=GetUnitFacing(Source)
  local real x2
  local real y2
  local unit SOG
  local unit VCF
  local unit SPG
  local unit SQG
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A1MI')+GetUnitAbilityLevel(Source,'A2QE')
  //call RemoveLocation(l)
  set x2=x+350*Cos(J2E*bj_DEGTORAD)
  set y2=y+350*Sin(J2E*bj_DEGTORAD)
  set SOG=CreateUnit(GetOwningPlayer(Source),'h0B3',x,y,J2E)
  set x2=x+350*Cos(J2E*bj_DEGTORAD)
  set y2=y-350*Sin(J2E*bj_DEGTORAD)
  set x2=x-350*Cos(J2E*bj_DEGTORAD)
  set y2=y+350*Sin(J2E*bj_DEGTORAD)
  set x2=x-350*Cos(J2E*bj_DEGTORAD)
  set y2=y-350*Sin(J2E*bj_DEGTORAD)
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function SNG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(282),((x)*1.))
  call SaveReal(hashtable019,(Cache),(283),((y)*1.))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveUnitHandle(hashtable019,(Cache),(434),(SOG))
  //set l=null
  set Source=null
  set SOG=null
  set VCF=null
  set SPG=null
  set SQG=null
  set t=null
endfunction

function Gust_Main takes nothing returns boolean
  if GetSpellAbilityId()=='A1N8' then
  endif
  return false
endfunction

function TP9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer id=0
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function SIG))
  loop
    exitwhen id>12
    set MF8[id]=9999
    set MG8[id]=9999
    set id=id+1
  endloop
  set t=null
endfunction

function SRG takes nothing returns nothing
  if IsUnitBADWithSpellbooks(GetEnumUnit())then
    return
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A1HZ')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A1HZ')
    call UnitRemoveAbility(GetEnumUnit(),'B0C5')
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A1I4')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A1I4')
    call UnitRemoveAbility(GetEnumUnit(),'B0C5')
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A1I3')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A1I3')
    call UnitRemoveAbility(GetEnumUnit(),'B0C5')
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A1I6')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A1I6')
    call UnitRemoveAbility(GetEnumUnit(),'B0C5')
  endif
endfunction

function SSG takes nothing returns nothing
  if IsUnitBADWithSpellbooks(GetEnumUnit())then
    return
  endif
  if IsMagicImmune(GetEnumUnit())==false then
    if MK8==1 then
      if GetUnitAbilityLevel(GetEnumUnit(),'A1HZ')==0 then
        call UnitRemoveAbility(GetEnumUnit(),'B0C5')
        call UnitAddAbility2(GetEnumUnit(),'A1HZ')
      endif
    elseif MK8==2 then
      if GetUnitAbilityLevel(GetEnumUnit(),'A1I4')==0 then
        call UnitRemoveAbility(GetEnumUnit(),'B0C5')
        call UnitAddAbility2(GetEnumUnit(),'A1I4')
      endif
    elseif MK8==3 then
      if GetUnitAbilityLevel(GetEnumUnit(),'A1I3')==0 then
        call UnitRemoveAbility(GetEnumUnit(),'B0C5')
        call UnitAddAbility2(GetEnumUnit(),'A1I3')
      endif
    elseif MK8==4 then
      if GetUnitAbilityLevel(GetEnumUnit(),'A1I6')==0 then
        call UnitRemoveAbility(GetEnumUnit(),'B0C5')
        call UnitAddAbility2(GetEnumUnit(),'A1I6')
      endif
    endif
  endif
endfunction

function STG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local group GGF=(LoadGroupHandle(hashtable019,(Cache),(340)))
  local real x=GetUnitX(Caster)
  local real y=GetUnitY(Caster)
  local group g=GetAvailableGroup()
  local group g2
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call ForGroup(GGF,function SRG)
    call KillGroup(g)
    call KillGroup(GGF)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call ShowUnit(Caster,false)
    set t=null
    set Source=null
    set Caster=null
    set GGF=null
    return false
  endif
  set MM8=Source
  set MK8=GetUnitAbilityLevel(Source,'A1HS')
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x,y,300,Condition(function DefaultEnemyFilter))
  call GroupRemoveGroup(g,GGF)
  call ForGroup(GGF,function SRG)
  call ForGroup(g,function SSG)
  call SaveGroupHandle(hashtable019,(Cache),(340),(g))
  call KillGroup(GGF)
  set t=null
  set Source=null
  set Caster=null
  set GGF=null
  set g=null
  set g2=null
  return false
endfunction

function AA_IceVortex takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local integer Level=GetUnitAbilityLevel(Source,'A1HS')
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'n0HQ',x,y,0)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call UnitApplyTimedLife(Caster,'BTLF',16)
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerRegisterUnitEvent(t,Caster,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function STG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveGroupHandle(hashtable019,(Cache),(340),(GetAvailableGroup()))
  //call RemoveLocation(l)
  set Source=null
  //set l=null
  set Caster=null
  set t=null
endfunction

function SWG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Caster
  local real Damage=(100+50*Level)/ 4
  if GetTriggerEventId()==EVENT_UNIT_DEATH or DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))>765 or GetUnitAbilityLevel(Target,'B0CC')==0 then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call UnitRemoveAbility(Target,'A1J9')
    call UnitRemoveAbility(Target,'B0CC')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEvalCount(t)==(10*.8)then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\ShivasEnchantment.mdx",Target,"overhead")))
    call DamageTarget(Source,Target,1,Damage)
  elseif GetTriggerEvalCount(t)==(10*1.6)then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\ShivasEnchantment.mdx",Target,"overhead")))
    call DamageTarget(Source,Target,1,Damage)
  elseif GetTriggerEvalCount(t)==(10*2.5)then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\ShivasEnchantment.mdx",Target,"overhead")))
    call DamageTarget(Source,Target,1,Damage)
  elseif GetTriggerEvalCount(t)==(10*3.4)then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call DamageTarget(Source,Target,1,Damage)
  elseif GetTriggerEvalCount(t)>(10*3.9)then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call UnitRemoveAbility(Target,'A1J9')
    call UnitRemoveAbility(Target,'B0CC')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    set Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
    call UnitAddAbility2(Caster,'A1MJ')
    call SetUnitAbilityLevel(Caster,'A1MJ',Level)
    call IssueTargetOrderById(Caster,852095,Target)
    set Caster=null
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function SXG takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A1MG')
  local string s="Doodads\\Cinematic\\GlowingRunes\\GlowingRunes4.mdl"
  if GetLocalPlayer()==GetOwningPlayer(Target)then
  endif
  if GetUnitTypeId(Source)=='e00E' then
    set Source=udg_Hero[GetPlayerId(GetOwningPlayer(Source))]
  endif
  call UnitAddAbility2(Target,'A1J9')
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Target))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Target))*1.))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\ShivasEnchantment.mdx",Target,"overhead")))
  call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffect(s,GetUnitX(Target),GetUnitY(Target))))
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function SWG))
  set Source=null
  set Target=null
  set t=null
endfunction

function AA_ColdFeet takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call SXG()
  endif
endfunction

function SZG takes nothing returns nothing
  local unit Source=MO8
  local unit Target=GetEnumUnit()
  local integer Level=MN8
  call SKG(Source,Target)
  call DamageTarget(Source,Target,1,150+100*Level)
  call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\PlasmaShot.mdl",Target,"chest"))
  set Source=null
  set Target=null
endfunction

function SAG takes nothing returns nothing
  local unit Source=MO8
  local unit Target=GetEnumUnit()
  local integer Level=MN8
  call SKG(Source,Target)
  set Source=null
  set Target=null
endfunction

function SBG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real RFE=(LoadReal(hashtable019,(Cache),(432)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real x=GetUnitX(Projectile)+30*Cos(J2E)
  local real y=GetUnitY(Projectile)+30*Sin(J2E)
  local group g
  local fogmodifier Z58
  if DistanceBetweenXY(x,y,TargetX,TargetY)<35 or x!=SafeX50(x)or y!=SafeY50(y)then
    set x=TargetX
    set y=TargetY
    call SetUnitX(Projectile,x)
    call SetUnitY(Projectile,y)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    set Z58=(LoadFogModifierHandle(hashtable019,(Cache),(440)))
    call FogModifierStop(Z58)
    call DestroyFogModifier(Z58)
    set Z58=null
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call KillUnit(Projectile)
    set tt_unit1=Source
    set MO8=Source
    set MN8=Level
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,RFE+25,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function SZG)
    call KillGroup(g)
    set g=null
  else
    call SetUnitX(Projectile,x)
    call SetUnitY(Projectile,y)
    set tt_unit1=Source
    set MO8=Source
    set MN8=Level
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,300,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function SAG)
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Projectile=null
  set Source=null
  return false
endfunction

function SCG takes unit Source,real x,real y,real N2F,effect FX,fogmodifier Z58 returns nothing
  local real J2E=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=CreateUnit(GetOwningPlayer(Source),'h0B6',GetUnitX(Source),GetUnitY(Source),J2E*bj_RADTODEG)
  local integer Level=GetUnitAbilityLevel(Source,'A1MI')+GetUnitAbilityLevel(Source,'A2QE')
  local real RFE=RMinIF(275+25*N2F*2,1000)
  local real YR8=DistanceBetweenXY(GetUnitX(Source),GetUnitY(Source),x,y)
  if IsUnitEnemy(Projectile,GetLocalPlayer())and IsObserver(GetLocalPlayer())==false then
    call UnitSetUsesAltIcon(Projectile,true)
  endif
  call TriggerRegisterTimerEvent(t,RMinIF(2./(YR8/ 30),.04),true)
  call TriggerAddCondition(t,Condition(function SBG))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveReal(hashtable019,(Cache),(47),((x)*1.))
  call SaveReal(hashtable019,(Cache),(48),((y)*1.))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveReal(hashtable019,(Cache),(432),((RFE)*1.))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveFogModifierHandle(hashtable019,(Cache),(440),(Z58))
  call SaveEffectHandle(hashtable019,(Cache),(32),(FX))
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1MI',true)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2QE',true)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1MN',false)
  set t=null
  set Projectile=null
endfunction

function S3G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real x
  local real y
  local real N2F=(TimerGetElapsed(GlobalTimer))-(LoadReal(hashtable019,(Cache),(431)))
  local string s
  local fogmodifier Z58
  local effect FX
  local real S6G=GetUnitX(Projectile)+30*Cos(J2E)
  local real SLG=GetUnitY(Projectile)+30*Sin(J2E)
  set x=SafeX50(S6G)
  set y=SafeY50(SLG)
  call SetUnitX(Projectile,x)
  call SetUnitY(Projectile,y)
  if GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A1MN')or x!=S6G or y!=SLG then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call RemoveUnit(Projectile)
    set s=""
    if IsPlayerAlly(GetOwningPlayer(Source),GetLocalPlayer())or IsObserver(GetLocalPlayer())then
      set s="war3mapImported\\IceWindGroundFX.mdl"
    endif
    set Z58=CreateFogModifierRadius(GetOwningPlayer(Source),FOG_OF_WAR_VISIBLE,x,y,500,true,true)
    call FogModifierStart(Z58)
    set FX=AddSpecialEffect(s,x,y)
    call SCG(Source,x,y,N2F,FX,Z58)
    set Z58=null
    set FX=null
  endif
  set t=null
  set Projectile=null
  set Source=null
  return false
endfunction

function AA_IceBlast takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=CreateUnit(GetOwningPlayer(Source),'H0B8',GetUnitX(Source),GetUnitY(Source),a*bj_RADTODEG)
  if IsUnitEnemy(Projectile,GetLocalPlayer())and IsObserver(GetLocalPlayer())==false then
    call UnitSetUsesAltIcon(Projectile,true)
  endif
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(13),((a)*1.))
  call SaveReal(hashtable019,(Cache),(431),(((TimerGetElapsed(GlobalTimer)))*1.))
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function S3G))
  call SetUnitColor(Projectile,GetPlayerColor(Player(14)))
  //call RemoveLocation(l)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1MI',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2QE',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1MN',true)
  call UnitAddAbility2(Source,'A1MN')
  set Source=null
  //set l=null
  set t=null
  set Projectile=null
endfunction

function S5G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer S2G=(LoadInteger(hashtable019,(GetHandleId(Source)),(449)))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source and GetEventDamage()>1 and IsRealDamage then
      call DisableTrigger(t)
      if S2G>0 then
        call SaveInteger(hashtable019,(GetHandleId(Source)),(449),(S2G-1))
        call TextTagOnUnit("+"+I2S(40+10*Level),1,Source,.024,100,200,255,255)
        call DamageTarget(Source,Target,1,40+10*Level)
      endif
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function T4G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  if GetTriggerEventId()!=EVENT_PLAYER_UNIT_ATTACKED or(LoadInteger(hashtable019,(GetHandleId(Source)),(449)))==0 then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call SaveInteger(hashtable019,(GetHandleId(Source)),(449),(0))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call UnitRemoveAbility(Source,'A1HN')
    call UnitRemoveAbility(Source,'B0CJ')
    call UnitRemoveAbility(Source,'A1IP')
  elseif GetAttacker()==Source and ((LoadInteger(hashtable019,(GetHandleId((Source))),((4289))))==1)==false then
    call AddTimedKeyToUnit(Source,4289,.4)
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
    call TriggerRegisterTimerEvent(t,2.,false)
    call TriggerAddCondition(t,Condition(function S5G))
    call SaveUnitHandle(hashtable019,(Cache),(17),(GetTriggerUnit()))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveInteger(hashtable019,(Cache),(5),(Level))
  endif
  set t=null
  set Source=null
  return false
endfunction

function T7G takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetEnumUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A1HQ')
  call UnitAddAbility2(Target,'A1HN')
  call UnitAddAbility2(Target,'A1IP')
  call SaveInteger(hashtable019,(GetHandleId(Target)),(449),(2+Level))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Target))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("war3mapImported\\FrostHands.mdx",Target,"right,hand")))
  call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffectTarget("war3mapImported\\FrostHands.mdx",Target,"left,hand")))
  call TriggerRegisterTimerEvent(t,30,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function T4G))
  set Source=null
  set Target=null
  set t=null
endfunction

function AA_ChillingTouch takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local group g=GetAvailableGroup()
  //local location l=GetSpellTargetLoc()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  //call RemoveLocation(l)
  call DestroyEffect(AddSpecialEffect("war3mapImported\\IcyWind.mdl",x,y))
  call GroupEnumUnitsInRange(g,x,y,550,Condition(function L58))
  call GroupAddUnit(g,Source)
  call ForGroup(g,function T7G)
  call KillGroup(g)
  set Source=null
  set g=null
  //set l=null
endfunction

function TDG takes nothing returns nothing
  call DamageTarget(MP8,GetEnumUnit(),1,(GetUnitAbilityLevel(MP8,'A1IM')*75)/ 10)
endfunction

function TEG takes unit Source, boolean b returns nothing
  local real DV9=(GetUnitAbilityLevel(Source,'A1IM')*75)/ 2
  set DV9=DV9/ 10.
  if GetUnitState(Source,UNIT_STATE_LIFE)<=DV9*.75 then
    set DV9=GetUnitState(Source,UNIT_STATE_LIFE)/ .75-10
  endif
  if b then
    call DamageTarget(Source,Source,1,DV9)
  endif
endfunction

function TFG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local group g
  local real DV9
  local unit Caster
  local integer Level=0
  local integer Count=GetTriggerEvalCount(t)
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    return false
  else
    if GetTriggerEvalCount(t)==1 then
      set Caster=CreateUnit(GetOwningPlayer(Source),'h0B2',x,y,0)
      call UnitApplyTimedLife(Caster,'BTLF',1)
      set Caster=null
      call TriggerRegisterTimerEvent(t,.1,true)
      set g=GetAvailableGroup()
      set MP8=Source
      set tt_unit1=Source
      call GroupEnumUnitsInRange(g,x,y,350,Condition(function DefaultEnemyFilter))
      call ForGroup(g,function TDG)
      call TEG(Source,LoadBoolean(hashtable019,Cache,0))
      call KillGroup(g)
    else
      if Count==10 then
        call FlushChildHashtable(hashtable019,(Cache))
        call CleanTrigger(t)
      endif
      set g=GetAvailableGroup()
      set MP8=Source
      set tt_unit1=Source
      call GroupEnumUnitsInRange(g,x,y,350,Condition(function DefaultEnemyFilter))
      call ForGroup(g,function TDG)
      call TEG(Source,LoadBoolean(hashtable019,Cache,0))
      call KillGroup(g)
      call RemoveDispellableBuffs(Source)
      call E79(Source,0,0)
    endif
  endif
  set t=null
  set g=null
  set Source=null
  return false
endfunction

function Slark_DarkPact takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real DV9=(GetUnitAbilityLevel(Source,'A1IM')*75)/ 2
  
  call SaveBoolean(hashtable019,Cache,0,true)
  
  if GetUnitTypeId(Source)=='e00E'then //multicast
    set Source=udg_Hero[GetPlayerId(GetOwningPlayer(Source))]
    set DV9=(GetUnitAbilityLevel(Source,'A1IM')*75)/ 2
    call SaveBoolean(hashtable019,Cache,0,false)
  endif
  
  call TriggerRegisterTimerEvent(t,1.5,false)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function TFG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=null
  set Source=null
endfunction

function TIG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local player AXD
  local integer Level=GetUnitAbilityLevel(Source,'A1IN')
  local integer MainLevel=GetUnitAbilityLevel(Source,'A1IN')
  local real Time=(TimerGetElapsed(GlobalTimer))
  local real TJG=(LoadReal(hashtable019,(Cache),(415)))
  local real TKG=(LoadReal(hashtable019,(Cache),(416)))
  if IsDead(Source)then
    set t=null
    set Source=null
    return false
  endif
  if IsSentinel(GetOwningPlayer(Source))then
    set AXD=Scourges[1]
  else
    set AXD=Sentinels[1]
  endif
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED and GetOwningPlayer(GetEventDamageSource())==NeutralsPlayer then
    if GetUnitAbilityLevel(Source,'A1IE')>0 then
      call UnitRemoveAbility(Source,'A1IE')
      call UnitRemoveAbility(Source,'B0C9')
    endif
    if GetUnitAbilityLevel(Source,'A1IF')>0 then
      call UnitRemoveAbility(Source,'A1IF')
      call UnitRemoveAbility(Source,'B0C9')
    endif
    if GetUnitAbilityLevel(Source,'A1IG')>0 then
      call UnitRemoveAbility(Source,'A1IG')
      call UnitRemoveAbility(Source,'B0C9')
    endif
    call SaveReal(hashtable019,(Cache),(414),((Time+2)*1.))
    set t=null
    set Source=null
    return false
  endif
  if(LoadReal(hashtable019,(Cache),(414)))>Time then
    set t=null
    set Source=null
    return false
  endif
  if (IsUnitVisibleLoD(Source,AXD) and GetUnitAbilityLevel(Source,'A1HX')==0) or GetUnitAbilityLevel(Source,'BNdo')>0 then
    set TKG=0
    if GetUnitAbilityLevel(Source,'A1IE')>0 or GetUnitAbilityLevel(Source,'A1IF')>0 or GetUnitAbilityLevel(Source,'A1IG')>0 then
      set TJG=TJG+.1
      if TJG>.4 then
        set TJG=0
        if GetUnitAbilityLevel(Source,'A1IE')>0 then
          call UnitRemoveAbility(Source,'A1IE')
          call UnitRemoveAbility(Source,'B0C9')
        endif
        if GetUnitAbilityLevel(Source,'A1IF')>0 then
          call UnitRemoveAbility(Source,'A1IF')
          call UnitRemoveAbility(Source,'B0C9')
        endif
        if GetUnitAbilityLevel(Source,'A1IG')>0 then
          call UnitRemoveAbility(Source,'A1IG')
          call UnitRemoveAbility(Source,'B0C9')
        endif
      endif
    endif
    call SaveReal(hashtable019,(Cache),(415),((TJG)*1.))
    call SaveReal(hashtable019,(Cache),(416),((TKG)*1.))
  elseif IsUnitVisibleLoD(Source,AXD)==false or GetUnitAbilityLevel(Source,'A1HX')>0 then
    set TJG=0
    if(Level==1 and GetUnitAbilityLevel(Source,'A1IE')==0)or(Level==2 and GetUnitAbilityLevel(Source,'A1IF')==0)or(Level==3 and GetUnitAbilityLevel(Source,'A1IG')==0)then
      set TKG=TKG+.1
      if TKG>.4 then
        set TKG=0
        if Level==1 then
          if GetUnitAbilityLevel(Source,'A1IE')==0 then
            call UnitAddAbility2(Source,'A1IE')
            call UnitMakeAbilityPermanent(Source,true,'A1I7')
            call UnitMakeAbilityPermanent(Source,true,'A1I8')
            call UnitMakeAbilityPermanent(Source,true,'A1IC')
          endif
        endif
        if Level==2 then
          if GetUnitAbilityLevel(Source,'A1IE')>0 then
            call UnitRemoveAbility(Source,'A1IE')
            call UnitRemoveAbility(Source,'B0C9')
          endif
          if GetUnitAbilityLevel(Source,'A1IF')==0 then
            call UnitAddAbility2(Source,'A1IF')
            call UnitMakeAbilityPermanent(Source,true,'A1I7')
            call UnitMakeAbilityPermanent(Source,true,'A1I9')
            call UnitMakeAbilityPermanent(Source,true,'A1ID')
          endif
        endif
        if Level==3 then
          if GetUnitAbilityLevel(Source,'A1IE')>0 then
            call UnitRemoveAbility(Source,'A1IE')
            call UnitRemoveAbility(Source,'B0C9')
          endif
          if GetUnitAbilityLevel(Source,'A1IF')>0 then
            call UnitRemoveAbility(Source,'A1IF')
            call UnitRemoveAbility(Source,'B0C9')
          endif
          if GetUnitAbilityLevel(Source,'A1IG')==0 then
            call UnitAddAbility2(Source,'A1IG')
            call UnitMakeAbilityPermanent(Source,true,'A1I7')
            call UnitMakeAbilityPermanent(Source,true,'A1IA')
            call UnitMakeAbilityPermanent(Source,true,'A1IB')
          endif
        endif
      endif
    endif
    call SaveReal(hashtable019,(Cache),(415),((TJG)*1.))
    call SaveReal(hashtable019,(Cache),(416),((TKG)*1.))
  endif
  set t=null
  set Source=null
  return false
endfunction

function Slark_ShadowDance_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveReal(hashtable019,(Cache),(415),((0)*1.))
  call SaveReal(hashtable019,(Cache),(416),((0)*1.))
  call SaveReal(hashtable019,(Cache),(414),(((TimerGetElapsed(GlobalTimer)))*1.))
  call SaveUnitHandle(hashtable019,(Cache),(2),(GetTriggerUnit()))
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function TIG))
  set t=null
endfunction

function TNG takes nothing returns boolean
  if GetLearnedSkill()=='A1IN' and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Slark_ShadowDance_Learn()
  endif
  return false
endfunction

function Slark_ImitateInvis takes nothing returns nothing
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if GetUnitAbilityLevel(GetTriggerUnit(),'A1HX')>0 then
      call IssueImmediateOrder(GetAttacker(),"stop")
      call Error(GetOwningPlayer(GetAttacker()),"This unit can't be attacked")
    endif
  else
    if GetUnitAbilityLevel(GetSpellTargetUnit(),'A1HX')>0 and ((IsUnitEnemy(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit())) and GetUnitAbilityLevel(GetTriggerUnit(),'Aloc')==0) or IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==false) then
      call IssueImmediateOrder(GetTriggerUnit(),"stop")
      if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==false then
        call Error(GetOwningPlayer(GetTriggerUnit()),"This unit can't be target for spell")
      endif
    endif
  endif
endfunction

function TT9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function TNG))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function Slark_ImitateInvis))
  set t=null
endfunction

function Slark_EssenceShift_RestoreStats takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer s_agi=(LoadInteger(hashtable019,(Cache),(422)))
  local integer s_str=(LoadInteger(hashtable019,(Cache),(423)))
  local integer s_int=(LoadInteger(hashtable019,(Cache),(424)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    if(LoadBoolean(hashtable019,(Cache),(276)))==false and GetTriggerUnit()==Source then
      call SaveBoolean(hashtable019,(Cache),(276),(true))
      call SetHeroAgi(Source,GetHeroAgi(Source,false)-s_agi-s_str-s_int,true)
      if LoadInteger(hashtable019,Cache,0)>0 then
        call LoDStat_Sub(Source,LoadInteger(hashtable019,Cache,0),"damage")
      endif
    elseif(LoadBoolean(hashtable019,(Cache),(277)))==false and GetTriggerUnit()==Target then
      call SaveBoolean(hashtable019,(Cache),(277),(true))
      call SetHeroAgi(Target,GetHeroAgi(Target,false)+s_agi,true)
      call SetHeroStr(Target,GetHeroStr(Target,false)+s_str,true)
      call SetHeroInt(Target,GetHeroInt(Target,false)+s_int,true)
    endif
  else
    if(LoadBoolean(hashtable019,(Cache),(276)))==false then
      call SaveBoolean(hashtable019,(Cache),(276),(true))
      call SetHeroAgi(Source,GetHeroAgi(Source,false)-s_agi-s_str-s_int,true)
      if LoadInteger(hashtable019,Cache,0)>0 then
        call LoDStat_Sub(Source,LoadInteger(hashtable019,Cache,0),"damage")
      endif
    endif
    if(LoadBoolean(hashtable019,(Cache),(277)))==false then
      call SaveBoolean(hashtable019,(Cache),(277),(true))
      call SetHeroAgi(Target,GetHeroAgi(Target,false)+s_agi,true)
      call SetHeroStr(Target,GetHeroStr(Target,false)+s_str,true)
      call SetHeroInt(Target,GetHeroInt(Target,false)+s_int,true)
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Slark_EssenceShift_StealPart takes unit Source,unit Target returns nothing
  local integer Level=GetUnitAbilityLevel(Source,'A1HR')
  //local integer A5D=GetUnitPrimaryAttribute(Target)
  local trigger t
  local integer Cache
  local integer s_agi
  local integer s_str
  local integer s_int
  local real dur
  local integer i=LoadInteger(MHT,GetHandleId(Source),EssenceShiftHash)+1
  local integer pid=GetPlayerId(GetOwningPlayer(Source))
  if Level==0 and GetUnitAbilityLevel(Source,'QP1F')>0 then
    set Level=GetUnitAbilityLevel(Source,'QP1F')
  endif
  set s_agi=IMinBJ(GetHeroAgi(Target,false)-1,1)
  set s_str=IMinBJ(GetHeroStr(Target,false)-1,1)
  set s_int=IMinBJ(GetHeroInt(Target,false)-1,1)
  if i>3 then
    set i=1
  endif
  call SaveInteger(MHT,GetHandleId(Source),EssenceShiftHash,i)
  //set b_EssenceShift_RangeSwitch[pid]=not b_EssenceShift_RangeSwitch[pid]
  if((not(Mode_BO))and (i<3 or IsUnitIdType(GetUnitTypeId(Source),UNIT_TYPE_RANGED_ATTACKER)==false)) or Mode_BO then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SetHeroAgi(Source,GetHeroAgi(Source,false)+s_agi+s_str+s_int,true)
    if GetUnitPrimaryAttribute(Source)!=2 then
      call LoDStat_Add(Source,s_agi+s_str+s_int,"damage")
      call SaveInteger(hashtable019,Cache,0,s_agi+s_str+s_int)
    endif
    call SetHeroAgi(Target,GetHeroAgi(Target,false)-s_agi,true)
    call SetHeroStr(Target,GetHeroStr(Target,false)-s_str,true)
    call SetHeroInt(Target,GetHeroInt(Target,false)-s_int,true)
    call SaveInteger(hashtable019,(Cache),(422),(s_agi))
    call SaveInteger(hashtable019,(Cache),(424),(s_str))
    call SaveInteger(hashtable019,(Cache),(423),(s_int))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveBoolean(hashtable019,(Cache),(276),(false))
    call SaveBoolean(hashtable019,(Cache),(277),(false))
    if Level==1 then
      set dur=15
    elseif Level==2 then
      set dur=30
    elseif Level==3 then
      set dur=60
    elseif Level==4 then
      set dur=120
    endif
    call TriggerRegisterTimerEvent(t,dur,false)
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function Slark_EssenceShift_RestoreStats))
    set t=null
  endif
  
endfunction

function Slark_EssenceShift_Actions takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  if GetTriggerEventId()!=EVENT_UNIT_DEATH then
    call Slark_EssenceShift_StealPart(Source,Target)
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Slark_EssenceShift_ALanded takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer i=(LoadInteger(hashtable019,(Cache),(30)))
  local unit Target=UnitAsInteger_Load(i)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source then
      call DisableTrigger(t)
      call UnitAsInteger_Clear(i)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call TriggerRegisterTimerEvent(t,.01,false)
      call TriggerAddCondition(t,Condition(function Slark_EssenceShift_Actions))
      call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
      call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
      call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
      call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    endif
  else
    call UnitAsInteger_Clear(i)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function Slark_EssenceShift_IsValid takes nothing returns nothing
  local trigger t=CreateTrigger()
  local unit Target=GetTriggerUnit()
  local unit Source=GetAttacker()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  if IsUnitType(Source,UNIT_TYPE_RANGED_ATTACKER) then
    call TriggerRegisterTimerEvent(t,2.5,false)
  else
    call TriggerRegisterTimerEvent(t,1.,false)
  endif
  call TriggerAddCondition(t,Condition(function Slark_EssenceShift_ALanded))
  call SaveInteger(hashtable019,(Cache),(30),(UnitAsInteger_Save(Target)))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set Target=null
  set Source=null
  set t=null
endfunction

function Slark_EssenceShift_Start takes nothing returns nothing
  local unit Source=GetAttacker()
  local integer lvl=GetUnitAbilityLevel(GetAttacker(),'A1HR')
  if lvl==0 and GetUnitAbilityLevel(Source,'QP1F')>0 then
    set lvl=GetUnitAbilityLevel(Source,'QP1F')
  endif
  if((LoadInteger(hashtable019,(GetHandleId((Source))),((4274))))==1)==false then
    call AddTimedKeyToUnit(Source,4274,.45-lvl*.05)
    call Slark_EssenceShift_IsValid()
  endif
  set Source=null
endfunction

function Slark_EssenceShift_Init takes nothing returns boolean
  if (GetUnitAbilityLevel(GetAttacker(),'A1HR')>0 or GetUnitAbilityLevel(GetAttacker(),'QP1F')>0)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetAttacker()==(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(14)))and GetUnitTypeId(GetTriggerUnit())!='n00L' and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))then
    call Slark_EssenceShift_Start()
  endif
  return false
endfunction

function Slark_EssenceShift_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function Slark_EssenceShift_Init))
  call SaveUnitHandle(hashtable019,Cache,(14),(GetTriggerUnit()))
  set t=null
endfunction

function TZG takes nothing returns boolean
  if (GetLearnedSkill()=='A1HR' or GetLearnedSkill()=='QP1F') and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Slark_EssenceShift_Learn()
  endif
  return false
endfunction

function TR9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function TZG))
  set t=null
endfunction

function TAG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  if GetTriggerEvalCount(t)>(4)/ .03 then
    call KillUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SetUnitX(Caster,GetUnitX(Source))
    call SetUnitY(Caster,GetUnitY(Source))
  endif
  //call UnitRemoveAbility(Source,'A04R')
  call UnitRemoveType(Source,UNIT_TYPE_PEON)
  set t=null
  set Source=null
  set Caster=null
  return false
endfunction

function Slark_ShadowDance takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A1IN')
  local real d=4
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'h0B1',GetUnitX(Source),GetUnitY(Source),0)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer i=-5
  local integer trans=255
  call ShowUnit(Source,false)
  call ShowUnit(Source,true)
  if GetLocalPlayer()==GetOwningPlayer(Source)then
    call ClearSelection()
    call SelectUnit(Source,true)
  endif
  call AddTimedAbility(Source,'A1HW',1,d)
  call AddTimedAbility(Source,'A1HX',1,d)
  call UnitAddType(Source,UNIT_TYPE_PEON)
  if IsUnitAlly(Source,GetLocalPlayer()) then
    set trans=0
  endif
  call ChangeUnitTint(Source,255,255,255,trans,d)
  //call UnitAddAbility(Source,'A04R')
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function TAG))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  
  set Source=null
  set Caster=null
  set t=null
endfunction

function T3G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=GetTriggerEvalCount(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local lightning ZQ8=(LoadLightningHandle(hashtable019,(Cache),(196)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(189)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(190)))
  local real TargetX=GetUnitX(Target)
  local real TargetY=GetUnitY(Target)
  local real AO8
  local real AP8
  local real LastX=(LoadReal(hashtable019,(Cache),(23)))
  local real LastY=(LoadReal(hashtable019,(Cache),(24)))
  local real J2E
  local real YR8=DistanceBetweenXY(LastX,LastY,TargetX,TargetY)
  call SaveReal(hashtable019,(Cache),(23),((TargetX)*1.))
  call SaveReal(hashtable019,(Cache),(24),((TargetY)*1.))
  if YR8>100 or Count>(3.5/ .03)or IsMagicImmune(Target) then
    call DestroyLightning(ZQ8)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call MoveLightning(ZQ8,true,SourceX,SourceY,TargetX,TargetY)
    if DistanceBetweenXY(SourceX,SourceY,TargetX,TargetY)>325 then
      set J2E=Atan2(TargetY-SourceY,TargetX-SourceX)
      set AO8=SourceX+(325)*Cos(J2E)
      set AP8=SourceY+(325)*Sin(J2E)
      call SetUnitX(Target,AO8)
      call SetUnitY(Target,AP8)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set ZQ8=null
  return false
endfunction

function T6G takes unit Source,unit Target,integer Level returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local lightning ZQ8=AddLightning("PONC",true,GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))
  call SetLightningColor(ZQ8,1,1,1,1)
  call SaveLightningHandle(hashtable019,(Cache),(196),(ZQ8))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(189),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(190),((GetUnitY(Source))*1.))
  call SaveReal(hashtable019,(Cache),(23),((GetUnitX(Target))*1.))
  call SaveReal(hashtable019,(Cache),(24),((GetUnitY(Target))*1.))
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function T3G))
  call DamageTarget(Source,Target,1,60*Level)
  call IssueTargetOrderById(Source,851983,Target)
  set t=null
  set ZQ8=null
endfunction

function TLG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=GetTriggerEvalCount(t)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local real PLE=(LoadReal(hashtable019,(Cache),(189)))
  local real P1E=(LoadReal(hashtable019,(Cache),(190)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real AO8=PLE+(30*(20+4*2)/ 30)*Count*Cos(J2E*bj_DEGTORAD)
  local real AP8=P1E+(30*(20+4*2)/ 30)*Count*Sin(J2E*bj_DEGTORAD)
  local real unit044=SquareRoot((AO8-TargetX)*(AO8-TargetX)+(AP8-TargetY)*(AP8-TargetY))
  local real reals023=700
  local real AJE=175
  local real boolean149=(1-unit044/ reals023)*AJE*2
  local group g=GetAvailableGroup()
  local unit Target
  if Count==1 then
    //call SetUnitAnimationByIndex(Source,5)
    call SetUnitTimeScale(Source,1.5)
  endif
  if boolean149>AJE then
    //call SetUnitAnimationByIndex(Source,5)
    set boolean149=AJE*2-boolean149
  endif
  if IsBuggyFlying(Source)==false then
    call SetUnitFlyHeight(Source,GetUnitDefaultFlyHeight(Source)+RMaxIF(boolean149,0),0)
  endif
  if IsUnitType(Source,UNIT_TYPE_HERO)then
    call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
  endif
  call SetUnitX(Source,SafeX50(AO8))
  call SetUnitY(Source,SafeY50(AP8))
  call SetUnitFacing(Source,J2E)
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,AO8,AP8,120,Condition(function DF9))
  set Target=FirstOfGroup(g)
  call KillGroup(g)
  if unit044<30 or Target!=null or GetTriggerEvalCount(t)>75 then
    if IsBuggyFlying(Source)==false then
      call SetUnitFlyHeight(Source,GetUnitDefaultFlyHeight(Source),0)
    endif
    call SetUnitFacing(Source,J2E)
    call SetUnitTimeScale(Source,1)
    call SetUnitAnimation(Source,"stand")
    call SetUnitPathing(Source,true)
    call UnitRemoveAbility(Source,'A1J6')
    call KillTrees(GetUnitX(Source),GetUnitY(Source),100)
    if Target!=null and IsMagicImmune(Target)==false then
      call AddTimedKeyToUnit(Target,4408,5)
      call T6G(Source,Target,Level)
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  set g=null
  return false
endfunction

function Slark_Pounce takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A1J7')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real YR8=700
  local real J2E=GetUnitFacing(Source)
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real TargetX=SafeX50(SourceX+YR8*Cos(J2E*bj_DEGTORAD))
  local real TargetY=SafeY50(SourceY+YR8*Sin(J2E*bj_DEGTORAD))
  call UnitAddAbility2(Source,'Amrf')
  call UnitRemoveAbility(Source,'Amrf')
  call SetUnitPathing(Source,false)
  call UnitAddAbility2(Source,'A1J6')
  call TriggerRegisterTimerEvent(t,.03,true)
  call TriggerAddCondition(t,Condition(function TLG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveReal(hashtable019,(Cache),(189),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(190),((SourceY)*1.))
  call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
  call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
  set Source=null
  set t=null
endfunction

function T5G takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit1
  local unit Target=tt_unit2
  local real Damage=(LoadReal(hashtable019,(Cache),(20)))
  call DamageTarget(Source,Target,1,Damage)
  set Source=null
  set Target=null
endfunction

function T2G takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetEnumUnit()
  local trigger t=AddProjectile(Source,Target,'h0BP',"T5G",700,false)
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A04A')
  local real Damage
  if Level==1 then
    set Damage=85
  elseif Level==2 then
    set Damage=165
  elseif Level==3 then
    set Damage=225
  elseif Level==4 then
    set Damage=300
  endif
  call SaveReal(hashtable019,(Cache),(20),((Damage)*1.))
  set Source=null
  set Target=null
  set t=null
endfunction

function QoP_ScreamOfPain takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local group g=GetAvailableGroup()
  local integer Level=GetUnitAbilityLevel(Source,'A04A')
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),500,Condition(function LR8))
  call ForGroup(g,function T2G)
  call KillGroup(g)
  call PlaySoundOnUnitBJ(sound032,100,Source)
  set Source=null
  set g=null
endfunction

function U8G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call InterruptUnit(Source)
  endif
  set t=null
  set Source=null
  return false
endfunction

function ShadowShaman_Shackles takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A00P')
  call TriggerRegisterTimerEvent(t,1+1.75+.75*Level,false)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerAddCondition(t,Condition(function U8G))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set Source=null
  set t=null
endfunction

function UEG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit target = LoadUnitHandle(hashtable019,Cache,17)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  
  if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)==4 or IsMagicImmune(Source)then
    call Buff_Remove(target,LoDBuff_BuffID[11])
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  if GetTriggerEventId()!=EVENT_WIDGET_DEATH then
    call DamageTarget(Source,target,1,10 + (Level-1)*20)
  endif
  
  set t=null
  set target = null
  set Source=null
  return false
endfunction

function UFG takes unit u, unit Source, integer Level returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function UEG))
  call Buff_Add(Source,LoDBuff_AbilID[11],LoDBuff_BuffID[11],4)
  call SaveUnitHandle(hashtable019,Cache,2,u)
  call SaveUnitHandle(hashtable019,Cache,17,Source)
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl",Source,"chest")))
  
  set t=null
endfunction

function item001 takes nothing returns boolean
  local unit u = GetEnumUnit()
  
  if IsUnitInGroup(u,MQ8)==false and IsMagicImmune(u)==false then
    call GroupAddUnit(MQ8,u)
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\FireBlast.mdx",u,"chest"))
    call UFG(MS8,u,MR8)
  endif
  
  set u = null
  return false
endfunction

function integers128 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(189)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(190)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real a=(LoadReal(hashtable019,(Cache),(13)))
  local real UIG=(1-I2R(Count)/ 50)*bj_PI
  local real UJG=1400/ 2*Cos(UIG)
  local real UKG=500/ 2*Sin(UIG)
  local real x=SafeX50(TargetX+UJG*Cos(a)-UKG*Sin(a))
  local real y=SafeY50(TargetY+UJG*Sin(a)+UKG*Cos(a))
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local group g
  local integer Level=GetUnitAbilityLevel(Source,'A1RJ')
  local string s=LoadStr(HeroStats,GetUnitTypeId(Source),COLOR)
  local integer r=255
  local integer gr=255
  local integer b=255
  if(s!="" and s!=null)then
    set r=S2I(SubString(s,0,3))
    set gr=S2I(SubString(s,3,6))
    set b=S2I(SubString(s,6,9))
  endif
  if GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()!='A1Z2' and Count>0)or Count>100 or L88(Source)then
    call KillTrees(x,y,300)
    call SetUnitVertexColor(Source,r,gr,b,255)
    if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A1RJ' then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1RJ',true)
    endif
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A20N',false)
    call SetUnitPathing(Source,true)
    call KillGroup(HND)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if ModuloInteger(Count,10)==0 then
      call KillTrees(x,y,200)
    endif
    call SaveInteger(hashtable019,(Cache),(34),(Count+1))
    if IsUnitType(Source,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
    endif
    call SetUnitX(Source,x)
    call SetUnitY(Source,y)
    call SetUnitFacing(Source,(a+UIG-bj_PI/ 2)*bj_RADTODEG)
    set g=GetAvailableGroup()
    set MQ8=HND
    set tt_unit1=Source
    set MS8=Source
    set MR8=GetUnitAbilityLevel(Source,'A1RJ')
    call GroupEnumUnitsInRange(g,x,y,325,Condition(function NonImmuneEnemyFilter))
    call ForGroup(g,function item001)
    call KillGroup(g)
  endif
  set t=null
  set Source=null
  set g=null
  set HND=null
  return false
endfunction

function Phoenix_Dive takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real a=AngleBetweenXY(SourceX,SourceY,GetSpellTargetX(),GetSpellTargetY())*bj_DEGTORAD
  local real TargetX=SourceX+1400/ 2*Cos(a)
  local real TargetY=SourceY+1400/ 2*Sin(a)
  local real life = GetWidgetLife(Source)
  local string s=LoadStr(HeroStats,GetUnitTypeId(Source),COLOR)
  local integer r=255
  local integer g=255
  local integer b=255
  if(s!="" and s!=null)then
    set r=S2I(SubString(s,0,3))
    set g=S2I(SubString(s,3,6))
    set b=S2I(SubString(s,6,9))
  endif
  call SetWidgetLife(Source,life - life*.15)
  call AddTimedKeyToUnit(Source,4301,2)
  call AddTimedKeyToUnit(Source,4415,2)
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function integers128))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(189),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(190),((SourceY)*1.))
  call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
  call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
  call SaveReal(hashtable019,(Cache),(13),((a)*1.))
  call SaveGroupHandle(hashtable019,(Cache),(133),(GetAvailableGroup()))
  call SetUnitPathing(Source,false)
  call SetUnitVertexColor(Source,r,g,b,50)
  call UnitAddAbility2(Source,'A20N')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1RJ',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A20N',true)
  set t=null
  set Source=null
endfunction


function UOG takes nothing returns nothing
  local unit Source=MT8
  local unit Target=GetEnumUnit()
  call DamageTarget(Source,Target,1,40+20*MU8)
  call Z48("Doodads\\Cinematic\\FireTrapUp\\FireTrapUp.mdl",Target,"origin",1)
  set Source=null
  set Target=null
endfunction

function UPG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=GetUnitAbilityLevel(Source,'A1RK')
  local group g
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set tt_unit1=Source
    set MT8=Source
    set MU8=Level
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1025,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function UOG)
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Source=null
  return false
endfunction

function UQG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit URG=(LoadUnitHandle(hashtable019,(Cache),(589)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if IsUnitIllusion(GetEventDamageSource()) then
      call HealUnitFor(URG,GetEventDamage())
    endif
  else
    if GetUnitX(URG)!=x or GetUnitY(URG)!=y then
      call SetUnitPosition(URG,x,y)
    endif
    if GetUnitY(Source)!=x or GetUnitY(Source)!=y then
      call SetUnitPosition(Source,x,y)
    endif
    set URG = LoadUnitHandle(hashtable019,Cache,19)
    call SetUnitX(URG,GetWidgetX(Source))
    call SetUnitY(URG,GetWidgetY(Source))
  endif
  if GetTriggerEvalCount(t)==1 then
    call PauseUnit(Source,true)
  endif
  set t=null
  set URG=null
  set Source=null
  return false
endfunction

function USG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit UTG=(LoadUnitHandle(hashtable019,(Cache),(588)))
  local unit URG=(LoadUnitHandle(hashtable019,(Cache),(589)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local unit WCE=(LoadUnitHandle(hashtable019,(Cache),(239)))
  local integer Level=GetUnitAbilityLevel(Source,'A1RK')
  local group g
  local unit Caster
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call StopSound(sound033,false,false)
    call ShowUnit(UTG,false)
    call ShowUnit(WCE,false)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call ShowUnit(Source,true)
    call UnitRemoveAbility(Source,'A04R')
    call SetUnitInvulnerable(Source,false)
    call PauseUnit(Source,false)
    if GetLocalPlayer()==GetOwningPlayer(Source)then
      call ClearSelection()
      call SelectUnit(Source,true)
    endif
    call SetUnitState(Source,UNIT_STATE_LIFE,1)
    set Caster=CreateUnit(GetOwningPlayer(GetKillingUnit()),'e00E',0,0,0)
    call UnitRemoveBuffs(Source,true,true)
    call UnitRemoveAbility(Source,'Aetl')
    call DamageTarget(Caster,Source,4,100000000)
    set Caster=null
  else
    if GetTriggerEvalCount(t)==1 then
      call SetUnitFlyHeight(URG,0,200)
    elseif GetTriggerEvalCount(t)==2 then
      call PauseUnit(URG,false)
      call UnitApplyTimedLife(URG,'BTLF',.1)
      call StopSound(sound033,false,false)
      call StartSound(sound034)
      call DestroyEffect(AddSpecialEffect("war3mapImported\\FireNova2.mdx",GetUnitX(UTG),GetUnitY(UTG)))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call ShowUnit(Source,true)
      call UnitRemoveAbility(Source,'A04R')
      call SetUnitInvulnerable(Source,false)
      call SetUnitAnimationByIndex(Source,8)
      call QueueUnitAnimation(Source,"idle")
      call PauseUnit(Source,false)
      if GetLocalPlayer()==GetOwningPlayer(Source)then
        call ClearSelection()
        call SelectUnit(Source,true)
      endif
      call ShowUnit(UTG,false)
      call ShowUnit(WCE,false)
      call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_MAX_LIFE))
      call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MAX_MANA))
      set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
      call UnitAddAbility2(Caster,'A1ZT')
      call SetUnitAbilityLevel(Caster,'A1ZT',Level)
      call IssueImmediateOrderById(Caster,852127)
      set Caster=null
    endif
  endif
  set t=null
  set Source=null
  set UTG=null
  set WCE=null
  set URG=null
  set g=null
  return false
endfunction

function unit082 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local unit UTG
  local unit URG
  local unit WCE=CreateUnit(GetOwningPlayer(Source),'h0CL',GetUnitX(Source),GetUnitY(Source),0)
  local integer Level=GetUnitAbilityLevel(Source,'A1RK')
  local unit Caster
  set UTG=CreateUnit(GetOwningPlayer(Source),'h0BX',x,y,0)
  if Level==1 then
    set URG=CreateUnit(GetOwningPlayer(Source),'h0CV',x,y,0)
  elseif Level==2 then
    set URG=CreateUnit(GetOwningPlayer(Source),'h0CX',x,y,0)
  elseif Level==3 then
    set URG=CreateUnit(GetOwningPlayer(Source),'h0CW',x,y,0)
  endif
  call AddSpecialEffectTarget("war3mapImported\\PhoenixDown_2.mdl",UTG,"origin")
  if GetLocalPlayer()==GetOwningPlayer(Source)then
    call ClearSelection()
    call SelectUnit(URG,true)
  endif
  
  call RefreshWithBalance(Source,false)
  call RemoveAbilsForUnit(Source)
  call KillTrees(x,y,400)
  call ShowUnit(Source,false)
  call UnitAddAbility2(Source,'A04R')
  call E79(Source,0,0)
  call SetUnitInvulnerable(Source,true)
  call UnitRemoveBuffs(Source,true,true)
  call StartSound(sound033)
  call UnitRemoveAbility(URG,'Arav')
  call UnitApplyTimedLife(UTG,'BTLF',6.1)
  call UnitApplyTimedLife(WCE,'BTLF',6.1)
  call UnitApplyTimedLife(URG,'BTLF',6.1)
  call TriggerRegisterTimerEvent(t,5.2,false)
  call TriggerRegisterTimerEvent(t,6,false)
  call TriggerAddCondition(t,Condition(function USG))
  call TriggerRegisterUnitEvent(t,URG,EVENT_UNIT_DEATH)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(588),(UTG))
  call SaveUnitHandle(hashtable019,(Cache),(589),(URG))
  call SaveUnitHandle(hashtable019,(Cache),(239),(WCE))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Source))*1.))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterUnitEvent(t,URG,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function UPG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerRegisterUnitEvent(t,URG,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,URG,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function UQG))
  call SaveUnitHandle(hashtable019,(Cache),(589),(URG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Source))*1.))
  
  if EM9(Source,'I0A8')then
    set Caster = CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
    call UnitAddAbility2(Caster,'A04I')
    call SaveUnitHandle(hashtable019,Cache,19,Caster)
    set Caster = null
  endif
  set WCE=null
  set t=null
  set Source=null
  set UTG=null
  set URG=null
endfunction

function Phoenix_Supernova takes nothing returns nothing
  if LoadInteger(hashtable019,GetHandleId(GetTriggerUnit()),1111111)!=1 then
    call unit082()
  endif
endfunction

function T39 takes nothing returns nothing
  call PreloadAbility('A1ZT')
endfunction

function Phoenix_Sunray_End takes unit u, timer t, integer info returns nothing
  local player p = GetOwningPlayer(u)
  local integer save = GetHandleId(u)
  
  call DestroyLightning(LoadLightningHandle(MHT,info,6))
  call DestroyLightning(LoadLightningHandle(MHT,info,5))
  call DestroyLightning(LoadLightningHandle(MHT,info,4))
  call DestroyLightning(LoadLightningHandle(MHT,info,3))
  call DestroyLightning(LoadLightningHandle(MHT,info,2))
  call KillGroup(LoadGroupHandle(MHT,info,1))
  
  call SaveInteger(hashtable019,save,4312,2)
  
  if LoadInteger(hashtable019,save,704)==0 or LoadInteger(hashtable019,save,704)=='A1YY' then
    call SetPlayerAbilityAvailable2(p,'A1YY',true)
  endif
  if LoadInteger(hashtable019,save,4311)!=1 then
    call UnitRemoveAbility(u,'Abun')
  endif
  
  call SetPlayerAbilityAvailable2(p,'A1YY',true)
  call SaveBoolean(MHT,save,'A1YY',false)
  call SaveBoolean(MHT,save,'A205',false)
  call UnitRemoveAbility(u,'A205')
  call UnitRemoveAbility(u,'A1Z3')
  call SetUnitPathing(u,true)
  
  call SetUnitAnimation(u,"stand")
  
  call StopSound(sound039,false,true)
  
  call Timer_End(t)
  set p=null
endfunction

function Phoenix_Sunray_Target_Condition takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if GetUnitAbilityLevel(t,'A04R')==0 and IsDead(t)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and t!=group_temp_unit[0] and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)!=null) then
    call GroupAddUnit(LoadGroupHandle(MHT,group_temp_integer[0],1),t)
  endif
  
  set t = null
  return false
endfunction

function Phoenix_Sunray_Targets takes nothing returns nothing
  local unit t = GetEnumUnit()
  local real amount = (group_temp_real[0] + group_temp_real[1]*GetUnitState(t,UNIT_STATE_MAX_LIFE))/5.
  
  if IsUnitAlly(group_temp_unit[0],GetOwningPlayer(t))then
    call SetWidgetLife(t,GetWidgetLife(t) + amount*0.5)
  else
    call DamageTarget(group_temp_unit[0],t,3,amount)
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\FireRayTarget.mdx",t,"origin"))
    call TimedReveal(GetOwningPlayer(t),2,GetUnitX(group_temp_unit[0]),GetUnitY(group_temp_unit[0]),500)
  endif
  
  set t = null
endfunction

function Phoenix_Sunray_Stop takes unit u, integer spell returns nothing
  //disables sunray when the units casts
  //supernova, spell steal, or cancel sunray
  
  if spell=='A1Z3' or spell=='A1RK' or spell=='A27H' or spell=='A30J' then
    call SaveBoolean(MHT,GetHandleId(u),'A1YY',true)
  endif
endfunction

function Phoenix_Sunray_Orders takes unit u, integer order returns nothing
  local integer info
  local real x2
  local real y2
  local real x1
  local real y1
  
  //pi parti :D
  //2 pi: 6.28318
  //1 pi: 3.14159
  //cake > pi \:D/
  
  if GetUnitAbilityLevel(u,'A205')>0then
    if order==851983 then //prevents the unit from fleeing
      call DisableTrigger(GAME_TRIGGER)
      call InterruptUnit(u)
      call SetUnitAnimationByIndex(u,LoadInteger(MHT,GetUnitTypeId(u),'A1P8'))
      call EnableTrigger(GAME_TRIGGER)
      return
    endif
    
    set info = LoadInteger(MHT,GetHandleId(u),'A1YY')
    
    if order==852177then //toggle movement on and off
      call SaveBoolean(MHT,info,1,true)
      call SetUnitAnimationByIndex(u,LoadInteger(MHT,GetUnitTypeId(u),'A1P8'))
    elseif order==852178then
      call SaveBoolean(MHT,info,1,false)
      call SetUnitAnimation(u,"stand")
    endif
    
    if order==851971 then //change angle order
      set x1 = GetWidgetX(u)
      set y1 = GetWidgetY(u)
      
      if GetTriggerEventId()==EVENT_UNIT_ISSUED_TARGET_ORDER then
        set x2 = GetWidgetX(GetOrderTargetUnit())
        set y2 = GetWidgetY(GetOrderTargetUnit())
      else
        set x2 = GetOrderPointX()
        set y2 = GetOrderPointY()
      endif
      
      set x1 = Atan2(y2-y1,x2-x1)
      
      if 0 > x1 then
        //call BJDebugMsg("adding pi to angle cause blizzard is dumb") //BEST COMMENT EVA!!! >:333
        set x1 = x1 + 6.28318
      endif
      
      call SaveBoolean(MHT,info,0,true)
      call SaveReal(MHT,info,0,x1)
      call SaveReal(MHT,info,1,GetUnitFacing(u)*bj_DEGTORAD)
      
      call DisableTrigger(GAME_TRIGGER)
      call InterruptUnit(u)
      call EnableTrigger(GAME_TRIGGER)
    endif
  endif
endfunction

function Phoenix_Sunray_Duration takes nothing returns nothing
  local group g = null
  local lightning l = null
  local timer t = GetExpiredTimer()
  local integer load
  local integer level
  local integer loopA = 2
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,0)
  local boolean active
  local real offset
  local real angle
  local real ax2
  local real ay2
  local real ax1
  local real ay1
  local real x2
  local real y2
  local real z2
  local real x1
  local real y1
  local real z1
  
  set load = GetHandleId(u)
  
  if IsDead(u) or IsUnitDisabled(u)or IsUnitSilenced(u) or IsUnitPaused(u) or IsUnitCycloned(u) or LoadInteger(hashtable019,GetHandleId(u),704)==-1 or count>239 or LoadBoolean(MHT,load,'A1YY') then
    call Phoenix_Sunray_End(u,t,info)
    
    set t = null
    set u = null
    return
  endif
  
  //if GetUnitCurrentOrder(u)==851983 then
  //	call DisableTrigger(GAME_TRIGGER)
  //	call InterruptUnit(u)
  //	call EnableTrigger(GAME_TRIGGER)
  //endif
  
  set x1 = GetWidgetX(u)
  set y1 = GetWidgetY(u)
  set ax2 = GetWidgetLife(u)
  set angle = GetUnitFacing(u)*bj_DEGTORAD
  call SetWidgetLife(u,ax2 - ax2*0.0015)//6*0.025*0.01
  
  if LoadBoolean(MHT,info,0) then
    set angle = LoadReal(MHT,info,0)
    set ay2 = angle - GetUnitFacing(u)*bj_DEGTORAD
    
    set offset = LoadReal(MHT,info,1)
    set ax2 = angle - offset
    
    if ax2 > 0 then
      set ax1 = bj_DEGTORAD/2
    else
      set ax1 = -bj_DEGTORAD/2
    endif
    
    if -180*bj_DEGTORAD > ax2 or ax2 > 180*bj_DEGTORAD then
      set ax1 = -ax1
    endif
    
    set angle = offset + ax1
    call SaveReal(MHT,info,1,angle)
    
    if HaveSavedReal(MHT,info,2)then
      if 0>ay2 then
        set ay2 = -ay2
      endif
      
      if 0.02>ay2 then
        call SaveBoolean(MHT,info,0,false)
        call RemoveSavedReal(MHT,info,2)
      endif
    endif
    
    if LoadBoolean(MHT,info,0) then
      call SaveReal(MHT,info,2,ay2)
    endif
    
    //is the unit icarus diving \:3/
    if LoadInteger(hashtable019,load,4301)!=1 then
      call SetUnitFacing(u,angle*bj_RADTODEG)
    endif
  endif
  
  if LoadBoolean(MHT,info,1)then
    set x1 = SafeX50(x1 +5*Cos(angle))
    set y1 = SafeY50(y1 +5*Sin(angle))
    
    call KillTrees(x1,y1,200)
    if IsUnitType(u,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(u),99,true)
    endif
    call SetUnitX(u,x1)
    call SetUnitY(u,y1)
  endif
  
  if count==1 then
    call DisableTrigger(GAME_TRIGGER)
    call InterruptUnit(u)
    call EnableTrigger(GAME_TRIGGER)
  endif
  
  set ax1 = Cos(angle)
  set ay1 = Sin(angle)
  
  set angle = (GetUnitFacing(u)+90)*bj_DEGTORAD
  set ax2 = Cos(angle)
  set ay2 = Sin(angle)
  
  set x1 = GetWidgetX(u) + 50*ax1
  set y1 = GetWidgetY(u) + 50*ay1
  call MoveLocation(ZeroLocation,x1,y1)
  set z1 = GetUnitFlyHeight(u)
  if 50>z1 then
    set z1 = 50
  endif
  set z1 = z1 + GetLocationZ(ZeroLocation)
  
  set x2 = x1 + 1150*ax1
  set y2 = y1 + 1150*ay1
  call MoveLocation(ZeroLocation,x2,y2)
  set z2 = GetLocationZ(ZeroLocation)
  
  loop
    exitwhen loopA == 7
    set angle = 30*(loopA/5)*Pow(-1,loopA)
    set offset = 30*((8-loopA)/5)*Pow(-1,loopA)
    set l = LoadLightningHandle(MHT,info,loopA)
    
    call MoveLightningEx(l,false, x1 + angle*ax2,y1 + angle*ay2,z1 + offset, x2,y2,z2)
    set loopA = loopA + 1
  endloop
  
  call DestroyEffect(AddSpecialEffect("war3mapImported\\FireRayTarget.mdx",x2,y2))
  call SaveInteger(MHT,info,0,count+1)
  
  if count/10 == count/10. then
    set x2 = x1
    set y2 = y1
    set loopA = 0
    set g = LoadGroupHandle(MHT,info,1)
    set group_temp_unit[0] = u
    set group_temp_integer[0] = info
    
    loop
      exitwhen loopA == 26
      set x2 = x2 + 50*ax1
      set y2 = y2 + 50*ay1
      
      call GroupEnumUnitsInRange(temp_group,x2,y2,100,Condition(function Phoenix_Sunray_Target_Condition))
      if loopA/3 == loopA/3.then
        call TimedReveal(GetOwningPlayer(u),2,x2,y2,225)
      endif
      set loopA = loopA + 1
    endloop
    
    set level = GetUnitAbilityLevel(u,'A1YY')
    set angle = count/239.
    set offset = 8*level + 8
    set group_temp_real[0] = offset + offset*angle
    set group_temp_real[1] = (level + angle*level)/100
    
    call ForGroup(g,function Phoenix_Sunray_Targets)
    call GroupClear(g)
  endif
  
  set g = null //moar gut! :D
  set u = null
  set t = null
  set l=null   //no gut :P
endfunction

function Phoenix_Sunray_Start takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local timer t = Timer_Get()
  local integer loopA = 2
  local integer info = GetHandleId(t)
  local integer save = GetHandleId(u)
  
  call UnitAddAbility2(u,'Abun')
  call UnitAddAbility2(u,'A205')
  call UnitAddAbility2(u,'A1Z3')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A1YY',false)
  
  call SetUnitPathing(u,false)
  call SaveInteger(MHT,save,'A1YY',info)
  call SaveBoolean(MHT,save,'A1YY',false)
  
  call SaveUnitHandle(MHT,info,0,u)
  call SaveGroupHandle(MHT,info,1,GetAvailableGroup())
  call SaveBoolean(MHT,info,0,false)
  call SaveBoolean(MHT,info,1,false)
  
  call StartSound(sound039)
  call SetSoundPosition(sound039,GetWidgetX(u),GetWidgetY(u),100)
  
  call SetUnitAnimationByIndex(u,LoadInteger(MHT,GetUnitTypeId(u),'A1P8'))
  
  loop
    exitwhen loopA == 7
    call SaveLightningHandle(MHT,info,loopA,AddLightning("SRAY",false,0,0,0,0))
    set loopA = loopA + 1
  endloop
  
  call TimerStart(t,0.025,true,function Phoenix_Sunray_Duration)
  
  set u = null
  set t = null
endfunction

function Phoenix_Spirits_Leveling takes nothing returns nothing
  call UnitAddAbility2(GetTriggerUnit(),'A1YX')
  call SetUnitAbilityLevel(GetTriggerUnit(),'A1YX',GetUnitAbilityLevel(GetTriggerUnit(),'A331'))
endfunction

function Phoenix_Spirits_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,0)
  
  if count==1 or IsMagicImmune(u) or IsDead(u) then
    call DestroyEffect(LoadEffectHandle(MHT,info,2))
    call Timer_End(t)
    call UnitRemoveAbility(u,LoDBuff_AbilID[10])
    call UnitRemoveAbility(u,LoDBuff_BuffID[10])
    set t = null
    set u = null
    return
  endif
  
  if count/4 == count/4. then
    call DamageTarget(LoadUnitHandle(MHT,info,1),u,1,LoadInteger(MHT,info,1))
  endif
  
  call SaveInteger(MHT,info,0,count-1)
  
  set t = null
  set u = null
endfunction

function Phoenix_Spirits_Damage_Start takes unit u, unit t returns nothing
  local timer time = Timer_Get()
  local integer info = GetHandleId(time)
  
  call SaveUnitHandle(MHT,info,0,t)
  call SaveUnitHandle(MHT,info,1,u)
  call SaveEffectHandle(MHT,info,2,AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl",t,"chest"))
  call SaveInteger(MHT,info,0,16)
  call SaveInteger(MHT,info,1,GetUnitAbilityLevel(u,'A1YX')*20-5)
  
  call TimerStart(time,0.25,true,function Phoenix_Spirits_Duration)
  
  set time = null
endfunction

function Phoenix_Spirits_Damage takes unit u returns nothing
  if GetUnitAbilityLevel(u,LoDBuff_BuffID[10])==0 then
    call Phoenix_Spirits_Damage_Start(group_temp_unit[0],u)
  endif
  call UnitAddAbility2(u,LoDBuff_AbilID[10])
endfunction

function Phoenix_Spirits_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local unit u = group_temp_unit[0]
  
  if IsDead(t)==false and IsUnitEnemy(u,GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R')==0 and IsMagicImmune(t)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) then
    if IsUnitBADWithSpellbooks(t)==false then
      call SetPlayerAbilityAvailable(GetOwningPlayer(t),'A2L8',false)
      call AddTimedAbility(t,'A2L8',1,4)
      call SetUnitAbilityLevel(t,'A2L7',TempInteger)
    endif
    call Phoenix_Spirits_Damage(t)
  endif
  
  set t = null
  set u = null
  return false
endfunction
//// EWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW\/ usin ice's code is so ugli :<
function WXG takes unit Source, unit Projectile, real x, real y returns nothing
  set group_temp_unit[0] = Source
  set TempInteger=GetUnitAbilityLevel(Source,'A1YX')
  call GroupEnumUnitsInRange(temp_group,x,y,200,Condition(function Phoenix_Spirits_Targets))
  call DestroyEffect(AddSpecialEffect("war3mapImported\\Firaga_2.mdx",x,y))
  call KillUnit(Projectile)
  call ShowUnit(Projectile,false)
endfunction

function WYG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit WZG=(LoadUnitHandle(hashtable019,(Cache),(393)))
  local real GWG=(LoadReal(hashtable019,(Cache),(685)))
  local real TargetX
  local real TargetY
  local real x
  local real y
  local real a
  local real r=18
  local integer Level=GetUnitAbilityLevel(Source,'A1YX')
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    set TargetX=GetUnitX(Target)
    set TargetY=GetUnitY(Target)
    call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
    call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
    call RemoveSavedHandle(hashtable019,(Cache),(17))
    call SaveUnitHandle(hashtable019,(Cache),(17),(null))
  elseif Target==null then
    set TargetX=(LoadReal(hashtable019,(Cache),(47)))
    set TargetY=(LoadReal(hashtable019,(Cache),(48)))
  else
    set TargetX=GetUnitX(Target)
    set TargetY=GetUnitY(Target)
  endif
  set a=AngleBetweenXY(GetUnitX(WZG),GetUnitY(WZG),TargetX,TargetY)
  call SetUnitFacing(WZG,a)
  set a = a*bj_DEGTORAD
  set x=GetWidgetX(WZG)+r*Cos(a)
  set y=GetWidgetY(WZG)+r*Sin(a)
  call SetUnitX(WZG,x)
  call SetUnitY(WZG,y)
  if DistanceBetweenXY(x,y,TargetX,TargetY)<r*2 then
    call WXG(Source,WZG,x,y)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  set WZG=null
  return false
endfunction

function WAG takes unit Source,unit WZG,unit Target,real GWG,unit Caster returns nothing
  local trigger t=null
  local integer Cache
  
  if Source==Target then
    call KillUnit(WZG)
    call ShowUnit(WZG,false)
    
    return
  endif
  
  set t = CreateTrigger()
  set Cache = GetHandleId(t)
  
  call SetUnitVertexColor(WZG,255,255,255,255)
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function WYG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(393),(WZG))
  call SaveReal(hashtable019,(Cache),(47),((GetSpellTargetX())*1.))
  call SaveReal(hashtable019,(Cache),(48),((GetSpellTargetY())*1.))
  call SaveReal(hashtable019,(Cache),(685),((GWG)*1.))
  
  set t=null
endfunction

function WBG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local unit WCG=(LoadUnitHandle(hashtable019,(Cache),(393)))
  local unit W3G=(LoadUnitHandle(hashtable019,(Cache),(394)))
  local unit W6G=(LoadUnitHandle(hashtable019,(Cache),(395)))
  local unit WLG=(LoadUnitHandle(hashtable019,(Cache),(396)))
  local integer Level=GetUnitAbilityLevel(Source,'A1YX')
  local real a=GetUnitFacing(Source)
  local real x
  local real y
  local group g
  local group g2
  local real rate=-1*360*.02/ 4
  local real a2
  local real offset
  local real GWG=(LoadReal(hashtable019,(Cache),(685)))
  local real EMF
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if GetSpellAbilityId()=='A1Z2' then
      if IsDead(WCG)==false then
        call WAG(Source,WCG,GetSpellTargetUnit(),GWG,Caster)
        call RemoveSavedHandle(hashtable019,(Cache),(393))
      elseif IsDead(W3G)==false then
        call WAG(Source,W3G,GetSpellTargetUnit(),GWG,Caster)
        call RemoveSavedHandle(hashtable019,(Cache),(394))
      elseif IsDead(W6G)==false then
        call WAG(Source,W6G,GetSpellTargetUnit(),GWG,Caster)
        call RemoveSavedHandle(hashtable019,(Cache),(395))
      elseif IsDead(WLG)==false then
        call WAG(Source,WLG,GetSpellTargetUnit(),GWG,Caster)
        call RemoveSavedHandle(hashtable019,(Cache),(396))
        
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1Z2',false)
        if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A1YX' then
          call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1YX',true)
        endif
        
        call FlushChildHashtable(hashtable019,(Cache))
        call CleanTrigger(t)
      endif
    elseif GetSpellAbilityId()=='A1RK' then
      if WCG!=null and IsDead(WCG)==false then
        call WAG(Source,WCG,Source,GWG,Caster)
      endif
      if W3G!=null and IsDead(W3G)==false then
        call WAG(Source,W3G,Source,GWG,Caster)
      endif
      if W6G!=null and IsDead(W6G)==false then
        call WAG(Source,W6G,Source,GWG,Caster)
      endif
      if WLG!=null and IsDead(WLG)==false then
        call WAG(Source,WLG,Source,GWG,Caster)
      endif
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1Z2',false)
      if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A1YX' then
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1YX',true)
      endif
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    set Count=Count+1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    if WCG!=null and IsDead(WCG)==false then
      set offset=360*4/ 4.
      set a2=offset+rate*Count
      set x=SafeX50(SourceX+200*Cos(a2*bj_DEGTORAD))
      set y=SafeY50(SourceY+200*Sin(a2*bj_DEGTORAD))
      call SetUnitFacing(WCG,a2-90)
      call SetUnitX(WCG,x)
      call SetUnitY(WCG,y)
    endif
    if W3G!=null and IsDead(W3G)==false then
      set offset=360*3/ 4.
      set a2=offset+rate*Count
      set x=SafeX50(SourceX+200*Cos(a2*bj_DEGTORAD))
      set y=SafeY50(SourceY+200*Sin(a2*bj_DEGTORAD))
      call SetUnitFacing(W3G,a2-90)
      call SetUnitX(W3G,x)
      call SetUnitY(W3G,y)
    endif
    if W6G!=null and IsDead(W6G)==false then
      set offset=360*2/ 4.
      set a2=offset+rate*Count
      set x=SafeX50(SourceX+200*Cos(a2*bj_DEGTORAD))
      set y=SafeY50(SourceY+200*Sin(a2*bj_DEGTORAD))
      call SetUnitFacing(W6G,a2-90)
      call SetUnitX(W6G,x)
      call SetUnitY(W6G,y)
    endif
    if WLG!=null and IsDead(WLG)==false then
      set offset=360*1/ 4.
      set a2=offset+rate*Count
      set x=SafeX50(SourceX+200*Cos(a2*bj_DEGTORAD))
      set y=SafeY50(SourceY+200*Sin(a2*bj_DEGTORAD))
      call SetUnitFacing(WLG,a2-90)
      call SetUnitX(WLG,x)
      call SetUnitY(WLG,y)
    endif
    if Count>800 or GetTriggerEventId()==EVENT_UNIT_DEATH then
      if WCG!=null and IsDead(WCG)==false then
        call WAG(Source,WCG,Source,GWG,Caster)
      endif
      if W3G!=null and IsDead(W3G)==false then
        call WAG(Source,W3G,Source,GWG,Caster)
      endif
      if W6G!=null and IsDead(W6G)==false then
        call WAG(Source,W6G,Source,GWG,Caster)
      endif
      if WLG!=null and IsDead(WLG)==false then
        call WAG(Source,WLG,Source,GWG,Caster)
      endif
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1Z2',false)
      if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A1YX' then
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1YX',true)
      endif
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    else
      call SaveReal(hashtable019,(Cache),(685),RMinBJ(.25+.75*(I2R(Count)/ 500.),1))
      if Count==625 then
        call BY8(sound040,GetOwningPlayer(Source))
      endif
      if Count>600 then
        if ModuloInteger(Count,10)==0 or ModuloInteger(Count,10)==1 or ModuloInteger(Count,10)==2 or ModuloInteger(Count,10)==3 or ModuloInteger(Count,10)==4 then
          call SetUnitVertexColor(WCG,255,0,0,255)
          call SetUnitVertexColor(W3G,255,0,0,255)
          call SetUnitVertexColor(W6G,255,0,0,255)
          call SetUnitVertexColor(WLG,255,0,0,255)
        else
          call SetUnitVertexColor(WCG,255,255,255,255)
          call SetUnitVertexColor(W3G,255,255,255,255)
          call SetUnitVertexColor(W6G,255,255,255,255)
          call SetUnitVertexColor(WLG,255,255,255,255)
        endif
      endif
    endif
  endif
  set t=null
  set Source=null
  set WCG=null
  set W3G=null
  set W6G=null
  set WLG=null
  set g=null
  set g2=null
  set Caster=null
  return false
endfunction

function Phoenix_FireSpirits takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real x
  local real y
  local unit WCG
  local unit W3G
  local unit W6G
  local unit WLG
  local real a=GetUnitFacing(Source)
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',SourceX,SourceY,0)
  call UnitAddAbility(Caster,'A21U')
  call SetWidgetLife(Source,GetWidgetLife(Source)-GetWidgetLife(Source)*.15)
  call UnitAddAbility2(Source,'A1Z2')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1Z2',true)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1YX',false)
  set x=GetUnitX(Source)+200*Cos(bj_DEGTORAD*360*4/ 4.*-1.)
  set y=GetUnitY(Source)+200*Sin(bj_DEGTORAD*360*4/ 4.*-1.)
  set WCG=CreateUnit(GetOwningPlayer(Source),'h0CU',x,y,360*4/ 4.*-1.)
  set x=GetUnitX(Source)+200*Cos(bj_DEGTORAD*360*3/ 4.*-1.)
  set y=GetUnitY(Source)+200*Sin(bj_DEGTORAD*360*3/ 4.*-1.)
  set W3G=CreateUnit(GetOwningPlayer(Source),'h0CU',x,y,360*3/ 4.*-1.)
  set x=GetUnitX(Source)+200*Cos(bj_DEGTORAD*360*2/ 4.*-1.)
  set y=GetUnitY(Source)+200*Sin(bj_DEGTORAD*360*2/ 4.*-1.)
  set W6G=CreateUnit(GetOwningPlayer(Source),'h0CU',x,y,360*2/ 4.*-1.)
  set x=GetUnitX(Source)+200*Cos(bj_DEGTORAD*360*1/ 4.*-1.)
  set y=GetUnitY(Source)+200*Sin(bj_DEGTORAD*360*1/ 4.*-1.)
  set WLG=CreateUnit(GetOwningPlayer(Source),'h0CU',x,y,360*1/ 4.*-1.)
  call SetUnitScale(WCG,2.25,2.25,2.25)
  call SetUnitScale(W3G,2.25,2.25,2.25)
  call SetUnitScale(W6G,2.25,2.25,2.25)
  call SetUnitScale(WLG,2.25,2.25,2.25)
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function WBG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(393),(WCG))
  call SaveUnitHandle(hashtable019,(Cache),(394),(W3G))
  call SaveUnitHandle(hashtable019,(Cache),(395),(W6G))
  call SaveUnitHandle(hashtable019,(Cache),(396),(WLG))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  set t=null
  set Source=null
  set WCG=null
  set W3G=null
  set W6G=null
  set WLG=null
  set Caster=null
endfunction

function W5G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Count=(LoadInteger(hashtable019,(GetHandleId(Target)),(627)))
  local real W2G=(LoadReal(hashtable019,(GetHandleId(Target)),(628)))
  local integer Level=GetUnitAbilityLevel(Source,'A1S4')
  local real Damage=(5+Level*15)*Pow(2,IMinBJ(Count,5)-1)
  set Damage=Damage+IMaxBJ(Count-5,0)*50
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    //		if IsUnitType(Target,UNIT_TYPE_HERO) then
    //			call KillUnit((LoadUnitHandle(HY,(Cache),(45))))
    //		endif
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call SaveInteger(hashtable019,(GetHandleId(Target)),(627),(0))
    call SaveReal(hashtable019,(GetHandleId(Target)),(628),((0)*1.))
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if GetSpellAbilityId()=='A1S9' then
      //			if IsUnitType(Target,UNIT_TYPE_HERO) then
      //				call KillUnit((LoadUnitHandle(HY,(Cache),(45))))
      //			endif
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call SaveInteger(hashtable019,(GetHandleId(Target)),(627),(0))
      call SaveReal(hashtable019,(GetHandleId(Target)),(628),((0)*1.))
      if((LoadInteger(hashtable019,(GetHandleId((Target))),((4293))))==1)then
        call SetUnitInvulnerable(Target,false)
      endif
      call DamageTarget(Source,Target,1,Damage)
      if((LoadInteger(hashtable019,(GetHandleId((Target))),((4293))))==1)then
        call SetUnitInvulnerable(Target,true)
      endif
      call TextTagOnUnit(I2S(R2I(Damage))+"!",2,Target,.025,100,0,200,216)
    endif
  elseif(TimerGetElapsed(GlobalTimer))>W2G then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    //		if IsUnitType(Target,UNIT_TYPE_HERO) then
    //			call KillUnit((LoadUnitHandle(HY,(Cache),(45))))
    //		endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call SaveInteger(hashtable019,(GetHandleId(Target)),(627),(0))
    call SaveReal(hashtable019,(GetHandleId(Target)),(628),((0)*1.))
    if((LoadInteger(hashtable019,(GetHandleId((Target))),((4293))))==1)then
      call SetUnitInvulnerable(Target,false)
    endif
    call DamageTarget(Source,Target,1,Damage)
    if((LoadInteger(hashtable019,(GetHandleId((Target))),((4293))))==1)then
      call SetUnitInvulnerable(Target,true)
    endif
    call TextTagOnUnit(I2S(R2I(Damage))+"!",2,Target,.025,100,0,200,216)
  else
    //		if IsUnitType(Target,UNIT_TYPE_HERO) then
    //			call SetUnitX((LoadUnitHandle(HY,(Cache),(45))),GetUnitX(Target))
    //			call SetUnitY((LoadUnitHandle(HY,(Cache),(45))),GetUnitY(Target))
    //		endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function X4G takes unit Source,unit Target returns nothing
  local trigger t
  local integer Cache
  local integer Level=GetUnitAbilityLevel(Source,'A1S4')
  local unit Projectile
  if(LoadInteger(hashtable019,(GetHandleId(Target)),(627)))>0 then
    call SaveInteger(hashtable019,(GetHandleId(Target)),(627),((LoadInteger(hashtable019,(GetHandleId(Target)),(627)))+1))
    call SaveReal(hashtable019,(GetHandleId(Target)),(628),(((TimerGetElapsed(GlobalTimer))+10)*1.))
  else
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    //		if IsUnitType(Target,UNIT_TYPE_HERO) then
    //			set Projectile=CreateUnit(GetOwningPlayer(Source),'o019',GetUnitX(Target),GetUnitY(Target),0)
    //			call SaveUnitHandle(HY,(Cache),(45),(Projectile))
    //		endif
    call SaveInteger(hashtable019,(GetHandleId(Target)),(627),(1))
    if IsUnitType(Target,UNIT_TYPE_HERO) then
      call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\shamanyouranus-ShadowyMissile.mdl",Target,"chest")))
    else
      call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\shamanyouranus-ShadowyMissile.mdl",Target,"origin")))
    endif
    call SaveReal(hashtable019,(GetHandleId(Target)),(628),(((TimerGetElapsed(GlobalTimer))+10)*1.))
    call TriggerRegisterTimerEvent(t,.05,true)
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function W5G))
    set Projectile=null
  endif
  call TextTagOnUnit("+"+I2S((LoadInteger(hashtable019,(GetHandleId(Target)),(627)))),3,Target,.025,100,0,200,216)
  call DamageTarget(Source,Target,1,50)
  set t=null
endfunction

function X7G takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),ND8)==false then
    call GroupAddUnit(ND8,GetEnumUnit())
    call X4G(N98,GetEnumUnit())
  endif
endfunction

function X8G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local integer Count=GetTriggerEvalCount(t)
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local real x=SafeX50(GetUnitX(Projectile)+(20)*Cos(a))
  local real y=SafeY50(GetUnitY(Projectile)+(20)*Sin(a))
  local group g
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local unit Target
  if Count==75 then
    call KillGroup(HND)
    call KillUnit(Projectile)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set tt_unit1=Source
    set N98=Source
    set ND8=HND
    call SetUnitX(Projectile,x)
    call SetUnitY(Projectile,y)
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,215,Condition(function NonImmuneEnemyFilter))
    set Target=(LoadUnitHandle(hashtable019,(GetHandleId(Source)),(673)))
    if Target!=null then
      if DistanceBetweenXY(GetUnitX(Target),GetUnitY(Target),x,y)<215 and IsUnitEnemy(Target,GetOwningPlayer(Source)) then
        call GroupAddUnit(g,Target)
      endif
    endif
    call ForGroup(g,function X7G)
    set Target=FirstOfGroup(g)
    call KillGroup(g)
  endif
  set t=null
  set Source=null
  set Projectile=null
  set g=null
  set Target=null
  set HND=null
  return false
endfunction

function SD_ShadowPoison takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=AngleBetweenXY(GetUnitX(Source),GetUnitY(Source),x,y)*bj_DEGTORAD
  local unit Projectile=CreateUnit(GetOwningPlayer(Source),'h0C2',GetUnitX(Source),GetUnitY(Source),a*bj_RADTODEG)
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function X8G))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveGroupHandle(hashtable019,(Cache),(133),(GetAvailableGroup()))
  call UnitAddAbility2(Source,'A1S9')
  set t=null
  set Source=null
  set Projectile=null
endfunction

function unit135 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit XFG=GetSummonedUnit()
  if GetTriggerEventId()!=EVENT_PLAYER_UNIT_SUMMON then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetUnitAbilityLevel(XFG,'B0DA')>0 and GetOwningPlayer(GetSummoningUnit())==GetOwningPlayer(Source)then
    if IsUnitAlly(Target,GetOwningPlayer(Source)) then
      call SelectUnitAddForPlayer(XFG,GetOwningPlayer(Source))
    else
      call IssueTargetOrderById(XFG,851983,Target)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set XFG=null
  return false
endfunction

function unit137 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
  call SaveInteger(hashtable019,(GetHandleId((Target))),((4293)),(2))
  call SetUnitInvulnerable(Target,false)
  call PauseUnit(Target,false)
  call ShowUnit(Target,true)
  call RemoveSavedHandle(hashtable019,(GetHandleId(Target)),(673))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  if GetTriggerEventId()!=EVENT_UNIT_DEATH then
    call ClearSelectionForPlayer(GetOwningPlayer(Target))
    call SelectUnitAddForPlayer(Target,GetOwningPlayer(Target))
    call PlaySoundAtPos(sound035,GetUnitX(Target),GetUnitY(Target))
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,3,false)
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
    call TriggerAddCondition(t,Condition(function unit135))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call UnitAddAbility2(Caster,'A1S5')
    if IsUnitIllusion(Target) then
      call SaveUnitHandle(hashtable019,GetHandleId(Caster),'0ILU',LoadUnitHandle(hashtable019,GetHandleId(Target),'0ILU')) //Disruption source info (illu)
    else
      call SaveUnitHandle(hashtable019,GetHandleId(Caster),'0ILU',Target) //Disruption source info (real)
    endif
    call SetUnitAbilityLevel(Caster,'A1S5',GetUnitAbilityLevel(Source,'A1S8'))
    call IssueTargetOrderById(Caster,852274,Target)
    call IssueTargetOrderById(Caster,852274,Target)
  endif
  set t=null
  set Source=null
  set Caster=null
  set Target=null
  return false
endfunction

function unit134 takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A1S8')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'o019',GetUnitX(Target),GetUnitY(Target),0)
  call UnitApplyTimedLife(Caster,'BTLF',2.6)
  if IsUnitAlly(Target,GetOwningPlayer(Source))==false then
    set Caster=CreateUnit(GetOwningPlayer(Source),'o019',GetUnitX(Target),GetUnitY(Target),0)
    call UnitApplyTimedLife(Caster,'BTLF',2.6)
  endif
  call SetUnitInvulnerable(Target,true)
  call PauseUnit(Target,true)
  call ShowUnit(Target,false)
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffect("war3mapImported\\WILLTHEALMIGHTY-Void5.mdx",GetUnitX(Target),GetUnitY(Target))))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call TriggerRegisterTimerEvent(t,2.5,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function unit137))
  call SaveUnitHandle(hashtable019,(GetHandleId(Source)),(673),(Target))
  call SaveInteger(hashtable019,(GetHandleId((Target))),((4293)),(1))
  set Source=null
  set Target=null
  set t=null
  set Caster=null
endfunction

function unit132 takes nothing returns boolean
  if GetSpellAbilityId()=='A1S8' and GetSpellTargetUnit()!=GetTriggerUnit()and IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit())) and(LoadBoolean(hashtable019,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))then
    call InterruptUnit(GetTriggerUnit())
    call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n038'))
  endif
  return false
endfunction

function SD_Disruption takes nothing returns nothing
  if (IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit())) or IsBlocked(GetSpellTargetUnit())==false)then
    call unit134()
  endif
endfunction

function TL9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function unit132))
  set t=null
endfunction

function XJG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=GetUnitAbilityLevel(Source,'A1SB')
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetEventDamage()>5 and IsRealDamage then
    call DisableTrigger(t)
    call DamageTarget(GetEventDamageSource(),GetTriggerUnit(),3,(.1+.1*Level)*GetEventDamage())
    call EnableTrigger(t)
  endif
  set Source=null
  set t=null
  return false
endfunction

function SD_SoulCatcher takes nothing returns nothing
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local group g=GetAvailableGroup()
  local unit Source=GetTriggerUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A1SB')
  local unit Target
  local trigger t
  local integer Cache
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x,y,475,Condition(function NonImmuneEnemyFilter))
  set Target=(LoadUnitHandle(hashtable019,(GetHandleId(Source)),(673)))
  if Target!=null then
    if DistanceBetweenXY(GetUnitX(Target),GetUnitY(Target),x,y)<475 and IsUnitEnemy(Target,GetOwningPlayer(Source)) then
      call GroupAddUnit(g,Target)
    endif
  endif
  set Target=GroupPickRandomUnit(g)
  call KillGroup(g)
  call DestroyEffect(AddSpecialEffect("war3mapImported\\Desecrate.mdx",x,y))
  if Target!=null then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
    call TriggerRegisterTimerEvent(t,12,false)
    call TriggerAddCondition(t,Condition(function XJG))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\void.mdx",Target,"chest")))
  endif
  set g=null
  set Source=null
  set Target=null
  set t=null
endfunction

function XNG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Count=GetTriggerEvalCount(t)
  local integer Level=GetUnitAbilityLevel(Source,'A1SA')
  if Count==5 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if((LoadInteger(hashtable019,(GetHandleId((Target))),((4293))))==1)then
      call SetUnitInvulnerable(Target,false)
    endif
    call DamageTarget(Source,Target,1,4*(25+25*Level))
    if((LoadInteger(hashtable019,(GetHandleId((Target))),((4293))))==1)then
      call SetUnitInvulnerable(Target,true)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function unit142 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function XNG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call TriggerEvaluate(t)
  set t=null
  set Source=null
  set Target=null
endfunction

function SD_DemonicPurge takes nothing returns nothing
  if IsUnitEnemy(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit())) and IsBlocked(GetSpellTargetUnit())==false then
    call unit142()
  endif
endfunction

function unit144 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=GetTriggerEvalCount(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call UnitRemoveAbility(Source,'A1SP')
  set t=null
  set Source=null
  return false
endfunction

function Gyro_RocketBarrage takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call UnitAddAbility2(Source,'A1SP')
  call UnitMakeAbilityPermanent(Source,true,'A1SP')
  call SetUnitAbilityLevel(Source,'A1SP',GetUnitAbilityLevel(Source,'A1SO'))
  call TriggerRegisterTimerEvent(t,3,false)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function unit144))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=null
  set Source=null
endfunction

function XTG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Count=GetTriggerEvalCount(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real x
  local real y
  local real d
  local real DV9
  local real LastX=(LoadReal(hashtable019,(Cache),(23)))
  local real LastY=(LoadReal(hashtable019,(Cache),(24)))
  local real a=AngleBetweenXY(LastX,LastY,GetUnitX(Target),GetUnitY(Target))*bj_DEGTORAD
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call UnitShareVision(Projectile,GetOwningPlayer(Target),false)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if GetTriggerUnit()!=Projectile then
      call KillUnit(Projectile)
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    call UnitRemoveBuffs(Projectile,true,true)
  elseif Count<3/ .02 then
    call SetUnitFacing(Projectile,a*bj_RADTODEG)
  else
    if Count==4/ .02 then
      call UnitShareVision(Projectile,GetOwningPlayer(Target),true)
    endif
    call SetUnitFacing(Projectile,a*bj_RADTODEG)
    set x=LastX+(280+20*Count*.02)*.02*Cos(a)
    set y=LastY+(280+20*Count*.02)*.02*Sin(a)
    call SetUnitPosition(Projectile,x,y)
    call SaveReal(hashtable019,(Cache),(23),((x)*1.))
    call SaveReal(hashtable019,(Cache),(24),((y)*1.))
    if DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))<20 then
      set d=RMinBJ(DistanceBetweenXY(x,y,(LoadReal(hashtable019,(Cache),(6))),(LoadReal(hashtable019,(Cache),(7)))),1500)
      set x = GetUnitAbilityLevel(Source,'A1SQ')
      set DV9=d/ 1500*(110*x)
      set DV9=RMaxBJ(DV9,50)
      call KillUnit(Projectile)
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      if GenericCondition_IsDotAInvis(Target)==false or IsUnitVisibleLoD(Target,GetOwningPlayer(Source)) then
        call DamageTarget(Source,Target,1,DV9)
        call StunTarget(Source,Target,2 + .2*x)
      endif
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set Projectile=null
  return false
endfunction

function unit133 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real a=AngleBetweenXY(GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))*bj_DEGTORAD
  local real x=SafeX50(GetUnitX(Source)+150*Cos(a))
  local real y=SafeY50(GetUnitY(Source)+150*Sin(a))
  local integer Level=GetUnitAbilityLevel(Source,'A1SQ')
  local unit Projectile
  local integer W78
  local string s="effects\\Snipe Target.mdx"
  if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Source))==false and IsObserver(GetLocalPlayer())==false then
    set s=""
  endif
  if Level==1 then
    set W78='h0CG'
  elseif Level==2 then
    set W78='h0C1'
  elseif Level==3 then
    set W78='h0CF'
  elseif Level==4 then
    set W78='h0CH'
  endif
  set Projectile=CreateUnit(GetOwningPlayer(Source),W78,x,y,a*bj_RADTODEG)
  call UnitRemoveAbility(Projectile,'Amov')
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Projectile,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Projectile,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function XTG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Source))*1.))
  call SaveReal(hashtable019,(Cache),(23),((GetUnitX(Projectile))*1.))
  call SaveReal(hashtable019,(Cache),(24),((GetUnitY(Projectile))*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget(s,Target,"overhead")))
  set t=null
  set Source=null
  set Target=null
  set Projectile=null
endfunction

function Gyro_HomingMissile takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call unit133()
  endif
endfunction

function XWG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call UnitRemoveAbility(Target,'B0DE')
  call UnitRemoveAbility(Target,'A1SS')
  set t=null
  set Target=null
  return false
endfunction

function unit139 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call UnitRemoveAbility(Target,'B0DG')
  call UnitRemoveAbility(Target,'A1T4')
  set t=null
  set Target=null
  return false
endfunction

function XYG takes nothing returns nothing
  local trigger t
  local integer Cache
  local integer Level=GetUnitAbilityLevel(NF8,'A1T5')
  local boolean RIE=false
  if Level==0 then
    set Level=GetUnitAbilityLevel(NF8,'A235')
    set RIE=true
  endif
  if IsUnitBADWithSpellbooks(GetEnumUnit())==false then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,2,false)
    call TriggerRegisterUnitEvent(t,GetEnumUnit(),EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function XWG))
    call SaveUnitHandle(hashtable019,(Cache),(17),(GetEnumUnit()))
    call SetPlayerAbilityAvailable2(GetOwningPlayer(GetEnumUnit()),'A1SS',false)
    call UnitAddAbility2(GetEnumUnit(),'A1SS')
  endif
  call DamageTarget(NF8,GetEnumUnit(),1,Level*50+200)
  set t=null
endfunction

function XZG takes nothing returns nothing
  local trigger t
  local integer Cache
  local integer Level=GetUnitAbilityLevel(NF8,'A1T5')
  local boolean RIE=false
  if Level==0 then
    set Level=GetUnitAbilityLevel(NF8,'A235')
    set RIE=true
  endif
  if IsUnitBADWithSpellbooks(GetEnumUnit())==false then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,3,false)
    call TriggerRegisterUnitEvent(t,GetEnumUnit(),EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function unit139))
    call SaveUnitHandle(hashtable019,(Cache),(17),(GetEnumUnit()))
    call SetPlayerAbilityAvailable2(GetOwningPlayer(GetEnumUnit()),'A1T4',false)
    call UnitAddAbility2(GetEnumUnit(),'A1T4')
  endif
  if RIE then
    call DamageTarget(NF8,GetEnumUnit(),1,Level*50+50+75)
  else
    call DamageTarget(NF8,GetEnumUnit(),1,Level*50+50)
  endif
  set t=null
endfunction

function unit141 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local group g
  local integer Count=GetTriggerEvalCount(t)
  local fogmodifier Z58=(LoadFogModifierHandle(hashtable019,(Cache),(42)))
  if Count==1 then
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Calldown_FlyUp.mdx",Source,"chest"))
  elseif Count==2 then
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Calldown_FlyUp.mdx",Source,"chest"))
  elseif Count==3 then
    call DestroyEffect(AddSpecialEffect("war3mapImported\\Calldown_FlyDown.mdx",x,y))
  elseif Count==4 then
    set g=GetAvailableGroup()
    set tt_unit1=Source
    set NF8=Source
    call GroupEnumUnitsInRange(g,x,y,475,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function XYG)
    call KillGroup(g)
    call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl",x,y))
  elseif Count==5 then
    call DestroyEffect(AddSpecialEffect("war3mapImported\\Calldown_FlyDown.mdx",x,y))
  elseif Count==6 then
    set g=GetAvailableGroup()
    set tt_unit1=Source
    set NF8=Source
    call GroupEnumUnitsInRange(g,x,y,475,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function XZG)
    call KillGroup(g)
    call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl",x,y))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FogModifierStop(Z58)
    call DestroyFogModifier(Z58)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set g=null
  set Z58=null
  return false
endfunction

function Gyro_Calldown takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local string s=""
  local fogmodifier Z58=CreateFogModifierRadius(GetOwningPlayer(Source),FOG_OF_WAR_VISIBLE,x,y,350,true,true)
  call FogModifierStart(Z58)
  if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Source)) or IsObserver(GetLocalPlayer())then
    set s="war3mapImported\\CallDown_4.mdx"
  endif
  call TriggerRegisterTimerEvent(t,.1,false)
  call TriggerRegisterTimerEvent(t,.8,false)
  call TriggerRegisterTimerEvent(t,1.6,false)
  call TriggerRegisterTimerEvent(t,2,false)
  call TriggerRegisterTimerEvent(t,3.6,false)
  call TriggerRegisterTimerEvent(t,4,false)
  call TriggerAddCondition(t,Condition(function unit141))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffect(s,x,y)))
  call SaveFogModifierHandle(hashtable019,(Cache),(42),(Z58))
  set t=null
  set Source=null
  set Z58=null
endfunction

function unit147 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer JDF=(LoadInteger(hashtable019,(Cache),(375)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Count
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    if GetEventDamageSource()==Source and(GetEventDamage()>20 or IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)) and IsRealDamage then
      set Count=(LoadInteger(hashtable019,(JDF),(34)))
      if Count>0 then
        call SaveInteger(hashtable019,(JDF),(34),(Count+1))
      endif
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  return false
endfunction

function X6G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  if IsHexed(Source)==false then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call UnitRemoveAbility(Source,'A237')
    call UnitAddAbility(Source,'A22B')
    call UnitRemoveAbility(Source,'A22B')
    if(FindItemOfType((Source),Item_Real[indexid_AghanimGyro])!=null)then
      call UnitAddAbility(Source,'A237')
    endif
  endif
  set t=null
  set Source=null
  return false
endfunction

function XLG takes unit Source returns nothing
  local trigger t
  local integer Cache
  if IsHexed(Source)==false then
    call UnitRemoveAbility(Source,'A237')
    call UnitAddAbility(Source,'A22B')
    call UnitRemoveAbility(Source,'A22B')
    if(FindItemOfType((Source),Item_Real[indexid_AghanimGyro])!=null)then
      call UnitAddAbility(Source,'A237')
    endif
  else
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call TriggerRegisterTimerEvent(t,.1,true)
    call TriggerAddCondition(t,Condition(function X6G))
    set t=null
  endif
endfunction

function unit149 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local integer Level=GetUnitAbilityLevel(Source,'A229')
  local integer JDF=Cache
  if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
    if IsUnitIllusion(GetAttacker()) and GetUnitAbilityLevel(GetAttacker(),'A1TW')>0 then
      call XLG(GetAttacker())
      call UnitRemoveAbility(GetAttacker(),'A1TW')
    endif
    if GetAttacker()==Source then
      set Count=Count+1
      if Count>3+Level then
        call UnitRemoveAbility(Source,'A1TW')
        call UnitRemoveAbility(Source,'B0DJ')
        call XLG(Source)
        call FlushChildHashtable(hashtable019,(Cache))
        call CleanTrigger(t)
      else
        set t=CreateTrigger()
        set Cache=GetHandleId(t)
        call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
        call TriggerRegisterTimerEvent(t,2,false)
        call TriggerAddCondition(t,Condition(function unit147))
        call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
        call SaveInteger(hashtable019,(Cache),(375),(JDF))
      endif
    endif
  else
    call UnitRemoveAbility(Source,'A1TW')
    call UnitRemoveAbility(Source,'B0DJ')
    call XLG(Source)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  return false
endfunction

function Gyro_FlakCannon takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call UnitAddAbility(Source,'A1TW')
  call UnitMakeAbilityPermanent(Source,true,'A1TW')
  call TriggerRegisterTimerEvent(t,15,false)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function unit149))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(34),(1))
  call UnitRemoveAbility(Source,'A237')
  // call UnitAddAbility(Source,'A22A')
  // call UnitRemoveAbility(Source,'A22A')
  if(FindItemOfType((Source),Item_Real[indexid_AghanimGyro])!=null)then
    call UnitAddAbility(Source,'A237')
  endif
  set t=null
  set Source=null
endfunction

function unit148 takes nothing returns boolean
  if IsUnitIllusion(GetTriggerUnit()) then
    call XLG(GetTriggerUnit())
  endif
  return false
endfunction

function U79 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterEnterRectSimple(t,GetWorldBounds())
  call TriggerAddCondition(t,Condition(function unit148))
  set t=null
endfunction

function Y4G takes nothing returns boolean
  local unit Target=GetFilterUnit()
  local unit Source=NG8
  local real SourceX=NH8
  local real SourceY=NI8
  local real NHE=NJ8
  local real NIE=NK8
  local real x
  local real y
  local real a
  local real d
  if(IsMagicImmune(GetFilterUnit())==false and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))then
    set d=DistanceBetweenXY(SourceX,SourceY,GetUnitX(Target),GetUnitY(Target))
    set a=AngleBetweenXY(SourceX,SourceY,GetUnitX(Target),GetUnitY(Target))*bj_DEGTORAD
    if d>NM8 then
      set x=GetUnitX(Target)+11*Cos(a)
      set y=GetUnitY(Target)+11*Sin(a)
    else
      set x=GetUnitX(Target)-11*Cos(a)
      set y=GetUnitY(Target)-11*Sin(a)
    endif
    call SetUnitX(Target,x)
    call SetUnitY(Target,y)
  endif
  set Target=null
  set Source=null
  return false
endfunction

function Y7G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(6)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(7)))
  local real x
  local real y
  local integer i=0
  local group g
  if GetTriggerEvalCount(t)>(50*(2+.5*GetUnitAbilityLevel(Source,'A1SU')))then
    loop
      exitwhen i>16
      set i=i+1
    endloop
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set g=GetAvailableGroup()
    set NH8=SourceX
    set NI8=SourceY
    set NG8=Source
    set tt_unit1=Source
    loop
      exitwhen i>16
      set x=SourceX+NM8*Cos(bj_DEGTORAD*360.*i/ 16.)
      set y=SourceY+NM8*Sin(bj_DEGTORAD*360.*i/ 16.)
      set NJ8=x
      set NK8=y
      call GroupEnumUnitsInRange(g,x,y,75,Condition(function Y4G))
      set i=i+1
    endloop
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Source=null
  return false
endfunction

function Y8G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(6)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(7)))
  local real x
  local real y
  local integer i=0
  call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  loop
    exitwhen i>16
    set x=SourceX+NM8*Cos(bj_DEGTORAD*360.*i/ 16.)
    set y=SourceY+NM8*Sin(bj_DEGTORAD*360.*i/ 16.)
    set i=i+1
  endloop
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffect("war3mapImported\\KineticField_FX_Stand.mdx",SourceX,SourceY)))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(7),((SourceY)*1.))
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function Y7G))
  set t=null
  set Source=null
  return false
endfunction

function Disruptor_KineticField takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real SourceX=GetSpellTargetX()
  local real SourceY=GetSpellTargetY()
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffect("war3mapImported\\KineticField_FX_Start.mdx",SourceX,SourceY)))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((SourceX)*1.))
  call SaveReal(hashtable019,(Cache),(7),((SourceY)*1.))
  call TriggerRegisterTimerEvent(t,1.2,false)
  call TriggerAddCondition(t,Condition(function Y8G))
  call TimedReveal(GetOwningPlayer(Source),5.5,SourceX,SourceY,325)
  set t=null
  set Source=null
endfunction

function YEG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(6)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(7)))
  local real x=GetUnitX(Projectile)
  local real y=GetUnitY(Projectile)
  local real a=AngleBetweenXY(x,y,TargetX,TargetY)
  local real d=DistanceBetweenXY(x,y,TargetX,TargetY)
  local real r=(LoadReal(hashtable019,(Cache),(671)))
  call SetUnitFacing(Projectile,a)
  set x=x+r*Cos(a*bj_DEGTORAD)
  set y=y+r*Sin(a*bj_DEGTORAD)
  call SetUnitX(Projectile,x)
  call SetUnitY(Projectile,y)
  if d<40 then
    call KillUnit(Projectile)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call AddTimedKeyToUnit(Target,4411,1)
    call SetUnitPosition(Target,TargetX,TargetY)
    call PanCameraToTimedForPlayer(GetOwningPlayer(Target),TargetX,TargetY,0)
  elseif IsMagicImmune(Target)then
    call KillUnit(Projectile)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Target=null
  set Projectile=null
  return false
endfunction

function YFG takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local real x=(LoadReal(hashtable019,(GetHandleId(Target)),(7400)))
  local real y=(LoadReal(hashtable019,(GetHandleId(Target)),(7500)))
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Projectile=CreateUnit(GetOwningPlayer(Source),'h0C6',GetUnitX(Target),GetUnitY(Target),0)
  local real d=DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))
  local real r=.02*(RMaxBJ(d/ 1.8,600))
  call TriggerAddCondition(t,Condition(function YEG))
  call TriggerRegisterTimerEvent(t,.02,true)
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveReal(hashtable019,(Cache),(671),((r)*1.))
  call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("effects\\Lightning_Ball_Tail_FX.mdx",Target,"overhead")))
  call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffect("effects\\Lightning_Ball_Tail_FX.mdx",x,y)))
  call TriggerEvaluate(t)
  set Source=null
  set Target=null
  set Projectile=null
  set t=null
endfunction

function Disruptor_Glimpse takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    if IsUnitIllusion(GetSpellTargetUnit())then
      call KillUnit(GetSpellTargetUnit())
    else
      call YFG()
    endif
  endif
endfunction

function YHG takes nothing returns nothing
  local unit Target=GetEnumUnit()
  local integer Cache=GetHandleId(Target)
  local integer i=1
  loop
    exitwhen i>14
    call SaveReal(hashtable019,Cache,7400+i-1,LoadReal(hashtable019,Cache,7400+i)*1.)
    call SaveReal(hashtable019,Cache,7500+i-1,LoadReal(hashtable019,Cache,7500+i)*1.)
    set i=i+1
  endloop
  call SaveReal(hashtable019,Cache,7400+14,GetUnitX(Target)*1.)
  call SaveReal(hashtable019,Cache,7500+14,GetUnitY(Target)*1.)
  set Target=null
endfunction

function YIG takes nothing returns boolean
  local group g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,0,0,99999,Condition(function DI9))
  call ForGroup(g,function YHG)
  call KillGroup(g)
  set g=null
  return false
endfunction

function UD9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerAddCondition(t,Condition(function YIG))
  set t=null
endfunction

function Disruptor_ThunderStrike_Damage takes nothing returns nothing
  if NN8!=GetEnumUnit() then
    call DamageTarget(NO8,GetEnumUnit(),1,NP8*20+20)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",GetEnumUnit(),"chest"))
  endif
endfunction

function Disruptor_ThunderStrike_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=LoadUnitHandle(hashtable019,Cache,2)
  local unit Target=LoadUnitHandle(hashtable019,Cache,17)
  local unit Caster=LoadUnitHandle(hashtable019,Cache,19)
  local integer Level=LoadInteger(hashtable019,Cache,5)
  local group g
  local integer Count=GetTriggerEvalCount(t)
  local unit d=null
  call SetUnitX(Caster,GetUnitX(Target))
  call SetUnitY(Caster,GetUnitY(Target))
  if Count==1 or Count==100 or Count==200 or Count==300 then
    set g=GetAvailableGroup()
    if IsDead(Target)then
      set d=CreateUnit(GetOwningPlayer(Target),'e00C',GetUnitX(Target),GetUnitY(Target),0)
      call UnitApplyTimedLife(d,'BTLF',.2)
      call IssueTargetOrderById(Caster,852119,d)
      set d=null
    else
      call IssueTargetOrderById(Caster,852119,Target)
      call DamageTarget(Source,Target,1,Level*20+20)
    endif
    call Z48("war3mapImported\\ThunderStorm_Groundeffect.mdx",Target,"origin",.6)
    set tt_unit1=Source
    set NO8=Source
    set NN8=Target
    set NP8=Level
    call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),265,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function Disruptor_ThunderStrike_Damage)
    call KillGroup(g)
    //call BJDebugMsg(I2S(Count))
    set g=null
    if GetTriggerEvalCount(t)==300 then
      call KillUnit(Caster)
      call FlushChildHashtable(hashtable019,Cache)
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set Caster=null
  return false
endfunction

function Disruptor_ThunderStrike_Start takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A1TV')
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e02P',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility2(Caster,'A1U7')
  call SetUnitAbilityLevel(Caster,'A1U7',Level)
  call UnitAddAbility2(Caster,'Aloc')
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function Disruptor_ThunderStrike_Duration))
  call SaveUnitHandle(hashtable019,Cache,2,Source)
  call SaveUnitHandle(hashtable019,Cache,17,Target)
  call SaveUnitHandle(hashtable019,Cache,19,Caster)
  call SaveInteger(hashtable019,Cache,5,Level)
  set Source=null
  set Target=null
  set Caster=null
  set t=null
endfunction

function Disruptor_ThunderStrike_StartSup takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call Disruptor_ThunderStrike_Start()
  endif
endfunction

function Disruptor_StaticStormClear takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local unit u=LoadUnitHandle(hashtable019,GetHandleId(t),0)
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    if GetUnitAbilityLevel(u,'QINV')>0 then
      call UnitRemoveAbility(u,'QINV')
    endif
    call FlushChildHashtable(hashtable019,GetHandleId(t))
    call CleanTrigger(t)
  else
    if GetUnitAbilityLevel(u,'B0DL')==0 then
      if GetUnitAbilityLevel(u,'QINV')>0 then
        call UnitRemoveAbility(u,'QINV')
      endif
      call FlushChildHashtable(hashtable019,GetHandleId(t))
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set u=null
endfunction

function Disruptor_StaticStormSilenceItems takes unit u returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call UnitAddAbility2(u,'QINV')
  call SetPlayerAbilityAvailable(GetOwningPlayer(u),'QINV',false)
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Disruptor_StaticStormClear))
  call SaveUnitHandle(hashtable019,h,0,u)
  
  set t=null
endfunction

function YOG takes nothing returns nothing
  call DamageTarget(NR8,GetEnumUnit(),1,NQ8)
  call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Purge_NoBirth.mdx",GetEnumUnit(),"origin"))
  if NS8 and GetUnitAbilityLevel(GetEnumUnit(),'QINV')==0 and GetUnitAbilityLevel(GetEnumUnit(),'AInv')>0 and IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO)==true then
    call Disruptor_StaticStormSilenceItems(GetEnumUnit())
  endif
endfunction

function YPG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local group g
  local integer Count=GetTriggerEvalCount(t)
  local boolean isAgh=LoadBoolean(hashtable019,Cache,0)
  local integer limit=20
  if isAgh then
    set limit=28
  endif
  if Count>limit then
    call StopSound(sound036,false,true)
    call KillUnit(Projectile)
    call ShowUnit(Projectile,false)
    call KillUnit(Caster)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set g=GetAvailableGroup()
    set tt_unit1=Source
    set NR8=Source
    set NQ8=.25*(150+50*Level)*(Count/ 20.)
    set NS8=isAgh
    call GroupEnumUnitsInRange(g,GetUnitX(Projectile),GetUnitY(Projectile),475,Condition(function LA8))
    call ForGroup(g,function YOG)
    
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Source=null
  set Projectile=null
  set Caster=null
  return false
endfunction

function Disruptor_StaticField takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real TargetX=GetSpellTargetX()
  local real TargetY=GetSpellTargetY()
  local unit Projectile=CreateUnit(GetOwningPlayer(Source),'h0CK',TargetX,TargetY,0)
  local integer Level=IMaxIF(GetUnitAbilityLevel(Source,'A1U6'),GetUnitAbilityLevel(Source,'A30N'))
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',TargetX,TargetY,0)
  call SetSoundVolume(sound036,200)
  call StartSound(sound036)
  call SetSoundPosition(sound036,TargetX,TargetY,100)
  if IsScourge(GetOwningPlayer(Source))then
    call UnitAddAbility2(Caster,'A1U5')
    if GetSpellAbilityId()=='A30N' then
      call SetUnitAbilityLevel(Caster,'A1U5',2)
    endif
  else
    call UnitAddAbility2(Caster,'A1U4')
    if GetSpellAbilityId()=='A30N' then
      call SetUnitAbilityLevel(Caster,'A1U4',2)
    endif
  endif
  call IssuePointOrderById(Caster,852473,TargetX,TargetY)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveBoolean(hashtable019,Cache,0,GetSpellAbilityId()=='A30N')
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerAddCondition(t,Condition(function YPG))
  set t=null
  set Source=null
  set Caster=null
  set Projectile=null
endfunction

function YSG takes nothing returns nothing
  local integer YTG=NY8
  local unit Target=GetEnumUnit()
  local integer YUG=662-1+YTG
  local real YVG=(LoadReal(hashtable019,(GetHandleId(Target)),(YUG)))
  local real UK8=(TimerGetElapsed(GlobalTimer))
  if YVG<UK8 then
    call SaveReal(hashtable019,(GetHandleId(Target)),(YUG),((UK8+2)*1.))
    if IsUnitType(GetEnumUnit(),UNIT_TYPE_STRUCTURE)==false then
      call DamageTarget(NT8,Target,1,2+6*NX8)
    endif
  endif
  set Target=null
endfunction

function Spirits_DamageHeroes takes nothing returns nothing
  local integer YTG=NY8
  local unit Target=GetEnumUnit()
  local integer YUG=662-1+YTG
  local real YVG=(LoadReal(hashtable019,(GetHandleId(Target)),(YUG)))
  local real UK8=(TimerGetElapsed(GlobalTimer))
  if YVG<UK8 then
    call SaveReal(hashtable019,(GetHandleId(Target)),(YUG),((UK8+2)*1.))
    if IsUnitType(GetEnumUnit(),UNIT_TYPE_STRUCTURE)==false then
      call DamageTarget(NT8,Target,1,15+10*NX8)
    endif
  endif
  set Target=null
endfunction

function YWG takes nothing returns nothing
  if IsUnitType(GetEnumUnit(),UNIT_TYPE_STRUCTURE)==false then
    call DamageTarget(NT8,GetEnumUnit(),1,NV8)
  endif
endfunction

function YXG takes unit Source,unit YYG returns nothing
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  set NV8=25*NX8
  set NT8=Source
  set NU8=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(YYG),GetUnitY(YYG),0)
  call GroupEnumUnitsInRange(g,GetUnitX(YYG),GetUnitY(YYG),325,Condition(function L38))
  call UnitAddAbility2(NU8,'A1TO')
  call ForGroup(g,function YWG)
  call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl",GetUnitX(YYG),GetUnitY(YYG)))
  call KillUnit(YYG)
  call KillGroup(g)
  call UnitApplyTimedLife(CreateUnit(GetOwningPlayer(Source),'o00Q',GetUnitX(YYG),GetUnitY(YYG),0),'BTLF',2)
  set g=null
endfunction

function YZG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit U01=(LoadUnitHandle(hashtable019,(Cache),(393)))
  local unit U02=(LoadUnitHandle(hashtable019,(Cache),(394)))
  local unit U03=(LoadUnitHandle(hashtable019,(Cache),(395)))
  local unit U04=(LoadUnitHandle(hashtable019,(Cache),(396)))
  local unit U05=(LoadUnitHandle(hashtable019,(Cache),(397)))
  local real x
  local real y
  local real a
  local real d=(LoadReal(hashtable019,(Cache),(138)))
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real rate
  local integer Count=GetTriggerEvalCount(t)
  local real offset
  local group g
  local integer StillAlive=0
  local real time=2.25
  local real CurrentAngle
  if IsDead(U01)==false then
    set StillAlive=StillAlive+1
  endif
  if IsDead(U02)==false then
    set StillAlive=StillAlive+1
  endif
  if IsDead(U03)==false then
    set StillAlive=StillAlive+1
  endif
  if IsDead(U04)==false then
    set StillAlive=StillAlive+1
  endif
  if IsDead(U05)==false then
    set StillAlive=StillAlive+1
  endif
  if StillAlive==5 then
    set time=2.25
  elseif StillAlive==4 then
    set time=2.1
  elseif StillAlive==3 then
    set time=1.95
  elseif StillAlive==2 then
    set time=1.8
  elseif StillAlive==1 then
    set time=1.65
  endif
  set rate=-1*360*.02/ time
  set CurrentAngle=(LoadReal(hashtable019,(Cache),(137)))+rate
  call SaveReal(hashtable019,(Cache),(137),((CurrentAngle)*1.))
  set NX8=GetUnitAbilityLevel(Source,'A1T8')
  set NT8=Source
  if Count==50 then
    call ShowUnit(U02,true)
    call SaveBoolean(hashtable019,(Cache),(512),(true))
    call UnitAddAbility2(U02,'Aloc')
  endif
  if Count==100 then
    call ShowUnit(U03,true)
    call SaveBoolean(hashtable019,(Cache),(513),(true))
    call UnitAddAbility2(U03,'Aloc')
  endif
  if Count==150 then
    call ShowUnit(U04,true)
    call SaveBoolean(hashtable019,(Cache),(514),(true))
    call UnitAddAbility2(U04,'Aloc')
  endif
  if Count==200 then
    call ShowUnit(U05,true)
    call SaveBoolean(hashtable019,(Cache),(515),(true))
    call UnitAddAbility2(U05,'Aloc')
  endif
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if GetSpellAbilityId()=='A24A' then
      if(LoadBoolean(hashtable019,(Cache),(655))) then
        call SaveBoolean(hashtable019,(Cache),(655),(false))
        call SaveBoolean(hashtable019,(Cache),(656),(false))
      else
        call SaveBoolean(hashtable019,(Cache),(655),(true))
        call SaveBoolean(hashtable019,(Cache),(656),(false))
      endif
    elseif GetSpellAbilityId()=='A24B' then
      if(LoadBoolean(hashtable019,(Cache),(656))) then
        call SaveBoolean(hashtable019,(Cache),(655),(false))
        call SaveBoolean(hashtable019,(Cache),(656),(false))
      else
        call SaveBoolean(hashtable019,(Cache),(655),(false))
        call SaveBoolean(hashtable019,(Cache),(656),(true))
      endif
    endif
  endif
  if(LoadBoolean(hashtable019,(Cache),(655)))then
    set d=RMaxBJ(d-5,100)
    call SaveReal(hashtable019,(Cache),(138),((d)*1.))
  elseif(LoadBoolean(hashtable019,(Cache),(656)))then
    set d=RMinBJ(d+5,875)
    call SaveReal(hashtable019,(Cache),(138),((d)*1.))
  endif
  if GetTriggerEventId()==EVENT_UNIT_DEATH or Count==950 or(IsDead(U01)and IsDead(U02)and IsDead(U03)and IsDead(U04)and IsDead(U05))or(Count>1 and GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A1T8')then
    if GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT then
      call UnitRemoveAbility(Source,'A24A')
      call UnitRemoveAbility(Source,'A24B')
    endif
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if IsDead(U01)==false then
      call YXG(Source,U01)
    endif
    if IsDead(U02)==false then
      call YXG(Source,U02)
    endif
    if IsDead(U03)==false then
      call YXG(Source,U03)
    endif
    if IsDead(U04)==false then
      call YXG(Source,U04)
    endif
    if IsDead(U05)==false then
      call YXG(Source,U05)
    endif
  else
    set g=GetAvailableGroup()
    if IsDead(U01)==false and(LoadBoolean(hashtable019,(Cache),(511)))then
      set offset=360*5/ 5.
      set a=offset+CurrentAngle
      set x=SafeX50(SourceX+d*Cos(a*bj_DEGTORAD))
      set y=SafeY50(SourceY+d*Sin(a*bj_DEGTORAD))
      call SetUnitX(U01,x)
      call SetUnitY(U01,y)
      set tt_unit1=Source
      call GroupEnumUnitsInRange(g,x,y,95,Condition(function DF9))
      if FirstOfGroup(g)!=null then
        call YXG(Source,U01)
      endif
      call GroupClear(g)
      set NW8=U01
      set NY8=1
      set NT8=Source
      call GroupEnumUnitsInRange(g,x,y,175,Condition(function LC8))
      call ForGroup(g,function YSG)
      call GroupClear(g)
    endif
    if IsDead(U02)==false and(LoadBoolean(hashtable019,(Cache),(512)))then
      set offset=360*4/ 5.
      set a=offset+CurrentAngle
      set x=SafeX50(SourceX+d*Cos(a*bj_DEGTORAD))
      set y=SafeY50(SourceY+d*Sin(a*bj_DEGTORAD))
      call SetUnitX(U02,x)
      call SetUnitY(U02,y)
      set tt_unit1=Source
      call GroupEnumUnitsInRange(g,x,y,95,Condition(function DF9))
      if FirstOfGroup(g)!=null then
        call YXG(Source,U02)
      endif
      call GroupClear(g)
      set NW8=U02
      set NY8=2
      set NT8=Source
      call GroupEnumUnitsInRange(g,x,y,175,Condition(function LC8))
      call ForGroup(g,function YSG)
      call GroupClear(g)
    endif
    if IsDead(U03)==false and(LoadBoolean(hashtable019,(Cache),(513)))then
      set offset=360*3/ 5.
      set a=offset+CurrentAngle
      set x=SafeX50(SourceX+d*Cos(a*bj_DEGTORAD))
      set y=SafeY50(SourceY+d*Sin(a*bj_DEGTORAD))
      call SetUnitX(U03,x)
      call SetUnitY(U03,y)
      set tt_unit1=Source
      call GroupEnumUnitsInRange(g,x,y,95,Condition(function DF9))
      if FirstOfGroup(g)!=null then
        call YXG(Source,U03)
      endif
      call GroupClear(g)
      set NW8=U03
      set NY8=3
      set NT8=Source
      call GroupEnumUnitsInRange(g,x,y,175,Condition(function LC8))
      call ForGroup(g,function YSG)
      call GroupClear(g)
    endif
    if IsDead(U04)==false and(LoadBoolean(hashtable019,(Cache),(514)))then
      set offset=360*2/ 5.
      set a=offset+CurrentAngle
      set x=SafeX50(SourceX+d*Cos(a*bj_DEGTORAD))
      set y=SafeY50(SourceY+d*Sin(a*bj_DEGTORAD))
      call SetUnitX(U04,x)
      call SetUnitY(U04,y)
      set tt_unit1=Source
      call GroupEnumUnitsInRange(g,x,y,95,Condition(function DF9))
      if FirstOfGroup(g)!=null then
        call YXG(Source,U04)
      endif
      call GroupClear(g)
      set NW8=U04
      set NY8=4
      set NT8=Source
      call GroupEnumUnitsInRange(g,x,y,175,Condition(function LC8))
      call ForGroup(g,function YSG)
      call GroupClear(g)
    endif
    if IsDead(U05)==false and(LoadBoolean(hashtable019,(Cache),(515)))then
      set offset=360*1/ 5.
      set a=offset+CurrentAngle
      set x=SafeX50(SourceX+d*Cos(a*bj_DEGTORAD))
      set y=SafeY50(SourceY+d*Sin(a*bj_DEGTORAD))
      call SetUnitX(U05,x)
      call SetUnitY(U05,y)
      set tt_unit1=Source
      call GroupEnumUnitsInRange(g,x,y,95,Condition(function DF9))
      if FirstOfGroup(g)!=null then
        call YXG(Source,U05)
      endif
      call GroupClear(g)
      set NW8=U05
      set NY8=5
      set NT8=Source
      call GroupEnumUnitsInRange(g,x,y,175,Condition(function LC8))
      call ForGroup(g,function YSG)
      call GroupClear(g)
    endif
    call KillGroup(g)
  endif
  set t=null
  set Source=null
  set U01=null
  set U02=null
  set U03=null
  set U04=null
  set U05=null
  set g=null
  return false
endfunction

function Wisp_Spirits takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit U01
  local unit U02
  local unit U03
  local unit U04
  local unit U05
  local real x
  local real y
  set x=GetUnitX(Source)+250*Cos(bj_DEGTORAD*360*5/ 5.*-1.)
  set y=GetUnitY(Source)+250*Sin(bj_DEGTORAD*360*5/ 5.*-1.)
  set U01=CreateUnit(GetOwningPlayer(Source),'h0CJ',x,y,360*5/ 5.*-1.)
  call UnitAddAbility2(U01,'Aloc')
  set x=GetUnitX(Source)+250*Cos(bj_DEGTORAD*360*4/ 5.*-1.)
  set y=GetUnitY(Source)+250*Sin(bj_DEGTORAD*360*4/ 5.*-1.)
  set U02=CreateUnit(GetOwningPlayer(Source),'h0CJ',x,y,360*4/ 5.*-1.)
  call ShowUnit(U02,false)
  call SetUnitInvulnerable(U02,true)
  set x=GetUnitX(Source)+250*Cos(bj_DEGTORAD*360*3/ 5.*-1.)
  set y=GetUnitY(Source)+250*Sin(bj_DEGTORAD*360*3/ 5.*-1.)
  set U03=CreateUnit(GetOwningPlayer(Source),'h0CJ',x,y,360*3/ 5.*-1.)
  call ShowUnit(U03,false)
  call SetUnitInvulnerable(U02,true)
  set x=GetUnitX(Source)+250*Cos(bj_DEGTORAD*360*2/ 5.*-1.)
  set y=GetUnitY(Source)+250*Sin(bj_DEGTORAD*360*2/ 5.*-1.)
  set U04=CreateUnit(GetOwningPlayer(Source),'h0CJ',x,y,360*2/ 5.*-1.)
  call ShowUnit(U04,false)
  call SetUnitInvulnerable(U04,true)
  set x=GetUnitX(Source)+250*Cos(bj_DEGTORAD*360*1/ 5.*-1.)
  set y=GetUnitY(Source)+250*Sin(bj_DEGTORAD*360*1/ 5.*-1.)
  set U05=CreateUnit(GetOwningPlayer(Source),'h0CJ',x,y,360*1/ 5.*-1.)
  call ShowUnit(U05,false)
  call SetUnitInvulnerable(U05,true)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(393),(U01))
  call SaveUnitHandle(hashtable019,(Cache),(394),(U02))
  call SaveUnitHandle(hashtable019,(Cache),(395),(U03))
  call SaveUnitHandle(hashtable019,(Cache),(396),(U04))
  call SaveUnitHandle(hashtable019,(Cache),(397),(U05))
  call SaveBoolean(hashtable019,(Cache),(511),(true))
  call SaveBoolean(hashtable019,(Cache),(512),(false))
  call SaveBoolean(hashtable019,(Cache),(513),(false))
  call SaveBoolean(hashtable019,(Cache),(514),(false))
  call SaveBoolean(hashtable019,(Cache),(515),(false))
  call SaveBoolean(hashtable019,(Cache),(655),(false))
  call SaveBoolean(hashtable019,(Cache),(656),(false))
  call SaveReal(hashtable019,(Cache),(138),((150)*1.))
  call UnitAddAbility2(Source,'A24B')
  call UnitAddAbility2(Source,'A24A')
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function YZG))
  set Source=null
  set t=null
  set U01=null
  set U02=null
  set U03=null
  set U04=null
  set U05=null
endfunction

function YLG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  if IsRealDamage then
    call HealUnitFor(Source,GetEventDamage()*.05*Level)
  endif
  set t=null
  set Source=null
  return false
endfunction

function Y1G takes unit u returns nothing
  local trigger t
  call UnitRemoveAbility(u,'A1TS')
  call UnitRemoveAbility(u,'A1TR')
  call UnitRemoveAbility(u,'A1TT')
  call UnitRemoveAbility(u,'A1TP')
  if(LoadBoolean(hashtable019,(GetHandleId(u)),(708)))then
    call SaveBoolean(hashtable019,(GetHandleId(u)),(708),(false))
    set t=(LoadTriggerHandle(hashtable019,(GetHandleId(u)),(709)))
    call FlushChildHashtable(hashtable019,(GetHandleId(t)))
    call CleanTrigger(t)
    call RemoveSavedHandle(hashtable019,(GetHandleId(u)),(709))
    set t=null
  endif
endfunction

function Y0G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call Y1G(Source)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function Y5G takes unit u,integer i returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(Cache),(2),(u))
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Y0G))
  if i==1 then
    call UnitAddAbility2(u,'A1TS')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A1TS',false)
  elseif i==2 then
    call UnitAddAbility2(u,'A1TR')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A1TR',false)
  elseif i==3 then
    call UnitAddAbility2(u,'A1TT')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A1TT',false)
  elseif i==4 then
    call UnitAddAbility2(u,'A1TP')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(u),'A1TP',false)
  endif
  if(LoadBoolean(hashtable019,(GetHandleId(u)),(708)))==false then
    call SaveBoolean(hashtable019,(GetHandleId(u)),(708),(true))
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DAMAGED)
    call TriggerAddCondition(t,Condition(function YLG))
    call SaveTriggerHandle(hashtable019,(GetHandleId(u)),(709),(t))
    call SaveUnitHandle(hashtable019,(GetHandleId(t)),(2),(u))
    call SaveInteger(hashtable019,(GetHandleId(t)),(5),(i))
  endif
  set t=null
endfunction

function Wisp_Overcharge_Act takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local integer Level=GetUnitAbilityLevel(Source,'A28Q')
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Z4G=(LoadUnitHandle(hashtable019,(GetHandleId(Source)),(652)))
  local boolean DCD=false
  local real hpcost=.2*(GetUnitState(Source,UNIT_STATE_LIFE)*.045)
  local real mpcost=.2*(GetUnitState(Source,UNIT_STATE_MANA)*.045)
  if GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER then
    if GetIssuedOrderId()==852589then
      call Y5G(Source,Level)
    elseif GetIssuedOrderId()==852590then
      call Y1G(Source)
    endif
  endif
  if GetUnitAbilityLevel(Source,'A1TS')>0 or GetUnitAbilityLevel(Source,'A1TR')>0 or GetUnitAbilityLevel(Source,'A1TT')>0 or GetUnitAbilityLevel(Source,'A1TP')>0 then
    set DCD=true
    call SetUnitState(Source,UNIT_STATE_LIFE,RMaxBJ(GetUnitState(Source,UNIT_STATE_LIFE)-hpcost,1))
    call SetUnitState(Source,UNIT_STATE_MANA,RMaxBJ(GetUnitState(Source,UNIT_STATE_MANA)-mpcost,1))
  endif
  if Z4G==null then
    if Target!=null then
      call Y1G(Target)
      set Target=null
      call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    endif
  else
    if Target==null then
      set Target=Z4G
      if DCD then
        call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
        call Y5G(Target,Level)
      else
        call Y1G(Target)
      endif
    elseif Target!=Z4G then
      call Y1G(Target)
      if DCD then
        set Target=Z4G
        call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
        call Y5G(Target,Level)
      endif
    elseif DCD==false then
      call Y1G(Target)
    elseif Target==Z4G then
      if DCD then
        set Target=Z4G
        call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
        call Y5G(Target,Level)
      endif
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set Z4G=null
  return false
endfunction

function Wisp_Overcharge_Learn takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A28Q')
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(null))
  call TriggerRegisterTimerEvent(t,.2,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ISSUED_ORDER)
  call TriggerAddCondition(t,Condition(function Wisp_Overcharge_Act))
  set Source=null
  set t=null
endfunction

function Wisp_Overcharge_Init takes nothing returns boolean
  if GetLearnedSkill()=='A28Q' and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call Wisp_Overcharge_Learn()
  endif
  return false
endfunction

function Wisp_Overcharge_Reg takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function Wisp_Overcharge_Init))
  set t=null
endfunction

function Tether_RemoveSlow takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  if not(UnitRemoveAbility(u,'A304') and UnitRemoveAbility(u,'B304')) or GetUnitAbilityLevel(u,'B304')>0 then
    if LoadBoolean(hashtable019,h,0)==false then
      call TriggerRegisterTimerEvent(t,1,true)
      call SaveBoolean(hashtable019,h,0,true)
    endif
  else
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  endif
  set u=null
  set t=null
endfunction

function Tether_ApplySlow takes unit u,real dur returns nothing
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,dur,false)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Tether_RemoveSlow))
  call UnitAddAbility2(u,'A305')
  call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A305',false)
  call SaveUnitHandle(hashtable019,h,0,u)
  set t=null
endfunction

function ZEG takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),NA8)==false then
    call GroupAddUnit(NA8,GetEnumUnit())
    //call StunTarget(NZ8,GetEnumUnit(),.25+.5*NC8)
    call Tether_ApplySlow(GetEnumUnit(),.25+.5*NC8)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl",GetEnumUnit(),"chest"))
  endif
endfunction

function ZFG takes unit Source,unit Target,group HND returns nothing
  local real x1=GetUnitX(Source)
  local real y1=GetUnitY(Source)
  local real x2=GetUnitX(Target)
  local real y2=GetUnitY(Target)
  local real a=AngleBetweenXY(x1,y1,x2,y2)*bj_DEGTORAD
  local real x
  local real y
  local real d=DistanceBetweenXY(x1,y1,x2,y2)
  local group g=GetAvailableGroup()
  local integer i=1
  set NA8=HND
  set NZ8=Source
  set NC8=GetUnitAbilityLevel(Source,'A1TA')
  set NB8=NC8*50+50
  loop
    exitwhen i>8
    set tt_unit1=Source
    set x=x1+d*i/ 8*Cos(a)
    set y=y1+d*i/ 8*Sin(a)
    call GroupEnumUnitsInRange(g,x,y,100,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function ZEG)
    call GroupClear(g)
    set i=i+1
  endloop
  call KillGroup(g)
  set g=null
endfunction

function ZGG takes unit Source,unit Target returns boolean
  return((LoadInteger(hashtable019,(GetHandleId((Source))),((4294))))==1)
endfunction

function ZHG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real d=DistanceBetweenUnits(Source,Target)
  local real a=GetAngleBetweenUnits(Source,Target)*bj_DEGTORAD
  local real x=GetUnitX(Source)+20*Cos(a)
  local real y=GetUnitY(Source)+20*Sin(a)
  local location l
  if d<300 or d>2150 then
    set l=LI8(x,y)
    set x=GetLocationX(l)
    set y=GetLocationY(l)
    if IsUnitType(Source,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
    endif
    call SetUnitX(Source,SafeX50(x))
    call SetUnitY(Source,SafeY50(y))
    call KillTrees(x,y,350)
    call RemoveLocation(l)
    set l=null
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call SaveInteger(hashtable019,(GetHandleId((Source))),((4295)),(2))
  else
    if IsUnitType(Source,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
    endif
    call SetUnitX(Source,x)
    call SetUnitY(Source,y)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function ZIG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local lightning ZQ8=(LoadLightningHandle(hashtable019,(Cache),(196)))
  local integer Count=GetTriggerEvalCount(t)
  local real d=DistanceBetweenUnits(Source,Target)
  local real a=1
  local real WEE=GetUnitState(Source,UNIT_STATE_LIFE)
  local real IVD=GetUnitState(Source,UNIT_STATE_MANA)
  local real ZJG=(LoadReal(hashtable019,(Cache),(670)))
  local real ZKG=(LoadReal(hashtable019,(Cache),(667)))
  local real ZMG
  local real ZNG
  if Target==null or Source==null or IsDead(Source) or(Count>600 and ZGG(Source,Target)==false and((LoadInteger(hashtable019,(GetHandleId((Source))),((4295))))==1)==false)or(d>925 and((LoadInteger(hashtable019,(GetHandleId((Source))),((4295))))==1)==false)or GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()=='A1TU')then
    call KillGroup(HND)
    call DestroyLightning(ZQ8)
    call UnitRemoveAbility(Target,'A1TH')
    call UnitRemoveAbility(Target,'A1TI')
    call UnitRemoveAbility(Target,'A1TG')
    call UnitRemoveAbility(Target,'A1TJ')
    call UnitRemoveAbility(Target,'B0DH')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call UnitRemoveAbility(Source,'A1TH')
    call UnitRemoveAbility(Source,'A1TI')
    call UnitRemoveAbility(Source,'A1TG')
    call UnitRemoveAbility(Source,'A1TJ')
    call UnitRemoveAbility(Source,'B0DH')
    call UnitRemoveAbility(Source,'A1TU')
    if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A1TA' then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1TA',true)
    endif
    call RemoveSavedHandle(hashtable019,GetHandleId(Source),652)
  else
    set ZMG=WEE/ GetUnitState(Source,UNIT_STATE_MAX_LIFE)
    set ZNG=IVD/ GetUnitState(Source,UNIT_STATE_MAX_MANA)
    if ZMG-ZJG>0 and(ZMG-ZJG)<.5 then
      if((LoadInteger(hashtable019,(GetHandleId((Source))),((4298))))==1)==false then
        call SetWidgetLife(Target,GetWidgetLife(Target) + (ZMG-ZJG)*GetUnitState(Source,UNIT_STATE_MAX_LIFE)*1.5)
      endif
    endif
    if ZNG-ZKG>0 and(ZNG-ZKG)<.5 then
      call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)+(ZNG-ZKG)*GetUnitState(Source,UNIT_STATE_MAX_MANA)*1.5)
    endif
    call SaveReal(hashtable019,(Cache),(670),((GetUnitState(Source,UNIT_STATE_LIFE)/ GetUnitState(Source,UNIT_STATE_MAX_LIFE))*1.))
    call SaveReal(hashtable019,(Cache),(667),((GetUnitState(Source,UNIT_STATE_MANA)/ GetUnitState(Source,UNIT_STATE_MAX_MANA))*1.))
    call MoveLightning(ZQ8,true,GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))
    call ZFG(Source,Target,HND)
    if IsUnitVisibleLoD(Source,GetLocalPlayer())==false and IsUnitVisibleLoD(Target,GetLocalPlayer())==false then
      set a=0
    endif
    if IsObserver(GetLocalPlayer())then
      set a=1
    endif
    if d<700 or((LoadInteger(hashtable019,(GetHandleId((Source))),((4295))))==1) then
      call SetLightningColor(ZQ8,.0,1.,1.,a)
    else
      call SetLightningColor(ZQ8,.8,.7,.4,a)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set HND=null
  set ZQ8=null
  return false
endfunction

function Wisp_Tether takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local lightning ZQ8=AddLightning("CHIM",true,GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))
  local integer Level=GetUnitAbilityLevel(Source,'A1TA')
  local integer ZEE
  local real d=DistanceBetweenUnits(Source,Target)
  local real a=GetAngleBetweenUnits(Source,Target)*bj_DEGTORAD
  local location l
  local real x
  local real y
  call SetLightningColor(ZQ8,.0,1.,1.,1)
  call UnitAddAbility2(Source,'A1TU')
  if Level==1 then
    set ZEE='A1TH'
  elseif Level==2 then
    set ZEE='A1TI'
  elseif Level==3 then
    set ZEE='A1TG'
  elseif Level==4 then
    set ZEE='A1TJ'
  endif
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A1TA',false)
  call UnitAddAbility2(Source,ZEE)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),ZEE,false)
  call UnitAddAbility2(Target,ZEE)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),ZEE,false)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveGroupHandle(hashtable019,(Cache),(133),(GetAvailableGroup()))
  call SaveLightningHandle(hashtable019,(Cache),(196),(ZQ8))
  call SaveReal(hashtable019,(Cache),(670),((GetUnitState(Source,UNIT_STATE_LIFE)/ GetUnitState(Source,UNIT_STATE_MAX_LIFE))*1.))
  call SaveReal(hashtable019,(Cache),(667),((GetUnitState(Source,UNIT_STATE_MANA)/ GetUnitState(Source,UNIT_STATE_MAX_MANA))*1.))
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function ZIG))
  call SaveUnitHandle(hashtable019,(GetHandleId(Source)),(652),(Target))
  if d>700 then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl",Source,"chest")))
    call TriggerRegisterTimerEvent(t,.02,true)
    call TriggerAddCondition(t,Condition(function ZHG))
    call SaveInteger(hashtable019,(GetHandleId((Source))),((4295)),(1))
  endif
  set Source=null
  set Target=null
  set ZQ8=null
  set t=null
  set l=null
endfunction

function ZQG takes unit Source,real x,real y returns boolean
  local boolean result=false
  local player p=GetOwningPlayer(Source)
  local unit Caster=CreateUnit(p,'e02Q',GetUnitX(Source),GetUnitY(Source),0)
  call UnitAddAbility2(Caster,'A1V4')
  if IssuePointOrderById(Caster,852525,x,y) then
    call KillUnit(Caster)
    set Caster=null
    set p=null
    return true
  else
    call KillUnit(Caster)
    set Caster=null
    set p=null
    return false
  endif
endfunction

function ZRG takes string ZS8,unit Target returns nothing
  local texttag tt=CreateTextTag()
  call SetTextTagText(tt,ZS8,.033)
  call SetTextTagPosUnit(tt,Target,64)
  call SetTextTagColor(tt,0,50,255,255)
  call SetTextTagVelocity(tt,0,.0355)
  call SetTextTagFadepoint(tt,.15)
  call SetTextTagPermanent(tt,false)
  call SetTextTagLifespan(tt,.85)
  call SetTextTagVisibility(tt,IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Target)))
  set tt=null
endfunction

function ZSG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Count=GetTriggerEvalCount(t)
  if IsDead(Source)==false and Count<12 then
    call ZRG(I2S(12-Count),Source)
  endif
  if Count==12 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  return false
endfunction

function ZTG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(GetHandleId(Source)),(652)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(189)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(190)))
  local fogmodifier Z58=(LoadFogModifierHandle(hashtable019,(Cache),(42)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call SaveInteger(hashtable019,(GetHandleId((Source))),((4294)),(2))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FogModifierStop(Z58)
    call DestroyFogModifier(Z58)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call KillTrees(TargetX,TargetY,250)
    call KillTrees(SourceX,SourceY,250)
    if GetTriggerEvalCount(t)==1 then
      if IsDead(Source)==false then
        call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",GetUnitX(Source),GetUnitY(Source)))
        call SetUnitPosition(Source,TargetX,TargetY)
        call PanCameraToTimedForPlayer(GetOwningPlayer(Source),TargetX,TargetY,0)
        call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",GetUnitX(Source),GetUnitY(Source)))
      endif
      if Target!=null and IsDead(Target)==false and GetOwningPlayer(Target)!=Sentinels[0]and GetOwningPlayer(Target)!=Scourges[0]and((LoadBoolean(hashtable019,(GetHandleId(GetOwningPlayer((Target)))),(139)))==false)then
        call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",GetUnitX(Target),GetUnitY(Target)))
        call AddTimedKeyToUnit(Target,4402,1)
        call SetUnitPosition(Target,TargetX,TargetY)
        if IsUnitType(Target,UNIT_TYPE_HERO) and IsDead(Target)==false then
          call PanCameraToTimedForPlayer(GetOwningPlayer(Target),TargetX,TargetY,0)
        endif
        call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",GetUnitX(Target),GetUnitY(Target)))
      endif
    else
      if IsDead(Source)==false then
        call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",GetUnitX(Source),GetUnitY(Source)))
        call SetUnitPosition(Source,SourceX,SourceY)
        call PanCameraToTimedForPlayer(GetOwningPlayer(Source),SourceX,SourceY,0)
        call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",GetUnitX(Source),GetUnitY(Source)))
      endif
      if Target!=null and IsDead(Target)==false and GetOwningPlayer(Target)!=Sentinels[0]and GetOwningPlayer(Target)!=Scourges[0]and((LoadBoolean(hashtable019,(GetHandleId(GetOwningPlayer((Target)))),(139)))==false)then
        call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",GetUnitX(Target),GetUnitY(Target)))
        call AddTimedKeyToUnit(Target,4402,1)
        call SetUnitPosition(Target,SourceX,SourceY)
        if IsUnitType(Target,UNIT_TYPE_HERO) and IsDead(Target)==false then
          call PanCameraToTimedForPlayer(GetOwningPlayer(Target),SourceX,SourceY,0)
        endif
        call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",GetUnitX(Target),GetUnitY(Target)))
      endif
      call SaveInteger(hashtable019,(GetHandleId((Source))),((4294)),(2))
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FogModifierStop(Z58)
      call DestroyFogModifier(Z58)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set Z58=null
  return false
endfunction

function ZUG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local fogmodifier Z58
  local integer Level=GetUnitAbilityLevel(Source,'A1TB')
  if IsUnitDisabled(Source)or IsUnitEntangled(Source)or IsDead(Source)then
    call SaveInteger(hashtable019,(GetHandleId((Source))),((4294)),(2))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEvalCount(t)==(2.75-.25*Level)/ .05 then
    set Z58=CreateFogModifierRadius(GetOwningPlayer(Source),FOG_OF_WAR_VISIBLE,GetUnitX(Source),GetUnitY(Source),400,true,true)
    call FogModifierStart(Z58)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call TriggerRegisterTimerEvent(t,.01,false)
    call TriggerRegisterTimerEvent(t,12,false)
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function ZTG))
    call SaveReal(hashtable019,(Cache),(189),((GetUnitX(Source))*1.))
    call SaveReal(hashtable019,(Cache),(190),((GetUnitY(Source))*1.))
    call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
    call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
    call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffect("war3mapImported\\EarthlyEminence.mdl",GetUnitX(Source),GetUnitY(Source))))
    call SaveFogModifierHandle(hashtable019,(Cache),(42),(Z58))
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function ZSG))
  endif
  set Source=null
  set t=null
  set Z58=null
  return false
endfunction

function Wisp_Relocate takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local unit Target=(LoadUnitHandle(hashtable019,(GetHandleId(Source)),(652)))
  local integer id=GetPlayerId(GetOwningPlayer(Source))
  local integer Level=GetUnitAbilityLevel(Source,'A1TB')
  call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",Source,"chest"))
  if Target!=null then
  endif
  call PingMinimapEx(x,y,4.,255,0,0,false)
  call TimedReveal(Sentinels[1],2.5,x,y,300)
  call TimedReveal(Scourges[1],2.5,x,y,300)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerAddCondition(t,Condition(function ZUG))
  call SaveReal(hashtable019,(Cache),(47),((x)*1.))
  call SaveReal(hashtable019,(Cache),(48),((y)*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffect("war3mapImported\\EarthlyEminence.mdl",x,y)))
  call SaveInteger(hashtable019,(GetHandleId((Source))),((4294)),(1))
  set Source=null
  set Target=null
  set t=null
endfunction

function ZWG takes nothing returns boolean
  if GetSpellAbilityId()=='A1TB' then
    if ZQG(GetTriggerUnit(),GetSpellTargetX(),GetSpellTargetY())==false then
      call InterruptUnit(GetTriggerUnit())
      call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n0KX'))
    else
      if IsSentinel(GetOwningPlayer(GetTriggerUnit()))then
        if IsPointInRegion(N68,GetSpellTargetX(),GetSpellTargetY()) then
          call InterruptUnit(GetTriggerUnit())
          call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n03Y'))
        endif
      else
        if IsPointInRegion(N38,GetSpellTargetX(),GetSpellTargetY()) then
          call InterruptUnit(GetTriggerUnit())
          call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName('n03Y'))
        endif
      endif
    endif
  endif
  return false
endfunction

function Func1043 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function ZWG))
  set N38=CreateRegion()
  call RegionAddRect(N38,G4)
  call RegionAddRect(N38,boolean036)
  set N68=CreateRegion()
  call RegionAddRect(N68,F4)
  call RegionAddRect(N68,Z5)
  set t=null
endfunction

function ZXG takes unit Source,unit Target,real SourceX,real SourceY,real a2 returns nothing
  local integer i=0
  local real TargetX
  local real TargetY=GetUnitY(Target)
  local real a
  local real x
  local real y
  local real ZYG
  if Target!=null then
    set TargetX=GetUnitX(Target)
    set TargetY=GetUnitY(Target)
    set a=AngleBetweenXY(SourceX,SourceY,TargetX,TargetY)
  else
    set a=a2
    set TargetX=SourceX+50*Cos(a*bj_DEGTORAD)
    set TargetY=SourceY+50*Sin(a*bj_DEGTORAD)
  endif
  set ZYG=a
  set x=TargetX+200*Cos(ZYG*bj_DEGTORAD)
  set y=TargetY+200*Sin(ZYG*bj_DEGTORAD)
  call B88(CreateDestructable('B006',x,y,-1*ZYG,.6,1),5)
  call KillTrees(x,y,300)
  set ZYG=a-40
  set x=TargetX+200*Cos(ZYG*bj_DEGTORAD)
  set y=TargetY+200*Sin(ZYG*bj_DEGTORAD)
  call B88(CreateDestructable('B006',x,y,-1*ZYG,.6,1),5)
  call KillTrees(x,y,300)
  set ZYG=a-80
  set x=TargetX+200*Cos(ZYG*bj_DEGTORAD)
  set y=TargetY+200*Sin(ZYG*bj_DEGTORAD)
  call B88(CreateDestructable('B006',x,y,-1*ZYG,.6,1),5)
  call KillTrees(x,y,300)
  set ZYG=a+40
  set x=TargetX+200*Cos(ZYG*bj_DEGTORAD)
  set y=TargetY+200*Sin(ZYG*bj_DEGTORAD)
  call B88(CreateDestructable('B006',x,y,-1*ZYG,.6,1),5)
  call KillTrees(x,y,300)
  set ZYG=a+80
  set x=TargetX+200*Cos(ZYG*bj_DEGTORAD)
  set y=TargetY+200*Sin(ZYG*bj_DEGTORAD)
  call B88(CreateDestructable('B006',x,y,-1*ZYG,.6,1),5)
  call KillTrees(x,y,300)
  if Target!=null then
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\ChainFreeze_F6.mdx",Target,"chest"))
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl",Target,"chest"))
    call DamageTarget(NL8,Target,1,N08*70)
  endif
endfunction

function ZZG takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),N58)==false then
    if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO)==false then
      call GroupAddUnit(N58,GetEnumUnit())
      call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\ChainFreeze_F6.mdx",GetEnumUnit(),"chest"))
      call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl",GetEnumUnit(),"chest"))
      call DamageTarget(NL8,GetEnumUnit(),1,N08*70)
    else
      set N18=GetEnumUnit()
    endif
  endif
endfunction

function ZAG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit ZBG=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real I1G=(LoadReal(hashtable019,(Cache),(683)))
  local real I0G=(LoadReal(hashtable019,(Cache),(684)))
  local real SourceX=GetUnitX(ZBG)
  local real SourceY=GetUnitY(ZBG)
  local real J2E=Atan2(I0G-SourceY,I1G-SourceX)
  local real AO8=SourceX+18*Cos(J2E)
  local real AP8=SourceY+18*Sin(J2E)
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local integer Level=GetUnitAbilityLevel(Source,'A1YO')
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  set NL8=Source
  set N58=HND
  set N08=Level
  set N18=null
  call GroupEnumUnitsInRange(g,AO8,AP8,225,Condition(function DefaultEnemyFilter))
  call ForGroup(g,function ZZG)
  call KillGroup(g)
  call SetUnitPosition(ZBG,AO8,AP8)
  if DistanceBetweenXY(AO8,AP8,I1G,I0G)<40 or N18!=null then
    call KillTrees(AO8,AP8,300)
    call KillUnit(ZBG)
    call ShowUnit(ZBG,false)
    call SetUnitPathing(ZBG,true)
    if N18!=null then
      call ZXG(Source,N18,AO8,AP8,J2E*bj_RADTODEG)
    else
      call ZXG(Source,null,AO8,AP8,J2E*bj_RADTODEG)
    endif
    call KillGroup(HND)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set Source=null
  set Target=null
  set t=null
  set ZBG=null
  set HND=null
  set g=null
  return false
endfunction

function Tuskar_IceShards takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit ZBG=CreateUnit(GetOwningPlayer(Source),'h0CS',GetUnitX(Source),GetUnitY(Source),0)
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real TargetX=GetSpellTargetX()
  local real TargetY=GetSpellTargetY()
  local real J2E=Atan2(TargetY-SourceY,TargetX-SourceX)
  local real I1G=SafeX50(SourceX+1600*Cos(J2E))
  local real I0G=SafeY50(SourceY+1600*Sin(J2E))
  call SetUnitFacing(ZBG,J2E*bj_RADTODEG)
  call SetUnitPathing(ZBG,false)
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function ZAG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(683),((I1G)*1.))
  call SaveReal(hashtable019,(Cache),(684),((I0G)*1.))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveUnitHandle(hashtable019,(Cache),(45),(ZBG))
  call SaveGroupHandle(hashtable019,(Cache),(133),(GetAvailableGroup()))
  set Source=null
  set ZBG=null
  set t=null
endfunction

function Z6G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=GetUnitAbilityLevel(Source,'A1YQ')
  local integer Count=GetTriggerEvalCount(t)
  local real y=(Count-50)*(Count-50)/ 4.3
  local real Damage
  if Level==1 then
    set Damage=75
  elseif Level==2 then
    set Damage=150
  else
    set Damage=225
  endif
  if Count==1 then
    call IssueTargetOrderById(Source,851983,Target)
  endif
  if Count<50 then
    if IsBuggyFlying(Target)==false then
      call SetUnitFlyHeight(Target,700*Count/ 50,0)
    endif
  elseif Count<100 then
    if IsBuggyFlying(Target)==false then
      call SetUnitFlyHeight(Target,700-700*(Count-50)/ 50,0)
    endif
  else
    if IsBuggyFlying(Target)==false then
      call SetUnitFlyHeight(Target,GetUnitDefaultFlyHeight(Target),0)
    endif
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call CN8(Target,'A204',1,1+Level,'B0DY')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),'A204',false)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function ZLG takes unit Source,unit Target returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A1YQ')
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call TextTagOnUnit("WALRUS PUNCH !!",3.5,Source,.03,255,0,0,255)
  call PlaySoundAtPos(VF,GetUnitX(Target),GetUnitY(Target))
  call UnitAddAbility2(Caster,'A1UP')
  call IssueTargetOrderById(Caster,852095,Target)
  if IsBuggyFlying(Target)==false then
    call UnitAddAbility2(Target,'Amrf')
    call UnitRemoveAbility(Target,'Amrf')
  endif
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl",Target,"overhead"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl",Target,"head"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl",Target,"left,hand"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl",Target,"right,hand"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl",Target,"chest"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl",Target,"origin"))
  call TriggerRegisterTimerEvent(t,.01,true)
  call TriggerAddCondition(t,Condition(function Z6G))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl",Target,"chest")))
  set t=null
  set Caster=null
endfunction

function Z1G takes nothing returns boolean
  local trigger t2=GetTriggeringTrigger()
  local integer Cache2=GetHandleId(t2)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache2),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache2),(17)))
  local effect Visual=(LoadEffectHandle(hashtable019,(Cache2),(32)))
  local trigger t=(LoadTriggerHandle(hashtable019,(Cache2),(35)))
  local integer Cache=(LoadInteger(hashtable019,(Cache2),(375)))
  if GetTriggerEvalCount(t2)==1 then
    call IssueTargetOrderById(Source,851983,Target)
  else
    if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
      if GetEventDamageSource()==Source and GetEventDamage()>30 and IsRealDamage and IsFakeDamage==false then
        call AddTimedAbility(Source,'A1UH',1,.1)
        //call AddTimedAbility(Source,'A1UI',1,.1)
        call DestroyEffect(Visual)
        call CleanTrigger(t2)
        call FlushChildHashtable(hashtable019,(Cache2))
        call CleanTrigger(t)
        call FlushChildHashtable(hashtable019,(Cache))
        call ZLG(Source,Target)
      endif
    elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
      if GetAttacker()==Source and GetTriggerUnit()!=Target then
        call FlushChildHashtable(hashtable019,(Cache2))
        call CleanTrigger(t2)
      endif
    else
      call UnitRemoveAbility(Source,'A1UH')
      //call UnitRemoveAbility(Source,'A1UI')
      call RemoveSavedHandle(hashtable019,(Cache),(17))
      call FlushChildHashtable(hashtable019,(Cache2))
      call CleanTrigger(t2)
    endif
  endif
  set t2=null
  set t=null
  set Source=null
  set Target=null
  set Visual=null
  return false
endfunction

function Z5G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target
  local effect Visual=(LoadEffectHandle(hashtable019,(Cache),(32)))
  local trigger t2
  local integer Cache2
  if GetTriggerEventId()!=EVENT_PLAYER_UNIT_ATTACKED then
    call DestroyEffect(Visual)
    call UnitRemoveAbility(Source,'A1UH')
    //call UnitRemoveAbility(Source,'A1UI')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetAttacker()==Source and GetTriggerUnit()!=(LoadUnitHandle(hashtable019,(Cache),(17)))and IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(Source))==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Source)!='N0MH' then
    set Target=GetTriggerUnit()
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    set t2=CreateTrigger()
    set Cache2=GetHandleId(t2)
    call TriggerRegisterTimerEvent(t2,0,false)
    call TriggerRegisterTimerEvent(t2,2,false)
    call TriggerRegisterUnitEvent(t2,Target,EVENT_UNIT_DAMAGED)
    call TriggerRegisterAnyUnitEvent(t2,EVENT_PLAYER_UNIT_ATTACKED)
    call TriggerAddCondition(t2,Condition(function Z1G))
    call SaveUnitHandle(hashtable019,(Cache2),(2),(Source))
    call SaveUnitHandle(hashtable019,(Cache2),(17),(Target))
    call SaveEffectHandle(hashtable019,(Cache2),(32),(Visual))
    call SaveInteger(hashtable019,(Cache2),(375),(Cache))
    call SaveTriggerHandle(hashtable019,(Cache2),(35),(t))
  endif
  set t=null
  set Source=null
  set Target=null
  set Visual=null
  set t2=null
  return false
endfunction

function Tuskar_WalrusPunch takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerRegisterTimerEvent(t,10,false)
  call TriggerAddCondition(t,Condition(function Z5G))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(null))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\WalrusPunchWeaponFX.mdx",Source,GetProperAttachPoint_Weapon(Source))))
  call UnitAddAbility2(Source,'A1UH')
  call UnitMakeAbilityPermanent(Source,true,'A1UL')
  set t=null
  set Source=null
endfunction

function A7G takes nothing returns nothing
  call ShowUnit(GetEnumUnit(),true)
  call UnitRemoveAbility(GetEnumUnit(),'A04R')
  call SetUnitInvulnerable(GetEnumUnit(),false)
  call PauseUnit(GetEnumUnit(),false)
  if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO) then
    call SetUnitPosition(GetEnumUnit(),OD8,OE8)
    call SelectUnitForPlayerSingle(GetEnumUnit(),GetOwningPlayer(GetEnumUnit()))
  else
    call SetUnitX(GetEnumUnit(),OD8)
    call SetUnitY(GetEnumUnit(),OE8)
  endif
  if GetEnumUnit()==O48 and O78!=null then
    call IssueTargetOrderById(O48,851983,O78)
  endif
  call DestroyEffect(AddSpecialEffect("war3mapImported\\ChainFreeze_F6.mdx",GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit())))
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl",GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit())))
endfunction

function Snowball_Slow takes nothing returns nothing
  local integer A38
  if O98==1 then
    set A38='A20F'
  elseif O98==2 then
    set A38='A20E'
  elseif O98==3 then
    set A38='A1SL'
  elseif O98==4 then
    set A38='A20D'
  endif
  if IsUnitInGroup(GetEnumUnit(),N28)==false then
    call GroupAddUnit(N28,GetEnumUnit())
    call SetPlayerAbilityAvailable2(GetOwningPlayer(GetEnumUnit()),A38,false)
    call CN8(GetEnumUnit(),A38,1,5,'B0DC')
  endif
endfunction

function A8G takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),N28)==false then
    call GroupAddUnit(N28,GetEnumUnit())
    call DamageTarget(O48,GetEnumUnit(),1,40*O98+40)
    call SetUnitAbilityLevel(O88,'A0X6',DO9(.25*O98+.25))
    call SetUnitX(O88,GetUnitX(GetEnumUnit()))
    call SetUnitY(O88,GetUnitY(GetEnumUnit()))
    call IssueTargetOrderById(O88,852095,GetEnumUnit())
  endif
endfunction

function integers139 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real TargetX=GetUnitX(Target)
  local real TargetY=GetUnitY(Target)
  local real r=(LoadReal(hashtable019,(Cache),(671)))
  local real a=AngleBetweenXY(GetUnitX(Projectile),GetUnitY(Projectile),TargetX,TargetY)*bj_DEGTORAD
  local real x=GetUnitX(Projectile)+r*Cos(a)
  local real y=GetUnitY(Projectile)+r*Sin(a)
  local group HND=(LoadGroupHandle(hashtable019,(Cache),(133)))
  local group g
  local integer Count=GetTriggerEvalCount(t)
  local real EMF=RMinBJ(2.5+(Count*.02),10)
  local real RFE=225+40*(Count*.02)
  set O98=GetUnitAbilityLevel(Source,'A1S7')
  set tt_unit1=Source
  set N28=HND
  set O48=Source
  set O78=Target
  set O88=(LoadUnitHandle(hashtable019,(Cache),(19)))
  call SetUnitX(Projectile,x)
  call SetUnitY(Projectile,y)
  call SetUnitFacing(Projectile,a*bj_RADTODEG-180)
  call SetUnitScale(Projectile,EMF,EMF,EMF)
  if DistanceBetweenXY(x,y,TargetX,TargetY)<r*2 or Count==150 then
    call KillTrees(x,y,300)
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,RFE,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function A8G)
    call KillGroup(g)
    set g=null
    set OD8=x
    set OE8=y
    call ForGroup((LoadGroupHandle(hashtable019,(Cache),(22))),function A7G)
    call KillGroup((LoadGroupHandle(hashtable019,(Cache),(22))))
    call KillGroup(HND)
    call KillUnit(Projectile)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    if ModuloInteger(GetTriggerEvalCount(t),5)==0 then
      call KillTrees(x,y,300)
      set g=GetAvailableGroup()
      call GroupEnumUnitsInRange(g,x,y,RFE,Condition(function DefaultEnemyFilter))
      call ForGroup(g,function A8G)
      call KillGroup(g)
      set g=null
    endif
  endif
  set t=null
  set Source=null
  set Projectile=null
  set HND=null
  set Target=null
  return false
endfunction

function ADG takes nothing returns nothing
  call DestroyEffect(AddSpecialEffect("war3mapImported\\ChainFreeze_F6.mdx",GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit())))
  call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl",GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit())))
  call ShowUnit(GetEnumUnit(),false)
  call UnitAddAbility2(GetEnumUnit(),'A04R')
  call SetUnitInvulnerable(GetEnumUnit(),true)
  call PauseUnit(GetEnumUnit(),true)
  if O48!=GetEnumUnit()then
    set OG8=OG8+1
  endif
endfunction

function AEG takes nothing returns boolean
  local unit t = GetFilterUnit()
  local player p = GetOwningPlayer(t)
  
  if IsUnitAlly(O48,p) and (p==GetOwningPlayer(O48) or (LoadBoolean(hashtable019,GetHandleId(p),139)==false and IsUnitType(t,UNIT_TYPE_HERO))) and (GetUnitAbilityLevel(t,'A04R')==0 and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and IsDead(t)==false) and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) then
    set t = null
    set p=null
    return true
  endif
  
  set t = null
  set p=null
  return false
endfunction

function Tuskar_Snowball takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real SourceX=GetUnitX(Source)
  local real SourceY=GetUnitY(Source)
  local real TargetX=GetUnitX(Target)
  local real TargetY=GetUnitY(Target)
  local real a=AngleBetweenXY(SourceX,SourceY,TargetX,TargetY)*bj_DEGTORAD
  local unit Projectile=CreateUnit(GetOwningPlayer(Source),'h0C3',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
  local group g=GetAvailableGroup()
  set OF8=0
  set OG8=1
  set O48=Source
  set OF8=1.5*RMaxBJ(133,GetUnitMoveSpeedLOD(Source))
  call GroupEnumUnitsInRange(g,SourceX,SourceY,255,Condition(function AEG))
  call ForGroup(g,function ADG)
  set O88=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
  call UnitAddAbility2(O88,'A0X6')
  call SetUnitTimeScale(Projectile,2)
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function integers139))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(19),(O88))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveReal(hashtable019,(Cache),(671),((OF8*.02)*1.))
  call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
  call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
  call SaveGroupHandle(hashtable019,(Cache),(22),(g))
  call SaveGroupHandle(hashtable019,(Cache),(133),(GetAvailableGroup()))
  set t=null
  set Source=null
  set Target=null
  set Projectile=null
  set g=null
endfunction

function Tuskar_FrozenSigil_Register takes unit u returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
  call SaveUnitHandle(hashtable019,GetHandleId(t),0,u)
  call TriggerAddCondition(t,Condition(function Oblivion_NetherWard_DmgBlock))
  set t=null
endfunction

function Tuskar_FrozenSigil_Check takes nothing returns nothing
  local integer id=GetUnitTypeId(GetSummonedUnit())
  if id=='o01J' or id=='o01K' or id=='o01L' or id=='o01M' then
    call Tuskar_FrozenSigil_Register(GetSummonedUnit())
  endif
  
endfunction

function Tuskar_FrozenSigil_Init takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function Tuskar_FrozenSigil_Check))
  set t=null
endfunction

function units012 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call IssueTargetOrderById(Source,851986,Target)
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function unit159 takes nothing returns nothing
  local unit Source=GetSummonedUnit()
  local unit Target=GetSummoningUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerAddCondition(t,Condition(function units012))
  call TriggerRegisterTimerEvent(t,.2,false)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  set t=null
  set Source=null
  set Target=null
endfunction

function AJG takes nothing returns boolean
  local integer id=GetUnitTypeId(GetSummonedUnit())
  if id=='o01J' or id=='o01K' or id=='o01L' or id=='o01M' then
    call unit159()
  endif
  return false
endfunction

function UN9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function AJG))
  set t=null
endfunction



function reals033 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local unit Caster=(LoadUnitHandle(hashtable019,(Cache),(19)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED and IsRealDamage then
    set OH8=GetEventDamageSource()
  else
    call SetUnitX(Source,GetUnitX(Target))
    call SetUnitY(Source,GetUnitY(Target))
    call SetUnitX(Caster,GetUnitX(Target))
    call SetUnitY(Caster,GetUnitY(Target))
  endif
  set t=null
  set Source=null
  set Target=null
  set Caster=null
  return false
endfunction

function ANG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED then
    set OH8=GetEventDamageSource()
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function strings021 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetSummoningUnit()
  local unit Target=GetSummonedUnit()
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
  local integer lvl
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function reals033))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  if EM9(Source,'I0A8')then
    call UnitAddAbility(Caster,'A04I')
  endif
  if GetUnitAbilityLevel(Source,'A14K')>0 then
    call UnitAddAbility(Caster,'A14K')
  endif
  set lvl=GetUnitAbilityLevel(Source,'A06M')
  if lvl==0 then
    set lvl=4
  endif
  if GetUnitAbilityLevel(Source,'A1B6')>0 then
    call UnitAddAbility2(Target,'A06M')
    call SetUnitAbilityLevel(Target,'A06M',lvl)
  endif
  call SaveInteger(hashtable019,GetHandleId(Source),4500,1)
  set t=null
  set Source=null
  set Target=null
  set Caster=null
endfunction

function strings022 takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetSummoningUnit()
  local unit Target=GetSummonedUnit()
  local integer lvl
  local integer id
  
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function ANG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  if GetUnitAbilityLevel(Source,'A1B6')>0 then
    if GetUnitTypeId(Target)=='npn2' or GetUnitTypeId(Target)=='npn5' or GetUnitTypeId(Target)=='n012' then//storm
      set id='Acdh'
      set lvl=GetUnitAbilityLevel(Source,'Acdh')
      if lvl==0 then
        set lvl=4
      endif
    else
      set id='Q119'
      set lvl=GetUnitAbilityLevel(Source,'P119')
      if lvl==0 then
        set lvl=4
      endif
    endif
    if id=='Q119' then
      call UnitAddAbility2(Target,id)
      call SetUnitAbilityLevel(Target,'P119',lvl)
      call UnitAddAbility2(Target,'A0MX')
      call SetUnitAbilityLevel(Target,'A0MX',lvl)
    else
      call UnitAddAbility2(Target,id)
      call SetUnitAbilityLevel(Target,id,lvl)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
endfunction

function integers137 takes nothing returns boolean
  local integer W78=GetUnitTypeId(GetSummonedUnit())
  if W78=='npn3' or W78=='npn6' or W78=='n010' or W78=='n0GZ' then
    call strings021()
  elseif integers138(W78)then
    call strings022()
  endif
  return false
endfunction

function Func1052 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function integers137))
  set t=null
endfunction

function units013 takes nothing returns nothing
  call StunTarget(OI8,GetEnumUnit(),.75+.25*GetUnitAbilityLevel(OI8,'A27F'))
endfunction

function ASG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real a=(LoadReal(hashtable019,(Cache),(137)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(189)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(190)))
  local group g
  local real d=DistanceBetweenXY(SourceX,SourceY,TargetX,TargetY)/ 25
  local location l
  local integer Count=GetTriggerEvalCount(t)
  local real x=SourceX+d*Count*Cos(a)
  local real y=SourceY+d*Count*Sin(a)
  if IsUnitType(Target,UNIT_TYPE_HERO)then
    call SaveBoolean(HeroStats,GetHandleId(Target),99,true)
  endif
  call SetUnitX(Target,SafeX50(x))
  call SetUnitY(Target,SafeY50(y))
  if IsBuggyFlying(Target)==false then
    call SetUnitFlyHeight(Target,325-13*Count,0)
  endif
  if Count==25 then
    if IsUnitType(Target,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(Target),99,true)
    endif
    call SetUnitX(Target,SafeX50(TargetX))
    call SetUnitY(Target,SafeY50(TargetY))
    if IsPointInRegion(RestrictedRegion,GetUnitX(Target),GetUnitY(Target)) then
      set l=LI8(GetUnitX(Target),GetUnitY(Target))
      if IsUnitType(Target,UNIT_TYPE_HERO)then
        call SaveBoolean(HeroStats,GetHandleId(Target),99,true)
      endif
      call SetUnitX(Target,SafeX75(GetLocationX(l)))
      call SetUnitY(Target,SafeY75(GetLocationY(l)))
      call RemoveLocation(l)
      set l=null
    endif
    set tt_unit1=Source
    set OI8=Source
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),350,Condition(function DefaultEnemyFilter))
    call GroupRemoveUnit(g,Target)
    call ForGroup(g,function units013)
    call KillGroup(g)
    call KillTrees(GetUnitX(Target),GetUnitY(Target),150)
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl",GetUnitX(Target),GetUnitY(Target)))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    if IsBuggyFlying(Target)==false then
      call SetUnitFlyHeight(Target,GetUnitDefaultFlyHeight(Target),0)
    endif
    call SetUnitPathing(Target,true)
  endif
  set t=null
  set Source=null
  set Target=null
  set g=null
  return false
endfunction

function ATG takes unit Source,unit Target,unit Target2,real AUG,real AVG,effect FX,effect AWG returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local real TargetX=AUG
  local real TargetY=AVG
  local real a=AngleBetweenXY(GetUnitX(Target),GetUnitY(Target),AUG,AVG)*bj_DEGTORAD
  if DistanceBetweenXY(GetUnitX(Target),GetUnitY(Target),AUG,AVG)>375 then
    set TargetX=GetUnitX(Target)+375*Cos(a)
    set TargetY=GetUnitY(Target)+375*Sin(a)
  endif
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveReal(hashtable019,(Cache),(137),((a)*1.))
  call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
  call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
  call SaveReal(hashtable019,(Cache),(189),((GetUnitX(Target))*1.))
  call SaveReal(hashtable019,(Cache),(190),((GetUnitY(Target))*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(FX))
  call SaveEffectHandle(hashtable019,(Cache),(176),(AWG))
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function ASG))
  set t=null
endfunction

function player012 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local integer RHE=(LoadInteger(hashtable019,(Cache),(12)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local integer AYG=(LoadInteger(hashtable019,(Cache),(706)))
  local real a
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or(GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT and IsUnitDisabled(Target)==false)then
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A27F',true)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A27X',false)
    call ATG(Source,Target,(LoadUnitHandle(hashtable019,(Cache),(711))),TargetX,TargetY,(LoadEffectHandle(hashtable019,(Cache),(32))),(LoadEffectHandle(hashtable019,(Cache),(176))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if GetSpellAbilityId()=='A27X' then
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
      set a=AngleBetweenXY(GetUnitX(Target),GetUnitY(Target),GetSpellTargetX(),GetSpellTargetY())*bj_DEGTORAD
      if DistanceBetweenXY(GetUnitX(Target),GetUnitY(Target),GetSpellTargetX(),GetSpellTargetY())>375 then
        set TargetX=GetUnitX(Target)+375*Cos(a)
        set TargetY=GetUnitY(Target)+375*Sin(a)
      else
        set TargetX=GetSpellTargetX()
        set TargetY=GetSpellTargetY()
      endif
      call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffect("Abilities\\Spells\\Other\\GeneralAuraTarget\\GeneralAuraTarget.mdl",TargetX,TargetY)))
      call SaveReal(hashtable019,(Cache),(47),((TargetX)*1.))
      call SaveReal(hashtable019,(Cache),(48),((TargetY)*1.))
      call SaveUnitHandle(hashtable019,(Cache),(711),(GetSpellTargetUnit()))
      call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffectTarget("Abilities\\Spells\\Other\\GeneralAuraTarget\\GeneralAuraTarget.mdl",GetSpellTargetUnit(),"origin")))
    endif
  else
    set Count=Count+1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    call SetUnitPathing(Target,false)
    if(LoadInteger(hashtable019,(Cache),(707)))==1 then
      set AYG=AYG+3
    else
      set AYG=AYG-3
    endif
    call SaveInteger(hashtable019,(Cache),(706),(AYG))
    if AYG==30 then
      call SaveInteger(hashtable019,(Cache),(707),(-1))
    elseif AYG==-30 then
      call SaveInteger(hashtable019,(Cache),(707),(1))
    endif
    if IsBuggyFlying(Target)==false then
      if Count<15 then
        call SetUnitFlyHeight(Target,Count*20,0)
      else
        call SetUnitFlyHeight(Target,300+AYG,0)
      endif
    endif
    if Count>(RHE-25)then
      if IsBuggyFlying(Target)==false then
        call SetUnitFlyHeight(Target,300,0)
      endif
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A27F',true)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A27X',false)
      call ATG(Source,Target,(LoadUnitHandle(hashtable019,(Cache),(711))),TargetX,TargetY,(LoadEffectHandle(hashtable019,(Cache),(32))),(LoadEffectHandle(hashtable019,(Cache),(176))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function AZG takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local integer Level=GetUnitAbilityLevel(Source,'A27F')
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  call UnitAddAbility(Caster,'A282')
  call SetUnitAbilityLevel(Caster,'A282',Level)
  call IssueTargetOrderById(Caster,852095,Target)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A27F',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A27X',true)
  call UnitAddAbility(Source,'A27X')
  call SetUnitPathing(Target,false)
  if IsBuggyFlying(Target)==false then
    call UnitAddAbility2(Target,'Amrf')
    call UnitRemoveAbility(Target,'Amrf')
  endif
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveUnitHandle(hashtable019,(Cache),(711),(Target))
  call SaveInteger(hashtable019,(Cache),(12),(R2I((1.25+.25*Level)/ .02)))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  call SaveInteger(hashtable019,(Cache),(706),(0))
  call SaveInteger(hashtable019,(Cache),(707),(1))
  call SaveReal(hashtable019,(Cache),(47),((GetUnitX(Target))*1.))
  call SaveReal(hashtable019,(Cache),(48),((GetUnitY(Target))*1.))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\AntiGravityTarget.mdx",Target,"origin")))
  call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffect("Abilities\\Spells\\Other\\GeneralAuraTarget\\GeneralAuraTarget.mdl",GetUnitX(Target),GetUnitY(Target))))
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerRegisterDeathEvent(t,Target)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function player012))
  set Source=null
  set Target=null
  set t=null
  set Caster=null
endfunction

function Rubick_Telekinesis takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call AZG()
  endif
endfunction

function Func1053 takes nothing returns nothing
  call PreloadAbility('A282')
endfunction

function ABG takes unit Source,unit Target returns nothing
  local integer Level=GetUnitAbilityLevel(Source,'A27G')
  if IsUnitType(Target,UNIT_TYPE_HERO) then
    if Level==1 then
      call AddTimedAbility(Target,'A27W',1,10)
    elseif Level==2 then
      call AddTimedAbility(Target,'A286',1,10)
    elseif Level==3 then
      call AddTimedAbility(Target,'A285',1,10)
    elseif Level==4 then
      call AddTimedAbility(Target,'A287',1,10)
    endif
  else
    if Level==1 then
      call AddTimedAbility(Target,'A291',1,10)
    elseif Level==2 then
      call AddTimedAbility(Target,'A28Z',1,10)
    elseif Level==3 then
      call AddTimedAbility(Target,'A292',1,10)
    elseif Level==4 then
      call AddTimedAbility(Target,'A290',1,10)
    endif
  endif
  call PlaySoundAtPos(sound044,GetUnitX(Target),GetUnitY(Target))
endfunction

function player013 takes nothing returns nothing
  local real d
  if IsUnitInGroup(GetEnumUnit(),OM8)==false then
    set d=DistanceBetweenUnits(GetEnumUnit(),OK8)
    if d<ON8 then
      set ON8=d
      set OJ8=GetEnumUnit()
    endif
  endif
endfunction

function integers140 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local group AlreadyHit=(LoadGroupHandle(hashtable019,(Cache),(187)))
  local real x=GetUnitX(Target)
  local real y=GetUnitY(Target)
  local group g=GetAvailableGroup()
  call GroupAddUnit(AlreadyHit,Target)
  call ABG(Source,Target)
  set tt_unit1=Source
  set OJ8=null
  set OK8=Target
  set OM8=AlreadyHit
  set ON8=999999
  call GroupEnumUnitsInRange(g,x,y,465,Condition(function NonImmuneVisibleEnemyFilter))
  call ForGroup(g,function player013)
  call KillGroup(g)
  if OJ8==null or GetTriggerEvalCount(t)>26 then
    call KillGroup(AlreadyHit)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set Target=OJ8
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  endif
  set g=null
  set t=null
  set Source=null
  set Target=null
  set AlreadyHit=null
  return false
endfunction

function A6G takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local group AlreadyHit=GetAvailableGroup()
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
  call PlaySoundAtPos(sound044,GetUnitX(Source),GetUnitY(Source))
  call UnitAddAbility2(Caster,'A284')
  call SetUnitAbilityLevel(Caster,'A284',GetUnitAbilityLevel(Source,'A27G'))
  call IssueTargetOrderById(Caster,852119,Target)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveGroupHandle(hashtable019,(Cache),(187),(AlreadyHit))
  call TriggerRegisterTimerEvent(t,.25,true)
  call TriggerAddCondition(t,Condition(function integers140))
  set Source=null
  set Target=null
  set t=null
  set Caster=null
  set AlreadyHit=null
endfunction

function Rubick_Fadebolt takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call A6G()
  endif
endfunction

function integer559 takes nothing returns boolean
  if IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    if GetLearnedSkill()=='A27F' then
      call UnitRemoveAbility(GetTriggerUnit(),'A27I')
    elseif GetLearnedSkill()=='A27G' then
      call UnitRemoveAbility(GetTriggerUnit(),'A27K')
    elseif GetLearnedSkill()=='A27V' then
      call UnitRemoveAbility(GetTriggerUnit(),'A27J')
    endif
  endif
  return false
endfunction

function A0G takes integer id returns nothing
  set OO8[OP8]=id
  set OP8=OP8+1
endfunction

function integers141 takes integer id returns boolean
  local integer i=0
  loop
    exitwhen i==OP8
    if id==OO8[i]then
      return true
    endif
    set i=i+1
  endloop
  return false
endfunction

function integer560 takes nothing returns boolean
  local unit u = GetTriggerUnit()
  local integer spell = GetSpellAbilityId()
  local integer info
  
  if IsUnitType(u,UNIT_TYPE_HERO) and integers141(spell)==false and GetUnitAbilityLevel(u,'A04R')==0then
    set info = GetHandleId(u)
    call SaveInteger(hashtable019,info,705,spell)
    call SaveInteger(hashtable019,info,712,GetUnitAbilityLevel(u,spell))
  endif
  
  set u = null
  return false
endfunction

function B4G takes unit u returns nothing
  call UnitRemoveAbility(u,'A13D')
  call UnitRemoveAbility(u,'A21J')
  call UnitRemoveAbility(u,'A1QV')
  call UnitRemoveAbility(u,'A1TU')
  call UnitRemoveAbility(u,'A24A')
  call UnitRemoveAbility(u,'A24B')
  call UnitRemoveAbility(u,'A1NH')
  call UnitRemoveAbility(u,'A20N')
  call UnitRemoveAbility(u,'A1Z2')
  call UnitRemoveAbility(u,'A1Z3')
  call UnitRemoveAbility(u,'A205')
  call UnitRemoveAbility(u,'A1VU')
  call UnitRemoveAbility(u,'A0GC')
  call UnitRemoveAbility(u,'A24E')
  call UnitRemoveAbility(u,'A0RT')
  call UnitRemoveAbility(u,'A1RA')
  call UnitRemoveAbility(u,'A0HA')
  call UnitRemoveAbility(u,'A0SA')
  call UnitRemoveAbility(u,'A121')
  call UnitRemoveAbility(u,'A1WF')
  call UnitRemoveAbility(u,'A02T')
  call UnitRemoveAbility(u,'A1S9')
  call UnitRemoveAbility(u,'A21H')
  call UnitRemoveAbility(u,'A1MN')
  call UnitRemoveAbility(u,'A06K')
  call UnitRemoveAbility(u,'A0NE')
  call UnitRemoveAbility(u,'A0MP')
endfunction

function B7G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer B8G=(LoadInteger(hashtable019,(Cache),(704)))
  local integer W7F=(LoadInteger(hashtable019,(Cache),(713)))
  if B8G==(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif GetTriggerEvalCount(t)>(15-W7F)and IsDead(Source)==false then
    call UnitRemoveAbility(Source,B8G)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  return false
endfunction

function B9G takes unit Source,integer B8G,real DRD returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function B7G))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(704),(B8G))
  call SaveInteger(hashtable019,(GetHandleId(Source)),(704),(-1))
  call SaveInteger(hashtable019,(Cache),(713),(R2I((TimerGetElapsed(GlobalTimer))-DRD)))
  set t=null
endfunction

function BDG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer B8G=(LoadInteger(hashtable019,(Cache),(704)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local integer Level=IMaxIF(GetUnitAbilityLevel(Source,'A27H'),GetUnitAbilityLevel(Source,'A30J'))
  local real DRD=(LoadReal(hashtable019,(Cache),(411)))
  if GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT and GetTriggerEventId()!=EVENT_WIDGET_DEATH then
    if Count==0 then
      call SaveInteger(hashtable019,(Cache),(34),(1))
      call DisplayTimedTextToPlayer(GetOwningPlayer(Source),0,0,10,"|c00ff0303"+GetObjectName('n0LW')+"|r")
    else
      call B4G(Source)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),B8G,false)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call B9G(Source,B8G,DRD)
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if (GetSpellAbilityId()=='A27H' or GetSpellAbilityId()=='A30J') then
      call B4G(Source)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),B8G,false)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      call B9G(Source,B8G,DRD)
    elseif GetSpellAbilityId()==B8G then
      call SaveReal(hashtable019,(Cache),(411),(((TimerGetElapsed(GlobalTimer)))*1.))
    endif
  elseif GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call B4G(Source)
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),B8G,false)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call B9G(Source,B8G,DRD)
  endif
  set t=null
  set Source=null
  return false
endfunction

function BEG takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer B8G=(LoadInteger(hashtable019,(Cache),(704)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real BFG=60*(2+IMaxIF(GetUnitAbilityLevel(Source,'A27H'),GetUnitAbilityLevel(Source,'A30J')))
  local integer id=GetPlayerId(GetOwningPlayer(Source))
  local boolean canSteal=(GetUnitAbilityLevel(Source,B8G)==0)
  local integer i=1
  call PlaySoundAtPos(sound042,GetUnitX(Source),GetUnitY(Source))
  loop
    exitwhen i>4+NumberOfExtraAbilities or canSteal==false
    if SkillID[PlayerSkillNumber[id*PlayerSkillOffset+i]]==B8G then
      set canSteal=false
    endif
    if AlternateSkillID[PlayerSkillNumber[id*PlayerSkillOffset+i]]==B8G then
      set canSteal=false
    endif
    set i=i+1
  endloop
  if canSteal then
    if(LoadInteger(hashtable019,(GetHandleId(Target)),(3000)))>0 then
      call SaveInteger(hashtable019,(GetHandleId(Source)),(3000),((LoadInteger(hashtable019,(GetHandleId(Target)),(3000)))))
    endif
    if(LoadInteger(hashtable019,(GetHandleId(Target)),(3001)))>0 then
      call SaveInteger(hashtable019,(GetHandleId(Source)),(3001),((LoadInteger(hashtable019,(GetHandleId(Target)),(3001)))))
    endif
    if(LoadInteger(hashtable019,(GetHandleId(Target)),(3002)))>0 then
      call SaveInteger(hashtable019,(GetHandleId(Source)),(3002),((LoadInteger(hashtable019,(GetHandleId(Target)),(3002)))))
    endif
    if(LoadInteger(hashtable019,(GetHandleId(Target)),(710)))>0 then
      call SaveInteger(hashtable019,(GetHandleId(Source)),(710),((LoadInteger(hashtable019,(GetHandleId(Target)),(710)))))
    endif
    call TextTagOnUnit(GetObjectName(B8G),3.5,Source,.024,170,0,255,216)
    call SaveInteger(hashtable019,(GetHandleId(Source)),(704),(B8G))
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),B8G,true)
    call UnitAddAbility2(Source,B8G)
    call SetUnitAbilityLevel(Source,B8G,Level)
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveInteger(hashtable019,(Cache),(34),(0))
    call SaveInteger(hashtable019,(Cache),(704),(B8G))
    call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
    call TriggerRegisterTimerEvent(t,BFG,false)
    call TriggerRegisterDeathEvent(t,Source)
    call TriggerRegisterTimerEvent(t,BFG-20,false)
    call TriggerAddCondition(t,Condition(function BDG))
  else
    call TextTagOnUnit("Failed ;(",3.5,Source,.024,170,0,255,216)
  endif
  set t=null
  set Source=null
  set Target=null
endfunction

function BGG takes unit Source,unit Target,integer B8G,integer Level returns nothing
  local trigger t=AddProjectile(Target,Source,'h0DB',"BEG",900,false)
  local integer Cache=GetHandleId(t)
  call PlaySoundAtPos(sound041,GetUnitX(Target),GetUnitY(Target))
  call TextTagOnUnit(GetObjectName(B8G),3.75,Target,.024,170,0,255,216)
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(704),(B8G))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  set t=null
endfunction

function BHG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if integers141(GetSpellAbilityId()) then
    else
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    endif
  else
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function GetAghaVersion takes integer id returns integer
  local integer i=1
  loop
    exitwhen i>AghaCounter
    if id==AghaUpgradedSpellID[i] or id==AghaBaseSpellID[i]  then
      return i
    endif
    
    set i=i+1
  endloop
  return 0
endfunction

function BIG takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  
  local integer id=LoadInteger(hashtable019,(GetHandleId(Target)),(705))
  local boolean b=GetSpellAbilityId()=='A30J'
  if(id)!=0 then
    if b then//upgraded
      if GetAghaVersion(id)>0 then
        set id=AghaUpgradedSpellID[GetAghaVersion(id)]
      endif
    else
      if GetAghaVersion(id)>0 then
        set id=AghaBaseSpellID[GetAghaVersion(id)]
      endif
    endif
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Nebula.mdx",Target,"origin"))
    call BGG(Source,Target,id,LoadInteger(hashtable019,GetHandleId(Target),712))
  endif
  set Source=null
  set Target=null
endfunction

function Rubick_SpellSteal takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call BIG()
  endif
endfunction

function BKG takes nothing returns nothing
  call A0G('A1WH')
  call A0G('ANcr')
  call A0G('QB0K')
  call A0G('A03G')
  call A0G('QM00')
  call A0G('A093')
  call A0G('QM02')
  call A0G('A15J')
  call A0G('QM03')
  call A0G('A0AG')
  call A0G('A0BE')
  call A0G('A1TX')
  call A0G('A229')
  call A0G('A1RI')
  call A0G('A1C0')
  call A0G('A11T')
  call A0G('QM01')
  call A0G('A19Z')
  call A0G('QM04')
  call A0G('A13D')
  call A0G('A21J')
  call A0G('A1QV')
  call A0G('A1TU')
  call A0G('A2O2')
  call A0G('A24A')
  call A0G('A24B')
  call A0G('A1NH')
  call A0G('A20N')
  call A0G('A1Z2')
  call A0G('A1Z3')
  call A0G('A205')
  call A0G('A1VU')
  call A0G('A0GC')
  call A0G('A24E')
  call A0G('A0RT')
  call A0G('A1RA')
  call A0G('A0HA')
  call A0G('A0SA')
  call A0G('A121')
  call A0G('A1WF')
  call A0G('A02T')
  call A0G('A1S9')
  call A0G('A21H')
  call A0G('A1MN')
  call A0G('A0KX')
  call A0G('A0KW')
  call A0G('A0A5')
  call A0G('A0BG')
  call A0G('Z234')
  call A0G('A32D')
  call A0G('A21W')
  call A0G('A21X')
  call A0G('A21V')
  call A0G('A21Y')
  call A0G('A1GU')
  call A0G('A1VH')
  call A0G('A1VG')
  call A0G('A0QN')
  call A0G('A026')
  call A0G('AHfa')
  call A0G('A09V')
  call A0G('A0DY')
  call A0G('A1WB')
  call A0G('A0LZ')
  call A0G('A0OI')
  call A0G('A1NA')
  call A0G('A1EA')
  call A0G('QB03')
  call A0G('A0NS')
  call A0G('A1DA')
  call A0G('A28Q')
  call A0G('A0WQ')
  call A0G('A1T8')
  call A0G('A10R')
  call A0G('A11N')
  call A0G('A0EY')
  call A0G('A0FH')
  call A0G('A0VK')
  call A0G('A0VQ')
  call A0G('A073')
  call A0G('A03J')
  call A0G('A04J')
  call A0G('A04M')
  call A0G('A04N')
  call A0G('A27F')
  call A0G('A27X')
  call A0G('A27G')
  
  call A0G('A27H')
  call A0G('A30J')
  
  call A0G('A0Q5')
  call A0G('A0TK')
  call A0G('AIbk')
  call A0G('A0JY')
  call A0G('A1AC')
  call A0G('AIpl')
  call A0G('AIpr')
  call A0G('Aeat')
  call A0G('ANTG')
  call A0G('ANLS')
  call A0G('A0K0')
  call A0G('A0H7')
  call A0G('A0H6')
  call A0G('A0FO')
  call A0G('A02X')
  call A0G('AIsw')
  call A0G('AItb')
  call A0G('A0B6')
  call A0G('A1R5')
  call A0G('A206')
  call A0G('A1FD')
  call A0G('A1FO')
  call A0G('A1FQ')
  call A0G('A1IO')
  call A0G('A0B8')
  call A0G('A1WE')
  call A0G('A0T8')
  call A0G('A0T7')
  call A0G('A017')
  call A0G('A1QD')
  call A0G('A1FP')
  call A0G('A0JL')
  call A0G('ACch')
  call A0G('AIxk')
  call A0G('AIpg')
  call A0G('A11F')
  call A0G('A11E')
  call A0G('A0S3')
  call A0G('A11D')
  call A0G('A11G')
  call A0G('A11H')
  call A0G('A2LI')
  call A0G('A0T9')
  call A0G('A15W')
  call A0G('AChx')
  call A0G('A0FD')
  call A0G('A0TE')
  call A0G('A1T7')
  call A0G('A19M')
  call A0G('A02O')
  call A0G('A08Y')
  call A0G('A08Z')
  call A0G('A090')
  call A0G('A092')
  call A0G('A0HB')
  call A0G('A0D3')
  call A0G('A0DF')
  call A0G('A02W')
  call A0G('A0CK')
  call A0G('A0K7')
  call A0G('A0JT')
  call A0G('AIda')
  call A0G('A269')
  call A0G('A1WO')
  call A0G('A1EW')
  call A0G('A1MO')
  call A0G('A1ZI')
  call A0G('A1ZH')
  call A0G('A1ZW')
  call A0G('A231')
  call A0G('A12W')
  call A0G('A14A')
  call A0G('A1Q8')
  call A0G('A28Y')
  call A0G('A28D')
  call A0G('A28F')
  call A0G('A2JO')
  call A0G('A2JQ')
  call A0G('A2JP')
  call A0G('A2JR')
  call A0G('A2JL')
  call A0G('A2FX')
  call A0G('A2K1')
  call A0G('A2K4')
  call A0G('A2K7')
  call A0G('A2KG')
  call A0G('A2KE')
  call A0G('A2KH')
  call A0G('A2K9')
  call A0G('A2EA')
  call A0G('A2N1') // shadow amulet
endfunction

function Func1046 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function integer560))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function integer559))
  set t=null
  call BKG()
endfunction

function BMG takes nothing returns nothing
  if IsUnitBADWithSpellbooks(GetEnumUnit())then
    return
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A27S')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A27S')
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A27Q')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A27Q')
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A27R')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A27R')
  endif
  if GetUnitAbilityLevel(GetEnumUnit(),'A27T')>0 then
    call UnitRemoveAbility(GetEnumUnit(),'A27T')
  endif
endfunction

function BNG takes nothing returns nothing
  if IsUnitBADWithSpellbooks(GetEnumUnit())then
    return
  endif
  if OQ8==1 then
    if GetUnitAbilityLevel(GetEnumUnit(),'A27S')==0 then
      call UnitAddAbility2(GetEnumUnit(),'A27S')
    endif
  elseif OQ8==2 then
    if GetUnitAbilityLevel(GetEnumUnit(),'A27Q')==0 then
      call UnitRemoveAbility(GetEnumUnit(),'A27S')
      call UnitAddAbility2(GetEnumUnit(),'A27Q')
    endif
  elseif OQ8==3 then
    if GetUnitAbilityLevel(GetEnumUnit(),'A27R')==0 then
      call UnitRemoveAbility(GetEnumUnit(),'A27S')
      call UnitRemoveAbility(GetEnumUnit(),'A27Q')
      call UnitAddAbility2(GetEnumUnit(),'A27R')
    endif
  elseif OQ8==4 then
    if GetUnitAbilityLevel(GetEnumUnit(),'A27T')==0 then
      call UnitRemoveAbility(GetEnumUnit(),'A27S')
      call UnitRemoveAbility(GetEnumUnit(),'A27Q')
      call UnitRemoveAbility(GetEnumUnit(),'A27R')
      call UnitAddAbility2(GetEnumUnit(),'A27T')
    endif
  endif
endfunction

function BOG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local group GGF=(LoadGroupHandle(hashtable019,(Cache),(340)))
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local group g=GetAvailableGroup()
  if Source==null or GetUnitTypeId(Source)!='E02X' then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call ForGroup(GGF,function BMG)
    call KillGroup(GGF)
    call KillGroup(g)
    return false
  endif
  set tt_unit1=Source
  set OQ8=GetUnitAbilityLevel(Source,'P211') //A27V
  if IsDead(Source)==false then
    call GroupEnumUnitsInRange(g,x,y,925,Condition(function Func1661))
  endif
  call GroupRemoveGroup(g,GGF)
  call ForGroup(GGF,function BMG)
  if IsDead(Source)==false then
    call ForGroup(g,function BNG)
  endif
  call SaveGroupHandle(hashtable019,(Cache),(340),(g))
  call KillGroup(GGF)
  set t=null
  set Source=null
  set GGF=null
  set g=null
  return false
endfunction

function Rubick_NullField_Learn takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  call TriggerRegisterTimerEvent(t,.3,true)
  call TriggerAddCondition(t,Condition(function BOG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveGroupHandle(hashtable019,(Cache),(340),(GetAvailableGroup()))
  set t=null
  set Source=null
endfunction

function BQG takes nothing returns boolean
  if (GetLearnedSkill()=='A27V' or GetLearnedSkill()=='QP0P') and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call Rubick_NullField_Learn()
  endif
  return false
endfunction

function US9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function BQG))
  set t=null
endfunction

function BRG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call AddUnitAnimationProperties(Source,"alternate",false)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function BSG takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerAddCondition(t,Condition(function BRG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=null
  set Source=null
endfunction

function Banshee_Exorcism takes nothing returns nothing
  if GetUnitTypeId(GetTriggerUnit())=='E02X' then
    call BSG()
  endif
endfunction

function BUG takes nothing returns nothing
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",GetTriggerUnit(),"origin"))
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",GetTriggerUnit(),"origin"))
endfunction

function BVG takes nothing returns boolean
  if GetUnitTypeId(GetTriggerUnit())=='H00S' then
    call BUG()
  endif
  return false
endfunction

function R29 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function BVG))
  set t=null
endfunction


function BBG takes nothing returns nothing
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\ImmolationRed\\ImmolationRedDamage.mdl",GetEnumUnit(),"chest"))
  call DamageTarget(OR8,GetEnumUnit(),1,(20+10*OS8)/ 5)
endfunction

function BCG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Level=GetUnitAbilityLevel(Source,'A2HS')
  local group g
  if GetUnitAbilityLevel(Source,'B0FP')==0 and GetUnitAbilityLevel(Source,'B0FQ')==0 then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call UnitRemoveAbility(Source,'A2H7')
    call UnitRemoveAbility(Source,'B0FO')
    call UnitRemoveAbility(Source,'A2IX')
    call UnitRemoveAbility(Source,'A2IW')
    call UnitRemoveAbility(Source,'A2IV')
    call UnitRemoveAbility(Source,'A2IY')
  else
    set tt_unit1=Source
    set OR8=Source
    set OS8=Level
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),400+25,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function BBG)
    call KillGroup(g)
  endif
  set g=null
  set t=null
  set Source=null
  return false
endfunction

function Xin_FlameGuard takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
  local integer Level=GetUnitAbilityLevel(Source,'A2HS')
  call UnitAddAbility(Caster,'A2H5')
  call SetUnitAbilityLevel(Caster,'A2H5',Level)
  call IssueTargetOrderById(Caster,852186,Source)
  call TriggerRegisterTimerEvent(t,.2,true)
  call TriggerAddCondition(t,Condition(function BCG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\FlameGuard.mdx",Source,"origin")))
  if Level==1 then
  elseif Level==2 then
  elseif Level==3 then
  elseif Level==4 then
  endif
  set Source=null
  set Caster=null
  set t=null
endfunction

function BLG takes unit Source returns nothing
  call UnitRemoveAbility(Source,'BOhx')
  call UnitRemoveAbility(Source,'B00H')
endfunction

function B1G takes unit Source returns nothing
  call UnitRemoveAbility(Source,'A2H9')
  call UnitRemoveAbility(Source,'B0FM')
endfunction

function B0G takes unit Source returns nothing
  call UnitRemoveAbility(Source,'A2JH')
  call UnitRemoveAbility(Source,'A2JG')
  call UnitRemoveAbility(Source,'A2JJ')
  call UnitRemoveAbility(Source,'A2JI')
  call UnitRemoveAbility(Source,'B0FL')
endfunction

function SleithOfFistGrow takes unit Source returns nothing
  local integer pid=GetPlayerId(GetOwningPlayer(Source))
  local boolean isranged
  local integer lvl
  if GetUnitAbilityLevel(Source,'A0CY')>0 or GetUnitAbilityLevel(Source,'QP1K')>0 then
    set isranged=IsUnitType(Source,UNIT_TYPE_RANGED_ATTACKER)==true or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+1]],"range morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+2]],"range morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+3]],"range morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+4]],"range morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+5]],"range morph",null) or RA8(StackingLimitations[PlayerSkillNumber[pid*PlayerSkillOffset+6]],"range morph",null)
    if GetUnitAbilityLevel(Source,'A0CY')>0 then
      set lvl=GetUnitAbilityLevel(Source,'A0CY')
    elseif GetUnitAbilityLevel(Source,'QP1K')>0 then
      set lvl=GetUnitAbilityLevel(Source,'QP1K')
    endif
    if isranged==false then
      //call BJDebugMsg("melee")
      call UnitAddAbility2(Source,'QF90'-1+lvl)
    else
      call UnitAddAbility2(Source,'QF92'+lvl)
    endif
  endif
  
endfunction

function B5G takes unit Source returns nothing
  call UnitAddAbility2(Source,'A2H9')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2H9',false)
endfunction

function B2G takes unit Source returns nothing
  local integer Level=GetUnitAbilityLevel(Source,'A2H0')+GetUnitAbilityLevel(Source,'QB0L')
  if Level<1 then
    return
  endif
  if Level==1 then
    call UnitAddAbility2(Source,'A2JH')
  elseif Level==2 then
    call UnitAddAbility2(Source,'A2JG')
  elseif Level==3 then
    call UnitAddAbility2(Source,'A2JJ')
  else
    call UnitAddAbility2(Source,'A2JI')
  endif
endfunction

function C4G takes unit Source,unit Target returns nothing
  local real a=GetRandomReal(0,360)
  local real x=GetUnitX(Target)+50*Cos(a*bj_DEGTORAD)
  local real y=GetUnitY(Target)+50*Sin(a*bj_DEGTORAD)
  call SetUnitPosition(Source,x,y)
  call SetUnitFacing(Source,bj_RADTODEG*Atan2(GetUnitY(Target)-GetUnitY(Source),GetUnitX(Target)-GetUnitX(Source)))
  call SetUnitAnimation(Source,"Attack")
  call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Fire_Blink_2.mdx",Source,"chest"))
  call B0G(Source)
  if IsUnitType(Target,UNIT_TYPE_HERO) or IsUnitIllusion(Target) then
    call B2G(Source)
    call UnitRemoveAbility(Source,'A2JF')
    if(Mode_EB) then
      if(GetUnitAbilityLevel(Source,'A1J2')>0) then
        call SetUnitAbilityLevel(Source,'A1J2',2)
        //call BJDebugMsg("1")
      elseif(GetUnitAbilityLevel(Source,'A1IT')>0) then
        call SetUnitAbilityLevel(Source,'A1IT',2)
        //call BJDebugMsg("2")
      elseif(GetUnitAbilityLevel(Source,'A1J1')>0) then
        call SetUnitAbilityLevel(Source,'A1J1',2)
        //call BJDebugMsg("3")
      elseif(GetUnitAbilityLevel(Source,'A1J0')>0) then
        call SetUnitAbilityLevel(Source,'A1J0',2)
        //call BJDebugMsg("4")
      endif
    endif
  else
    call UnitAddAbility2(Source,'A2JF')
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2JF',false)
  endif
  call IssueTargetOrderById(Source,851983,Target)
endfunction

function C7G takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local real SourceX=(LoadReal(hashtable019,(Cache),(189)))
  local real SourceY=(LoadReal(hashtable019,(Cache),(190)))
  local group AlreadyHit=(LoadGroupHandle(hashtable019,(Cache),(187)))
  local group g=(LoadGroupHandle(hashtable019,(Cache),(22)))
  local unit Target=null
  local boolean found=false
  local fogmodifier Z58=(LoadFogModifierHandle(hashtable019,(Cache),(42)))
  local integer Level=GetUnitAbilityLevel(Source,'A2H0')
  local trigger tt
  local integer h
  local string s=LoadStr(HeroStats,GetUnitTypeId(Source),COLOR)
  local integer r=255
  local integer gr=255
  local integer b=255
  if(s!="" and s!=null)then
    set r=S2I(SubString(s,0,3))
    set gr=S2I(SubString(s,3,6))
    set b=S2I(SubString(s,6,9))
  endif
  if Level<1 then
    set Level=GetUnitAbilityLevel(Source,'QB0L')
  endif
  //local integer MorphID=(LoadInteger(HY,(Cache),(25)))
  loop
    exitwhen FirstOfGroup(g)==null or found
    set Target=FirstOfGroup(g)
    call GroupRemoveUnit(g,Target)
    if IsUnitInGroup(Target,AlreadyHit)and Target!=null then
      set Target=null
      set found=false
    else
      set found=true
    endif
  endloop
  call SetUnitPathing(Source,false)
  call SetUnitInvulnerable(Source,true)
  call L48(Source)
  if found==false or((LoadInteger(hashtable019,(GetHandleId((Source))),((4319))))==1) then
    call SaveInteger(hashtable019,(GetHandleId((Source))),((4318)),(2))
    call B1G(Source)
    call UnitRemoveAbility(Source,'QF90')
    call UnitRemoveAbility(Source,'QF91')
    call UnitRemoveAbility(Source,'QF92')
    call UnitRemoveAbility(Source,'QF93')
    call UnitRemoveAbility(Source,'QF94')
    call UnitRemoveAbility(Source,'QF95')
    call UnitRemoveAbility(Source,'A2JF')
    call B0G(Source)
    call L48(Source)
    call BLG(Source)
    //call SaveInteger(HY,GetHandleId(LoadTriggerHandle(HY,GetHandleId(Source),'0PAS')),100,1)
    //call TriggerEvaluate(LoadTriggerHandle(HY,GetHandleId(Source),'0PAS'))  //FORCE DISABLE PASSIVES WHEN MORPHING BACK
    call UnitAddAbility(Source,'A2H2')
    call UnitRemoveAbility(Source,'A2H2')
    
    call UnMorphUnit(Source,LoadInteger(hashtable019,Cache,25))
    call RemoveAbilsForUnit(Source)
    //if GetUnitTypeId(Source)!='N0M0'then
    //	call UnitAddAbility(Source,MorphID)
    //	call UnitRemoveAbility(Source,MorphID)
    //endif
    call L48(Source)
    if((LoadInteger(hashtable019,(GetHandleId((Source))),((4319))))==1)==false then
      call SetUnitX(Source,SourceX)
      call SetUnitY(Source,SourceY)
    endif
    call SetUnitVertexColor(Source,r,gr,b,255)
    call SetUnitPathing(Source,true)
    call SetUnitInvulnerable(Source,false)
    if GetUnitAbilityLevel(Source,'A0MQ')+GetUnitAbilityLevel(Source,'A1B6')>0 then
      call SetPlayerAbilityAvailable(GetOwningPlayer(Source),'A0MQ',true)
      call SetPlayerAbilityAvailable(GetOwningPlayer(Source),'A1B6',true)
    endif
    call SetUnitTimeScale(Source,1)
    call KillGroup(AlreadyHit)
    call KillGroup(g)
    call RemoveUnit((LoadUnitHandle(hashtable019,(Cache),(19))))
    call FogModifierStop(Z58)
    call DestroyFogModifier(Z58)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call GroupAddUnit(AlreadyHit,Target)
    call C4G(Source,Target)
  endif
  set Z58=null
  set t=null
  set Source=null
  set Target=null
  set g=null
  set tt=null
  set AlreadyHit=null
  return false
endfunction

function Xin_SleightOfFist takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local fogmodifier Z58=CreateFogModifierRadius(GetOwningPlayer(Source),FOG_OF_WAR_VISIBLE,x,y,600,true,true)
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'h0E7',GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
  local group g=GetAvailableGroup()
  local integer Level=IMaxIF(GetUnitAbilityLevel(Source,'A2H0'),GetUnitAbilityLevel(Source,'QB0L'))
  local integer id=W28(GetUnitTypeId(Source))
  local trigger tt
  local integer h
  local string s=LoadStr(HeroStats,GetUnitTypeId(Source),COLOR)
  local integer r=255
  local integer gr=255
  local integer b=255
  if(s!="" and s!=null)then
    set r=S2I(SubString(s,0,3))
    set gr=S2I(SubString(s,3,6))
    set b=S2I(SubString(s,6,9))
  endif
  if Mode_EB then
    call SleithOfFistGrow(Source)
  endif
  //local integer MorphID=GetMorphId(HeroTypeId[GetPlayerId(GetOwningPlayer(Source))])
  call UnitRemoveAbility(Source,'B01N')
  call UnitRemoveAbility(Source,'Aetl')
  call SetUnitVertexColor(Caster,255,255,255,100)
  call FogModifierStart(Z58)
  call SaveInteger(hashtable019,(GetHandleId((Source))),((4318)),(1))
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x,y,150+100*Level+25,Condition(function LZ8))
  call L48(Source)
  call BLG(Source)
  call SaveInteger(hashtable019,GetHandleId(LoadTriggerHandle(hashtable019,GetHandleId(Source),'0PAS')),100,1)
  call TriggerEvaluate(LoadTriggerHandle(hashtable019,GetHandleId(Source),'0PAS'))  //FORCE DISABLE PASSIVES WHEN MORPHING
  if GetUnitAbilityLevel(Source,'A0MQ')+GetUnitAbilityLevel(Source,'A1B6')>0 then
    call SetPlayerAbilityAvailable(GetOwningPlayer(Source),'A0MQ',false)
    call SetPlayerAbilityAvailable(GetOwningPlayer(Source),'A1B6',false)
  endif
  //if GetUnitTypeId(Source)!='N0M0'then
  //	call UnitAddAbility(Source,MorphID)
  //	call UnitRemoveAbility(Source,MorphID)
  //endif
  
  call SaveInteger(hashtable019,(Cache),25,MorphUnit(Source)+1)
  call UnitAddAbility(Source,'A2H1')
  call UnitRemoveAbility(Source,'A2H1')
  call RemoveAbilsForUnit(Source)
  call SetUnitVertexColor(Source,r,gr,b,125)
  call SetUnitPathing(Source,false)
  call SetUnitInvulnerable(Source,true)
  call SetUnitTimeScale(Source,3)
  call TriggerRegisterTimerEvent(t,.2,true)
  call TriggerAddCondition(t,Condition(function C7G))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveReal(hashtable019,(Cache),(189),((GetUnitX(Source))*1.))
  call SaveReal(hashtable019,(Cache),(190),((GetUnitY(Source))*1.))
  call SaveGroupHandle(hashtable019,(Cache),(187),(GetAvailableGroup()))
  call SaveGroupHandle(hashtable019,(Cache),(22),(g))
  call SaveFogModifierHandle(hashtable019,(Cache),(42),(Z58))
  call SaveUnitHandle(hashtable019,(Cache),(19),(Caster))
  //call SaveInteger(HY,(Cache),(25),MorphID+1)
  call B5G(Source)
  call TriggerEvaluate(t)
  set Source=null
  set t=null
  set Z58=null
  set Caster=null
  set g=null
  set tt=null
endfunction

function CDG takes nothing returns boolean
  local unit W39=GetSummonedUnit()
  if IsUnitIllusion(W39) and GetUnitTypeId(W39)=='N0MH' then
    call B1G(W39)
    call UnitRemoveAbility(W39,'A2JF')
    call B0G(W39)
    call UnitAddAbility(W39,'A2H2')
    call UnitRemoveAbility(W39,'A2H2')
  endif
  set W39=null
  return false
endfunction

function SleightOfFistAbuseStop takes nothing returns boolean
  if GetSpellAbilityId()=='QB0L' or GetSpellAbilityId()=='A2H0' then
    if GetUnitAbilityLevel(GetTriggerUnit(),'Aetl')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B01N')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B15V')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'Abun')>0 or GetUnitAbilityLevel(GetTriggerUnit(),'B08Y')>0 then
      call InterruptUnit(GetTriggerUnit())
      call Error(GetOwningPlayer(GetTriggerUnit()),"Cannot use this now.")
    endif
  endif
  
  
  return false
endfunction

function UW9 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddCondition(t,Condition(function CDG))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddCondition(t,Condition(function SleightOfFistAbuseStop))
  set t=null
endfunction

function unit151 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=GetUnitAbilityLevel(Source,'A2H3')
  local integer RHE=2
  if Level>2 then
    set RHE=3
  endif
  if GetTriggerEvalCount(t)==RHE then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  call DamageTarget(Source,Target,1,20+20*Level)
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function CFG takes nothing returns nothing
  local unit Source=tt_unit1
  local unit Target=tt_unit2
  local unit Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call UnitAddAbility(Caster,'A2H4')
  call IssueTargetOrderById(Caster,852106,Target)
  call TriggerAddCondition(t,Condition(function unit151))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call TriggerRegisterTimerEvent(t,0,false)
  call TriggerRegisterTimerEvent(t,1,true)
  set Caster=null
  set Source=null
  set Target=null
  set t=null
endfunction

function Xin_SearingChains takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local group g=GetAvailableGroup()
  local real x=GetUnitX(Source)
  local real y=GetUnitY(Source)
  local unit u1=null
  local unit u2=null
  local unit u3=null
  local integer AUD=0
  local unit u
  local trigger t
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,x,y,425,Condition(function NonImmuneVisibleEnemyFilter))
  loop
    exitwhen FirstOfGroup(g)==null or AUD==2
    set u=GroupPickRandomUnit(g)
    if u!=null then
      if AUD==0 then
        set u1=u
      elseif AUD==1 then
        set u2=u
      elseif AUD==2 then
        set u3=u
      endif
      set AUD=AUD+1
      call GroupRemoveUnit(g,u)
    endif
  endloop
  call KillGroup(g)
  if u1!=null then
    call AddProjectile(Source,u1,'h0E0',"CFG",9000,false)
  endif
  if u2!=null then
    call AddProjectile(Source,u2,'h0E0',"CFG",9000,false)
  endif
  if u3!=null then
    call AddProjectile(Source,u3,'h0E0',"CFG",9000,false)
  endif
  set g=null
  set Source=null
  set u=null
  set u1=null
  set u2=null
  set u3=null
  set t=null
endfunction

function CIG takes nothing returns boolean
  local unit Source=(LoadUnitHandle(hashtable019,(GetHandleId(GetTriggeringTrigger())),(2)))
  local integer Cache=GetHandleId(Source)
  local integer i=0
  local real UK8=(TimerGetElapsed(GlobalTimer))
  local integer CJG=(LoadInteger(hashtable019,(Cache),(749)))
  local real x
  local real y
  local real t
  loop
    exitwhen i>CJG
    set t=(LoadReal(hashtable019,(Cache),(10000+i)))
    if t+10>UK8 then
      set x=(LoadReal(hashtable019,(Cache),(11000+i)))
      set y=(LoadReal(hashtable019,(Cache),(12000+i)))
    endif
    set i=i+1
  endloop
  set Source=null
  return false
endfunction

function CKG takes integer Cache,integer CJG,real AO8,real AP8 returns boolean
  local real x
  local real y
  local real t
  local integer i=0
  local real UK8=(TimerGetElapsed(GlobalTimer))
  loop
    exitwhen i>CJG
    set t=(LoadReal(hashtable019,(Cache),(10000+i)))
    if t+10>UK8 then
      set x=(LoadReal(hashtable019,(Cache),(11000+i)))
      set y=(LoadReal(hashtable019,(Cache),(12000+i)))
      if DistanceBetweenXY(x,y,AO8,AP8)<75 then
        return true
      endif
    endif
    set i=i+1
  endloop
  return false
endfunction

function CMG takes integer Cache,integer CJG returns integer
  local real t
  local integer i=0
  local real UK8=(TimerGetElapsed(GlobalTimer))
  loop
    exitwhen i>CJG
    set t=(LoadReal(hashtable019,(Cache),(10000+i)))
    if t+10<UK8 then
      return i
    endif
    set i=i+1
  endloop
  return-1
endfunction

function CNG takes unit Source,integer COG,real x,real y returns nothing
  local integer Cache=GetHandleId(Source)
  local integer CJG=(LoadInteger(hashtable019,(Cache),(749)))
  local integer CPG
  if CKG(Cache,CJG,x,y)then
    return
  endif
  set CPG=CMG(Cache,CJG)
  if CPG==-1 then
    set CPG=CJG
    set CJG=CJG+1
    call SaveInteger(hashtable019,(Cache),(749),(CJG))
  endif
  call SaveInteger(hashtable019,(Cache),(13000),(COG))
  call SaveReal(hashtable019,(Cache),(10000),(((TimerGetElapsed(GlobalTimer)))*1.))
  call SaveReal(hashtable019,(Cache),(11000),((x)*1.))
  call SaveReal(hashtable019,(Cache),(11000),((y)*1.))
endfunction

function CQG takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function CIG))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set Source=null
  set t=null
endfunction

function CRG takes nothing returns nothing
  call DamageTarget(OU8,GetEnumUnit(),1,50+OT8*50)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\LordofFlameMissile\\LordofFlameMissile.mdl",GetEnumUnit(),"origin"))
endfunction

function CSG takes unit Source,unit S4E,real x,real y returns nothing
  local group g
  call KillUnit(S4E)
  call ZD8("war3mapImported\\Firaga_2.mdx",x,y,2)
  set g=GetAvailableGroup()
  set tt_unit1=Source
  set OU8=Source
  set OT8=GetUnitAbilityLevel(Source,'A2JK')
  call GroupEnumUnitsInRange(g,x,y,450+25,Condition(function DefaultEnemyFilter))
  call UnitRemoveAbility(Source,'A04R')
  call ForGroup(g,function CRG)
  call UnitAddAbility2(Source,'A04R')
  call KillGroup(g)
  set g=null
endfunction

function CTG takes unit Source,unit CUG returns nothing
  local integer Cache=GetHandleId(Source)
  local integer CVG=(LoadInteger(hashtable019,(Cache),(746)))
  local unit CWG
  local integer i=1
  local integer x
  loop
    exitwhen i>CVG
    set CWG=(LoadUnitHandle(hashtable019,(Cache),(1450+i)))
    if CWG==CUG then
      set CVG=CVG-1
      call SaveUnitHandle(hashtable019,(Cache),(1450+i),((LoadUnitHandle(hashtable019,(Cache),(1450+i+1)))))
      call SaveInteger(hashtable019,(Cache),(746),(CVG))
      set x=i+1
      loop
        exitwhen x>CVG
        call SaveUnitHandle(hashtable019,(Cache),(1450+x),((LoadUnitHandle(hashtable019,(Cache),(1450+x+1)))))
        set x=x+1
      endloop
    endif
    set i=i+1
  endloop
  set CWG=null
endfunction

function CXG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit S4E=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local real NHE=GetUnitX(S4E)
  local real NIE=GetUnitY(S4E)
  local real TargetX=(LoadReal(hashtable019,(Cache),(47)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(48)))
  local real a=AngleBetweenXY(NHE,NIE,TargetX,TargetY)*bj_DEGTORAD
  local real AO8
  local real AP8
  local real d=DistanceBetweenXY(NHE,NIE,TargetX,TargetY)
  local real rate=GetUnitMoveSpeedLOD(Source)*2.5*.02
  if GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call CTG(Source,S4E)
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(177))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif d<2 then
    call SetUnitAnimationByIndex(S4E,1)
  else
    if d<rate then
      set AO8=TargetX
      set AP8=TargetY
    else
      set AO8=NHE+rate*Cos(a)
      set AP8=NIE+rate*Sin(a)
    endif
    call SetUnitX(S4E,AO8)
    call SetUnitY(S4E,AP8)
  endif
  set t=null
  set Source=null
  set S4E=null
  return false
endfunction

function CYG takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real a=AngleBetweenXY(GetUnitX(Source),GetUnitY(Source),GetSpellTargetX(),GetSpellTargetY())*bj_DEGTORAD
  local integer Cache=GetHandleId(Source)
  local integer CVG=(LoadInteger(hashtable019,(Cache),(746)))
  local integer Level=GetUnitAbilityLevel(Source,'A2JK')
  local unit CWG=(LoadUnitHandle(hashtable019,(Cache),(1450+1)))
  local unit CZG=CreateUnit(GetOwningPlayer(Source),'h0E8',GetUnitX(Source),GetUnitY(Source),a*bj_RADTODEG)
  local trigger t
  local integer i=1
  set CVG=CVG+1
  call SaveUnitHandle(hashtable019,(Cache),(1450+CVG),(CZG))
  call SaveInteger(hashtable019,(Cache),(746),(CVG))
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call SetUnitVertexColor(CZG,255,255,255,75)
  call SetUnitTimeScale(CZG,2)
  call SetUnitAnimationByIndex(CZG,0)
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerAddCondition(t,Condition(function CXG))
  call TriggerRegisterDeathEvent(t,CZG)
  call UnitApplyTimedLife(CZG,'BTLF',45)
  call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx",CZG,"hand right alternate")))
  call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx",CZG,"hand left alternate")))
  call SaveEffectHandle(hashtable019,(Cache),(177),(AddSpecialEffectTarget("war3mapImported\\FlameDash_Ground.mdx",CZG,"origin")))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(19),(CZG))
  call SaveReal(hashtable019,(Cache),(47),SafeX50((GetSpellTargetX())*1.))
  call SaveReal(hashtable019,(Cache),(48),SafeY50((GetSpellTargetY())*1.))
  set Source=null
  set t=null
  set CWG=null
  set CZG=null
endfunction

function Xin_FireRemnants takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local integer HTD=(LoadInteger(hashtable019,(GetHandleId(Source)),(747)))
  if HTD>0 then
    call CYG()
    call UnitRemoveAbility(Source,OZ8[HTD])
    set HTD=HTD-1
    call SaveInteger(hashtable019,(GetHandleId(Source)),(747),(HTD))
    call UnitAddAbility2(Source,OZ8[HTD])
  else
    call Error(GetOwningPlayer(GetTriggerUnit()),"No more charges")
  endif
  set Source=null
endfunction

function CBG takes nothing returns boolean
  return GetUnitTypeId(GetFilterUnit())=='h0E8'
endfunction

function CCG takes nothing returns nothing
  local real YR8=DistanceBetweenXY(GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),OV8,OW8)
  if YR8>OX8 and IsDead(GetEnumUnit())==false then
    set OY8=GetEnumUnit()
    set OX8=YR8
  endif
endfunction

function unit155 takes unit Source,real x,real y returns unit
  local group g=GetAvailableGroup()
  set OY8=null
  set OX8=-1
  set OV8=x
  set OW8=y
  call GroupEnumUnitsOfPlayer(g,GetOwningPlayer(Source),Condition(function CBG))
  call ForGroup(g,function CCG)
  call KillGroup(g)
  set g=null
  return OY8
endfunction

function FireRemnant_FindTargetClosest takes nothing returns nothing
  local real YR8=DistanceBetweenXY(GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),OV8,OW8)
  if YR8<OX8 and IsDead(GetEnumUnit())==false then
    set OY8=GetEnumUnit()
    set OX8=YR8
  endif
endfunction

function C6G takes unit u1,unit u2 returns real
  local real TAE=DistanceBetweenUnits(u1,u2)
  local real time=TAE/ 1300.
  if time>.4 then
    return TAE/.4
  endif
  return 1300.
endfunction

function CLG takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real I1G=(LoadReal(hashtable019,(Cache),(47)))
  local real I0G=(LoadReal(hashtable019,(Cache),(48)))
  local unit S4E=(LoadUnitHandle(hashtable019,(Cache),(19)))
  local real NHE=GetUnitX(Source)
  local real NIE=GetUnitY(Source)
  local real TargetX=(LoadReal(hashtable019,(Cache),(6)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(7)))
  local real a
  local real AO8
  local real AP8
  local real d
  local real AJ8=(LoadReal(hashtable019,(Cache),(44)))
  local real rate=AJ8*.02
  local group g
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  if S4E!=null then
    set TargetX=GetUnitX(S4E)
    set TargetY=GetUnitY(S4E)
    call SaveReal(hashtable019,(Cache),(6),((TargetX)*1.))
    call SaveReal(hashtable019,(Cache),(7),((TargetY)*1.))
  endif
  set a=AngleBetweenXY(NHE,NIE,TargetX,TargetY)*bj_DEGTORAD
  set d=DistanceBetweenXY(NHE,NIE,TargetX,TargetY)
  if GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call SaveInteger(hashtable019,(GetHandleId((Source))),((4319)),(2))
    call SetUnitVertexColor(Source,255,255,255,255)
    call SetUnitTimeScale(Source,1)
    call SetUnitAnimationByIndex(Source,0)
    call SetUnitPathing(Source,true)
    call SetUnitInvulnerable(Source,false)
    call UnitRemoveAbility(Source,'A04R')
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(177))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif d<rate then
    call SetUnitX(Source,TargetX)
    call SetUnitY(Source,(TargetY))
    call KillTrees(TargetX,TargetY,100)
    call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
    call CSG(Source,S4E,TargetX,TargetY)
    set S4E=unit155(Source,I1G,I0G)
    if S4E==null then
      call SaveInteger(hashtable019,(GetHandleId((Source))),((4319)),(2))
      
      call SetUnitVertexColor(Source,255,255,255,255)
      call SetUnitTimeScale(Source,1)
      call SetUnitAnimationByIndex(Source,1)
      call SetUnitPathing(Source,true)
      call SetUnitInvulnerable(Source,false)
      call UnitRemoveAbility(Source,'A04R')
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
      call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(177))))
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
    else
      call SaveInteger(hashtable019,(Cache),(34),(Count+1))
      call SaveUnitHandle(hashtable019,(Cache),(19),(S4E))
      call SaveReal(hashtable019,(Cache),(44),((C6G(Source,S4E))*1.))
      call SaveReal(hashtable019,(Cache),(6),((GetUnitX(S4E))*1.))
      call SaveReal(hashtable019,(Cache),(7),((GetUnitY(S4E))*1.))
    endif
  else
    call SetUnitAnimationByIndex(Source,0)
    call SetUnitPathing(Source,false)
    set AO8=NHE+rate*Cos(a)
    set AP8=NIE+rate*Sin(a)
    if IsUnitType(Source,UNIT_TYPE_HERO)then
      call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
    endif
    call SetUnitX(Source,(AO8))
    call SetUnitY(Source,AP8)
    call SaveBoolean(HeroStats,GetHandleId(Source),99,true)
    call KillTrees(AO8,AP8,100)
    call SetUnitFacing(Source,a*bj_RADTODEG)
  endif
  call CNG(Source,Count,GetUnitX(Source),GetUnitY(Source))
  set t=null
  set Source=null
  set S4E=null
  set g=null
  return false
endfunction

function unit157 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)+150)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function Xin_FireRemnantsB takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t
  local integer Cache=GetHandleId(Source)
  local integer CVG=(LoadInteger(hashtable019,(Cache),(746)))
  local unit S4E
  if CVG>0 and((LoadInteger(hashtable019,(GetHandleId((Source))),((4319))))==1)==false then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SetUnitVertexColor(Source,255,0,0,75)
    call SetUnitTimeScale(Source,2)
    call SetUnitAnimationByIndex(Source,0)
    call SetUnitPathing(Source,false)
    call SetUnitInvulnerable(Source,true)
    call UnitAddAbility2(Source,'A04R')
    call SaveInteger(hashtable019,(GetHandleId((Source))),((4319)),(1))
    call TriggerRegisterTimerEvent(t,.02,true)
    call TriggerAddCondition(t,Condition(function CLG))
    call TriggerRegisterDeathEvent(t,Source)
    call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx",Source,"hand right alternate")))
    call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffectTarget("war3mapImported\\Phoenix_Missile_smaller.mdx",Source,"hand left alternate")))
    call SaveEffectHandle(hashtable019,(Cache),(177),(AddSpecialEffectTarget("war3mapImported\\FlameDash_Ground.mdx",Source,"origin")))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    call SaveReal(hashtable019,(Cache),(47),((GetSpellTargetX())*1.))
    call SaveReal(hashtable019,(Cache),(48),((GetSpellTargetY())*1.))
    set S4E=unit155(Source,GetSpellTargetX(),GetSpellTargetY())
    call SaveUnitHandle(hashtable019,(Cache),(19),(S4E))
    call SaveReal(hashtable019,(Cache),(44),((C6G(Source,S4E))*1.))
    call SaveReal(hashtable019,(Cache),(6),((GetUnitX(S4E))*1.))
    call SaveReal(hashtable019,(Cache),(7),((GetUnitY(S4E))*1.))
    call SaveInteger(hashtable019,(Cache),(34),(1))
  else
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,.0,false)
    call TriggerAddCondition(t,Condition(function unit157))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  endif
  set t=null
  set Source=null
  set S4E=null
endfunction

function unit158 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer HTD=(LoadInteger(hashtable019,(GetHandleId(Source)),(747)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  if HTD<3 then
    set Count=Count-1
    call SaveInteger(hashtable019,(Cache),(34),(Count))
    if Count==0 then
      call UnitRemoveAbility(Source,OZ8[HTD])
      set Count=35
      call SaveInteger(hashtable019,(Cache),(34),(Count))
      set HTD=HTD+1
      call SaveInteger(hashtable019,(GetHandleId(Source)),(747),(HTD))
      call UnitAddAbility2(Source,OZ8[HTD])
    endif
  endif
  set t=null
  set Source=null
  return false
endfunction

function L4G takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call SaveInteger(hashtable019,(GetHandleId(Source)),(747),(3))
  call UnitAddAbility2(Source,OZ8[3])
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function unit158))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveInteger(hashtable019,(Cache),(34),(30))
  set Source=null
  set t=null
endfunction

function L7G takes nothing returns boolean
  if GetLearnedSkill()=='A2JK' and IsUnitIllusion(GetTriggerUnit())==false then
    call UnitAddAbility2(GetTriggerUnit(),'A2JL')
    call SetUnitAbilityLevel(GetTriggerUnit(),'A2JL',GetLearnedSkillLevel())
    if GetLearnedSkillLevel()==1 then
      call L4G()
      call CQG()
    endif
  endif
  return false
endfunction

function Func1049 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function L7G))
  set t=null
  set OZ8[0]='A2JO'
  set OZ8[1]='A2JQ'
  set OZ8[2]='A2JP'
  set OZ8[3]='A2JR'
endfunction



function DFH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer CG8=(LoadInteger(hashtable019,(Cache),(59)))
  if LoadBoolean(hashtable019,Cache,0)==false then
    if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
      if GetEventDamageSource()==Source and IsRealDamage and IsFakeDamage==false then
        call TriggerRegisterTimerEvent(t,0,false)
        call HealUnitFor(Source,GetEventDamage()*0.2*(GetUnitAbilityLevel(Source,'A2EY')+GetUnitAbilityLevel(Source,'QP1O')))
        call SaveBoolean(hashtable019,Cache,0,true)
      else
        set t=null
        set Source=null
        return false
      endif
    endif
  endif
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  call UnitRemoveAbility(Source,CG8)
  call UnitRemoveAbility(Source,'B0FJ')
  call UnitRemoveAbility(Source,'B0FK')
  set t=null
  set Source=null
  return false
endfunction

function MomentOfCourageFilter takes nothing returns boolean
  if (IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit())))!=null then
    call TriggerRegisterUnitEvent(temp_trigger,GetFilterUnit(),EVENT_UNIT_DAMAGED)
  endif
  return false
endfunction

function DGH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit u=GetAttacker()
  local integer Level=GetUnitAbilityLevel(Source,'A2EY')+GetUnitAbilityLevel(Source,'QP1O')
  local integer id
  local group g=GetAvailableGroup()
  if Source==GetTriggerUnit()and ((LoadInteger(hashtable019,(GetHandleId((Source))),((4316))))==1)==false and IsUnitAlly(Source,GetOwningPlayer(u))==false and GetUnitAbilityLevel(Source,'A1HX')==0 then
    if PRD_Get(Source,'A2EY',14+2*Level) then
      call AddTimedKeyToUnit(Source,4316,0.9)
      if Level==1 then
        set id='A2GD'
      elseif Level==2 then
        set id='A2GE'
      elseif Level==3 then
        set id='A2GF'
      elseif Level==4 then
        set id='A2GC'
      endif
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),id,false)
      call UnitAddAbility2(Source,id)
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call TriggerRegisterDeathEvent(t,Source)
      set tt_unit1=Source
      set temp_trigger=t
      call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),600,Condition(function MomentOfCourageFilter))
      set temp_trigger=null
      call TriggerRegisterTimerEvent(t,1,false)
      //call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DAMAGED)
      call TriggerAddCondition(t,Condition(function DFH))
      call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
      call SaveInteger(hashtable019,(Cache),(59),(id))
    endif
  endif
  call KillGroup(g)
  set g=null
  set t=null
  set Source=null
  set u=null
  return false
endfunction

function LegionCommander_MomentOfCourage takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterAnyUnitEventBJ(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function DGH))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set Source=null
  set t=null
endfunction

function DIH takes nothing returns boolean
  if (GetLearnedSkill()=='A2EY' or GetLearnedSkill()=='QP1O') and IsUnitIllusion(GetTriggerUnit())==false and GetLearnedSkillLevel()==1 then
    call LegionCommander_MomentOfCourage()
  endif
  return false
endfunction

function Func1051 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function DIH))
  set t=null
endfunction

function DJH takes unit u,integer d returns nothing
  local integer array b
  local integer a=d
  local integer c=1
  local integer i=0
  local integer E29
  if d<1 then
    call UnitRemoveAbility(u,O18[0])
    call UnitRemoveAbility(u,O18[1])
    call UnitRemoveAbility(u,O18[2])
    call UnitRemoveAbility(u,O18[3])
    call UnitRemoveAbility(u,O18[4])
    call UnitRemoveAbility(u,O18[5])
    call UnitRemoveAbility(u,O18[6])
    call UnitRemoveAbility(u,O18[7])
    call UnitRemoveAbility(u,O18[8])
    return
  endif
  loop
    exitwhen c==0
    set c=a/ 2
    set b[i]=a-c*2
    set a=c
    set i=i+1
  endloop
  set E29=8
  set i=0
  loop
    exitwhen i>E29
    if b[i]==1 then
      call UnitAddAbility2(u,O18[i])
    else
      call UnitRemoveAbility(u,O18[i])
    endif
    set i=i+1
  endloop
endfunction

function DKH takes unit Source,integer Level,unit Target returns nothing
  local integer Cache=GetHandleId(Source)
  local integer DMH=(LoadInteger(hashtable019,(Cache),(739)))
  if IsUnitType(Target,UNIT_TYPE_HERO) then
    set DMH=DMH+6+4*Level
    call SaveInteger(hashtable019,(Cache),(739),(DMH))
    call TextTagOnUnit(GetUnitName(Source)+" Won The Duel!!",5,Source,.03,255,0,0,255)
    call DJH(Source,DMH)
  endif
endfunction

function DNH takes unit u returns boolean
  return GetUnitAbilityLevel(u,'Bcyc')==0 or IsUnitCycloned(u)==false
endfunction

function DOH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local real Time=(LoadReal(hashtable019,(Cache),(442)))
  local unit Caster
  if GetTriggerEvalCount(t)==1 then
    set Caster=CreateUnit(GetOwningPlayer(Target),'e00E',GetUnitX(Target),GetUnitY(Target),0)
    call UnitAddAbility(Caster,'A2G5')
    call IssueTargetOrderById(Caster,852583,Target)
    set Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
    call UnitAddAbility(Caster,'A2G5')
    call IssueTargetOrderById(Caster,852583,Source)
    set Caster=null
  endif
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or Time<(TimerGetElapsed(GlobalTimer))or DNH(Source)==false or DNH(Target)==false then
    if GetTriggerEventId()==EVENT_WIDGET_DEATH then
      if GetTriggerUnit()==Source then
        call DKH(Target,Level,GetTriggerUnit())
      else
        call DKH(Source,Level,GetTriggerUnit())
      endif
    endif
    call UnitRemoveAbility(Source,'B0FG')
    call UnitRemoveAbility(Target,'B0FG')
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(175))))
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(176))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call SetUnitPathing(Source,true)
    call SetUnitPathing(Target,true)
  elseif GetIssuedOrderId()!=851973 then
    call SetUnitPathing(Source,false)
    call SetUnitPathing(Target,false)
    call DisableTrigger(t)
    call IssueTargetOrderById(Source,851983,Target)
    call IssueTargetOrderById(Target,851983,Source)
    call EnableTrigger(t)
  else
    if GetUnitAbilityLevel(Source,'NOAT')>0 or GetUnitAbilityLevel(Source,'Abun')>0 then
      call UnitRemoveAbility(Source,'NOAT')
      call UnitRemoveAbility(Source,'Abun')
    endif
    if GetUnitAbilityLevel(Target,'NOAT')>0 or GetUnitAbilityLevel(Target,'Abun')>0 then
      call UnitRemoveAbility(Target,'NOAT')
      call UnitRemoveAbility(Target,'Abun')
    endif
  endif
  set t=null
  set Source=null
  set Target=null
  set Caster=null
  return false
endfunction

function DPH takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A2CI')
  local trigger t
  local integer Cache
  call SetUnitPathing(Source,false)
  call SetUnitPathing(Target,false)
  call IssueTargetOrderById(Source,851983,Target)
  call IssueTargetOrderById(Target,851983,Source)
  set t=CreateTrigger()
  set Cache=GetHandleId(t)
  call SaveEffectHandle(hashtable019,(Cache),(175),(AddSpecialEffectTarget("war3mapImported\\DuelFX.mdx",Source,"overhead")))
  call SaveEffectHandle(hashtable019,(Cache),(176),(AddSpecialEffectTarget("war3mapImported\\DuelFX.mdx",Target,"overhead")))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(442),(((TimerGetElapsed(GlobalTimer))+.75*Level+3.25)*1.))
  call TriggerAddCondition(t,Condition(function DOH))
  call TriggerRegisterTimerEvent(t,.05,true)
  call TriggerRegisterTimerEvent(t,.01,false)
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerRegisterDeathEvent(t,Target)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_ISSUED_TARGET_ORDER)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_ISSUED_POINT_ORDER)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_ISSUED_ORDER)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ISSUED_TARGET_ORDER)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ISSUED_POINT_ORDER)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ISSUED_ORDER)
  set Source=null
  set Target=null
  set t=null
endfunction

function LegionCommander_Duel takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call DPH()
  endif
endfunction

function Func1050 takes nothing returns nothing
  set O18[0]='A2GK'
  set O18[1]='A2GJ'
  set O18[2]='A2GI'
  set O18[3]='A2GH'
  set O18[4]='A2GN'
  set O18[5]='A2GO'
  set O18[6]='A2GM'
  set O18[7]='A2GL'
  set O18[8]='A2GP'
endfunction


function DUH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer Level=(LoadInteger(hashtable019,(Cache),(5)))
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  set Count=Count+1
  call SaveInteger(hashtable019,(Cache),(34),(Count))
  if GetTriggerEventId()==EVENT_WIDGET_DEATH or Count>5 then
    call UnitRemoveAbility(Target,O08[Level])
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+20+10*Level)
    call Z48("Abilities\\Spells\\Orc\\SpiritLink\\SpiritLinkZapTarget.mdl",Target,"chest",1.9)
  endif
  set t=null
  set Source=null
  set Target=null
  return false
endfunction

function LegionCommander_PressTheAttack takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A2J2')
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call RemoveDispellableBuffs(Target)
  call E79(Target,0,0)
  call UnitAddAbility2(Target,O08[Level])
  //call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),O08[Level],false)
  call SaveEffectHandle(hashtable019,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Human\\InnerFire\\InnerFireTarget.mdl",Target,"overhead")))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveInteger(hashtable019,(Cache),(34),(0))
  call TriggerAddCondition(t,Condition(function DUH))
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerRegisterDeathEvent(t,Target)
  call TriggerEvaluate(t)
  set Source=null
  set Target=null
  set t=null
endfunction

function UZ9 takes nothing returns nothing
  set O08[1]='A2J9'
  set O08[2]='A2JA'
  set O08[3]='A2J8'
  set O08[4]='A2J7'
endfunction

function DXH takes unit Source,integer Level returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Source),GetUnitY(Source),0)
  call UnitAddAbility2(Caster,'A2JC')
  call SetUnitAbilityLevel(Caster,'A2JC',Level/ 3)
  call IssueTargetOrderById(Caster,852101,Source)
  set Caster=null
endfunction

function DYH takes nothing returns nothing
  if IsUnitType(GetEnumUnit(),UNIT_TYPE_SUMMONED) or IsUnitIllusion(GetEnumUnit()) then
    call DamageTarget(GetTriggerUnit(),GetEnumUnit(),1,GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)*.5)
  endif
  call DamageTarget(GetTriggerUnit(),GetEnumUnit(),1,50*P48+(12+P48*2)*(O28+O58))
endfunction

function DZH takes nothing returns nothing
  if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO) then
    set O28=O28+1
  else
    set O58=O58+1
  endif
endfunction

function Legion_Odds_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  
  //call LoDMovePercentage_Sub(LoadUnitHandle(MHT,info,0),LoadReal(MHT,info,0))
  call SubBonusMSPercent(LoadUnitHandle(MHT,info,0),R2I(LoadReal(MHT,info,0)))
  call Timer_End(t)
  set t = null
endfunction

function LegionCommander_OverhelmingOdds takes nothing returns nothing
  local timer t = Timer_Get()
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local integer Level=GetUnitAbilityLevel(Source,'A2JB')
  local group g=GetAvailableGroup()
  call DestroyEffect(AddSpecialEffect("war3mapImported\\OverwhelmingOdds.mdx",x,y))
  call GroupEnumUnitsInRange(g,x,y,315+25,Condition(function LR8))
  set O58=0
  set O28=0
  set P48=Level
  call ForGroup(g,function DZH)
  call ForGroup(g,function DYH)
  call KillGroup(g)
  
  set x = (9*O28 + 3*O58)//*0.01
  
  //call LoDMovePercentage_Add(Source,x)
  call AddBonusMSPercent(Source,R2I(x))
  if x>0then
    call Buff_Add(Source,LoDBuff_AbilID[20],LoDBuff_BuffID[20],7)
  endif
  
  set Level = GetHandleId(t)
  call SaveUnitHandle(MHT,Level,0,Source)
  call SaveReal(MHT,Level,0,x)
  
  call TimerStart(t,7,false,function Legion_Odds_End)
  
  set Source = null
  set g = null
  set t = null
endfunction

function UB9 takes nothing returns nothing
  call PreloadAbility('A2JC')
endfunction

function DCH takes nothing returns nothing
  set PE8=true
  call DamageTarget(P78,GetEnumUnit(),1,((200+400*P98)/ P88)/ 20)
  set PE8=false
endfunction

function D3H takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local real x=(LoadReal(hashtable019,(Cache),(6)))
  local real y=(LoadReal(hashtable019,(Cache),(7)))
  local group g
  if GetTriggerEvalCount(t)>20 then
    call DestroyEffect((LoadEffectHandle(hashtable019,(Cache),(32))))
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  else
    set g=GetAvailableGroup()
    set tt_unit1=Source
    call GroupEnumUnitsInRange(g,x,y,170+25,Condition(function DE9))
    set P98=IMaxIF(GetUnitAbilityLevel(Source,'A2BG'),GetUnitAbilityLevel(Source,'A30H'))
    set P78=Source
    set P88=CountUnitsInGroup(g)
    call ForGroup(g,function DCH)
    call KillGroup(g)
    set g=null
  endif
  set t=null
  set Source=null
  return false
endfunction

function Skywrath_MysticFlare takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local string s="war3mapImported\\DivineWrathTarget.mdx"
  local location l=GetSpellTargetLoc()
  call PlaySoundAtPointBJ(PD8,100,l,0)
  call RemoveLocation(l)
  call TriggerRegisterTimerEvent(t,.1,true)
  call TriggerAddCondition(t,Condition(function D3H))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call DestroyEffect(AddSpecialEffect(s,x,y))
  set t=null
  set Source=null
  set l=null
endfunction

function U69 takes nothing returns nothing
  set PD8=CreateSound("Abilities\\Spells\\Demon\\RainOfFire\\RainOfFireTarget2.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(PD8,"StarfallTarget")
  call SetSoundDuration(PD8,3000)
endfunction

function integer313 takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit1
  local unit Target=tt_unit2
  local integer Level=GetUnitAbilityLevel(Source,'A2BE')
  local real Damage=40+20*Level+1.6*GetHeroInt(Source,true)
  if GetHeroInt(Source,true)==0 then
    set Damage=40+20*Level+1.6*GetHeroInt(udg_Hero[GetPlayerId(GetOwningPlayer(Source))],true)
  endif
  set PE8=true
  call DamageTarget(Source,Target,1,Damage)
  set PE8=false
  set Source=null
  set Target=null
endfunction

function EDH takes nothing returns nothing
  local trigger t=AddProjectile(GetTriggerUnit(),GetSpellTargetUnit(),'h0DQ',"E9H",500,false)
  local integer Cache=GetHandleId(t)
  set t=null
endfunction

function Skywrath_ArcaneBolt takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call EDH()
  endif
endfunction

function EFH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local real d
  if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
  else
    call UnitRemoveAbility(Target,'A2HX')
    call UnitRemoveAbility(Target,'A2I0')
    call UnitRemoveAbility(Target,'A2HY')
    call UnitRemoveAbility(Target,'A2HZ')
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set Target=null
  set t=null
  return false
endfunction

function EGH takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=GetTriggerUnit()
  local unit Target=GetSpellTargetUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A2HN')
  local real SB8=2+Level
  local integer id='A2HX'
  if Level==1 then
    set id='A2HX'
  elseif Level==2 then
    set id='A2I0'
  elseif Level==3 then
    set id='A2HY'
  elseif Level==4 then
    set id='A2HZ'
  endif
  call UnitAddAbility2(Target,id)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Target),id,false)
  call TriggerRegisterTimerEvent(t,SB8,false)
  call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function EFH))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
  set Source=null
  set Target=null
  set t=null
endfunction

function Skywrath_AncientSeal takes nothing returns nothing
  if IsUnitType(GetSpellTargetUnit(),UNIT_TYPE_HERO) and IsBlocked(GetSpellTargetUnit())==false then
    call EGH()
  endif
endfunction

function integer306 takes nothing returns nothing
  local integer Cache=GetHandleId(GetTriggeringTrigger())
  local unit Source=tt_unit1
  local unit Target=tt_unit2
  local real x=GetUnitX(Target)
  local real y=GetUnitY(Target)
  local integer Level=GetUnitAbilityLevel(Source,'A2IT')
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',x,y,0)
  call UnitAddAbility(Caster,'A2IU')
  call SetUnitAbilityLevel(Caster,'A2IU',Level)
  call IssueImmediateOrderById(Caster,852096)
  set Source=null
  set Target=null
  set Caster=null
endfunction

function EJH takes unit Source,group g returns unit
  local unit integer312=null
  local real d=99999
  local unit EMH=FirstOfGroup(g)
  call GroupRemoveUnit(g,EMH)
  loop
    exitwhen EMH==null
    if DistanceBetweenUnits(Source,EMH)<d then
      set d=DistanceBetweenUnits(Source,EMH)
      set integer312=EMH
    endif
    set EMH=FirstOfGroup(g)
    call GroupRemoveUnit(g,EMH)
  endloop
  set EMH=null
  set TEMPUNIT=integer312
  set integer312=null
  return TEMPUNIT
endfunction

function Skywrath_ConcussiveShot takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=null
  local group g=GetAvailableGroup()
  set tt_unit1=Source
  call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1600+25,Condition(function DD9))
  set Target=EJH(Source,g)
  call KillGroup(g)
  if Target!=null then
    call AddProjectile(Source,Target,'h0E6',"EIH",800,false)
  endif
  set g=null
  set Target=null
  set Source=null
endfunction

function FFH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer TQG=(LoadInteger(hashtable019,(Cache),(422)))
  local integer TRG=(LoadInteger(hashtable019,(Cache),(423)))
  local integer SSF=(LoadInteger(hashtable019,(Cache),(424)))
  call SetHeroAgi(Target,GetHeroAgi(Target,false)+TQG,true)
  call SetHeroStr(Target,GetHeroStr(Target,false)+TRG,true)
  call SetHeroInt(Target,GetHeroInt(Target,false)+SSF,true)
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Target=null
  return false
endfunction

function FGH takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local unit Target=GetEnumUnit()
  local integer Level=GetUnitAbilityLevel(Source,'A2FK')
  local trigger t
  local integer Cache
  local integer A5D
  local integer TQG
  local integer TRG
  local integer SSF
  local real rate
  if IsUnitType(Target,UNIT_TYPE_HERO) then
    set A5D=GetUnitPrimaryAttribute(Target)
    set rate=.15
    if A5D==2 then
      set TQG=R2I(rate*GetHeroAgi(Target,false))-1
      set TRG=0
      set SSF=0
    elseif A5D==3 then
      set TQG=0
      set TRG=R2I(rate*GetHeroStr(Target,false))-1
      set SSF=0
    elseif A5D==1 then
      set TQG=0
      set TRG=0
      set SSF=R2I(rate*GetHeroInt(Target,false))-1
    endif
    call SetHeroAgi(Target,GetHeroAgi(Target,false)-TQG,true)
    call SetHeroStr(Target,GetHeroStr(Target,false)-TRG,true)
    call SetHeroInt(Target,GetHeroInt(Target,false)-SSF,true)
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,7,false)
    call TriggerRegisterDeathEvent(t,Target)
    call TriggerAddCondition(t,Condition(function FFH))
    call SaveInteger(hashtable019,(Cache),(422),(TQG))
    call SaveInteger(hashtable019,(Cache),(424),(SSF))
    call SaveInteger(hashtable019,(Cache),(423),(TRG))
    call SaveUnitHandle(hashtable019,(Cache),(17),(Target))
    set t=null
  endif
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",Target,"chest"))
  call DamageTarget(Source,Target,PM8,50+50*Level)
  set Source=null
  set Target=null
endfunction

function Shredder_WhirlingDeath takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local group g=GetAvailableGroup()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=AngleBetweenXY(GetUnitX(Source),GetUnitY(Source),x,y)*bj_DEGTORAD
  set x=GetUnitX(Source)
  set y=GetUnitY(Source)
  if KillTrees(x,y,300)>0 then
    set PM8=3
  else
    set PM8=1
  endif
  call GroupEnumUnitsInRange(g,x,y,300+25,Condition(function LR8))
  call ForGroup(g,function FGH)
  call KillGroup(g)
  call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\WhirlingDeath_01.mdx",Source,"origin"))
  set Source=null
  set g=null
endfunction

function FJH takes unit Source,unit Target returns nothing
  local integer Level=GetUnitAbilityLevel(Source,'A2E3')
  call DamageTarget(Source,Target,3,60+40*Level)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",Target,"origin"))
endfunction

function FKH takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),DK)==false then
    call GroupAddUnit(DK,GetEnumUnit())
    call FJH(tt_unit1,GetEnumUnit())
  endif
endfunction

function FMH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local unit Target=(LoadUnitHandle(hashtable019,(Cache),(17)))
  local integer region009=(LoadInteger(hashtable019,(Cache),(18)))
  local integer Count=GetTriggerEvalCount(t)
  local unit RDE
  local group trigger008=(LoadGroupHandle(hashtable019,(Cache),(16)))
  local group g
  local boolean WD9=(LoadBoolean(hashtable019,(Cache),(727)))
  local boolean FNH=(LoadBoolean(hashtable019,(Cache),(740)))
  if IsUnitDisabled(Hero)then
    set FNH=true
    call SaveBoolean(hashtable019,(Cache),(740),(FNH))
  endif
  if WD9==false then
    set RDE=(LoadUnitHandle(hashtable019,(Cache),(700+region009+1-Count)))
    call RemoveUnit(RDE)
  else
    set RDE=(LoadUnitHandle(hashtable019,(Cache),(700+Count)))
    if FNH==false then
      if IsUnitType(Hero,UNIT_TYPE_HERO)then
        call SaveBoolean(HeroStats,GetHandleId(Hero),99,true)
      endif
      call SetUnitX(Hero,GetUnitX(RDE))
      call SetUnitY(Hero,GetUnitY(RDE))
    endif
    call RemoveUnit(RDE)
    set g=GetAvailableGroup()
    set tt_unit1=Hero
    set DK=trigger008
    call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),250,Condition(function LW8))
    call ForGroup(g,function FKH)
    call KillGroup(g)
  endif
  if Count==(region009)then
    call KillTrees(GetUnitX(Hero),GetUnitY(Hero),90)
    call KillGroup(trigger008)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  endif
  set t=null
  set Hero=null
  set Target=null
  set RDE=null
  set trigger008=null
  set g=null
  return false
endfunction

function FOH takes nothing returns nothing
  if WA8(GetEnumDestructable())and IsDestructableDeadBJ(GetEnumDestructable())==false then
    set PN8=PN8+1
  endif
endfunction

function FPH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=(LoadUnitHandle(hashtable019,(Cache),(14)))
  local real J2E=(LoadReal(hashtable019,(Cache),(13)))
  local integer RHE=(LoadInteger(hashtable019,(Cache),(12)))
  local integer Count=GetTriggerEvalCount(t)
  local real x=(LoadReal(hashtable019,(Cache),(6)))+Count*50*Cos(J2E*bj_DEGTORAD)
  local real y=(LoadReal(hashtable019,(Cache),(7)))+Count*50*Sin(J2E*bj_DEGTORAD)
  local boolean RIE=(LoadBoolean(hashtable019,(Cache),(15)))
  local unit RJE
  local trigger trigger009=(LoadTriggerHandle(hashtable019,(Cache),(11)))
  local integer sound002=GetHandleId(trigger009)
  local integer ID='u01Q'
  local real RFE=250
  local rect r
  local real d=90
  set r=Rect(x-d,y-d,x+d,y+d)
  set PN8=0
  call EnumDestructablesInRect(r,Condition(function ReturnTrue2),function FOH)
  if PN8>0 or Count==RHE or Count==(RHE-1)or Count==(RHE-2)then
    set ID='u01P'
  endif
  set RJE=CreateUnit(GetOwningPlayer(Hero),ID,x,y,J2E)
  call SaveUnitHandle(hashtable019,(sound002),(700+Count),(RJE))
  if PN8>0 then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call TriggerRegisterTimerEvent(trigger009,.5/ RHE,true)
    call TriggerAddCondition(trigger009,Condition(function FMH))
    call SaveInteger(hashtable019,(sound002),(18),(Count))
    call SaveBoolean(hashtable019,(sound002),(727),(true))
    call SaveUnitHandle(hashtable019,(sound002),(14),(Hero))
    call SaveGroupHandle(hashtable019,(sound002),(16),(GetAvailableGroup()))
    call SaveReal(hashtable019,(sound002),(6),((x)*1.))
    call SaveReal(hashtable019,(sound002),(7),((y)*1.))
    call SaveBoolean(hashtable019,(sound002),(740),(false))
  elseif Count>RHE then
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
    call TriggerRegisterTimerEvent(trigger009,.5/ RHE,true)
    call TriggerAddCondition(trigger009,Condition(function FMH))
    call SaveInteger(hashtable019,(sound002),(18),(Count))
    call SaveBoolean(hashtable019,(sound002),(727),(false))
    call SaveUnitHandle(hashtable019,(sound002),(14),(Hero))
    call SaveGroupHandle(hashtable019,(sound002),(16),(GetAvailableGroup()))
    call SaveBoolean(hashtable019,(sound002),(740),(false))
  endif
  set t=null
  set Hero=null
  set RJE=null
  set trigger009=null
  return false
endfunction

function Shredder_Timberchain takes nothing returns nothing
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  local unit Hero=GetTriggerUnit()
  //local location l=GetSpellTargetLoc()
  local real J2E=AngleBetweenXY(GetUnitX(Hero),GetUnitY(Hero),GetSpellTargetX(),GetSpellTargetY())
  local integer Level=GetUnitAbilityLevel(Hero,'A2E3')
  local integer integers061
  local integer RHE
  local trigger boolean136=CreateTrigger()
  set integers061=600+200*Level
  set RHE=integers061/ 50
  call SaveUnitHandle(hashtable019,(Cache),(14),(Hero))
  call SaveInteger(hashtable019,(Cache),(5),(Level))
  call SaveReal(hashtable019,(Cache),(13),((J2E)*1.))
  call SaveInteger(hashtable019,(Cache),(12),(RHE))
  call SaveTriggerHandle(hashtable019,(Cache),(11),(boolean136))
  call SaveReal(hashtable019,(Cache),(6),((GetUnitX(Hero))*1.))
  call SaveReal(hashtable019,(Cache),(7),((GetUnitY(Hero))*1.))
  call TriggerRegisterTimerEvent(t,.5/ RHE,true)
  call TriggerAddCondition(t,Condition(function FPH))
  //call RemoveLocation(l)
  set t=null
  set Hero=null
  //set l=null
  set boolean136=null
endfunction

function FTH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer info = GetHandleId(Source)
  
  call LoDStat_Sub(Source,1,"regen")
  call LoDStat_Sub(Source,1,"armour")
  call SaveInteger(hashtable019,info,'A2E4',LoadInteger(hashtable019,info,'A2E4')-1)
  
  if GetTriggerEventId()==EVENT_UNIT_DEATH then//not really needed, but just incase of respawn and such
    call Buff_Remove(Source,LoDBuff_BuffID[5])
  endif
  
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function FUH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local integer Count=LoadInteger(hashtable019,GetHandleId(Source),'A2E4')
  if IsUnitEnemy(GetAttacker(),GetOwningPlayer(Source)) and 4*(IMaxIF(GetUnitAbilityLevel(Source,'A2E4'),GetUnitAbilityLevel(Source,'QP1P')))>Count then
    call Buff_Add(Source,LoDBuff_AbilID[5],LoDBuff_BuffID[5],16)
    call LoDStat_Add(Source,1,"regen")
    call LoDStat_Add(Source,1,"armour")
    call SaveInteger(hashtable019,GetHandleId(Source),'A2E4',Count+1)
    
    call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\ReactiveArmor.mdx",Source,"chest"))
    
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,16,false)
    call TriggerRegisterDeathEvent(t,Source)
    call TriggerAddCondition(t,Condition(function FTH))
    call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  endif
  set t=null
  set Source=null
  return false
endfunction

function Shredder_ReactiveArmor_Learn takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function FUH))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  set t=null
  set Source=null
endfunction

function FWH takes nothing returns boolean
  if (GetLearnedSkill()=='A2E4' or GetLearnedSkill()=='QP1P') and GetLearnedSkillLevel()==1 and IsUnitIllusion(GetTriggerUnit())==false then
    call Shredder_ReactiveArmor_Learn()
  endif
  return false
endfunction

function U29 takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function FWH))
  set t=null
endfunction

function FXH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  call UnitRemoveAbility(Source,'Bpig')
  call UnitRemoveAbility(Source,'BEia')
  call UnitRemoveAbility(Source,'A2FX')
  call FlushChildHashtable(hashtable019,(Cache))
  call CleanTrigger(t)
  set t=null
  set Source=null
  return false
endfunction

function FYH takes unit Source,unit Target returns nothing
  local unit Caster=CreateUnit(GetOwningPlayer(Source),'e00E',GetUnitX(Target),GetUnitY(Target),0)
  local integer WFE=R2I(100*GetUnitState(Target,UNIT_STATE_LIFE)/ GetUnitState(Target,UNIT_STATE_MAX_LIFE))
  local integer Level=IMaxIF(IMinIF(R2I(100-WFE)/ 5,20),1)
  call UnitAddAbility(Caster,'A2DV')
  call SetUnitAbilityLevel(Caster,'A2DV',Level)
  call IssueTargetOrderById(Caster,852075,Target)
  set Caster=null
endfunction

function FZH takes nothing returns nothing
  if GameEnded==false then
    call DamageTarget(PS8,GetEnumUnit(),3,(25+25*PT8)*.5)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",GetEnumUnit(),"origin"))
    call FYH(PS8,GetEnumUnit())
  endif
endfunction

function FAH takes nothing returns nothing
  if IsUnitInGroup(GetEnumUnit(),PR8)==false then
    call GroupAddUnit(PR8,GetEnumUnit())
    call DamageTarget(PS8,GetEnumUnit(),3,60+40*PT8)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",GetEnumUnit(),"origin"))
    call FYH(PS8,GetEnumUnit())
  endif
endfunction

function FBH takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer Cache=GetHandleId(t)
  local unit Source=(LoadUnitHandle(hashtable019,(Cache),(2)))
  local unit Projectile=(LoadUnitHandle(hashtable019,(Cache),(45)))
  local real TargetX=(LoadReal(hashtable019,(Cache),(6)))
  local real TargetY=(LoadReal(hashtable019,(Cache),(7)))
  local real x
  local real y
  local real a
  local integer state=(LoadInteger(hashtable019,(Cache),(33)))
  local group AlreadyHit=(LoadGroupHandle(hashtable019,(Cache),(187)))
  local group g
  local integer Count=(LoadInteger(hashtable019,(Cache),(34)))
  local real manacost
  call UnitAddAbility2(Source,'Abun')
  if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
    if GetSpellAbilityId()=='A2FX' then
      call SaveInteger(hashtable019,(Cache),(33),(2))
      call GroupClear(AlreadyHit)
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2FX',false)
      set t=CreateTrigger()
      set Cache=GetHandleId(t)
      call TriggerRegisterTimerEvent(t,0,false)
      call TriggerAddCondition(t,Condition(function FXH))
      call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
    endif
  elseif GetTriggerEventId()==EVENT_WIDGET_DEATH or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==-1 then
    call UnitRemoveAbility(Source,'Abun')
    if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A2E5' then
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2E5',true)
    endif
    call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2FX',false)
    call UnitRemoveAbility(Source,'A2FX')
    call UnitRemoveAbility(Source,'Bpig')
    call UnitRemoveAbility(Source,'BEia')
    call KillUnit(Projectile)
    call KillGroup(AlreadyHit)
    call FlushChildHashtable(hashtable019,(Cache))
    call CleanTrigger(t)
  elseif state==0 then
    set a=AngleBetweenXY(GetUnitX(Projectile),GetUnitY(Projectile),TargetX,TargetY)*bj_DEGTORAD
    set x=GetUnitX(Projectile)+18*Cos(a)
    set y=GetUnitY(Projectile)+18*Sin(a)
    call KillTrees(x,y,175)
    if DistanceBetweenXY(x,y,TargetX,TargetY)<40 then
      set x=TargetX
      set y=TargetY
    endif
    call SetUnitX(Projectile,x)
    call SetUnitY(Projectile,y)
    set tt_unit1=Source
    set PS8=Source
    set PT8=GetUnitAbilityLevel(Source,'A2E5')
    set PR8=AlreadyHit
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,200+25,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function FAH)
    call KillGroup(g)
    if x==TargetX and y==TargetY then
      call SaveInteger(hashtable019,(Cache),(33),(1))
      call GroupClear(AlreadyHit)
    endif
  elseif state==1 then
    set Count=Count+1
    if Count==25 then
      set x=GetUnitX(Projectile)
      set y=GetUnitY(Projectile)
      call KillTrees(x,y,175)
      set Count=0
      set tt_unit1=Source
      set PS8=Source
      set PT8=GetUnitAbilityLevel(Source,'A2E5')
      set g=GetAvailableGroup()
      call GroupEnumUnitsInRange(g,x,y,200+25,Condition(function DefaultEnemyFilter))
      call ForGroup(g,function FZH)
      call KillGroup(g)
      set manacost=(15+5*PT8)/ 2
      if GetUnitState(Source,UNIT_STATE_MANA)<manacost or DistanceBetweenUnits(Source,Projectile)>2000 then
        call SaveInteger(hashtable019,(Cache),(33),(2))
        call GroupClear(AlreadyHit)
        call UnitRemoveAbility(Source,'A2FX')
        call UnitRemoveAbility(Source,'Bpig')
        call UnitRemoveAbility(Source,'BEia')
      else
        call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)-manacost)
      endif
    endif
    call SaveInteger(hashtable019,(Cache),(34),(Count))
  elseif state==2 then
    set a=AngleBetweenXY(GetUnitX(Projectile),GetUnitY(Projectile),GetUnitX(Source),GetUnitY(Source))*bj_DEGTORAD
    set x=GetUnitX(Projectile)+16*Cos(a)
    set y=GetUnitY(Projectile)+16*Sin(a)
    call KillTrees(x,y,175)
    call SetUnitX(Projectile,x)
    call SetUnitY(Projectile,y)
    set tt_unit1=Source
    set PS8=Source
    set PT8=GetUnitAbilityLevel(Source,'A2E5')
    set PR8=AlreadyHit
    set g=GetAvailableGroup()
    call GroupEnumUnitsInRange(g,x,y,200+25,Condition(function DefaultEnemyFilter))
    call ForGroup(g,function FAH)
    call KillGroup(g)
    if DistanceBetweenXY(x,y,GetUnitX(Source),GetUnitY(Source))<40 then
      call UnitRemoveAbility(Source,'Abun')
      call KillUnit(Projectile)
      call KillGroup(AlreadyHit)
      call FlushChildHashtable(hashtable019,(Cache))
      call CleanTrigger(t)
      if(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hashtable019,(GetHandleId(Source)),(704)))=='A2E5' then
        call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2E5',true)
      endif
      call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2FX',false)
    endif
  endif
  set t=null
  set Source=null
  set Projectile=null
  set AlreadyHit=null
  set g=null
  return false
endfunction

function Shredder_Chakram takes nothing returns nothing
  local unit Source=GetTriggerUnit()
  local real x=GetSpellTargetX()
  local real y=GetSpellTargetY()
  local real a=AngleBetweenXY(GetUnitX(Source),GetUnitY(Source),x,y)*bj_DEGTORAD
  local unit Projectile=CreateUnit(GetOwningPlayer(Source),'h0DS',GetUnitX(Source),GetUnitY(Source),a*bj_RADTODEG)
  local trigger t=CreateTrigger()
  local integer Cache=GetHandleId(t)
  call TriggerRegisterTimerEvent(t,.02,true)
  call TriggerRegisterDeathEvent(t,Source)
  call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function FBH))
  call SaveUnitHandle(hashtable019,(Cache),(45),(Projectile))
  call SaveUnitHandle(hashtable019,(Cache),(2),(Source))
  call SaveReal(hashtable019,(Cache),(6),((x)*1.))
  call SaveReal(hashtable019,(Cache),(7),((y)*1.))
  call SaveInteger(hashtable019,(Cache),(33),(0))
  call SaveGroupHandle(hashtable019,(Cache),(187),(GetAvailableGroup()))
  call UnitAddAbility2(Source,'Abun')
  call UnitAddAbility2(Source,'A2FX')
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2E5',false)
  call SetPlayerAbilityAvailable2(GetOwningPlayer(Source),'A2FX',true)
  set Source=null
  set t=null
  set Projectile=null
endfunction

function V49 takes nothing returns nothing
  call PreloadAbility('A2DV')
endfunction


function Formless_Reset_Effect takes nothing returns nothing
  local player p=GetTriggerPlayer()
  local unit cho=udg_Hero[GetPlayerId(p)]
  local integer xx = 0
  local integer CopiedTech = 0
  local integer OriginTech = 0  
  local integer OriginSkill
  local integer PlayerId=GetPlayerId(p)
  local integer OriginalSkill
  local integer CopiedSkill
  local integer level
  
  
  loop
    set xx=xx+1
    set CopiedTech=LoadInteger(MHT,GetHandleId(cho),StringHash("copied"+I2S(xx)))
    set CopiedSkill=LoadInteger(MHT,GetHandleId(cho),StringHash("scopied"+I2S(xx)))
    if CopiedTech!=0 then
      set level=GetUnitAbilityLevel(cho,CopiedSkill)
      //	if SubString(StackingLimitations[CopiedSkill],0,7)=="passive" then//[lich] remove active skill from availables 
      call UnitRemoveAbility(cho,CopiedSkill) // remove skill completely
      //else
      //call SetPlayerAbilityAvailable(p,CopiedSkill,false) 
      //endif
      //it will remove only passives
      
      
      call UnitMakeAbilityPermanent(cho,false,CopiedTech)
      call UnitRemoveAbility(cho,CopiedTech)
      call SetPlayerAbilityAvailable(p,CopiedTech,false)
      
      if xx==1 then
        set OriginTech= 'Y500'
        set OriginSkill=110*4+1
        set OriginalSkill='A590'
      elseif xx==2 then
        set OriginTech = 'Y501'
        set OriginSkill=110*4+2
        set OriginalSkill='A591'
      elseif xx==3 then
        set OriginTech = 'Y502'
        set OriginSkill=110*4+3
        set OriginalSkill='A592'
      elseif xx==4 then
        set OriginTech = 'Y503'
        set OriginSkill=110*4+4
        set OriginalSkill='A593'
      endif
      
      call UnitAddAbility(cho,OriginalSkill)
      
      call UnitAddAbility2(cho,OriginTech)
      call SetPlayerAbilityAvailable(p,OriginTech,false)
      call UnitMakeAbilityPermanent(cho,true,OriginTech)
      
      call SetUnitAbilityLevel(cho,OriginalSkill,level)
      
      set PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]=OriginSkill
    endif
    set CopiedTech=0
    exitwhen xx>PlayerSkillOffset
  endloop
  
  set p=null
  set cho=null
endfunction

function Formless_Reset_Init takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-reset",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-reset",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-reset",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-reset",true)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-reset",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-reset",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-reset",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-reset",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-reset",true)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-reset",true)
  call TriggerAddAction(t,function Formless_Reset_Effect)
  set t=null
endfunction 

function Formless_Effect takes unit cho, unit t, integer cha returns nothing
  local integer level=GetUnitAbilityLevel(cho,cha)
  local integer OriginTech
  local integer xx
  local integer i
  local player p=GetOwningPlayer(cho)
  local integer PlayerId= GetPlayerId(p)
  local integer PlayerId2= GetPlayerId(GetOwningPlayer(t))
  local integer CopiedTech
  local boolean b = false 
  if cha=='A590' then
    set xx=1
    set OriginTech= 'Y500'
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIsm\\AIsmTarget.mdl",cho,"origin"))
  elseif cha=='A591' then
    set xx=2
    set OriginTech = 'Y501'
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIsm\\AIsmTarget.mdl",cho,"origin"))
  elseif cha=='A592' then
    set xx=3
    set OriginTech = 'Y502'
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIsm\\AIsmTarget.mdl",cho,"origin"))
  elseif cha=='A593' then
    set xx=4
    set OriginTech = 'Y503'
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl",cho,"origin"))
  endif
  
  set CopiedTech = EngineeringUpgradeSkillID[PlayerSkillNumber[PlayerId2*PlayerSkillOffset+xx]]
  if CopiedTech==0 then
    call Error(p,"No Ability Found")
    return 
  endif
  if GetUnitAbilityLevel(cho,CopiedTech)==0 then
    call SaveInteger(MHT,GetHandleId(cho),StringHash("copied"+I2S(xx)),CopiedTech)
    call SaveInteger(MHT,GetHandleId(cho),StringHash("scopied"+I2S(xx)),SkillID[PlayerSkillNumber[PlayerId2*PlayerSkillOffset+xx]])
    
    call UnitRemoveAbility(cho,cha)
    
    call UnitMakeAbilityPermanent(cho,false,OriginTech)
    call UnitRemoveAbility(cho,OriginTech)
    call SetPlayerAbilityAvailable(p,OriginTech,false)
    //if SubString(StackingLimitations[PlayerSkillNumber[PlayerId2*PlayerSkillOffset+xx]],0,7)=="passive" then//[lich] if its passive then add, else if exist - set available, else - add
    call UnitAddAbility(cho,SkillID[PlayerSkillNumber[PlayerId2*PlayerSkillOffset+xx]])
    //elseif GetUnitAbilityLevel(cho,SkillID[PlayerSkillNumber[PlayerId2*PlayerSkillOffset+xx]])>0 then
    //	call SetPlayerAbilityAvailable(p,SkillID[PlayerSkillNumber[PlayerId2*PlayerSkillOffset+xx]],true)
    //else
    //  call UnitAddAbility(cho,SkillID[PlayerSkillNumber[PlayerId2*PlayerSkillOffset+xx]])
    //endif//
    call UnitAddAbility2(cho,CopiedTech)
    call SetPlayerAbilityAvailable(p,CopiedTech,false)
    call UnitMakeAbilityPermanent(cho,true,CopiedTech) 
    
    call SetUnitAbilityLevel(cho,SkillID[PlayerSkillNumber[PlayerId2*PlayerSkillOffset+xx]],level)
    
    
    //	call ModifyHeroSkillPoints(cho,bj_MODIFYMETHOD_ADD,level)
    //   set level2=level
    //   loop
    //	   call SelectHeroSkill(cho,SkillID[PlayerSkillNumber[PlayerId2*PlayerSkillOffset+xx]])
    //		set level2=level2-1
    //		exitwhen level2==0	 
    //	endloop	 
    
    
    //	call SetPlayerAbilityAvailable(p,SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],true) 
    //   call UnitAddAbility2(cho,CopiedTech)
    //	call SetPlayerAbilityAvailable(p,CopiedTech,false)
    //	call UnitMakeAbilityPermanent(cho,true,CopiedTech)
    
    //	call SetPlayerAbilityAvailable(p,SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],true) 
    ///	//  call SetUnitAbilityLevel(cho,SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]],level)
    
    set i=0
    loop     //general condition that work when s5 and s6
      set i=i+1
      if SkillID[PlayerSkillNumber[PlayerId*PlayerSkillOffset+i]]== cha then
        set b=true
      endif
      exitwhen b
    endloop
    set PlayerSkillNumber[PlayerId*PlayerSkillOffset+i]= PlayerSkillNumber[PlayerId2*PlayerSkillOffset+xx]
  elseif CopiedTech== 'Y500' or CopiedTech== 'Y501' or CopiedTech== 'Y502' or CopiedTech== 'Y503' then
    call Error(p,"You cannot copy Copy Abilities")
  else
    call Error(p,"You already have that ability")
  endif
  set p=null
endfunction

function FormlessTimer takes nothing returns nothing
  local timer t2 =GetExpiredTimer()
  local unit cho =LoadUnitHandle(MHT,GetHandleId(t2),1)
  local integer cha =LoadInteger(MHT,GetHandleId(t2),1)
  local unit t =LoadUnitHandle(MHT,GetHandleId(t2),2) 
  call Formless_Effect(cho,t,cha)
  call Timer_End(t2)
  set cho=null
  set t=null
  set t2=null
endfunction

function Formless_Condition takes nothing returns nothing
  local unit cho=GetTriggerUnit()
  local integer cha= GetSpellAbilityId()
  local unit t= GetSpellTargetUnit()
  local timer t2
  if cha=='A590' or cha=='A591' or cha=='A592' or cha=='A593' then
    set t2=Timer_Get()
    call SaveUnitHandle(MHT,GetHandleId(t2),1,cho)
    call SaveInteger(MHT,GetHandleId(t2),1,cha)
    call SaveUnitHandle(MHT,GetHandleId(t2),2,t)
    call TimerStart(t2,0.1,false, function FormlessTimer)   
  endif
  set cho=null
  set t=null
  set t2=null
endfunction

function Formless_Init takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function Formless_Condition))
  set t=null
endfunction


function Weaver_Attack_Learn takes nothing returns nothing
  local unit u = GetTriggerUnit()
  
  call UnitMakeAbilityPermanent(u,true,'A0CM')
  call UnitMakeAbilityPermanent(u,true,'A0CN')
  call UnitMakeAbilityPermanent(u,true,'A0CR')
  call UnitMakeAbilityPermanent(u,true,'A0CS')
  
  //local integer spell = 'A0CG'
  
  //call BJDebugMsg("Learning: "+GetUnitName(u))
  
  set u = null
endfunction


function R48 takes nothing returns nothing
  local unit u=LoadUnitHandle(hashtable019,'0GTU',1488)
  local integer Q28=LoadInteger(hashtable019,'0GLS',1488)
  local integer sl=LoadInteger(hashtable019,'0GAL',1488)
  local integer H8H
  local integer Level
  local unit u2
  local trigger t
  local integer integer302
  local player p
  local unit Caster
  local texttag tt
  local integer i
  local boolean LGF
  local unit Target
  local real x
  local real y
  local real ZV8
  local image im
  local string fx
  local location YT9
  local boolexpr VH9
  local group HQ9
  local integer Cache
  local integer FMF
  local unit DKD
  local real WFE
  local unit XX8
  local real BaseScale
  local region UJE
  local integer pid=GetPlayerId(GetOwningPlayer(u))
  if Q28=='A2JL' and sl==1 then
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call SaveInteger(hashtable019,(GetHandleId(u)),(747),(3))
    call UnitAddAbility2(u,OZ8[3])
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function unit158))
    call SaveUnitHandle(hashtable019,(Cache),(2),(u))
    call SaveInteger(hashtable019,(Cache),(34),(30))
    set t=CreateTrigger()
    set Cache=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,.5,true)
    call TriggerAddCondition(t,Condition(function CIG))
    call SaveUnitHandle(hashtable019,(Cache),(2),(u))
    set u=null
    set t=null
  elseif Q28=='A0BR' and sl==1 then
    call UnitAddAbility2(GetTriggerUnit(),'A0CQ')
  elseif Q28=='A21X' then
    call SetHeroAgi(u,GetHeroAgi(u,false)+4,true)
    call SaveInteger(hashtable019,GetHandleId(u),3000,sl)
  elseif Q28=='A21W' then
    call SetHeroStr(u,GetHeroStr(u,false)+4,true)
    call SaveInteger(hashtable019,GetHandleId(u),3001,sl)
  elseif Q28=='A21V' then
    call SetHeroInt(u,GetHeroInt(u,false)+4,true)
    call SaveInteger(hashtable019,GetHandleId(u),3002,sl)
  endif
  set u2=null
  set Caster=null
  set Target=null
  set DKD=null
  set XX8=null
  set HQ9=null
  set YT9=null
  set UJE=null
  set VH9=null
  set t=null
  set u=null
endfunction

function isUnitSomesideBuilding takes nothing returns boolean
  return((GetOwningPlayer(GetFilterUnit())==Player(0)or GetOwningPlayer(GetFilterUnit())==Player(6))and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE))!=null
endfunction

function HEH takes nothing returns nothing
  local trigger t
  
  set t=CreateTrigger()
  call TriggerRegisterEnterRectSimple(t,GetWorldBounds())
  call TriggerAddAction(t,function SH8)
  
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_LEVEL)
  call TriggerAddAction(t,function Func1381)
  //set t=CreateTrigger()
  //call TriggerRegisterEnterRectSimple(t,bj_mapInitialPlayableArea)
  //call TriggerAddAction(t,function DPSRegister)
  //call TimerStart(CreateTimer(),1.,true,function DPSTimerCounter)
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddAction(t,function BYD)
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddAction(t,function BXD)
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CHANNEL)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
  call TriggerAddAction(t,function R78)
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_LEVEL)
  call TriggerAddAction(t,function Q08)
  
  if Mode_Debug then
    set t=CreateTrigger()
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_ORDER)
    call TriggerAddAction(t,function QU8)
    set t=CreateTrigger()
    call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
    call TriggerAddAction(t,function QT8)
    set t=CreateTrigger()
    call TriggerRegisterPlayerSelectionEventBJ(t,Player(1),true)
    call TriggerAddAction(t,function QS8)
  endif
  //call ExecuteFunc("SZ8")
  //call InitInvokerSpells()
  call RP8()
  call TriggerSleepAction(1)
  set t=null
endfunction


function Gnoll_Flux_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if IsDead(t)==false and IsUnitAlly(group_temp_unit[0],GetOwningPlayer(t)) and GetUnitAbilityLevel(t,'A04R')==0 and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) and t!=group_temp_unit[0] then
    call SaveBoolean(MHT,99999,99999,false)
    set t = null
  endif
  
  set t = null
  return false
endfunction

function Gnoll_Flux_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,0)
  
  if count==120 or IsDead(u)then
    call DestroyEffect(LoadEffectHandle(MHT,info,2))
    call Timer_End(t)
    set t = null
    set u = null
    return
  endif
  
  call SaveInteger(MHT,info,0,count + 1)
  
  set group_temp_unit[0] = u
  call SaveBoolean(MHT,99999,99999,true)
  
  call GroupEnumUnitsInRange(temp_group,GetWidgetX(u),GetWidgetY(u),250,Condition(function Gnoll_Flux_Targets))
  
  if LoadBoolean(MHT,99999,99999)then
    if GetUnitAbilityLevel(u,LoDBuff_BuffID[27])==0then
      call Buff_Add(u,LoDBuff_AbilID[27],LoDBuff_BuffID[27],6 - count*0.05)
    endif
    if count/10 == count/10. then
      call DamageTarget(LoadUnitHandle(MHT,info,1),u,1,LoadReal(MHT,info,0))
    endif
  else
    call Buff_Remove(u,LoDBuff_BuffID[27])
  endif
  
  set t = null
  set u = null
endfunction

function Gnoll_Flux_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local unit d = GetSpellTargetUnit()
  local integer info = GetHandleId(t)
  
  call SaveUnitHandle(MHT,info,0,d)
  call SaveUnitHandle(MHT,info,1,u)
  call SaveEffectHandle(MHT,info,2,AddSpecialEffectTarget("war3mapImported\\Flux3.mdx",d,"origin"))
  call SaveInteger(MHT,info,0,0)
  call SaveReal(MHT,info,0,GetUnitAbilityLevel(u,'A2M1')*7.5)
  
  call TimerStart(t,0.05,true,function Gnoll_Flux_Duration)
  call Buff_Add(d,LoDBuff_AbilID[27],LoDBuff_BuffID[27],6)
  
  set d = null
  set u = null
  set t = null
endfunction


function Gnoll_Field_Targets takes nothing returns nothing
  local integer key
  local integer info
  local unit t = GetFilterUnit()
  
  if IsUnitAlly(t,group_temp_player)and (IsUnitType(t,UNIT_TYPE_HERO)or IsUnitType(t,UNIT_TYPE_STRUCTURE)==true)and GetUnitAbilityLevel(t,'A04R')==0 and IsDead(t)==false then
    call GroupAddUnit(temp_group2,t)   //adds the unit to group of currently affected units
    
    if IsUnitInGroup(t,group_temp_group)==false then  //hasn't been affected by the field
      set info = GetHandleId(t)
      set key = StringHash("field_count")
      
      call Buff_Add(t,LoDBuff_AbilID[28],LoDBuff_BuffID[28],-1) //adds the buff
      
      if IsUnitType(t,UNIT_TYPE_HERO)then
        call LoDStat_Add(t,group_temp_integer[0],"attack")
      else
        call LoDStat_Add(t,group_temp_integer[1],"attack")
      endif
      
      call SaveInteger(MHT,info,key,LoadInteger(MHT,info,key) + 1) //keeps track of the number of times the unit has been affected for field stacking
      
      
      call UnitAddAbility(t,'A515')
      call UnitMakeAbilityPermanent(t,true,'A515')
      call UnitMakeAbilityPermanent(t,true,'ACes')
      
      set t = null
      return
    endif
    
    call GroupRemoveUnit(group_temp_group,t) //removes the unit from the group of previously affected units
  endif
  
  set t = null
endfunction

function Gnoll_Field_Duration takes nothing returns nothing
  local unit u = null
  local timer t = GetExpiredTimer()
  local integer key = StringHash("field_count")
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local integer amount = LoadInteger(MHT,info,1)
  
  set group_temp_group = LoadGroupHandle(MHT,info,1)
  
  if count==0 then
    call DestroyEffect(LoadEffectHandle(MHT,info,2))
    
    loop
      set u = FirstOfGroup(group_temp_group)
      exitwhen u==null
      set info = GetHandleId(u)
      set count = LoadInteger(MHT,info,key)
      
      if count==1then
        call UnitRemoveAbility(u,'A515')
        call Buff_Remove(u,LoDBuff_BuffID[28])
      endif
      
      call SaveInteger(MHT,info,key,count - 1)
      call LoDStat_Sub(u,amount,"attack")
      
      call GroupRemoveUnit(group_temp_group,u)
    endloop
    
    call KillGroup(group_temp_group)
    call Timer_End(t)
    set t = null
    return
  endif
  
  call SaveInteger(MHT,info,0,count - 1)
  
  set group_temp_player = LoadPlayerHandle(MHT,info,0)
  set group_temp_integer[0] = amount
  set group_temp_integer[1] = amount/2
  
  call GroupEnumUnitsInRange(temp_group,LoadReal(MHT,info,0),LoadReal(MHT,info,1),325,Condition(function Gnoll_Field_Targets))
  
  
  //removes the bonuses from any unit out of range
  loop
    set u = FirstOfGroup(group_temp_group)
    exitwhen u==null
    set info = GetHandleId(u)
    set count = LoadInteger(MHT,info,key)
    
    if count==1then
      call UnitRemoveAbility(u,'A515')
      call Buff_Remove(u,LoDBuff_BuffID[28])
    endif
    
    call SaveInteger(MHT,info,key,count - 1)
    call LoDStat_Sub(u,amount,"attack")
    
    call GroupRemoveUnit(group_temp_group,u)
  endloop
  
  //updates the current group with the newly affected units
  loop
    set u = FirstOfGroup(temp_group2)
    exitwhen u==null
    call GroupRemoveUnit(temp_group2,u)
    call GroupAddUnit(group_temp_group,u)
  endloop
  
  
  set t = null
endfunction

function Gnoll_Field_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local real x = GetSpellTargetX()
  local real y = GetSpellTargetY()
  local integer info = GetHandleId(t)
  local integer level = GetUnitAbilityLevel(u,'A2LM')
  
  call SavePlayerHandle(MHT,info,0,GetOwningPlayer(u))
  call SaveGroupHandle(MHT,info,1,GetAvailableGroup())
  call SaveEffectHandle(MHT,info,2,AddSpecialEffect("war3mapImported\\MagneticField04.mdl",x,y))
  call SaveInteger(MHT,info,0,30 + 5*level)
  call SaveInteger(MHT,info,1,40 + 10*level)
  call SaveReal(MHT,info,0,x)
  call SaveReal(MHT,info,1,y)
  
  call TimerStart(t,0.1,true,function Gnoll_Field_Duration)
  
  set t = null
  set u = null
endfunction


function Gnoll_Spark_Closest takes unit u returns nothing
  local real x = GetWidgetX(u) - group_temp_real[0]
  local real y = GetWidgetY(u) - group_temp_real[1]
  local real d = SquareRoot(x*x + y*y)
  
  if group_temp_real[2] > d then
    set group_temp_real[2] = d
    set group_temp_unit[0] = u
  endif
endfunction

function Gnoll_Spark_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if IsUnitEnemy(t,group_temp_player) and GetUnitAbilityLevel(t,'A04R')==0 and IsMagicImmune(t)==false and IsDead(t)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) then
    call Gnoll_Spark_Closest(t)
  endif
  
  set t = null
  return false
endfunction

function Gnoll_Spark_Chase takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local unit u1 = LoadUnitHandle(MHT,info,0)
  local unit u2 = LoadUnitHandle(MHT,info,1)
  local real x2
  local real y2
  local real x1
  local real y1
  
  if IsDead(u2)then
    call KillUnit(u1)
    
    call Timer_End(t)
    set u2 = null
    set u1 = null
    set t = null
    return
  endif
  
  set x1 = GetWidgetX(u1)
  set y1 = GetWidgetY(u1)
  set x2 = x1 - GetWidgetX(u2)
  set y2 = y1 - GetWidgetY(u2)
  
  if 15>SquareRoot(x2*x2 + y2*y2)then
    call DamageTarget(LoadUnitHandle(MHT,info,3),u2,1,LoadInteger(MHT,info,1))
    call KillUnit(u1)
    
    call Timer_End(t)
    set u2 = null
    set u1 = null
    set t = null
    return
  endif
  
  set x2 = Atan2(-y2,-x2)
  
  call SetUnitX(u1,x1 + 10.625*Cos(x2))
  call SetUnitY(u1,y1 + 10.625*Sin(x2))
  
  set u2 = null
  set u1 = null
  set t = null
endfunction

function Gnoll_Spark_Duration takes nothing returns nothing
  local unit u = null
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  
  if count==1000 then
    call KillUnit(LoadUnitHandle(MHT,info,0))
    call Timer_End(t)
    set t = null
    return
  endif
  
  set group_temp_player = LoadPlayerHandle(MHT,info,2)
  set group_temp_unit[0] = null
  set group_temp_real[0] = LoadReal(MHT,info,0)
  set group_temp_real[1] = LoadReal(MHT,info,1)
  set group_temp_real[2] = 450
  
  call GroupEnumUnitsInRange(temp_group,group_temp_real[0],group_temp_real[1],400,Condition(function Gnoll_Spark_Targets))
  
  call SaveInteger(MHT,info,0,count + 1)
  
  if group_temp_unit[0]!=null then
    set u = LoadUnitHandle(MHT,info,0)
    
    call SetUnitAnimationByIndex(u,2)
    call SetUnitVertexColor(u,255,255,255,150)
    call SaveUnitHandle(MHT,info,1,group_temp_unit[0])
    
    call TimerStart(t,0.025,true,function Gnoll_Spark_Chase)
    
    set u = null
  endif
  
  set t = null
endfunction

function Gnoll_Spark_Delay takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  
  call TimerStart(t,0.05,true,function Gnoll_Spark_Duration)
  
  call SetUnitAnimationByIndex(LoadUnitHandle(MHT,info,0),1)
  
  set t = null
endfunction

function Gnoll_Spark_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local player p = GetOwningPlayer(u)
  local real x = GetSpellTargetX()
  local real y = GetSpellTargetY()
  local unit d = CreateUnit(p,'h0EG',x,y,270)
  local integer info = GetHandleId(t)
  
  call UnitAddAbility(d,'Aloc')
  call UnitAddAbility(d,'A04R')
  call UnitAddAbility(d,'Arav')
  
  call SaveUnitHandle(MHT,info,0,d)
  call SaveUnitHandle(MHT,info,3,u)
  call SavePlayerHandle(MHT,info,2,p)
  call SaveInteger(MHT,info,0,0)
  call SaveInteger(MHT,info,1,100 + 50*GetUnitAbilityLevel(u,'A2LL'))
  call SaveReal(MHT,info,0,x)
  call SaveReal(MHT,info,1,y)
  
  call SetUnitAnimationByIndex(d,0)
  
  call TimerStart(t,3,false,function Gnoll_Spark_Delay)
  
  set p = null
  set d = null
  set u = null
  set t = null
endfunction


function Func4152 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit tempest=(LoadUnitHandle(hashtable019,(h),(17)))
  call FlushChildHashtable(hashtable019,(h))
  call CleanTrigger(t)
  call FlushChildHashtable(hashtable019,(GetHandleId(tempest)))
  call RemoveUnit(tempest)
  set t=null
  set tempest=null
  return false
endfunction

function Func4153 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit tempest=(LoadUnitHandle(hashtable019,(h),(2)))
  call FlushChildHashtable(hashtable019,(h))
  call CleanTrigger(t)
  call FlushChildHashtable(hashtable019,(GetHandleId(tempest)))
  call ShowUnit(tempest,false)
  set t=null
  set tempest=null
  return false
endfunction

function Func4154 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local unit tempest=(LoadUnitHandle(hashtable019,(h),(17)))
  local integer lvl=GetUnitAbilityLevel(caster,'A2M0')
  if GetTriggerEvalCount(t)==200 or GetTriggerEventId()==EVENT_WIDGET_DEATH then
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
    call KillUnit(tempest)
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl",GetUnitX(tempest),GetUnitX(tempest)))
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call SaveUnitHandle(hashtable019,(h),(2),(tempest))
    call TriggerRegisterTimerEvent(t,0,false)
    call TriggerAddCondition(t,Condition(function Func4153))
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,3,false)
    call TriggerAddCondition(t,Condition(function Func4152))
    call SaveUnitHandle(hashtable019,(h),(17),(tempest))
  else
    call SuspendHeroXP(tempest,true)
    call UnitModifySkillPoints(tempest,-25)
  endif
  set t=null
  set caster=null
  set tempest=null
  return false
endfunction

function Zet_Tempest_Start takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local unit tempest
  local integer lvl=GetUnitAbilityLevel(caster,'A2M0')
  local integer i=0
  local item it
  local integer dummyItemId='I02M'
  local integer pid=GetPlayerId(GetOwningPlayer(caster))
  call DisableTrigger(HeroEnters)
  set tempest=CreateUnit(GetOwningPlayer(caster),GetUnitTypeId(caster),GetUnitX(caster),GetUnitY(caster),0)
  call EnableTrigger(HeroEnters)
  call SetUnitVertexColor(tempest,255,255,255,130)
  call SaveBoolean(hashtable019,GetHandleId(tempest),StringHash("tempest"),true)
  call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl",tempest,"chest"))
  if IsSentinel(GetOwningPlayer(tempest))==false then
    //set dummyItemId='I0PC'
  endif
  call SelectUnitAddForPlayer(tempest,GetOwningPlayer(caster))
  call DisableTrigger(t_manipulateitem)
  loop
    exitwhen i>5
    if UnitItemInSlot(caster,i)!=null and GetItemTypeId(UnitItemInSlot(caster,i))!=Item_Real[indexid_Aegis]and GetItemTypeId(UnitItemInSlot(caster,i))!=Item_Real[indexid_RefresherOrb]and GetItemTypeId(UnitItemInSlot(caster,i))!=Item_Real[indexid_ObserverWards]and GetItemTypeId(UnitItemInSlot(caster,i))!=Item_Real[indexid_SentryWards]and GetItemTypeId(UnitItemInSlot(caster,i))!=Item_Real[indexid_Smoke]then
      set it=CreateItem(GetItemTypeId(UnitItemInSlot(caster,i)),0,0)
      if GetItemCharges(UnitItemInSlot(caster,i))>0 then
        call SetItemCharges(it,GetItemCharges(UnitItemInSlot(caster,i)))
      endif
      call UnitAddItem(tempest,it)
      call SetItemPlayer(it,GetOwningPlayer(tempest),false)
      if GetItemTypeId(it)==Item_Real[indexid_DivineRapier]or GetItemTypeId(it)==Item_Real[indexid_DivineRapierFree]or GetItemTypeId(it)==Item_Real[indexid_Gem]then
        call SetItemDropOnDeath(it,false)
      endif
    else
      call UnitAddItem(tempest,CreateItem(dummyItemId,0,0))
    endif
    set i=i+1
  endloop
  call EnableTrigger(t_manipulateitem)
  call SetHeroLevel(tempest,GetHeroLevel(caster),false)
  set i=1
  loop
    exitwhen i>GetUnitAbilityLevel(caster,'Aamk')
    call SelectHeroSkill(tempest,'Aamk')
    set i=i+1
  endloop
  call UnitAddAbility2(tempest,EngineeringUpgradeSkillID[PlayerSkillNumber[pid*PlayerSkillOffset+1]])
  call UnitAddAbility2(tempest,EngineeringUpgradeSkillID[PlayerSkillNumber[pid*PlayerSkillOffset+2]])
  call UnitAddAbility2(tempest,EngineeringUpgradeSkillID[PlayerSkillNumber[pid*PlayerSkillOffset+3]])
  call UnitAddAbility2(tempest,EngineeringUpgradeSkillID[PlayerSkillNumber[pid*PlayerSkillOffset+4]])
  
  set i=1
  loop
    exitwhen i>GetUnitAbilityLevel(caster,SkillID[PlayerSkillNumber[pid*PlayerSkillOffset+1]])
    call SelectHeroSkill(tempest,SkillID[PlayerSkillNumber[pid*PlayerSkillOffset+1]])
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>GetUnitAbilityLevel(caster,SkillID[PlayerSkillNumber[pid*PlayerSkillOffset+2]])
    call SelectHeroSkill(tempest,SkillID[PlayerSkillNumber[pid*PlayerSkillOffset+2]])
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>GetUnitAbilityLevel(caster,SkillID[PlayerSkillNumber[pid*PlayerSkillOffset+3]])
    call SelectHeroSkill(tempest,SkillID[PlayerSkillNumber[pid*PlayerSkillOffset+3]])
    set i=i+1
  endloop
  set i=1
  loop
    exitwhen i>GetUnitAbilityLevel(caster,SkillID[PlayerSkillNumber[pid*PlayerSkillOffset+4]])
    call SelectHeroSkill(tempest,SkillID[PlayerSkillNumber[pid*PlayerSkillOffset+4]])
    set i=i+1
  endloop
  call UnitRemoveAbility(tempest,'A2M0')
  call UnitModifySkillPoints(tempest,-25)
  call SuspendHeroXP(tempest,true)
  call TriggerRegisterTimerEvent(t,0.1,true)
  call TriggerRegisterDeathEvent(t,tempest)
  call TriggerAddCondition(t,Condition(function Func4154))
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  call SaveUnitHandle(hashtable019,(h),(17),(tempest))
  call SetUnitState(caster,UNIT_STATE_LIFE,GetUnitState(caster,UNIT_STATE_LIFE)*(1-(0.45-0.15*lvl)))
  call SetUnitState(caster,UNIT_STATE_MANA,GetUnitState(caster,UNIT_STATE_MANA)*(1-(0.45-0.15*lvl)))
  call SetUnitState(tempest,UNIT_STATE_LIFE,GetUnitState(caster,UNIT_STATE_LIFE))
  call SetUnitState(tempest,UNIT_STATE_MANA,GetUnitState(caster,UNIT_STATE_MANA))
  set caster=null
  set tempest=null
  set t=null
  set it=null
endfunction


function Wyvern_Burn_Buff takes unit u returns boolean
  return GetUnitAbilityLevel(u,'D100')==1 or GetUnitAbilityLevel(u,'D101')==1 or GetUnitAbilityLevel(u,'D102')==1 or GetUnitAbilityLevel(u,'D103')==1
endfunction

function Wyvern_Burn_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,0)
  local real life
  
  if count==4 or IsDead(u) or Wyvern_Burn_Buff(u)==false then
    call DestroyEffect(LoadEffectHandle(MHT,info,1))
    call Timer_End(t)
    set t = null
    set u = null
    return
  endif
  
  set life = GetWidgetLife(u)
  set life = life - life*0.06
  
  if 0.405 > life then
    set life = 0.406
  endif
  
  call SetWidgetLife(u,life)
  call SaveInteger(MHT,info,0,count + 1)
  
  set t = null
  set u = null
endfunction

function Wyvern_Burn_Effect takes unit u, unit d returns nothing
  local timer t = Timer_Get()
  local integer info = GetHandleId(t)
  local integer level = GetUnitAbilityLevel(u,'A332') - 1
  
  
  call Buff_Add(d,'C100' + level,'D100' + level,5)
  
  call SaveUnitHandle(MHT,info,0,d)
  call SaveEffectHandle(MHT,info,1,AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostDamage\\FrostDamage.mdl",d,"chest"))
  call SaveInteger(MHT,info,0,0)
  
  call TimerStart(t,1,true,function Wyvern_Burn_Duration)
  
  set t = null
endfunction

function Wyvern_Burn_Damage_Detect takes nothing returns nothing
  local unit u = null
  local trigger trig = GetTriggeringTrigger()
  local integer info = GetHandleId(trig)
  
  if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
    call CleanTrigger(trig)
    call RemoveSavedHandle(MHT,info,0)
    set trig = null
    return
  endif
  
  set u = GetEventDamageSource()
  
  if u==LoadUnitHandle(MHT,info,0) and GetEventDamage()>5then
    call Wyvern_Burn_Effect(u,GetTriggerUnit())
    call CleanTrigger(trig)
    call RemoveSavedHandle(MHT,info,0)
  endif
  
  set trig = null
  set u = null
endfunction

function Wyvern_Burn_Damage_Start takes unit u, unit t returns nothing
  local trigger trig = CreateTrigger()
  
  call SaveUnitHandle(MHT,GetHandleId(trig),0,u)
  
  call TriggerRegisterUnitEvent(trig,t,EVENT_UNIT_DAMAGED)
  call TriggerRegisterTimerEvent(trig,3,false)
  call TriggerAddCondition(trig,Condition(function Wyvern_Burn_Damage_Detect))
  
  set trig = null
endfunction

function Wyvern_Burn_Attack_Condition takes unit u, unit t returns nothing
  //local integer level
  
  if GetUnitAbilityLevel(u,LoDBuff_BuffID[29])==1 and GetUnitAbilityLevel(t,'A04R')==0 and Wyvern_Burn_Buff(t)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and IsUnitEnemy(u,GetOwningPlayer(t)) and GetUnitTypeId(t)!='n00L'then
    //set level = GetUnitAbilityLevel(u,'A2NE') - 1
    
    //if Wyvern_Burn_Buff(u)==false then
    //	call Wyvern_Burn_Attack_Start(u,t,level)
    //endif
    
    //call Buff_Add(t,'C100' + level,'D100' + level,5)
    
    call Wyvern_Burn_Damage_Start(u,t)
  endif
endfunction

function Wyvern_Burn_End takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local unit u = LoadUnitHandle(MHT,info,0)
  local integer lvl
  local integer h
  
  if IsDead(u)==false and LoadBoolean(MHT,GetHandleId(u),StringHash("morphedburn")) then
    //call Transform_Movement(u,'A2NE',GetUnitTypeId(u))
    call UnMorphUnit(u,LoadInteger(MHT,info,1))
    call UnMorphUnit(u,LoadInteger(MHT,info,0))
    call KillTrees(GetWidgetX(u),GetWidgetY(u),150)
    call SaveBoolean(MHT,GetHandleId(u),StringHash("morphedburn"),false)
    call SaveInteger(MHT,GetHandleId(u),StringHash("morphedburn"),0)
    if GetUnitAbilityLevel(u,'Q0BK')>0 then
      set lvl=GetUnitAbilityLevel(u,'Q0BK')
      call UnitRemoveAbility(u,'Q0BK')
      call UnitAddAbility2(u,'Q0BK')
      call SetUnitAbilityLevel(u,'Q0BK',lvl)
    endif
    if GetUnitAbilityLevel(u,'A0CG')>0 then
      set lvl=GetUnitAbilityLevel(u,'A0CG')
      call UnitRemoveAbility(u,'A0CG')
      call UnitAddAbility2(u,'A0CG')
      call SetUnitAbilityLevel(u,'A0CG',lvl)
    endif
    call RemoveAbilsForUnit(u)
    if GetUnitAbilityLevel(u,'A2AI')>0 then
      call UnitRemoveAbility(u,'QF0O')
      call SetUnitAbilityLevel(u,'QB0G',GetUnitAbilityLevel(u,'A2AI'))
    endif
    call Timer_End(t)
  elseif IsDead(u) and LoadBoolean(MHT,GetHandleId(u),StringHash("morphedburn")) then
    call TimerStart(t,1,true,function Wyvern_Burn_End)
    
    
  endif
  set t = null
  set u = null
endfunction

function Wyvern_Burn_Start takes nothing returns nothing
  //local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  //local integer info = GetHandleId(t)
  //	local integer level = GetUnitAbilityLevel(u,'A2NE') - 1
  //	local integer id = 'M550' + 2*level + 1
  //	local integer cha = MorphUnit(u) + 1
  //	local integer h
  //	call SaveUnitHandle(MHT,info,0,u)
  //	call SaveInteger(MHT,info,0,cha)
  //	call SaveInteger(MHT,info,1,id - 1)
  //
  //	call SaveBoolean(MHT,GetHandleId(u),StringHash("morphedburn"),true)
  //	call SaveInteger(MHT,GetHandleId(u),StringHash("first"),cha)
  //	call SaveInteger(MHT,GetHandleId(u),StringHash("second"),id - 1)
  //
  //	call UnitAddAbility(u,id)
  //	call UnitRemoveAbility(u,id)
  if GetUnitTypeId(u)!='N0MA' and GetUnitTypeId(u)!='N0MO' and GetUnitTypeId(u)!='N0MB' and GetUnitTypeId(u)!='N0MC' then
    call RemoveAbilsForUnit(u)
    call Buff_Add(u,LoDBuff_AbilID[29],LoDBuff_BuffID[29],6)
    call FixPassiveSkills_TempDisableAbilitiesForHero(u)
  else
    call KillTrees(GetUnitX(u),GetUnitY(u),200)
  endif
  //call TimerStart(t,6,false,function Wyvern_Burn_End)
  
  //set t = null
  set u = null
endfunction



function Wyvern_Blast_Secondary_Duration takes nothing returns nothing
  local unit u = null
  local unit u2 = null
  local timer t = GetExpiredTimer()
  local boolean b = true
  local integer info = GetHandleId(t)
  local integer loopA = 3
  local integer count = LoadInteger(MHT,info,0)
  local real x1
  local real y1
  local real x2
  local real y2
  
  loop
    exitwhen loopA == count
    if LoadBoolean(MHT,info,loopA)then
      set u2 = LoadUnitHandle(MHT,info,loopA + 1)
      
      if IsDead(u2)then
        call KillUnit(LoadUnitHandle(MHT,info,loopA))
        call SaveBoolean(MHT,info,loopA,false)
      else
        set u = LoadUnitHandle(MHT,info,loopA)
        set x1 = GetWidgetX(u)
        set y1 = GetWidgetY(u)
        set x2 = x1 - GetWidgetX(u2)
        set y2 = y1 - GetWidgetY(u2)
        
        if 16 > SquareRoot(x2*x2 + y2*y2)then
          call SaveBoolean(MHT,info,loopA,false)
          call DamageTarget(LoadUnitHandle(MHT,info,2),u2,1,LoadInteger(MHT,info,1))
          call Buff_Add(u2,LoDBuff_AbilID[30],LoDBuff_BuffID[30],4)
          call KillUnit(u)
        else
          set b = false
          set x2 = Atan2(-y2,-x2)
          
          call SetUnitX(u,x1 + 15*Cos(x2))
          call SetUnitY(u,y1 + 15*Sin(x2))
          call SetUnitFacing(u,x2*bj_RADTODEG)
        endif
      endif
    endif
    set loopA = loopA + 2
  endloop
  
  if b then
    call Timer_End(t)
  endif
  
  set u2 = null
  set u = null
  set t = null
endfunction

function Wyvern_Blast_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  
  if IsUnitEnemy(t,group_temp_player) and GetUnitAbilityLevel(t,'A04R')==0 and IsMagicImmune(t)==false and IsDead(t)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and (IsUnitType(t,UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(t)) and t!=group_temp_unit[0] then
    call SaveUnitHandle(MHT,group_temp_integer[0],group_temp_integer[1],CreateUnit(group_temp_player,'h0EC',group_temp_real[0],group_temp_real[1],0))
    call SaveUnitHandle(MHT,group_temp_integer[0],group_temp_integer[1]+1,t)
    call SaveBoolean(MHT,group_temp_integer[0],group_temp_integer[1],true)
    set group_temp_integer[1] = group_temp_integer[1] + 2
    call SaveBoolean(MHT,99999,99998,true)
  endif
  
  set t = null
  return false
endfunction

function Wyvern_Blast_Effect takes timer t, integer info, unit u returns nothing
  set group_temp_unit[0] = u
  set group_temp_player = GetOwningPlayer(LoadUnitHandle(MHT,info,2))
  set group_temp_integer[0] = info
  set group_temp_integer[1] = 3
  set group_temp_real[0] = GetWidgetX(u)
  set group_temp_real[1] = GetWidgetY(u)
  call SaveBoolean(MHT,99999,99998,false)
  
  call GroupEnumUnitsInRange(temp_group,group_temp_real[0],group_temp_real[1],525,Condition(function Wyvern_Blast_Targets))
  
  if LoadBoolean(MHT,99999,99998) then
    call SaveInteger(MHT,info,0,group_temp_integer[1])
    call TimerStart(t,0.025,true,function Wyvern_Blast_Secondary_Duration)
  endif
  
  call RemoveSavedHandle(MHT,99999,99998)
endfunction

function Wyvern_Blast_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local unit u2 = LoadUnitHandle(MHT,info,1)
  local unit u1 = LoadUnitHandle(MHT,info,0)
  local real x1 = GetWidgetX(u1)
  local real y1 = GetWidgetY(u1)
  local real x2 = x1 - GetWidgetX(u2)
  local real y2 = y1 - GetWidgetY(u2)
  local real d = SquareRoot(x2*x2 + y2*y2)
  local real s = d/(55-count)
  
  if s>=SquareRoot(x2*x2 + y2*y2)then
    call Wyvern_Blast_Effect(t,info,u2)
    call KillUnit(u1)
    
    set u2 = null
    set u1 = null
    set t = null
    return
  endif
  
  set d = Atan2(-y2,-x2)
  call SetUnitX(u1,x1 + s*Cos(d))
  call SetUnitY(u1,y1 + s*Sin(d))
  call SetUnitFacing(u1,d*bj_RADTODEG)
  
  call SaveInteger(MHT,info,0,count + 1)
  
  set u2 = null
  set u1 = null
  set t = null
endfunction

function Wyvern_Blast_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit u = GetTriggerUnit()
  local unit d = CreateUnit(GetOwningPlayer(u),'e01E',GetWidgetX(u),GetWidgetY(u),0)
  local integer info = GetHandleId(t)
  
  call SaveUnitHandle(MHT,info,0,d)
  call SaveUnitHandle(MHT,info,1,GetSpellTargetUnit())
  call SaveUnitHandle(MHT,info,2,u)
  call SaveInteger(MHT,info,0,0)
  call SaveInteger(MHT,info,1,GetUnitAbilityLevel(u,'A2LA')*80 + 20)
  
  call TimerStart(t,0.025,true,function Wyvern_Blast_Duration)
  
  set d = null
  set u = null
  set t = null
endfunction

function SplinterBlast_TargetsAvailable takes nothing returns boolean
  return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or IsUnitSpiritBear(GetFilterUnit()))
endfunction

function Func4060 takes nothing returns nothing
  local integer h=GetHandleId(GetTriggeringTrigger())
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local unit target=TempTarget
  local integer lvl=GetUnitAbilityLevel(caster,'A2LA')
  if IsMagicImmune(target)==false then
    call DamageTarget(caster,target,1,20+80*lvl)
    call Buff_Add(target,LoDBuff_AbilID[30],LoDBuff_BuffID[30],4)
    call AddTimedAbility(target,'A2MJ',1,4)
    //call SetPlayerAbilityAvailable(GetOwningPlayer(target),'A2MK',false)
    //call UnitMakeAbilityPermanent(target,true,'A2MJ')
  endif
  set caster=null
  set target=null
endfunction

function Func4061 takes nothing returns nothing
  local unit u=Wyvern_SplinterBlast_InitialCaster
  local unit target=GetEnumUnit()
  local trigger t=CreateDummyProjectile(Wyvern_SplinterBlast_Helper,target,'h0EC',"Func4060",600)
  local integer h=GetHandleId(t)
  call SaveUnitHandle(hashtable019,(h),(2),(u))
  set u=null
  set target=null
  set t=null
endfunction

function Func4062 takes unit caster,unit target returns nothing
  local integer lvl=GetUnitAbilityLevel(caster,'A2LA')
  local group g=GetAvailableGroup()
  set tt_unit1=caster
  set Wyvern_SplinterBlast_InitialCaster=caster
  set Wyvern_SplinterBlast_Helper=target
  call GroupEnumUnitsInRange(g,GetUnitX(target),GetUnitY(target),525,Condition(function SplinterBlast_TargetsAvailable))
  call GroupRemoveUnit(g,target)
  call ForGroup(g,function Func4061)
  call KillGroup(g)
  set caster=null
  set target=null
  set g=null
endfunction

function Func4063 takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,(h),(2)))
  local unit target=(LoadUnitHandle(hashtable019,(h),(17)))
  local unit proj=(LoadUnitHandle(hashtable019,(h),(45)))
  local real px=GetUnitX(proj)
  local real py=GetUnitY(proj)
  local real tx=GetUnitX(target)
  local real ty=GetUnitY(target)
  local real distance=DistanceBetweenXY(tx,ty,px,py)
  local integer count=GetTriggerEvalCount(t)
  local real angle=AngleBetweenXY(px,py,tx,ty)
  local real newX
  local real newY
  local real speed=distance/((1.35/.02)-count)
  if speed<500*0.02 then
    set speed=500*0.02
  endif
  set newX=px+speed*Cos(angle*bj_DEGTORAD)
  set newY=py+speed*Sin(angle*bj_DEGTORAD)
  call SetUnitX(proj,newX)
  call SetUnitY(proj,newY)
  call SetUnitFacing(proj,angle)
  if DistanceBetweenXY(tx,ty,newX,newY)<=speed then
    call KillUnit(proj)
    call Func4062(caster,target)
    call FlushChildHashtable(hashtable019,(h))
    call CleanTrigger(t)
  endif
  set t=null
  set target=null
  set caster=null
  set proj=null
  return false
endfunction

function Wyvern_SplinterBlast_Start takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local unit target=GetSpellTargetUnit()
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local unit proj=CreateUnit(GetOwningPlayer(caster),'e01E',GetUnitX(caster),GetUnitY(caster),0)
  call TriggerRegisterTimerEvent(t,0.02,true)
  call TriggerAddCondition(t,Condition(function Func4063))
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  call SaveUnitHandle(hashtable019,(h),(17),(target))
  call SaveUnitHandle(hashtable019,(h),(45),(proj))
  set caster=null
  set target=null
  set proj=null
  set t=null
endfunction


function Wyvern_Embrace_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,0)
  local real life
  
  if count==40 or IsDead(u) or IsUnitHidden(u) or GetUnitAbilityLevel(u,'BNdo')>0 then
    set count = 1
    loop
      exitwhen count==10
      call DestroyEffect(LoadEffectHandle(MHT,info,count))
      set count = count + 1
    endloop
    
    set info = GetHandleId(u)
    set count = LoadInteger(MHT,info,'A516')
    
    if count==1then
      call UnitRemoveAbility(u,'A516')
    endif
    
    call SaveInteger(MHT,info,'A516',count - 1)
    
    call Timer_End(t)
    set t = null
    set u = null
    return
  endif
  
  set life = GetWidgetLife(u)
  
  call SetWidgetLife(u,life + 2 + GetUnitState(u,UNIT_STATE_MAX_LIFE)*LoadReal(MHT,info,0))
  call SaveInteger(MHT,info,0,count + 1)
  
  set t = null
  set u = null
endfunction

function Wyvern_Embrace_Start takes nothing returns nothing
  local timer t = null
  local integer info
  local unit u = GetTriggerUnit()
  local unit u2 = GetSpellTargetUnit()
  local unit dummy=CreateUnit(GetOwningPlayer(u2),'e00E',GetUnitX(u2),GetUnitY(u2),0)
  call UnitAddAbility(dummy,'A2LG')
  if IssueTargetOrder(dummy,"thunderbolt",u2)==true then 
    set t = Timer_Get()
    set info = GetHandleId(t)
    
    call SaveUnitHandle(MHT,info,0,u2)
    call SaveReal(MHT,info,0,GetUnitAbilityLevel(udg_Hero[GetPlayerId(GetOwningPlayer(u))],'A2LB')*0.001 + 0.002)
    call SaveInteger(MHT,info,0,0)
    
    call SaveEffectHandle(MHT,info,1,AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx",u2,"hand right"))
    call SaveEffectHandle(MHT,info,2,AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx",u2,"hand left"))
    call SaveEffectHandle(MHT,info,3,AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx",u2,"foot right"))
    call SaveEffectHandle(MHT,info,4,AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx",u2,"foot left"))
    call SaveEffectHandle(MHT,info,5,AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx",u2,"foot right mount rear"))
    call SaveEffectHandle(MHT,info,6,AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx",u2,"foot left mount rear"))
    call SaveEffectHandle(MHT,info,7,AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx",u2,"head"))
    call SaveEffectHandle(MHT,info,8,AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx",u2,"chest"))
    call SaveEffectHandle(MHT,info,9,AddSpecialEffectTarget("war3mapImported\\Cryofreeze5.mdx",u2,GetProperAttachPoint_Weapon(u2)))
    
    call UnitAddAbility(u2,'A516')
    call SaveInteger(MHT,GetHandleId(u2),'A516',LoadInteger(MHT,GetHandleId(u2),'A516') + 1) //for multicast stacking
    
    call TimerStart(t,0.1,true,function Wyvern_Embrace_Duration)
    
    set t = null
  endif
  set dummy=null
  set u2 = null
  set u = null
  set t = null
endfunction


function Wyvern_Curse_Reorder takes unit u returns nothing
  if GetUnitAbilityLevel(u,LoDBuff_BuffID[31])>0 and UnitIsSleeping(u)==false and GetUnitAbilityLevel(u,'B008')==0 and HW8==false then
    call DisableTrigger(GAME_TRIGGER)
    call IssueTargetOrder(u,"attack",LoadUnitHandle(MHT,GetHandleId(u),'A0Z0'))
    call EnableTrigger(GAME_TRIGGER)
  endif
endfunction

function Wyvern_Curse_Targets takes nothing returns boolean
  local unit t = GetFilterUnit()
  local integer info
  
  if IsUnitAlly(t,group_temp_player) and GetUnitAbilityLevel(t,'A04R')==0 and IsDead(t)==false and IsUnitType(t,UNIT_TYPE_STRUCTURE)==false and t!=group_temp_unit[0] then
    if GetUnitAbilityLevel(t,LoDBuff_BuffID[31])==0 then
      set info = GetHandleId(t)
      call GroupAddUnit(group_temp_group,t)
      call Buff_Add(t,LoDBuff_AbilID[31],LoDBuff_BuffID[31],group_temp_real[0])
      call SaveUnitHandle(MHT,info,'A0Z0',group_temp_unit[0])
      
      if LoadBoolean(MHT,info,2)==false then
        call SaveBoolean(MHT,info,2,true)
        call TriggerRegisterUnitEvent(GAME_TRIGGER,t,EVENT_UNIT_ISSUED_ORDER)
        call TriggerRegisterUnitEvent(GAME_TRIGGER,t,EVENT_UNIT_ISSUED_POINT_ORDER)
        call TriggerRegisterUnitEvent(GAME_TRIGGER,t,EVENT_UNIT_ISSUED_TARGET_ORDER)
      endif
    endif
    
    if UnitIsSleeping(t)==false and GetUnitAbilityLevel(t,'B008')==0 then
      call DisableTrigger(GAME_TRIGGER)
      call IssueTargetOrder(t,"attack",group_temp_unit[0])
      call EnableTrigger(GAME_TRIGGER)
    endif
  endif
  
  set t = null
  return false
endfunction

function Wyvern_curse_Duration takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,0)
  local group g = LoadGroupHandle(MHT,info,2)
  local real x
  local real y
  
  if count==0 or IsDead(u) or IsUnitHidden(u)then
    set u = FirstOfGroup(g)
    
    loop
      exitwhen u==null
      call RemoveSavedHandle(MHT,GetHandleId(u),'A0Z0')
      call Buff_Remove(u,LoDBuff_BuffID[31])
      call IssueImmediateOrder(u,"stop")
      call GroupRemoveUnit(g,u)
      set u = FirstOfGroup(g)
    endloop
    
    call DestroyEffect(LoadEffectHandle(MHT,info,4))
    call DestroyEffect(LoadEffectHandle(MHT,info,3))
    call RemoveUnit(LoadUnitHandle(MHT,info,5))
    call KillGroup(g)
    
    call Timer_End(t)
    set g = null// da last gut D:
    set u = null
    set t = null
    return
  endif
  
  call SaveInteger(MHT,info,0,count - 1)
  
  set group_temp_unit[0] = u
  set group_temp_group = g
  set group_temp_player = LoadPlayerHandle(MHT,info,1)
  set group_temp_real[0] = LoadReal(MHT,info,0) - count*0.05
  set x = GetWidgetX(u)
  set y = GetWidgetY(u)
  
  call GroupEnumUnitsInRange(temp_group,x,y,375,Condition(function Wyvern_Curse_Targets))
  call SetUnitPosition(LoadUnitHandle(MHT,info,5),x,y)
  
  set g = null // o wait, ders one more! \:D/
  set u = null
  set t = null
endfunction

function Wyvern_Curse_Start takes nothing returns nothing
  local timer t = Timer_Get()
  local unit caster = GetTriggerUnit()
  local unit target = GetSpellTargetUnit()
  local integer h = GetHandleId(t)
  local integer level = GetUnitAbilityLevel(caster,'A0Z0')
  local real x = GetUnitX(target)
  local real y = GetUnitY(target)
  call StunTarget(caster,target,level*0.25+2.25)
  call TimerStart(t,0.05,true,function Wyvern_curse_Duration)
  
  set group_temp_unit[0] = target
  set group_temp_real[0] = level*.25 + 2.25
  set group_temp_group = GetAvailableGroup()
  set group_temp_player = GetOwningPlayer(group_temp_unit[0])
  
  call GroupEnumUnitsInRange(temp_group,x,y,375,Condition(function Wyvern_Curse_Targets))
  call SaveUnitHandle(MHT,h,0,group_temp_unit[0])
  call SavePlayerHandle(MHT,h,1,group_temp_player)
  call SaveGroupHandle(MHT,h,2,group_temp_group)
  //call SaveEffectHandle(MHT,h,3,AddSpecialEffectTarget("war3mapImported\\WintersCurseAoE.mdx",d,"origin"))
  call SaveEffectHandle(MHT,h,3,AddSpecialEffect("war3mapImported\\WintersCurseAoE.mdx",GetWidgetX(group_temp_unit[0]),GetWidgetY(group_temp_unit[0])))
  call SaveEffectHandle(MHT,h,4,AddSpecialEffectTarget("war3mapImported\\WintersCurse.mdx",group_temp_unit[0],"overhead"))
  call SaveUnitHandle(MHT,h,5,target)
  call SaveReal(MHT,h,0,group_temp_real[0])
  call SaveInteger(MHT,h,0,45 + 5*level)
  
  set t = null
  set caster = null
  set target = null
endfunction

function Wyvern_Curse_ForceAttack takes nothing returns nothing
  local unit u=GetEnumUnit()
  call DisableTrigger(trig_WintersCurse)
  call UnitWakeUp(u)
  call IssueTargetOrder(u,"attack",unit_WinterCurseTarget)
  call EnableTrigger(trig_WintersCurse)
  set u=null
endfunction

function Wyvern_Curse_AddKeys takes nothing returns nothing
  call AddTimedKeyToUnit(GetEnumUnit(),4328,0.75)
endfunction

function Wyvern_Curse_ForGroup takes nothing returns nothing
  local unit u=GetEnumUnit()
  if IsUnitInGroup(u,group_WinterCurse)==false then
    call GroupAddUnit(group_WinterCurse,u)
    call TriggerRegisterUnitEvent(trig_WintersCurse,u,EVENT_UNIT_ISSUED_TARGET_ORDER)
    call TriggerRegisterUnitEvent(trig_WintersCurse,u,EVENT_UNIT_ISSUED_POINT_ORDER)
    call TriggerRegisterUnitEvent(trig_WintersCurse,u,EVENT_UNIT_ISSUED_TARGET_ORDER)
    call SaveInteger(hashtable019,GetHandleId(u),4328,1)
  endif
  set u=null
endfunction

function Wyvern_Curse_Duration takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=(LoadUnitHandle(hashtable019,h,2))
  local unit target=(LoadUnitHandle(hashtable019,h,17))
  local integer lvl=(LoadInteger(hashtable019,h,5))
  local integer counter=(LoadInteger(hashtable019,h,34))
  local group g=(LoadGroupHandle(hashtable019,h,22))
  local group gg
  if GetTriggerEventId()!=EVENT_UNIT_ISSUED_TARGET_ORDER and GetTriggerEventId()!=EVENT_UNIT_ISSUED_POINT_ORDER and GetTriggerEventId()!=EVENT_UNIT_ISSUED_TARGET_ORDER then
    set counter=counter+1
    call SaveInteger(hashtable019,(h),(34),(counter))
    set group_WinterCurse=g
    set trig_WintersCurse=t
    set gg=GetAvailableGroup()
    set tt_unit1=caster
    call GroupEnumUnitsInRange(gg,GetUnitX(target),GetUnitY(target),375,Condition(function NonImmuneEnemyFilter))
    call GroupRemoveUnit(gg,target)
    call ForGroup(gg,function Wyvern_Curse_ForGroup)
    call KillGroup(gg)
    if counter==(2.25+0.25*lvl)*20 or IsDead(target)then
      call ForGroup(g,function Wyvern_Curse_AddKeys)
      call UnitRemoveAbility(target,'A342')
      call KillGroup(g)
      call DestroyEffect((LoadEffectHandle(hashtable019,(h),(32))))
      call DestroyEffect((LoadEffectHandle(hashtable019,(h),(176))))
      call FlushChildHashtable(hashtable019,(h))
      call CleanTrigger(t)
    else
      set trig_WintersCurse=t
      set unit_WinterCurseTarget=target
      call ForGroup(g,function Wyvern_Curse_ForceAttack)
      if ModuloInteger(counter,20)==0 or counter==0 then
      endif
    endif
  else
    if UnitIsSleeping(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),'B008')==0 and GetIssuedOrderId()!=851973 then
      call DisableTrigger(t)
      call ClearSelectionForPlayer(GetOwningPlayer(GetTriggerUnit()))
      call IssueTargetOrder(GetTriggerUnit(),"attack",target)
      call EnableTrigger(t)
    endif
  endif
  set t=null
  set caster=null
  set target=null
  set g=null
  set gg=null
  return false
endfunction

function Wyvern_Curse_Acts takes nothing returns nothing
  local unit caster=GetTriggerUnit()
  local trigger t=CreateTrigger()
  local integer h=GetHandleId(t)
  local integer lvl=GetUnitAbilityLevel(caster,'A0Z0')
  local unit target=GetSpellTargetUnit()
  local unit dummy=CreateUnit(GetOwningPlayer(caster),'e00E',GetUnitX(target),GetUnitY(target),0)
  set unit_WinterCurseCaster=caster
  call UnitAddAbility2(target,'A342')
  call UnitAddAbility(dummy,'A2NJ')
  call SetUnitAbilityLevel(dummy,'A2NJ',lvl)
  call IssueTargetOrder(dummy,"thunderbolt",target)
  call TriggerRegisterTimerEvent(t,0.05,true)
  call SaveUnitHandle(hashtable019,(h),(2),(caster))
  call SaveUnitHandle(hashtable019,(h),(17),(target))
  call SaveInteger(hashtable019,(h),(5),(lvl))
  call SaveGroupHandle(hashtable019,(h),(22),(GetAvailableGroup()))
  call SaveEffectHandle(hashtable019,(h),(32),(AddSpecialEffectTarget("war3mapImported\\WintersCurse.mdx",target,"overhead")))
  call SaveEffectHandle(hashtable019,(h),(176),(AddSpecialEffect("war3mapImported\\WintersCurseAoE.mdx",GetUnitX(target),GetUnitY(target))))
  call TriggerAddCondition(t,Condition(function Wyvern_Curse_Duration))
  set caster=null
  set target=null
  set dummy=null
  set t=null
endfunction

function Wyvern_Curse_Real_Start takes nothing returns nothing
  if IsBlocked(GetSpellTargetUnit())==false then
    call Wyvern_Curse_Acts()
  endif
endfunction

function Ursa_Swipes_Learn takes nothing returns nothing
  local unit u = GetTriggerUnit()
  
  call SetUnitAbilityLevel(u,'ANic',GetUnitAbilityLevel(u,'P611') + 4)
  
  set u = null
endfunction

function Ursa_Swipes_Learn_First takes nothing returns nothing
  local unit u = GetTriggerUnit()
  
  call UnitAddAbility2(u,'Q067')
  call UnitMakeAbilityPermanent(u,true,'ANic')
  
  call SetUnitAbilityLevel(u,'ANic',5)
  
  set u = null
endfunction

function Shadow_Amulet_Effect takes nothing returns nothing
  local unit d = null
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local integer count = LoadInteger(MHT,info,0)
  local unit u = LoadUnitHandle(MHT,info,0)
  
  if IsDead(u) or (GetUnitAbilityLevel(u,'B0G8')==0 and count > LoadInteger(MHT,info,2)) or GetWidgetX(u)!=LoadReal(MHT,info,0) or GetWidgetY(u)!=LoadReal(MHT,info,1)then
    call SaveBoolean(MHT,GetHandleId(u),'A2N5',false)
    call UnitRemoveAbility(u,'B0G8')
    call Timer_End(t)
    set t = null
    set u = null
    return
  endif
  
  if count==LoadInteger(MHT,info,2) then
    set d = CreateUnit(Player(15),'e00E',0,0,0)
    call UnitAddAbility(d,'A2N5')
    call IssueTargetOrder(d,"invisibility",u)
    call SaveBoolean(MHT,GetHandleId(u),'A2N5',false)
    set d = null
  endif
  
  call SaveInteger(MHT,info,0,count + 1)
  
  set t = null
  set u = null
endfunction

function Shadow_Amulet_Setup takes nothing returns nothing
  local timer t = GetExpiredTimer()
  local integer info = GetHandleId(t)
  local unit u = LoadUnitHandle(MHT,info,0)
  
  call SaveReal(MHT,info,0,GetWidgetX(u))
  call SaveReal(MHT,info,1,GetWidgetY(u))
  call SaveInteger(MHT,info,0,0)
  call SaveInteger(MHT,info,2,R2I(1.5/0.05))
  call IssueImmediateOrder(u,"holdposition")
  
  call TimerStart(t,0.05,true,function Shadow_Amulet_Effect)
  
  set t = null
  set u = null
endfunction

function Shadow_Amulet_Start takes unit u returns nothing
  local timer t = Timer_Get()
  local string s = ""
  
  if GetOwningPlayer(u)==GetLocalPlayer()then
    set s = "Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl"
  endif
  
  call DestroyEffect(AddSpecialEffectTarget(s,u,"chest"))
  call DestroyEffect(AddSpecialEffectTarget(s,u,"hand,left"))
  call DestroyEffect(AddSpecialEffectTarget(s,u,"hand,right"))
  
  call SaveUnitHandle(MHT,GetHandleId(t),0,u)
  call TimerStart(t,0.01,false,function Shadow_Amulet_Setup)
  
  set t = null
endfunction

function Shadow_Amulet_Condition takes nothing returns nothing
  local unit u = GetTriggerUnit()
  local integer info = GetHandleId(u)
  
  if LoadBoolean(MHT,info,'A2N5')==false then
    call SaveBoolean(MHT,info,'A2N5',true)
    call Shadow_Amulet_Start(u)
  endif
  
  set u = null
endfunction


function Silencer_LastWordPassive_Act takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit caster=LoadUnitHandle(hashtable019,h,0)
  local unit silencer=LoadUnitHandle(hashtable019,h,1)
  local unit d
  if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST then
    set d=CreateUnit(GetOwningPlayer(caster),'e00E',GetUnitX(caster),GetUnitY(caster),0)
    call UnitAddAbility(d,'A33T')
    call SetUnitAbilityLevel(d,'A33T',GetUnitAbilityLevel(silencer,'A33O'))
    call IssueTargetOrder(d,"drunkenhaze",caster)
    set d=null
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
    //	call echo("casted")
  else
    //call echo("Destroyed")
    call FlushChildHashtable(hashtable019,h)
    call CleanTrigger(t)
  endif
  set t=null
  set caster=null
  set silencer=null
endfunction

function Silencer_LastWordPassive_FindSilencer takes nothing returns boolean
  return IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsDead(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit())) and GetUnitAbilityLevel(GetFilterUnit(),'A33O')>0
endfunction

function Silencer_LastWordPassive_Check takes unit caster, integer aid returns nothing
  local trigger t
  local integer h
  local group g
  local unit silencer
  if BalanceOffSpellChecker(aid)==false then
    //call echo("bad spell")
    return
  endif
  set t=CreateTrigger()
  set h=GetHandleId(t)
  set g=GetAvailableGroup()
  call GroupEnumUnitsInRange(g,GetUnitX(caster),GetUnitY(caster),800,Condition(function Silencer_LastWordPassive_FindSilencer))
  set silencer=FirstOfGroup(g)
  call KillGroup(g)
  set g=null
  call TriggerRegisterTimerEvent(t,10,false)
  call TriggerRegisterUnitEvent(t,caster,EVENT_UNIT_SPELL_ENDCAST)
  call TriggerAddCondition(t,Condition(function Silencer_LastWordPassive_Act))
  call SaveUnitHandle(hashtable019,h,0,caster)
  call SaveUnitHandle(hashtable019,h,1,silencer)
  
  set t=null
endfunction


//Generic event functions that are called everytime the event occurs
//===========================================================================================
function LoDSpell_Generic takes unit u, integer spell returns nothing
  if LoadBoolean(MHT,spell,spell)then
    //call Transform_Movement(u,spell,GetUnitTypeId(u))
  endif
  if GetUnitAbilityLevel(u,'B0H0')>0 then
    call Silencer_LastWordPassive_Check(u,spell)
  endif
  if Reduced_Spell(spell)then
    call Reduced_Spell_Proc(u,spell)
  endif
  
  call Silencer_Last_Word_Cast(u)
  call Zeus_Static_Field_Condition(u,spell)
  call Bristleback_Warpath_Condition(u,spell)
  call Earthshaker_Aftershock_Condition(u,spell)
  call Phoenix_Sunray_Stop(u,spell)
endfunction

function LoDOrder_Generic takes unit u, integer order, eventid id returns nothing
  if id==EVENT_UNIT_ISSUED_ORDER then
    
  endif
  
  call Phoenix_Sunray_Orders(u,order)
  call Wyvern_Curse_Reorder(u)
endfunction

function LoDAttack_Generic takes unit u, unit t returns nothing
  //if GetUnitAbilityLevel(u,'A0WR')>0 and IsUnitType(u,UNIT_TYPE_RANGED_ATTACKER) then//brood's hunger
  //	call Brood_Hunger_CustomLifesteal(u,t)
  //endif
  if GetUnitAbilityLevel(t,'BUfa')>0 and IsUnitType(u,UNIT_TYPE_RANGED_ATTACKER) then
    call Lich_FrostArmor_RangedAttack(u,t)
  endif
  //call Jakiro_Autofire_Condition(u,t)
  call Psi_Blades_Condition(u,t)
  call Void_Bash_Detect(u,t)
  call Wyvern_Burn_Attack_Condition(u,t)
  call Kunka_Tidebringer_Condition(u,t)
  call Tree_Invis_Cancel(u)
  call Abbadon_Frostmourne_Attack(u,t)
  call Rikki_BackStab_Condition(u,t)
  call Tree_Invi_Condition_Self(u,t)
endfunction

function LoDDeath_Generic takes unit u, unit t returns nothing
  call Alchemist_Greed_Condition(u,t)
endfunction

//function LoDSummon_Generic takes unit u, unit t returns nothing

//endfunction


function LoDDamage_Generic takes unit u, unit t, real d returns nothing
  local integer lvl
  call Void_Bash_Condition(u,t)
  
  if d>0 then
    if IsFakeDamage==false and d>40 or IsUnitType(t,UNIT_TYPE_STRUCTURE)==true then
      call Kunka_Tidebringer_Effect(u,t,d)
    endif
    
    if GetUnitAbilityLevel(t,'B066')==1 then
      set lvl=IMaxIF(GetUnitAbilityLevel(u,'A0MG'),GetUnitAbilityLevel(u,'QP18'))
      call UnitRemoveAbility(t,'B066')
      call Buff_Add(t,'C103' + lvl,'D107',2.5)
      call AddTimedAbility(t,'QH00',1,2.5)
      //call Buff_Add(t,'QH00','D107',2.5)
      //call SaveInteger(HY,GetHandleId(t),166882,GetUnitAbilityLevel(u,'A0MG'))
    endif
    
    call Abbadon_Time_Condition(t,d)
  endif
endfunction

function EnchantedTotemEffectFromDummy takes nothing returns boolean
  local trigger t=GetTriggeringTrigger()
  local unit caster=LoadUnitHandle(hashtable019,GetHandleId(t),0)
  local unit u=CreateUnit(GetOwningPlayer(caster),'e00E',GetUnitX(caster),GetUnitY(caster),0)
  local integer id='QFZX'
  call UnitRemoveAbility(caster,'Broa')
  if Mode_EB and ((GetUnitAbilityLevel(caster,'A0CG')>0 and IsUnitType(caster,UNIT_TYPE_MELEE_ATTACKER)) or GetUnitAbilityLevel(caster,'A1IQ')>0 or GetUnitAbilityLevel(caster,'A13T')>0 or GetUnitAbilityLevel(caster,'A1YQ')>0 or GetUnitAbilityLevel(caster,'A2H0')>0 or GetUnitAbilityLevel(caster,'QB0L')>0) then
    set id='QFZY'
  endif
  call UnitAddAbility(u,id)
  call SetUnitAbilityLevel(u,id,GetUnitAbilityLevel(caster,'A0DL'))
  call IssueImmediateOrder(u,"roar")
  call FlushChildHashtable(hashtable019,GetHandleId(t))
  call DestroyTrigger(t)
  set t=null
  set u=null
  set caster=null
  return false
endfunction

function EnchantedTotemCasting takes nothing returns nothing
  local unit caster
  local trigger t
  set caster=GetTriggerUnit()
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,0.01,false)
  call TriggerAddCondition(t,Condition(function EnchantedTotemEffectFromDummy))
  call SaveUnitHandle(hashtable019,GetHandleId(t),0,caster)
  set t=null
  set caster=null
  call EnchantTotemOnCast()
endfunction

function OrbWalkingCheck takes unit u returns nothing
  if isPoisonArrowSkill(GetSpellAbilityId()) and (GetUnitAbilityLevel(u,'Aetl')>0 or GetUnitAbilityLevel(u,'B017')>0) then
    call InterruptUnit(u)
  endif
endfunction

//Specific functions are executed here
//===========================================================================================
function LoD_Event_Condition takes nothing returns boolean
  local unit u = null
  local integer i = GetSpellAbilityId()
  local integer l
  local eventid id = GetTriggerEventId()
  
  
  
  if i!=0 then
    
    //call BJDebugMsg("spell: "+Id2String(i))
    
    if id == EVENT_UNIT_SPELL_EFFECT then
      
      //call BJDebugMsg(Id2String(GetSpellAbilityId()))
      call LoDSpell_Generic(GetTriggerUnit(),i)
      //call BJDebugMsg("spell: "+Id2String(i)+" func:"+LoadStr(MHT,i,0))
      if LoadStr(MHT,i,0)!=null and LoadStr(MHT,i,0)!="" then
        call ExeFunc(LoadStr(MHT,i,0))
      endif
      
    elseif id==EVENT_UNIT_SPELL_ENDCAST then
      if LoadStr(MHT,i,1)!=null and LoadStr(MHT,i,1)!="" then
        call ExeFunc(LoadStr(MHT,i,1))
      endif
    elseif id==EVENT_UNIT_SPELL_FINISH then
      if LoadStr(MHT,i,2)!=null and LoadStr(MHT,i,2)!="" then
        call ExeFunc(LoadStr(MHT,i,2))
      endif
    elseif id==EVENT_UNIT_SPELL_CAST then
      call OrbWalkingCheck(GetTriggerUnit())
      if LoadStr(MHT,i,3)!=null and LoadStr(MHT,i,3)!="" then
        call ExeFunc(LoadStr(MHT,i,3))
      endif
    endif
    
  endif
  
  if id == EVENT_UNIT_HERO_SKILL then
    set u = GetTriggerUnit()
    set i = GetLearnedSkill()
    set l = GetLearnedSkillLevel()
    
    
    //call BJDebugMsg("Learned: "+Id2String(i)+"	"+I2S(i))
    
    call Passive_Cooldown_Learn(u,i,l)
    
    if LoadStr(MHT,i,5)!=null and LoadStr(MHT,i,5)!="" then
      call ExeFunc(LoadStr(MHT,i,5))
    endif
    
    if l==1then
      if LoadStr(MHT,i,4)!=null and LoadStr(MHT,i,4)!="" then
        call ExeFunc(LoadStr(MHT,i,4))
      endif
    endif
    
    set u = null
    
  endif
  
  if id == EVENT_PLAYER_UNIT_ATTACKED then
    call LoDAttack_Generic(GetAttacker(),GetTriggerUnit())
    
  endif
  
  if id == EVENT_UNIT_ISSUED_ORDER or id == EVENT_UNIT_ISSUED_POINT_ORDER or id == EVENT_UNIT_ISSUED_TARGET_ORDER then
    //Save (udgtable,handle,2,true) when a units orders are added as an event
    
    call LoDOrder_Generic(GetTriggerUnit(),GetIssuedOrderId(),id)
    
  endif
  
  if id == EVENT_PLAYER_UNIT_DEATH then
    call LoDDeath_Generic(GetKillingUnit(),GetTriggerUnit())
    
  endif
  
  if id == EVENT_UNIT_SUMMON then
    set u = GetSummoningUnit()
    //call LoDSummon_Generic(u,GetTriggerUnit())
    if LoadStr(MHT,LoadInteger(MHT,GetHandleId(u),'SPEL'),9)!=null and LoadStr(MHT,LoadInteger(MHT,GetHandleId(u),'SPEL'),9)!="" then
      call ExeFunc(LoadStr(MHT,LoadInteger(MHT,GetHandleId(u),'SPEL'),9))
    endif
    set u = null
  endif
  
  if id == EVENT_UNIT_DAMAGED then
    //Save (udgtable,handle,1,true) when a unit being damage is added as an event
    
    call LoDDamage_Generic(GetEventDamageSource(),GetTriggerUnit(),GetEventDamage())
    
  endif
  set u=null
  return false
endfunction

function LoD_Chat_Event takes nothing returns boolean
  // only used for EVENT_PLAYER_CHAT, all other events should be register
  // with GAME_TRIGGER
  if LoadStr(MHT,StringHash(GetEventPlayerChatString()),10)!=null and LoadStr(MHT,StringHash(GetEventPlayerChatString()),10)!="" then
    call ExeFunc(LoadStr(MHT,StringHash(GetEventPlayerChatString()),10))
  endif
  return false
endfunction

function LoDEvent_Init takes nothing returns nothing
  //EVENT_UNIT_SPELL_EFFECT
  call SaveStr(MHT,'A326',0,"SoulFeedActions")
  call SaveStr(MHT,'A327',0,"ParadoxalSprintInit")
  call SaveStr(MHT,'A2NT',0,"Silencer_LastWord")
  call SaveStr(MHT,'A0MT',0,"Netherblast_Start")
  call SaveStr(MHT,'A1P8',0,"Spiritbreaker_Charge_Start")
  call SaveStr(MHT,'A01I',0,"Pitlord_Firestorm_Start")
  call SaveStr(MHT,'A1YY',0,"Phoenix_Sunray_Start")
  call SaveStr(MHT,'A0O6',0,"Jakiro_Icepath_Start")
  call SaveStr(MHT,'A0IL',0,"Alchemist_Acidspray_Start")
  call SaveStr(MHT,'A1A8',0,"Tauren_Spirit_Start")
  call SaveStr(MHT,'A21J',0,"Tauren_Spirit_Stop")
  call SaveStr(MHT,'A2KZ',0,"Terrorblade_Reflection_Start")
  call SaveStr(MHT,'A04V',0,"Bane_Enfeeble_Condition")
  call SaveStr(MHT,'A0LV',0,"Chen_Test_Condition")
  call SaveStr(MHT,'A2MC',0,"Chen_Teleport_Condition")
  call SaveStr(MHT,'A0NS',0,"Abbadon_Time_Start")
  call SaveStr(MHT,'A1DA',0,"Abbadon_Time_Start")
  call SaveStr(MHT,'A1DP',0,"Razor_Link_Start")
  call SaveStr(MHT,'A2IS',0,"Sven_Warcry_Start")
  call SaveStr(MHT,'A0RP',0,"Templar_Trap_Place")
  call SaveStr(MHT,'A0RT',0,"Templar_Trap_Start")
  call SaveStr(MHT,'A0RQ',0,"Templar_Trap_Start")
  call SaveStr(MHT,'A2ML',0,"Tree_Armour_Start")
  call SaveStr(MHT,'A2M1',0,"Gnoll_Flux_Start")
  call SaveStr(MHT,'A2LM',0,"Gnoll_Field_Start")
  call SaveStr(MHT,'A2LL',0,"Gnoll_Spark_Start")
  call SaveStr(MHT,'A332',0,"Wyvern_Burn_Start")
  call SaveStr(MHT,'DRKN',0,"Nightstalker_Darkness_Start")
  call SaveStr(MHT,'DRKU',0,"Nightstalker_Darkness_Start")
  //call SaveStr(MHT,'A2LA',0,"Wyvern_Blast_Start")
  call SaveStr(MHT,'A2LA',0,"Wyvern_SplinterBlast_Start")
  call SaveStr(MHT,'A2M0',0,"Zet_Tempest_Start")
  call SaveStr(MHT,'A136',0,"Admiral_Torrent")
  call SaveStr(MHT,'TEST',0,"testchain")
  call SaveStr(MHT,'A11K',0,"Admiral_GhostShip")
  call SaveStr(MHT,'A1NI',0,"Alchemist_UnstableConcoction")
  call SaveStr(MHT,'A0E3',0,"AM_ManaVoid")
  call SaveStr(MHT,'AEbl',0,"AM_Blink")
  call SaveStr(MHT,'QB08',0,"AM_Blink")
  call SaveStr(MHT,'A0O1',0,"Beastmaster_WildAxes")
  call SaveStr(MHT,'A0O2',0,"Beastmaster_PrimalRoar")
  call SaveStr(MHT,'A289',0,"Beastmaster_PrimalRoar")
  call SaveStr(MHT,'A13Z',0,"Beastmaster_HawkInvis")
  call SaveStr(MHT,'A0B4',0,"Bounty_Track")
  call SaveStr(MHT,'QB0D',0,"Bounty_Track")
  call SaveStr(MHT,'A07A',0,"Bounty_Windwalk")
  call SaveStr(MHT,'QB09',0,"Bounty_Windwalk")
  //call SaveStr(MHT,'A0GP',0,"OOE")
  call SaveStr(MHT,'A0FW',0,"BB_Goo")
  call SaveStr(MHT,'A2O6',0,"Stampede_Cast")
  call SaveStr(MHT,'A00L',0,"Double_Edge_Start")
  call SaveStr(MHT,'A0KM',0,"Chen_Penitence")
  //call SaveStr(MHT,'A069',0,"PUE")
  call SaveStr(MHT,'A28T',0,"Chen_HolyPersuation")
  call SaveStr(MHT,'A0LT',0,"Chen_HandOfGod")
  call SaveStr(MHT,'A04C',0,"CM_Frostbite_Disarm")
  call SaveStr(MHT,'A034',0,"Slardar_AmplifyDamage")
  call SaveStr(MHT,'QB0C',0,"Slardar_AmplifyDamage")
  call SaveStr(MHT,'A0DL',0,"EnchantedTotemCasting")
  
  call SaveStr(MHT,'A1CS',0,"Chen_HandOfGod")
  call SaveStr(MHT,'A0Z6',0,"Clockwerk_RocketFlare")
  call SaveStr(MHT,'A0Z5',0,"Clockwerk_PowerCogs_Start")
  call SaveStr(MHT,'A0Z8',0,"Clockwerk_Hookshot")
  call SaveStr(MHT,'A1CV',0,"Clockwerk_Hookshot")
  call SaveStr(MHT,'A0Z4',0,"Clockwerk_BatteryAssault")
  call SaveStr(MHT,'A03R',0,"CM_FreezingField")
  call SaveStr(MHT,'A0AV',0,"CM_FreezingField")
  call SaveStr(MHT,'A1E9',0,"CM_Nova")
  call SaveStr(MHT,'A14P',0,"Storm_StaticRemnant")
  call SaveStr(MHT,'A14R',0,"Storm_ElectricVortex")
  call SaveStr(MHT,'A14O',0,"Storm_BallLightning")
  call SaveStr(MHT,'A0AR',0,"DK_DragonTail")
  call SaveStr(MHT,'QB0G',0,"DK_DragonTail")
  call SaveStr(MHT,'A03G',0,"DK_DragonForm_Act")
  call SaveStr(MHT,'QM00',0,"DK_DragonForm_Act")
  call SaveStr(MHT,'A2QI',0,"Kaolin_GeomagneticGrip_Effect")
  call SaveStr(MHT,'A2TH',0,"Kaolin_Stones_SummonStart")
  call SaveStr(MHT,'A2QM',0,"Kaolin_BoulderSmash_InitSup")
  call SaveStr(MHT,'A2QT',0,"Oracle_FortunesEnd_Sup")
  call SaveStr(MHT,'A2T5',0,"Oracle_FatesEdict_Sup")
  call SaveStr(MHT,'QB0O',0,"Oracle_PurifingFlames_InitSup")
  call SaveStr(MHT,'A2SG',0,"Oracle_PurifingFlames_InitSup")
  call SaveStr(MHT,'A2TF',0,"Oracle_FalsePromise_Start")
  call SaveStr(MHT,'QB11',0,"Oracle_FalsePromise_Start")
  call SaveStr(MHT,'A0SK',0,"ES_Fissure")
  call SaveStr(MHT,'A0DH',0,"ES_EchoSlam_Act")
  call SaveStr(MHT,'A1OB',0,"ES_EchoSlam_Act")
  call SaveStr(MHT,'A01B',0,"Enchantress_NaturesAttendants")
  call SaveStr(MHT,'A0DX',0,"Enchantress_Enchant")
  call SaveStr(MHT,'A0B1',0,"Enigma_MidnightPulse")
  call SaveStr(MHT,'A0I7',0,"Enigma_Malefice_InitSup")
  call SaveStr(MHT,'A180',0,"Enigma_DemonicConversion")
  call SaveStr(MHT,'A1BX',0,"Enigma_BlackHole")
  call SaveStr(MHT,'A30L',0,"Enigma_BlackHole")
  call SaveStr(MHT,'A09W',0,"Lion_FingerOfDeath_Splash")
  
  call SaveStr(MHT,'A0SC',0,"Puck_WaningRift")
  call SaveStr(MHT,'A1QP',0,"Puck_DreamCoil")
  call SaveStr(MHT,'A0S8',0,"Puck_DreamCoil")
  call SaveStr(MHT,'A0S9',0,"Puck_IllusoryOrb")
  call SaveStr(MHT,'A0SA',0,"Puck_EtherealJaunt")
  call SaveStr(MHT,'A21E',0,"Prophet_Sprout")
  call SaveStr(MHT,'A1W8',0,"Prophet_WrathOfNature")
  call SaveStr(MHT,'A1W9',0,"Prophet_WrathOfNature")
  call SaveStr(MHT,'A0QR',0,"Huskar_LifeBreak")
  call SaveStr(MHT,'A1B3',0,"Huskar_LifeBreak")
  call SaveStr(MHT,'A0QP',0,"Huskar_InnerVitality")
  call SaveStr(MHT,'A0O5',0,"THD_Macropyre")
  call SaveStr(MHT,'A1B1',0,"THD_Macropyre")
  call SaveStr(MHT,'ANLS',0,"LinkenSphere_Share")
  call SaveStr(MHT,'A0O7',0,"THD_DualBreath")
  call SaveStr(MHT,'A0M1',0,"Juggernaut_Omnislash")
  call SaveStr(MHT,'A1AX',0,"Juggernaut_Omnislash")
  call SaveStr(MHT,'A05G',0,"Juggernaut_Bladefury")
  call SaveStr(MHT,'A10U',0,"Kotl_Recall")
  call SaveStr(MHT,'A11Y',0,"Kotl_Recall")
  call SaveStr(MHT,'A11Z',0,"Kotl_Recall")
  call SaveStr(MHT,'A10X',0,"Kotl_ManaLeak")
  call SaveStr(MHT,'A112',0,"Kotl_ChakraMagic")
  call SaveStr(MHT,'A11X',0,"Kotl_BlindingLight")
  call SaveStr(MHT,'A11V',0,"Kotl_BlindingLight")
  call SaveStr(MHT,'A11W',0,"Kotl_BlindingLight")
  call SaveStr(MHT,'Z042',0,"LoDLightStrikeArray_Cast")
  call SaveStr(MHT,'QB0E',0,"LoDLightStrikeArray_Cast")
  call SaveStr(MHT,'A054',0,"Luna_Eclipse")
  call SaveStr(MHT,'A00U',0,"Luna_Eclipse")
  call SaveStr(MHT,'A0KV',0,"Potm_Starfall")
  call SaveStr(MHT,'A0KU',0,"Potm_MoonlightShadows")
  call SaveStr(MHT,'A0LN',0,"Potm_Leap")
  call SaveStr(MHT,'A0L8',0,"PotM_EluneArrow_Start")
  call SaveStr(MHT,'A33U',0,"StormOld_LightningGrapple")
  
  call SaveStr(MHT,'A0FN',0,"Morphling_Waveform")
  call SaveStr(MHT,'QB02',0,"Morphling_Waveform")
  call SaveStr(MHT,'A0G8',0,"Morphling_Replicate")
  call SaveStr(MHT,'A0GC',0,"Morphling_ReplicateReplace")
  call SaveStr(MHT,'A0G6',0,"Morphling_AdaptiveStrike")
  call SaveStr(MHT,'A07U',0,"Naga_SongOfSiren")
  call SaveStr(MHT,'A2KU',0,"Naga_RipTide")
  call SaveStr(MHT,'A24D',0,"Naga_Ensnare")
  call SaveStr(MHT,'A08N',0,"Omni_Purification")
  call SaveStr(MHT,'A10D',0,"PL_SpiritLance")
  call SaveStr(MHT,'QB0B',0,"PL_Doppelwalk")
  call SaveStr(MHT,'A0D7',0,"PL_Doppelwalk")
  call SaveStr(MHT,'A26N',0,"Treant_LeechSeed")
  call SaveStr(MHT,'A14L',0,"Silencer_CurseOfSilence")
  call SaveStr(MHT,'A0L3',0,"Silencer_GlobalSilence_Start")
  call SaveStr(MHT,'A2QC',0,"Silencer_GlobalSilence_Start")
  call SaveStr(MHT,'A064',0,"Sniper_Shrapnel")
  call SaveStr(MHT,'A0RG',0,"Riki_SmokeScreen")
  call SaveStr(MHT,'A0K9',0,"Riki_BlinkStrike")
  call SaveStr(MHT,'A1WH',0,"Sven_GodStrenght")
  call SaveStr(MHT,'A0WP',0,"Sven_GodStrenght")
  call SaveStr(MHT,'A190',0,"Sven_StormBolt")
  call SaveStr(MHT,'A1EF',0,"LoneDruid_Rabid")
  call SaveStr(MHT,'A1EE',0,"LoneDruid_Rabid")
  call SaveStr(MHT,'A1EH',0,"LoneDruid_Rabid")
  call SaveStr(MHT,'A1EI',0,"LoneDruid_Rabid")
  call SaveStr(MHT,'A1EG',0,"LoneDruid_Rabid")
  call SaveStr(MHT,'A0A5',0,"LoneDruid_SpiritBear")
  call SaveStr(MHT,'A0AG',0,"LoneDruid_TrueForm")
  //call SaveStr(MHT,'A0A7',0,"LoneDruid_Return")
  call SaveStr(MHT,'A1A1',0,"Chieftain_SplitEarth")
  call SaveStr(MHT,'A0BQ',0,"Tinker_MarchOfMachines")
  call SaveStr(MHT,'A049',0,"Tinker_Laser")
  call SaveStr(MHT,'A33G',0,"Tinker_Laser")
  call SaveStr(MHT,'A0BZ',0,"Tiny_Toss")
  call SaveStr(MHT,'A0LL',0,"Tiny_Avalanche")
  call SaveStr(MHT,'A1EJ',0,"Troll_BattleTrance")
  call SaveStr(MHT,'A0BE',0,"Troll_Rage")
  call SaveStr(MHT,'A21M',0,"Troll_AxesRanged")
  call SaveStr(MHT,'A21N',0,"Troll_AxesMelee")
  call SaveStr(MHT,'A1N4',0,"Ursa_Overpower")
  call SaveStr(MHT,'QB0P',0,"Ursa_Overpower")
  call SaveStr(MHT,'A0LC',0,"Ursa_Enrage")
  call SaveStr(MHT,'A17O',0,"VS_WaveOfTerror")
  call SaveStr(MHT,'A0IN',0,"VS_NetherSwap")
  call SaveStr(MHT,'A1AW',0,"VS_NetherSwap")
  call SaveStr(MHT,'A1EA',0,"TA_Refraction")
  call SaveStr(MHT,'QB03',0,"TA_Refraction")
  call SaveStr(MHT,'A0RV',0,"TA_Meld")
  call SaveStr(MHT,'A14I',0,"WR_Windrun")
  call SaveStr(MHT,'A12J',0,"WR_Shacleshot")
  call SaveStr(MHT,'A12K',0,"WR_Powershot")
  call SaveStr(MHT,'A12P',0,"WR_FocusFire")
  call SaveStr(MHT,'A1D6',0,"WR_FocusFire")
  call SaveStr(MHT,'A29G',0,"Zeus_WrathOfGod")
  call SaveStr(MHT,'A29H',0,"Zeus_WrathOfGod")
  call SaveStr(MHT,'A0JC',0,"Zeus_LightningBolt")
  call SaveStr(MHT,'A020',0,"Zeus_ChainLightning")
  call SaveStr(MHT,'A0I3',0,"Abaddon_DeathCoil")
  call SaveStr(MHT,'A0MF',0,"Abaddon_AphoticShield")
  call SaveStr(MHT,'A0S1',0,"Axe_BattleHunger")
  call SaveStr(MHT,'A0I6',0,"Axe_BerserkerCall")
  call SaveStr(MHT,'A0E2',0,"Axe_CullingBlade")
  call SaveStr(MHT,'A1MR',0,"Axe_CullingBlade")
  call SaveStr(MHT,'A04Y',0,"Bane_Nightmare")
  call SaveStr(MHT,'A02Q',0,"Bane_Grip")
  call SaveStr(MHT,'A1D9',0,"Bane_Grip")
  call SaveStr(MHT,'A1EL',0,"Batrider_StickyNapalm")
  call SaveStr(MHT,'A19V',0,"Batrider_FlameBreak")
  call SaveStr(MHT,'A19Z',0,"Batrider_Firefly")
  call SaveStr(MHT,'QM04',0,"Batrider_Firefly")
  call SaveStr(MHT,'A1MV',0,"Batrider_FlamingLasso")
  call SaveStr(MHT,'A19O',0,"Batrider_FlamingLasso")
  call SaveStr(MHT,'A0LH',0,"BS_Rupture")
  call SaveStr(MHT,'A0EC',0,"BS_Bloodrage_Action")
  call SaveStr(MHT,'Z234',0,"LoDSpinWeb_Cast")
  call SaveStr(MHT,'A0WQ',0,"Brood_Hunger")
  call SaveStr(MHT,'A0BH',0,"Brood_SpawnSpiderlings")
  call SaveStr(MHT,'A0RW',0,"CK_RealityRift")
  call SaveStr(MHT,'A04Q',0,"BoneFletcher_DeathPact")
  call SaveStr(MHT,'A0OJ',0,"OD_AstralImprisonment")
  call SaveStr(MHT,'A0OK',0,"OD_SanityEclipse")
  call SaveStr(MHT,'A1VW',0,"OD_SanityEclipse")
  call SaveStr(MHT,'A0QG',0,"DS_IonShell")
  call SaveStr(MHT,'A0QE',0,"DS_Vacuum")
  call SaveStr(MHT,'A0R7',0,"DS_Surge")
  call SaveStr(MHT,'A21Q',0,"DS_WallOfReplica")
  call SaveStr(MHT,'A0QK',0,"DS_WallOfReplica")
  call SaveStr(MHT,'A15S',0,"Undying_Decay")
  call SaveStr(MHT,'A0R5',0,"Undying_SoulRip")
  call SaveStr(MHT,'A15V',0,"Undying_TombStone")
  call SaveStr(MHT,'QM03',0,"Undying_FleshGolem")
  call SaveStr(MHT,'A0LK',0,"Void_Timewalk")
  call SaveStr(MHT,'A0J1',0,"Void_Chronosphere")
  call SaveStr(MHT,'A1D7',0,"Void_Chronosphere")
  call SaveStr(MHT,'A333',0,"Furion_ForceOfNature")
  //call SaveStr(MHT,'A0VS',0,"VLF")//classic invoker
  //call SaveStr(MHT,'A0VK',0,"WEF")
  //	call SaveStr(MHT,'A0VQ',0,"WJF")
  //	call SaveStr(MHT,'A0XL',0,"WOF")
  //	call SaveStr(MHT,'A0VM',0,"WYF")
  //	call SaveStr(MHT,'A0VN',0,"W0F")
  //	call SaveStr(MHT,'A0VO',0,"XJF")
  //	call SaveStr(MHT,'A0VP',0,"XSF")
  //	call SaveStr(MHT,'A0VG',0,"XXF")
  //	call SaveStr(MHT,'A0VZ',0,"XCF")
  //	call SaveStr(MHT,'A21X',0,"YRF")
  //	call SaveStr(MHT,'A21W',0,"YRF")
  //	call SaveStr(MHT,'A21V',0,"YRF")
  //	call SaveStr(MHT,'A21Y',0,"X2F")
  //	call SaveStr(MHT,'A1GU',0,"X2F")
  call SaveStr(MHT,'Z610',0,"Lod_DeafeningBlast_Effect")
  call SaveStr(MHT,'Z609',0,"Lod_EMP_Effect")
  call SaveStr(MHT,'Z608',0,"Lod_Tornado_Effect")
  call SaveStr(MHT,'Z607',0,"Lod_Alacrity_Effect")
  call SaveStr(MHT,'Z606',0,"Lod_IceWall_Effect")
  call SaveStr(MHT,'Z605',0,"Lod_GhostWalk_Effect")
  call SaveStr(MHT,'Z604',0,"Lod_ColdSnap_Effect")
  call SaveStr(MHT,'Z603',0,"Lod_ForgeSpirit_Effect")
  call SaveStr(MHT,'Z602',0,"Lod_ChaosMeteor_Effect")
  call SaveStr(MHT,'Z601',0,"Lod_SunStrike_Effect")
  call SaveStr(MHT,'QF89',0,"MARKSMANSHIP_EFFECT_sup")
  call SaveStr(MHT,'A33A',0,"Traxex_Gust_Start")
  
  call SaveStr(MHT,'AHtb',0,"SkeletonKing_HellfireBlast")
  call SaveStr(MHT,'QB0H',0,"SkeletonKing_HellfireBlast")
  call SaveStr(MHT,'A2S0',0,"SkeletonKing_MortalStrike_RegSup")
  call SaveStr(MHT,'A0N8',0,"Meepo_Poof")
  call SaveStr(MHT,'A0NB',0,"Meepo_Earthbind")
  call SaveStr(MHT,'Z397',0,"Leshrak_SplitEarth")
  call SaveStr(MHT,'QB0F',0,"Leshrak_SplitEarth")
  call SaveStr(MHT,'A20T',0,"Leshrak_DiabolicEdict")
  call SaveStr(MHT,'A21G',0,"Leshrak_PulseNova")
  call SaveStr(MHT,'A21F',0,"Leshrak_PulseNova")
  call SaveStr(MHT,'A05T',0,"Lich_ChainFrost")
  call SaveStr(MHT,'A08H',0,"Lich_ChainFrost")
  call SaveStr(MHT,'A0X5',0,"Lion_Impale")
  call SaveStr(MHT,'A053',0,"Lich_DarkRitual")
  call SaveStr(MHT,'A093',0,"Lycan_Shapeshift")
  call SaveStr(MHT,'QM02',0,"Lycan_Shapeshift")
  call SaveStr(MHT,'A03D',0,"Lycan_SpiritWolves")
  call SaveStr(MHT,'A0ZF',0,"Lycan_Howl")
  call SaveStr(MHT,'A094',0,"Doom_LvlDeath")
  call SaveStr(MHT,'A10R',0,"Doom_Devour")
  call SaveStr(MHT,'A1OP',0,"Doom_ScorchedEarth")
  call SaveStr(MHT,'A0A2',0,"Doom_AghanimDoom_Act")
  call SaveStr(MHT,'A29L',0,"Magnus_ReversePolarity")
  call SaveStr(MHT,'A037',0,"Magnus_Empower")
  call SaveStr(MHT,'A1RD',0,"Magnus_Skewer")
  call SaveStr(MHT,'A0G2',0,"Medusa_MysticSnake")
  call SaveStr(MHT,'A1AT',0,"Medusa_StoneGaze_Start")
  call SaveStr(MHT,'QB10',0,"Medusa_StoneGaze_Start")
  call SaveStr(MHT,'A194',0,"Lifestealer_OpenWounds")
  call SaveStr(MHT,'A0SW',0,"Lifestealer_Infest")
  call SaveStr(MHT,'A0T2',0,"Lifestealer_Rage")
  call SaveStr(MHT,'QB0Q',0,"Lifestealer_Rage")
  call SaveStr(MHT,'A05V',0,"Necrolyte_DeathPulse")
  call SaveStr(MHT,'A067',0,"Necrolyte_ReapersScythe")
  call SaveStr(MHT,'A08P',0,"Necrolyte_ReapersScythe")
  call SaveStr(MHT,'A0X7',0,"NA_Impale")
  call SaveStr(MHT,'A1H5',0,"NA_Manaburn")
  call SaveStr(MHT,'A2KO',0,"NA_SpikedCarapace")
  call SaveStr(MHT,'A0FH',0,"Shadowraze_Cast")
  call SaveStr(MHT,'A0F0',0,"Shadowraze_Cast")
  call SaveStr(MHT,'A0EY',0,"Shadowraze_Cast")
  call SaveStr(MHT,'A29J',0,"SF_RequiemOfSouls")
  call SaveStr(MHT,'A1MP',0,"SF_RequiemOfSouls")
  call SaveStr(MHT,'A344',0,"TrueForm_BattleRoar")
  call SaveStr(MHT,'A02H',0,"NightHunter_Void")
  call SaveStr(MHT,'A0YM',0,"PA_StiflingDagger")
  call SaveStr(MHT,'A0PL',0,"PA_Blink")
  call SaveStr(MHT,'A0RA',0,"PitLord_PitOfMalice")
  call SaveStr(MHT,'A06I',0,"Pudge_MeatHook")
  call SaveStr(MHT,'A1CX',0,"Pudge_Dismember")
  call SaveStr(MHT,'A2TD',0,"Oblivion_Decripify_Act")
  call SaveStr(MHT,'A1E7',0,"Razor_PlasmaField")
  call SaveStr(MHT,'A1AO',0,"Razor_EyeOfTheStorm")
  call SaveStr(MHT,'A1UV',0,"Razor_EyeOfTheStorm")
  call SaveStr(MHT,'A06O',0,"SK_Burrowstrike")
  call SaveStr(MHT,'A0H0',0,"SK_Sandstorm")
  call SaveStr(MHT,'A29K',0,"Slardar_SlithereenCrush")
  call SaveStr(MHT,'QB0I',0,"Slardar_SlithereenCrush")
  call SaveStr(MHT,'A0HW',0,"Spectre_SpectralDagger")
  call SaveStr(MHT,'A0H9',0,"Spectre_Haunt")
  call SaveStr(MHT,'A0HA',0,"Spectre_Reality")
  call SaveStr(MHT,'A0G4',0,"Spiritbreaker_NetherStrike")
  call SaveStr(MHT,'A1D8',0,"Spiritbreaker_NetherStrike")
  call SaveStr(MHT,'A07Q',0,"TB_Sunder")
  call SaveStr(MHT,'A0H4',0,"TB_ConjureImage")
  call SaveStr(MHT,'A046',0,"Tidehunter_Gush")
  call SaveStr(MHT,'A29I',0,"Tidehunter_Ravage")
  call SaveStr(MHT,'A226',0,"Tidehunter_AnchorSmash")
  call SaveStr(MHT,'A0MU',0,"Doom_DoomCast")
  call SaveStr(MHT,'A0OR',0,"Dazzle_ShadowWave")
  call SaveStr(MHT,'A0NQ',0,"Dazzle_PoisonTouch")
  call SaveStr(MHT,'A10Q',0,"Dazzle_Weave")
  call SaveStr(MHT,'A1DB',0,"Dazzle_Weave")
  call SaveStr(MHT,'A10L',0,"Dazzle_Grave")
  call SaveStr(MHT,'A173',0,"Venomancer_VenomousGale")
  call SaveStr(MHT,'A013',0,"Venomancer_PoisonNova")
  call SaveStr(MHT,'A0A6',0,"Venomancer_PoisonNova")
  call SaveStr(MHT,'A1UZ',0,"Viper_ViperStrike")
  call SaveStr(MHT,'A080',0,"Viper_ViperStrike")
  call SaveStr(MHT,'A08X',0,"Visage_GraveChill")
  call SaveStr(MHT,'A1NE',0,"Visage_Familiars")
  call SaveStr(MHT,'A2IG',0,"Visage_Familiars")
  call SaveStr(MHT,'A1NA',0,"Visage_SoulAssumption")
  call SaveStr(MHT,'A06P',0,"WL_Upheaval")
  call SaveStr(MHT,'A0J5',0,"WL_FatalBounds")
  call SaveStr(MHT,'A0AS',0,"WL_ShadowWord")
  call SaveStr(MHT,'S00U',0,"WL_Infernal")
  call SaveStr(MHT,'A0CT',0,"Weaver_TimeLapse")
  call SaveStr(MHT,'A1QW',0,"Weaver_TheSwarm")
  call SaveStr(MHT,'A0NM',0,"WD_ParalyzingCask")
  call SaveStr(MHT,'A0NE',0,"WD_VoodooRestoration")
  call SaveStr(MHT,'A0NO',0,"WD_Maledict")
  call SaveStr(MHT,'A0NT',0,"WD_DeathWard")
  call SaveStr(MHT,'A0NX',0,"WD_DeathWard")
  call SaveStr(MHT,'A1HS',0,"AA_IceVortex")
  call SaveStr(MHT,'A1MG',0,"AA_ColdFeet")
  call SaveStr(MHT,'A1MI',0,"AA_IceBlast")
  call SaveStr(MHT,'A2QE',0,"AA_IceBlast")
  call SaveStr(MHT,'A1HQ',0,"AA_ChillingTouch")
  call SaveStr(MHT,'A1IM',0,"Slark_DarkPact")
  call SaveStr(MHT,'A1IN',0,"Slark_ShadowDance")
  call SaveStr(MHT,'A1J7',0,"Slark_Pounce")
  call SaveStr(MHT,'A04A',0,"QoP_ScreamOfPain")
  call SaveStr(MHT,'A00P',0,"ShadowShaman_Shackles")
  call SaveStr(MHT,'A1RJ',0,"Phoenix_Dive")
  //call SaveStr(MHT,'A1RJ',0,"Queen_Snatch")
  call SaveStr(MHT,'A1RK',0,"Phoenix_Supernova")
  call SaveStr(MHT,'A1YX',0,"Phoenix_FireSpirits")
  call SaveStr(MHT,'A1S4',0,"SD_ShadowPoison")
  call SaveStr(MHT,'A1S8',0,"SD_Disruption")
  call SaveStr(MHT,'A1SB',0,"SD_SoulCatcher")
  call SaveStr(MHT,'A1SA',0,"SD_DemonicPurge")
  call SaveStr(MHT,'A1SO',0,"Gyro_RocketBarrage")
  call SaveStr(MHT,'A1SQ',0,"Gyro_HomingMissile")
  call SaveStr(MHT,'A1T5',0,"Gyro_Calldown")
  call SaveStr(MHT,'A235',0,"Gyro_Calldown")
  call SaveStr(MHT,'A229',0,"Gyro_FlakCannon")
  call SaveStr(MHT,'A1SU',0,"Disruptor_KineticField")
  call SaveStr(MHT,'A1SW',0,"Disruptor_Glimpse")
  call SaveStr(MHT,'A1TV',0,"Disruptor_ThunderStrike_StartSup")
  call SaveStr(MHT,'A1U6',0,"Disruptor_StaticField")
  call SaveStr(MHT,'A30N',0,"Disruptor_StaticField")
  call SaveStr(MHT,'A2KQ',0,"UnrefinedFireblast")
  call SaveStr(MHT,'A1PH',0,"TB_SoulSteal")
  
  call SaveStr(MHT,'A1T8',0,"Wisp_Spirits")
  call SaveStr(MHT,'A1TA',0,"Wisp_Tether")
  call SaveStr(MHT,'A1TB',0,"Wisp_Relocate")
  call SaveStr(MHT,'A1YO',0,"Tuskar_IceShards")
  call SaveStr(MHT,'A1YQ',0,"Tuskar_WalrusPunch")
  call SaveStr(MHT,'A1S7',0,"Tuskar_Snowball")
  call SaveStr(MHT,'A27F',0,"Rubick_Telekinesis")
  call SaveStr(MHT,'A27G',0,"Rubick_Fadebolt")
  call SaveStr(MHT,'A27H',0,"Rubick_SpellSteal")
  call SaveStr(MHT,'A30J',0,"Rubick_SpellSteal")
  call SaveStr(MHT,'A073',0,"Banshee_Exorcism")
  call SaveStr(MHT,'A03J',0,"Banshee_Exorcism")
  call SaveStr(MHT,'A04J',0,"Banshee_Exorcism")
  call SaveStr(MHT,'A04M',0,"Banshee_Exorcism")
  call SaveStr(MHT,'A04N',0,"Banshee_Exorcism")
  call SaveStr(MHT,'A2HS',0,"Xin_FlameGuard")
  call SaveStr(MHT,'A2H0',0,"Xin_SleightOfFist")
  call SaveStr(MHT,'QB0L',0,"Xin_SleightOfFist")
  call SaveStr(MHT,'A2H3',0,"Xin_SearingChains")
  call SaveStr(MHT,'A2JO',0,"Xin_FireRemnants")
  call SaveStr(MHT,'A2JQ',0,"Xin_FireRemnants")
  call SaveStr(MHT,'A2JP',0,"Xin_FireRemnants")
  call SaveStr(MHT,'A2JR',0,"Xin_FireRemnants")
  call SaveStr(MHT,'A2JL',0,"Xin_FireRemnantsB")
  call SaveStr(MHT,'A2CI',0,"LegionCommander_Duel")
  call SaveStr(MHT,'A2J2',0,"LegionCommander_PressTheAttack")
  call SaveStr(MHT,'A2JB',0,"LegionCommander_OverhelmingOdds")
  call SaveStr(MHT,'A2BG',0,"Skywrath_MysticFlare")
  call SaveStr(MHT,'A30H',0,"Skywrath_MysticFlare")
  call SaveStr(MHT,'A2BE',0,"Skywrath_ArcaneBolt")
  call SaveStr(MHT,'A2HN',0,"Skywrath_AncientSeal")
  call SaveStr(MHT,'A2IT',0,"Skywrath_ConcussiveShot")
  call SaveStr(MHT,'A2FK',0,"Shredder_WhirlingDeath")
  call SaveStr(MHT,'A2E3',0,"Shredder_Timberchain")
  call SaveStr(MHT,'A2E5',0,"Shredder_Chakram")
  call SaveStr(MHT,'A11N',0,"Admiral_XMark_Effectsup")
  call SaveStr(MHT,'A300',0,"Beastmaster_CallHawk")
  call SaveStr(MHT,'A301',0,"Beastmaster_CallBeast")
  call SaveStr(MHT,'A07F',0,"Lich_FrostNova_Start")
  call SaveStr(MHT,'A0CC',0,"Oblivion_LifeDrain_Start")
  call SaveStr(MHT,'A02Z',0,"Oblivion_LifeDrain_Start")
  call SaveStr(MHT,'A32A',0,"Kodo_Spit")
  call SaveStr(MHT,'A32C',0,"Kodo_Trample")
  call SaveStr(MHT,'A32E',0,"Kodo_Digest")
  call SaveStr(MHT,'A32D',0,"Kodo_DigestSpitEffectSup")
  call SaveStr(MHT,'A32G',0,"Kodo_DrumWars")
  call SaveStr(MHT,'A004',0,"Bounty_ShurikenToss")
  
  call SaveStr(MHT,'A2LB',0,"Wyvern_Embrace_Start")
  call SaveStr(MHT,'A0Z0',0,"Wyvern_Curse_Real_Start")
  call SaveStr(MHT,'A01Z',0,"Tree_Invis_Start")
  call SaveStr(MHT,'A0CA',0,"Weaver_Shukuchi_Start")
  call SaveStr(MHT,'A2N1',0,"Shadow_Amulet_Condition")
  call SaveStr(MHT,'A055',0,"Chaos_Bolt_Start")
  call SaveStr(MHT,'A085',0,"Keeper_Illuminate_Start")
  call SaveStr(MHT,'A121',0,"Keeper_Illuminate_End")
  call SaveStr(MHT,'A07Z',0,"Tree_Overgrowth_Start")
  call SaveStr(MHT,'A2K4',0,"Halberd_Start")
  
  call SaveStr(MHT,'QB00',0,"Chaos_Bolt_Start")//[lich bs] balanced chaos bolt
  call SaveStr(MHT,'QB01',0,"Weaver_Shukuchi_Start")
  call SaveStr(MHT,'QB04',0,"Silencer_LastWord")
  
  call SaveStr(MHT,'A2O2',0,"Drow_Trueshot_Toggling")
  
  
  
  //EVENT_UNIT_SPELL_ENDCAST
  call SaveStr(MHT,'A1P8',1,"Spiritbreaker_Charge_Stop")
  call SaveStr(MHT,'A085',1,"Keeper_Illuminate_Check")
  
  //EVENT_UNIT_SPELL_FINISH
  call SaveStr(MHT,'A1AA',2,"Tauren_Stomp_Effect")
  call SaveStr(MHT,'A2LK',2,"Tauren_Stomp_Effect")
  call SaveStr(MHT,'A065',2,"Rearm_Effect")
  
  //EVENT_UNIT_SPELL_CAST
  call SaveStr(MHT,'A1AA',3,"Tauren_Stomp_Check")
  call SaveStr(MHT,'A2LK',3,"Tauren_Stomp_Check")
  call SaveStr(MHT,'A11N',3,"Admiral_XMark_OnCastsup")
  call SaveStr(MHT,'AEbl',3,"AM_Blink_OnCast")
  call SaveStr(MHT,'QB08',3,"AM_Blink_OnCast")
  call SaveStr(MHT,'A00L',3,"Double_Edge_Condtionsup")
  call SaveStr(MHT,'A28T',3,"Chen_HolyPersuation_OnCast")
  call SaveStr(MHT,'A14O',3,"Storm_BallLightning_OnCast")
  call SaveStr(MHT,'A2QI',3,"Kaolin_GeomagneticGrip_Cast")
  call SaveStr(MHT,'A2QT',3,"Oracle_FortunesEnd_OnCastSup")
  call SaveStr(MHT,'A180',3,"Enigma_DemonicConversion_OnCast")
  call SaveStr(MHT,'A1BX',3,"Enigma_BlackHole_OnCast")
  call SaveStr(MHT,'A30L',3,"Enigma_BlackHole_OnCast")
  call SaveStr(MHT,'A21E',3,"Prophet_NaturesWrath_OnCast")
  call SaveStr(MHT,'A0M1',3,"Juggernaut_Omnislash_OnCast")
  call SaveStr(MHT,'A1AX',3,"Juggernaut_Omnislash_OnCast")
  call SaveStr(MHT,'A10U',3,"Kotl_Recall_OnCast")
  call SaveStr(MHT,'A11Y',3,"Kotl_Recall_OnCast")
  call SaveStr(MHT,'A11Z',3,"Kotl_Recall_OnCast")
  call SaveStr(MHT,'A01P',3,"Lina_LagunaBlade_OnCast")
  call SaveStr(MHT,'A09Z',3,"Lina_LagunaBlade_OnCast")
  call SaveStr(MHT,'A0G8',3,"Morphling_Replicate_OnCast")
  call SaveStr(MHT,'A24D',3,"Naga_Ensnare_OnCast")
  call SaveStr(MHT,'A10D',3,"PL_SpiritLance_OnCast")
  call SaveStr(MHT,'A0K9',3,"Rikimaru_BlinkStrike_OnCast")
  call SaveStr(MHT,'A190',3,"Sven_StormBolt_OnCast")
  call SaveStr(MHT,'A0BZ',3,"Tiny_Toss_OnCast")
  call SaveStr(MHT,'A0IN',3,"VS_NetherSwap_OnCast")
  call SaveStr(MHT,'A1AW',3,"VS_NetherSwap_OnCast")
  call SaveStr(MHT,'A02A',3,"VS_MagicMissile_OnCast")
  call SaveStr(MHT,'A0MF',3,"Abaddon_AphoticShield_OnCast")
  call SaveStr(MHT,'A0RW',3,"CK_RealityRift_OnCast")
  call SaveStr(MHT,'A0OJ',3,"OD_AstralImprisonment_OnCast")
  call SaveStr(MHT,'A0QE',3,"DS_Vacuum_OnCast")
  call SaveStr(MHT,'AHtb',3,"SkeletonKing_HellfireBlast_OnCast")
  call SaveStr(MHT,'QB0H',3,"SkeletonKing_HellfireBlast_OnCast")
  call SaveStr(MHT,'A0R0',3,"Pitlord_DarkRift_OnCast")
  call SaveStr(MHT,'A226',3,"Tidehunter_AnhorSmash_OnCast")
  call SaveStr(MHT,'A32D',3,"Kodo_DigestSpitCast")
  
  //call SaveStr(MHT,'A2MC',3,"Chen_Teleport_Check")
  //call SaveStr(MHT,'A28T',3,"Chen_Pursuasion_Check")
  //call SaveStr(MHT,'A065',3,"Rearm_Check")
  
  
  //EVENT_UNIT_HERO_SKILL   // only called the first time the spell is leveled
  //call SaveStr(MHT,'A088',4,"Multicast_Init")
  call SaveStr(MHT,'A1P8',4,"Spiritbreaker_Charge_Learn")
  call SaveStr(MHT,'A32G',4,"Kodo_DigestBonuses")
  call SaveStr(MHT,'AIcd',4,"Pitlord_Atrophy_Init")
  call SaveStr(MHT,'QP1C',4,"Pitlord_Atrophy_Init")
  call SaveStr(MHT,'A0O3',4,"Alchemist_Greed_Learn")
  call SaveStr(MHT,'QP0O',4,"Alchemist_Greed_Learn")
  call SaveStr(MHT,'A0NS',4,"Abbadon_Time_Learn")
  call SaveStr(MHT,'A1DA',4,"Abbadon_Time_Learn")
  call SaveStr(MHT,'A517',4,"Abbadon_Time_Learn")
  call SaveStr(MHT,'A518',4,"Abbadon_Time_Learn")
  call SaveStr(MHT,'A0RP',4,"Templar_Trap_Learn")
  call SaveStr(MHT,'A2O2',4,"MyTrueshot")
  call SaveStr(MHT,'A0AK',4,"RemoteMines_Show")
  call SaveStr(MHT,'QF88',4,"Trax_Marksmanship_learn")
  call SaveStr(MHT,'A30U',4,"THD_LiquidFire_DetectUnitType")
  //call SaveStr(MHT,'A522',4,"Kunka_Tidebringer_Learn")
  //call SaveStr(MHT,'A519',4,"Jakiro_Autofire_Learn")
  call SaveStr(MHT,'A062',4,"Luna_Aura_Learn")
  call SaveStr(MHT,'QP0E',4,"Luna_Aura_Learn")
  //call SaveStr(MHT,'A0RO',4,"TemplarAssassin_PsiBlades_Leveling")
  //call SaveStr(MHT,'A041',4,"Luna_Glaive_Learn")
  //call SaveStr(MHT,'QP0D',4,"Luna_Glaive_Learn")
  //Called everytime as skill obtained as 5-6th skill. They have no Learn trigger, so u have to list functions here
  call SaveStr(MHT,'A32G',1000,"Kodo_DigestBonuses")
  call SaveStr(MHT,'A2O2',1000,"MyTrueshot")
  call SaveStr(MHT,'A0MB',1000,"Riki_PermanentInvis_Learnd")
  call SaveStr(MHT,'P019',1000,"Maiden_Brilliance_Learn")
  call SaveStr(MHT,'QP05',1000,"Maiden_Brilliance_Learn")
  call SaveStr(MHT,'A0O3',1000,"Alchemist_Greed_Learn")
  call SaveStr(MHT,'QP0O',1000,"Alchemist_Greed_Learn")
  call SaveStr(MHT,'A1P8',1000,"Spiritbreaker_Charge_Learn")
  call SaveStr(MHT,'A0RP',1000,"Templar_Trap_Learn")
  call SaveStr(MHT,'AIcd',1000,"Pitlord_Atrophy_Init")
  call SaveStr(MHT,'QF88',1000,"Trax_Marksmanship_learn")
  //call SaveStr(MHT,'A519',1000,"Jakiro_Autofire_Learn")
  call SaveStr(MHT,'A1IN',1000,"Slark_ShadowDance_Learn")
  call SaveStr(MHT,'A1HR',1000,"Slark_EssenceShift_Learn")
  call SaveStr(MHT,'QP1F',1000,"Slark_EssenceShift_Learn")
  call SaveStr(MHT,'A13T',1000,"Kunka_Tidebringer_Learn")
  call SaveStr(MHT,'A522',1000,"Kunka_Tidebringer_Learn")
  call SaveStr(MHT,'A19Q',1000,"Tiny_CraggyExterior_Learning")
  call SaveStr(MHT,'QP1J',1000,"Tiny_CraggyExterior_Learning")
  call SaveStr(MHT,'A0CY',1000,"Tiny_Grow_Learning")
  call SaveStr(MHT,'QP1K',1000,"Tiny_Grow_Learning")
  //call SaveStr(MHT,'A30U',1000,"THD_LiquidFire_DetectUnitType")
  call SaveStr(MHT,'A30T',1000,"THD_LiquidFire_DetectUnitType")
  call SaveStr(MHT,'A306',1000,"THD_LiquidFire_DetectUnitType")
  call SaveStr(MHT,'A1CD',1000,"Chieftain_NaturalOrder_Learning")
  call SaveStr(MHT,'QP1I',1000,"Chieftain_NaturalOrder_Learning")
  
  call SaveStr(MHT,'A0QQ',1000,"SacredWarrior_BerserkerBlood_Learn")
  call SaveStr(MHT,'A0M3',1000,"Bristleback_Bristleback_Learn")
  call SaveStr(MHT,'A2E4',1000,"Shredder_ReactiveArmor_Learn")
  call SaveStr(MHT,'A03U',1000,"Sniper_TakeAim_Learn")
  call SaveStr(MHT,'QP1Q',1000,"Sniper_TakeAim_Learn")
  
  call SaveStr(MHT,'A062',1000,"Luna_Aura_Learn")
  call SaveStr(MHT,'QP0E',1000,"Luna_Aura_Learn")
  call SaveStr(MHT,'A0KX',1000,"Morphling_Morph_Learn")
  //call SaveStr(MHT,'A0CT',1000,"Weaver_TimeLapse_Learn")
  call SaveStr(MHT,'A0A5',1000,"LoneDruid_SpiritBear_Leveling")
  call SaveStr(MHT,'A27V',1000,"Rubick_NullField_Learn")
  call SaveStr(MHT,'QP0P',1000,"Rubick_NullField_Learn")
  call SaveStr(MHT,'A28Q',1000,"Wisp_Overcharge_Learn")
  call SaveStr(MHT,'A18X',1000,"Lina_FierySoul_Learn")
  call SaveStr(MHT,'A11N',1000,"Admiral_XMark_Learn_Triggered")
  call SaveStr(MHT,'A01Y',1000,"Leoric_Reincarnation_Learn")
  //call SaveStr(MHT,'A03E',1000,"Lycan_FeralImpulse_Leveling")
  //call SaveStr(MHT,'QP0Q',1000,"Lycan_FeralImpulse_Leveling")
  
  call SaveStr(MHT,'A0SS',1000,"Lifestealer_Feast_Learn")
  call SaveStr(MHT,'A0RO',1000,"TemplarAssassin_PsiBlades_Leveling")
  call SaveStr(MHT,'A0QW',1000,"StormSpirit_Overload_Learn")
  call SaveStr(MHT,'A0QN',1000,"Huskar_BurningSpear_Learn")
  call SaveStr(MHT,'A1E6',1000,"Razor_UnstableCurrent_Learn")
  call SaveStr(MHT,'A0OI',1000,"Destroyer_ArcaneOrb_Learn")
  call SaveStr(MHT,'A0NA',1000,"Spectre_Dispersion_Learn")
  call SaveStr(MHT,'A0NS',1000,"Abbadon_Time_Learn")
  call SaveStr(MHT,'A0MG',1000,"Abbadon_Frostmourne_Learn")
  call SaveStr(MHT,'A0CG',1000,"Weaver_Attack_Learn")
  call SaveStr(MHT,'A0VX',1000,"Visage_GravekeeperCloak_Leveling")
  call SaveStr(MHT,'A1NA',1000,"Visage_SoulAssumption_Learn")
  call SaveStr(MHT,'A04E',1000,"Tidehunter_KrakenShell_Learn")
  call SaveStr(MHT,'QP10',1000,"Tidehunter_KrakenShell_Learn")
  
  call SaveStr(MHT,'A06D',1000,"Butcher_FleshHeap_Learn")
  call SaveStr(MHT,'QP13',1000,"Butcher_FleshHeap_Learn")
  
  call SaveStr(MHT,'A03P',1000,"PhantomAssassin_Blur_Learn")
  call SaveStr(MHT,'QP0R',1000,"PhantomAssassin_Blur_Learn")
  call SaveStr(MHT,'A01N',1000,"Necrolyte_Heartstopper_Learn")
  call SaveStr(MHT,'A0I8',1000,"Bloodseeker_Thrist_Learn")
  call SaveStr(MHT,'A21L',1000,"Warlord_WhirlingAxes_Learn")
  call SaveStr(MHT,'A06B',1000,"Techies_SuicideSquad_Learn")
  call SaveStr(MHT,'A0LZ',1000,"Silencer_GlaivesOfWisdom_Learn")
  call SaveStr(MHT,'A0DY',1000,"Enchantress_Impetus_Learn")
  call SaveStr(MHT,'A1IQ',1000,"Bounty_Jinada_Learn")
  call SaveStr(MHT,'A524',1000,"Bounty_Jinada_Learn")
  call SaveStr(MHT,'A1V6',1000,"Magina_ManaBreak_Learn")
  call SaveStr(MHT,'A0IF',1000,"Destroyer_EssenceAura_Leveling")
  call SaveStr(MHT,'A1EA',1000,"TemplarAssassin_Refraction_Learn")
  call SaveStr(MHT,'QB03',1000,"TemplarAssassin_Refraction_Learn")
  //call SaveStr(MHT,'A086',1000,"NightStalker_NightHunter_Leveling")
  //call SaveStr(MHT,'A08E',1000,"NightStalker_NightHunter_Leveling")
  call SaveStr(MHT,'A2EY',1000,"LegionCommander_MomentOfCourage")
  call SaveStr(MHT,'A0AK',1000,"RemoteMines_Show")
  call SaveStr(MHT,'A0LV',1000,"Chen_Test_Learn")
  call SaveStr(MHT,'A2AI',1000,"DragonKnight_DragonTail_Leveling")
  call SaveStr(MHT,'A0CZ',1000,"Void_Backtrack_Init")
  call SaveStr(MHT,'A2S0',1000,"SkeletonKing_MortalStrike_AddCrit")
  call SaveStr(MHT,'A0MM',1000,"Viper_CorrosiveSkin_Reg2")
  call SaveStr(MHT,'QP0Y',1000,"Viper_CorrosiveSkin_Reg2")
  call SaveStr(MHT,'A0CL',1000,"DK_DragonBlood_Act")
  call SaveStr(MHT,'QP0J',1000,"DK_DragonBlood_Act")
  call SaveStr(MHT,'A00J',1000,"Riki_PermanentInvisibility_Leveling")
  call SaveStr(MHT,'A0OO',1000,"Beastmaster_CallOfTheWild_Learned")
  call SaveStr(MHT,'A303',1000,"Bone_SearingArrows_Learn")
  call SaveStr(MHT,'A0H4',1000,"TB_ConjureImage_Leveled")
  //call SaveStr(MHT,'P611',4,"Ursa_Swipes_Learn_First")
  
  
  //EVENT_UNIT_HERO_SKILL   // called everytime the spell is leveled
  call SaveStr(MHT,'P019',5,"Maiden_Brilliance_Learn")
  call SaveStr(MHT,'QP05',5,"Maiden_Brilliance_Learn")
  call SaveStr(MHT,'A0H4',5,"TB_ConjureImage_Leveled")
  call SaveStr(MHT,'A0CL',5,"DK_DragonBlood_Act")
  call SaveStr(MHT,'QP0J',5,"DK_DragonBlood_Act")
  call SaveStr(MHT,'A0RO',5,"TemplarAssassin_PsiBlades_Leveling")
  call SaveStr(MHT,'QP1S',5,"TemplarAssassin_PsiBlades_Leveling")
  
  call SaveStr(MHT,'A13T',5,"Kunka_Tidebringer_Learn")
  call SaveStr(MHT,'A0CG',5,"Weaver_Attack_Learn")
  call SaveStr(MHT,'A0LV',5,"Chen_Test_Learn")
  call SaveStr(MHT,'A522',5,"Kunka_Tidebringer_Learn")
  call SaveStr(MHT,'A30U',5,"THD_LiquidFire_Lvlup")
  call SaveStr(MHT,'A32Y',5,"Kodo_DigestLeveling")
  call SaveStr(MHT,'A32Z',5,"Doom_Devour_Leveling")
  call SaveStr(MHT,'A331',5,"Phoenix_Spirits_Leveling")
  // Used for s5-s6 support, called everytime unit obtains next level of ability, but not 1st
  call SaveStr(MHT,'A331',1001,"Phoenix_Spirits_Leveling")
  call SaveStr(MHT,'A0H4',1001,"TB_ConjureImage_Leveled")
  call SaveStr(MHT,'A32Z',1001,"Doom_Devour_Leveling")
  call SaveStr(MHT,'A32Y',1001,"Kodo_DigestLeveling")
  
  call SaveStr(MHT,'A30T',1001,"THD_LiquidFire_Lvlup")
  call SaveStr(MHT,'A306',1001,"THD_LiquidFire_Lvlup")
  call SaveStr(MHT,'A303',1001,"Bone_SearingArrows_Learn")
  call SaveStr(MHT,'P019',1001,"Maiden_Brilliance_Learn")
  call SaveStr(MHT,'A0OO',1001,"Beastmaster_CallOfTheWild_Learned")
  call SaveStr(MHT,'QP05',1001,"Maiden_Brilliance_Learn")
  call SaveStr(MHT,'A2S0',1001,"SkeletonKing_MortalStrike_AddCrit")
  call SaveStr(MHT,'A0LV',1001,"Chen_Test_Learn")
  call SaveStr(MHT,'A0RO',1001,"TemplarAssassin_PsiBlades_Leveling")
  call SaveStr(MHT,'A13T',1001,"Kunka_Tidebringer_Learn")
  call SaveStr(MHT,'A522',1001,"Kunka_Tidebringer_Learn")
  call SaveStr(MHT,'A19Q',1001,"Tiny_CraggeExterior_Leveling")
  call SaveStr(MHT,'QP1J',1001,"Tiny_CraggeExterior_Leveling")
  call SaveStr(MHT,'A03U',1001,"Sniper_TakeAim_Learn")
  call SaveStr(MHT,'QP1Q',1001,"Sniper_TakeAim_Learn")
  //call SaveStr(MHT,'A2EY',1001,"Legion_MomentOfCourage_Leveling")
  call SaveStr(MHT,'A0A5',1001,"LoneDruid_SpiritBear_Leveling")
  call SaveStr(MHT,'A03E',1001,"Lycan_FeralImpulse_Leveling")
  call SaveStr(MHT,'QP0Q',1001,"Lycan_FeralImpulse_Leveling")
  call SaveStr(MHT,'A0CG',1001,"Weaver_Attack_Learn")
  call SaveStr(MHT,'A0VX',1001,"Visage_GravekeeperCloak_Leveling")
  call SaveStr(MHT,'A2AI',1001,"DragonKnight_DragonTail_Leveling")
  call SaveStr(MHT,'A0CY',1001,"Tiny_Grow_Learning")
  call SaveStr(MHT,'QP1K',1001,"Tiny_Grow_Learning")
  call SaveStr(MHT,'A0IF',1001,"Destroyer_EssenceAura_Leveling")
  call SaveStr(MHT,'A0CL',1001,"DK_DragonBlood_Act")
  call SaveStr(MHT,'QP0J',1001,"DK_DragonBlood_Act")
  call SaveStr(MHT,'A00J',1001,"Riki_PermanentInvisibility_Leveling")
  
  
  
  //call SaveStr(MHT,'P611',5,"Ursa_Swipes_Learn")
  
  
  //EVENT_UNIT_ATTACKED
  
  
  
  //EVENT_UNIT_ISSUED_ORDER
  //EVENT_UNIT_ISSUED_POINT_ORDER
  //EVENT_UNIT_ISSUED_TARGET_ORDER
  
  
  //EVENT_PLAYER_UNIT_SUMMON
  call SaveStr(MHT,'A24K',9,"Terrorblase_Reflection_Illusion")
  
  
  //EVENT_PLAYER_CHAT
  call SaveStr(MHT,StringHash("-display"),10,"Psi_Blades_Display_Toggle")
  call SaveStr(MHT,StringHash("-stats"),10,"Display_Stats")
  call SaveStr(MHT,StringHash("-st"),10,"Display_Stats")
  //call SaveStr(MHT,StringHash("derp"),10,"herp")//for imbaness \:D/
endfunction

function LoDEvent_Add takes nothing returns nothing
  local unit u = GetTriggerUnit()
  if LoadBoolean(MHT,GetHandleId(u),2) then
    set u=null
    return
  endif
  //call TriggerRegisterUnitEvent(GAME_TRIGGER,u,EVENT_UNIT_DAMAGED)
  
  
  call TriggerRegisterUnitEvent(GAME_TRIGGER,u,EVENT_UNIT_HERO_SKILL)
  
  call TriggerRegisterUnitEvent(GAME_TRIGGER,u,EVENT_UNIT_SPELL_CAST)
  call TriggerRegisterUnitEvent(GAME_TRIGGER,u,EVENT_UNIT_SPELL_EFFECT)
  call TriggerRegisterUnitEvent(GAME_TRIGGER,u,EVENT_UNIT_SPELL_FINISH)
  call TriggerRegisterUnitEvent(GAME_TRIGGER,u,EVENT_UNIT_SPELL_ENDCAST)
  
  call TriggerRegisterUnitEvent(GAME_TRIGGER,u,EVENT_UNIT_ISSUED_ORDER)
  call TriggerRegisterUnitEvent(GAME_TRIGGER,u,EVENT_UNIT_ISSUED_POINT_ORDER)
  call TriggerRegisterUnitEvent(GAME_TRIGGER,u,EVENT_UNIT_ISSUED_TARGET_ORDER)
  call SaveBoolean(MHT,GetHandleId(u),2,true)//used to check if a unit has registered order events
  
  
  
  
  set u = null
endfunction

function WriteImageOnGround takes string S,real SizeX,real SizeY,real PosX,real PosY,real PosZ,boolean Show,integer id returns nothing
  set tt_image1=CreateImage(S,SizeX,SizeY,0,PosX-(SizeX/ 2),PosY-(SizeY/ 2),PosZ,0,0,0,2)
  call SetImageRenderAlways(tt_image1,true)
  call ShowImage(tt_image1,true)
endfunction

function LichFunctionToDisplayTimeLeft takes integer seconds,integer r,integer g,integer b,integer a,real x,real y,integer Cache returns nothing
  if seconds>99 then
    set TIMERIMG[1]=true
    set TIMERIMG[2]=true
    set TIMERIMG[3]=true
    
    call WriteImageOnGround("Fonts\\"+SubString(I2S(seconds),0,1)+".blp",61,61,x-50,y,0,true,1)
    call SaveImageHandle(hashtable019,Cache,1520,tt_image1)
    call SetImageColor(tt_image1,r,g,b,a)
    call WriteImageOnGround("Fonts\\"+SubString(I2S(seconds),1,2)+".blp",61,61,x-20,y,0,true,2)
    call SaveImageHandle(hashtable019,Cache,1521,tt_image1)
    call SetImageColor(tt_image1,r,g,b,a)
    call WriteImageOnGround("Fonts\\"+SubString(I2S(seconds),2,3)+".blp",61,61,x+20,y,0,true,3)
    call SaveImageHandle(hashtable019,Cache,1522,tt_image1)
    call SetImageColor(tt_image1,r,g,b,a)
  elseif seconds >9 then
    set TIMERIMG[2]=true
    set TIMERIMG[3]=true
    
    call WriteImageOnGround("Fonts\\"+SubString(I2S(seconds),0,1)+".blp",61,61,x-20,y,0,true,2)
    call SaveImageHandle(hashtable019,Cache,1521,tt_image1)
    call SetImageColor(tt_image1,r,g,b,a)
    call WriteImageOnGround("Fonts\\"+SubString(I2S(seconds),1,2)+".blp",61,61,x+20,y,0,true,3)
    call SaveImageHandle(hashtable019,Cache,1522,tt_image1)
    call SetImageColor(tt_image1,r,g,b,a)
  else
    set TIMERIMG[2]=true
    set TIMERIMG[3]=true
    call PlaySoundBJ(Sound_Tick)
    //call KillSoundWhenDone(bj_lastPlayedSound)
    call WriteImageOnGround("Fonts\\0.blp",61,61,x-20,y,0,true,2)
    call SaveImageHandle(hashtable019,Cache,1521,tt_image1)
    call SetImageColor(tt_image1,r,g,b,a)
    call WriteImageOnGround("Fonts\\"+I2S(seconds)+".blp",61,61,x+20,y,0,true,3)
    call SaveImageHandle(hashtable019,Cache,1522,tt_image1)
    call SetImageColor(tt_image1,r,g,b,a)
  endif
  
endfunction

function APShowTimer takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local integer i=R2I(TimerGetRemaining(NK))
  local image im
  local integer k=1
  loop
    set LastTimeActivity[k]=TimerGetElapsed(GlobalTimer)
    set k=k+1
    exitwhen k>11
  endloop
  if TIMERIMG[1]==true then
    set im=LoadImageHandle(hashtable019,h,1520)
    call DestroyImage(im)
    set TIMERIMG[1]=false
  endif
  if TIMERIMG[2]==true then
    set im=LoadImageHandle(hashtable019,h,1521)
    call DestroyImage(im)
    set TIMERIMG[2]=false
  endif
  if TIMERIMG[3]==true then
    set im=LoadImageHandle(hashtable019,h,1522)
    call DestroyImage(im)
    set TIMERIMG[3]=false
  endif
  if i==0 or b_AllPlayersReady then
    call FlushChildHashtable(hashtable019,h)
    call DestroyTrigger(t)
  else
    call LichFunctionToDisplayTimeLeft(i,255,2,2,255,-7000,6666,h)
  endif
  
  set t=null
endfunction

function ShowTimersInit takes nothing returns nothing
  set APShowTimersTrig=CreateTrigger()// timer on taverns
  set Sound_Tick=CreateSound( "Sound\\Interface\\BattleNetTick.wav", false, false, false, 10, 10, "" )
  call SetSoundParamsFromLabel( Sound_Tick, "ChatroomTimerTick" )
  call SetSoundDuration( Sound_Tick, 476 )
  call TriggerRegisterTimerEvent(APShowTimersTrig,1,true)
  call TriggerAddCondition(APShowTimersTrig,Condition(function APShowTimer))
  call TriggerEvaluate(APShowTimersTrig)
  
endfunction

function MeeleeRangedItemFixFn takes unit Hero,item Item returns nothing
  local unit u=Hero
  local integer unitId=GetUnitTypeId(u)
  local integer indexId=GetIndexNoMute(Item)
  if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)then
    if indexId==indexid_EyeOfSkadiRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_EyeOfSkadi])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_QuellingBladeRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_QuellingBlade])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_StoutShieldRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_StoutShield])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_PoormansShieldRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_PoormansShield])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_VanguardRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_Vanguard])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_OrbOfVenomRanged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_OrbOfVenom])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_MantaStyleRanged then
      if BY9(u)==false then
        set tt_player1=GetItemPlayer(Item)
        call RemoveItem(Item)
        set tt_item1=UnitAddItemById(u,Item_Real[indexid_MantaStyle])
        call SetItemPlayer(tt_item1,tt_player1,false)
        call SetItemUserData(tt_item1,1)
      endif
    elseif indexId==indexid_corruptorranged then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_corruptor])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    endif
  else
    if indexId==indexid_EyeOfSkadi then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_EyeOfSkadiRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_QuellingBlade then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_QuellingBladeRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_StoutShield then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_StoutShieldRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_PoormansShield then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_PoormansShieldRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_Vanguard then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_VanguardRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_OrbOfVenom then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_OrbOfVenomRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_MantaStyle then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_MantaStyleRanged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    elseif indexId==indexid_corruptor then
      set tt_player1=GetItemPlayer(Item)
      call RemoveItem(Item)
      set tt_item1=UnitAddItemById(u,Item_Real[indexid_corruptorranged])
      call SetItemPlayer(tt_item1,tt_player1,false)
      call SetItemUserData(tt_item1,1)
    endif
  endif
  set u=null
endfunction

function MeleeRangeItemsFix takes nothing returns boolean
  local integer i=0
  local integer k=0
  local item it=null
  local integer j=0
  local boolean f=false
  loop
    exitwhen i>12
    if IsDead(udg_Hero[i])==false and TimerGetRemaining(HeroRespawnTimer[i])<=0 then
      set k=0
      call RemoveDefaultString(udg_Hero[i],0.1)
      loop
        exitwhen k>5
        set it=UnitItemInSlot(udg_Hero[i],k)
        if it!=null then
          set f=false
          set j=1
          loop
            exitwhen j>VU7
            if VT7[j]==it and (GetIndexNoMute(it)==indexid_MantaStyle or GetIndexNoMute(it)==indexid_MantaStyleRanged) then//check cooldowned items state
              set j=99999
              set f=true//skip item if its on cd
            endif
            set j=j+1
          endloop
          if f==false then
            call MeeleeRangedItemFixFn(udg_Hero[i],it)
          endif
        endif
        set k=k+1
      endloop
    endif
    set i=i+1
  endloop
  set it=null
  return false
endfunction

function skdjgbnkjwfefb takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer lvl=LoadInteger(hashtable019,h,1)
  local integer id='Q0BK'
  if GetTriggerEventId()==EVENT_UNIT_HERO_SKILL then
    if GetLearnedSkill()==id then
      call SaveInteger(hashtable019,h,1,GetLearnedSkillLevel())
    endif
  elseif GetTriggerEventId()==EVENT_UNIT_DEATH then
    call TriggerRegisterTimerEvent(t,1,true)
  else
    if IsDead(u)==false then
      call UnitRemoveAbility(u,id)
      call UnitAddAbility2(u,id)
      call SetUnitAbilityLevel(u,id,lvl)
      call DestroyTrigger(t)
      call FlushChildHashtable(hashtable019,h)
    endif
  endif
  set t=null
  set u=null
endfunction

function FixRangeMorphsBite takes nothing returns nothing
  local trigger t
  local integer h
  local unit u=GetTriggerUnit()
  local integer id='Q0BK'
  local integer lvl=GetUnitAbilityLevel(u,id)
  if lvl>0 then
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,0.4,false)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_HERO_SKILL)
    call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
    call TriggerAddCondition(t,Condition(function skdjgbnkjwfefb))
    call SaveUnitHandle(hashtable019,h,0,u)
    call SaveInteger(hashtable019,h,1,lvl)
    set t=null
  endif
  set u=null
endfunction

function Kaolin_addsubskill takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer PlayerId=GetPlayerId(GetOwningPlayer(u))
  local integer xx=1
  local boolean b=false
  loop
    if PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]>=441 and PlayerSkillNumber[PlayerId*PlayerSkillOffset+xx]<=444 then
      set b=true
    endif
    set xx=xx+1
    exitwhen b or xx>4+NumberOfExtraAbilities
  endloop
  if not LoadBoolean(hashtable019,GetHandleId(u),StringHash("rolling stones")) and b then
    call UnitAddAbility2(u,'A2TH')
    call Kaolin_RollingBoulder_Init(u)
    call SaveBoolean(hashtable019,GetHandleId(u),StringHash("rolling stones"),true)
  endif
  set u=null
  call FlushChildHashtable(hashtable019,h)
  call DestroyTimer(t)
  set t=null
endfunction

function Kaolin_Prereg takes nothing returns nothing
  local timer t
  local integer h
  if b_isPickTime==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and IsUnitIllusion(GetTriggerUnit())==false then
    set t=CreateTimer()
    set h=GetHandleId(t)
    call TimerStart(t,0,false,function Kaolin_addsubskill)
    call SaveUnitHandle(hashtable019,h,0,GetTriggerUnit())
  endif
  set t=null
endfunction

function Weaver_TimeLapse_LearnFixed takes unit u returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterTimerEventPeriodic(t,.5)
  call TriggerAddAction(t,function RDG)
  call SaveUnitHandle(hashtable019,GetHandleId(t),221,u)
  set t=null
endfunction

function TimeLapse_Init takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  call Weaver_TimeLapse_LearnFixed(u)
  set u=null
  call FlushChildHashtable(hashtable019,h)
  call CleanTrigger(t)
  set t=null
endfunction

function TimeLapse_PreInit takes nothing returns nothing
  local trigger t
  local integer h
  if b_isPickTime==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and IsUnitIllusion(GetTriggerUnit())==false then
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,0,false)
    call TriggerAddCondition(t,Condition(function TimeLapse_Init))
    call SaveUnitHandle(hashtable019,h,0,GetTriggerUnit())
    set t=CreateTrigger()
    set h=GetHandleId(t)
    call TriggerRegisterTimerEvent(t,.5,true)
    call TriggerAddCondition(t,Condition(function FQG))
    call SaveUnitHandle(hashtable019,(h),(304),(GetTriggerUnit()))
    call SaveUnitHandle(hashtable019,(h),(305),(CreateUnit(GetOwningPlayer(GetTriggerUnit()),'o01A',GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),0)))
  endif
  set t=null
  
endfunction

function FixHPIllusBug takes nothing returns nothing
  if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO) and b_isPickTime==false and IsUnitIllusion(GetTriggerUnit())==false  then//and (LoadBoolean(HY,(GetHandleId(GetTriggerUnit())),(327)))==false
    //call SaveBoolean(HY,(GetHandleId(GetTriggerUnit())),(327),(true))
    call UnitAddItem(GetTriggerUnit(),CreateItem('I00E',GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit())))
  endif
endfunction

function Kaolin_RegisterUnitWithStones takes nothing returns nothing
  local trigger t=CreateTrigger()
  local region r=CreateRegion()
  //call RegionAddRect(r,bj_mapInitialPlayableArea)
  call TriggerRegisterEnterRectSimple(t,bj_mapInitialPlayableArea)
  call TriggerAddCondition(t,Condition(function Kaolin_Prereg))
  if Kaolin_PreloadAnimation==false then
    set Kaolin_PreloadAnimation=true
  endif
  call TriggerAddCondition(t,Condition(function TimeLapse_PreInit))
  //call TriggerAddCondition(t,Condition(function TimeLapse_PreInit))
  //call TriggerAddCondition(t,Condition(function FixHPIllusBug))
  set r=null
  set t=null
endfunction

function Bughunter_Dummies takes nothing returns nothing
  local unit hero
  local unit dummy
  local integer i=1
  local integer lvl=0
  local boolean b=Mode_S5 or Mode_S6
  if b_isPickTime then
    return
  endif
  loop
    set hero=udg_Hero[i]
    set dummy=BugHunterProviders[i]
    set lvl=GetUnitAbilityLevel(hero,'A086')+GetUnitAbilityLevel(hero,'QP0T')
    if lvl==0 and b then
      if SkillID[PlayerSkillNumber[i*PlayerSkillOffset+5]]=='P247' then
        set lvl=ExtraAbilityLevel[i*2+1]
      endif
    endif
    if lvl>0 then
      if IsDayTime() then
        if GetUnitAbilityLevel(dummy,'A330')!=0 then
          call UnitRemoveAbility(dummy,'A330')
        endif
        if IsHeroDead[GetPlayerId(GetOwningPlayer(hero))]==false then
          if GetUnitAbilityLevel(hero,'P247')>0 and GetUnitAbilityLevel(hero,'P247')!=5  then
            call SetUnitAbilityLevel(hero,'P247',5)
          endif
          if GetUnitAbilityLevel(hero,'A116')>0 then
            call UnitRemoveAbility(hero,'A116')
            call UnitRemoveAbility(hero,'A117')
          endif
        endif
      else
        if GetUnitAbilityLevel(dummy,'A330')!=lvl then
          call UnitAddAbility2(dummy,'A330')
          call SetUnitAbilityLevel(dummy,'A330',lvl)
        endif
        if IsHeroDead[GetPlayerId(GetOwningPlayer(hero))]==false then
          if GetUnitAbilityLevel(hero,'P247')!=lvl then
            call SetUnitAbilityLevel(hero,'P247',lvl)
          endif
          if GetUnitAbilityLevel(hero,'A116')==0 then
            call UnitAddAbility2(hero,'A116')
            call UnitAddAbility2(hero,'A117')
          endif
        endif
      endif
    elseif GetUnitAbilityLevel(dummy,'A330')>0 then
      call UnitRemoveAbility(dummy,'A330')
    endif
    if IsDead(hero)==false and IsHeroDead[GetPlayerId(GetOwningPlayer(hero))]==false and (GetUnitAbilityLevel(hero,'A08E')>0 or SkillID[PlayerSkillNumber[GetPlayerId(GetOwningPlayer(hero))*PlayerSkillOffset+5]]=='A08C') then
      if IsDayTime()==false then
        if GetUnitAbilityLevel(hero,'A08E')>0 then
          call SetUnitAbilityLevel(hero,'A08C',GetUnitAbilityLevel(hero,'A08E'))
        else
          call SetUnitAbilityLevel(hero,'A08C',ExtraAbilityLevel[GetPlayerId(GetOwningPlayer(hero))*2+1])
        endif
      else
        call SetUnitAbilityLevel(hero,'A08C',5)
      endif
    endif
    set i=i+1
    if i==6 then
      set i=7
    endif
    exitwhen i>11
  endloop
  set hero=null
  set dummy=null
endfunction

function NIghtstalker_Passive_Global takes nothing returns nothing
  local timer t=CreateTimer()
  local unit u
  local integer i=1
  loop
    set BugHunterProviders[i]=CreateUnit(Player(i),'e00C',0,0,0)
    call UnitAddAbility2(BugHunterProviders[i],'Aloc')
    set i=i+1
    if i==6 then
      set i=7
    endif
    exitwhen i>11
  endloop
  call TimerStart(t,1,true,function Bughunter_Dummies)
  set t=null
endfunction

function CustomUnitBountyAllyFilter takes nothing returns boolean
  if(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GlobalKiller)) and IsDead(GetFilterUnit())==false and IsHexed(GetFilterUnit())==false) then
    return true
  endif
  return false
endfunction

function Func5420 takes nothing returns boolean
  if(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GlobalKiller))==false and IsDead(GetFilterUnit())==false and IsHexed(GetFilterUnit())==false) then
    return true
  endif
  return false
endfunction

function GiveRealExpToUnitsAround takes nothing returns nothing
  if(GetUnitLevel(GetEnumUnit())<25 or Mode_UL)then 
    call AddHeroXP(GetEnumUnit(),GlobalKillerExp,true)
  endif
  
endfunction

function CustomUnitBountySystemInit takes nothing returns nothing
  local unit killer=GetKillingUnit()
  local unit dead=GetTriggerUnit()
  local integer i=0
  local integer gold=0
  local integer xp=0
  local group g=null
  local group gg=null
  local integer count=0
  local boolean b=false
  local integer greed=0
  local integer greedlvl=0
  if IsUnitType(dead,UNIT_TYPE_HERO) or IsUnitIllusion(dead) then
    set dead=null
    set killer=null
    return
  endif
  if(killer!=null) then
    set b=IsUnitAlly(killer,GetOwningPlayer(dead))
    if b then
      if SacrificedByLich then
        set xp=LoadInteger(UnitStats,i,EXP)
      else
        set xp=36
      endif
      if xp>0 then
        set g=GetAvailableGroup()
        set GlobalKiller=killer
        call GroupEnumUnitsInRange(g,GetUnitX(dead),GetUnitY(dead),EXPAOE,Condition(function Func5420))//alive non-hexed enemy heroes
        //set count=CountUnitsInGroup(g)
        if(FirstOfGroup(g)!=null)then
          set GlobalKillerExp=R2I(xp/CountUnitsInGroup(g))
          call ForGroup(g,function GiveRealExpToUnitsAround)
        endif
        call KillGroup(g)
        set GlobalKiller=null
      endif
    endif
    if b==false or SacrificedByLich then
      set i=GetUnitTypeId(dead)
      if(SacrificedByLich==false) and (GetOwningPlayer(killer)!=Sentinels[0] and GetOwningPlayer(killer)!=Scourges[0])then
        if LoadReal(HeroStats,GetHandleId(GetOwningPlayer(killer)),25)<TimerGetElapsed(GlobalTimer)then
          set greedlvl=GetUnitAbilityLevel(killer,'P155')//Goblin's greed
          if greedlvl>0 and IsUnitType(dead,UNIT_TYPE_STRUCTURE)==false and (GetUnitAbilityLevel(dead,'A04R')==0 or IsSiegeUnit(dead)) then
            set greed=IMinIF(2+2*greedlvl+LoadInteger(MHT,GetHandleId(killer),'A0O3'),30)//define gold
            call SaveInteger(MHT,GetHandleId(GetOwningPlayer(killer)),'A0O3',LoadInteger(MHT,GetHandleId(GetOwningPlayer(killer)),'A0O3') + greed)//save gold for greedy stats
          endif
          
          set gold=GetRandomInt(LoadInteger(UnitStats,i,BOUNTYL),LoadInteger(UnitStats,i,BOUNTYH))+greed
          if gold>0 then
            call ImitateBountyGain(GetOwningPlayer(killer),dead,gold)
          endif
        else
          //call BJDebugMsg("Gold restricted due to buyback.")
        endif
      endif
      set xp=LoadInteger(UnitStats,i,EXP)
      if(xp>0) then
        if IsUnitType(dead,UNIT_TYPE_SUMMONED) then
          set xp=R2I(xp*0.5)
        endif
        set g=GetAvailableGroup()
        set GlobalKiller=killer
        call GroupEnumUnitsInRange(g,GetUnitX(dead),GetUnitY(dead),EXPAOE,Condition(function CustomUnitBountyAllyFilter))//alive non-hexed allied heroes
        if(GetOwningPlayer(dead)==NeutralsPlayer and IsUnitType(dead,UNIT_TYPE_ANCIENT)==false)then
          set gg=GetAvailableGroup()
          call GroupEnumUnitsInRange(gg,GetUnitX(dead),GetUnitY(dead),EXPAOE,Condition(function Func5420))//alive non-hexed allied heroes
          call GroupAddGroup(gg,g)
          call KillGroup(gg)
          set gg=null
        endif
        //set count=CountUnitsInGroup(g)
        if(FirstOfGroup(g)!=null)then
          set GlobalKillerExp=R2I(xp/CountUnitsInGroup(g))
          //call BJDebugMsg(I2S(count))
          call ForGroup(g,function GiveRealExpToUnitsAround)
        endif
        set GlobalKiller=null
        call KillGroup(g)
        
      endif
      set SacrificedByLich=false
    endif
    //call BJDebugMsg(I2S(gold)+" gold, exp: "+I2S(xp))
    
  endif
  set killer=null
  set dead=null
  set g=null
endfunction

function OnPurge takes nothing returns nothing
  call UnitRemoveAbility(GetSpellTargetUnit(),'B02U')//viscous nasal goo
  call UnitRemoveAbility(GetSpellTargetUnit(),'BHtc')//thunderclap
endfunction

function SpiderlingsCheck takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  local integer h=GetHandleId(t)
  local unit u=LoadUnitHandle(hashtable019,h,0)
  local integer hu=GetHandleId(u)
  local real time=TimerGetElapsed(GlobalTimer)
  local real limit=LoadReal(MHT,hu,'A002')
  local integer pid=LoadInteger(MHT,hu,'A002')
  local unit spider
  if GetTriggerEventId()==EVENT_UNIT_DEATH then
    call DestroyEffect(LoadEffectHandle(MHT,hu,'A002'+1))
    set spider=CreateUnit(Player(pid),'n01E',GetUnitX(u),GetUnitY(u),0)
    call UnitApplyTimedLife(spider,'BTLF',60)
    if GetUnitX(spider)==0 and GetUnitY(spider)==0 then
      //i dont know ~.~
    endif
  else
    if time>=limit then
      call DestroyEffect(LoadEffectHandle(MHT,hu,'A002'+1))
      call FlushChildHashtable(hashtable019,h)
      call DestroyTrigger(t)
      call RemoveSavedHandle(MHT,hu,'A002')
      call RemoveSavedInteger(MHT,hu,'A002')
      call RemoveSavedReal(MHT,hu,'A002')
    endif
  endif
  
  set t=null
endfunction

function SpiderlingsSpawnAttack takes nothing returns nothing
  local trigger t
  local integer h
  local unit attacker=GetAttacker()
  local unit attacked=GetTriggerUnit()
  local integer ha
  if GetUnitAbilityLevel(attacker,'A002')>0 and IsUnitType(attacked,UNIT_TYPE_SUMMONED)==false and IsUnitIllusion(attacked)==false then
    set ha=GetHandleId(attacked)
    set t=LoadTriggerHandle(MHT,ha,'A002')
    if t!=null then
      call SaveReal(MHT,ha,'A002',TimerGetElapsed(GlobalTimer)+2.)
      call SaveInteger(MHT,ha,'A002',GetPlayerId(GetOwningPlayer(attacker)))
    else
      set t=CreateTrigger()
      call TriggerRegisterTimerEvent(t,0.1,true)
      call TriggerRegisterUnitEvent(t,attacked,EVENT_UNIT_DEATH)
      call TriggerAddCondition(t,Condition(function SpiderlingsCheck))
      call SaveUnitHandle(hashtable019,GetHandleId(t),0,attacked)
      call SaveTriggerHandle(MHT,ha,'A002',t)
      call SaveReal(MHT,ha,'A002',TimerGetElapsed(GlobalTimer)+2.)
      call SaveInteger(MHT,ha,'A002',GetPlayerId(GetOwningPlayer(attacker)))
      call SaveEffectHandle(MHT,ha,'A002'+1,AddSpecialEffectTarget("Abilities\\Spells\\Other\\Parasite\\ParasiteTarget.mdl",attacked,"overhead"))
    endif
  endif
  set t=null
  set attacker=null
  set attacked=null
endfunction

function SpiderlingsSpawnsInit takes nothing returns nothing
  local trigger t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function SpiderlingsSpawnAttack))
  set t=null
endfunction

function fuckingstuck takes nothing returns nothing
endfunction


function RadianceBearers takes nothing returns boolean
  return IsDead(GetFilterUnit())==false and GetUnitAbilityLevel(GetFilterUnit(),'A04I')>0 and IsUnitPaused(GetFilterUnit())==false and IsHexed(GetFilterUnit())==false and GetUnitAbilityLevel(GetFilterUnit(),'BNdo')==0 and GetUnitAbilityLevel(GetFilterUnit(),'B0FG')==0
endfunction

function RadianceEnemies takes nothing returns boolean
  return IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(TEMPUNIT)) and IsUnitInGroup(GetFilterUnit(),RadianceDamaged)==false and IsDead(GetFilterUnit())==false and GetUnitAbilityLevel(GetFilterUnit(),'A04R')==0 and GetUnitAbilityLevel(GetFilterUnit(),'Aloc')==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_MECHANICAL)==false 
endfunction

function RadianceDamage takes nothing returns nothing
  call DamageTarget(tt_unit1,GetEnumUnit(),1,50)
endfunction

function RadianceForGroup takes nothing returns nothing
  local unit u=GetEnumUnit()
  local group g=GetAvailableGroup()
  set TEMPUNIT=u
  call GroupEnumUnitsInRange(g,GetUnitX(u),GetUnitY(u),725,Condition(function RadianceEnemies))
  call GroupAddGroup(g,RadianceDamaged)
  set TEMPUNIT=u
  set tt_unit1=CreateUnit(GetOwningPlayer(u),'e00E',GetUnitX(u),GetUnitY(u),0)
  call ForGroup(g,function RadianceDamage)
  call KillGroup(g)
  set g=null
  set u=null
endfunction

function RadianceTick takes nothing returns nothing
  local group g=GetAvailableGroup()
  set zOffsetDebug=0
  call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function RadianceBearers))
  call GroupClear(RadianceDamaged)
  call ForGroup(g,function RadianceForGroup)
  call KillGroup(g)
  set g=null
endfunction

function RadiancePick takes nothing returns nothing
  local timer t=LoadTimerHandle(hashtable019,GetHandleId(GetTriggeringTrigger()),0)
  call TimerStart(t,1,true,function RadianceTick)
  call FlushChildHashtable(hashtable019,GetHandleId(GetTriggeringTrigger()))
  call DestroyTrigger(GetTriggeringTrigger())
  set t=null
endfunction

function RadianceTriggered takes nothing returns nothing
  local timer t=CreateTimer()
  local trigger tt=CreateTrigger()
  call SaveTimerHandle(hashtable019,GetHandleId(tt),0,t)
  call TriggerRegisterAnyUnitEvent(tt,EVENT_PLAYER_UNIT_PICKUP_ITEM)
  call TriggerAddCondition(tt,Condition(function RadiancePick))
  call ExeFunc("PushOut")
  call ExeFunc("SaveHeroes")
  set t=null
  set tt=null
endfunction

function PushOutToMap takes nothing returns nothing
  local unit u=GetTriggerUnit()
  local real x=GetUnitX(u)
  local real y=GetUnitY(u)
  if SafeX50(x)!=x then
    call SetUnitX(u,SafeX50(x))
  endif
  if SafeY50(y)!=y then
    call SetUnitY(u,SafeY50(y))
  endif
  set u=null
endfunction

function PushOut takes nothing returns nothing
  local trigger t=CreateTrigger()
  //call TriggerRegisterTimerEvent(t,0.33,true)
  call TriggerRegisterLeaveRectSimple(t,bj_mapInitialPlayableArea)
  call TriggerAddCondition(t,Condition(function PushOutToMap))
  set t=null
endfunction

function RecreateHeroIfMissed takes integer i, integer h returns nothing
  local player p=Player(i)
  local integer k=i*100
  local unit u=CreateUnit(p,LoadInteger(hashtable019,h,k+80),LoadReal(hashtable019,h,k),LoadReal(hashtable019,h,k+1),90)
  local item it=null
  call AddHeroXP(u,LoadInteger(hashtable019,h,k+30),false)
  set it=CreateItem(LoadInteger(hashtable019,h,k+1),0,0)
  call SetItemPlayer(it,LoadPlayerHandle(hashtable019,h,k+1),true)
  call UnitAddItem(u,it)
  if LoadInteger(hashtable019,h,k+11)>0 then
    call SetItemCharges(it,LoadInteger(hashtable019,h,k+11))
  endif
  set it=CreateItem(LoadInteger(hashtable019,h,k+2),0,0)
  call SetItemPlayer(it,LoadPlayerHandle(hashtable019,h,k+2),true)
  call UnitAddItem(u,it)
  if LoadInteger(hashtable019,h,k+12)>0 then
    call SetItemCharges(it,LoadInteger(hashtable019,h,k+12))
  endif
  set it=CreateItem(LoadInteger(hashtable019,h,k+3),0,0)
  call SetItemPlayer(it,LoadPlayerHandle(hashtable019,h,k+3),true)
  call UnitAddItem(u,it)
  if LoadInteger(hashtable019,h,k+13)>0 then
    call SetItemCharges(it,LoadInteger(hashtable019,h,k+13))
  endif
  set it=CreateItem(LoadInteger(hashtable019,h,k+4),0,0)
  call SetItemPlayer(it,LoadPlayerHandle(hashtable019,h,k+4),true)
  call UnitAddItem(u,it)
  if LoadInteger(hashtable019,h,k+14)>0 then
    call SetItemCharges(it,LoadInteger(hashtable019,h,k+14))
  endif
  set it=CreateItem(LoadInteger(hashtable019,h,k+5),0,0)
  call SetItemPlayer(it,LoadPlayerHandle(hashtable019,h,k+5),true)
  call UnitAddItem(u,it)
  if LoadInteger(hashtable019,h,k+15)>0 then
    call SetItemCharges(it,LoadInteger(hashtable019,h,k+15))
  endif
  set it=CreateItem(LoadInteger(hashtable019,h,k+6),0,0)
  call SetItemPlayer(it,LoadPlayerHandle(hashtable019,h,k+6),true)
  call UnitAddItem(u,it)
  if LoadInteger(hashtable019,h,k+16)>0 then
    call SetItemCharges(it,LoadInteger(hashtable019,h,k+16))
  endif
  call DisplayTimedTextToPlayer(p,0,0,20,"|c00ff0000  Your hero was recreated due to a fatal error. Please report this replay at |c00ffff00LegendsOfDota.com|r |c00ff0000if you notice any problems.|r")
  //call DisplayTimedTextToPlayer(p,0,0,20,"|c00ff0000  All spells cooldowns and effects were resetted.|r")
  set u=null
  set it=null
endfunction

function SaveHeroesTick takes nothing returns nothing
  local timer t=GetExpiredTimer()
  local integer h=GetHandleId(t)
  local unit u
  local item it
  local integer i=1
  local integer k
  local boolean missing=false
  loop
    if PlayerHaveHero[i] then
      set missing=false
      set u=udg_Hero[i]
      if u==null or GetUnitTypeId(u)<1 or GetHandleId(u)<1 then
        set missing=true
      endif
      
      set k=i*100
      if missing==false then//if hero there then
        //save hero id
        call SaveBoolean(hashtable019,h,k,true)
        call SaveInteger(hashtable019,h,k+80,GetUnitTypeId(u))
        //item info
        set it=UnitItemInSlot(u,0)
        call SaveInteger(hashtable019,h,k+1,GetItemTypeId(it))
        call SavePlayerHandle(hashtable019,h,k+1,GetItemPlayer(it))
        call SaveInteger(hashtable019,h,k+11,GetItemCharges(it))
        set it=UnitItemInSlot(u,1)
        call SaveInteger(hashtable019,h,k+2,GetItemTypeId(it))
        call SavePlayerHandle(hashtable019,h,k+2,GetItemPlayer(it))
        call SaveInteger(hashtable019,h,k+12,GetItemCharges(it))
        set it=UnitItemInSlot(u,2)
        call SaveInteger(hashtable019,h,k+3,GetItemTypeId(it))
        call SavePlayerHandle(hashtable019,h,k+3,GetItemPlayer(it))
        call SaveInteger(hashtable019,h,k+13,GetItemCharges(it))
        set it=UnitItemInSlot(u,3)
        call SaveInteger(hashtable019,h,k+4,GetItemTypeId(it))
        call SavePlayerHandle(hashtable019,h,k+4,GetItemPlayer(it))
        call SaveInteger(hashtable019,h,k+14,GetItemCharges(it))
        set it=UnitItemInSlot(u,4)
        call SaveInteger(hashtable019,h,k+5,GetItemTypeId(it))
        call SavePlayerHandle(hashtable019,h,k+5,GetItemPlayer(it))
        call SaveInteger(hashtable019,h,k+15,GetItemCharges(it))
        set it=UnitItemInSlot(u,5)
        call SaveInteger(hashtable019,h,k+6,GetItemTypeId(it))
        call SavePlayerHandle(hashtable019,h,k+6,GetItemPlayer(it))
        call SaveInteger(hashtable019,h,k+16,GetItemCharges(it))
        //save coordinates
        call SaveReal(hashtable019,h,k,GetUnitX(u))
        call SaveReal(hashtable019,h,k+1,GetUnitY(u))
        //save exp
        call SaveInteger(hashtable019,h,k+30,GetHeroXP(u))
      endif
      if missing and LoadBoolean(hashtable019,h,k) then
        call RecreateHeroIfMissed(i,h)
      endif
    endif
    
    set i=i+1
    if i==6 then
      set i=7
    endif
    exitwhen i>11
    
  endloop
  
  set u=null
  set it=null
  set t=null
endfunction

function SaveHeroes takes nothing returns nothing
  local timer t=CreateTimer()
  local integer h=GetHandleId(t)
  call TimerStart(t,1,true,function SaveHeroesTick)
  set t=null
endfunction

function DoubleHoldActs takes nothing returns nothing
  local trigger t=GetTriggeringTrigger()
  if GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER and GetIssuedOrderId()==851993 then
    call UnitAddType(GetTriggerUnit(),UNIT_TYPE_PEON)
    
    //call echo("added")
  endif
  call CleanTrigger(t)
  set t=null
endfunction

function DoubleHold takes nothing returns nothing
  local trigger t
  
  if GetIssuedOrderId()==851993 and LoadBoolean(hashtable019,GetHandleId(GetTriggeringTrigger()),GetHandleId(GetTriggerUnit()))==false then
    set t=CreateTrigger()
    call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_ISSUED_ORDER)
    call TriggerRegisterTimerEvent(t,0.1,false)
    call TriggerAddCondition(t,Condition(function DoubleHoldActs))
    call SaveBoolean(hashtable019,GetHandleId(GetTriggeringTrigger()),GetHandleId(GetTriggerUnit()),true)
    set t=null
  endif
  
  if GetIssuedOrderId()!=851993 and IsCourier(GetTriggerUnit())==false and IsUnitFamiliar(GetUnitTypeId(GetTriggerUnit()))==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_PEON)==true then
    call UnitRemoveType(GetTriggerUnit(),UNIT_TYPE_PEON)
    //call echo("removed")
  endif
  if GetIssuedOrderId()!=851993 and LoadBoolean(hashtable019,GetHandleId(GetTriggeringTrigger()),GetHandleId(GetTriggerUnit())) then
    call RemoveSavedBoolean(hashtable019,GetHandleId(GetTriggeringTrigger()),GetHandleId(GetTriggerUnit()))
  endif
endfunction

function ConvertItemData takes integer indexid, integer d_id, integer r_id, integer s_id, integer m_id, string IconPath, integer cooldown returns nothing
  set Item_Dummy[indexid]=d_id
  set Item_Real[indexid]=r_id
  set Item_SellerUnit[indexid]=s_id
  set Item_Mute[indexid]=m_id
  set Item_Icon[indexid]=IconPath
  set Item_Cooldown[indexid]=cooldown
endfunction

function InitItems takes nothing returns nothing
  local string s=""
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0FF','I0FG',0,0,"ReplaceableTextures\\CommandButtons\\BTNSelectHeroOn.blp",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02Q','I02O','h011','I00A',"ReplaceableTextures\\CommandButtons\\BTNBootsOfSpeed.blp",0)
  set indexid_BootsOfSpeed=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02S','I02P','h012','I0CA',"ReplaceableTextures\\CommandButtons\\BTNGlove.blp",0)
  set indexid_GlovesOfHaste=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02N','I02R','h013','I0CS',"ReplaceableTextures\\CommandButtons\\BTNBoots.blp",0)
  set indexid_BootsOfElvenskin=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02X','I02Y','h015','I0D4',"ReplaceableTextures\\CommandButtons\\BTNCirclet.blp",0)
  set indexid_CircletOfNobility=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02Z','I043','h016','I0CV',"ReplaceableTextures\\CommandButtons\\BTNBelt.blp",0)
  set indexid_BeltOfStrength=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I030','I044','h017','I0D2',"ReplaceableTextures\\CommandButtons\\BTNINV_ThrowingKnife_03.blp",0)
  set indexid_BladesOfAlacrity=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I031','I045','h018','I0D5',"ReplaceableTextures\\CommandButtons\\BTNClawsOfAttack.blp",0)
  set indexid_BladesOfAttack=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I032','I046','h019','I0CZ',"ReplaceableTextures\\CommandButtons\\BTNSteelMelee.blp",0)
  set indexid_Broadsword=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I033','I047','h01A','I0D7',"ReplaceableTextures\\CommandButtons\\BTNINV_Chest_Chain_12.blp",0)
  set indexid_Chainmail=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I034','I048','h01B','I0CX',"ReplaceableTextures\\CommandButtons\\BTNINV_Sword_19.blp",0)
  set indexid_Claymore=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I035','I049','h01C','I0CI',"ReplaceableTextures\\CommandButtons\\BTNFrostMourne.blp",0)
  set indexid_DemonEdge=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I036','I04A','h01D','I0CH',"ReplaceableTextures\\CommandButtons\\BTNINV_Weapon_Bow_06.blp",0)
  set indexid_Eaglehorn=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I037','I04B','h01E','I0CR',"ReplaceableTextures\\CommandButtons\\BTNEnchantedGemstone.blp",0)
  set indexid_EnergyBooster=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I038','I04C','h01F','I0CJ',"ReplaceableTextures\\CommandButtons\\BTNGauntletsOfOgrePower.blp",0)
  set indexid_GauntletOfStrength=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I039','I04D','h01G','I0DG',"ReplaceableTextures\\CommandButtons\\BTNGem.blp",0)
  set indexid_Gem=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0MS','I0MR',0,'I0MT',"ReplaceableTextures\\CommandButtons\\BTNGem.blp",0)
  set indexid_GemCourier=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03B','I04E','h01H','I0DA',"ReplaceableTextures\\CommandButtons\\BTNHelmutPurple.blp",0)
  set indexid_HelmOfIronWill=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03C','I04F','h01I','I0CQ',"ReplaceableTextures\\CommandButtons\\BTNPeriapt1.blp",0)
  set indexid_Hyperstone=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03D','I04G','h01J','I0CU',"ReplaceableTextures\\CommandButtons\\BTNNatureTouchGrow.blp",0)
  set indexid_IronwoodBranch=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03E','I04H','h01K','I0C7',"ReplaceableTextures\\CommandButtons\\BTNDaggerOfEscape.blp",12)
  set indexid_KelensDagger=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03E','I04I','h01K','I0DH',"ReplaceableTextures\\CommandButtons\\BTNDaggerOfEscape.blp",0)
  set indexid_DisabledKelensDagger=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03F','I04J','h01L','I0CM',"ReplaceableTextures\\CommandButtons\\BTNMantleOfIntelligence.blp",0)
  set indexid_MantleOfIntelligence=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03G','I04K','h01M','I0CD',"ReplaceableTextures\\CommandButtons\\BTNUndeadShrine.blp",0)
  set indexid_MaskOfDeath=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03H','I04L','h01N','I0CG',"ReplaceableTextures\\CommandButtons\\BTNSpiritWalkerMasterTraining.blp",0)
  set indexid_MesserschmidtReaver=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03I','I04M','h01O','I0D0',"ReplaceableTextures\\CommandButtons\\BTNHammer.blp",0)
  set indexid_MithrilHammer=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03J','I04N','h01P','I0CN',"ReplaceableTextures\\CommandButtons\\BTNStaffOfNegation.blp",0)
  set indexid_MysticStaff=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03K','I04O','h01Q','I0D8',"ReplaceableTextures\\CommandButtons\\BTNSpiritWalkerAdeptTraining.tga",0)
  set indexid_OgreAxe=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03L','I04P','h01R','I0CE',"ReplaceableTextures\\CommandButtons\\BTNINV_Misc_Cape_08.blp",0)
  set indexid_PlaneswalkerCloak=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03M','I04Q','h01S','I0DB',"ReplaceableTextures\\CommandButtons\\BTNINV_Chest_Plate13.blp",0)
  set indexid_PlateMail=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03N','I04R','h01T','I0CL',"ReplaceableTextures\\CommandButtons\\BTNUsedSoulGem.blp",0)
  set indexid_PointBooster=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03P','I04S','h01U','I0CY',"ReplaceableTextures\\CommandButtons\\BTNAlleriaFlute.blp",0)
  set indexid_Quarterstaff=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03Q','I04T','h01V','I0DI',"ReplaceableTextures\\CommandButtons\\BTNGoldRing.blp",0)
  set indexid_RingOfHealth=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03R','I04U','h01W','I0CW',"ReplaceableTextures\\CommandButtons\\BTNRingPurple.blp",0)
  set indexid_RingOfProtection=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03S','I04V','h01X','I0DJ',"ReplaceableTextures\\CommandButtons\\BTNRingSkull.blp",0)
  set indexid_RingOfRegeneration=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03T','I04W','h01Y','I0CP',"ReplaceableTextures\\CommandButtons\\BTNRobeOfTheMagi.blp",0)
  set indexid_RobeOfMagi=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03U','I04X','h01Z','I0CC',"ReplaceableTextures\\CommandButtons\\BTNStaffOfTeleportation.blp",0)
  set indexid_SacredRelic=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03V','I04Y','h020','I0C5',"ReplaceableTextures\\CommandButtons\\BTNSlippersOfAgility.blp",0)
  set indexid_SlippersOfAgility=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03W','I04Z','h021','I0DK',"ReplaceableTextures\\CommandButtons\\BTNSobiMask.blp",0)
  set indexid_SobiMask=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03X','I050','h022','I0D1',"ReplaceableTextures\\CommandButtons\\BTNWandOfCyclone.blp",0)
  set indexid_StaffOfWizardry=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03A','I051','h023','I0D9',"ReplaceableTextures\\CommandButtons\\BTNSteelArmor.blp",0)
  set indexid_StoutShield=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0KB','I0KA',0,'I0KC',"ReplaceableTextures\\CommandButtons\\BTNSteelArmor.blp",0)
  set indexid_StoutShieldRanged=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03Y','I052','h024','I0C9',"ReplaceableTextures\\CommandButtons\\BTNOrbofSlowness.blp",0)
  set indexid_UltimateOrb=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03Z','I053','h025','I0CK',"ReplaceableTextures\\CommandButtons\\BTNSoulGem.blp",0)
  set indexid_VitalityBooster=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I040','I054','h026','I0DL',"ReplaceableTextures\\CommandButtons\\BTNPeriapt.blp",0)
  set indexid_VoidStone=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I041','I055','h027','I0D6',"ReplaceableTextures\\CommandButtons\\BTNSteelRanged.blp",0)
  set indexid_javelin=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I00L','I0AV','h02B',0,"ReplaceableTextures\\CommandButtons\\BTNBottle0.blp",0)
  set indexid_Bottle0Shop=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I05E','I0AM',0,'I0DN',"ReplaceableTextures\\CommandButtons\\BTNBottle0.blp",0)
  set indexid_Bottle0=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AU','I0AN',0,'I0DO',"ReplaceableTextures\\CommandButtons\\BTNBottle1.blp",0)
  set indexid_bottle1=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AS','I0AO',0,'I0DP',"ReplaceableTextures\\CommandButtons\\BTNBottle2.blp",0)
  set indexid_bottle2=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AT','I0AP',0,'I0DQ',"ReplaceableTextures\\CommandButtons\\BTNBottle3.blp",0)
  set indexid_bottle3=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0GW','I0GY',0,'I0H3',"ReplaceableTextures\\CommandButtons\\BTNBottle_Illusion.blp",0)
  set indexid_BottleIllusion=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0H2','I0GX',0,'I0DR',"ReplaceableTextures\\CommandButtons\\BTNBottle_Regeneration.blp",0)
  set indexid_BottleRegen=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0GV','I0H1',0,'I0H4',"ReplaceableTextures\\CommandButtons\\BTNBottle_Haste.blp",0)
  set indexid_BottleHaste=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AR','I0H0',0,'I0H6',"ReplaceableTextures\\CommandButtons\\BTNBottle_DoubleDamage.blp",0)
  set indexid_BottleDD=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AQ','I0GZ',0,'I0H5',"ReplaceableTextures\\CommandButtons\\BTNBottle_Invisibility.blp",0)
  set indexid_BottleInvis=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0GD','I0GC','h074','I0GE',"ReplaceableTextures\\CommandButtons\\BTNWand.blp",0)
  set indexid_MagicStick=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0HC','I0HB',0,'I0HA',"ReplaceableTextures\\CommandButtons\\BTNStarWand.blp",0)
  set indexid_MagicWand=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0HT','I0HR','h07W','I0HV',"ReplaceableTextures\\CommandButtons\\BTNOrcMeleeUpTwo.blp",0)
  set indexid_QuellingBlade=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0HU','I0HP',0,'I0HW',"ReplaceableTextures\\CommandButtons\\BTNOrcMeleeUpTwo.blp",0)
  set indexid_QuellingBladeRanged=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0N4','I0N3',0,'I0N5',"ReplaceableTextures\\CommandButtons\\BTNPoisonBlade.blp",30)
  set indexid_corruptor=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0N7','I0N6',0,'I0N8',"ReplaceableTextures\\CommandButtons\\BTNPoisonBlade.blp",30)
  set indexid_corruptorranged=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0J7','I0J6','h083','I0J8',"ReplaceableTextures\\CommandButtons\\BTNAmulet.blp",0)
  set indexid_TalismanOfEvasion=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0JJ','I0JI','h087','I0JK',"ReplaceableTextures\\CommandButtons\\BTNGreenStaff.blp",30)
  set indexid_GhostScepter=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0MA','I0M9','h0CM','I0MB',"ReplaceableTextures\\CommandButtons\\BTNOrbOfVenom.blp",0)
  set indexid_OrbOfVenom=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0MD','I0ME',0,'I0MC',"ReplaceableTextures\\CommandButtons\\BTNOrbOfVenom.blp",0)
  set indexid_OrbOfVenomRanged=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I057','I05C','h02A','ITGB',"ReplaceableTextures\\CommandButtons\\BTNAncientOfTheEarth.blp",0)
  set indexid_Tango=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'INTD','INTG',0,0,"ReplaceableTextures\\CommandButtons\\BTNAncientOfTheEarth.blp",0)
  set indexid_TangoSec=ITC
  
  set ITC=ITC+1
  call ConvertItemData(ITC,'I042','I05D','h028','INCP',"ReplaceableTextures\\CommandButtons\\BTNLesserClarityPotion.blp",0)
  set indexid_ClarityPotion=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0HO','I0HN','h07V',0,"ReplaceableTextures\\CommandButtons\\BTNVialFull.blp",0)
  set indexid_ghostpotion=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I056','I05F','h029','INHS',"ReplaceableTextures\\CommandButtons\\BTNHealingSalve.blp",0)
  set indexid_HealingSalve=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I058','I05G','h02C',0,"ReplaceableTextures\\CommandButtons\\BTNSentryWard.blp",0)
  set indexid_ObserverWards=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I059','I05H','h02D',0,"ReplaceableTextures\\CommandButtons\\BTNBlueSentryWard.blp",0)
  set indexid_SentryWards=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I05A','I05I','h02E',0,"ReplaceableTextures\\CommandButtons\\BTNScrollUber.blp",0)
  set indexid_ScrollOfTownPortal=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I05B','I05J','h02F',0,"ReplaceableTextures\\CommandButtons\\BTNCritterChicken.blp",0)
  set indexid_AnimalCourier=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0B0','I0B1',0,0,"ReplaceableTextures\\CommandButtons\\BTNCheese.blp",0)
  set indexid_Cheese=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0GG','I0GF','h075',0,"ReplaceableTextures\\CommandButtons\\BTNPotionOfDivinity.blp",30)
  set OX7=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0GI','I0GH','h076',0,"ReplaceableTextures\\CommandButtons\\BTNDustOfAppearance.blp",60)
  set indexid_dustofappearance=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0KT','I0KS','h0B9',0,"ReplaceableTextures\\CommandButtons\\BTNWandOfManaSteal.blp",0)
  set indexid_wandofillusions=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0NF','I0NG','h0D3',0,"ReplaceableTextures\\CommandButtons\\BTNSmokePotion.blp",90)
  set indexid_Smoke=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I061','I062',0,'I01J',"ReplaceableTextures\\CommandButtons\\BTNOrbOfFire.blp",0)
  set indexid_Perseverance=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I064','I063',0,'I01K',"ReplaceableTextures\\CommandButtons\\BTNINV_Helmet_17.blp",0)
  set indexid_HeaddressOfRejuvenation=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I065','I066',0,'I01L',"ReplaceableTextures\\CommandButtons\\BTNThoriumArmor.blp",0)
  set indexid_NathrezimBuckler=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I068','I067',0,'I01M',"ReplaceableTextures\\CommandButtons\\BTNRingVioletSpider.tga",0)
  set indexid_RingOfBasilius=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I069','I06A',0,'I0C6',"ReplaceableTextures\\CommandButtons\\BTNRingVioletSpider.tga",0)
  set indexid_RingOfBasiliusHero=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I06C','I06B',0,'I01P',"ReplaceableTextures\\CommandButtons\\BTNAbility_Rogue_Sprint.blp",0)
  set indexid_bootsOfTravel=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03O','I02T',0,'I01R',"ReplaceableTextures\\CommandButtons\\BTNWirtsLegGreen.blp",0)
  set indexid_PowerTreadsAgility=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02U','I05Y',0,'I01Q',"ReplaceableTextures\\CommandButtons\\BTNWirtsLeg.blp",0)
  set indexid_PowerTreadsStrength=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I060','I05Z',0,'I01S',"ReplaceableTextures\\CommandButtons\\BTNWirtsLegBlue.blp",0)
  set indexid_PowerTreadsIntelligence=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I06E','I06D',0,'I01T',"ReplaceableTextures\\CommandButtons\\BTNGoldGloves.blp",100)
  set indexid_HandOfMidas=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0NO','I0NN',0,'I0NP',"ReplaceableTextures\\CommandButtons\\BTNGoldGloves.blp",100)
  set indexid_HandOfMidasCourier=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I06G','I06F',0,'I01U',"ReplaceableTextures\\CommandButtons\\BTNINV_Mace_10.blp",0)
  set indexid_OblivionStaff=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I06I','I06H',0,'I01V',"ReplaceableTextures\\CommandButtons\\BTNRunedBracers.blp",0)
  set indexid_Bracer=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I06K','I06J',0,'I01W',"ReplaceableTextures\\CommandButtons\\BTNRevenant.blp",0)
  set indexid_WraithBand=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I06M','I06L',0,'I01X',"ReplaceableTextures\\CommandButtons\\BTNTalisman.tga",0)
  set indexid_NullTalisman=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I08F','I08G',0,'I01Y',"ReplaceableTextures\\CommandButtons\\BTNINV_Sword_10.blp",0)
  set indexid_Yasha=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I08I','I08H',0,'I01Z',"ReplaceableTextures\\CommandButtons\\BTNJapaneseSword.blp",0)
  set indexid_Sange=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I08J','I08K',0,'I020',"ReplaceableTextures\\CommandButtons\\BTNINV_Hammer_10.blp",0)
  set indexid_CraniumBasher=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I08M','I08L',0,'I0C8',"ReplaceableTextures\\CommandButtons\\BTNINV_Hammer_10.blp",0)
  set indexid_CraniumBasherRanged=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I08N','I08O',0,'I021',"ReplaceableTextures\\CommandButtons\\BTNINV_Chest_Plate06.blp",17)
  set indexid_BladeMail=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I08Q','I08P',0,'I022',"ReplaceableTextures\\CommandButtons\\BTNStormHammer.blp",0)
  set indexid_Maelstrom=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I08S','I08R',0,'I023',"ReplaceableTextures\\CommandButtons\\BTNINV_Sword_11.blp",12)
  set indexid_DiffusalBlade=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0JB','I0J9',0,'I0JD',"ReplaceableTextures\\CommandButtons\\BTNDiffusal2.blp",12)
  set indexid_DiffusalBlade_upg=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0EW','I0EV',0,'I0EX',"ReplaceableTextures\\CommandButtons\\BTNINV_Sword_11.blp",0)
  set indexid_DiffusalBlade_empty=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0JC','I0JA',0,'I0JE',"ReplaceableTextures\\CommandButtons\\BTNDiffusal2.blp",0)
  set indexid_DiffusalBlade_upg_empty=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I08U','I08T',0,'I024',"ReplaceableTextures\\CommandButtons\\BTNINV_Helmet_13.blp",300)
  set indexid_HelmOfTheDominator=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I08W','I08V',0,'I0CO',"ReplaceableTextures\\CommandButtons\\BTNINV_Helmet_13.blp",0)
  set indexid_HelmOfTheDominatorCourier=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I08X','I08Y',0,'I025',"ReplaceableTextures\\CommandButtons\\BTNHelmOfValor.blp",0)
  set indexid_MaskOfMadness=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I090','I08Z',0,'I026',"ReplaceableTextures\\CommandButtons\\BTNStaffofpurification.blp",30)
  set indexid_Eul=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I092','I091',0,'I027',"ReplaceableTextures\\CommandButtons\\BTNPhilosophersStone.blp",0)
  set indexid_SoulBooster=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I094','I093',0,'I028',"ReplaceableTextures\\CommandButtons\\BTNSpellShieldAmulet.blp",45)
  set indexid_Mekansm=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I096','I095',0,'I029',"ReplaceableTextures\\CommandButtons\\BTNSpell_Holy_BlessingOfStrength.blp",0)
  set indexid_SangeAndYasha=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I098','I097',0,'I02A',"ReplaceableTextures\\CommandButtons\\BTNAbility_Gouge.blp",0)
  set indexid_Desolator=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09A','I099',0,'I02B',"ReplaceableTextures\\CommandButtons\\BTNINV_ThrowingAxe_06.blp",0)
  set indexid_BattleFury=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09B','I09C',0,'I02C',"ReplaceableTextures\\CommandButtons\\BTNThoriumMelee.blp",0)
  set indexid_Crystalys=ITC
  set s="ReplaceableTextures\\CommandButtons\\BTNRodOfNecromancy.blp"
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0G2','I0FZ',0,'I0G8',s,80)
  set indexid_BlackKingBar10=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0G6','I0G0',0,'I0G9',s,75)
  set indexid_BlackKingBar09=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09E','I0FY',0,'I0G7',s,70)
  set indexid_BlackKingBar08=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0G5','I0FS',0,'I02D',s,65)
  set indexid_BlackKingBar07=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0G3','I09D',0,'I0GB',s,60)
  set indexid_BlackKingBar06=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0G4','I0G1',0,'I0GA',s,55)
  set indexid_BlackKingBar05=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0P6','I0P8',0,'I0P7',s,50)
  set indexid_BlackKingBar04=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AX','I0AW',0,0,"ReplaceableTextures\\CommandButtons\\BTNArcaniteArmor.blp",0)
  set indexid_Aegis=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09G','I09F',0,'I02E',"ReplaceableTextures\\CommandButtons\\BTNINV_ThrowingAxe_02.blp",35)
  set indexid_MantaStyle=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0MV','I0MU',0,'I0MW',"ReplaceableTextures\\CommandButtons\\BTNINV_ThrowingAxe_02.blp",50)
  set indexid_MantaStyleRanged=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09I','I09H',0,'I02F',"ReplaceableTextures\\CommandButtons\\BTNLothars.blp",0)
  set indexid_LotharsEdge=ITC
  set s="ReplaceableTextures\\CommandButtons\\BTNINV_Wand_06.blp"
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09K','I09M',0,'I01G',s,35)
  set indexid_Dagon1=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09J','I09P',0,'I02G',s,30)
  set indexid_Dagon2=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09Q','I09N',0,'I0DC',s,25)
  set indexid_Dagon3=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09S','I09O',0,'I0DD',s,20)
  set indexid_Dagon4=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09R','I09L',0,'I0D3',s,15)
  set indexid_Dagon5=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09U','I09T',0,'I02H',"ReplaceableTextures\\CommandButtons\\BTNNecromancerAdept.blp",90)
  set indexid_Necronomicon1=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09V','I09X',0,'I02I',"ReplaceableTextures\\CommandButtons\\BTNBookOfTheDead.blp",90)
  set indexid_Necronomicon2=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I09W','I09Y',0,'I02J',"ReplaceableTextures\\CommandButtons\\BTNNecromancerMaster.blp",90)
  set indexid_Necronomicon3=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0A0','I09Z',0,'I0BO',"ReplaceableTextures\\CommandButtons\\BTNOrb of Water.blp",0)
  set indexid_LinkensSphere=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0HK','I0HJ',0,'I0HL',"ReplaceableTextures\\CommandButtons\\BTNOrb of Water.blp",0)
  set indexid_LinkenDummy=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0A2','I0A1',0,'I0BP',"ReplaceableTextures\\CommandButtons\\BTNINV_Sword_25.blp",0)
  set indexid_DivineRapier=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0LI','I0LJ',0,'I0LK',"ReplaceableTextures\\CommandButtons\\BTNINV_Sword_25.blp",0)
  set indexid_DivineRapierFree=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0A4','I0A3',0,'I0BQ',"ReplaceableTextures\\CommandButtons\\BTNINV_Weapon_Crossbow_10.blp",0)
  set indexid_Buriza=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0A6','I0A5',0,'I0BR',"ReplaceableTextures\\CommandButtons\\BTNINV_Weapon_Halberd_10.blp",0)
  set indexid_MKBOn=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0K8','I0K7',0,'I0K9',"ReplaceableTextures\\CommandButtons\\BTNINV_Weapon_Halberd_10.blp",0)
  set indexid_MKBOff=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0A7','I0A8',0,'I0BS',"ReplaceableTextures\\CommandButtons\\BTNTransmute.blp",0)
  set indexid_RadianceOn=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0KQ','I0KP',0,'I0KR',"ReplaceableTextures\\CommandButtons\\BTNTransmute.blp",0)
  set indexid_RadianceOff=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AA','I0A9',0,'I0BT',"ReplaceableTextures\\CommandButtons\\BTNHeartOfAszune.blp",0)
  set indexid_HeartOfTarrasque=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AA','I0KL',0,'I0KM',"ReplaceableTextures\\CommandButtons\\BTNHeartOfAszune.blp",0)
  set indexid_DisabledHeartOfTarrasque=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AC','I0AB',0,'I0BU',"ReplaceableTextures\\CommandButtons\\BTNHornOfDoom.blp",35)
  set indexid_Satanic=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AD','I0AE',0,'I0BV',"ReplaceableTextures\\CommandButtons\\BTNIceShard.blp",0)
  set indexid_EyeOfSkadi=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AG','I0AF',0,'I0CT',"ReplaceableTextures\\CommandButtons\\BTNIceShard.blp",0)
  set indexid_EyeOfSkadiRanged=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AH','I0AI',0,'I0BW',"ReplaceableTextures\\CommandButtons\\BTNINV_ThrowingKnife_04.blp",0)
  set indexid_Butterfly=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0B8','I0AY',0,'I00B',"ReplaceableTextures\\CommandButtons\\BTNINV_Wand_05.blp",0)
  set indexid_AghanimBasic=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AK','I0AJ',0,'I0BX',"ReplaceableTextures\\CommandButtons\\BTNHeartOfSearinox.blp",210)
  set indexid_RefresherOrb=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07K','I0AL',0,'I0BY',"ReplaceableTextures\\CommandButtons\\BTNINV_Sword_09.blp",35)
  set indexid_GuinsooHex=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0BB','I0BA',0,'I0BZ',"ReplaceableTextures\\CommandButtons\\BTNAdvancedUnholyArmor.blp",0)
  set indexid_Vanguard=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0LE','I0LC',0,'I0LD',"ReplaceableTextures\\CommandButtons\\BTNAdvancedUnholyArmor.blp",0)
  set indexid_VanguardRanged=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0BC','I0BD',0,'I00C',"ReplaceableTextures\\CommandButtons\\BTNArcaneRing.blp",33)
  set indexid_ArcaneRing=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0BF','I0BE',0,'I0C0',"ReplaceableTextures\\CommandButtons\\BTNThunderMallet.blp",35)
  set indexid_Mjollnir=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I014','I01D',0,0,"ReplaceableTextures\\CommandButtons\\BTNRavenForm.blp",0)
  set indexid_FlyingCourier=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0BH','I0BG',0,'I0C1',"ReplaceableTextures\\CommandButtons\\BTNCloakOfFlames.blp",0)
  set indexid_VladmirsOffering=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0BI','I0BJ',0,'I0C2',"ReplaceableTextures\\CommandButtons\\BTNINV_Chest_Chain_14.blp",0)
  set indexid_AssaultCuirass=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0BL','I0BK',0,'I0C3',"ReplaceableTextures\\CommandButtons\\BTNINV_Misc_Gem_Bloodstone_02.blp",300)
  set indexid_bloodstone=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0BN','I0BM',0,'I0C4',"ReplaceableTextures\\CommandButtons\\BTNHoodOfCunning.blp",0)
  set indexid_HoodOfDefiance=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I00S','I00M',0,'I01C',"ReplaceableTextures\\CommandButtons\\BTNImprovedUnholyStrength.blp",0)
  set indexid_ArmletOn=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I00T','I00Q',0,'I01E',"ReplaceableTextures\\CommandButtons\\BTNUnholyStrength.blp",0)
  set indexid_ArmletOff=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I00V','I00N',0,'I01F',"ReplaceableTextures\\CommandButtons\\BTNImprovedUnholyStrength.blp",0)
  set indexid_ArmletOnCourier=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I00W','I00R',0,'I0DE',"ReplaceableTextures\\CommandButtons\\BTNUnholyStrength.blp",0)
  set indexid_ArmletOffCourier=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I00X','I00Z',0,'I0CF',"ReplaceableTextures\\CommandButtons\\BTNAdvancedMoonArmor.blp",30)
  set indexid_ShivasGuard=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I00Y','I010',0,'I0DF',"ReplaceableTextures\\CommandButtons\\BTNAdvancedMoonArmor.blp",0)
  set indexid_ShivasGuardCourier=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I013','I012',0,'I0CB',"ReplaceableTextures\\CommandButtons\\BTNStaffOfSilence.blp",18)
  set indexid_Orchid=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0GK','I0GJ',0,'I0GL',"ReplaceableTextures\\CommandButtons\\BTNPhaseBoots.blp",0)
  set indexid_PhaseBoots=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0HG','I0HI',0,'I0HH',"ReplaceableTextures\\CommandButtons\\BTNForceStaff.blp",20)
  set indexid_ForceStaff=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0I0','I0K6',0,'I0I2',"ReplaceableTextures\\CommandButtons\\BTNPipeOfInsight.blp",25)
  set indexid_Pipe=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0JG','I0JF',0,'I0JH',"ReplaceableTextures\\CommandButtons\\BTNImprovedUnholyArmor.blp",0)
  set indexid_PoormansShield=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0KD','I0KF',0,'I0KE',"ReplaceableTextures\\CommandButtons\\BTNImprovedUnholyArmor.blp",0)
  set indexid_PoormansShieldRanged=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0KX','I0KY',0,'I0KZ',"ReplaceableTextures\\CommandButtons\\BTNUrnOfKelThuzad.blp",8)
  set indexid_UrnOfShadows=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0LG','I0LF',0,'I0LH',"ReplaceableTextures\\CommandButtons\\BTNUrnOfKelThuzad.blp",0)
  set indexid_UrnOfShadowsEmpty=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0LP','I0LL',0,'I0LQ',"ReplaceableTextures\\CommandButtons\\BTNSoulRing.blp",25)
  set indexid_SoulRing=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0LR','I0LT',0,'I0LS',"ReplaceableTextures\\CommandButtons\\BTNGhostBlade.blp",30)
  set indexid_EtherealBlade=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0MJ','I0MI',0,'I0MK',"ReplaceableTextures\\CommandButtons\\BTNArcaneBoots.blp",55)
  set indexid_ArcaneBoots=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0N1','I0N0',0,'I0N2',"ReplaceableTextures\\CommandButtons\\BTNMedalionOfCourage.blp",7)
  set indexid_MedallionOfCourage=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0ND','I0NE',0,'I0NC',"ReplaceableTextures\\CommandButtons\\BTNJanggo.blp",30)
  set indexid_janggo=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0NL','I0NK',0,'I0NM',"ReplaceableTextures\\CommandButtons\\BTNJanggo.blp",0)
  set indexid_janggoempty=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0O2','I0O3',0,'I0O4',"ReplaceableTextures\\CommandButtons\\BTNBoneChimes.blp",30)
  set indexid_VeilOfDiscord=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0OC','I0OE',0,'I0OD',"ReplaceableTextures\\CommandButtons\\BTNBoneChimes.blp",30)
  set indexid_BladeOfTheReaper=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0OF','I0OG',0,'I0OH',"ReplaceableTextures\\CommandButtons\\BTNTranquilBoots.blp",0)
  set indexid_TranquilBoots=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0OJ','I0OI',0,'I0OK',"ReplaceableTextures\\CommandButtons\\BTNTranquilBoots.blp",0)
  set indexid_TranquilBootsBroken=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0OM','I0OL',0,'I0ON',"ReplaceableTextures\\CommandButtons\\BTNWitchDoctorMaster.blp",20)
  set indexid_RodOfAtos=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0OP','I0OO',0,'I0OQ',"ReplaceableTextures\\CommandButtons\\BTNPendantOfMana.blp",20)
  set indexid_MoonShard=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0OU','I0OV',0,'I0OW',"ReplaceableTextures\\CommandButtons\\BTNHalberd.blp",30)
  set indexid_HeavensHalberd=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0OY','I0OX',0,'I0OZ',"ReplaceableTextures\\CommandButtons\\BTNAnnihilator.blp",60)
  set indexid_AbyssalBlade=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0P0','I0P1',0,'I0P2',"ReplaceableTextures\\CommandButtons\\BTNRingJadeFalcon.blp",0)
  set indexid_RingOfAquila=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0P3','I0P4',0,'I0P5',"ReplaceableTextures\\CommandButtons\\BTNRingJadeFalcon.blp",0)
  set indexid_RingOfAquilaHero=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h02G',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h086',0,"",0)
  set s="ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
  set ITC=ITC+1
  call ConvertItemData(ITC,'I05L','I05R','h02H','I0DS',s,0)
  set indexid_RecipeHeaddressOfRejuvenation=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I05M','I05S','h02I','I0DT',s,0)
  set indexid_RecipeNethrezimBuckler=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h02J',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I05O','I05T','h02K','I0DU',s,0)
  set indexid_RecipeBootsOfTravel=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h014',0,s,0)
  set indexid_RecipePowerTreads=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I05P','I05U','h02L','I0DW',s,0)
  set indexid_RecipeHandOfMidas=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h02M',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I05K','I05V','h02N','I0DX',s,0)
  set indexid_RecipeBracer=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I05N','I05W','h02O','I0DY',s,0)
  set indexid_RecipeWraithBand=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I05Q','I05X','h02P','I0DZ',s,0)
  set indexid_RecipeNullTalisman=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I06N','I06O','h02Q','I0E0',s,0)
  set indexid_RecipeYasha=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I06Q','I06P','h02R','I0E1',s,0)
  set indexid_RecipeSange=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I06R','I06S','h02S','I0E2',s,0)
  set indexid_RecipeCraniumBasher=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h02T',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I06W','I06V','h02U','I0E4',s,0)
  set indexid_RecipeMaelstrom=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I06X','I06Y','h02V','I0E5',s,0)
  set indexid_RecipeDiffusalBlade=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h02W',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I070','I06Z','h02X','I0E6',s,0)
  set indexid_RecipeMaskOfMadness=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I071','I072','h02Y','I0E7',s,0)
  set indexid_RecipeEul=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h02Z',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I074','I073','h030','I0E8',s,0)
  set indexid_RecipeMekansm=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h031',0,"",0)
  set indexid_RecipeSangeAndYasha=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I076','I07V','h032','I0EA',s,0)
  set indexid_RecipeDesolator=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h033',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I077','I07W','h034','I0EB',s,0)
  set indexid_RecipeCrystalys=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I078','I07X','h035','I0EC',s,0)
  set indexid_RecipeBKB=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I079','I07Y','h036','I0ED',s,0)
  set indexid_RecipeMantaStyle=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07A',0,'h037','I0EE',s,0)
  set indexid_RecipeLotharsEdge=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07B','I080','h038','I0EF',s,0)
  set indexid_RecipeDagon=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07C','I081','h039','I0EG',s,0)
  set indexid_RecipeNecronomicon=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07D','I082','h03A','I0EH',s,0)
  set indexid_RecipeLinken=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h03C',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07E','I083','h03D','I0EI',s,0)
  set indexid_RecipeBuriza=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h03E',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07G','I07F','h03F','I0EJ',s,0)
  set indexid_RecipeRadiance=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07H','I084','h03G','I0EK',s,0)
  set indexid_RecipeHeartOfTarrasque=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07O','I085','h03H','I0EL',s,0)
  set indexid_RecipeSatanic=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h03I',0,"",0)
  set indexid_RecipeEyeOfSkadi=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h03J',0,"",0)
  set indexid_RecipeButterfly=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h03K',0,"",0)
  set indexid_RecipeAghanim=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07J','I088','h03L','I0EO',s,0)
  set indexid_RecipeRefresherOrb=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h03M',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h03N',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07M','I089','h03O','I0EP',s,0)
  set indexid_RecipeArcaneRing=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07P','I08A','h03Q','I0EQ',s,0)
  set indexid_RecipeFlyingCourier=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07Q','I08B','h03R','I0ER',s,0)
  set indexid_RecipeVladmirOffering=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07R','I08C','h03S','I0ES',s,0)
  set indexid_RecipeAssaultCuirass=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h03T',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h03U',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07S','I08D','h03V','I0ET',s,0)
  set indexid_RecipeArmlet=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07T','I08E','h03W','I0EU',s,0)
  set indexid_RecipeShivasGuard=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h079',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0H8','I0H7','h07S','I0H9',s,0)
  set indexid_RecipeMagicWand=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0HD','I0HF','h07T','I0HE',s,0)
  set indexid_RecipeForceStaff=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0HX','I0HZ','h07X','I0HY',s,0)
  set indexid_RecipePipe=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I07L','I0KN','h03P','I0KO',s,0)
  set indexid_RecipeMjollnir=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0KW','I0KV','h0BA','I0KU',s,0)
  set indexid_RecipeUrnOfShadows=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0LM','I0LN','h0BQ','I0LO',s,0)
  set indexid_RecipeSoulRing=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0N9','I0NA','h0D1','I0NB',s,0)
  set indexid_RecipeJanggo=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0NH','I0NI','h0CY','I0NJ',s,0)
  set indexid_RecipeMedallion=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0O5','I0O6','h0DD','I0O7',s,0)
  set indexid_RecipeVeilOfDiscord=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0OB','I0OA','h03X','I0O9',s,0)
  set indexid_RecipeOrchid=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h0DT',0,"",0)
  set indexid_RecipeBladeOfReaper=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h0DU',0,"",0)
  set indexid_RecipeTranquilBoots=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h0E9',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h0EA',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,0,0,'h0EC',0,"",0)
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0P9','I0PB','h0EI','I0PA',"ReplaceableTextures\\CommandButtons\\BTNPendantOfMana.blp",0)
  set indexid_ShadowAmulet=ITC
  set s="ReplaceableTextures\\CommandButtons\\BTNINV_Wand_05.blp"
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0AZ','I011',0,'I0EY',s,0)
  set indexid_AghanimFurion=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I00F','I00D',0,'I0EZ',s,0)
  set indexid_AghanimKotL=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I018','I009',0,'I0F0',s,0)
  set indexid_AghanimLeshrak=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I019','I005',0,'I0F6',s,0)
  set indexid_AghanimLich=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I01A','I00G',0,'I0F1',s,0)
  set indexid_AghanimLina=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I01B','I004',0,'I0F2',s,0)
  set indexid_AghanimLion=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I01H','I003',0,'I0F3',s,0)
  set indexid_AghanimLucifer=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I01I','I002',0,'I0F5',s,0)
  set indexid_AghanimLuna=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02K','I001',0,'I0F4',s,0)
  set indexid_AghanimNecro=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02L','I00I',0,'I0FE',s,0)
  set indexid_AghanimOgre=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0B2','I00H',0,'I0F9',s,0)
  set indexid_AghanimPugna=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0B3','I00P',0,'I0FA',s,0)
  set indexid_AghanimQoP=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0B4','I00U',0,'I0F7',s,0)
  set indexid_AghanimRhasta=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0B7','I000',0,'I0FD',s,0)
  set indexid_AghanimCM=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0B6','I016',0,'I0FC',s,0)
  set indexid_AghanimVeno=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0B5','I017',0,'I0FB',s,0)
  set indexid_AghanimWD=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0B9','I00O',0,'I0F8',s,0)
  set indexid_AghanimZeus=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0J5','I0IT',0,'I0IJ',s,0)
  set indexid_AghanimSniper=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0IV','I0IU',0,'I0I9',s,0)
  set indexid_AghanimClockwerk=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0IW','I0IS',0,'I0II',s,0)
  set indexid_AghanimVS=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0IX','I0IR',0,'I0IA',s,0)
  set indexid_AghanimJuggernaut=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0IY','I0IQ',0,'I0IH',s,0)
  set indexid_AghanimChaosKnight=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0IZ','I0IK',0,'I0IG',s,0)
  set indexid_AghanimChen=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0J0','I0IL',0,'I0IF',s,0)
  set indexid_AghanimNightstalker=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0J1','I0IM',0,'I0IE',s,0)
  set indexid_AghanimJakiro=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0J2','I0IP',0,'I0ID',s,0)
  set indexid_AghanimSandKing=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0J3','I0IO',0,'I0IC',s,0)
  set indexid_AghanimHuskar=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0J4','I0IN',0,'I0IB',s,0)
  set indexid_AghanimInvoker=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0I6','I0I7',0,'I0I8',s,0)
  set indexid_AghanimPanda=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0JZ','I0JS',0,'I0JR',s,0)
  set indexid_aghanimPudge=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0K0','I0JT',0,'I0JL',s,0)
  set indexid_AghanimWR=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0K1','I0JU',0,'I0JM',s,0)
  set indexid_AghanimVoid=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0K2','I0JW',0,'I0JN',s,0)
  set indexid_AghanimSpiritbreaker=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0K3','I0JV',0,'I0JQ',s,0)
  set indexid_AghanimBane=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0K4','I0JY',0,'I0JP',s,0)
  set indexid_AghanimAbaddon=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0K5','I0JX',0,'I0JO',s,0)
  set indexid_AghanimDazzle=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0KI','I0KH',0,'I0KJ',s,0)
  set indexid_AghanimTechies=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0L4','I0L5',0,'I0L8',s,0)
  set indexid_AghanimZombie=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0L3','I0L0',0,'I0L9',s,0)
  set indexid_AghanimAxe=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0L2','I0L7',0,'I0LA',s,0)
  set indexid_AghanimES=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0LU','I0LV',0,'I0LW',s,0)
  set indexid_AghanimPuck=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0M1','I0M0',0,'I0M2',s,0)
  set indexid_AghanimWL=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0M5','I0M4',0,'I0M3',s,0)
  set indexid_AghanimRazor=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0M6','I0M7',0,'I0M8',s,0)
  set indexid_AghanimViper=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0MF','I0MG',0,'I0MH',s,0)
  set indexid_AghanimTiny=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0MM','I0ML',0,'I0MN',s,0)
  set indexid_AghanimOD=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0MO','I0MP',0,'I0MQ',s,0)
  set indexid_AghanimEnchantress=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0NQ','I0NR',0,'I0NS',s,0)
  set indexid_AghanimDS=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0NT','I0NU',0,'I0NV',s,0)
  set indexid_AghanimGyro=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0PG','I0PH',0,'I0PI',s,0)
  set indexid_aghanimSilencer=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0PJ','I0PK',0,'I0PL',s,0)
  set indexid_aghanimAA=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0PP','I0PQ',0,'I0PR',s,0)
  set indexid_aghanimOmni=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0PS','I0PT',0,'I0PU',s,0)
  set indexid_aghanimSkywrath=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0PW','I0PV',0,'I0PX',s,0)
  set indexid_aghanimRubick=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0PZ','I0PY',0,'I0Q0',s,0)
  set indexid_aghanimEnigma=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0Q2','I0Q3',0,'I0Q1',s,0)
  set indexid_aghanimDisruptor=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0NW','I0NX',0,'I0NY',s,0)
  set indexid_AghanimMeepo=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0NZ','I0O0',0,'I0O1',s,0)
  set indexid_AghanimBeastmaster=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0OR','I0OS',0,'I0OT',s,0)
  set indexid_AghanimVisage=ITC
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03A','I051','h08K','I0D9',"ReplaceableTextures\\CommandButtons\\BTNSteelArmor.blp",0)
  set MK7[ITC]=indexid_StoutShield
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03Y','I052','h08X','I0C9',"ReplaceableTextures\\CommandButtons\\BTNOrbofSlowness.blp",0)
  set MK7[ITC]=indexid_UltimateOrb
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02S','I02P','h08S','I0CA',"ReplaceableTextures\\CommandButtons\\BTNGlove.blp",0)
  set MK7[ITC]=indexid_GlovesOfHaste
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02N','I02R','h08P','I0CS',"ReplaceableTextures\\CommandButtons\\BTNBoots.blp",0)
  set MK7[ITC]=indexid_BootsOfElvenskin
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02Z','I043','h08Q','I0CV',"ReplaceableTextures\\CommandButtons\\BTNBelt.blp",0)
  set MK7[ITC]=indexid_BeltOfStrength
  set ITC=ITC+1
  call ConvertItemData(ITC,'I031','I045','h08T','I0D5',"ReplaceableTextures\\CommandButtons\\BTNClawsOfAttack.blp",0)
  set MK7[ITC]=indexid_BladesOfAttack
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03B','I04E','h08N','I0DA',"ReplaceableTextures\\CommandButtons\\BTNHelmutPurple.blp",0)
  set MK7[ITC]=indexid_HelmOfIronWill
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03E','I04H','h08W','I0C7',"ReplaceableTextures\\CommandButtons\\BTNDaggerOfEscape.blp",18)
  set MK7[ITC]=indexid_KelensDagger
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03G','I04K','h08O','I0CD',"ReplaceableTextures\\CommandButtons\\BTNUndeadShrine.blp",0)
  set MK7[ITC]=indexid_MaskOfDeath
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03P','I04S','h08U','I0CY',"ReplaceableTextures\\CommandButtons\\BTNAlleriaFlute.blp",0)
  set MK7[ITC]=indexid_Quarterstaff
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03Q','I04T','h08G','I0DI',"ReplaceableTextures\\CommandButtons\\BTNGoldRing.blp",0)
  set MK7[ITC]=indexid_RingOfHealth
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03S','I04V','h08L','I0DJ',"ReplaceableTextures\\CommandButtons\\BTNRingSkull.blp",0)
  set MK7[ITC]=indexid_RingOfRegeneration
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03T','I04W','h08R','I0CP',"ReplaceableTextures\\CommandButtons\\BTNRobeOfTheMagi.blp",0)
  set MK7[ITC]=indexid_RobeOfMagi
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03V','I04Y','h08E','I0C5',"ReplaceableTextures\\CommandButtons\\BTNSlippersOfAgility.blp",0)
  set MK7[ITC]=indexid_SlippersOfAgility
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03W','I04Z','h08J','I0DK',"ReplaceableTextures\\CommandButtons\\BTNSobiMask.blp",0)
  set MK7[ITC]=indexid_SobiMask
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0GD','I0GC','h08I','I0GE',"ReplaceableTextures\\CommandButtons\\BTNWand.blp",0)
  set MK7[ITC]=indexid_MagicStick
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0HT','I0HR','h08F','I0HW',"ReplaceableTextures\\CommandButtons\\BTNOrcMeleeUpTwo.blp",0)
  set MK7[ITC]=indexid_QuellingBlade
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0J7','I0J6','h08V','I0J8',"ReplaceableTextures\\CommandButtons\\BTNAmulet.blp",0)
  set MK7[ITC]=indexid_TalismanOfEvasion
  set ITC=ITC+1
  call ConvertItemData(ITC,'I03L','I04P','h08M','I0CE',"ReplaceableTextures\\CommandButtons\\BTNINV_Misc_Cape_08.blp",0)
  set MK7[ITC]=indexid_PlaneswalkerCloak
  set ITC=ITC+1
  call ConvertItemData(ITC,'I05A','I05I','h08H',0,"ReplaceableTextures\\CommandButtons\\BTNScrollUber.blp",0)
  set MK7[ITC]=indexid_ScrollOfTownPortal
  set ITC=ITC+1
  call ConvertItemData(ITC,'I037','I04B','h093','I0CR',"ReplaceableTextures\\CommandButtons\\BTNEnchantedGemstone.blp",0)
  set MK7[ITC]=indexid_EnergyBooster
  set ITC=ITC+1
  call ConvertItemData(ITC,'I02Q','I02O','h0BO','I00A',"ReplaceableTextures\\CommandButtons\\BTNINV_Misc_Cape_08.blp",0)
  set MK7[ITC]=indexid_BootsOfSpeed
  set ITC=ITC+1
  call ConvertItemData(ITC,'I0MA','I0M9','h0CN','I0MB',"ReplaceableTextures\\CommandButtons\\BTNOrbOfVenom.blp",0)
  set MK7[ITC]=indexid_OrbOfVenom
  set ITC=ITC+1
  call ConvertItemData(ITC,'I033','I047','h0D0','I0D7',"ReplaceableTextures\\CommandButtons\\BTNGlove.blp",0)
  set MK7[ITC]=indexid_Chainmail
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_RingOfHealth
  set Rec_Comp_2[Recipe_Max]=indexid_VoidStone
  set Rec_Final[Recipe_Max]=indexid_Perseverance
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_RingOfRegeneration
  set Rec_Comp_2[Recipe_Max]=indexid_IronwoodBranch
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeHeaddressOfRejuvenation
  set Rec_Final[Recipe_Max]=indexid_HeaddressOfRejuvenation
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Chainmail
  set Rec_Comp_2[Recipe_Max]=indexid_IronwoodBranch
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeNethrezimBuckler
  set Rec_Final[Recipe_Max]=indexid_NathrezimBuckler
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_RingOfProtection
  set Rec_Comp_2[Recipe_Max]=indexid_SobiMask
  set Rec_Final[Recipe_Max]=indexid_RingOfBasilius
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_BootsOfSpeed
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeBootsOfTravel
  set Rec_Final[Recipe_Max]=indexid_bootsOfTravel
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_BootsOfSpeed
  set Rec_Comp_2[Recipe_Max]=indexid_BootsOfElvenskin
  set Rec_Comp_3[Recipe_Max]=indexid_GlovesOfHaste
  set Rec_Final[Recipe_Max]=indexid_PowerTreadsAgility
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_BootsOfSpeed
  set Rec_Comp_2[Recipe_Max]=indexid_BeltOfStrength
  set Rec_Comp_3[Recipe_Max]=indexid_GlovesOfHaste
  set Rec_Final[Recipe_Max]=indexid_PowerTreadsStrength
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_BootsOfSpeed
  set Rec_Comp_2[Recipe_Max]=indexid_RobeOfMagi
  set Rec_Comp_3[Recipe_Max]=indexid_GlovesOfHaste
  set Rec_Final[Recipe_Max]=indexid_PowerTreadsIntelligence
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_GlovesOfHaste
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeHandOfMidas
  set Rec_Final[Recipe_Max]=indexid_HandOfMidas
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Quarterstaff
  set Rec_Comp_2[Recipe_Max]=indexid_RobeOfMagi
  set Rec_Comp_3[Recipe_Max]=indexid_SobiMask
  set Rec_Final[Recipe_Max]=indexid_OblivionStaff
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_CircletOfNobility
  set Rec_Comp_2[Recipe_Max]=indexid_GauntletOfStrength
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeBracer
  set Rec_Final[Recipe_Max]=indexid_Bracer
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_CircletOfNobility
  set Rec_Comp_2[Recipe_Max]=indexid_SlippersOfAgility
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeWraithBand
  set Rec_Final[Recipe_Max]=indexid_WraithBand
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_CircletOfNobility
  set Rec_Comp_2[Recipe_Max]=indexid_MantleOfIntelligence
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeNullTalisman
  set Rec_Final[Recipe_Max]=indexid_NullTalisman
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_BladesOfAlacrity
  set Rec_Comp_2[Recipe_Max]=indexid_BootsOfElvenskin
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeYasha
  set Rec_Final[Recipe_Max]=indexid_Yasha
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_OgreAxe
  set Rec_Comp_2[Recipe_Max]=indexid_BeltOfStrength
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeSange
  set Rec_Final[Recipe_Max]=indexid_Sange
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_javelin
  set Rec_Comp_2[Recipe_Max]=indexid_BeltOfStrength
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeCraniumBasher
  set Rec_Final[Recipe_Max]=indexid_CraniumBasher
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Broadsword
  set Rec_Comp_2[Recipe_Max]=indexid_Chainmail
  set Rec_Comp_3[Recipe_Max]=indexid_RobeOfMagi
  set Rec_Final[Recipe_Max]=indexid_BladeMail
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_MithrilHammer
  set Rec_Comp_2[Recipe_Max]=indexid_GlovesOfHaste
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeMaelstrom
  set Rec_Final[Recipe_Max]=indexid_Maelstrom
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_BladesOfAlacrity
  set Rec_Comp_2[Recipe_Max]=indexid_BladesOfAlacrity
  set Rec_Comp_3[Recipe_Max]=indexid_RobeOfMagi
  set Rec_Comp_4[Recipe_Max]=indexid_RecipeDiffusalBlade
  set Rec_Final[Recipe_Max]=indexid_DiffusalBlade
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_DiffusalBlade
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeDiffusalBlade
  set Rec_Final[Recipe_Max]=indexid_DiffusalBlade_upg
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_DiffusalBlade_empty
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeDiffusalBlade
  set Rec_Final[Recipe_Max]=indexid_DiffusalBlade_upg
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_HelmOfIronWill
  set Rec_Comp_2[Recipe_Max]=indexid_MaskOfDeath
  set Rec_Final[Recipe_Max]=indexid_HelmOfTheDominator
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_MaskOfDeath
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeMaskOfMadness
  set Rec_Final[Recipe_Max]=indexid_MaskOfMadness
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_SobiMask
  set Rec_Comp_2[Recipe_Max]=indexid_StaffOfWizardry
  set Rec_Comp_3[Recipe_Max]=indexid_VoidStone
  set Rec_Comp_4[Recipe_Max]=indexid_RecipeEul
  set Rec_Final[Recipe_Max]=indexid_Eul
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_PointBooster
  set Rec_Comp_2[Recipe_Max]=indexid_EnergyBooster
  set Rec_Comp_3[Recipe_Max]=indexid_VitalityBooster
  set Rec_Final[Recipe_Max]=indexid_SoulBooster
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_HeaddressOfRejuvenation
  set Rec_Comp_2[Recipe_Max]=indexid_NathrezimBuckler
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeMekansm
  set Rec_Final[Recipe_Max]=indexid_Mekansm
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Sange
  set Rec_Comp_2[Recipe_Max]=indexid_Yasha
  set Rec_Final[Recipe_Max]=indexid_SangeAndYasha
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_MithrilHammer
  set Rec_Comp_2[Recipe_Max]=indexid_MithrilHammer
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeDesolator
  set Rec_Final[Recipe_Max]=indexid_Desolator
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Perseverance
  set Rec_Comp_2[Recipe_Max]=indexid_Broadsword
  set Rec_Comp_3[Recipe_Max]=indexid_Claymore
  set Rec_Final[Recipe_Max]=indexid_BattleFury
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_BladesOfAttack
  set Rec_Comp_2[Recipe_Max]=indexid_Broadsword
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeCrystalys
  set Rec_Final[Recipe_Max]=indexid_Crystalys
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_MithrilHammer
  set Rec_Comp_2[Recipe_Max]=indexid_OgreAxe
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeBKB
  set Rec_Final[Recipe_Max]=indexid_BlackKingBar10
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Yasha
  set Rec_Comp_2[Recipe_Max]=indexid_UltimateOrb
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeMantaStyle
  set Rec_Final[Recipe_Max]=indexid_MantaStyleRanged
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_ShadowAmulet
  set Rec_Comp_2[Recipe_Max]=indexid_Claymore
  set Rec_Final[Recipe_Max]=indexid_LotharsEdge
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_StaffOfWizardry
  set Rec_Comp_2[Recipe_Max]=indexid_NullTalisman
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeDagon
  set Rec_Final[Recipe_Max]=indexid_Dagon1
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Dagon1
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeDagon
  set Rec_Final[Recipe_Max]=indexid_Dagon2
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Dagon2
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeDagon
  set Rec_Final[Recipe_Max]=indexid_Dagon3
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Dagon3
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeDagon
  set Rec_Final[Recipe_Max]=indexid_Dagon4
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Dagon4
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeDagon
  set Rec_Final[Recipe_Max]=indexid_Dagon5
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_StaffOfWizardry
  set Rec_Comp_2[Recipe_Max]=indexid_BeltOfStrength
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeNecronomicon
  set Rec_Final[Recipe_Max]=indexid_Necronomicon1
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Necronomicon1
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeNecronomicon
  set Rec_Final[Recipe_Max]=indexid_Necronomicon2
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Necronomicon2
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeNecronomicon
  set Rec_Final[Recipe_Max]=indexid_Necronomicon3
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_UltimateOrb
  set Rec_Comp_2[Recipe_Max]=indexid_Perseverance
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeLinken
  set Rec_Final[Recipe_Max]=indexid_LinkensSphere
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_DemonEdge
  set Rec_Comp_2[Recipe_Max]=indexid_SacredRelic
  set Rec_Final[Recipe_Max]=indexid_DivineRapier
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Crystalys
  set Rec_Comp_2[Recipe_Max]=indexid_DemonEdge
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeBuriza
  set Rec_Final[Recipe_Max]=indexid_Buriza
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_DemonEdge
  set Rec_Comp_2[Recipe_Max]=indexid_javelin
  set Rec_Comp_3[Recipe_Max]=indexid_javelin
  set Rec_Final[Recipe_Max]=indexid_MKBOn
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_SacredRelic
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeRadiance
  set Rec_Final[Recipe_Max]=indexid_RadianceOn
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_MesserschmidtReaver
  set Rec_Comp_2[Recipe_Max]=indexid_VitalityBooster
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeHeartOfTarrasque
  set Rec_Final[Recipe_Max]=indexid_HeartOfTarrasque
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_MesserschmidtReaver
  set Rec_Comp_2[Recipe_Max]=indexid_HelmOfTheDominator
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeSatanic
  set Rec_Final[Recipe_Max]=indexid_Satanic
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_MesserschmidtReaver
  set Rec_Comp_2[Recipe_Max]=indexid_HelmOfTheDominatorCourier
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeSatanic
  set Rec_Final[Recipe_Max]=indexid_Satanic
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_UltimateOrb
  set Rec_Comp_2[Recipe_Max]=indexid_UltimateOrb
  set Rec_Comp_3[Recipe_Max]=indexid_PointBooster
  set Rec_Comp_4[Recipe_Max]=indexid_OrbOfVenom
  set Rec_Final[Recipe_Max]=indexid_EyeOfSkadi
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_UltimateOrb
  set Rec_Comp_2[Recipe_Max]=indexid_UltimateOrb
  set Rec_Comp_3[Recipe_Max]=indexid_PointBooster
  set Rec_Comp_4[Recipe_Max]=indexid_OrbOfVenomRanged
  set Rec_Final[Recipe_Max]=indexid_EyeOfSkadi
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Eaglehorn
  set Rec_Comp_2[Recipe_Max]=indexid_Quarterstaff
  set Rec_Comp_3[Recipe_Max]=indexid_TalismanOfEvasion
  set Rec_Final[Recipe_Max]=indexid_Butterfly
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_SobiMask
  set Rec_Comp_2[Recipe_Max]=indexid_Chainmail
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeMedallion
  set Rec_Final[Recipe_Max]=indexid_MedallionOfCourage
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_PointBooster
  set Rec_Comp_2[Recipe_Max]=indexid_OgreAxe
  set Rec_Comp_3[Recipe_Max]=indexid_BladesOfAlacrity
  set Rec_Comp_4[Recipe_Max]=indexid_StaffOfWizardry
  set Rec_Final[Recipe_Max]=indexid_AghanimBasic
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Perseverance
  set Rec_Comp_2[Recipe_Max]=indexid_OblivionStaff
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeRefresherOrb
  set Rec_Final[Recipe_Max]=indexid_RefresherOrb
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_UltimateOrb
  set Rec_Comp_2[Recipe_Max]=indexid_MysticStaff
  set Rec_Comp_3[Recipe_Max]=indexid_VoidStone
  set Rec_Final[Recipe_Max]=indexid_GuinsooHex
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_VitalityBooster
  set Rec_Comp_2[Recipe_Max]=indexid_RingOfHealth
  set Rec_Comp_3[Recipe_Max]=indexid_StoutShield
  set Rec_Final[Recipe_Max]=indexid_Vanguard
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_VitalityBooster
  set Rec_Comp_2[Recipe_Max]=indexid_RingOfHealth
  set Rec_Comp_3[Recipe_Max]=indexid_StoutShieldRanged
  set Rec_Final[Recipe_Max]=indexid_Vanguard
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_EnergyBooster
  set Rec_Comp_2[Recipe_Max]=indexid_RingOfProtection
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeArcaneRing
  set Rec_Final[Recipe_Max]=indexid_ArcaneRing
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Hyperstone
  set Rec_Comp_2[Recipe_Max]=indexid_Maelstrom
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeMjollnir
  set Rec_Final[Recipe_Max]=indexid_Mjollnir
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_AnimalCourier
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeFlyingCourier
  set Rec_Final[Recipe_Max]=indexid_FlyingCourier
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_RingOfRegeneration
  set Rec_Comp_2[Recipe_Max]=indexid_RingOfBasilius
  set Rec_Comp_3[Recipe_Max]=indexid_MaskOfDeath
  set Rec_Comp_4[Recipe_Max]=indexid_RecipeVladmirOffering
  set Rec_Final[Recipe_Max]=indexid_VladmirsOffering
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_RingOfRegeneration
  set Rec_Comp_2[Recipe_Max]=indexid_RingOfBasiliusHero
  set Rec_Comp_3[Recipe_Max]=indexid_MaskOfDeath
  set Rec_Comp_4[Recipe_Max]=indexid_RecipeVladmirOffering
  set Rec_Final[Recipe_Max]=indexid_VladmirsOffering
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Hyperstone
  set Rec_Comp_2[Recipe_Max]=indexid_PlateMail
  set Rec_Comp_3[Recipe_Max]=indexid_Chainmail
  set Rec_Comp_4[Recipe_Max]=indexid_RecipeAssaultCuirass
  set Rec_Final[Recipe_Max]=indexid_AssaultCuirass
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_SoulBooster
  set Rec_Comp_2[Recipe_Max]=indexid_Perseverance
  set Rec_Final[Recipe_Max]=indexid_bloodstone
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_RingOfRegeneration
  set Rec_Comp_2[Recipe_Max]=indexid_RingOfRegeneration
  set Rec_Comp_3[Recipe_Max]=indexid_RingOfHealth
  set Rec_Comp_4[Recipe_Max]=indexid_PlaneswalkerCloak
  set Rec_Final[Recipe_Max]=indexid_HoodOfDefiance
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_GlovesOfHaste
  set Rec_Comp_2[Recipe_Max]=indexid_HelmOfIronWill
  set Rec_Comp_3[Recipe_Max]=indexid_BladesOfAttack
  set Rec_Comp_4[Recipe_Max]=indexid_RecipeArmlet
  set Rec_Final[Recipe_Max]=indexid_ArmletOffCourier
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_MysticStaff
  set Rec_Comp_2[Recipe_Max]=indexid_PlateMail
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeShivasGuard
  set Rec_Final[Recipe_Max]=indexid_ShivasGuard
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_OblivionStaff
  set Rec_Comp_2[Recipe_Max]=indexid_OblivionStaff
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeOrchid
  set Rec_Final[Recipe_Max]=indexid_Orchid
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_BootsOfSpeed
  set Rec_Comp_2[Recipe_Max]=indexid_BladesOfAttack
  set Rec_Comp_3[Recipe_Max]=indexid_BladesOfAttack
  set Rec_Final[Recipe_Max]=indexid_PhaseBoots
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_MagicStick
  set Rec_Comp_2[Recipe_Max]=indexid_IronwoodBranch
  set Rec_Comp_3[Recipe_Max]=indexid_IronwoodBranch
  set Rec_Comp_4[Recipe_Max]=indexid_IronwoodBranch
  set Rec_Comp_5[Recipe_Max]=indexid_RecipeMagicWand
  set Rec_Final[Recipe_Max]=indexid_MagicWand
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_RingOfRegeneration
  set Rec_Comp_2[Recipe_Max]=indexid_StaffOfWizardry
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeForceStaff
  set Rec_Final[Recipe_Max]=indexid_ForceStaff
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_HoodOfDefiance
  set Rec_Comp_2[Recipe_Max]=indexid_HeaddressOfRejuvenation
  set Rec_Comp_3[Recipe_Max]=indexid_RecipePipe
  set Rec_Final[Recipe_Max]=indexid_Pipe
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_StoutShield
  set Rec_Comp_2[Recipe_Max]=indexid_SlippersOfAgility
  set Rec_Comp_3[Recipe_Max]=indexid_SlippersOfAgility
  set Rec_Final[Recipe_Max]=indexid_PoormansShield
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_StoutShieldRanged
  set Rec_Comp_2[Recipe_Max]=indexid_SlippersOfAgility
  set Rec_Comp_3[Recipe_Max]=indexid_SlippersOfAgility
  set Rec_Final[Recipe_Max]=indexid_PoormansShield
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_SobiMask
  set Rec_Comp_2[Recipe_Max]=indexid_GauntletOfStrength
  set Rec_Comp_3[Recipe_Max]=indexid_GauntletOfStrength
  set Rec_Comp_4[Recipe_Max]=indexid_RecipeUrnOfShadows
  set Rec_Final[Recipe_Max]=indexid_UrnOfShadows
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_SobiMask
  set Rec_Comp_2[Recipe_Max]=indexid_RingOfRegeneration
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeSoulRing
  set Rec_Final[Recipe_Max]=indexid_SoulRing
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Eaglehorn
  set Rec_Comp_2[Recipe_Max]=indexid_GhostScepter
  set Rec_Final[Recipe_Max]=indexid_EtherealBlade
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_BootsOfSpeed
  set Rec_Comp_2[Recipe_Max]=indexid_EnergyBooster
  set Rec_Final[Recipe_Max]=indexid_ArcaneBoots
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_RobeOfMagi
  set Rec_Comp_2[Recipe_Max]=indexid_Bracer
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeJanggo
  set Rec_Final[Recipe_Max]=indexid_janggo
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_janggo
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeJanggo
  set Rec_Final[Recipe_Max]=indexid_janggo
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_janggoempty
  set Rec_Comp_2[Recipe_Max]=indexid_RecipeJanggo
  set Rec_Final[Recipe_Max]=indexid_janggo
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_HelmOfIronWill
  set Rec_Comp_2[Recipe_Max]=indexid_NullTalisman
  set Rec_Comp_3[Recipe_Max]=indexid_RecipeVeilOfDiscord
  set Rec_Final[Recipe_Max]=indexid_VeilOfDiscord
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_BootsOfSpeed
  set Rec_Comp_2[Recipe_Max]=indexid_RingOfProtection
  set Rec_Comp_3[Recipe_Max]=indexid_RingOfRegeneration
  set Rec_Final[Recipe_Max]=indexid_TranquilBoots
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_StaffOfWizardry
  set Rec_Comp_2[Recipe_Max]=indexid_StaffOfWizardry
  set Rec_Comp_3[Recipe_Max]=indexid_VitalityBooster
  set Rec_Final[Recipe_Max]=indexid_RodOfAtos
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_Sange
  set Rec_Comp_2[Recipe_Max]=indexid_TalismanOfEvasion
  set Rec_Final[Recipe_Max]=indexid_HeavensHalberd
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_CraniumBasher
  set Rec_Comp_2[Recipe_Max]=indexid_SacredRelic
  set Rec_Final[Recipe_Max]=indexid_AbyssalBlade
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_WraithBand
  set Rec_Comp_2[Recipe_Max]=indexid_RingOfBasilius
  set Rec_Final[Recipe_Max]=indexid_RingOfAquila
  set Recipe_Max=Recipe_Max+1
  set Rec_Comp_1[Recipe_Max]=indexid_WraithBand
  set Rec_Comp_2[Recipe_Max]=indexid_RingOfBasiliusHero
  set Rec_Final[Recipe_Max]=indexid_RingOfAquilaHero
endfunction

function InitCustomTeams takes nothing returns nothing
  call SetPlayerTeam(Player(1),0)
  call SetPlayerTeam(Player(2),0)
  call SetPlayerTeam(Player(3),0)
  call SetPlayerTeam(Player(4),0)
  call SetPlayerTeam(Player(5),0)
  call SetPlayerTeam(Player(7),1)
  call SetPlayerTeam(Player(8),1)
  call SetPlayerTeam(Player(9),1)
  call SetPlayerTeam(Player(10),1)
  call SetPlayerTeam(Player(11),1)
endfunction

function main takes nothing returns nothing
  local weathereffect we
  local integer i
  local player p
  local unit u
  local integer unitID
  local trigger t
  local real life
  local integer ZG8
  local integer HFH
  local version v
  local integer T88
  local integer HI9
  local player VH8
  local location YT9
  local region UJE
  local real d
  local integer Cache
  call LoD_Init()
  call SuspendTimeOfDay(true)
  call TriggerAddCondition(GAME_TRIGGER,Condition(function LoD_Event_Condition))
  call TriggerAddCondition(CHAT_TRIGGER,Condition(function LoD_Chat_Event))
  call SetCameraBounds(-7552.+GetCameraMargin(CAMERA_MARGIN_LEFT),-7936.+GetCameraMargin(CAMERA_MARGIN_BOTTOM),7552.-GetCameraMargin(CAMERA_MARGIN_RIGHT),7424.-GetCameraMargin(CAMERA_MARGIN_TOP),-7552.+GetCameraMargin(CAMERA_MARGIN_LEFT),7424.-GetCameraMargin(CAMERA_MARGIN_TOP),7552.-GetCameraMargin(CAMERA_MARGIN_RIGHT),-7936.+GetCameraMargin(CAMERA_MARGIN_BOTTOM))
  call SetDayNightModels("Environment\\DNC\\DNCFelwood\\DNCFelwoodTerrain\\DNCFelwoodTerrain.mdl","Environment\\DNC\\DNCFelwood\\DNCFelwoodUnit\\DNCFelwoodUnit.mdl")
  call SetWaterBaseColor(0,0,255,255)
  call NewSoundEnvironment("Default")
  call SetAmbientDaySound("FelwoodDay")
  call SetAmbientNightSound("FelwoodNight")
  call SetMapMusic("Music",true,0)
  set sound005=CreateSound("Abilities\\Spells\\NightElf\\Blink\\BlinkArrival1.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound005,"BlinkTarget")
  call SetSoundDuration(sound005,1466)
  call SetSoundPitch(sound005,1.6)
  set sound006=CreateSound("Abilities\\Spells\\Human\\Blizzard\\BlizzardLoop1.wav",true,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound006,"BlizzardLoop")
  call SetSoundDuration(sound006,4000)
  set sound007=CreateSound("Buildings\\Undead\\TempleOfTheDamned\\TempleOfTheDamnedWhat.wav",false,true,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(sound007,"TempleOfTheDamnedWhat")
  call SetSoundDuration(sound007,3518)
  call SetSoundDistanceCutoff(sound007,2000.)
  set boolean023=CreateSound("Abilities\\Spells\\Human\\Flare\\FlareTarget2.wav",false,true,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(boolean023,"Flare2")
  call SetSoundDuration(boolean023,1344)
  call SetSoundDistanceCutoff(boolean023,2000.)
  set DC=CreateSound("Sounds\\Dominating.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(DC,1802)
  call SetSoundChannel(DC,0)
  call SetSoundVolume(DC,127)
  call SetSoundPitch(DC,1.)
  set boolean019=CreateSound("Sounds\\Double_Kill.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(boolean019,2012)
  call SetSoundChannel(boolean019,0)
  call SetSoundVolume(boolean019,127)
  call SetSoundPitch(boolean019,1.)
  set FC=CreateSound("Sounds\\firstblood.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(FC,1567)
  call SetSoundChannel(FC,0)
  call SetSoundVolume(FC,127)
  call SetSoundPitch(FC,1.)
  set Sound_TechiesLaugh=CreateSound("Units\\Creeps\\GoblinSapper\\GoblinSapperYesAttack1.wav",false,false,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(Sound_TechiesLaugh,"GoblinSapperYesAttack")
  call SetSoundDuration(Sound_TechiesLaugh,813)
  call SetSoundChannel(Sound_TechiesLaugh,0)
  set ZC=CreateSound("Sounds\\GodLike.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(ZC,1828)
  call SetSoundChannel(ZC,0)
  call SetSoundVolume(ZC,127)
  call SetSoundPitch(ZC,1.)
  set WC=CreateSound("Sounds\\HolyShit.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(WC,2325)
  call SetSoundChannel(WC,0)
  call SetSoundVolume(WC,127)
  call SetSoundPitch(WC,1.)
  set sound014=CreateSound("Buildings\\NightElf\\MoonWell\\MoonWellWhat1.wav",false,true,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(sound014,"MoonWellWhat")
  call SetSoundDuration(sound014,2972)
  call SetSoundDistances(sound014,600.,10000.)
  call SetSoundDistanceCutoff(sound014,2000.)
  set LC=CreateSound("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaos.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(LC,"MarkOfChaos")
  call SetSoundDuration(LC,4000)
  set boolean022=CreateSound("Sounds\\Killing_Spree.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(boolean022,2377)
  call SetSoundChannel(boolean022,0)
  call SetSoundVolume(boolean022,127)
  call SetSoundPitch(boolean022,1.)
  set sound016=CreateSound("Sound\\Buildings\\Death\\NightElfBuildingDeathSmall1.wav",false,true,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(sound016,"DeathNightElfBuildingCancel")
  call SetSoundDuration(sound016,3675)
  set TC=CreateSound("Sounds\\MegaKill.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(TC,2612)
  call SetSoundChannel(TC,0)
  call SetSoundVolume(TC,127)
  call SetSoundPitch(TC,1.)
  set boolean020=CreateSound("Abilities\\Spells\\NightElf\\ShadowMeld\\ShadowMeld1.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(boolean020,"ShadowMeld")
  call SetSoundDuration(boolean020,941)
  set boolean024=CreateSound("Sounds\\MonsterKill.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(boolean024,3344)
  call SetSoundChannel(boolean024,0)
  call SetSoundVolume(boolean024,127)
  call SetSoundPitch(boolean024,1.)
  set WD=CreateSound("Sounds\\Ownage.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(WD,2586)
  call SetSoundChannel(WD,0)
  call SetSoundVolume(WD,127)
  call SetSoundPitch(WD,1.)
  set sound019=CreateSound("Abilities\\Spells\\Undead\\DevourMagic\\DevourMagic.wav",false,true,true,10,10,"MissilesEAX")
  call SetSoundParamsFromLabel(sound019,"DevourMagicLaunch")
  call SetSoundDuration(sound019,1225)
  set QD=CreateSound("Sound\\Ambient\\DoodadEffects\\TheHornOfCenarius.wav",false,false,false,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(QD,"HornOfCenariusSound")
  call SetSoundDuration(QD,12121)
  call SetSoundVolume(QD,115)
  set UD=CreateSound("Sounds\\triple_kill.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(UD,1907)
  call SetSoundChannel(UD,0)
  call SetSoundVolume(UD,127)
  call SetSoundPitch(UD,1.)
  set BE=CreateSound("Sounds\\Unstoppable.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(BE,2038)
  call SetSoundChannel(BE,0)
  call SetSoundVolume(BE,127)
  call SetSoundPitch(BE,1.)
  set integer009=CreateSound("Abilities\\Spells\\Human\\DivineShield\\PaladinDivineShieldDeath1.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(integer009,"DivineShieldDeath")
  call SetSoundDuration(integer009,1043)
  call SetSoundDistanceCutoff(integer009,1500.)
  set sound022=CreateSound("Abilities\\Spells\\Items\\AIso\\SoulGem.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound022,"SoulGem")
  call SetSoundDuration(sound022,4474)
  set integer008=CreateSound("Sounds\\WhickedSick.mp3",false,false,false,10,10,"DefaultEAXON")
  call SetSoundDuration(integer008,2612)
  call SetSoundChannel(integer008,0)
  call SetSoundVolume(integer008,127)
  call SetSoundPitch(integer008,1.)
  set FE=CreateSound("Units\\Creeps\\GoblinSapper\\GoblinSapperYesAttack4.wav",false,true,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(FE,"GoblinSapperYesAttack")
  call SetSoundDuration(FE,1091)
  call SetSoundChannel(FE,0)
  set sound024=CreateSound("Abilities\\Spells\\NightElf\\shadowstrike\\ShadowStrikeBirth1.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound024,"ShadowStrikeBirth")
  call SetSoundDuration(sound024,2194)
  call SetSoundPitch(sound024,1.2)
  set sound025=CreateSound("Abilities\\Spells\\Human\\ReviveHuman\\ReviveHuman.wav",false,false,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(sound025,"ReviveHuman")
  call SetSoundDuration(sound025,3196)
  call SetSoundChannel(sound025,8)
  set JE=CreateSound("Sounds\\UltraKill.mp3",false,false,false,10,10,"")
  call SetSoundDuration(JE,1958)
  call SetSoundChannel(JE,0)
  call SetSoundVolume(JE,127)
  call SetSoundPitch(JE,1.)
  set KE=CreateSound("Sounds\\Rampage.mp3",false,false,false,10,10,"")
  call SetSoundDuration(KE,1195)
  call SetSoundChannel(KE,0)
  call SetSoundVolume(KE,127)
  call SetSoundPitch(KE,1.)
  set sound026=CreateSound("Units\\Orc\\AncestralGuardian\\AncestralGuardianAttack1.wav",false,true,true,10,10,"CombatSoundsEAX")
  call SetSoundParamsFromLabel(sound026,"AncestralGuardianAttack1")
  call SetSoundDuration(sound026,1181)
  set sound027=CreateSound("Abilities\\Spells\\Human\\Feedback\\Feedback.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound027,"Feedback")
  call SetSoundDuration(sound027,1222)
  set sound028=CreateSound("Units\\Undead\\Abomination\\AbominationPissed5.wav",false,true,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(sound028,"AbominationPissed")
  call SetSoundDuration(sound028,1735)
  set sound029=CreateSound("Sound\\Units\\Death\\ArtilleryCorpseExplodeDeath1.wav",false,true,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(sound029,"ArtilleryExplodeDeath")
  call SetSoundDuration(sound029,1486)
  set sound030=CreateSound("Units\\Undead\\CryptFiend\\CryptFiendPissed2.wav",false,true,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(sound030,"CryptFiendPissed")
  call SetSoundDuration(sound030,3541)
  set ResQFun=CreateSound("Units\\Orc\\BatTroll\\TrollbatriderPissed4.wav",false,true,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(ResQFun,"TrollbatriderPissed")
  call SetSoundDuration(ResQFun,2659)
  set sound032=CreateSound("Units\\Undead\\Banshee\\BansheeDeath.wav",false,true,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(sound032,"BansheeDeath")
  call SetSoundDuration(sound032,2380)
  set sound033=CreateSound("Abilities\\Spells\\Other\\Volcano\\VolcanoLoop.wav",false,false,false,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(sound033,"VolcanoLoop")
  call SetSoundDuration(sound033,7616)
  set sound034=CreateSound("Abilities\\Spells\\Human\\ThunderClap\\ThunderClapCaster.wav",false,false,false,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound034,"ThunderClap")
  call SetSoundDuration(sound034,3451)
  set sound035=CreateSound("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImage.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound035,"MirrorImage")
  call SetSoundDuration(sound035,1756)
  set sound036=CreateSound("Abilities\\Spells\\Human\\CloudOfFog\\CloudOfFogLoop1.wav",true,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound036,"CloudOfFogLoop")
  call SetSoundDuration(sound036,2038)
  call SetSoundPitch(sound036,.9)
  set ZF=CreateSound("Sound\\Interface\\Hint.wav",false,false,false,10,10,"")
  call SetSoundParamsFromLabel(ZF,"Hint")
  call SetSoundDuration(ZF,2006)
  set VF=CreateSound("war3mapImported\\pl_impact_stun.mp3",false,true,true,10,10,"SpellsEAX")
  call SetSoundDuration(VF,1340)
  call SetSoundChannel(VF,11)
  call SetSoundVolume(VF,127)
  call SetSoundPitch(VF,1.)
  call SetSoundDistances(VF,600.,10000.)
  call SetSoundDistanceCutoff(VF,2000.)
  call SetSoundConeAngles(VF,.0,.0,127)
  call SetSoundConeOrientation(VF,.0,.0,.0)
  set sound039=CreateSound("Sound\\Buildings\\Fire\\OrcHumanLargeBuildingFire1.wav",true,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound039,"HumanFireLarge")
  call SetSoundDuration(sound039,3471)
  set sound040=CreateSound("Units\\Human\\Phoenix\\PhoenixEggWhat1.wav",false,false,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(sound040,"PhoenixEggWhat")
  call SetSoundDuration(sound040,1579)
  call SetSoundChannel(sound040,0)
  set sound041=CreateSound("Abilities\\Spells\\Human\\SpellSteal\\SpellStealMissile.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound041,"SpellStealMissileLaunch")
  call SetSoundDuration(sound041,1541)
  set sound042=CreateSound("Abilities\\Spells\\Human\\SpellSteal\\SpellStealTarget.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound042,"SpellStealTarget")
  call SetSoundDuration(sound042,984)
  set sound043=CreateSound("Abilities\\Spells\\Undead\\UndeadMine\\AcolyteMining.wav",false,true,true,10,10,"DefaultEAXON")
  call SetSoundParamsFromLabel(sound043,"AcolyteMining")
  call SetSoundDuration(sound043,4233)
  call SetSoundChannel(sound043,0)
  set sound044=CreateSound("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouch.wav",false,true,true,10,10,"SpellsEAX")
  call SetSoundParamsFromLabel(sound044,"SpiritTouch")
  call SetSoundDuration(sound044,2043)
  call SetSoundChannel(sound044,11)
  //	set spooky[0]=CreateSound("Sound\\Ambient\\DoodadEffects\\FrostmourneChant1.wav",false,true,true,10,10,"DefaultEAXON")
  //	set spooky[1]=CreateSound("Sound\\Ambient\\DoodadEffects\\FlashBackHalfSecondSecond.wav",false,true,true,10,10,"DefaultEAXON")
  //	set spooky[2]=CreateSound("Sound\\Ambient\\DoodadEffects\\FlashBack1Second.wav",false,true,true,10,10,"DefaultEAXON")
  //	set spooky[3]=CreateSound("Sound\\Ambient\\Ashenvale\\FreakyForest3.wav",false,true,true,10,10,"DefaultEAXON")
  //	set spooky[4]=CreateSound("Sound\\Ambient\\Ashenvale\\FreakyForest2.wav",false,true,true,10,10,"DefaultEAXON")
  //	set spooky[5]=CreateSound("Abilities\\Spells\\Undead\\ReviveUndead\\ReviveUndead.wav",false,true,true,10,10,"DefaultEAXON")
  set ScouBotMeleeSpawnRect=Rect(6176.,3136.,6400.,3392.)
  set ScouMidMeleeSpawnRect=Rect(3616.,3584.,3872.,3872.)
  set ScouTopMeleeSpawnRect=Rect(2304.,5280.,2752.,5728.)
  set gg_rct_Hero_Creation_UD=Rect(6176.,5952.,6624.,6240.)
  set SentBotRangeSpawnRect=Rect(-4224.,-6848.,-3968.,-6592.)
  set SentTopRangeSpawnRect=Rect(-6304.,-4384.,-6080.,-4224.)
  set SentMidRangeSpawnRect=Rect(-4928.,-5760.,-4736.,-5536.)
  set ScouBotRangeSpawnRect=Rect(6048.,3424.,6304.,3776.)
  set ScouMidRangeSpawnRect=Rect(4128.,3776.,4352.,4032.)
  set ScouTopRangeSpawnRect=Rect(2752.,5408.,3040.,5632.)
  set gg_rct_Hero_Creation_NE=Rect(-7040.,-6912.,-6688.,-6656.)
  set SentBotMeleeSpawnRect=Rect(-3648.,-6880.,-3424.,-6688.)
  set SentTopMeleeSpawnRect=Rect(-6336.,-4224.,-5984.,-3904.)
  set SentMidMeleeSpawnRect=Rect(-4896.,-5504.,-4608.,-5184.)
  set BottomRuneSpawnRect=Rect(2912.,-2944.,3104.,-2720.)
  set F4=Rect(5696.,5504.,7296.,7392.)
  set G4=Rect(-7680.,-8032.,-6176.,-6240.)
  set TopRuneSpawnRect=Rect(-2464.,1536.,-2240.,1760.)
  set Z4=Rect(4288.,-2688.,4544.,-2400.)
  set V4=Rect(-3328.,-416.,-3104.,-96.)
  set W4=Rect(1440.,-4096.,1728.,-3872.)
  set X4=Rect(-4576.,3328.,-4448.,3488.)
  set Y4=Rect(-3264.,4192.,-2912.,4320.)
  set J4=Rect(2848.,-5088.,3072.,-4928.)
  set K4=Rect(-1824.,2240.,-1472.,2464.)
  set L4=Rect(3008.,-3776.,3136.,-3648.)
  set M4=Rect(1184.,2976.,1280.,3104.)
  set N4=Rect(-512.,-3648.,-320.,-3520.)
  set gg_rct_Allpick_Sent=Rect(-7104.,6656.,-6848.,6912.)
  set gg_rct_Allpick_Scourge=Rect(-7104.,6656.,-6880.,6880.)
  set R4=Rect(-5952.,-6432.,-5248.,-5728.)
  set P4=Rect(5088.,7488.,5792.,8192.)
  set Q4=Rect(2304.,-672.,2592.,-384.)
  set U4=Rect(3872.,-3008.,4928.,-1952.)
  set unit006=Rect(-3552.,-768.,-2528.,320.)
  set real015=Rect(1056.,-5216.,2368.,-3744.)
  set integer041=Rect(-5120.,3008.,-3648.,4320.)
  set B5=Rect(-3456.,3808.,-2656.,4864.)
  set real014=Rect(2272.,-6080.,3776.,-4928.)
  set SomeRect7=Rect(-1888.,2208.,-992.,3040.)
  set integer039=Rect(416.,2624.,1632.,3648.)
  set F5=Rect(2592.,-4800.,3744.,-3328.)
  set integers010=Rect(-1024.,-3808.,192.,-2752.)
  set boolean036=Rect(-7936.,-7776.,-5920.,-5760.)
  set Z5=Rect(5504.,5184.,7744.,7136.)
  set V5=Rect(-800.,3072.,64.,4032.)
  set W5=Rect(-384.,3392.,-192.,3520.)
  set integer040=Rect(-1728.,-5056.,-768.,-3840.)
  set Y5=Rect(-1152.,-4704.,-960.,-4480.)
  set rect070=Rect(-480.,-800.,-256.,-512.)
  set N5=Rect(2112.,-736.,2752.,-160.)
  set SomeRect2=Rect(2112.,-960.,2720.,-640.)
  set T5=Rect(2112.,-1088.,2720.,-864.)
  set boolean037=Rect(2656.,-1120.,2784.,-416.)
  set integer042=Rect(2752.,-1248.,2880.,-544.)
  set real016=Rect(2848.,-1344.,2912.,-640.)
  set unit007=Rect(2912.,-1408.,2976.,-704.)
  set I6=Rect(2208.,-1216.,2816.,-992.)
  set O6=Rect(2464.,-1472.,3200.,-1152.)
  set A6=Rect(-8160.,-8192.,-3712.,-4352.)
  set B6=Rect(-8192.,-4960.,-4640.,-3552.)
  set C6=Rect(-4000.,-7744.,-3072.,-5152.)
  set D6=Rect(2304.,4064.,8032.,7776.)
  set E6=Rect(4640.,1952.,8000.,4384.)
  set F6=Rect(3136.,2816.,5216.,4960.)
  set G6=Rect(-7968.,5216.,-7456.,5920.)
  set H6=Rect(-8064.,2880.,-7648.,4512.)
  set Z6=Rect(-3296.,3712.,-2688.,3968.)
  set V6=Rect(-2400.,2016.,-1952.,2624.)
  set W6=Rect(-2016.,1600.,-1216.,2048.)
  set X6=Rect(-2144.,2528.,-1888.,2944.)
  set Y6=Rect(-1280.,1728.,-736.,2176.)
  set J6=Rect(-1696.,-768.,-1376.,-448.)
  set K6=Rect(-576.,.0,-352.,256.)
  set L6=Rect(3104.,-2784.,3680.,-2304.)
  set M6=Rect(3264.,-3040.,3872.,-2656.)
  set N6=Rect(4960.,-3104.,5632.,-2816.)
  set SomeRect3=Rect(4896.,-3744.,5280.,-3456.)
  set T6=Rect(7488.,-3520.,8192.,-2336.)
  set R6=Rect(6656.,-3328.,7808.,-2656.)
  set P6=Rect(7104.,-8192.,8192.,-5920.)
  set Q6=Rect(5952.,-8192.,7200.,-7712.)
  set U6=Rect(7168.,-6240.,8128.,-5184.)
  set I7=Rect(5824.,-8032.,6400.,-7776.)
  set O7=Rect(6976.,-6560.,7488.,-5920.)
  set A7=Rect(-5856.,2944.,-5600.,3200.)
  set B7=Rect(6784.,-7776.,7264.,-7456.)
  set C7=Rect(-8128.,-8192.,5536.,-7744.)
  set D7=Rect(2368.,-7904.,2688.,-7584.)
  set E7=Rect(-1664.,-7808.,-1344.,-7552.)
  set F7=Rect(-2944.,-8192.,-1664.,-7680.)
  set G7=Rect(-4000.,-8192.,-3168.,-7616.)
  set H7=Rect(-5760.,-8000.,-5184.,-7584.)
  set Z7=Rect(-3296.,3744.,-3104.,3872.)
  set V7=Rect(-8192.,-8192.,-6720.,-7744.)
  set W7=Rect(-8192.,-6432.,-7456.,-4928.)
  set X7=Rect(-8192.,-8128.,-7904.,8160.)
  set Y7=Rect(-7744.,3936.,-7328.,5600.)
  set J7=Rect(-7680.,1984.,-6560.,2816.)
  set K7=Rect(-7776.,1696.,-6944.,2176.)
  set L7=Rect(-8032.,-3040.,-7680.,-2720.)
  set M7=Rect(-7904.,-2656.,-7552.,-2336.)
  set N7=Rect(-3936.,-2720.,-3584.,-2400.)
  set S7=Rect(-3168.,-1952.,-2912.,-1696.)
  set T7=Rect(-4128.,-1632.,-3776.,-1152.)
  set R7=Rect(-4992.,-1792.,-3968.,-1440.)
  set P7=Rect(-5536.,-1664.,-4832.,-1280.)
  set Q7=Rect(-2304.,3872.,-2048.,4096.)
  set U7=Rect(-5664.,-1440.,-5344.,.0)
  set I8=Rect(-5824.,-1504.,-5472.,-544.)
  set O8=Rect(-5216.,-1216.,-4480.,-384.)
  set A8=Rect(-5632.,448.,-5152.,1856.)
  set B8=Rect(-5856.,1440.,-5248.,2592.)
  set C8=Rect(-5408.,1888.,-4928.,2368.)
  set D8=Rect(-5056.,1664.,-4064.,2144.)
  set E8=Rect(-4320.,1344.,-3808.,1952.)
  set F8=Rect(-4224.,1440.,-3200.,2016.)
  set G8=Rect(-2112.,3424.,-1856.,3744.)
  set H8=Rect(-2400.,640.,-2208.,896.)
  set Z8=Rect(-3392.,640.,-3200.,896.)
  set V8=Rect(-3744.,-1024.,-3232.,384.)
  set W8=Rect(-2016.,-5504.,-1664.,-4768.)
  set X8=Rect(-1760.,-5248.,-1312.,-4800.)
  set Y8=Rect(896.,-3328.,1088.,-3072.)
  set J8=Rect(2368.,-3808.,2688.,-3360.)
  set K8=Rect(1952.,-3744.,2208.,-3456.)
  set L8=Rect(-768.,-1344.,-480.,-1024.)
  set M8=Rect(1152.,-6560.,1376.,-6272.)
  set N8=Rect(1216.,-6368.,1504.,-6176.)
  set S8=Rect(-1376.,-6784.,-1184.,-6528.)
  set T8=Rect(7616.,-6528.,8192.,8160.)
  set R8=Rect(7072.,-2304.,7264.,-2048.)
  set P8=Rect(-7872.,7872.,8192.,8192.)
  set Q8=Rect(1792.,7776.,2112.,8192.)
  set U8=Rect(-2656.,.0,-2496.,256.)
  set integer032=Rect(-768.,7232.,-416.,7424.)
  set strings006=Rect(-7968.,5472.,-7648.,5792.)
  set integer036=Rect(1120.,7904.,1312.,8160.)
  set B9=Rect(736.,4480.,1120.,4800.)
  set strings005=Rect(2208.,4928.,2400.,5152.)
  set D9=Rect(576.,4384.,1120.,4928.)
  set integer033=Rect(2560.,4160.,2784.,4576.)
  set F9=Rect(-5984.,-3776.,-5504.,-3232.)
  set integer034=Rect(576.,4256.,1024.,4672.)
  set strings002=Rect(544.,4352.,992.,4768.)
  set Z9=Rect(704.,2496.,1376.,2784.)
  set V9=Rect(-2240.,1792.,-1856.,2240.)
  set W9=Rect(-1472.,1472.,-992.,1728.)
  set integer035=Rect(2368.,-3200.,2656.,-2880.)
  set Y9=Rect(2624.,-3584.,2816.,-2848.)
  set integer038=Rect(2784.,-3232.,2976.,-2976.)
  set L9=Rect(2784.,-3424.,2976.,-3168.)
  set strings004=Rect(7328.,7808.,8192.,8192.)
  set N9=Rect(1984.,7584.,3296.,8192.)
  set S9=Rect(2240.,7392.,2560.,8192.)
  set T9=Rect(-1888.,416.,-1696.,576.)
  set strings003=Rect(7776.,2720.,8192.,3648.)
  set integer037=Rect(5280.,640.,5664.,1184.)
  set strings007=Rect(-3104.,2720.,-2624.,3232.)
  set booleans006=Rect(7584.,-7072.,7776.,-6880.)
  set J8=Rect(2816.,-3488.,3008.,-3232.)
  set K8=Rect(1568.,-2976.,1760.,-2656.)
  set integer035=Rect(2368.,-3264.,2656.,-2944.)
  set Y9=Rect(2624.,-3648.,2816.,-2912.)
  set J9=Rect(2464.,-3456.,2656.,-3200.)
  set C7=Rect(-8192.,-8128.,5472.,-7648.)
  set boolean025=Rect(-8192.,-3712.,-7008.,-2144.)
  set real007=Rect(-3360.,-8192.,-1472.,-7648.)
  set BA=Rect(-2528.,-7840.,-1696.,-7488.)
  set real006=Rect(-2336.,-7584.,-1600.,-7456.)
  set DA=Rect(-8192.,2016.,-6816.,2880.)
  set integer016=Rect(6880.,-3328.,8000.,-2624.)
  set LA=Rect(3904.,2976.,4160.,3264.)
  set string001=Rect(2336.,5952.,2592.,6240.)
  set NA=Rect(6304.,1984.,6560.,2272.)
  set SA=Rect(-3328.,-6912.,-3072.,-6624.)
  set TA=Rect(-4384.,-4800.,-4128.,-4512.)
  set SomeRect6=Rect(-6432.,-3840.,-6176.,-3552.)
  set real008=Rect(-7584.,6176.,-6304.,7552.)
  set real009=Rect(2240.,-1024.,2592.,-416.)
  set real003=Rect(2368.,-1120.,2784.,-704.)
  set IB=Rect(-1088.,5376.,768.,6624.)
  set OB=Rect(1600.,1024.,3456.,2432.)
  set SomeRect1=Rect(5504.,-1056.,7200.,512.)
  set BB=Rect(-6944.,-1792.,-5248.,-224.)
  set CB=Rect(-1536.,-7424.,640.,-6048.)
  set DB=Rect(-3328.,-7200.,-2464.,-6368.)
  set EB=Rect(-4288.,-4544.,-3424.,-3712.)
  set FB=Rect(-6784.,-3616.,-5920.,-2784.)
  set GB=Rect(1472.,5440.,2336.,6272.)
  set HB=Rect(2656.,2336.,3520.,3168.)
  set ZB=Rect(5984.,1152.,6848.,1984.)
  set VB=Rect(-4128.,-3712.,-2496.,-2272.)
  set WB=Rect(-8192.,-8128.,-5120.,-5536.)
  set XB=Rect(4608.,4352.,8192.,8192.)
  set YB=Rect(-8096.,-7104.,-8064.,-7072.)
  set JB=Rect(-8096.,-7104.,-8064.,-7072.)
  set KB=Rect(-8096.,-7104.,-8064.,-7072.)
  set F9=Rect(6208.,7488.,8192.,8192.)
  set LB=Rect(-2784.,1280.,-1952.,2048.)
  set MB=Rect(2528.,-3168.,3360.,-2464.)
  set SB=Rect(-3936.,4480.,-3136.,5120.)
  set TB=Rect(3680.,-6016.,4416.,-5376.)
  set RB=Rect(3424.,-352.,4224.,320.)
  set PB=Rect(-4608.,-448.,-3872.,192.)
  set QB=Rect(2528.,-1376.,2944.,-960.)
  set p=Player(15)
  set CY=CreateUnit(p,'u00Z',7360.,-4416.,270.)
  call SetUnitColor(CY,ConvertPlayerColor(12))
  set BY=CreateUnit(p,'u00Z',-7296.,4224.,270.)
  call SetUnitColor(BY,ConvertPlayerColor(12))
  set u=CreateUnit(p,'uC74',3200.,-64.,270.)
  set u=CreateUnit(p,'uC74',-4544.,1152.,270.)
  set GZ=CreateUnit(p,'u010',-7296.,4416.,270.)
  call SetUnitColor(GZ,ConvertPlayerColor(12))
  set DY=CreateUnit(p,'u010',7360.,-4224.,270.)
  call SetUnitColor(DY,ConvertPlayerColor(12))
  set p=Player(15)
  set TopWaypointDummy=CreateUnit(p,'e00D',-6005.1,5458.6,212.15)
  set MidWaypointDummy=CreateUnit(p,'e00B',-561.7,-651.7,325.6)
  set BottomWaypointDummy=CreateUnit(p,'e00A',5613.5,-6070.9,64.)
  set SentBaseWaypointDummy=CreateUnit(p,'e008',-5467.9,-5891.1,307.304)
  set ScouBaseWaypointDummy=CreateUnit(p,'e001',4901.8,4536.6,212.11)
  call ConfigureNeutralVictim()
  set PL8=Filter(function ReturnTrue1)
  set filterIssueHauntOrderAtLocBJ=Filter(function IssueHauntOrderAtLocBJFilter)
  set filterEnumDestructablesInCircleBJ=Filter(function S08)
  set filterGetUnitsInRectOfPlayer=Filter(function GetUnitsInRectOfPlayerFilter)
  set filterGetUnitsOfTypeIdAll=Filter(function GetUnitsOfTypeIdAllFilter)
  set filterGetUnitsOfPlayerAndTypeId=Filter(function GetUnitsOfPlayerAndTypeIdFilter)
  set filterMeleeTrainedUnitIsHeroBJ=Filter(function MeleeTrainedUnitIsHeroBJFilter)
  set filterLivingPlayerUnitsOfTypeId=Filter(function LivingPlayerUnitsOfTypeIdFilter)
  set ZG8=0
  loop
    exitwhen ZG8==16
    set bj_FORCE_PLAYER[ZG8]=CreateForce()
    call ForceAddPlayer(bj_FORCE_PLAYER[ZG8],Player(ZG8))
    set ZG8=ZG8+1
  endloop
  set bj_FORCE_ALL_PLAYERS=CreateForce()
  call ForceEnumPlayers(bj_FORCE_ALL_PLAYERS,null)
  set bj_cineModePriorSpeed=GetGameSpeed()
  set bj_cineModePriorFogSetting=IsFogEnabled()
  set bj_cineModePriorMaskSetting=IsFogMaskEnabled()
  set ZG8=0
  loop
    exitwhen ZG8>=bj_MAX_QUEUED_TRIGGERS
    set bj_queuedExecTriggers[ZG8]=null
    set bj_queuedExecUseConds[ZG8]=false
    set ZG8=ZG8+1
  endloop
  set bj_isSinglePlayer=false
  set HFH=0
  set ZG8=0
  loop
    exitwhen ZG8>=12
    if(GetPlayerController(Player(ZG8))==MAP_CONTROL_USER and GetPlayerSlotState(Player(ZG8))==PLAYER_SLOT_STATE_PLAYING)then
      set HFH=HFH+1
    endif
    set ZG8=ZG8+1
  endloop
  set bj_isSinglePlayer=(HFH==1)
  set bj_rescueSound=CreateSoundFromLabel("Rescue",false,false,false,10000,10000)
  set bj_questDiscoveredSound=CreateSoundFromLabel("QuestNew",false,false,false,10000,10000)
  set bj_questUpdatedSound=CreateSoundFromLabel("QuestUpdate",false,false,false,10000,10000)
  set bj_questCompletedSound=CreateSoundFromLabel("QuestCompleted",false,false,false,10000,10000)
  set bj_questFailedSound=CreateSoundFromLabel("QuestFailed",false,false,false,10000,10000)
  set bj_questHintSound=CreateSoundFromLabel("Hint",false,false,false,10000,10000)
  set bj_questSecretSound=CreateSoundFromLabel("SecretFound",false,false,false,10000,10000)
  set bj_questItemAcquiredSound=CreateSoundFromLabel("ItemReward",false,false,false,10000,10000)
  set bj_questWarningSound=CreateSoundFromLabel("Warning",false,false,false,10000,10000)
  set bj_victoryDialogSound=CreateSoundFromLabel("QuestCompleted",false,false,false,10000,10000)
  set bj_defeatDialogSound=CreateSoundFromLabel("QuestFailed",false,false,false,10000,10000)
  call DelayedSuspendDecayCreate()
  set v=VersionGet()
  if(v==VERSION_REIGN_OF_CHAOS)then
    set bj_MELEE_MAX_TWINKED_HEROES=bj_MELEE_MAX_TWINKED_HEROES_V0
  else
    set bj_MELEE_MAX_TWINKED_HEROES=bj_MELEE_MAX_TWINKED_HEROES_V1
  endif
  call InitQueuedTriggers()
  call InitRescuableBehaviorBJ()
  call InitDNCSounds()
  call InitMapRects()
  call InitSummonableCaps()
  set T88=0
  loop
    set bj_stockAllowedPermanent[T88]=false
    set bj_stockAllowedCharged[T88]=false
    set bj_stockAllowedArtifact[T88]=false
    set T88=T88+1
    exitwhen T88>10
  endloop
  call SetAllItemTypeSlots(11)
  call SetAllUnitTypeSlots(11)
  set bj_stockUpdateTimer=CreateTimer()
  call TimerStart(bj_stockUpdateTimer,bj_STOCK_RESTOCK_INITIAL_DELAY,false,function TG8)
  set bj_stockItemPurchased=CreateTrigger()
  call TriggerRegisterPlayerUnitEvent(bj_stockItemPurchased,Player(15),EVENT_PLAYER_UNIT_SELL_ITEM,null)
  call TriggerAddAction(bj_stockItemPurchased,function RemovePurchasedItem)
  call DetectGameStarted()
  set i=0
  set i=0
  loop
    exitwhen(i>16)
    set unusedarray[i]=0
    set PlayerKillsStreak[i]=0
    set amhCounter[i]=0
    set MultikillCounter[i]=0
    set TrackBonusBounty[i]=0
    set i=i+1
  endloop
  set i=0
  loop
    exitwhen(i>NumberOfHeroes)
    set b_isHeroPicked[i]=false
    set IsHeroIngame[i]=false
    set WO[i]=0
    set i=i+1
  endloop
  set i=0
  loop
    exitwhen(i>4)
    set OwnageCounters[i]=0
    set i=i+1
  endloop
  set i=0
  loop
    exitwhen(i>2)
    set DeathmatchKillsCounter[i]=0
    set Deathmatch_LivesUsed[i]=0
    set i=i+1
  endloop
  set i=0
  loop
    exitwhen(i>12)
    set udg_Colors[i]=""
    set MultikillTimers[i]=CreateTimer()
    set i=i+1
  endloop
  set i=0
  loop
    exitwhen(i>13)
    set PlayerHaveRealHero[i]=false
    set PlayerHaveHero[i]=false
    set HeroRespawnTimer[i]=CreateTimer()
    set PlayerUseRandomStatus[i]=false
    set IsImpossibleToBuyback[i]=false
    set SDHeroesPoolInc[i]=0
    set ResetCooldown[i]=0
    set ReadyCooldown[i]=0
    set OO[i]=0
    set booleans050[i]=false
    set TrueshotCreeps[i]=true
    set i=i+1
  endloop
  set i=0
  loop
    exitwhen(i>1)
    set Mode_VR_b[i]=false
    set ItemsAbilities2[i]=0
    set F3[i]=false
    set i=i+1
  endloop
  set MinGoldForRepick=150
  set SentinelTopRangeRaxExists=true
  set SentinelMidRangeRaxExists=true
  set SentinelBottomRangeRaxExists=true
  set SentinelTopMeleeRaxExists=true
  set SentinelMidMeleeRaxExists=true
  set SentinelBottomMeleeRaxExists=true
  set ScourgeTopRangeRaxExists=true
  set ScourgeMidRangeRaxExists=true
  set ScourgeBottomRangeRaxExists=true
  set ScourgeTopMeleeRaxExists=true
  set ScourgeMidMeleeRaxExists=true
  set ScourgeBottomMeleeRaxExists=true
  set MeleeCreepsSpawnAmount=3
  set RangeCreepsSpawnAmount=1
  set i=0
  loop
    exitwhen(i>17)
    set udg_Hero[i]=null
    set HeroTypeId[i]=0
    set i=i+1
  endloop
  set Force_SentPlayers=CreateForce()
  set Force_ScourgePlayers=CreateForce()
  
  set AllPlayers=CreateForce()
  
  set udg_Allow_Random=true
  set udg_Allow_Repick=true
  set i=0
  loop
    exitwhen(i>14)
    set HasAlreadyPickedHero[i]=false
    set i=i+1
  endloop
  set i=0
  loop
    exitwhen(i>15)
    set PlayerSkillNumber[i*PlayerSkillOffset+1]=0
    set PlayerSkillNumber[i*PlayerSkillOffset+2]=0
    set PlayerSkillNumber[i*PlayerSkillOffset+3]=0
    set PlayerSkillNumber[i*PlayerSkillOffset+4]=0
    set PlayerSkillNumber[i*PlayerSkillOffset+5]=0
    set PlayerSkillNumber[i*PlayerSkillOffset+6]=0
    set L3[i]="Here"
    set i=i+1
  endloop
  call TK8()
  call UF8()
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,15,true)
  call TriggerAddCondition(t,Condition(function UJ8))
  set t=null
  set IsHeroDead[0]=false
  set IsHeroDead[1]=false
  set IsHeroDead[2]=false
  set IsHeroDead[3]=false
  set IsHeroDead[4]=false
  set IsHeroDead[5]=false
  set IsHeroDead[6]=false
  set IsHeroDead[7]=false
  set IsHeroDead[8]=false
  set IsHeroDead[9]=false
  set IsHeroDead[10]=false
  set IsHeroDead[11]=false
  set IsHeroDead[12]=false
  set IsHeroDead[13]=false
  set IsHeroDead[14]=false
  set IsHeroDead[15]=false
  set IsHeroDead[16]=false
  set EN=CreateRegion()
  call RegionAddRect(EN,boolean036)
  set GN=CreateRegion()
  call RegionAddRect(GN,Z5)
  set DN=CreateRegion()
  call RegionAddRect(DN,A6)
  call RegionAddRect(DN,B6)
  call RegionAddRect(DN,C6)
  set SomeRect4=CreateRegion()
  call RegionAddRect(SomeRect4,D6)
  call RegionAddRect(SomeRect4,E6)
  call RegionAddRect(SomeRect4,F6)
  set RestrictedRegion=CreateRegion()
  call RegionAddRect(RestrictedRegion,G6)
  call RegionAddRect(RestrictedRegion,H6)
  call RegionAddRect(RestrictedRegion,Z6)
  call RegionAddRect(RestrictedRegion,V6)
  call RegionAddRect(RestrictedRegion,W6)
  call RegionAddRect(RestrictedRegion,X6)
  call RegionAddRect(RestrictedRegion,Y6)
  call RegionAddRect(RestrictedRegion,J6)
  call RegionAddRect(RestrictedRegion,K6)
  call RegionAddRect(RestrictedRegion,L6)
  call RegionAddRect(RestrictedRegion,M6)
  call RegionAddRect(RestrictedRegion,N6)
  call RegionAddRect(RestrictedRegion,SomeRect3)
  call RegionAddRect(RestrictedRegion,T6)
  call RegionAddRect(RestrictedRegion,R6)
  call RegionAddRect(RestrictedRegion,P6)
  call RegionAddRect(RestrictedRegion,Q6)
  call RegionAddRect(RestrictedRegion,U6)
  call RegionAddRect(RestrictedRegion,I7)
  call RegionAddRect(RestrictedRegion,O7)
  call RegionAddRect(RestrictedRegion,A7)
  call RegionAddRect(RestrictedRegion,B7)
  call RegionAddRect(RestrictedRegion,C7)
  call RegionAddRect(RestrictedRegion,D7)
  call RegionAddRect(RestrictedRegion,E7)
  call RegionAddRect(RestrictedRegion,F7)
  call RegionAddRect(RestrictedRegion,G7)
  call RegionAddRect(RestrictedRegion,H7)
  call RegionAddRect(RestrictedRegion,Z7)
  call RegionAddRect(RestrictedRegion,V7)
  call RegionAddRect(RestrictedRegion,W7)
  call RegionAddRect(RestrictedRegion,X7)
  call RegionAddRect(RestrictedRegion,Y7)
  call RegionAddRect(RestrictedRegion,J7)
  call RegionAddRect(RestrictedRegion,K7)
  call RegionAddRect(RestrictedRegion,L7)
  call RegionAddRect(RestrictedRegion,M7)
  call RegionAddRect(RestrictedRegion,N7)
  call RegionAddRect(RestrictedRegion,S7)
  call RegionAddRect(RestrictedRegion,T7)
  call RegionAddRect(RestrictedRegion,R7)
  call RegionAddRect(RestrictedRegion,P7)
  call RegionAddRect(RestrictedRegion,Q7)
  call RegionAddRect(RestrictedRegion,U7)
  call RegionAddRect(RestrictedRegion,I8)
  call RegionAddRect(RestrictedRegion,O8)
  call RegionAddRect(RestrictedRegion,A8)
  call RegionAddRect(RestrictedRegion,B8)
  call RegionAddRect(RestrictedRegion,C8)
  call RegionAddRect(RestrictedRegion,D8)
  call RegionAddRect(RestrictedRegion,E8)
  call RegionAddRect(RestrictedRegion,F8)
  call RegionAddRect(RestrictedRegion,G8)
  call RegionAddRect(RestrictedRegion,H8)
  call RegionAddRect(RestrictedRegion,Z8)
  call RegionAddRect(RestrictedRegion,V8)
  call RegionAddRect(RestrictedRegion,W8)
  call RegionAddRect(RestrictedRegion,X8)
  call RegionAddRect(RestrictedRegion,Y8)
  call RegionAddRect(RestrictedRegion,J8)
  call RegionAddRect(RestrictedRegion,K8)
  call RegionAddRect(RestrictedRegion,L8)
  call RegionAddRect(RestrictedRegion,M8)
  call RegionAddRect(RestrictedRegion,N8)
  call RegionAddRect(RestrictedRegion,S8)
  call RegionAddRect(RestrictedRegion,T8)
  call RegionAddRect(RestrictedRegion,R8)
  call RegionAddRect(RestrictedRegion,P8)
  call RegionAddRect(RestrictedRegion,Q8)
  call RegionAddRect(RestrictedRegion,U8)
  call RegionAddRect(RestrictedRegion,integer032)
  call RegionAddRect(RestrictedRegion,strings006)
  call RegionAddRect(RestrictedRegion,integer036)
  call RegionAddRect(RestrictedRegion,B9)
  call RegionAddRect(RestrictedRegion,strings005)
  call RegionAddRect(RestrictedRegion,D9)
  call RegionAddRect(RestrictedRegion,integer033)
  call RegionAddRect(RestrictedRegion,F9)
  call RegionAddRect(RestrictedRegion,integer034)
  call RegionAddRect(RestrictedRegion,strings002)
  call RegionAddRect(RestrictedRegion,Z9)
  call RegionAddRect(RestrictedRegion,V9)
  call RegionAddRect(RestrictedRegion,W9)
  call RegionAddRect(RestrictedRegion,integer035)
  call RegionAddRect(RestrictedRegion,Y9)
  call RegionAddRect(RestrictedRegion,J9)
  call RegionAddRect(RestrictedRegion,integer038)
  call RegionAddRect(RestrictedRegion,L9)
  call RegionAddRect(RestrictedRegion,strings004)
  call RegionAddRect(RestrictedRegion,N9)
  call RegionAddRect(RestrictedRegion,S9)
  call RegionAddRect(RestrictedRegion,T9)
  call RegionAddRect(RestrictedRegion,strings003)
  call RegionAddRect(RestrictedRegion,integer037)
  call RegionAddRect(RestrictedRegion,strings007)
  call AddDispellableBuff('A1W3')
  call AddDispellableBuff('A317')
  call AddDispellableBuff('A315')
  call AddDispellableBuff('A314')
  call AddDispellableBuff('A313')
  call AddDispellableBuff('A312')
  call AddDispellableBuff('A310')
  call AddDispellableBuff('A30Y')
  call AddDispellableBuff('B307')
  call AddDispellableBuff('A334')
  call AddDispellableBuff('A335')
  call AddDispellableBuff('B08B')
  call AddDispellableBuff('B083')
  
  call AddDispellableBuff('B06Z')
  call AddDispellableBuff('B0GR')
  call AddDispellableBuff('B0GT')
  call AddDispellableBuff('B0GK')
  call AddDispellableBuff('B0GG')
  call AddDispellableBuff('A2L8')
  call AddDispellableBuff('BPSE')
  call AddDispellableBuff('B06Q')
  call AddDispellableBuff('BSTN')
  call AddDispellableBuff('BHtc')
  call AddDispellableBuff('B0BM')
  call AddDispellableBuff('B0BR')
  call AddDispellableBuff('B0C1')
  call AddDispellableBuff('BEer')
  call AddDispellableBuff('B02U')
  call AddDispellableBuff('B07E')
  call AddDispellableBuff('B0CF')
  call AddDispellableBuff('B06M')
  call AddDispellableBuff('B07N')
  call AddDispellableBuff('B08S')
  call AddDispellableBuff('B00Q')
  call AddDispellableBuff('B072')
  call AddDispellableBuff('BUan')
  call AddDispellableBuff('B095')
  call AddDispellableBuff('B083')
  call AddDispellableBuff('B02V')
  call AddDispellableBuff('B01Y')
  call AddDispellableBuff('BNab')
  call AddDispellableBuff('B08R')
  call AddDispellableBuff('B066')
  call AddDispellableBuff('B03I')
  call AddDispellableBuff('B063')
  call AddDispellableBuff('Bena')
  call AddDispellableBuff('Beng')
  call AddDispellableBuff('B03C')
  call AddDispellableBuff('B00L')
  call AddDispellableBuff('BHca')
  call AddDispellableBuff('Bcsd')
  call AddDispellableBuff('B079')
  call AddDispellableBuff('B0BQ')
  call AddDispellableBuff('B0B9')
  call AddDispellableBuff('Bprg')
  call AddDispellableBuff('B08M')
  call AddDispellableBuff('B02G')
  call AddDispellableBuff('B01X')
  call AddDispellableBuff('B01D')
  call AddDispellableBuff('B092')
  call AddDispellableBuff('B0AQ')
  call AddDispellableBuff('BEsh')
  //call AddDispellableBuff('B001')
  call AddDispellableBuff('B017')
  call AddDispellableBuff('B0AE')
  call AddDispellableBuff('B0AD')
  call AddDispellableBuff('B08O')
  call AddDispellableBuff('Bfro')
  call AddDispellableBuff('B027')
  call AddDispellableBuff('B028')
  call AddDispellableBuff('B05H')
  call AddDispellableBuff('B0BS')
  call AddDispellableBuff('Bcri')
  call AddDispellableBuff('B0BF')
  call AddDispellableBuff('B0BE')
  call AddDispellableBuff('B090')
  call AddDispellableBuff('B008')
  call AddDispellableBuff('B04B')
  call AddDispellableBuff('B02F')
  call AddDispellableBuff('BUsp')
  call AddDispellableBuff('Bust')
  call AddDispellableBuff('B0CC')
  call AddDispellableBuff('BCri')
  call AddDispellableBuff('B03J')
  call AddDispellableBuff('BEsh')
  //call AddDispellableBuff('B001')
  call AddDispellableBuff('B0AQ')
  call AddDispellableBuff('Bena')
  call AddDispellableBuff('Beng')
  call AddDispellableBuff('B078')
  call AddDispellableBuff('Bdet')
  call AddDispellableBuff('B00T')
  call AddDispellableBuff('Bslo')
  call AddDispellableBuff('BNdh')
  call AddDispellableBuff('B0C8')
  call AddDispellableBuff('B08O')
  call AddDispellableBuff('B07V')
  call AddDispellableBuff('B07U')
  call AddDispellableBuff('B01X')
  call AddDispellableBuff('BNsi')
  call AddDispellableBuff('B031')
  call AddDispellableBuff('BNso')
  call AddDispellableBuff('B00P')
  call AddDispellableBuff('B02M')
  call AddDispellableBuff('A1LD')
  call AddDispellableBuff('B0CD')
  call AddDispellableBuff('A1JA')
  call AddDispellableBuff('B043')
  call AddDispellableBuff('BNpa')
  call AddDispellableBuff('B01N')
  call AddDispellableBuff('BIcb')
  call AddDispellableBuff('B04Q')
  call AddDispellableBuff('B00C')
  call AddDispellableBuff('B09K')
  call AddDispellableBuff('B033')
  call AddDispellableBuff('B08F')
  call AddDispellableBuff('B08E')
  call AddDispellableBuff('Bpoi')
  call AddDispellableBuff('B0AM')
  call AddDispellableBuff('BNrd')
  call AddDispellableBuff('B00H')
  call AddDispellableBuff('BOhx')
  call AddDispellableBuff('B03F')
  call AddDispellableBuff('B02N')
  call AddDispellableBuff('B0E7')
  call AddDispellableBuff('B06D')
  call AddDispellableBuff('B0BN')
  call AddDispellableBuff('B09Q')
  call AddDispellableBuff('B0DI')
  call AddDispellableBuff('B0BB')
  call AddDispellableBuff('B09J')
  call AddDispellableBuff('B0AF')
  call AddDispellableBuff('B08B')
  call AddDispellableBuff('B071')
  call AddDispellableBuff('B08N')
  call AddDispellableBuff('B02I')
  call AddDispellableBuff('B08Q')
  call AddDispellableBuff('B0C2')
  call AddDispellableBuff('B06S')
  call AddDispellableBuff('B02S')
  call AddDispellableBuff('B02W')
  call AddDispellableBuff('B05Q')
  call AddDispellableBuff('B02D')
  call AddDispellableBuff('B0BY')
  call AddDispellableBuff('B02P')
  call AddDispellableBuff('B05F')
  call AddDispellableBuff('B0EP')
  call AddDispellableBuff('B0ER')
  call AddDispellableBuff('B0ET')
  call AddDispellableBuff('B0FN')
  call AddDispellableBuff('B0FY')
  call AddDispellableBuff('B0FT')
  call AddDispellableBuff('B0FZ')
  call AddDispellableBuff('B0G0')
  call AddDispellableBuff('B0F5')
  
  call AddPositiveBuffToList('Broa')
  call AddPositiveBuffToList('B014')
  call AddPositiveBuffToList('B00G')
  call AddPositiveBuffToList('B016')
  call AddPositiveBuffToList('B077')
  call AddPositiveBuffToList('B0FP')
  call AddPositiveBuffToList('B0FQ')
  call AddPositiveBuffToList('Bblo')
  call AddPositiveBuffToList('B013')
  
  
  
  
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function EH9))
  
  set t=null
  call FlushGameCache(InitGameCache("dr.x"))
  set MN=InitGameCache("dr.x")
  call FlushGameCache(InitGameCache("d"))
  set RGCGC=InitGameCache("d")
  call FlushGameCache(InitGameCache("meta"))
  set RGCGC2=InitGameCache("meta")
  call FlushGameCache(InitGameCache("mapid"))
  set RGCGC3=InitGameCache("mapid")
  set BonusDamageSystemCont[0]='A17F'
  set BonusDamageSystemCont[1]='A17G'
  set BonusDamageSystemCont[2]='A17H'
  set BonusDamageSystemCont[3]='A17C'
  set BonusDamageSystemCont[4]='A17D'
  set BonusDamageSystemCont[5]='A17E'
  set BonusDamageSystemCont[6]='A17J'
  set BonusDamageSystemCont[7]='A17I'
  set BonusDamageSystemCont[8]='A17L'
  set BonusMSPercentSystem[0]='USS0'
  set BonusMSPercentSystem[1]='USS1'
  set BonusMSPercentSystem[2]='USS2'
  set BonusMSPercentSystem[3]='USS3'
  set BonusMSPercentSystem[4]='USS4'
  set BonusMSPercentSystem[5]='USS5'
  set BonusMSPercentSystem[6]='USS6'
  set BonusMSPercentSystem[7]='USS7'
  set BonusMSPercentSystem[8]='USS8'
  set BonusMSPercentSystem[9]='USS9'
  call HideAbility('A344')
  call HideAbility('USS0')
  call HideAbility('USS1')
  call HideAbility('USS2')
  call HideAbility('USS3')
  call HideAbility('USS4')
  call HideAbility('USS5')
  call HideAbility('USS6')
  call HideAbility('USS7')
  call HideAbility('USS8')
  call HideAbility('USS9')
  call HideAbility('A2J9')//legion's spellbooks
  call HideAbility('A2JA')
  call HideAbility('A2J8')
  call HideAbility('A2J7')
  call HideAbility('A27S')//rubick's null field containers
  call HideAbility('A27Q')
  call HideAbility('A27R')
  call HideAbility('A1IE')//Shadow dance containers
  call HideAbility('A1IF')
  call HideAbility('A1IG')
  call HideAbility('A2QA')//Meepo resistance
  call HideAbility('A27T')
  call HideAbility('A1CA')//Chieftain's containers
  call HideAbility('A1C9')
  call HideAbility('A1CB')
  call HideAbility('A1CC')
  call HideAbility('QF9E')//Troll's Bash
  call HideAbility('A1LD')//Ice Blast debuff 
  call HideAbility('A1UH')//Walrus punch crit
  call HideAbility('A1UI')
  call HideAbility('A1HZ')//Ice Vortex
  call HideAbility('A1I4')
  call HideAbility('A1I3')
  call HideAbility('A1I6')
  set EvasionContainers[0]='EVS0'
  set EvasionContainers[1]='EVS1'
  set EvasionContainers[2]='EVS2'
  set EvasionContainers[3]='EVS3'
  set EvasionContainers[4]='EVS4'
  set EvasionContainers[5]='EVS5'
  set EvasionContainers[6]='EVS6'
  set EvasionContainers[7]='EVS7'
  set EvasionContainers[8]='EVS8'
  call HideAbility(EvasionContainers[0])
  call HideAbility(EvasionContainers[1])
  call HideAbility(EvasionContainers[2])
  call HideAbility(EvasionContainers[3])
  call HideAbility(EvasionContainers[4])
  call HideAbility(EvasionContainers[5])
  call HideAbility(EvasionContainers[6])
  call HideAbility(EvasionContainers[7])
  call HideAbility(EvasionContainers[8])
  
  set SN[0]='A1QE'
  set SN[1]='A1QF'
  set SN[2]='A1QI'
  set SN[3]='A1QK'
  set SN[4]='A1QJ'
  set SN[5]='A1QH'
  set SN[6]='A1QO'
  set SN[7]='A1QN'
  set SN[8]='A1QM'
  set SN[9]='A1QG'
  set SN[10]='A1QQ'
  set TN[0]='A1GK'
  set TN[1]='A1GL'
  set TN[2]='A1GJ'
  set TN[3]='A1GP'
  set TN[4]='A1GM'
  set TN[5]='A1GN'
  set TN[6]='A1GO'
  set TN[7]='A1GI'
  set TN[8]='A1GQ'
  set RN[0]='A1CM'
  set RN[1]='A1CK'
  set RN[2]='A1CF'
  set RN[3]='A1CI'
  set RN[4]='A1CG'
  set RN[5]='A1CH'
  set ArmletStrBonus[0]='ARM0'
  set ArmletStrBonus[1]='ARM1'
  set ArmletStrBonus[2]='ARM2'
  set ArmletStrBonus[3]='ARM3'
  set ArmletStrBonus[4]='ARM4'
  set PN=CreateTrigger()
  call TriggerAddCondition(PN,Condition(function GS9))
  set BuybackUnitId[0]='h09G'
  set BuybackUnitCost[0]=50
  set BuybackUnitId[1]='h09T'
  set BuybackUnitCost[1]=100
  set BuybackUnitId[2]='h09F'
  set BuybackUnitCost[2]=150
  set BuybackUnitId[3]='h09H'
  set BuybackUnitCost[3]=200
  set BuybackUnitId[4]='h09E'
  set BuybackUnitCost[4]=250
  set BuybackUnitId[5]='h09D'
  set BuybackUnitCost[5]=300
  set BuybackUnitId[6]='h09C'
  set BuybackUnitCost[6]=350
  set BuybackUnitId[7]='h09B'
  set BuybackUnitCost[7]=400
  set BuybackUnitId[8]='h099'
  set BuybackUnitCost[8]=450
  set BuybackUnitId[9]='h09A'
  set BuybackUnitCost[9]=500
  set BuybackUnitId[10]='h09J'
  set BuybackUnitCost[10]=550
  set BuybackUnitId[11]='h09K'
  set BuybackUnitCost[11]=600
  set BuybackUnitId[12]='h09L'
  set BuybackUnitCost[12]=650
  set BuybackUnitId[13]='h09M'
  set BuybackUnitCost[13]=700
  set BuybackUnitId[14]='h09N'
  set BuybackUnitCost[14]=750
  set BuybackUnitId[15]='h09O'
  set BuybackUnitCost[15]=800
  set BuybackUnitId[16]='h09P'
  set BuybackUnitCost[16]=850
  set BuybackUnitId[17]='h09Q'
  set BuybackUnitCost[17]=900
  set BuybackUnitId[18]='h09R'
  set BuybackUnitCost[18]=950
  set BuybackUnitId[19]='h09S'
  set BuybackUnitCost[19]=1000
  set BuybackUnitId[20]='h09I'
  set BuybackUnitCost[20]=1050
  set BuybackUnitId[21]='h09Z'
  set BuybackUnitCost[21]=1100
  set BuybackUnitId[22]='h09X'
  set BuybackUnitCost[22]=1150
  set BuybackUnitId[23]='h0A1'
  set BuybackUnitCost[23]=1200
  set BuybackUnitId[24]='h0A2'
  set BuybackUnitCost[24]=1250
  set BuybackUnitId[25]='h0A6'
  set BuybackUnitCost[25]=1300
  set BuybackUnitId[26]='h0A3'
  set BuybackUnitCost[26]=1350
  set BuybackUnitId[27]='h0A4'
  set BuybackUnitCost[27]=1400
  set BuybackUnitId[28]='h09Y'
  set BuybackUnitCost[28]=1450
  set BuybackUnitId[29]='h09V'
  set BuybackUnitCost[29]=1500
  set BuybackUnitId[30]='h0A0'
  set BuybackUnitCost[30]=1550
  set BuybackUnitId[31]='h09U'
  set BuybackUnitCost[31]=1600
  set BuybackUnitId[32]='h0AF'
  set BuybackUnitCost[32]=1650
  set BuybackUnitId[33]='h0AD'
  set BuybackUnitCost[33]=1700
  set BuybackUnitId[34]='h0AE'
  set BuybackUnitCost[34]=1750
  set BuybackUnitId[35]='h0AC'
  set BuybackUnitCost[35]=1800
  set BuybackUnitId[36]='h0AB'
  set BuybackUnitCost[36]=1850
  set BuybackUnitId[37]='h0AA'
  set BuybackUnitCost[37]=1900
  set BuybackUnitId[38]='h0A9'
  set BuybackUnitCost[38]=1950
  set BuybackUnitId[39]='h0AG'
  set BuybackUnitCost[39]=2000
  set BuybackUnitId[40]='h0A7'
  set BuybackUnitCost[40]=2050
  set BuybackUnitId[41]='h0AO'
  set BuybackUnitCost[41]=2100
  set BuybackUnitId[42]='h0AY'
  set BuybackUnitCost[42]=2150
  set BuybackUnitId[43]='h0AH'
  set BuybackUnitCost[43]=2200
  set BuybackUnitId[44]='h0AI'
  set BuybackUnitCost[44]=2250
  set BuybackUnitId[45]='h0AJ'
  set BuybackUnitCost[45]=2300
  set BuybackUnitId[46]='h0AP'
  set BuybackUnitCost[46]=2350
  set BuybackUnitId[47]='h0AQ'
  set BuybackUnitCost[47]=2400
  set BuybackUnitId[48]='h0AK'
  set BuybackUnitCost[48]=2450
  set BuybackUnitId[49]='h0AR'
  set BuybackUnitCost[49]=2500
  set BuybackUnitId[50]='h0AL'
  set BuybackUnitCost[50]=2550
  set BuybackUnitId[51]='h0AS'
  set BuybackUnitCost[51]=2600
  set BuybackUnitId[52]='h09W'
  set BuybackUnitCost[52]=2650
  set BuybackUnitId[53]='h0AM'
  set BuybackUnitCost[53]=2700
  set BuybackUnitId[54]='h0A8'
  set BuybackUnitCost[54]=2750
  set BuybackUnitId[55]='h0AT'
  set BuybackUnitCost[55]=2800
  set BuybackUnitId[56]='h0AU'
  set BuybackUnitCost[56]=2850
  set BuybackUnitId[57]='h0AN'
  set BuybackUnitCost[57]=2900
  set BuybackUnitId[58]='h0AV'
  set BuybackUnitCost[58]=2950
  set BuybackUnitId[59]='h0AW'
  set BuybackUnitCost[59]=3000
  set UN[0]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[1]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[2]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[3]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[4]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[5]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[6]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[7]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[8]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[9]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[10]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[11]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[12]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[13]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set UN[14]=BuybackUnitId[DefineBuybackUnitIndex(1)]
  set hashtable019=InitHashtable()
  set GlobalTimer=CreateTimer()
  set CS=Rect(-7040,-7680,7040,7168)
  call SetFloatGameState(GAME_STATE_TIME_OF_DAY,6.)
  call SuspendTimeOfDay(false)
  //call SetTimeOfDayScale(.5)
  call SetSkyModel("Environment\\Sky\\FoggedSky\\FoggedSky.mdl")
  call SetCreepCampFilterState(true)
  set MainModeInTxt="Normal Mode"
  call TimerStart(GlobalTimer,99999.,false,null)
  set Weather_Rain=AddWeatherEffect(bj_mapInitialPlayableArea,'RAhr')
  set Weather_Snow=AddWeatherEffect(bj_mapInitialPlayableArea,'SNbs')
  set Weather_Moonlight=AddWeatherEffect(bj_mapInitialPlayableArea,'LRma')
  set Weather_Wind=AddWeatherEffect(bj_mapInitialPlayableArea,'WOlw')
  set Sentinels[0]=Player(0)
  set Sentinels[1]=Player(1)
  set Sentinels[2]=Player(2)
  set Sentinels[3]=Player(3)
  set Sentinels[4]=Player(4)
  set Sentinels[5]=Player(5)
  set Scourges[0]=Player(6)
  set Scourges[1]=Player(7)
  set Scourges[2]=Player(8)
  set Scourges[3]=Player(9)
  set Scourges[4]=Player(10)
  set Scourges[5]=Player(11)
  set NeutralsPlayer=Player(12)
  call SetUnitPathing(SentBaseWaypointDummy,false)
  call SetUnitPathing(BottomWaypointDummy,false)
  call SetUnitPathing(MidWaypointDummy,false)
  call SetUnitPathing(TopWaypointDummy,false)
  call SetUnitPathing(ScouBaseWaypointDummy,false)
  call SetUnitInvulAdvanced(ScouBaseWaypointDummy,true)
  call SetUnitInvulAdvanced(TopWaypointDummy,true)
  call SetUnitInvulAdvanced(MidWaypointDummy,true)
  call SetUnitInvulAdvanced(BottomWaypointDummy,true)
  call SetUnitInvulAdvanced(SentBaseWaypointDummy,true)
  set FrozenThroneCreepsWaypoint=GetUnitLoc(ScouBaseWaypointDummy)
  set TreeOfLifeCreepsWaypoint=GetUnitLoc(SentBaseWaypointDummy)
  set MidCreepsWaypoint=GetUnitLoc(MidWaypointDummy)
  set TopCreepsWaypoint=GetUnitLoc(TopWaypointDummy)
  set BottomCreepsWaypoint=GetUnitLoc(BottomWaypointDummy)
  set WaypointAbilID='A06G'
  set WaypointLocations[1]=TreeOfLifeCreepsWaypoint
  set WaypointLocations[2]=TopCreepsWaypoint
  set WaypointLocations[3]=MidCreepsWaypoint
  set WaypointLocations[4]=BottomCreepsWaypoint
  set WaypointLocations[5]=FrozenThroneCreepsWaypoint
  set ScourgeMidMeleeSpawn=GetRectCenter(ScouMidMeleeSpawnRect)
  set ScourgeTopMeleeSpawn=GetRectCenter(ScouTopMeleeSpawnRect)
  set ScourgeBottomMeleeSpawn=GetRectCenter(ScouBotMeleeSpawnRect)
  set ScourgeMidRangeSpawn=GetRectCenter(ScouMidRangeSpawnRect)
  set ScourgeTopRangeSpawn=GetRectCenter(ScouTopRangeSpawnRect)
  set ScourgeBottomRangeSpawn=GetRectCenter(ScouBotRangeSpawnRect)
  set SentinelMidMeleeSpawn=GetRectCenter(SentMidMeleeSpawnRect)
  set SentinelTopMeleeSpawn=GetRectCenter(SentTopMeleeSpawnRect)
  set SentinelBottomMeleeSpawn=GetRectCenter(SentBotMeleeSpawnRect)
  set SentinelMidRangeSpawn=GetRectCenter(SentMidRangeSpawnRect)
  set SentinelTopRangeSpawn=GetRectCenter(SentTopRangeSpawnRect)
  set SentinelBottomRangeSpawn=GetRectCenter(SentBotRangeSpawnRect)
  set TopRuneSpawn=GetRectCenter(TopRuneSpawnRect)
  set BottomRuneSpawn=GetRectCenter(BottomRuneSpawnRect)
  set Mode_Normal=true
  set SentFountain=CreateUnit(Sentinels[0],'nfoh',-7232,-7136,270)
  set SentinelBuilding_ShopCache=CreateUnit(Player15,'hC95',-6880,-7136,270)
  set SentinelBuilding_ShopWeapon=CreateUnit(Player15,'n01K',-7264,-6688,270)
  set SentinelBuilding_ShopAccessorizer=CreateUnit(Player15,'nC38',-7264,-6880,270)
  set SentinelBuilding_ShopChimaera=CreateUnit(Player15,'e025',-6624,-7136,270)
  
  set SentinelBuilding_Shop1=CreateUnit(Player15,'n00V',-6816,-6368,270)
  set SentinelBuilding_Shop2=CreateUnit(Player15,'n00W',-7200,-6432,270)
  set SentinelBuilding_Shop3=CreateUnit(Player15,'n002',-6688,-6368,270)
  set SentinelBuilding_Shop4=CreateUnit(Player15,'n00X',-7072,-6368,270)
  set SentinelBuilding_Shop5=CreateUnit(Player15,'n009',-6560,-6432,270)
  set SentinelBuilding_Shop6=CreateUnit(Player15,'n0HE',-6944,-6368,270)
  set NQ=CreateUnit(Sentinels[0],'etol',-5632,-6144,270)
  set SQ=CreateUnit(Sentinels[0],'e00R',-6112,1568,90)
  set TQ=CreateUnit(Sentinels[0],'e00R',-1504,-1824,45)
  set integer025=CreateUnit(Sentinels[0],'e00R',4960,-6752,0)
  set boolean031=CreateUnit(Sentinels[0],'e011',-6112,-1248,90)
  set integer027=CreateUnit(Sentinels[0],'e011',-3488,-3296,45)
  set string005=CreateUnit(Sentinels[0],'e011',-544,-6688,0)
  set E47=CreateUnit(Sentinels[0],'e00S',-6368,-4256,90)
  set E77=CreateUnit(Sentinels[0],'e00S',-4448,-4960,45)
  set E87=CreateUnit(Sentinels[0],'e00S',-3744,-6816,0)
  set E97=CreateUnit(Sentinels[0],'e019',-5600,-5728,45)
  set ED7=CreateUnit(Sentinels[0],'e019',-5280,-6112,45)
  set EE7=CreateUnit(Sentinels[0],'eaom',-6080,-4480,90)
  set EF7=CreateUnit(Sentinels[0],'eaom',-4416,-5312,45)
  set EG7=CreateUnit(Sentinels[0],'eaom',-4032,-7040,0)
  set EH7=CreateUnit(Sentinels[0],'eaoe',-6656,-4480,90)
  set EI7=CreateUnit(Sentinels[0],'eaoe',-4864,-4992,45)
  set EJ7=CreateUnit(Sentinels[0],'eaoe',-4032,-6528,0)
  set EK7=CreateUnit(Sentinels[0],'emow',-5792,-5408,270)
  set EM7=CreateUnit(Sentinels[0],'emow',-6624,-5088,270)
  set EN7=CreateUnit(Sentinels[0],'emow',-5344,-3936,270)
  set EO7=CreateUnit(Sentinels[0],'emow',-5088,-4576,270)
  set EP7=CreateUnit(Sentinels[0],'emow',-3936,-5344,270)
  set EQ7=CreateUnit(Sentinels[0],'emow',-5088,-5536,270)
  set ER7=CreateUnit(Sentinels[0],'emow',-4896,-6240,270)
  set ES7=CreateUnit(Sentinels[0],'emow',-3808,-5856,270)
  set ET7=CreateUnit(Sentinels[0],'emow',-4512,-7072,270)
  set EU7=CreateUnit(Sentinels[0],'emow',-5472,-4704,270)
  set EV7=CreateUnit(Sentinels[0],'emow',-4512,-5856,270)
  set EW7=CreateUnit(Sentinels[0],'eaow',-6080,-5120,270)
  set EX7=CreateUnit(Sentinels[0],'eaow',-4544,-6528,270)
  set EY7=CreateUnit(Sentinels[0],'edob',-6400,-5696,270)
  set EZ7=CreateUnit(Sentinels[0],'edob',-5248,-6848,270)
  call SetPlayerAbilityAvailable2(Player15,'Aro1',false)
  call SetUnitColor(SentinelBuilding_ShopCache,ES)
  call SetUnitColor(SentinelBuilding_ShopChimaera,ES)
  call SetUnitColor(SentinelBuilding_ShopAccessorizer,FS)
  call SetUnitColor(SentinelBuilding_ShopWeapon,FS)
  call SetUnitColor(SentinelBuilding_Shop1,FS)
  call SetUnitColor(SentinelBuilding_Shop2,FS)
  call SetUnitColor(SentinelBuilding_Shop3,FS)
  call SetUnitColor(SentinelBuilding_Shop4,FS)
  call SetUnitColor(SentinelBuilding_Shop5,FS)
  call SetUnitInvulAdvanced(SQ,true)
  call SetUnitInvulAdvanced(TQ,true)
  call SetUnitInvulAdvanced(integer025,true)
  call SetUnitInvulAdvanced(boolean031,true)
  call SetUnitInvulAdvanced(integer027,true)
  call SetUnitInvulAdvanced(string005,true)
  call SetUnitInvulAdvanced(E47,true)
  call SetUnitInvulAdvanced(E77,true)
  call SetUnitInvulAdvanced(E87,true)
  call SetUnitInvulAdvanced(E97,true)
  call SetUnitInvulAdvanced(ED7,true)
  call SetUnitInvulAdvanced(NQ,true)
  call SetUnitInvulAdvanced(EE7,true)
  call SetUnitInvulAdvanced(EF7,true)
  call SetUnitInvulAdvanced(EG7,true)
  call SetUnitInvulAdvanced(EH7,true)
  call SetUnitInvulAdvanced(EI7,true)
  call SetUnitInvulAdvanced(EJ7,true)
  call SetUnitInvulAdvanced(EW7,true)
  call SetUnitInvulAdvanced(EX7,true)
  call SetUnitInvulAdvanced(EY7,true)
  call SetUnitInvulAdvanced(EZ7,true)
  call SetUnitInvulAdvanced(EK7,true)
  call SetUnitInvulAdvanced(EM7,true)
  call SetUnitInvulAdvanced(EN7,true)
  call SetUnitInvulAdvanced(EO7,true)
  call SetUnitInvulAdvanced(EP7,true)
  call SetUnitInvulAdvanced(EQ7,true)
  call SetUnitInvulAdvanced(ER7,true)
  call SetUnitInvulAdvanced(ES7,true)
  call SetUnitInvulAdvanced(ET7,true)
  call SetUnitInvulAdvanced(EU7,true)
  call SetUnitInvulAdvanced(EV7,true)
  set EC7=6784
  set E37=6368
  
  set ScourgeFountain=CreateUnit(Scourges[0],'ndfl',6784,6368,270)
  set ScourgeBuilding_ShopGateway=CreateUnit(Player15,'nC35',6816,5984,270)
  set ScourgeBuilding_ShopWeapon=CreateUnit(Player15,'n01K',6304,6368,270)
  set ScourgeBuilding_ShopAccessorizer=CreateUnit(Player15,'nC38',6496,6368,270)
  set ScourgeBuilding_ShopGraveyard=CreateUnit(Player15,'u00Q',6816,5664,270)
  set ScourgeBuilding_Shop1=CreateUnit(Player15,'n00V',5920,6048,0)
  set ScourgeBuilding_Shop2=CreateUnit(Player15,'n00W',5984,6432,0)
  set ScourgeBuilding_Shop3=CreateUnit(Player15,'n002',5920,5920,0)
  set ScourgeBuilding_Shop4=CreateUnit(Player15,'n00X',5920,6304,0)
  set ScourgeBuilding_Shop5=CreateUnit(Player15,'n009',5984,5792,0)
  set ScourgeBuilding_Shop6=CreateUnit(Player15,'n0HE',5920,6176,0)
  set FrozenThrone=CreateUnit(Scourges[0],'unpl',5184,4864,220)
  set Towers_Scourge_Top_1=CreateUnit(Scourges[0],'u00M',-4704,5920,270)
  set Towers_Scourge_Mid_1=CreateUnit(Scourges[0],'u00M',1056,-96,270)
  set Towers_Scourge_Bot_1=CreateUnit(Scourges[0],'u00M',6048,-2080,270)
  set Towers_Scourge_Top_2=CreateUnit(Scourges[0],'u00D',32,5920,270)
  set Towers_Scourge_Mid_2=CreateUnit(Scourges[0],'u00D',2528,1824,270)
  set Towers_Scourge_Bot_2=CreateUnit(Scourges[0],'u00D',6304,-96,270)
  set Towers_Scourge_Top_3=CreateUnit(Scourges[0],'u00N',2976,5792,270)
  set Towers_Scourge_Mid_3=CreateUnit(Scourges[0],'u00N',3936,3488,270)
  set Towers_Scourge_Bot_3=CreateUnit(Scourges[0],'u00N',6368,2528,270)
  set Towers_Scourge_Throne1=CreateUnit(Scourges[0],'u00T',4832,4832,270)
  set Towers_Scourge_Throne2=CreateUnit(Scourges[0],'u00T',5152,4512,270)
  set HL7=CreateUnit(Scourges[0],'usep',3392,5504,270)
  set H17=CreateUnit(Scourges[0],'usep',4352,3584,270)
  set H07=CreateUnit(Scourges[0],'usep',6656,2880,270)
  set H57=CreateUnit(Scourges[0],'utod',3392,6080,270)
  set H27=CreateUnit(Scourges[0],'utod',3904,3904,270)
  set I47=CreateUnit(Scourges[0],'utod',6080,2944,270)
  set I77=CreateUnit(Scourges[0],'uzig',2656,4704,270)
  set I87=CreateUnit(Scourges[0],'uzig',3168,4064,270)
  set I97=CreateUnit(Scourges[0],'uzig',3488,4832,270)
  set ID7=CreateUnit(Scourges[0],'uzig',4128,6240,270)
  set IE7=CreateUnit(Scourges[0],'uzig',4064,5280,270)
  set IF7=CreateUnit(Scourges[0],'uzig',4384,4256,270)
  set IG7=CreateUnit(Scourges[0],'uzig',5728,4000,270)
  set IH7=CreateUnit(Scourges[0],'uzig',5536,2464,270)
  set II7=CreateUnit(Scourges[0],'uzig',5024,3744,270)
  set IJ7=CreateUnit(Scourges[0],'uzig',6880,3936,270)
  set IK7=CreateUnit(Scourges[0],'uzig',4640,2848,270)
  set IM7=CreateUnit(Scourges[0],'usap',3968,5888,270)
  set IN7=CreateUnit(Scourges[0],'usap',6400,3584,270)
  set IO7=CreateUnit(Scourges[0],'ubon',4992,5952,270)
  set IP7=CreateUnit(Scourges[0],'ubon',6464,4608,270)
  call SetUnitColor(ScourgeBuilding_ShopGateway,EA7)
  call SetUnitColor(ScourgeBuilding_ShopAccessorizer,EB7)
  call SetUnitColor(ScourgeBuilding_ShopWeapon,EB7)
  call SetUnitColor(ScourgeBuilding_Shop1,EB7)
  call SetUnitColor(ScourgeBuilding_Shop2,EB7)
  call SetUnitColor(ScourgeBuilding_Shop3,EB7)
  call SetUnitColor(ScourgeBuilding_Shop4,EB7)
  call SetUnitColor(ScourgeBuilding_Shop5,EB7)
  call SetUnitInvulAdvanced(Towers_Scourge_Top_1,true)
  call SetUnitInvulAdvanced(Towers_Scourge_Mid_1,true)
  call SetUnitInvulAdvanced(Towers_Scourge_Bot_1,true)
  call SetUnitInvulAdvanced(Towers_Scourge_Top_2,true)
  call SetUnitInvulAdvanced(Towers_Scourge_Mid_2,true)
  call SetUnitInvulAdvanced(Towers_Scourge_Bot_2,true)
  call SetUnitInvulAdvanced(Towers_Scourge_Top_3,true)
  call SetUnitInvulAdvanced(Towers_Scourge_Mid_3,true)
  call SetUnitInvulAdvanced(Towers_Scourge_Bot_3,true)
  call SetUnitInvulAdvanced(Towers_Scourge_Throne1,true)
  call SetUnitInvulAdvanced(Towers_Scourge_Throne2,true)
  call SetUnitInvulAdvanced(FrozenThrone,true)
  call SetUnitInvulAdvanced(HL7,true)
  call SetUnitInvulAdvanced(H17,true)
  call SetUnitInvulAdvanced(H07,true)
  call SetUnitInvulAdvanced(H57,true)
  call SetUnitInvulAdvanced(H27,true)
  call SetUnitInvulAdvanced(I47,true)
  call SetUnitInvulAdvanced(IM7,true)
  call SetUnitInvulAdvanced(IN7,true)
  call SetUnitInvulAdvanced(IO7,true)
  call SetUnitInvulAdvanced(IP7,true)
  call SetUnitInvulAdvanced(I77,true)
  call SetUnitInvulAdvanced(I87,true)
  call SetUnitInvulAdvanced(I97,true)
  call SetUnitInvulAdvanced(ID7,true)
  call SetUnitInvulAdvanced(IE7,true)
  call SetUnitInvulAdvanced(IF7,true)
  call SetUnitInvulAdvanced(IG7,true)
  call SetUnitInvulAdvanced(IH7,true)
  call SetUnitInvulAdvanced(II7,true)
  call SetUnitInvulAdvanced(IJ7,true)
  call SetUnitInvulAdvanced(IK7,true)
  set HI9=25
  set CirclesOfPower_1=CreateUnit(Player(1),'ncop',-7424,-6976,270)
  call UnitAddAbility(CirclesOfPower_1,'A141')
  call ClearSelectionForPlayer(Player(1))
  call SelectUnitAddForPlayer(CirclesOfPower_1,Player(1))
  if GetLocalPlayer()==Player(1)then
    call SetUnitVertexColor(CirclesOfPower_1,255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower_1,255,255,255,HI9)
  endif
  set CirclesOfPower_2=CreateUnit(Player(2),'ncop',-7424,-6848,270)
  call UnitAddAbility(CirclesOfPower_2,'A141')
  call ClearSelectionForPlayer(Player(2))
  call SelectUnitAddForPlayer(CirclesOfPower_2,Player(2))
  if GetLocalPlayer()==Player(2)then
    call SetUnitVertexColor(CirclesOfPower_2,255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower_2,255,255,255,HI9)
  endif
  set CirclesOfPower_3=CreateUnit(Player(3),'ncop',-7424,-6720,270)
  call UnitAddAbility(CirclesOfPower_3,'A141')
  call ClearSelectionForPlayer(Player(3))
  call SelectUnitAddForPlayer(CirclesOfPower_3,Player(3))
  if GetLocalPlayer()==Player(3)then
    call SetUnitVertexColor(CirclesOfPower_3,255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower_3,255,255,255,HI9)
  endif
  set CirclesOfPower_4=CreateUnit(Player(4),'ncop',-7424,-6592,270)
  call UnitAddAbility(CirclesOfPower_4,'A141')
  call ClearSelectionForPlayer(Player(4))
  call SelectUnitAddForPlayer(CirclesOfPower_4,Player(4))
  if GetLocalPlayer()==Player(4)then
    call SetUnitVertexColor(CirclesOfPower_4,255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower_4,255,255,255,HI9)
  endif
  set CirclesOfPower_5=CreateUnit(Player(5),'ncop',-7424,-6464,270)
  call UnitAddAbility(CirclesOfPower_5,'A141')
  call ClearSelectionForPlayer(Player(5))
  call SelectUnitAddForPlayer(CirclesOfPower_5,Player(5))
  if GetLocalPlayer()==Player(5)then
    call SetUnitVertexColor(CirclesOfPower_5,255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower_5,255,255,255,HI9)
  endif
  set CirclesOfPower_7=CreateUnit(Player(7),'ncop',7040,6272,270)
  call UnitAddAbility(CirclesOfPower_7,'A1WI')
  call ClearSelectionForPlayer(Player(7))
  call SelectUnitAddForPlayer(CirclesOfPower_7,Player(7))
  if GetLocalPlayer()==Player(7)then
    call SetUnitVertexColor(CirclesOfPower_7,255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower_7,255,255,255,HI9)
  endif
  set CirclesOfPower_8=CreateUnit(Player(8),'ncop',7040,6144,270)
  call UnitAddAbility(CirclesOfPower_8,'A1WI')
  call ClearSelectionForPlayer(Player(8))
  call SelectUnitAddForPlayer(CirclesOfPower_8,Player(8))
  if GetLocalPlayer()==Player(8)then
    call SetUnitVertexColor(CirclesOfPower_8,255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower_8,255,255,255,HI9)
  endif
  set CirclesOfPower_9=CreateUnit(Player(9),'ncop',7040,6016,270)
  call UnitAddAbility(CirclesOfPower_9,'A1WI')
  call ClearSelectionForPlayer(Player(9))
  call SelectUnitAddForPlayer(CirclesOfPower_9,Player(9))
  if GetLocalPlayer()==Player(9)then
    call SetUnitVertexColor(CirclesOfPower_9,255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower_9,255,255,255,HI9)
  endif
  set CirclesOfPower_10=CreateUnit(Player(10),'ncop',7040,5888,270)
  call UnitAddAbility(CirclesOfPower_10,'A1WI')
  call ClearSelectionForPlayer(Player(10))
  call SelectUnitAddForPlayer(CirclesOfPower_10,Player(10))
  if GetLocalPlayer()==Player(10)then
    call SetUnitVertexColor(CirclesOfPower_10,255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower_10,255,255,255,HI9)
  endif
  set CirclesOfPower_11=CreateUnit(Player(11),'ncop',7040,5760,270)
  call UnitAddAbility(CirclesOfPower_11,'A1WI')
  call ClearSelectionForPlayer(Player(11))
  call SelectUnitAddForPlayer(CirclesOfPower_11,Player(11))
  if GetLocalPlayer()==Player(11)then
    call SetUnitVertexColor(CirclesOfPower_11,255,255,255,255)
  else
    call SetUnitVertexColor(CirclesOfPower_11,255,255,255,HI9)
  endif
  set CirclesOfPower[1]=CirclesOfPower_1
  set CirclesOfPower[2]=CirclesOfPower_2
  set CirclesOfPower[3]=CirclesOfPower_3
  set CirclesOfPower[4]=CirclesOfPower_4
  set CirclesOfPower[5]=CirclesOfPower_5
  set CirclesOfPower[7]=CirclesOfPower_7
  set CirclesOfPower[8]=CirclesOfPower_8
  set CirclesOfPower[9]=CirclesOfPower_9
  set CirclesOfPower[10]=CirclesOfPower_10
  set CirclesOfPower[11]=CirclesOfPower_11
  set ItemSpawnX[1]=GetUnitX(CirclesOfPower_1)
  set ItemSpawnX[2]=GetUnitX(CirclesOfPower_2)
  set ItemSpawnX[3]=GetUnitX(CirclesOfPower_3)
  set ItemSpawnX[4]=GetUnitX(CirclesOfPower_4)
  set ItemSpawnX[5]=GetUnitX(CirclesOfPower_5)
  set ItemSpawnX[7]=GetUnitX(CirclesOfPower_7)
  set ItemSpawnX[8]=GetUnitX(CirclesOfPower_8)
  set ItemSpawnX[9]=GetUnitX(CirclesOfPower_9)
  set ItemSpawnX[10]=GetUnitX(CirclesOfPower_10)
  set ItemSpawnX[11]=GetUnitX(CirclesOfPower_11)
  set ItemSpawnY[1]=GetUnitY(CirclesOfPower_1)
  set ItemSpawnY[2]=GetUnitY(CirclesOfPower_2)
  set ItemSpawnY[3]=GetUnitY(CirclesOfPower_3)
  set ItemSpawnY[4]=GetUnitY(CirclesOfPower_4)
  set ItemSpawnY[5]=GetUnitY(CirclesOfPower_5)
  set ItemSpawnY[7]=GetUnitY(CirclesOfPower_7)
  set ItemSpawnY[8]=GetUnitY(CirclesOfPower_8)
  set ItemSpawnY[9]=GetUnitY(CirclesOfPower_9)
  set ItemSpawnY[10]=GetUnitY(CirclesOfPower_10)
  set ItemSpawnY[11]=GetUnitY(CirclesOfPower_11)
  call HU9()
  call HZ9()
  call SaveUnitWinAnimation('esen',"stand 4")
  call SaveUnitWinAnimation('e00V',"stand 4")
  call SaveUnitWinAnimation('edry',"spell")
  call SaveUnitWinAnimation('e00W',"spell")
  call SaveUnitWinAnimation('ugho',"stand victory")
  call SaveUnitWinAnimation('u001',"stand victory")
  call SaveUnitWinAnimation('unec',"stand channel")
  call SaveUnitWinAnimation('u002',"stand channel")
  call SaveUnitModelScale('n00M',.4,'n00M')
  call SaveUnitModelScale('e02R',.5,'e02R')
  call SaveUnitModelScale('e02T',1.2,'e02T')
  call SaveUnitModelScale('e02S',.5,'e02S')
  call SaveUnitModelScale('e030',.5,'e030')
  call SaveUnitModelScale('n0LS',1,'n0LS')
  set t=CreateTrigger()
  set VH8=Player(15)
  set TavernIntSent1=CreateUnit(VH8,'n008',-7360,6464,270)
  set TavernIntSent2=CreateUnit(VH8,'n0GJ',-7168,6464,270)
  set TavernIntScourge1=CreateUnit(VH8,'n01D',-6848,6464,270)
  set TavernIntScourge2=CreateUnit(VH8,'n0LH',-6656,6464,270)
  set TavernAgiSent1=CreateUnit(VH8,'n01N',-7360,6784,270)
  set TavernAgiSent2=CreateUnit(VH8,'n007',-7168,6784,270)
  set TavernAgiScourge1=CreateUnit(VH8,'n005',-6848,6784,270)
  set TavernAgiScourge2=CreateUnit(VH8,'n0LI',-6656,6784,270)
  set TavernStrSent1=CreateUnit(VH8,'n01B',-7360,7104,270)
  set TavernStrSent2=CreateUnit(VH8,'n01P',-7168,7104,270)
  set TavernStrScrouge1=CreateUnit(VH8,'n0GK',-6848,7104,270)
  set TavernStrScrouge2=CreateUnit(VH8,'n0LJ',-6656,7104,270)
  call SetUnitColor(TavernIntSent1,ConvertPlayerColor(1))
  call SetUnitColor(TavernIntSent2,ConvertPlayerColor(1))
  call SetUnitColor(TavernIntScourge1,ConvertPlayerColor(9))
  call SetUnitColor(TavernIntScourge2,ConvertPlayerColor(9))
  call SetUnitColor(TavernAgiSent1,ConvertPlayerColor(6))
  call SetUnitColor(TavernAgiSent2,ConvertPlayerColor(6))
  call SetUnitColor(TavernAgiScourge1,ConvertPlayerColor(10))
  call SetUnitColor(TavernAgiScourge2,ConvertPlayerColor(10))
  call SetUnitColor(TavernStrSent1,ConvertPlayerColor(0))
  call SetUnitColor(TavernStrSent2,ConvertPlayerColor(0))
  call SetUnitColor(TavernStrScrouge1,ConvertPlayerColor(11))
  call SetUnitColor(TavernStrScrouge2,ConvertPlayerColor(11))
  set t=null
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.01,false)
  call TriggerAddCondition(t,Condition(function IV9))
  set RF=CreateTrigger()
  call TriggerRegisterTimerEventSingle(RF,.01)
  call TriggerAddAction(RF,function IW9)
  set t=CreateTrigger()
  call TriggerRegisterPlayerEventLeave(t,Sentinels[1])
  call TriggerRegisterPlayerEventLeave(t,Sentinels[2])
  call TriggerRegisterPlayerEventLeave(t,Sentinels[3])
  call TriggerRegisterPlayerEventLeave(t,Sentinels[4])
  call TriggerRegisterPlayerEventLeave(t,Sentinels[5])
  call TriggerRegisterPlayerEventLeave(t,Scourges[1])
  call TriggerRegisterPlayerEventLeave(t,Scourges[2])
  call TriggerRegisterPlayerEventLeave(t,Scourges[3])
  call TriggerRegisterPlayerEventLeave(t,Scourges[4])
  call TriggerRegisterPlayerEventLeave(t,Scourges[5])
  call TriggerAddAction(t,function IL9)
  call TriggerAddAction(t,function RI8)
  call TriggerAddAction(t,function BWD)
  //call ExeFunc("IY9")
  if udg_ObserverMode then
    call IY9()
    set t=CreateTrigger()
    if IsPlayerObserver(udg_Observer1)then
      call TriggerRegisterPlayerEventLeave(t,udg_Observer1)
    endif
    if IsPlayerObserver(udg_Observer2)then
      call TriggerRegisterPlayerEventLeave(t,udg_Observer2)
    endif
    call TriggerAddAction(t,function IZ9)
  endif
  set IsPlayerLeftGame[0]=false
  set IsPlayerLeftGame[1]=false
  set IsPlayerLeftGame[2]=false
  set IsPlayerLeftGame[3]=false
  set IsPlayerLeftGame[4]=false
  set IsPlayerLeftGame[5]=false
  set IsPlayerLeftGame[6]=false
  set IsPlayerLeftGame[7]=false
  set IsPlayerLeftGame[8]=false
  set IsPlayerLeftGame[9]=false
  set IsPlayerLeftGame[10]=false
  set IsPlayerLeftGame[11]=false
  set IsPlayerLeftGame[12]=false
  set IsPlayerLeftGame[13]=false
  set IsPlayerLeftGame[14]=false
  set IsPlayerLeftGame[15]=false
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_REVIVE_FINISH)
  call TriggerAddAction(t,function JT9)
  set t=CreateTrigger()
  call TriggerRegisterEnterRectSimple(t,GetWorldBounds())
  call TriggerAddCondition(t,Condition(function VD9))
  call TriggerAddAction(t,function VT9)
  set HeroEnters=t
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
  call TriggerAddAction(t,function VY9)
  call TriggerAddCondition(t,Condition(function VX9))
  set OneHero=t
  set TriggerGoldPerSecond=CreateTrigger()
  call TriggerRegisterTimerEvent(TriggerGoldPerSecond,0.6,true)
  call TriggerAddCondition(TriggerGoldPerSecond,Condition(function GoldPerSecTrigger))
  call DisableTrigger(TriggerGoldPerSecond)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddAction(t,function VA9)
  set TriggerUpdateGameTime=t
  call L98(0,0,false)
  call VC9()
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
  call TriggerAddCondition(t,Condition(function V39))
  set t=null
  call PreloadAbility('A27F')
  call PreloadAbility('A27X')
  call PreloadAbility('A27H')
  call PreloadAbility('A27V')
  call PreloadAbility('A27G')
  call PreloadAbility('A27I')
  call PreloadAbility('A27K')
  call PreloadAbility('A27J')
  set t_RegisterCreepsDeath=CreateTrigger()
  call TriggerRegisterPlayerUnitEvent(t_RegisterCreepsDeath,Sentinels[0],EVENT_PLAYER_UNIT_DEATH,Condition(function ReturnTrue))
  call TriggerRegisterPlayerUnitEvent(t_RegisterCreepsDeath,Scourges[0],EVENT_PLAYER_UNIT_DEATH,Condition(function ReturnTrue))
  call TriggerRegisterPlayerUnitEvent(t_RegisterCreepsDeath,NeutralsPlayer,EVENT_PLAYER_UNIT_DEATH,Condition(function ReturnTrue))
  call TriggerAddAction(t_RegisterCreepsDeath,function RegisterCreepsDeath)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function WV9))
  set t=null
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Func5518))
  call TriggerAddAction(t,function XS9)
  set QF=t
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function YG9))
  set t=null
  //call SetPlayerTechMaxAllowed(Player(0),HeroId[113],0)//[lich]remove formless from taverns
  call SetPlayerTechMaxAllowed(Sentinels[1],'H500',0)
  call SetPlayerTechMaxAllowed(Sentinels[2],'H500',0)
  call SetPlayerTechMaxAllowed(Sentinels[3],'H500',0)
  call SetPlayerTechMaxAllowed(Sentinels[4],'H500',0)
  call SetPlayerTechMaxAllowed(Sentinels[5],'H500',0)
  call SetPlayerTechMaxAllowed(Scourges[1],'H500',0)
  call SetPlayerTechMaxAllowed(Scourges[2],'H500',0)
  call SetPlayerTechMaxAllowed(Scourges[3],'H500',0)
  call SetPlayerTechMaxAllowed(Scourges[4],'H500',0)
  call SetPlayerTechMaxAllowed(Scourges[5],'H500',0)
  call SetPlayerTechMaxAllowed(Player(0),'H500',0)
  call SetPlayerTechMaxAllowed(Player(6),'H500',0)
  call SetPlayerTechMaxAllowed(Player(12),'H500',0)
  call SetPlayerTechMaxAllowed(Player(13),'H500',0)
  call SetPlayerTechMaxAllowed(Player(14),'H500',0)
  set M87=CreateTrigger()
  call TriggerAddCondition(M87,Condition(function YM9))
  set UF=CreateTrigger()
  call TriggerRegisterPlayerUnitEvent(UF,NeutralsPlayer,EVENT_PLAYER_UNIT_DEATH,Condition(function ReturnTrue2))
  call TriggerAddCondition(UF,Condition(function YR9))
  call TriggerAddAction(UF,function YU9)
  set t=CreateTrigger()
  call TriggerRegisterPlayerUnitEvent(t,Sentinels[0],EVENT_PLAYER_UNIT_DEATH,Condition(function ReturnTrue2))
  call TriggerRegisterPlayerUnitEvent(t,Scourges[0],EVENT_PLAYER_UNIT_DEATH,Condition(function ReturnTrue2))
  call TriggerAddCondition(t,Condition(function YC9))
  set t=null
  set t=CreateTrigger()
  call TriggerAddCondition(t,Condition(function ZD9))
  call TriggerRegisterTimerEvent(t,6,false)
  set t=null
  //Start Tavern Reveal Fix :3
  call TimedReveal(Player(0),5,-6990.,6840.,750)
  call TimedReveal(Player(1),5,-6990.,6840.,750)
  call TimedReveal(Player(2),5,-6990.,6840.,750)
  call TimedReveal(Player(3),5,-6990.,6840.,750)
  call TimedReveal(Player(4),5,-6990.,6840.,750)
  call TimedReveal(Player(5),5,-6990.,6840.,750)
  call TimedReveal(Player(6),5,-6990.,6840.,750)
  call TimedReveal(Player(7),5,-6990.,6840.,750)
  call TimedReveal(Player(8),5,-6990.,6840.,750)
  call TimedReveal(Player(9),5,-6990.,6840.,750)
  call TimedReveal(Player(10),5,-6990.,6840.,750)
  call TimedReveal(Player(11),5,-6990.,6840.,750)
  call TimedReveal(Player(12),5,-6990.,6840.,750)
  call ExecuteFunc("InitItems")
  set WE7=CreateRegion()
  call RegionAddRect(WE7,WB)
  call RegionAddRect(WE7,XB)
  set t=CreateTrigger()
  call TriggerAddCondition(t,Condition(function ZI9))
  set T47=t
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)
  call TriggerAddCondition(t,Condition(function UnitItem_Enter))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PICKUP_ITEM)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DROP_ITEM)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PAWN_ITEM)
  call TriggerAddCondition(t,Condition(function CM9))
  set t_manipulateitem=t
  set t=CreateTrigger()
  call TriggerAddCondition(t,Condition(function CN9))
  call TriggerAddCondition(t,Condition(function FixRangeMorphsBite))
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PICKUP_ITEM)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DROP_ITEM)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PAWN_ITEM)
  call TriggerAddCondition(t,Condition(function CA9))
  set VQ7=t
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_USE_ITEM)
  //call TriggerAddCondition(t,Condition(function C39))
  set VR7=t
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function CB9))
  set t=null
  set t=CreateTrigger()
  call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function Func4819))
  set t=null
  set t=CreateTrigger()
  call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_PICKUP_ITEM)
  call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_DROP_ITEM)
  call TriggerAddCondition(t,Condition(function L89))
  set VV7=t
  set t=CreateTrigger()
  set t=CreateTrigger()
  call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddAction(t,function LH9)
  call TriggerAddCondition(t,Condition(function LD9))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function LK9))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
  call TriggerAddAction(t,function LS9)
  call TriggerAddCondition(t,Condition(function LO9))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.33,true)
  call TriggerAddCondition(t,Condition(function DED))
  set t=null
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.75,true)
  call TriggerAddCondition(t,Condition(function DID))
  set t=null
  call HideAbility('A29N')//courier reincarnation
  call HideAbility('A174')
  set t=CreateTrigger()
  call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function D0D))
  set t=null
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PICKUP_ITEM)
  call TriggerAddCondition(t,Condition(function D2D))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DROP_ITEM)
  call TriggerAddCondition(t,Condition(function D5D))
  set t=null
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PICKUP_ITEM)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DROP_ITEM)
  call TriggerAddCondition(t,Condition(function E7D))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PICKUP_ITEM)
  call TriggerAddCondition(t,Condition(function EDD))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.5,true)
  call TriggerAddCondition(t,Condition(function EMD))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PICKUP_ITEM)
  call TriggerAddCondition(t,Condition(function FBD))
  call J8D()
  call SetAltMinimapIcon("war3mapImported\\black.blp")
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function KJD))
  call HideAbility('A1VV')
  call HideAbility('A30P')
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_USE_ITEM)
  call TriggerAddCondition(t,Condition(function KBD))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddAction(t,function K3D)
  call TriggerAddCondition(t,Condition(function KCD))
  set YT9=GetRectCenter(Q4)
  set Roshan=CreateUnitAtLoc(Player(12),'n00L',YT9,bj_UNIT_FACING)
  call SetUnitAcquireRange(Roshan,150)
  call YI9(Roshan)
  call RemoveLocation(YT9)
  call UnitAddItem(Roshan,CreateItem(Item_Real[indexid_Aegis],0,0))
  call UnitAddAbility(Roshan,'A142')
  set YT9=GetRectCenter(Z4)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set YT9=GetRectCenter(V4)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set YT9=GetRectCenter(W4)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set YT9=GetRectCenter(X4)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set YT9=GetRectCenter(Y4)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set YT9=GetRectCenter(J4)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set YT9=GetRectCenter(K4)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set YT9=GetRectCenter(L4)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set YT9=GetRectCenter(M4)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set YT9=GetRectCenter(N4)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set YT9=GetRectCenter(W5)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set YT9=GetRectCenter(Y5)
  call RemoveUnit(CreateUnitAtLoc(NeutralsPlayer,'u001',YT9,0))
  call RemoveLocation(YT9)
  set t=CreateTrigger()
  call TriggerRegisterUnitInRange(t,BottomWaypointDummy,300,Condition(function ReturnTrue))
  call TriggerRegisterUnitInRange(t,MidWaypointDummy,300,Condition(function ReturnTrue))
  call TriggerRegisterUnitInRange(t,TopWaypointDummy,300,Condition(function ReturnTrue))
  call TriggerAddCondition(t,Condition(function KLD))
  set unit001=CreateTrigger()
  call TriggerAddAction(unit001,function K1D)
  set integers005=CreateTrigger()
  call TriggerAddAction(integers005,function K0D)
  set t=CreateTrigger()
  set UJE=CreateRegion()
  call RegionAddRect(UJE,SentMidMeleeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,SentMidRangeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,TA)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  call TriggerAddCondition(t,Condition(function K5D))
  set t=CreateTrigger()
  set UJE=CreateRegion()
  call RegionAddRect(UJE,ScouMidRangeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,ScouMidMeleeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,LA)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  call TriggerAddCondition(t,Condition(function K2D))
  set t=CreateTrigger()
  set UJE=CreateRegion()
  call RegionAddRect(UJE,SentTopMeleeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,SentTopRangeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,SomeRect6)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  call TriggerAddCondition(t,Condition(function M4D))
  set t=CreateTrigger()
  set UJE=CreateRegion()
  call RegionAddRect(UJE,ScouTopRangeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,ScouTopMeleeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,string001)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  call TriggerAddCondition(t,Condition(function M7D))
  set t=CreateTrigger()
  set UJE=CreateRegion()
  call RegionAddRect(UJE,SentBotRangeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,SentBotMeleeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,SA)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  call TriggerAddCondition(t,Condition(function M8D))
  set t=CreateTrigger()
  set UJE=CreateRegion()
  call RegionAddRect(UJE,ScouBotRangeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,ScouBotMeleeSpawnRect)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  set UJE=CreateRegion()
  call RegionAddRect(UJE,NA)
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  call TriggerAddCondition(t,Condition(function M9D))
  set integers004=CreateTrigger()
  call TriggerAddAction(integers004,function MPD)
  set BG=CreateTrigger()
  call TriggerRegisterUnitEvent(BG,EH7,EVENT_UNIT_DEATH)
  call TriggerAddAction(BG,function MRD)
  set reals001=CreateTrigger()
  call TriggerRegisterUnitEvent(reals001,EI7,EVENT_UNIT_DEATH)
  call TriggerAddAction(reals001,function MSD)
  set DG=CreateTrigger()
  call TriggerRegisterUnitEvent(DG,EJ7,EVENT_UNIT_DEATH)
  call TriggerAddAction(DG,function MTD)
  set boolean004=CreateTrigger()
  call TriggerRegisterUnitEvent(boolean004,EE7,EVENT_UNIT_DEATH)
  call TriggerAddAction(boolean004,function MUD)
  set FG=CreateTrigger()
  call TriggerRegisterUnitEvent(FG,EF7,EVENT_UNIT_DEATH)
  call TriggerAddAction(FG,function MVD)
  set integer012=CreateTrigger()
  call TriggerRegisterUnitEvent(integer012,EG7,EVENT_UNIT_DEATH)
  call TriggerAddAction(integer012,function MWD)
  set real001=CreateTrigger()
  call TriggerRegisterUnitEvent(real001,H57,EVENT_UNIT_DEATH)
  call TriggerAddAction(real001,function MXD)
  set ZG=CreateTrigger()
  call TriggerRegisterUnitEvent(ZG,H27,EVENT_UNIT_DEATH)
  call TriggerAddAction(ZG,function MYD)
  set VG=CreateTrigger()
  call TriggerRegisterUnitEvent(VG,I47,EVENT_UNIT_DEATH)
  call TriggerAddAction(VG,function MZD)
  set WG=CreateTrigger()
  call TriggerRegisterUnitEvent(WG,HL7,EVENT_UNIT_DEATH)
  call TriggerAddAction(WG,function MAD)
  set integer014=CreateTrigger()
  call TriggerRegisterUnitEvent(integer014,H17,EVENT_UNIT_DEATH)
  call TriggerAddAction(integer014,function MBD)
  set YG=CreateTrigger()
  call TriggerRegisterUnitEvent(YG,H07,EVENT_UNIT_DEATH)
  call TriggerAddAction(YG,function MCD)
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,NQ,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function M3D))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,FrozenThrone,EVENT_UNIT_DAMAGED)
  call TriggerAddCondition(t,Condition(function MLD))
  set JG=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(JG,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(JG,Condition(function M1D))
  call TriggerAddAction(JG,function M0D)
  set group002=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(group002,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(group002,Condition(function M5D))
  call TriggerAddAction(group002,function M2D)
  set LG=CreateTrigger()
  call TriggerAddAction(LG,function N4D)
  set integer013=CreateTrigger()
  call TriggerRegisterTimerEventSingle(integer013,75.)
  call TriggerAddAction(integer013,function N7D)
  set trigger019=CreateTrigger()
  call TriggerAddCondition(trigger019,Condition(function O4D))
  set SG=CreateTrigger()
  call TriggerAddAction(SG,function O7D)
  set trigger021=CreateTrigger()
  call TriggerAddAction(trigger021,function OED)
  set trigger022=CreateTrigger()
  call TriggerRegisterTimerEventPeriodic(trigger022,1.)
  call TriggerAddAction(trigger022,function OND)
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELECTED)
  call TriggerAddCondition(t,Condition(function QHD))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DESELECTED)
  call TriggerAddCondition(t,Condition(function QGD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,boolean031,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,boolean031,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QLD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,integer027,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,integer027,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Q1D))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,string005,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,string005,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Q0D))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,E47,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,E47,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Q5D))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,E77,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,E77,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Q2D))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,E87,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,E87,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function R4D))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,E97,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,E97,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function R7D))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,ED7,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,ED7,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function R8D))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,EE7,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,EE7,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function R9D))
  
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,EF7,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,EF7,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function RDD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,EG7,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,EG7,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function RED))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,EH7,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,EH7,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function RFD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,EI7,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,EI7,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function RGD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,EJ7,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,EJ7,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function RHD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Top_2,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Top_2,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QRD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Mid_2,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Mid_2,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QSD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Bot_2,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Bot_2,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QTD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Top_3,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Top_3,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QUD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Mid_3,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Mid_3,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QVD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Bot_3,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Bot_3,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QWD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Throne1,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Throne1,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QXD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Throne2,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,Towers_Scourge_Throne2,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QYD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,HL7,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,HL7,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QZD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,H17,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,H17,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QAD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,H07,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,H07,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QBD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,H57,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,H57,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function QCD))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,H27,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,H27,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Q3D))
  set t=CreateTrigger()
  call TriggerRegisterUnitEvent(t,I47,EVENT_UNIT_DAMAGED)
  call TriggerRegisterUnitEvent(t,I47,EVENT_UNIT_DEATH)
  call TriggerAddCondition(t,Condition(function Q6D))
  
  set BDRegen=CreateTrigger()
  call TriggerRegisterTimerEvent(BDRegen,1,true)
  call TriggerAddCondition(BDRegen,Condition(function QOD))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,5,true)
  call TriggerAddCondition(t,Condition(function RRD))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,4,true)
  call TriggerAddCondition(t,Condition(function RZD))
  set Y57=GetAvailableGroup()
  set t=CreateTrigger()
  //set UJE=CreateRegion()
  //call RegionAddRect(UJE,bj_mapInitialPlayableArea)
  call TriggerRegisterEnterRectSimple(t,GetWorldBounds())
  call TriggerAddCondition(t,Condition(function R3D))
  set t=CreateTrigger()
  call TriggerAddCondition(t,Condition(function R6D))
  call TriggerRegisterTimerEvent(t,5,true)
  call DestroyFogModifier(CreateFogModifierRadius(Sentinels[0],FOG_OF_WAR_VISIBLE,-4550,1250,300,true,true))
  call DestroyFogModifier(CreateFogModifierRadius(Scourges[0],FOG_OF_WAR_VISIBLE,-4550,1250,300,true,true))
  call DestroyFogModifier(CreateFogModifierRadius(Sentinels[0],FOG_OF_WAR_VISIBLE,3200,1,300,true,true))
  call DestroyFogModifier(CreateFogModifierRadius(Scourges[0],FOG_OF_WAR_VISIBLE,3200,1,300,true,true))
  call DestroyFogModifier(CreateFogModifierRadius(Sentinels[0],FOG_OF_WAR_VISIBLE,-7292,4186,450,true,true))
  call DestroyFogModifier(CreateFogModifierRadius(Scourges[0],FOG_OF_WAR_VISIBLE,-7292,4186,450,true,true))
  call DestroyFogModifier(CreateFogModifierRadius(Sentinels[0],FOG_OF_WAR_VISIBLE,7348,-4334,450,true,true))
  call DestroyFogModifier(CreateFogModifierRadius(Scourges[0],FOG_OF_WAR_VISIBLE,7348,-4334,450,true,true))
  call DestroyFogModifier(CreateFogModifierRect(Sentinels[0],FOG_OF_WAR_VISIBLE,CS,true,true))
  call DestroyFogModifier(CreateFogModifierRect(Scourges[0],FOG_OF_WAR_VISIBLE,CS,true,true))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,3.5,true)
  call TriggerAddCondition(t,Condition(function S9D))
  set trigger024=CreateTrigger()
  call TriggerRegisterUnitEvent(trigger024,FrozenThrone,EVENT_UNIT_DEATH)
  call TriggerAddAction(trigger024,function SKD)
  set trigger025=CreateTrigger()
  call TriggerRegisterUnitEvent(trigger025,NQ,EVENT_UNIT_DEATH)
  call TriggerAddAction(trigger025,function SID)
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function SPD))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function CustomLifestealAura))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
  call TriggerAddCondition(t,Condition(function TranquilBroke_Condition))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddAction(t,function SQD)
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function STD))
  set ZI7=CreateTrigger()
  call TriggerAddAction(ZI7,function SXD)
  set t=CreateTrigger()
  call TriggerRegisterPlayerUnitEvent(t,NeutralsPlayer,EVENT_PLAYER_UNIT_ATTACKED,Condition(function ReturnTrue2))
  call TriggerAddCondition(t,Condition(function SYD))
  set ZJ7=CreateRegion()
  call RegionAddRect(ZJ7,N5)
  call RegionAddRect(ZJ7,SomeRect2)
  call RegionAddRect(ZJ7,T5)
  call RegionAddRect(ZJ7,boolean037)
  call RegionAddRect(ZJ7,integer042)
  call RegionAddRect(ZJ7,real016)
  call RegionAddRect(ZJ7,unit007)
  call RegionAddRect(ZJ7,I6)
  call RegionAddRect(ZJ7,O6)
  set unit002=CreateTrigger()
  call TriggerRegisterEnterRectSimple(unit002,bj_mapInitialPlayableArea)
  call TriggerAddCondition(unit002,Condition(function SZD))
  call TriggerAddAction(unit002,function SAD)
  set integers002=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(integers002,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(integers002,Condition(function SBD))
  call TriggerAddAction(integers002,function S6D)
  set OH=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(OH,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(OH,Condition(function SLD))
  call TriggerAddAction(OH,function S5D)
  if(bj_isSinglePlayer and S2D())then
    call AddFlyingCourierIfSolo()
    call T3D()
  endif
  set t=CreateTrigger()
  call TriggerRegisterPlayerChatEvent(t,PlayerModeTyper,"-wtf",true)
  call TriggerAddAction(t,function T0D)
  call TriggerAddCondition(t,Condition(function T6D))
  set t=CreateTrigger()
  call TriggerRegisterPlayerUnitEvent(t,Sentinels[1],EVENT_PLAYER_HERO_LEVEL,Condition(function ReturnTrue2))
  call TriggerRegisterPlayerUnitEvent(t,Sentinels[2],EVENT_PLAYER_HERO_LEVEL,Condition(function ReturnTrue2))
  call TriggerRegisterPlayerUnitEvent(t,Sentinels[3],EVENT_PLAYER_HERO_LEVEL,Condition(function ReturnTrue2))
  call TriggerRegisterPlayerUnitEvent(t,Sentinels[4],EVENT_PLAYER_HERO_LEVEL,Condition(function ReturnTrue2))
  call TriggerRegisterPlayerUnitEvent(t,Sentinels[5],EVENT_PLAYER_HERO_LEVEL,Condition(function ReturnTrue2))
  call TriggerRegisterPlayerUnitEvent(t,Scourges[1],EVENT_PLAYER_HERO_LEVEL,Condition(function ReturnTrue2))
  call TriggerRegisterPlayerUnitEvent(t,Scourges[2],EVENT_PLAYER_HERO_LEVEL,Condition(function ReturnTrue2))
  call TriggerRegisterPlayerUnitEvent(t,Scourges[3],EVENT_PLAYER_HERO_LEVEL,Condition(function ReturnTrue2))
  call TriggerRegisterPlayerUnitEvent(t,Scourges[4],EVENT_PLAYER_HERO_LEVEL,Condition(function ReturnTrue2))
  call TriggerRegisterPlayerUnitEvent(t,Scourges[5],EVENT_PLAYER_HERO_LEVEL,Condition(function ReturnTrue2))
  call TriggerAddCondition(t,Condition(function T2D))
  set t=CreateTrigger()
  call TriggerRegisterPlayerChatEvent(t,PlayerModeTyper,"-test",true)
  call TriggerAddCondition(t,Condition(function U7D))
  set t=CreateTrigger()
  set UJE=CreateRegion()
  call RegionAddRect(UJE,GetWorldBounds())
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue))
  call TriggerAddCondition(t,Condition(function HeroAttackedLogic_Init))
  set t=CreateTrigger()
  call TriggerRegisterUnitInRange(t,BottomWaypointDummy,300,Condition(function ReturnTrue))
  call TriggerRegisterUnitInRange(t,MidWaypointDummy,300,Condition(function ReturnTrue))
  call TriggerRegisterUnitInRange(t,TopWaypointDummy,300,Condition(function ReturnTrue))
  call TriggerAddCondition(t,Condition(function UZD))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,25,false)
  call TriggerAddAction(t,function UCD)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,2,false)
  call TriggerAddCondition(t,Condition(function U2D))
  set integer031=CreateRegion()
  call RegionAddRect(integer031,G4)
  call RegionAddRect(integer031,F4)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,25,false)
  call TriggerAddAction(t,function VFD)
  set t=CreateTrigger()
  call TriggerRegisterPlayerChatEvent(t,Sentinels[1],"-",false)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[2],"-",false)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[3],"-",false)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[4],"-",false)
  call TriggerRegisterPlayerChatEvent(t,Sentinels[5],"-",false)
  call TriggerRegisterPlayerChatEvent(t,Scourges[1],"-",false)
  call TriggerRegisterPlayerChatEvent(t,Scourges[2],"-",false)
  call TriggerRegisterPlayerChatEvent(t,Scourges[3],"-",false)
  call TriggerRegisterPlayerChatEvent(t,Scourges[4],"-",false)
  call TriggerRegisterPlayerChatEvent(t,Scourges[5],"-",false)
  call TriggerAddAction(t,function VGD)
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_FINISH)
  call TriggerAddCondition(t,Condition(function YAD))
  call TriggerAddAction(t,function Y6D)
  set CSONStatus1[0]=false
  set CSONStatus1[1]=false
  set CSONStatus1[2]=false
  set CSONStatus1[3]=false
  set CSONStatus1[4]=false
  set CSONStatus1[5]=false
  set CSONStatus1[6]=false
  set CSONStatus1[7]=false
  set CSONStatus1[8]=false
  set CSONStatus1[9]=false
  set CSONStatus1[10]=false
  set CSONStatus1[11]=false
  set CSONStatus1[12]=false
  set CSONStatus1[13]=false
  set CSONStatus1[14]=false
  set CSONStatus1[15]=false
  set CSONStatus1[16]=false
  set FixedCameraOnHero[0]=false
  set FixedCameraOnHero[1]=false
  set FixedCameraOnHero[2]=false
  set FixedCameraOnHero[3]=false
  set FixedCameraOnHero[4]=false
  set FixedCameraOnHero[5]=false
  set FixedCameraOnHero[6]=false
  set FixedCameraOnHero[7]=false
  set FixedCameraOnHero[8]=false
  set FixedCameraOnHero[9]=false
  set FixedCameraOnHero[10]=false
  set FixedCameraOnHero[11]=false
  set FixedCameraOnHero[12]=false
  set FixedCameraOnHero[13]=false
  set FixedCameraOnHero[14]=false
  set FixedCameraOnHero[15]=false
  set FixedCameraOnHero[16]=false
  set AutoselectionStatus[0]=true
  set AutoselectionStatus[1]=true
  set AutoselectionStatus[2]=true
  set AutoselectionStatus[3]=true
  set AutoselectionStatus[4]=true
  set AutoselectionStatus[5]=true
  set AutoselectionStatus[6]=true
  set AutoselectionStatus[7]=true
  set AutoselectionStatus[8]=true
  set AutoselectionStatus[9]=true
  set AutoselectionStatus[10]=true
  set AutoselectionStatus[11]=true
  set AutoselectionStatus[12]=true
  set AutoselectionStatus[13]=true
  set AutoselectionStatus[14]=true
  set AutoselectionStatus[15]=true
  set AutoselectionStatus[16]=true
  set HeroHasBeenUnlocked[0]=false
  set HeroHasBeenUnlocked[1]=false
  set HeroHasBeenUnlocked[2]=false
  set HeroHasBeenUnlocked[3]=false
  set HeroHasBeenUnlocked[4]=false
  set HeroHasBeenUnlocked[5]=false
  set HeroHasBeenUnlocked[6]=false
  set HeroHasBeenUnlocked[7]=false
  set HeroHasBeenUnlocked[8]=false
  set HeroHasBeenUnlocked[9]=false
  set HeroHasBeenUnlocked[10]=false
  set HeroHasBeenUnlocked[11]=false
  set HeroHasBeenUnlocked[12]=false
  set HeroHasBeenUnlocked[13]=false
  set HeroHasBeenUnlocked[14]=false
  set HeroHasBeenUnlocked[15]=false
  set HeroHasBeenUnlocked[16]=false
  set ShowDeathTimer[0]=false
  set ShowDeathTimer[1]=false
  set ShowDeathTimer[2]=false
  set ShowDeathTimer[3]=false
  set ShowDeathTimer[4]=false
  set ShowDeathTimer[5]=false
  set ShowDeathTimer[6]=false
  set ShowDeathTimer[7]=false
  set ShowDeathTimer[8]=false
  set ShowDeathTimer[9]=false
  set ShowDeathTimer[10]=false
  set ShowDeathTimer[11]=false
  set ShowDeathTimer[12]=false
  set ShowDeathTimer[13]=false
  set ShowDeathTimer[14]=false
  set ShowDeathTimer[15]=false
  set ShowDeathTimer[16]=false
  set ShowDeathTimer[GetPlayerId(Sentinels[1])]=true
  set ShowDeathTimer[GetPlayerId(Sentinels[2])]=true
  set ShowDeathTimer[GetPlayerId(Sentinels[3])]=true
  set ShowDeathTimer[GetPlayerId(Sentinels[4])]=true
  set ShowDeathTimer[GetPlayerId(Sentinels[5])]=true
  set ShowDeathTimer[GetPlayerId(Scourges[1])]=true
  set ShowDeathTimer[GetPlayerId(Scourges[2])]=true
  set ShowDeathTimer[GetPlayerId(Scourges[3])]=true
  set ShowDeathTimer[GetPlayerId(Scourges[4])]=true
  set ShowDeathTimer[GetPlayerId(Scourges[5])]=true
  call ZID()
  set ShowRollNumbers[0]=true
  set ShowRollNumbers[1]=true
  set ShowRollNumbers[2]=true
  set ShowRollNumbers[3]=true
  set ShowRollNumbers[4]=true
  set ShowRollNumbers[5]=true
  set ShowRollNumbers[6]=true
  set ShowRollNumbers[7]=true
  set ShowRollNumbers[8]=true
  set ShowRollNumbers[9]=true
  set ShowRollNumbers[10]=true
  set ShowRollNumbers[11]=true
  set ShowRollNumbers[12]=true
  set ShowRollNumbers[13]=true
  set ShowRollNumbers[14]=true
  set ShowRollNumbers[15]=true
  set hhnActive[0]=false
  set hhnActive[1]=false
  set hhnActive[2]=false
  set hhnActive[3]=false
  set hhnActive[4]=false
  set hhnActive[5]=false
  set hhnActive[6]=false
  set hhnActive[7]=false
  set hhnActive[8]=false
  set hhnActive[9]=false
  set hhnActive[10]=false
  set hhnActive[11]=false
  set hhnActive[12]=false
  set hhnActive[13]=false
  set hhnActive[14]=false
  set SoundsMuted[GetPlayerId(Sentinels[1])]=false
  set SoundsMuted[GetPlayerId(Sentinels[2])]=false
  set SoundsMuted[GetPlayerId(Sentinels[3])]=false
  set SoundsMuted[GetPlayerId(Sentinels[4])]=false
  set SoundsMuted[GetPlayerId(Sentinels[5])]=false
  set SoundsMuted[GetPlayerId(Scourges[1])]=false
  set SoundsMuted[GetPlayerId(Scourges[2])]=false
  set SoundsMuted[GetPlayerId(Scourges[3])]=false
  set SoundsMuted[GetPlayerId(Scourges[4])]=false
  set SoundsMuted[GetPlayerId(Scourges[5])]=false
  set ItemInfoShown[GetPlayerId(Sentinels[1])]=false
  set ItemInfoShown[GetPlayerId(Sentinels[2])]=false
  set ItemInfoShown[GetPlayerId(Sentinels[3])]=false
  set ItemInfoShown[GetPlayerId(Sentinels[4])]=false
  set ItemInfoShown[GetPlayerId(Sentinels[5])]=false
  set ItemInfoShown[GetPlayerId(Scourges[1])]=false
  set ItemInfoShown[GetPlayerId(Scourges[2])]=false
  set ItemInfoShown[GetPlayerId(Scourges[3])]=false
  set ItemInfoShown[GetPlayerId(Scourges[4])]=false
  set ItemInfoShown[GetPlayerId(Scourges[5])]=false
  set SpellInfoShown[GetPlayerId(Sentinels[1])]=false
  set SpellInfoShown[GetPlayerId(Sentinels[2])]=false
  set SpellInfoShown[GetPlayerId(Sentinels[3])]=false
  set SpellInfoShown[GetPlayerId(Sentinels[4])]=false
  set SpellInfoShown[GetPlayerId(Sentinels[5])]=false
  set SpellInfoShown[GetPlayerId(Scourges[1])]=false
  set SpellInfoShown[GetPlayerId(Scourges[2])]=false
  set SpellInfoShown[GetPlayerId(Scourges[3])]=false
  set SpellInfoShown[GetPlayerId(Scourges[4])]=false
  set SpellInfoShown[GetPlayerId(Scourges[5])]=false
  set t=CreateTrigger()
  call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_ORDER)
  call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
  call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
  call TriggerAddCondition(t,Condition(function ZTD))
  //	set t=CreateTrigger()
  //	call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_ORDER)
  //	call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
  //	call TriggerRegisterHumanUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
  //	call TriggerAddCondition(t,Condition(function DoubleHold))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,5,true)
  call TriggerAddCondition(t,Condition(function ZSD))
  set A47[GetPlayerId(Sentinels[1])]=false
  set A47[GetPlayerId(Sentinels[2])]=false
  set A47[GetPlayerId(Sentinels[3])]=false
  set A47[GetPlayerId(Sentinels[4])]=false
  set A47[GetPlayerId(Sentinels[5])]=false
  set A47[GetPlayerId(Scourges[1])]=false
  set A47[GetPlayerId(Scourges[2])]=false
  set A47[GetPlayerId(Scourges[3])]=false
  set A47[GetPlayerId(Scourges[4])]=false
  set A47[GetPlayerId(Scourges[5])]=false
  set ShowCourierIcon[GetPlayerId(Sentinels[1])]=false
  set ShowCourierIcon[GetPlayerId(Sentinels[2])]=false
  set ShowCourierIcon[GetPlayerId(Sentinels[3])]=false
  set ShowCourierIcon[GetPlayerId(Sentinels[4])]=false
  set ShowCourierIcon[GetPlayerId(Sentinels[5])]=false
  set ShowCourierIcon[GetPlayerId(Scourges[1])]=false
  set ShowCourierIcon[GetPlayerId(Scourges[2])]=false
  set ShowCourierIcon[GetPlayerId(Scourges[3])]=false
  set ShowCourierIcon[GetPlayerId(Scourges[4])]=false
  set ShowCourierIcon[GetPlayerId(Scourges[5])]=false
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.01,false)
  call TriggerAddCondition(t,Condition(function ZAD))
  set CustomWaterColor[0]=false
  set CustomWaterColor[1]=false
  set CustomWaterColor[2]=false
  set CustomWaterColor[3]=false
  set CustomWaterColor[4]=false
  set CustomWaterColor[5]=false
  set CustomWaterColor[6]=false
  set CustomWaterColor[7]=false
  set CustomWaterColor[8]=false
  set CustomWaterColor[9]=false
  set CustomWaterColor[10]=false
  set CustomWaterColor[11]=false
  set CustomWaterColor[12]=false
  set CustomWaterColor[13]=false
  set CustomWaterColor[14]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\WitchDoctor\\WitchDoctorPissed1.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\WitchDoctor\\WitchDoctorPissed2.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\WitchDoctor\\WitchDoctorPissed3.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\WitchDoctor\\WitchDoctorPissed4.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\WitchDoctor\\WitchDoctorPissed5.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\WitchDoctor\\WitchDoctorPissed6.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Undead\\HeroDreadLord\\HeroDreadlordPissed1.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Undead\\HeroDreadLord\\HeroDreadlordPissed2.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Undead\\HeroDreadLord\\HeroDreadlordPissed3.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Undead\\HeroDreadLord\\HeroDreadlordPissed4.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Undead\\HeroDreadLord\\HeroDreadlordPissed5.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Undead\\HeroDreadLord\\HeroDreadlordPissed6.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Undead\\HeroDreadLord\\HeroDreadlordPissed7.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Creeps\\HEROGoblinALCHEMIST\\HeroAlchemistPissed1.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Creeps\\HEROGoblinALCHEMIST\\HeroAlchemistPissed2.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Creeps\\HEROGoblinALCHEMIST\\HeroAlchemistPissed3.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Creeps\\HEROGoblinALCHEMIST\\HeroAlchemistPissed4.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Creeps\\HEROGoblinALCHEMIST\\HeroAlchemistPissed5.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Creeps\\HEROGoblinALCHEMIST\\HeroAlchemistPissed6.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\BloodElfSpellThief\\SpellbreakerPissed1.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\BloodElfSpellThief\\SpellbreakerPissed2.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\BloodElfSpellThief\\SpellbreakerPissed3.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\BloodElfSpellThief\\SpellbreakerPissed4.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\BloodElfSpellThief\\SpellbreakerPissed5.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\Rifleman\\RiflemanPissed1.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\Rifleman\\RiflemanPissed2.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\Rifleman\\RiflemanPissed3.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\Rifleman\\RiflemanPissed4.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\Rifleman\\RiflemanPissed5.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\Rifleman\\RiflemanPissed6.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\Rifleman\\RiflemanPissed7.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Human\\Rifleman\\RiflemanPissed8.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\HeroShadowHunter\\ShadowHunterPissed1.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\HeroShadowHunter\\ShadowHunterPissed2.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\HeroShadowHunter\\ShadowHunterPissed3.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\HeroShadowHunter\\ShadowHunterPissed4.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\HeroShadowHunter\\ShadowHunterPissed5.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\HeroShadowHunter\\ShadowHunterPissed6.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\HeroShadowHunter\\ShadowHunterPissed7.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\HeroShadowHunter\\ShadowHunterPissed8.wav"
  set AI7[AJ7]=false
  set AJ7=AJ7+1
  set AH7[AJ7]="Units\\Orc\\HeroShadowHunter\\ShadowHunterPissed9.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\Ogre\\OgrePissed1.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\Ogre\\OgrePissed2.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\Ogre\\OgrePissed3.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\Ogre\\OgrePissed4.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\Ogre\\OgrePissed5.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\GoblinSapper\\GoblinSapperPissed1.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\GoblinSapper\\GoblinSapperPissed2.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\GoblinSapper\\GoblinSapperPissed3.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\GoblinSapper\\GoblinSapperPissed4.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\GoblinSapper\\GoblinSapperPissed5.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\GoblinSapper\\GoblinSapperPissed6.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\GoblinSapper\\GoblinSapperPissed7.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Orc\\HeroBladeMaster\\HeroBladeMasterPissed1.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Orc\\HeroBladeMaster\\HeroBladeMasterPissed2.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Orc\\HeroBladeMaster\\HeroBladeMasterPissed3.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Orc\\HeroBladeMaster\\HeroBladeMasterPissed4.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\PandarenBrewmaster\\PandarenBrewmasterPissed1.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\PandarenBrewmaster\\PandarenBrewmasterPissed2.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\PandarenBrewmaster\\PandarenBrewmasterPissed3.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\PandarenBrewmaster\\PandarenBrewmasterPissed4.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\PandarenBrewmaster\\PandarenBrewmasterPissed5.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\PandarenBrewmaster\\PandarenBrewmasterPissed6.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\PandarenBrewmaster\\PandarenBrewmasterPissed7.wav"
  set AI7[AJ7]=false
  set AH7[AJ7]="Units\\Creeps\\PandarenBrewmaster\\PandarenBrewmasterPissed8.wav"
  set AI7[AJ7]=false
  set AN7[0]=false
  set AN7[1]=false
  set AN7[2]=false
  set AN7[3]=false
  set AN7[4]=false
  set AN7[5]=false
  set AN7[6]=false
  set AN7[7]=false
  set AN7[8]=false
  set AN7[9]=false
  set AN7[10]=false
  set AN7[11]=false
  set AN7[12]=false
  set AN7[13]=false
  set GL[0]=false
  set GL[1]=false
  set GL[2]=false
  set GL[3]=false
  set GL[4]=false
  set GL[5]=false
  set GL[6]=false
  set GL[7]=false
  set GL[8]=false
  set GL[9]=false
  set GL[10]=false
  set GL[11]=false
  set GL[12]=false
  set t=null
  set t=CreateTrigger()
  call TriggerAddAction(t,function LLD)
  call TriggerAddCondition(t,Condition(function B1D))
  
  set AR7=t
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,.01,false)
  call TriggerAddCondition(t,Condition(function L1D))
  if udg_ObserverMode then
    set t=CreateTrigger()
    call TriggerRegisterTimerEvent(t,1,true)
    call TriggerAddCondition(t,Condition(function IJE))
  endif
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,1,true)
  call TriggerAddCondition(t,Condition(function MeleeRangeItemsFix))
  set BH=CreateTrigger()
  call TriggerRegisterTimerExpireEvent(BH,MultikillTimers[1])
  call TriggerAddAction(BH,function integer469)
  set integer002=CreateTrigger()
  call TriggerRegisterTimerExpireEvent(integer002,MultikillTimers[2])
  call TriggerAddAction(integer002,function I6E)
  set DH=CreateTrigger()
  call TriggerRegisterTimerExpireEvent(DH,MultikillTimers[3])
  call TriggerAddAction(DH,function ILE)
  set booleans001=CreateTrigger()
  call TriggerRegisterTimerExpireEvent(booleans001,MultikillTimers[4])
  call TriggerAddAction(booleans001,function integer471)
  set FH=CreateTrigger()
  call TriggerRegisterTimerExpireEvent(FH,MultikillTimers[5])
  call TriggerAddAction(FH,function I0E)
  set booleans002=CreateTrigger()
  call TriggerRegisterTimerExpireEvent(booleans002,MultikillTimers[7])
  call TriggerAddAction(booleans002,function integer470)
  set integers003=CreateTrigger()
  call TriggerRegisterTimerExpireEvent(integers003,MultikillTimers[8])
  call TriggerAddAction(integers003,function integer472)
  set ZH=CreateTrigger()
  call TriggerRegisterTimerExpireEvent(ZH,MultikillTimers[9])
  call TriggerAddAction(ZH,function J4E)
  set VH=CreateTrigger()
  call TriggerRegisterTimerExpireEvent(VH,MultikillTimers[10])
  call TriggerAddAction(VH,function J7E)
  set WH=CreateTrigger()
  call TriggerRegisterTimerExpireEvent(WH,MultikillTimers[11])
  call TriggerAddAction(WH,function J8E)
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,14,false)
  call TriggerAddCondition(t,Condition(function JEE))
  set t=CreateTrigger()
  call TriggerRegisterTimerEvent(t,15,false)
  call TriggerAddCondition(t,Condition(function JDE))
  set boolean003=CreateTrigger()
  call TriggerRegisterTimerEventSingle(boolean003,65.)
  call TriggerAddAction(boolean003,function JFE)
  //set JH=CreateTrigger()
  //call TriggerRegisterTimerEventSingle(JH,120.)
  //call TriggerAddAction(JH,function JHE)
  set t=CreateTrigger()
  set UJE=CreateRegion()
  call RegionAddRect(UJE,GetWorldBounds())
  call TriggerRegisterEnterRegion(t,UJE,Condition(function ReturnTrue2))
  call TriggerAddCondition(t,Condition(function YYF))
  call ExeFunc("Kaolin_RegisterUnitWithStones")
  call ExeFunc("NIghtstalker_Passive_Global")
  set i=0
  loop
    set HidePassivesForPlayer[i]=false
    set i=i+1
    exitwhen i>12
  endloop
  set i=0
  loop
    set SpawnHistory[i]=0
    set i=i+1
    exitwhen i>40
  endloop
  set JH8[1]='A0VS'
  set JH8[2]='A0VK'
  set JH8[3]='A0VQ'
  set JH8[4]='A0XL'
  set JH8[5]='A0VM'
  set JH8[6]='A0VN'
  set JH8[7]='A0VO'
  set JH8[8]='A0VP'
  set JH8[9]='A0VG'
  set JH8[10]='A0VZ'
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerAddCondition(t,Condition(function PZF))
  call TriggerAddAction(t,function PAF)
  set t=CreateTrigger()
  call TriggerRegisterTimerEventSingle(t,.1)
  call TriggerAddAction(t,function HEH)
  
  // RMD - MapID
  call Traffic_RegisterCustomGlobalData("i","d",0x03)
  
  // RMD - Meta Data
  call Traffic_RegisterCustomMetaData("a","Kills",0)
  call Traffic_RegisterCustomMetaData("b","Deaths",0)
  call Traffic_RegisterCustomMetaData("c","Assists",0)
  call Traffic_RegisterCustomMetaData("d","CreepKills",0)
  call Traffic_RegisterCustomMetaData("e","CreepDenies",0)
  call Traffic_RegisterCustomMetaData("f","Neutrals",0)
  
  call StoreAllTints()
  call StoreAllUnitsBounty()
  call StoreAllUnitsSightRange()
  
  set CustomUnitBountySystem=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(CustomUnitBountySystem,EVENT_PLAYER_UNIT_DEATH)
  call TriggerAddCondition(CustomUnitBountySystem,Condition(function CustomUnitBountySystemInit))
  set t=CreateTrigger()
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PICKUP_ITEM)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DROP_ITEM)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PAWN_ITEM)
  call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
  call TriggerAddCondition(t,Condition(function EvasionStacking))
  call ExeFunc("fuckingstuck")
  call ExeFunc("SpiderlingsSpawnsInit")
  call ExeFunc("RadianceTriggered")
  call ExeFunc("Spiritbreaker_Charge_Init")
  call ExeFunc("PRD_Init")
  call ExeFunc("Kodo_DigestAllItems")
  set t=null
  set UJE=null
endfunction

function config takes nothing returns nothing
  call SetMapName("TRIGSTR_50000")
  call SetMapDescription("TRIGSTR_50001")
  call SetPlayers(10)
  call SetTeams(10)
  call SetGamePlacement(MAP_PLACEMENT_TEAMS_TOGETHER)
  call DefineStartLocation(0,-6990.,6840.)
  call DefineStartLocation(1,-6990.,6840.)
  call DefineStartLocation(2,-6990.,6840.)
  call DefineStartLocation(3,-6990.,6840.)
  call DefineStartLocation(4,-6990.,6840.)
  call DefineStartLocation(5,-6990.,6840.)
  call DefineStartLocation(6,-6990.,6840.)
  call DefineStartLocation(7,-6990.,6840.)
  call DefineStartLocation(8,-6990.,6840.)
  call DefineStartLocation(9,-6990.,6840.)
  call SetPlayerStartLocation(Player(1),0)
  call ForcePlayerStartLocation(Player(1),0)
  call SetPlayerColor(Player(1),ConvertPlayerColor(1))
  call SetPlayerRacePreference(Player(1),RACE_PREF_NIGHTELF)
  call SetPlayerRaceSelectable(Player(1),false)
  call SetPlayerController(Player(1),MAP_CONTROL_USER)
  call SetPlayerStartLocation(Player(2),1)
  call ForcePlayerStartLocation(Player(2),1)
  call SetPlayerColor(Player(2),ConvertPlayerColor(2))
  call SetPlayerRacePreference(Player(2),RACE_PREF_NIGHTELF)
  call SetPlayerRaceSelectable(Player(2),false)
  call SetPlayerController(Player(2),MAP_CONTROL_USER)
  call SetPlayerStartLocation(Player(3),2)
  call ForcePlayerStartLocation(Player(3),2)
  call SetPlayerColor(Player(3),ConvertPlayerColor(3))
  call SetPlayerRacePreference(Player(3),RACE_PREF_NIGHTELF)
  call SetPlayerRaceSelectable(Player(3),false)
  call SetPlayerController(Player(3),MAP_CONTROL_USER)
  call SetPlayerStartLocation(Player(4),3)
  call ForcePlayerStartLocation(Player(4),3)
  call SetPlayerColor(Player(4),ConvertPlayerColor(4))
  call SetPlayerRacePreference(Player(4),RACE_PREF_NIGHTELF)
  call SetPlayerRaceSelectable(Player(4),false)
  call SetPlayerController(Player(4),MAP_CONTROL_USER)
  call SetPlayerStartLocation(Player(5),4)
  call ForcePlayerStartLocation(Player(5),4)
  call SetPlayerColor(Player(5),ConvertPlayerColor(5))
  call SetPlayerRacePreference(Player(5),RACE_PREF_NIGHTELF)
  call SetPlayerRaceSelectable(Player(5),false)
  call SetPlayerController(Player(5),MAP_CONTROL_USER)
  call SetPlayerStartLocation(Player(7),5)
  call ForcePlayerStartLocation(Player(7),5)
  call SetPlayerColor(Player(7),ConvertPlayerColor(7))
  call SetPlayerRacePreference(Player(7),RACE_PREF_UNDEAD)
  call SetPlayerRaceSelectable(Player(7),false)
  call SetPlayerController(Player(7),MAP_CONTROL_USER)
  call SetPlayerStartLocation(Player(8),6)
  call ForcePlayerStartLocation(Player(8),6)
  call SetPlayerColor(Player(8),ConvertPlayerColor(8))
  call SetPlayerRacePreference(Player(8),RACE_PREF_UNDEAD)
  call SetPlayerRaceSelectable(Player(8),false)
  call SetPlayerController(Player(8),MAP_CONTROL_USER)
  call SetPlayerStartLocation(Player(9),7)
  call ForcePlayerStartLocation(Player(9),7)
  call SetPlayerColor(Player(9),ConvertPlayerColor(9))
  call SetPlayerRacePreference(Player(9),RACE_PREF_UNDEAD)
  call SetPlayerRaceSelectable(Player(9),false)
  call SetPlayerController(Player(9),MAP_CONTROL_USER)
  call SetPlayerStartLocation(Player(10),8)
  call ForcePlayerStartLocation(Player(10),8)
  call SetPlayerColor(Player(10),ConvertPlayerColor(10))
  call SetPlayerRacePreference(Player(10),RACE_PREF_UNDEAD)
  call SetPlayerRaceSelectable(Player(10),false)
  call SetPlayerController(Player(10),MAP_CONTROL_USER)
  call SetPlayerStartLocation(Player(11),9)
  call ForcePlayerStartLocation(Player(11),9)
  call SetPlayerColor(Player(11),ConvertPlayerColor(11))
  call SetPlayerRacePreference(Player(11),RACE_PREF_UNDEAD)
  call SetPlayerRaceSelectable(Player(11),false)
  call SetPlayerController(Player(11),MAP_CONTROL_USER)
  call InitCustomTeams()
  call SetPlayerAlliance(Player(15),Player(1),ConvertAllianceType(6),true)
  call SetPlayerAlliance(Player(15),Player(2),ConvertAllianceType(6),true)
  call SetPlayerAlliance(Player(15),Player(3),ConvertAllianceType(6),true)
  call SetPlayerAlliance(Player(15),Player(4),ConvertAllianceType(6),true)
  call SetPlayerAlliance(Player(15),Player(5),ConvertAllianceType(6),true)
  call SetPlayerAlliance(Player(15),Player(7),ConvertAllianceType(6),true)
  call SetPlayerAlliance(Player(15),Player(8),ConvertAllianceType(6),true)
  call SetPlayerAlliance(Player(15),Player(9),ConvertAllianceType(6),true)
  call SetPlayerAlliance(Player(15),Player(10),ConvertAllianceType(6),true)
  call SetPlayerAlliance(Player(15),Player(11),ConvertAllianceType(6),true)
  call SetStartLocPrioCount(0,9)
  call SetStartLocPrio(0,0,1,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(0,1,2,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(0,2,3,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(0,3,4,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(0,4,5,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(0,5,6,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(0,6,7,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(0,7,8,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(0,8,9,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrioCount(1,9)
  call SetStartLocPrio(1,0,0,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(1,1,2,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(1,2,3,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(1,3,4,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(1,4,5,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(1,5,6,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(1,6,7,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(1,7,8,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(1,8,9,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrioCount(2,9)
  call SetStartLocPrio(2,0,0,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(2,1,1,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(2,2,3,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(2,3,4,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(2,4,5,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(2,5,6,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(2,6,7,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(2,7,8,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(2,8,9,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrioCount(3,9)
  call SetStartLocPrio(3,0,0,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(3,1,1,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(3,2,2,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(3,3,4,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(3,4,5,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(3,5,6,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(3,6,7,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(3,7,8,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(3,8,9,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrioCount(4,9)
  call SetStartLocPrio(4,0,0,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(4,1,1,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(4,2,2,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(4,3,3,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(4,4,5,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(4,5,6,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(4,6,7,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(4,7,8,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(4,8,9,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrioCount(5,9)
  call SetStartLocPrio(5,0,0,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(5,1,1,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(5,2,2,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(5,3,3,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(5,4,4,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(5,5,6,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(5,6,7,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(5,7,8,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(5,8,9,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrioCount(6,9)
  call SetStartLocPrio(6,0,0,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(6,1,1,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(6,2,2,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(6,3,3,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(6,4,4,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(6,5,5,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(6,6,7,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(6,7,8,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(6,8,9,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrioCount(7,9)
  call SetStartLocPrio(7,0,0,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(7,1,1,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(7,2,2,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(7,3,3,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(7,4,4,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(7,5,5,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(7,6,6,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(7,7,8,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(7,8,9,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrioCount(8,9)
  call SetStartLocPrio(8,0,0,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(8,1,1,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(8,2,2,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(8,3,3,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(8,4,4,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(8,5,5,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(8,6,6,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(8,7,7,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(8,8,9,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrioCount(9,9)
  call SetStartLocPrio(9,0,0,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(9,1,1,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(9,2,2,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(9,3,3,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(9,4,4,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(9,5,5,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(9,6,6,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(9,7,7,MAP_LOC_PRIO_HIGH)
  call SetStartLocPrio(9,8,8,MAP_LOC_PRIO_HIGH)
endfunction
